var U={};U.toRGBA8=function(e){var r=e.width,n=e.height;if(e.tabs.acTL==null)return[U.toRGBA8.decodeImage(e.data,r,n,e).buffer];var t=[];e.frames[0].data==null&&(e.frames[0].data=e.data);for(var f=r*n*4,l=new Uint8Array(f),i=new Uint8Array(f),o=new Uint8Array(f),h=0;h<e.frames.length;h++){var a=e.frames[h],w=a.rect.x,v=a.rect.y,s=a.rect.width,u=a.rect.height,d=U.toRGBA8.decodeImage(a.data,s,u,e);if(h!=0)for(var A=0;A<f;A++)o[A]=l[A];if(a.blend==0?U._copyTile(d,s,u,l,r,n,w,v,0):a.blend==1&&U._copyTile(d,s,u,l,r,n,w,v,1),t.push(l.buffer.slice(0)),a.dispose!=0){if(a.dispose==1)U._copyTile(i,s,u,l,r,n,w,v,0);else if(a.dispose==2)for(var A=0;A<f;A++)l[A]=o[A]}}return t};U.toRGBA8.decodeImage=function(e,r,n,t){var f=r*n,l=U.decode._getBPP(t),i=Math.ceil(r*l/8),o=new Uint8Array(f*4),h=new Uint32Array(o.buffer),a=t.ctype,w=t.depth,v=U._bin.readUshort;if(a==6){var s=f<<2;if(w==8)for(var u=0;u<s;u+=4)o[u]=e[u],o[u+1]=e[u+1],o[u+2]=e[u+2],o[u+3]=e[u+3];if(w==16)for(var u=0;u<s;u++)o[u]=e[u<<1]}else if(a==2){var d=t.tabs.tRNS;if(d==null){if(w==8)for(var u=0;u<f;u++){var A=u*3;h[u]=255<<24|e[A+2]<<16|e[A+1]<<8|e[A]}if(w==16)for(var u=0;u<f;u++){var A=u*6;h[u]=255<<24|e[A+4]<<16|e[A+2]<<8|e[A]}}else{var M=d[0],c=d[1],p=d[2];if(w==8)for(var u=0;u<f;u++){var g=u<<2,A=u*3;h[u]=255<<24|e[A+2]<<16|e[A+1]<<8|e[A],e[A]==M&&e[A+1]==c&&e[A+2]==p&&(o[g+3]=0)}if(w==16)for(var u=0;u<f;u++){var g=u<<2,A=u*6;h[u]=255<<24|e[A+4]<<16|e[A+2]<<8|e[A],v(e,A)==M&&v(e,A+2)==c&&v(e,A+4)==p&&(o[g+3]=0)}}}else if(a==3){var P=t.tabs.PLTE,T=t.tabs.tRNS,_=T?T.length:0;if(w==1)for(var R=0;R<n;R++)for(var H=R*i,C=R*r,u=0;u<r;u++){var g=C+u<<2,z=e[H+(u>>3)]>>7-((u&7)<<0)&1,I=3*z;o[g]=P[I],o[g+1]=P[I+1],o[g+2]=P[I+2],o[g+3]=z<_?T[z]:255}if(w==2)for(var R=0;R<n;R++)for(var H=R*i,C=R*r,u=0;u<r;u++){var g=C+u<<2,z=e[H+(u>>2)]>>6-((u&3)<<1)&3,I=3*z;o[g]=P[I],o[g+1]=P[I+1],o[g+2]=P[I+2],o[g+3]=z<_?T[z]:255}if(w==4)for(var R=0;R<n;R++)for(var H=R*i,C=R*r,u=0;u<r;u++){var g=C+u<<2,z=e[H+(u>>1)]>>4-((u&1)<<2)&15,I=3*z;o[g]=P[I],o[g+1]=P[I+1],o[g+2]=P[I+2],o[g+3]=z<_?T[z]:255}if(w==8)for(var u=0;u<f;u++){var g=u<<2,z=e[u],I=3*z;o[g]=P[I],o[g+1]=P[I+1],o[g+2]=P[I+2],o[g+3]=z<_?T[z]:255}}else if(a==4){if(w==8)for(var u=0;u<f;u++){var g=u<<2,B=u<<1,D=e[B];o[g]=D,o[g+1]=D,o[g+2]=D,o[g+3]=e[B+1]}if(w==16)for(var u=0;u<f;u++){var g=u<<2,B=u<<2,D=e[B];o[g]=D,o[g+1]=D,o[g+2]=D,o[g+3]=e[B+2]}}else if(a==0)for(var M=t.tabs.tRNS?t.tabs.tRNS:-1,R=0;R<n;R++){var G=R*i,S=R*r;if(w==1)for(var q=0;q<r;q++){var D=255*(e[G+(q>>>3)]>>>7-(q&7)&1),L=D==M*255?0:255;h[S+q]=L<<24|D<<16|D<<8|D}else if(w==2)for(var q=0;q<r;q++){var D=85*(e[G+(q>>>2)]>>>6-((q&3)<<1)&3),L=D==M*85?0:255;h[S+q]=L<<24|D<<16|D<<8|D}else if(w==4)for(var q=0;q<r;q++){var D=17*(e[G+(q>>>1)]>>>4-((q&1)<<2)&15),L=D==M*17?0:255;h[S+q]=L<<24|D<<16|D<<8|D}else if(w==8)for(var q=0;q<r;q++){var D=e[G+q],L=D==M?0:255;h[S+q]=L<<24|D<<16|D<<8|D}else if(w==16)for(var q=0;q<r;q++){var D=e[G+(q<<1)],L=v(e,G+(q<<1))==M?0:255;h[S+q]=L<<24|D<<16|D<<8|D}}return o};U.decode=function(e){for(var r=new Uint8Array(e),n=8,t=U._bin,f=t.readUshort,l=t.readUint,i={tabs:{},frames:[]},o=new Uint8Array(r.length),h=0,a,w=0,v=[137,80,78,71,13,10,26,10],s=0;s<8;s++)if(r[s]!=v[s])throw"The input is not a PNG file!";for(;n<r.length;){var u=t.readUint(r,n);n+=4;var d=t.readASCII(r,n,4);if(n+=4,d=="IHDR")U.decode._IHDR(r,n,i);else if(d=="CgBI")i.tabs[d]=r.slice(n,n+4);else if(d=="IDAT"){for(var s=0;s<u;s++)o[h+s]=r[n+s];h+=u}else if(d=="acTL")i.tabs[d]={num_frames:l(r,n),num_plays:l(r,n+4)},a=new Uint8Array(r.length);else if(d=="fcTL"){if(w!=0){var A=i.frames[i.frames.length-1];A.data=U.decode._decompress(i,a.slice(0,w),A.rect.width,A.rect.height),w=0}var M={x:l(r,n+12),y:l(r,n+16),width:l(r,n+4),height:l(r,n+8)},c=f(r,n+22);c=f(r,n+20)/(c==0?100:c);var p={rect:M,delay:Math.round(c*1e3),dispose:r[n+24],blend:r[n+25]};i.frames.push(p)}else if(d=="fdAT"){for(var s=0;s<u-4;s++)a[w+s]=r[n+s+4];w+=u-4}else if(d=="pHYs")i.tabs[d]=[t.readUint(r,n),t.readUint(r,n+4),r[n+8]];else if(d=="cHRM"){i.tabs[d]=[];for(var s=0;s<8;s++)i.tabs[d].push(t.readUint(r,n+s*4))}else if(d=="tEXt"||d=="zTXt"){i.tabs[d]==null&&(i.tabs[d]={});var g=t.nextZero(r,n),P=t.readASCII(r,n,g-n),T,_=n+u-g-1;if(d=="tEXt")T=t.readASCII(r,g+1,_);else{var R=U.decode._inflate(r.slice(g+2,g+2+_));T=t.readUTF8(R,0,R.length)}i.tabs[d][P]=T}else if(d=="iTXt"){i.tabs[d]==null&&(i.tabs[d]={});var g=0,H=n;g=t.nextZero(r,H);var P=t.readASCII(r,H,g-H);H=g+1;var C=r[H];r[H+1],H+=2,g=t.nextZero(r,H),t.readASCII(r,H,g-H),H=g+1,g=t.nextZero(r,H),t.readUTF8(r,H,g-H),H=g+1;var T,_=u-(H-n);if(C==0)T=t.readUTF8(r,H,_);else{var R=U.decode._inflate(r.slice(H,H+_));T=t.readUTF8(R,0,R.length)}i.tabs[d][P]=T}else if(d=="PLTE")i.tabs[d]=t.readBytes(r,n,u);else if(d=="hIST"){var z=i.tabs.PLTE.length/3;i.tabs[d]=[];for(var s=0;s<z;s++)i.tabs[d].push(f(r,n+s*2))}else if(d=="tRNS")i.ctype==3?i.tabs[d]=t.readBytes(r,n,u):i.ctype==0?i.tabs[d]=f(r,n):i.ctype==2&&(i.tabs[d]=[f(r,n),f(r,n+2),f(r,n+4)]);else if(d=="gAMA")i.tabs[d]=t.readUint(r,n)/1e5;else if(d=="sRGB")i.tabs[d]=r[n];else if(d=="bKGD")i.ctype==0||i.ctype==4?i.tabs[d]=[f(r,n)]:i.ctype==2||i.ctype==6?i.tabs[d]=[f(r,n),f(r,n+2),f(r,n+4)]:i.ctype==3&&(i.tabs[d]=r[n]);else if(d=="IEND")break;n+=u,t.readUint(r,n),n+=4}if(w!=0){var A=i.frames[i.frames.length-1];A.data=U.decode._decompress(i,a.slice(0,w),A.rect.width,A.rect.height)}return i.data=U.decode._decompress(i,o,i.width,i.height),delete i.compress,delete i.interlace,delete i.filter,i};U.decode._decompress=function(e,r,n,t){var f=U.decode._getBPP(e),l=Math.ceil(n*f/8),i=new Uint8Array((l+1+e.interlace)*t);return e.tabs.CgBI?r=U.inflateRaw(r,i):r=U.decode._inflate(r,i),e.interlace==0?r=U.decode._filterZero(r,e,0,n,t):e.interlace==1&&(r=U.decode._readInterlace(r,e)),r};U.decode._inflate=function(e,r){var n=U.inflateRaw(new Uint8Array(e.buffer,2,e.length-6),r);return n};U.inflateRaw=function(){var e={};return e.H={},e.H.N=function(r,n){var t=Uint8Array,f=0,l=0,i=0,o=0,h=0,a=0,w=0,v=0,s=0,u,d;if(r[0]==3&&r[1]==0)return n||new t(0);var A=e.H,M=A.b,c=A.e,p=A.R,g=A.n,P=A.A,T=A.Z,_=A.m,R=n==null;for(R&&(n=new t(r.length>>>2<<5));f==0;){if(f=M(r,s,1),l=M(r,s+1,2),s+=3,l==0){s&7&&(s+=8-(s&7));var H=(s>>>3)+4,C=r[H-4]|r[H-3]<<8;R&&(n=e.H.W(n,v+C)),n.set(new t(r.buffer,r.byteOffset+H,C),v),s=H+C<<3,v+=C;continue}if(R&&(n=e.H.W(n,v+(1<<17))),l==1&&(u=_.J,d=_.h,a=511,w=31),l==2){i=c(r,s,5)+257,o=c(r,s+5,5)+1,h=c(r,s+10,4)+4,s+=14;for(var z=1,I=0;I<38;I+=2)_.Q[I]=0,_.Q[I+1]=0;for(var I=0;I<h;I++){var B=c(r,s+I*3,3);_.Q[(_.X[I]<<1)+1]=B,B>z&&(z=B)}s+=3*h,g(_.Q,z),P(_.Q,z,_.u),u=_.w,d=_.d,s=p(_.u,(1<<z)-1,i+o,r,s,_.v);var D=A.V(_.v,0,i,_.C);a=(1<<D)-1;var G=A.V(_.v,i,o,_.D);w=(1<<G)-1,g(_.C,D),P(_.C,D,u),g(_.D,G),P(_.D,G,d)}for(;;){var S=u[T(r,s)&a];s+=S&15;var q=S>>>4;if(!(q>>>8))n[v++]=q;else{if(q==256)break;var L=v+q-254;if(q>264){var E=_.q[q-257];L=v+(E>>>3)+c(r,s,E&7),s+=E&7}var F=d[T(r,s)&w];s+=F&15;var X=F>>>4,Z=_.c[X],k=(Z>>>4)+M(r,s,Z&15);for(s+=Z&15;v<L;)n[v]=n[v++-k],n[v]=n[v++-k],n[v]=n[v++-k],n[v]=n[v++-k];v=L}}}return n.length==v?n:n.slice(0,v)},e.H.W=function(r,n){var t=r.length;if(n<=t)return r;var f=new Uint8Array(t<<1);return f.set(r,0),f},e.H.R=function(r,n,t,f,l,i){for(var o=e.H.e,h=e.H.Z,a=0;a<t;){var w=r[h(f,l)&n];l+=w&15;var v=w>>>4;if(v<=15)i[a]=v,a++;else{var s=0,u=0;v==16?(u=3+o(f,l,2),l+=2,s=i[a-1]):v==17?(u=3+o(f,l,3),l+=3):v==18&&(u=11+o(f,l,7),l+=7);for(var d=a+u;a<d;)i[a]=s,a++}}return l},e.H.V=function(r,n,t,f){for(var l=0,i=0,o=f.length>>>1;i<t;){var h=r[i+n];f[i<<1]=0,f[(i<<1)+1]=h,h>l&&(l=h),i++}for(;i<o;)f[i<<1]=0,f[(i<<1)+1]=0,i++;return l},e.H.n=function(r,n){for(var t=e.H.m,f=r.length,l,i,o,h,a,w=t.j,h=0;h<=n;h++)w[h]=0;for(h=1;h<f;h+=2)w[r[h]]++;var v=t.K;for(l=0,w[0]=0,i=1;i<=n;i++)l=l+w[i-1]<<1,v[i]=l;for(o=0;o<f;o+=2)a=r[o+1],a!=0&&(r[o]=v[a],v[a]++)},e.H.A=function(r,n,t){for(var f=r.length,l=e.H.m,i=l.r,o=0;o<f;o+=2)if(r[o+1]!=0)for(var h=o>>1,a=r[o+1],w=h<<4|a,v=n-a,s=r[o]<<v,u=s+(1<<v);s!=u;){var d=i[s]>>>15-n;t[d]=w,s++}},e.H.l=function(r,n){for(var t=e.H.m.r,f=15-n,l=0;l<r.length;l+=2){var i=r[l]<<n-r[l+1];r[l]=t[i]>>>f}},e.H.M=function(r,n,t){t=t<<(n&7);var f=n>>>3;r[f]|=t,r[f+1]|=t>>>8},e.H.I=function(r,n,t){t=t<<(n&7);var f=n>>>3;r[f]|=t,r[f+1]|=t>>>8,r[f+2]|=t>>>16},e.H.e=function(r,n,t){return(r[n>>>3]|r[(n>>>3)+1]<<8)>>>(n&7)&(1<<t)-1},e.H.b=function(r,n,t){return(r[n>>>3]|r[(n>>>3)+1]<<8|r[(n>>>3)+2]<<16)>>>(n&7)&(1<<t)-1},e.H.Z=function(r,n){return(r[n>>>3]|r[(n>>>3)+1]<<8|r[(n>>>3)+2]<<16)>>>(n&7)},e.H.i=function(r,n){return(r[n>>>3]|r[(n>>>3)+1]<<8|r[(n>>>3)+2]<<16|r[(n>>>3)+3]<<24)>>>(n&7)},e.H.m=function(){var r=Uint16Array,n=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new n(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new n(286),Y:new n(30),a:new n(19),t:new n(15e3),k:new r(65536),g:new r(32768)}}(),function(){for(var r=e.H.m,n=32768,t=0;t<n;t++){var f=t;f=(f&2863311530)>>>1|(f&1431655765)<<1,f=(f&3435973836)>>>2|(f&858993459)<<2,f=(f&4042322160)>>>4|(f&252645135)<<4,f=(f&4278255360)>>>8|(f&16711935)<<8,r.r[t]=(f>>>16|f<<16)>>>17}function l(i,o,h){for(;o--!=0;)i.push(0,h)}for(var t=0;t<32;t++)r.q[t]=r.S[t]<<3|r.T[t],r.c[t]=r.p[t]<<4|r.z[t];l(r._,144,8),l(r._,112,9),l(r._,24,7),l(r._,8,8),e.H.n(r._,9),e.H.A(r._,9,r.J),e.H.l(r._,9),l(r.$,32,5),e.H.n(r.$,5),e.H.A(r.$,5,r.h),e.H.l(r.$,5),l(r.Q,19,0),l(r.C,286,0),l(r.D,30,0),l(r.v,320,0)}(),e.H.N}();U.decode._readInterlace=function(e,r){for(var n=r.width,t=r.height,f=U.decode._getBPP(r),l=f>>3,i=Math.ceil(n*f/8),o=new Uint8Array(t*i),h=0,a=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],v=[8,8,8,4,4,2,2],s=[8,8,4,4,2,2,1],u=0;u<7;){for(var d=v[u],A=s[u],M=0,c=0,p=a[u];p<t;)p+=d,c++;for(var g=w[u];g<n;)g+=A,M++;var P=Math.ceil(M*f/8);U.decode._filterZero(e,r,h,M,c);for(var T=0,_=a[u];_<t;){for(var R=w[u],H=h+T*P<<3;R<n;){if(f==1){var C=e[H>>3];C=C>>7-(H&7)&1,o[_*i+(R>>3)]|=C<<7-((R&7)<<0)}if(f==2){var C=e[H>>3];C=C>>6-(H&7)&3,o[_*i+(R>>2)]|=C<<6-((R&3)<<1)}if(f==4){var C=e[H>>3];C=C>>4-(H&7)&15,o[_*i+(R>>1)]|=C<<4-((R&1)<<2)}if(f>=8)for(var z=_*i+R*l,I=0;I<l;I++)o[z+I]=e[(H>>3)+I];H+=f,R+=A}T++,_+=d}M*c!=0&&(h+=c*(1+P)),u=u+1}return o};U.decode._getBPP=function(e){var r=[1,null,3,1,2,null,4][e.ctype];return r*e.depth};U.decode._filterZero=function(e,r,n,t,f){var l=U.decode._getBPP(r),i=Math.ceil(t*l/8),o=U.decode._paeth;l=Math.ceil(l/8);var h,a,w=e[n],v=0;if(w>1&&(e[n]=[0,0,1][w-2]),w==3)for(v=l;v<i;v++)e[v+1]=e[v+1]+(e[v+1-l]>>>1)&255;for(var s=0;s<f;s++)if(h=n+s*i,a=h+s+1,w=e[a-1],v=0,w==0)for(;v<i;v++)e[h+v]=e[a+v];else if(w==1){for(;v<l;v++)e[h+v]=e[a+v];for(;v<i;v++)e[h+v]=e[a+v]+e[h+v-l]}else if(w==2)for(;v<i;v++)e[h+v]=e[a+v]+e[h+v-i];else if(w==3){for(;v<l;v++)e[h+v]=e[a+v]+(e[h+v-i]>>>1);for(;v<i;v++)e[h+v]=e[a+v]+(e[h+v-i]+e[h+v-l]>>>1)}else{for(;v<l;v++)e[h+v]=e[a+v]+o(0,e[h+v-i],0);for(;v<i;v++)e[h+v]=e[a+v]+o(e[h+v-l],e[h+v-i],e[h+v-l-i])}return e};U.decode._paeth=function(e,r,n){var t=e+r-n,f=t-e,l=t-r,i=t-n;return f*f<=l*l&&f*f<=i*i?e:l*l<=i*i?r:n};U.decode._IHDR=function(e,r,n){var t=U._bin;n.width=t.readUint(e,r),r+=4,n.height=t.readUint(e,r),r+=4,n.depth=e[r],r++,n.ctype=e[r],r++,n.compress=e[r],r++,n.filter=e[r],r++,n.interlace=e[r],r++};U._bin={nextZero:function(e,r){for(;e[r]!=0;)r++;return r},readUshort:function(e,r){return e[r]<<8|e[r+1]},writeUshort:function(e,r,n){e[r]=n>>8&255,e[r+1]=n&255},readUint:function(e,r){return e[r]*(256*256*256)+(e[r+1]<<16|e[r+2]<<8|e[r+3])},writeUint:function(e,r,n){e[r]=n>>24&255,e[r+1]=n>>16&255,e[r+2]=n>>8&255,e[r+3]=n&255},readASCII:function(e,r,n){for(var t="",f=0;f<n;f++)t+=String.fromCharCode(e[r+f]);return t},writeASCII:function(e,r,n){for(var t=0;t<n.length;t++)e[r+t]=n.charCodeAt(t)},readBytes:function(e,r,n){for(var t=[],f=0;f<n;f++)t.push(e[r+f]);return t},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,r,n){for(var t="",f,l=0;l<n;l++)t+="%"+U._bin.pad(e[r+l].toString(16));try{f=decodeURIComponent(t)}catch{return U._bin.readASCII(e,r,n)}return f}};U._copyTile=function(e,r,n,t,f,l,i,o,h){for(var a=Math.min(r,f),w=Math.min(n,l),v=0,s=0,u=0;u<w;u++)for(var d=0;d<a;d++)if(i>=0&&o>=0?(v=u*r+d<<2,s=(o+u)*f+i+d<<2):(v=(-o+u)*r-i+d<<2,s=u*f+d<<2),h==0)t[s]=e[v],t[s+1]=e[v+1],t[s+2]=e[v+2],t[s+3]=e[v+3];else if(h==1){var A=e[v+3]*.00392156862745098,M=e[v]*A,c=e[v+1]*A,p=e[v+2]*A,g=t[s+3]*(1/255),P=t[s]*g,T=t[s+1]*g,_=t[s+2]*g,R=1-A,H=A+g*R,C=H==0?0:1/H;t[s+3]=255*H,t[s+0]=(M+P*R)*C,t[s+1]=(c+T*R)*C,t[s+2]=(p+_*R)*C}else if(h==2){var A=e[v+3],M=e[v],c=e[v+1],p=e[v+2],g=t[s+3],P=t[s],T=t[s+1],_=t[s+2];A==g&&M==P&&c==T&&p==_?(t[s]=0,t[s+1]=0,t[s+2]=0,t[s+3]=0):(t[s]=M,t[s+1]=c,t[s+2]=p,t[s+3]=A)}else if(h==3){var A=e[v+3],M=e[v],c=e[v+1],p=e[v+2],g=t[s+3],P=t[s],T=t[s+1],_=t[s+2];if(A==g&&M==P&&c==T&&p==_)continue;if(A<220&&g>20)return!1}return!0};U.encode=function(e,r,n,t,f,l,i){t==null&&(t=0),i==null&&(i=!1);var o=U.encode.compress(e,r,n,t,[!1,!1,!1,0,i,!1]);return U.encode.compressPNG(o,-1),U.encode._main(o,r,n,f,l)};U.encodeLL=function(e,r,n,t,f,l,i,o){for(var h={ctype:0+(t==1?0:2)+(f==0?0:4),depth:l,frames:[]},a=(t+f)*l,w=a*r,v=0;v<e.length;v++)h.frames.push({rect:{x:0,y:0,width:r,height:n},img:new Uint8Array(e[v]),blend:0,dispose:1,bpp:Math.ceil(a/8),bpl:Math.ceil(w/8)});U.encode.compressPNG(h,0,!0);var s=U.encode._main(h,r,n,i,o);return s};U.encode._main=function(e,r,n,t,f){f==null&&(f={});var l=U.crc.crc,i=U._bin.writeUint,o=U._bin.writeUshort,h=U._bin.writeASCII,a=8,w=e.frames.length>1,v=!1,s=33+(w?20:0);if(f.sRGB!=null&&(s+=13),f.pHYs!=null&&(s+=21),e.ctype==3){for(var u=e.plte.length,d=0;d<u;d++)e.plte[d]>>>24!=255&&(v=!0);s+=8+u*3+4+(v?8+u*1+4:0)}for(var A=0;A<e.frames.length;A++){var M=e.frames[A];w&&(s+=38),s+=M.cimg.length+12,A!=0&&(s+=4)}s+=12;for(var c=new Uint8Array(s),p=[137,80,78,71,13,10,26,10],d=0;d<8;d++)c[d]=p[d];if(i(c,a,13),a+=4,h(c,a,"IHDR"),a+=4,i(c,a,r),a+=4,i(c,a,n),a+=4,c[a]=e.depth,a++,c[a]=e.ctype,a++,c[a]=0,a++,c[a]=0,a++,c[a]=0,a++,i(c,a,l(c,a-17,17)),a+=4,f.sRGB!=null&&(i(c,a,1),a+=4,h(c,a,"sRGB"),a+=4,c[a]=f.sRGB,a++,i(c,a,l(c,a-5,5)),a+=4),f.pHYs!=null&&(i(c,a,9),a+=4,h(c,a,"pHYs"),a+=4,i(c,a,f.pHYs[0]),a+=4,i(c,a,f.pHYs[1]),a+=4,c[a]=f.pHYs[2],a++,i(c,a,l(c,a-13,13)),a+=4),w&&(i(c,a,8),a+=4,h(c,a,"acTL"),a+=4,i(c,a,e.frames.length),a+=4,i(c,a,f.loop!=null?f.loop:0),a+=4,i(c,a,l(c,a-12,12)),a+=4),e.ctype==3){var u=e.plte.length;i(c,a,u*3),a+=4,h(c,a,"PLTE"),a+=4;for(var d=0;d<u;d++){var g=d*3,P=e.plte[d],T=P&255,_=P>>>8&255,R=P>>>16&255;c[a+g+0]=T,c[a+g+1]=_,c[a+g+2]=R}if(a+=u*3,i(c,a,l(c,a-u*3-4,u*3+4)),a+=4,v){i(c,a,u),a+=4,h(c,a,"tRNS"),a+=4;for(var d=0;d<u;d++)c[a+d]=e.plte[d]>>>24&255;a+=u,i(c,a,l(c,a-u-4,u+4)),a+=4}}for(var H=0,A=0;A<e.frames.length;A++){var M=e.frames[A];w&&(i(c,a,26),a+=4,h(c,a,"fcTL"),a+=4,i(c,a,H++),a+=4,i(c,a,M.rect.width),a+=4,i(c,a,M.rect.height),a+=4,i(c,a,M.rect.x),a+=4,i(c,a,M.rect.y),a+=4,o(c,a,t[A]),a+=2,o(c,a,1e3),a+=2,c[a]=M.dispose,a++,c[a]=M.blend,a++,i(c,a,l(c,a-30,30)),a+=4);var C=M.cimg,u=C.length;i(c,a,u+(A==0?0:4)),a+=4;var z=a;h(c,a,A==0?"IDAT":"fdAT"),a+=4,A!=0&&(i(c,a,H++),a+=4),c.set(C,a),a+=u,i(c,a,l(c,z,a-z)),a+=4}return i(c,a,0),a+=4,h(c,a,"IEND"),a+=4,i(c,a,l(c,a-4,4)),a+=4,c.buffer};U.encode.compressPNG=function(e,r,n){for(var t=0;t<e.frames.length;t++){var f=e.frames[t];f.rect.width;var l=f.rect.height,i=new Uint8Array(l*f.bpl+l);f.cimg=U.encode._filterZero(f.img,l,f.bpp,f.bpl,i,r,n)}};U.encode.compress=function(e,r,n,t,f){for(var l=f[0],i=f[1],o=f[2],h=f[3],a=f[4],w=f[5],v=6,s=8,u=255,d=0;d<e.length;d++)for(var A=new Uint8Array(e[d]),M=A.length,c=0;c<M;c+=4)u&=A[c+3];var p=u!=255,g=U.encode.framize(e,r,n,l,i,o),P={},T=[],_=[];if(t!=0){for(var R=[],c=0;c<g.length;c++)R.push(g[c].img.buffer);for(var H=U.encode.concatRGBA(R),C=U.quantize(H,t),c=0;c<C.plte.length;c++)T.push(C.plte[c].est.rgba);for(var z=0,c=0;c<g.length;c++){var I=g[c],B=I.img.length,D=new Uint8Array(C.inds.buffer,z>>2,B>>2);_.push(D);var G=new Uint8Array(C.abuf,z,B);w&&U.encode.dither(I.img,I.rect.width,I.rect.height,T,G,D),I.img.set(G),z+=B}}else for(var d=0;d<g.length;d++){var I=g[d],S=new Uint32Array(I.img.buffer),q=I.rect.width,M=S.length,D=new Uint8Array(M);_.push(D);for(var c=0;c<M;c++){var L=S[c];if(c!=0&&L==S[c-1])D[c]=D[c-1];else if(c>q&&L==S[c-q])D[c]=D[c-q];else{var E=P[L];if(E==null&&(P[L]=E=T.length,T.push(L),T.length>=300))break;D[c]=E}}}var F=T.length;F<=256&&a==!1&&(F<=2?s=1:F<=4?s=2:F<=16?s=4:s=8,s=Math.max(s,h));for(var d=0;d<g.length;d++){var I=g[d];I.rect.x,I.rect.y;var q=I.rect.width,X=I.rect.height,Z=I.img;new Uint32Array(Z.buffer);var k=4*q,$=4;if(F<=256&&a==!1){k=Math.ceil(s*q/8);for(var Q=new Uint8Array(k*X),Y=_[d],J=0;J<X;J++){var c=J*k,K=J*q;if(s==8)for(var x=0;x<q;x++)Q[c+x]=Y[K+x];else if(s==4)for(var x=0;x<q;x++)Q[c+(x>>1)]|=Y[K+x]<<4-(x&1)*4;else if(s==2)for(var x=0;x<q;x++)Q[c+(x>>2)]|=Y[K+x]<<6-(x&3)*2;else if(s==1)for(var x=0;x<q;x++)Q[c+(x>>3)]|=Y[K+x]<<7-(x&7)*1}Z=Q,v=3,$=1}else if(p==!1&&g.length==1){for(var Q=new Uint8Array(q*X*3),y=q*X,c=0;c<y;c++){var O=c*3,b=c*4;Q[O]=Z[b],Q[O+1]=Z[b+1],Q[O+2]=Z[b+2]}Z=Q,v=2,$=3,k=3*q}I.img=Z,I.bpl=k,I.bpp=$}return{ctype:v,depth:s,plte:T,frames:g}};U.encode.framize=function(e,r,n,t,f,l){for(var i=[],o=0;o<e.length;o++){var h=new Uint8Array(e[o]),a=new Uint32Array(h.buffer),w,v=0,s=0,u=r,d=n,A=t?1:0;if(o!=0){for(var M=l||t||o==1||i[o-2].dispose!=0?1:2,c=0,p=1e9,g=0;g<M;g++){for(var D=new Uint8Array(e[o-1-g]),P=new Uint32Array(e[o-1-g]),T=r,_=n,R=-1,H=-1,C=0;C<n;C++)for(var z=0;z<r;z++){var I=C*r+z;a[I]!=P[I]&&(z<T&&(T=z),z>R&&(R=z),C<_&&(_=C),C>H&&(H=C))}R==-1&&(T=_=R=H=0),f&&((T&1)==1&&T--,(_&1)==1&&_--);var B=(R-T+1)*(H-_+1);B<p&&(p=B,c=g,v=T,s=_,u=R-T+1,d=H-_+1)}var D=new Uint8Array(e[o-1-c]);c==1&&(i[o-1].dispose=2),w=new Uint8Array(u*d*4),U._copyTile(D,r,n,w,u,d,-v,-s,0),A=U._copyTile(h,r,n,w,u,d,-v,-s,3)?1:0,A==1?U.encode._prepareDiff(h,r,n,w,{x:v,y:s,width:u,height:d}):U._copyTile(h,r,n,w,u,d,-v,-s,0)}else w=h.slice(0);i.push({rect:{x:v,y:s,width:u,height:d},img:w,blend:A,dispose:0})}if(t)for(var o=0;o<i.length;o++){var G=i[o];if(G.blend!=1){var S=G.rect,q=i[o-1].rect,L=Math.min(S.x,q.x),E=Math.min(S.y,q.y),F=Math.max(S.x+S.width,q.x+q.width),X=Math.max(S.y+S.height,q.y+q.height),Z={x:L,y:E,width:F-L,height:X-E};i[o-1].dispose=1,o-1!=0&&U.encode._updateFrame(e,r,n,i,o-1,Z,f),U.encode._updateFrame(e,r,n,i,o,Z,f)}}var k=0;if(e.length!=1)for(var I=0;I<i.length;I++){var G=i[I];k+=G.rect.width*G.rect.height}return i};U.encode._updateFrame=function(e,r,n,t,f,l,i){for(var o=Uint8Array,h=Uint32Array,a=new o(e[f-1]),w=new h(e[f-1]),v=f+1<e.length?new o(e[f+1]):null,s=new o(e[f]),u=new h(s.buffer),d=r,A=n,M=-1,c=-1,p=0;p<l.height;p++)for(var g=0;g<l.width;g++){var P=l.x+g,T=l.y+p,_=T*r+P,R=u[_];R==0||t[f-1].dispose==0&&w[_]==R&&(v==null||v[_*4+3]!=0)||(P<d&&(d=P),P>M&&(M=P),T<A&&(A=T),T>c&&(c=T))}M==-1&&(d=A=M=c=0),i&&((d&1)==1&&d--,(A&1)==1&&A--),l={x:d,y:A,width:M-d+1,height:c-A+1};var H=t[f];H.rect=l,H.blend=1,H.img=new Uint8Array(l.width*l.height*4),t[f-1].dispose==0?(U._copyTile(a,r,n,H.img,l.width,l.height,-l.x,-l.y,0),U.encode._prepareDiff(s,r,n,H.img,l)):U._copyTile(s,r,n,H.img,l.width,l.height,-l.x,-l.y,0)};U.encode._prepareDiff=function(e,r,n,t,f){U._copyTile(e,r,n,t,f.width,f.height,-f.x,-f.y,2)};U.encode._filterZero=function(e,r,n,t,f,l,i){var o=[],h=[0,1,2,3,4];l!=-1?h=[l]:(r*t>5e5||n==1)&&(h=[0]);var a;i&&(a={level:0});for(var w=f.length>1e7&&UZIP!=null?UZIP:pako,v=0;v<h.length;v++){for(var s=0;s<r;s++)U.encode._filterLine(f,e,s,t,n,h[v]);o.push(w.deflate(f,a))}for(var u,d=1e9,v=0;v<o.length;v++)o[v].length<d&&(u=v,d=o[v].length);return o[u]};U.encode._filterLine=function(e,r,n,t,f,l){var i=n*t,o=i+n,h=U.decode._paeth;if(e[o]=l,o++,l==0)if(t<500)for(var a=0;a<t;a++)e[o+a]=r[i+a];else e.set(new Uint8Array(r.buffer,i,t),o);else if(l==1){for(var a=0;a<f;a++)e[o+a]=r[i+a];for(var a=f;a<t;a++)e[o+a]=r[i+a]-r[i+a-f]+256&255}else if(n==0){for(var a=0;a<f;a++)e[o+a]=r[i+a];if(l==2)for(var a=f;a<t;a++)e[o+a]=r[i+a];if(l==3)for(var a=f;a<t;a++)e[o+a]=r[i+a]-(r[i+a-f]>>1)+256&255;if(l==4)for(var a=f;a<t;a++)e[o+a]=r[i+a]-h(r[i+a-f],0,0)+256&255}else{if(l==2)for(var a=0;a<t;a++)e[o+a]=r[i+a]+256-r[i+a-t]&255;if(l==3){for(var a=0;a<f;a++)e[o+a]=r[i+a]+256-(r[i+a-t]>>1)&255;for(var a=f;a<t;a++)e[o+a]=r[i+a]+256-(r[i+a-t]+r[i+a-f]>>1)&255}if(l==4){for(var a=0;a<f;a++)e[o+a]=r[i+a]+256-h(0,r[i+a-t],0)&255;for(var a=f;a<t;a++)e[o+a]=r[i+a]+256-h(r[i+a-f],r[i+a-t],r[i+a-f-t])&255}}};U.crc={table:function(){for(var e=new Uint32Array(256),r=0;r<256;r++){for(var n=r,t=0;t<8;t++)n&1?n=3988292384^n>>>1:n=n>>>1;e[r]=n}return e}(),update:function(e,r,n,t){for(var f=0;f<t;f++)e=U.crc.table[(e^r[n+f])&255]^e>>>8;return e},crc:function(e,r,n){return U.crc.update(4294967295,e,r,n)^4294967295}};U.quantize=function(e,r){var n=new Uint8Array(e),t=n.slice(0),f=new Uint32Array(t.buffer),l=U.quantize.getKDtree(t,r),i=l[0],o=l[1],h=U.quantize.planeDst,a=n.length,w=new Uint8Array(a>>2),v;if(n.length<2e7)for(var s=0;s<a;s+=4){var u=n[s]*.00392156862745098,d=n[s+1]*(1/255),A=n[s+2]*(1/255),M=n[s+3]*(1/255);v=U.quantize.getNearest(i,u,d,A,M),w[s>>2]=v.ind,f[s>>2]=v.est.rgba}else for(var s=0;s<a;s+=4){var u=n[s]*.00392156862745098,d=n[s+1]*(1/255),A=n[s+2]*(1/255),M=n[s+3]*(1/255);for(v=i;v.left;)v=h(v.est,u,d,A,M)<=0?v.left:v.right;w[s>>2]=v.ind,f[s>>2]=v.est.rgba}return{abuf:t.buffer,inds:w,plte:o}};U.quantize.getKDtree=function(e,r,n){n==null&&(n=1e-4);var t=new Uint32Array(e.buffer),f={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};f.bst=U.quantize.stats(e,f.i0,f.i1),f.est=U.quantize.estats(f.bst);for(var l=[f];l.length<r;){for(var i=0,o=0,h=0;h<l.length;h++)l[h].est.L>i&&(i=l[h].est.L,o=h);if(i<n)break;var a=l[o],w=U.quantize.splitPixels(e,t,a.i0,a.i1,a.est.e,a.est.eMq255),v=a.i0>=w||a.i1<=w;if(v){a.est.L=0;continue}var s={i0:a.i0,i1:w,bst:null,est:null,tdst:0,left:null,right:null};s.bst=U.quantize.stats(e,s.i0,s.i1),s.est=U.quantize.estats(s.bst);var u={i0:w,i1:a.i1,bst:null,est:null,tdst:0,left:null,right:null};u.bst={R:[],m:[],N:a.bst.N-s.bst.N};for(var h=0;h<16;h++)u.bst.R[h]=a.bst.R[h]-s.bst.R[h];for(var h=0;h<4;h++)u.bst.m[h]=a.bst.m[h]-s.bst.m[h];u.est=U.quantize.estats(u.bst),a.left=s,a.right=u,l[o]=s,l.push(u)}l.sort(function(d,A){return A.bst.N-d.bst.N});for(var h=0;h<l.length;h++)l[h].ind=h;return[f,l]};U.quantize.getNearest=function(e,r,n,t,f){if(e.left==null)return e.tdst=U.quantize.dist(e.est.q,r,n,t,f),e;var l=U.quantize.planeDst(e.est,r,n,t,f),i=e.left,o=e.right;l>0&&(i=e.right,o=e.left);var h=U.quantize.getNearest(i,r,n,t,f);if(h.tdst<=l*l)return h;var a=U.quantize.getNearest(o,r,n,t,f);return a.tdst<h.tdst?a:h};U.quantize.planeDst=function(e,r,n,t,f){var l=e.e;return l[0]*r+l[1]*n+l[2]*t+l[3]*f-e.eMq};U.quantize.dist=function(e,r,n,t,f){var l=r-e[0],i=n-e[1],o=t-e[2],h=f-e[3];return l*l+i*i+o*o+h*h};U.quantize.splitPixels=function(e,r,n,t,f,l){var i=U.quantize.vecDot;for(t-=4;n<t;){for(;i(e,n,f)<=l;)n+=4;for(;i(e,t,f)>l;)t-=4;if(n>=t)break;var o=r[n>>2];r[n>>2]=r[t>>2],r[t>>2]=o,n+=4,t-=4}for(;i(e,n,f)>l;)n-=4;return n+4};U.quantize.vecDot=function(e,r,n){return e[r]*n[0]+e[r+1]*n[1]+e[r+2]*n[2]+e[r+3]*n[3]};U.quantize.stats=function(e,r,n){for(var t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f=[0,0,0,0],l=n-r>>2,i=r;i<n;i+=4){var o=e[i]*.00392156862745098,h=e[i+1]*(1/255),a=e[i+2]*(1/255),w=e[i+3]*(1/255);f[0]+=o,f[1]+=h,f[2]+=a,f[3]+=w,t[0]+=o*o,t[1]+=o*h,t[2]+=o*a,t[3]+=o*w,t[5]+=h*h,t[6]+=h*a,t[7]+=h*w,t[10]+=a*a,t[11]+=a*w,t[15]+=w*w}return t[4]=t[1],t[8]=t[2],t[9]=t[6],t[12]=t[3],t[13]=t[7],t[14]=t[11],{R:t,m:f,N:l}};U.quantize.estats=function(e){var r=e.R,n=e.m,t=e.N,f=n[0],l=n[1],i=n[2],o=n[3],h=t==0?0:1/t,a=[r[0]-f*f*h,r[1]-f*l*h,r[2]-f*i*h,r[3]-f*o*h,r[4]-l*f*h,r[5]-l*l*h,r[6]-l*i*h,r[7]-l*o*h,r[8]-i*f*h,r[9]-i*l*h,r[10]-i*i*h,r[11]-i*o*h,r[12]-o*f*h,r[13]-o*l*h,r[14]-o*i*h,r[15]-o*o*h],w=a,v=U.M4,s=[Math.random(),Math.random(),Math.random(),Math.random()],u=0,d=0;if(t!=0)for(var A=0;A<16&&(s=v.multVec(w,s),d=Math.sqrt(v.dot(s,s)),s=v.sml(1/d,s),!(A!=0&&Math.abs(d-u)<1e-9));A++)u=d;var M=[f*h,l*h,i*h,o*h],c=v.dot(v.sml(255,M),s);return{Cov:a,q:M,e:s,L:u,eMq255:c,eMq:v.dot(s,M),rgba:(Math.round(255*M[3])<<24|Math.round(255*M[2])<<16|Math.round(255*M[1])<<8|Math.round(255*M[0])<<0)>>>0}};U.M4={multVec:function(e,r){return[e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3],e[4]*r[0]+e[5]*r[1]+e[6]*r[2]+e[7]*r[3],e[8]*r[0]+e[9]*r[1]+e[10]*r[2]+e[11]*r[3],e[12]*r[0]+e[13]*r[1]+e[14]*r[2]+e[15]*r[3]]},dot:function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]},sml:function(e,r){return[e*r[0],e*r[1],e*r[2],e*r[3]]}};U.encode.concatRGBA=function(e){for(var r=0,n=0;n<e.length;n++)r+=e[n].byteLength;for(var t=new Uint8Array(r),f=0,n=0;n<e.length;n++){for(var l=new Uint8Array(e[n]),i=l.length,o=0;o<i;o+=4){var h=l[o],a=l[o+1],w=l[o+2],v=l[o+3];v==0&&(h=a=w=0),t[f+o]=h,t[f+o+1]=a,t[f+o+2]=w,t[f+o+3]=v}f+=i}return t.buffer};U.encode.dither=function(e,r,n,t,f,l){function i(z,I,B,D){I[B]+=z[0]*D>>4,I[B+1]+=z[1]*D>>4,I[B+2]+=z[2]*D>>4,I[B+3]+=z[3]*D>>4}function o(z){return Math.max(0,Math.min(255,z))}function h(z,I){var B=z[0]-I[0],D=z[1]-I[1],G=z[2]-I[2],S=z[3]-I[3];return B*B+D*D+G*G+S*S}for(var a=t.length,w=[],v=0;v<a;v++){var s=t[v];w.push([s>>>0&255,s>>>8&255,s>>>16&255,s>>>24&255])}for(var v=0;v<a;v++)for(var u=4294967295,d=0,A=0;A<a;A++){var M=h(w[v],w[A]);A!=v&&M<u&&(u=M,d=A)}for(var c=new Uint32Array(f.buffer),p=new Int16Array(r*n*4),g=0;g<n;g++)for(var P=0;P<r;P++){for(var v=(g*r+P)*4,T=[o(e[v]+p[v]),o(e[v+1]+p[v+1]),o(e[v+2]+p[v+2]),o(e[v+3]+p[v+3])],d=0,_=16777215,A=0;A<a;A++){var R=h(T,w[A]);R<_&&(_=R,d=A)}var H=w[d],C=[T[0]-H[0],T[1]-H[1],T[2]-H[2],T[3]-H[3]];P!=r-1&&i(C,p,v+4,7),g!=n-1&&(P!=0&&i(C,p,v+4*r-4,3),i(C,p,v+4*r,5),P!=r-1&&i(C,p,v+4*r+4,1)),l[v>>2]=d,c[v>>2]=t[d]}};export{U as UPNG};
