import{aD as yn,aa as kn,ac as st,aj as wn,ad as Nn,V as $,j as X,h as it,f as An,am as Tn,b as at,a0 as he,aY as rt,aZ as ot,a_ as En,a$ as _n,g as ct,o as xn,D as Cn,ak as vn,P as lt,b0 as Ln,b1 as In,b2 as Rn,b3 as Mn,ai as Sn,B as Gn,ao as te,G as dt,Q as On,an as Se,b4 as jn,ap as ut,b5 as qn,M as Pn,L as Bn,as as Hn,Y as Te,af as ft,b6 as Un}from"./ddd@DwDq534T.js";class ht extends yn{constructor(K){super(K)}parse(K){function ne(h){switch(h.image_type){case pe:case z:if(h.colormap_length>256||h.colormap_size!==24||h.colormap_type!==1)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case U:case V:case de:case me:if(h.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case _e:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+h.image_type)}if(h.width<=0||h.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(h.pixel_size!==8&&h.pixel_size!==16&&h.pixel_size!==24&&h.pixel_size!==32)throw new Error("THREE.TGALoader: Invalid pixel size "+h.pixel_size)}function H(h,q,R,C,P){let _,v;const A=R.pixel_size>>3,N=R.width*R.height*A;if(q&&(v=P.subarray(C,C+=R.colormap_length*(R.colormap_size>>3))),h){_=new Uint8Array(N);let y,u,k,M=0;const J=new Uint8Array(A);for(;M<N;)if(y=P[C++],u=(y&127)+1,y&128){for(k=0;k<A;++k)J[k]=P[C++];for(k=0;k<u;++k)_.set(J,M+k*A);M+=A*u}else{for(u*=A,k=0;k<u;++k)_[M+k]=P[C++];M+=u}}else _=P.subarray(C,C+=q?R.width*R.height:N);return{pixel_data:_,palettes:v}}function ee(h,q,R,C,P,_,v,A,N){const y=N;let u,k=0,M,J;const ae=j.width;for(J=q;J!==C;J+=R)for(M=P;M!==v;M+=_,k++)u=A[k],h[(M+ae*J)*4+3]=255,h[(M+ae*J)*4+2]=y[u*3+0],h[(M+ae*J)*4+1]=y[u*3+1],h[(M+ae*J)*4+0]=y[u*3+2];return h}function L(h,q,R,C,P,_,v,A){let N,y=0,u,k;const M=j.width;for(k=q;k!==C;k+=R)for(u=P;u!==v;u+=_,y+=2)N=A[y+0]+(A[y+1]<<8),h[(u+M*k)*4+0]=(N&31744)>>7,h[(u+M*k)*4+1]=(N&992)>>2,h[(u+M*k)*4+2]=(N&31)<<3,h[(u+M*k)*4+3]=N&32768?0:255;return h}function Z(h,q,R,C,P,_,v,A){let N=0,y,u;const k=j.width;for(u=q;u!==C;u+=R)for(y=P;y!==v;y+=_,N+=3)h[(y+k*u)*4+3]=255,h[(y+k*u)*4+2]=A[N+0],h[(y+k*u)*4+1]=A[N+1],h[(y+k*u)*4+0]=A[N+2];return h}function S(h,q,R,C,P,_,v,A){let N=0,y,u;const k=j.width;for(u=q;u!==C;u+=R)for(y=P;y!==v;y+=_,N+=4)h[(y+k*u)*4+2]=A[N+0],h[(y+k*u)*4+1]=A[N+1],h[(y+k*u)*4+0]=A[N+2],h[(y+k*u)*4+3]=A[N+3];return h}function le(h,q,R,C,P,_,v,A){let N,y=0,u,k;const M=j.width;for(k=q;k!==C;k+=R)for(u=P;u!==v;u+=_,y++)N=A[y],h[(u+M*k)*4+0]=N,h[(u+M*k)*4+1]=N,h[(u+M*k)*4+2]=N,h[(u+M*k)*4+3]=255;return h}function Q(h,q,R,C,P,_,v,A){let N=0,y,u;const k=j.width;for(u=q;u!==C;u+=R)for(y=P;y!==v;y+=_,N+=2)h[(y+k*u)*4+0]=A[N+0],h[(y+k*u)*4+1]=A[N+0],h[(y+k*u)*4+2]=A[N+0],h[(y+k*u)*4+3]=A[N+1];return h}function Ee(h,q,R,C,P){let _,v,A,N,y,u;switch((j.flags&xe)>>be){default:case ve:_=0,A=1,y=q,v=0,N=1,u=R;break;case ge:_=0,A=1,y=q,v=R-1,N=-1,u=-1;break;case se:_=q-1,A=-1,y=-1,v=0,N=1,u=R;break;case Ce:_=q-1,A=-1,y=-1,v=R-1,N=-1,u=-1;break}if(fe)switch(j.pixel_size){case 8:le(h,v,N,u,_,A,y,C);break;case 16:Q(h,v,N,u,_,A,y,C);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(j.pixel_size){case 8:ee(h,v,N,u,_,A,y,C,P);break;case 16:L(h,v,N,u,_,A,y,C);break;case 24:Z(h,v,N,u,_,A,y,C);break;case 32:S(h,v,N,u,_,A,y,C);break;default:throw new Error("THREE.TGALoader: Format not supported.")}return h}const _e=0,pe=1,U=2,V=3,z=9,de=10,me=11,xe=48,be=4,ge=0,Ce=1,ve=2,se=3;if(K.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let I=0;const G=new Uint8Array(K),j={id_length:G[I++],colormap_type:G[I++],image_type:G[I++],colormap_index:G[I++]|G[I++]<<8,colormap_length:G[I++]|G[I++]<<8,colormap_size:G[I++],origin:[G[I++]|G[I++]<<8,G[I++]|G[I++]<<8],width:G[I++]|G[I++]<<8,height:G[I++]|G[I++]<<8,pixel_size:G[I++],flags:G[I++]};if(ne(j),j.id_length+I>K.length)throw new Error("THREE.TGALoader: No data.");I+=j.id_length;let ie=!1,ue=!1,fe=!1;switch(j.image_type){case z:ie=!0,ue=!0;break;case pe:ue=!0;break;case de:ie=!0;break;case U:break;case me:ie=!0,fe=!0;break;case V:fe=!0;break}const ye=new Uint8Array(j.width*j.height*4),ke=H(ie,ue,j,I,G);return Ee(ye,j.width,j.height,ke.pixel_data,ke.palettes),{data:ye,width:j.width,height:j.height,flipY:!0,generateMipmaps:!0,minFilter:kn}}}class Fn extends st{load(K,ne,H,ee){const L=this,Z=L.path===""?wn.extractUrlBase(K):L.path,S=new Nn(L.manager);S.setPath(L.path),S.setRequestHeader(L.requestHeader),S.setWithCredentials(L.withCredentials),S.load(K,function(le){try{ne(L.parse(le,Z))}catch(Q){ee?ee(Q):console.error(Q),L.manager.itemError(K)}},H,ee)}parse(K,ne){function H(t,e){const s=[],n=t.childNodes;for(let i=0,a=n.length;i<a;i++){const r=n[i];r.nodeName===e&&s.push(r)}return s}function ee(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),s=new Array(e.length);for(let n=0,i=e.length;n<i;n++)s[n]=e[n];return s}function L(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),s=new Array(e.length);for(let n=0,i=e.length;n<i;n++)s[n]=parseFloat(e[n]);return s}function Z(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),s=new Array(e.length);for(let n=0,i=e.length;n<i;n++)s[n]=parseInt(e[n]);return s}function S(t){return t.substring(1)}function le(){return"three_default_"+bn++}function Q(t){return Object.keys(t).length===0}function Ee(t){return{unit:_e(H(t,"unit")[0]),upAxis:pe(H(t,"up_axis")[0])}}function _e(t){return t!==void 0&&t.hasAttribute("meter")===!0?parseFloat(t.getAttribute("meter")):1}function pe(t){return t!==void 0?t.textContent:"Y_UP"}function U(t,e,s,n){const i=H(t,e)[0];if(i!==void 0){const a=H(i,s);for(let r=0;r<a.length;r++)n(a[r])}}function V(t,e){for(const s in t){const n=t[s];n.build=e(t[s])}}function z(t,e){return t.build!==void 0||(t.build=e(t)),t.build}function de(t){const e={sources:{},samplers:{},channels:{}};let s=!1;for(let n=0,i=t.childNodes.length;n<i;n++){const a=t.childNodes[n];if(a.nodeType!==1)continue;let r;switch(a.nodeName){case"source":r=a.getAttribute("id"),e.sources[r]=Le(a);break;case"sampler":r=a.getAttribute("id"),e.samplers[r]=me(a);break;case"channel":r=a.getAttribute("target"),e.channels[r]=xe(a);break;case"animation":de(a),s=!0;break;default:console.log(a)}}s===!1&&(w.animations[t.getAttribute("id")||he.generateUUID()]=e)}function me(t){const e={inputs:{}};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"input":const a=S(i.getAttribute("source")),r=i.getAttribute("semantic");e.inputs[r]=a;break}}return e}function xe(t){const e={};let n=t.getAttribute("target").split("/");const i=n.shift();let a=n.shift();const r=a.indexOf("(")!==-1,d=a.indexOf(".")!==-1;if(d)n=a.split("."),a=n.shift(),e.member=n.shift();else if(r){const c=a.split("(");a=c.shift();for(let l=0;l<c.length;l++)c[l]=parseInt(c[l].replace(/\)/,""));e.indices=c}return e.id=i,e.sid=a,e.arraySyntax=r,e.memberSyntax=d,e.sampler=S(t.getAttribute("source")),e}function be(t){const e=[],s=t.channels,n=t.samplers,i=t.sources;for(const a in s)if(s.hasOwnProperty(a)){const r=s[a],d=n[r.sampler],c=d.inputs.INPUT,l=d.inputs.OUTPUT,m=i[c],o=i[l],p=Ce(r,m,o);j(p,e)}return e}function ge(t){return z(w.animations[t],be)}function Ce(t,e,s){const n=w.nodes[t.id],i=oe(n.id),a=n.transforms[t.sid],r=n.matrix.clone().transpose();let d,c,l,m,o,p;const f={};switch(a){case"matrix":for(l=0,m=e.array.length;l<m;l++)if(d=e.array[l],c=l*s.stride,f[d]===void 0&&(f[d]={}),t.arraySyntax===!0){const O=s.array[c],x=t.indices[0]+4*t.indices[1];f[d][x]=O}else for(o=0,p=s.stride;o<p;o++)f[d][o]=s.array[c+o];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',a);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',a);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',a);break}const g=ve(f,r);return{name:i.uuid,keyframes:g}}function ve(t,e){const s=[];for(const i in t)s.push({time:parseFloat(i),value:t[i]});s.sort(n);for(let i=0;i<16;i++)ie(s,i,e.elements[i]);return s;function n(i,a){return i.time-a.time}}const se=new $,I=new $,G=new On;function j(t,e){const s=t.keyframes,n=t.name,i=[],a=[],r=[],d=[];for(let c=0,l=s.length;c<l;c++){const m=s[c],o=m.time,p=m.value;D.fromArray(p).transpose(),D.decompose(se,G,I),i.push(o),a.push(se.x,se.y,se.z),r.push(G.x,G.y,G.z,G.w),d.push(I.x,I.y,I.z)}return a.length>0&&e.push(new ot(n+".position",i,a)),r.length>0&&e.push(new En(n+".quaternion",i,r)),d.length>0&&e.push(new ot(n+".scale",i,d)),e}function ie(t,e,s){let n,i=!0,a,r;for(a=0,r=t.length;a<r;a++)n=t[a],n.value[e]===void 0?n.value[e]=null:i=!1;if(i===!0)for(a=0,r=t.length;a<r;a++)n=t[a],n.value[e]=s;else ue(t,e)}function ue(t,e){let s,n;for(let i=0,a=t.length;i<a;i++){const r=t[i];if(r.value[e]===null){if(s=fe(t,i,e),n=ye(t,i,e),s===null){r.value[e]=n.value[e];continue}if(n===null){r.value[e]=s.value[e];continue}ke(r,s,n,e)}}}function fe(t,e,s){for(;e>=0;){const n=t[e];if(n.value[s]!==null)return n;e--}return null}function ye(t,e,s){for(;e<t.length;){const n=t[e];if(n.value[s]!==null)return n;e++}return null}function ke(t,e,s,n){if(s.time-e.time===0){t.value[n]=e.value[n];return}t.value[n]=(t.time-e.time)*(s.value[n]-e.value[n])/(s.time-e.time)+e.value[n]}function h(t){const e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"instance_animation":e.animations.push(S(i.getAttribute("url")));break}}w.clips[t.getAttribute("id")]=e}function q(t){const e=[],s=t.name,n=t.end-t.start||-1,i=t.animations;for(let a=0,r=i.length;a<r;a++){const d=ge(i[a]);for(let c=0,l=d.length;c<l;c++)e.push(d[c])}return new rt(s,n,e)}function R(t){return z(w.clips[t],q)}function C(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"skin":e.id=S(i.getAttribute("source")),e.skin=P(i);break;case"morph":e.id=S(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}w.controllers[t.getAttribute("id")]=e}function P(t){const e={sources:{}};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=L(i.textContent);break;case"source":const a=i.getAttribute("id");e.sources[a]=Le(i);break;case"joints":e.joints=_(i);break;case"vertex_weights":e.vertexWeights=v(i);break}}return e}function _(t){const e={inputs:{}};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"input":const a=i.getAttribute("semantic"),r=S(i.getAttribute("source"));e.inputs[a]=r;break}}return e}function v(t){const e={inputs:{}};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"input":const a=i.getAttribute("semantic"),r=S(i.getAttribute("source")),d=parseInt(i.getAttribute("offset"));e.inputs[a]={id:r,offset:d};break;case"vcount":e.vcount=Z(i.textContent);break;case"v":e.v=Z(i.textContent);break}}return e}function A(t){const e={id:t.id},s=w.geometries[e.id];return t.skin!==void 0&&(e.skin=N(t.skin),s.sources.skinIndices=e.skin.indices,s.sources.skinWeights=e.skin.weights),e}function N(t){const s={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},n=t.sources,i=t.vertexWeights,a=i.vcount,r=i.v,d=i.inputs.JOINT.offset,c=i.inputs.WEIGHT.offset,l=t.sources[t.joints.inputs.JOINT],m=t.sources[t.joints.inputs.INV_BIND_MATRIX],o=n[i.inputs.WEIGHT.id].array;let p=0,f,g,b;for(f=0,b=a.length;f<b;f++){const x=a[f],T=[];for(g=0;g<x;g++){const E=r[p+d],Y=r[p+c],F=o[Y];T.push({index:E,weight:F}),p+=2}for(T.sort(O),g=0;g<4;g++){const E=T[g];E!==void 0?(s.indices.array.push(E.index),s.weights.array.push(E.weight)):(s.indices.array.push(0),s.weights.array.push(0))}}for(t.bindShapeMatrix?s.bindMatrix=new X().fromArray(t.bindShapeMatrix).transpose():s.bindMatrix=new X().identity(),f=0,b=l.array.length;f<b;f++){const x=l.array[f],T=new X().fromArray(m.array,f*m.stride).transpose();s.joints.push({name:x,boneInverse:T})}return s;function O(x,T){return T.weight-x.weight}}function y(t){return z(w.controllers[t],A)}function u(t){const e={init_from:H(t,"init_from")[0].textContent};w.images[t.getAttribute("id")]=e}function k(t){return t.build!==void 0?t.build:t.init_from}function M(t){const e=w.images[t];return e!==void 0?z(e,k):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function J(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"profile_COMMON":e.profile=ae(i);break}}w.effects[t.getAttribute("id")]=e}function ae(t){const e={surfaces:{},samplers:{}};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"newparam":mt(i,e);break;case"technique":e.technique=yt(i);break;case"extra":e.extra=je(i);break}}return e}function mt(t,e){const s=t.getAttribute("sid");for(let n=0,i=t.childNodes.length;n<i;n++){const a=t.childNodes[n];if(a.nodeType===1)switch(a.nodeName){case"surface":e.surfaces[s]=bt(a);break;case"sampler2D":e.samplers[s]=gt(a);break}}}function bt(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"init_from":e.init_from=i.textContent;break}}return e}function gt(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"source":e.source=i.textContent;break}}return e}function yt(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=i.nodeName,e.parameters=kt(i);break;case"extra":e.extra=je(i);break}}return e}function kt(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[i.nodeName]=Ge(i);break;case"transparent":e[i.nodeName]={opaque:i.hasAttribute("opaque")?i.getAttribute("opaque"):"A_ONE",data:Ge(i)};break}}return e}function Ge(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"color":e[i.nodeName]=L(i.textContent);break;case"float":e[i.nodeName]=parseFloat(i.textContent);break;case"texture":e[i.nodeName]={id:i.getAttribute("texture"),extra:Oe(i)};break}}return e}function Oe(t){const e={technique:{}};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"extra":wt(i,e);break}}return e}function wt(t,e){for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"technique":Nt(i,e);break}}}function Nt(t,e){for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":i.textContent.toUpperCase()==="TRUE"?e.technique[i.nodeName]=1:i.textContent.toUpperCase()==="FALSE"?e.technique[i.nodeName]=0:e.technique[i.nodeName]=parseInt(i.textContent);break;case"bump":e[i.nodeName]=qe(i);break}}}function je(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"technique":e.technique=At(i);break}}return e}function At(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"double_sided":e[i.nodeName]=parseInt(i.textContent);break;case"bump":e[i.nodeName]=qe(i);break}}return e}function qe(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"texture":e[i.nodeName]={id:i.getAttribute("texture"),texcoord:i.getAttribute("texcoord"),extra:Oe(i)};break}}return e}function Pe(t){return t}function Tt(t){return z(w.effects[t],Pe)}function Et(t){const e={name:t.getAttribute("name")};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"instance_effect":e.url=S(i.getAttribute("url"));break}}w.materials[t.getAttribute("id")]=e}function _t(t){let e,s=t.slice((t.lastIndexOf(".")-1>>>0)+2);switch(s=s.toLowerCase(),s){case"tga":e=Me;break;default:e=et}return e}function Be(t){const e=Tt(t.url),s=e.profile.technique;let n;switch(s.type){case"phong":case"blinn":n=new ct;break;case"lambert":n=new _n;break;default:n=new it;break}n.name=t.name||"";function i(c,l=null){const m=e.profile.samplers[c.id];let o=null;if(m!==void 0){const p=e.profile.surfaces[m.source];o=M(p.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),o=M(c.id);if(o!==null){const p=_t(o);if(p!==void 0){const f=p.load(o),g=c.extra;if(g!==void 0&&g.technique!==void 0&&Q(g.technique)===!1){const b=g.technique;f.wrapS=b.wrapU?Te:ft,f.wrapT=b.wrapV?Te:ft,f.offset.set(b.offsetU||0,b.offsetV||0),f.repeat.set(b.repeatU||1,b.repeatV||1)}else f.wrapS=Te,f.wrapT=Te;return l!==null&&(f.colorSpace=l),f}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",o),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",c.id),null}const a=s.parameters;for(const c in a){const l=a[c];switch(c){case"diffuse":l.color&&n.color.fromArray(l.color),l.texture&&(n.map=i(l.texture,Se));break;case"specular":l.color&&n.specular&&n.specular.fromArray(l.color),l.texture&&(n.specularMap=i(l.texture));break;case"bump":l.texture&&(n.normalMap=i(l.texture));break;case"ambient":l.texture&&(n.lightMap=i(l.texture,Se));break;case"shininess":l.float&&n.shininess&&(n.shininess=l.float);break;case"emission":l.color&&n.emissive&&n.emissive.fromArray(l.color),l.texture&&(n.emissiveMap=i(l.texture,Se));break}}n.color.convertSRGBToLinear(),n.specular&&n.specular.convertSRGBToLinear(),n.emissive&&n.emissive.convertSRGBToLinear();let r=a.transparent,d=a.transparency;if(d===void 0&&r&&(d={float:1}),r===void 0&&d&&(r={opaque:"A_ONE",data:{color:[1,1,1,1]}}),r&&d)if(r.data.texture)n.transparent=!0;else{const c=r.data.color;switch(r.opaque){case"A_ONE":n.opacity=c[3]*d.float;break;case"RGB_ZERO":n.opacity=1-c[0]*d.float;break;case"A_ZERO":n.opacity=1-c[3]*d.float;break;case"RGB_ONE":n.opacity=c[0]*d.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',r.opaque)}n.opacity<1&&(n.transparent=!0)}if(s.extra!==void 0&&s.extra.technique!==void 0){const c=s.extra.technique;for(const l in c){const m=c[l];switch(l){case"double_sided":n.side=m===1?Cn:vn;break;case"bump":n.normalMap=i(m.texture),n.normalScale=new xn(1,1);break}}}return n}function xt(t){return z(w.materials[t],Be)}function Ct(t){const e={name:t.getAttribute("name")};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"optics":e.optics=vt(i);break}}w.cameras[t.getAttribute("id")]=e}function vt(t){for(let e=0;e<t.childNodes.length;e++){const s=t.childNodes[e];switch(s.nodeName){case"technique_common":return Lt(s)}}return{}}function Lt(t){const e={};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];switch(n.nodeName){case"perspective":case"orthographic":e.technique=n.nodeName,e.parameters=It(n);break}}return e}function It(t){const e={};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[n.nodeName]=parseFloat(n.textContent);break}}return e}function He(t){let e;switch(t.optics.technique){case"perspective":e=new lt(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":let s=t.optics.parameters.ymag,n=t.optics.parameters.xmag;const i=t.optics.parameters.aspect_ratio;n=n===void 0?s*i:n,s=s===void 0?n/i:s,n*=.5,s*=.5,e=new Ln(-n,n,s,-s,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new lt;break}return e.name=t.name||"",e}function Rt(t){const e=w.cameras[t];return e!==void 0?z(e,He):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function Mt(t){let e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"technique_common":e=St(i);break}}w.lights[t.getAttribute("id")]=e}function St(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=i.nodeName,e.parameters=Gt(i)}}return e}function Gt(t){const e={};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"color":const a=L(i.textContent);e.color=new at().fromArray(a).convertSRGBToLinear();break;case"falloff_angle":e.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":const r=parseFloat(i.textContent);e.distance=r?Math.sqrt(1/r):0;break}}return e}function Ue(t){let e;switch(t.technique){case"directional":e=new Sn;break;case"point":e=new Mn;break;case"spot":e=new Rn;break;case"ambient":e=new In;break}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function Ot(t){const e=w.lights[t];return e!==void 0?z(e,Ue):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function jt(t){const e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},s=H(t,"mesh")[0];if(s!==void 0){for(let n=0;n<s.childNodes.length;n++){const i=s.childNodes[n];if(i.nodeType!==1)continue;const a=i.getAttribute("id");switch(i.nodeName){case"source":e.sources[a]=Le(i);break;case"vertices":e.vertices=qt(i);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",i.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(Pt(i));break;default:console.log(i)}}w.geometries[t.getAttribute("id")]=e}}function Le(t){const e={array:[],stride:3};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"float_array":e.array=L(n.textContent);break;case"Name_array":e.array=ee(n.textContent);break;case"technique_common":const i=H(n,"accessor")[0];i!==void 0&&(e.stride=parseInt(i.getAttribute("stride")));break}}return e}function qt(t){const e={};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];n.nodeType===1&&(e[n.getAttribute("semantic")]=S(n.getAttribute("source")))}return e}function Pt(t){const e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let s=0,n=t.childNodes.length;s<n;s++){const i=t.childNodes[s];if(i.nodeType===1)switch(i.nodeName){case"input":const a=S(i.getAttribute("source")),r=i.getAttribute("semantic"),d=parseInt(i.getAttribute("offset")),c=parseInt(i.getAttribute("set")),l=c>0?r+c:r;e.inputs[l]={id:a,offset:d},e.stride=Math.max(e.stride,d+1),r==="TEXCOORD"&&(e.hasUV=!0);break;case"vcount":e.vcount=Z(i.textContent);break;case"p":e.p=Z(i.textContent);break}}return e}function Bt(t){const e={};for(let s=0;s<t.length;s++){const n=t[s];e[n.type]===void 0&&(e[n.type]=[]),e[n.type].push(n)}return e}function Ht(t){let e=0;for(let s=0,n=t.length;s<n;s++)t[s].hasUV===!0&&e++;e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function ze(t){const e={},s=t.sources,n=t.vertices,i=t.primitives;if(i.length===0)return{};const a=Bt(i);for(const r in a){const d=a[r];Ht(d),e[r]=Ut(d,s,n)}return e}function Ut(t,e,s){const n={},i={array:[],stride:0},a={array:[],stride:0},r={array:[],stride:0},d={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:4},m={array:[],stride:4},o=new Gn,p=[];let f=0;for(let g=0;g<t.length;g++){const b=t[g],O=b.inputs;let x=0;switch(b.type){case"lines":case"linestrips":x=b.count*2;break;case"triangles":x=b.count*3;break;case"polylist":for(let T=0;T<b.count;T++){const E=b.vcount[T];switch(E){case 3:x+=3;break;case 4:x+=6;break;default:x+=(E-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",b.type)}o.addGroup(f,x,g),f+=x,b.material&&p.push(b.material);for(const T in O){const E=O[T];switch(T){case"VERTEX":for(const Y in s){const F=s[Y];switch(Y){case"POSITION":const ce=i.array.length;if(W(b,e[F],E.offset,i.array),i.stride=e[F].stride,e.skinWeights&&e.skinIndices&&(W(b,e.skinIndices,E.offset,l.array),W(b,e.skinWeights,E.offset,m.array)),b.hasUV===!1&&t.uvsNeedsFix===!0){const gn=(i.array.length-ce)/i.stride;for(let nt=0;nt<gn;nt++)r.array.push(0,0)}break;case"NORMAL":W(b,e[F],E.offset,a.array),a.stride=e[F].stride;break;case"COLOR":W(b,e[F],E.offset,c.array),c.stride=e[F].stride;break;case"TEXCOORD":W(b,e[F],E.offset,r.array),r.stride=e[F].stride;break;case"TEXCOORD1":W(b,e[F],E.offset,d.array),r.stride=e[F].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',Y)}}break;case"NORMAL":W(b,e[E.id],E.offset,a.array),a.stride=e[E.id].stride;break;case"COLOR":W(b,e[E.id],E.offset,c.array,!0),c.stride=e[E.id].stride;break;case"TEXCOORD":W(b,e[E.id],E.offset,r.array),r.stride=e[E.id].stride;break;case"TEXCOORD1":W(b,e[E.id],E.offset,d.array),d.stride=e[E.id].stride;break}}}return i.array.length>0&&o.setAttribute("position",new te(i.array,i.stride)),a.array.length>0&&o.setAttribute("normal",new te(a.array,a.stride)),c.array.length>0&&o.setAttribute("color",new te(c.array,c.stride)),r.array.length>0&&o.setAttribute("uv",new te(r.array,r.stride)),d.array.length>0&&o.setAttribute("uv1",new te(d.array,d.stride)),l.array.length>0&&o.setAttribute("skinIndex",new te(l.array,l.stride)),m.array.length>0&&o.setAttribute("skinWeight",new te(m.array,m.stride)),n.data=o,n.type=t[0].type,n.materialKeys=p,n}function W(t,e,s,n,i=!1){const a=t.p,r=t.stride,d=t.vcount;function c(o){let p=a[o+s]*m;const f=p+m;for(;p<f;p++)n.push(l[p]);if(i){const g=n.length-m-1;we.setRGB(n[g+0],n[g+1],n[g+2]).convertSRGBToLinear(),n[g+0]=we.r,n[g+1]=we.g,n[g+2]=we.b}}const l=e.array,m=e.stride;if(t.vcount!==void 0){let o=0;for(let p=0,f=d.length;p<f;p++){const g=d[p];if(g===4){const b=o+r*0,O=o+r*1,x=o+r*2,T=o+r*3;c(b),c(O),c(T),c(O),c(x),c(T)}else if(g===3){const b=o+r*0,O=o+r*1,x=o+r*2;c(b),c(O),c(x)}else if(g>4)for(let b=1,O=g-2;b<=O;b++){const x=o+r*0,T=o+r*b,E=o+r*(b+1);c(x),c(T),c(E)}o+=r*g}}else for(let o=0,p=a.length;o<p;o+=r)c(o)}function Fe(t){return z(w.geometries[t],ze)}function zt(t){const e={name:t.getAttribute("name")||"",joints:{},links:[]};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"technique_common":Dt(n,e);break}}w.kinematicsModels[t.getAttribute("id")]=e}function Ft(t){return t.build!==void 0?t.build:t}function Vt(t){return z(w.kinematicsModels[t],Ft)}function Dt(t,e){for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"joint":e.joints[n.getAttribute("sid")]=Kt(n);break;case"link":e.links.push(Ve(n));break}}}function Kt(t){let e;for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"prismatic":case"revolute":e=Jt(n);break}}return e}function Jt(t){const e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new $,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"axis":const i=L(n.textContent);e.axis.fromArray(i);break;case"limits":const a=n.getElementsByTagName("max")[0],r=n.getElementsByTagName("min")[0];e.limits.max=parseFloat(a.textContent),e.limits.min=parseFloat(r.textContent);break}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function Ve(t){const e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"attachment_full":e.attachments.push(Wt(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(De(n));break}}return e}function Wt(t){const e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"link":e.links.push(Ve(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(De(n));break}}return e}function De(t){const e={type:t.nodeName},s=L(t.textContent);switch(e.type){case"matrix":e.obj=new X,e.obj.fromArray(s).transpose();break;case"translate":e.obj=new $,e.obj.fromArray(s);break;case"rotate":e.obj=new $,e.obj.fromArray(s),e.angle=he.degToRad(s[3]);break}return e}function Yt(t){const e={name:t.getAttribute("name")||"",rigidBodies:{}};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"rigid_body":e.rigidBodies[n.getAttribute("name")]={},Xt(n,e.rigidBodies[n.getAttribute("name")]);break}}w.physicsModels[t.getAttribute("id")]=e}function Xt(t,e){for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"technique_common":Zt(n,e);break}}}function Zt(t,e){for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"inertia":e.inertia=L(n.textContent);break;case"mass":e.mass=L(n.textContent)[0];break}}}function Qt(t){const e={bindJointAxis:[]};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"bind_joint_axis":e.bindJointAxis.push($t(n));break}}w.kinematicsScenes[S(t.getAttribute("url"))]=e}function $t(t){const e={target:t.getAttribute("target").split("/").pop()};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType===1)switch(n.nodeName){case"axis":const i=n.getElementsByTagName("param")[0];e.axis=i.textContent;const a=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=a.substring(0,a.length-1);break}}return e}function en(t){return t.build!==void 0?t.build:t}function tn(t){return z(w.kinematicsScenes[t],en)}function nn(){const t=Object.keys(w.kinematicsModels)[0],e=Object.keys(w.kinematicsScenes)[0],s=Object.keys(w.visualScenes)[0];if(t===void 0||e===void 0)return;const n=Vt(t),i=tn(e),a=Ze(s),r=i.bindJointAxis,d={};for(let m=0,o=r.length;m<o;m++){const p=r[m],f=B.querySelector('[sid="'+p.target+'"]');if(f){const g=f.parentElement;c(p.jointIndex,g)}}function c(m,o){const p=o.getAttribute("name"),f=n.joints[m];a.traverse(function(g){g.name===p&&(d[m]={object:g,transforms:sn(o),joint:f,position:f.zeroPosition})})}const l=new X;tt={joints:n&&n.joints,getJointValue:function(m){const o=d[m];if(o)return o.position;console.warn("THREE.ColladaLoader: Joint "+m+" doesn't exist.")},setJointValue:function(m,o){const p=d[m];if(p){const f=p.joint;if(o>f.limits.max||o<f.limits.min)console.warn("THREE.ColladaLoader: Joint "+m+" value "+o+" outside of limits (min: "+f.limits.min+", max: "+f.limits.max+").");else if(f.static)console.warn("THREE.ColladaLoader: Joint "+m+" is static.");else{const g=p.object,b=f.axis,O=p.transforms;D.identity();for(let x=0;x<O.length;x++){const T=O[x];if(T.sid&&T.sid.indexOf(m)!==-1)switch(f.type){case"revolute":D.multiply(l.makeRotationAxis(b,he.degToRad(o)));break;case"prismatic":D.multiply(l.makeTranslation(b.x*o,b.y*o,b.z*o));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+f.type);break}else switch(T.type){case"matrix":D.multiply(T.obj);break;case"translate":D.multiply(l.makeTranslation(T.obj.x,T.obj.y,T.obj.z));break;case"scale":D.scale(T.obj);break;case"rotate":D.multiply(l.makeRotationAxis(T.obj,T.angle));break}}g.matrix.copy(D),g.matrix.decompose(g.position,g.quaternion,g.scale),d[m].position=o}}else console.log("THREE.ColladaLoader: "+m+" does not exist.")}}}function sn(t){const e=[],s=B.querySelector('[id="'+t.id+'"]');for(let n=0;n<s.childNodes.length;n++){const i=s.childNodes[n];if(i.nodeType!==1)continue;let a,r;switch(i.nodeName){case"matrix":a=L(i.textContent);const d=new X().fromArray(a).transpose();e.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:d});break;case"translate":case"scale":a=L(i.textContent),r=new $().fromArray(a),e.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:r});break;case"rotate":a=L(i.textContent),r=new $().fromArray(a);const c=he.degToRad(a[3]);e.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:r,angle:c});break}}return e}function an(t){const e=t.getElementsByTagName("node");for(let s=0;s<e.length;s++){const n=e[s];n.hasAttribute("id")===!1&&n.setAttribute("id",le())}}const D=new X,re=new $;function Ie(t){const e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new X,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];if(n.nodeType!==1)continue;let i;switch(n.nodeName){case"node":e.nodes.push(n.getAttribute("id")),Ie(n);break;case"instance_camera":e.instanceCameras.push(S(n.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(Ke(n));break;case"instance_light":e.instanceLights.push(S(n.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(Ke(n));break;case"instance_node":e.instanceNodes.push(S(n.getAttribute("url")));break;case"matrix":i=L(n.textContent),e.matrix.multiply(D.fromArray(i).transpose()),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":i=L(n.textContent),re.fromArray(i),e.matrix.multiply(D.makeTranslation(re.x,re.y,re.z)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":i=L(n.textContent);const a=he.degToRad(i[3]);e.matrix.multiply(D.makeRotationAxis(re.fromArray(i),a)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":i=L(n.textContent),e.matrix.scale(re.fromArray(i)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Ye(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):w.nodes[e.id]=e,e}function Ke(t){const e={id:S(t.getAttribute("url")),materials:{},skeletons:[]};for(let s=0;s<t.childNodes.length;s++){const n=t.childNodes[s];switch(n.nodeName){case"bind_material":const i=n.getElementsByTagName("instance_material");for(let a=0;a<i.length;a++){const r=i[a],d=r.getAttribute("symbol"),c=r.getAttribute("target");e.materials[d]=S(c)}break;case"skeleton":e.skeletons.push(S(n.textContent));break}}return e}function rn(t,e){const s=[],n=[];let i,a,r;for(i=0;i<t.length;i++){const l=t[i];let m;if(Ye(l))m=oe(l),Je(m,e,s);else if(un(l)){const p=w.visualScenes[l].children;for(let f=0;f<p.length;f++){const g=p[f];if(g.type==="JOINT"){const b=oe(g.id);Je(b,e,s)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",l)}for(i=0;i<e.length;i++)for(a=0;a<s.length;a++)if(r=s[a],r.bone.name===e[i].name){n[i]=r,r.processed=!0;break}for(i=0;i<s.length;i++)r=s[i],r.processed===!1&&(n.push(r),r.processed=!0);const d=[],c=[];for(i=0;i<n.length;i++)r=n[i],d.push(r.bone),c.push(r.boneInverse);return new Un(d,c)}function Je(t,e,s){t.traverse(function(n){if(n.isBone===!0){let i;for(let a=0;a<e.length;a++){const r=e[a];if(r.name===n.name){i=r.boneInverse;break}}i===void 0&&(i=new X),s.push({bone:n,boneInverse:i,processed:!1})}})}function on(t){const e=[],s=t.matrix,n=t.nodes,i=t.type,a=t.instanceCameras,r=t.instanceControllers,d=t.instanceLights,c=t.instanceGeometries,l=t.instanceNodes;for(let o=0,p=n.length;o<p;o++)e.push(oe(n[o]));for(let o=0,p=a.length;o<p;o++){const f=Rt(a[o]);f!==null&&e.push(f.clone())}for(let o=0,p=r.length;o<p;o++){const f=r[o],g=y(f.id),b=Fe(g.id),O=We(b,f.materials),x=f.skeletons,T=g.skin.joints,E=rn(x,T);for(let Y=0,F=O.length;Y<F;Y++){const ce=O[Y];ce.isSkinnedMesh&&(ce.bind(E,g.skin.bindMatrix),ce.normalizeSkinWeights()),e.push(ce)}}for(let o=0,p=d.length;o<p;o++){const f=Ot(d[o]);f!==null&&e.push(f.clone())}for(let o=0,p=c.length;o<p;o++){const f=c[o],g=Fe(f.id),b=We(g,f.materials);for(let O=0,x=b.length;O<x;O++)e.push(b[O])}for(let o=0,p=l.length;o<p;o++)e.push(oe(l[o]).clone());let m;if(n.length===0&&e.length===1)m=e[0];else{m=i==="JOINT"?new jn:new dt;for(let o=0;o<e.length;o++)m.add(e[o])}return m.name=i==="JOINT"?t.sid:t.name,m.matrix.copy(s),m.matrix.decompose(m.position,m.quaternion,m.scale),m}const cn=new it({name:st.DEFAULT_MATERIAL_NAME,color:16711935});function ln(t,e){const s=[];for(let n=0,i=t.length;n<i;n++){const a=e[t[n]];a===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[n]),s.push(cn)):s.push(xt(a))}return s}function We(t,e){const s=[];for(const n in t){const i=t[n],a=ln(i.materialKeys,e);if(a.length===0&&(n==="lines"||n==="linestrips"?a.push(new ut):a.push(new ct)),n==="lines"||n==="linestrips")for(let l=0,m=a.length;l<m;l++){const o=a[l];if(o.isMeshPhongMaterial===!0||o.isMeshLambertMaterial===!0){const p=new ut;p.color.copy(o.color),p.opacity=o.opacity,p.transparent=o.transparent,a[l]=p}}const r=i.data.attributes.skinIndex!==void 0,d=a.length===1?a[0]:a;let c;switch(n){case"lines":c=new Hn(i.data,d);break;case"linestrips":c=new Bn(i.data,d);break;case"triangles":case"polylist":r?c=new qn(i.data,d):c=new Pn(i.data,d);break}s.push(c)}return s}function Ye(t){return w.nodes[t]!==void 0}function oe(t){return z(w.nodes[t],on)}function dn(t){const e={name:t.getAttribute("name"),children:[]};an(t);const s=H(t,"node");for(let n=0;n<s.length;n++)e.children.push(Ie(s[n]));w.visualScenes[t.getAttribute("id")]=e}function Xe(t){const e=new dt;e.name=t.name;const s=t.children;for(let n=0;n<s.length;n++){const i=s[n];e.add(oe(i.id))}return e}function un(t){return w.visualScenes[t]!==void 0}function Ze(t){return z(w.visualScenes[t],Xe)}function fn(t){const e=H(t,"instance_visual_scene")[0];return Ze(S(e.getAttribute("url")))}function hn(){const t=w.clips;if(Q(t)===!0){if(Q(w.animations)===!1){const e=[];for(const s in w.animations){const n=ge(s);for(let i=0,a=n.length;i<a;i++)e.push(n[i])}Ne.push(new rt("default",-1,e))}}else for(const e in t)Ne.push(R(e))}function pn(t){let e="";const s=[t];for(;s.length;){const n=s.shift();n.nodeType===Node.TEXT_NODE?e+=n.textContent:(e+=`
`,s.push.apply(s,n.childNodes))}return e.trim()}if(K.length===0)return{scene:new An};const Qe=new DOMParser().parseFromString(K,"application/xml"),B=H(Qe,"COLLADA")[0],Re=Qe.getElementsByTagName("parsererror")[0];if(Re!==void 0){const t=H(Re,"div")[0];let e;return t?e=t.textContent:e=pn(Re),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,e),null}const mn=B.getAttribute("version");console.debug("THREE.ColladaLoader: File version",mn);const $e=Ee(H(B,"asset")[0]),et=new Tn(this.manager);et.setPath(this.resourcePath||ne).setCrossOrigin(this.crossOrigin);let Me;ht&&(Me=new ht(this.manager),Me.setPath(this.resourcePath||ne));const we=new at,Ne=[];let tt={},bn=0;const w={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};U(B,"library_animations","animation",de),U(B,"library_animation_clips","animation_clip",h),U(B,"library_controllers","controller",C),U(B,"library_images","image",u),U(B,"library_effects","effect",J),U(B,"library_materials","material",Et),U(B,"library_cameras","camera",Ct),U(B,"library_lights","light",Mt),U(B,"library_geometries","geometry",jt),U(B,"library_nodes","node",Ie),U(B,"library_visual_scenes","visual_scene",dn),U(B,"library_kinematics_models","kinematics_model",zt),U(B,"library_physics_models","physics_model",Yt),U(B,"scene","instance_kinematics_scene",Qt),V(w.animations,be),V(w.clips,q),V(w.controllers,A),V(w.images,k),V(w.effects,Pe),V(w.materials,Be),V(w.cameras,He),V(w.lights,Ue),V(w.geometries,ze),V(w.visualScenes,Xe),hn(),nn();const Ae=fn(H(B,"scene")[0]);return Ae.animations=Ne,$e.upAxis==="Z_UP"&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),Ae.rotation.set(-Math.PI/2,0,0)),Ae.scale.multiplyScalar($e.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ne},kinematics:tt,library:w,scene:Ae}}}export{Fn as ColladaLoader};
