const __vite__fileDeps=["./USDZLoader@C78fv819.js","./fflate.module@Do-qMP1X.js","./FBXLoader_139@EwyvjmEk.js","./EXRLoader@7UhQUwQ2.js","./Water2@BrDsMR-4.js","./Reflector@Y262dkt1.js","./ParticleEngineExamples@BJYno18w.js","./ParticleEngine@DmMsVNVO.js","./TAARenderPass@C2E6-JSV.js","./SSAARenderPass@CzwPtIot.js","./HBAOPass@DG1WO0kq.js","./SimplexNoise@DJLmKNIm.js","./GTAOPass@BZIQrJwt.js","./MipGenerationShader@34s1mtIh.js","./mipSampleFunctions@CE2NLcig.js","./ShaderReplacement@CxvBdKt5.js","./WrappedShaderMaterial@jJQ4lvlR.js","./ExtendedShaderMaterial@CoOG-Exu.js","./SSRPass@BsVtJJvQ.js","./PackedShader@D9dUVuxe.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();const scriptRel="modulepreload",assetsURL=function(s,e){return new URL(s,e).href},seen={},__vitePreload=function(e,i,r){let o=Promise.resolve();if(i&&i.length>0){const l=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");o=Promise.all(i.map(d=>{if(d=assetsURL(d,r),d in seen)return;seen[d]=!0;const u=d.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(!!r)for(let _=l.length-1;_>=0;_--){const b=l[_];if(b.href===d&&(!u||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${f}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":scriptRel,u||(h.as="script",h.crossOrigin=""),h.href=d,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((_,b)=>{h.addEventListener("load",_),h.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)))})}))}return o.then(()=>e()).catch(l=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l})};var define_process_env_default$2={};try{global._preload_}catch{var global=window}if(global._preload_===void 0){function is_data_url(s){if(typeof s=="string"){const e=s.slice(0,16);if(e.indexOf("data:")==0||e.indexOf("blob:")==0)return!0}return!1}function to_array_buffer(s){const e=s?.constructor?.name;return s instanceof ArrayBuffer||e==="ArrayBuffer"?s:s instanceof Uint8Array||e==="Uint8Array"?s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset):typeof s=="string"?new TextEncoder().encode(s).buffer:e=="Buffer"||s instanceof Float32Array||e==="Float32Array"||s instanceof Uint8ClampedArray||e==="Uint8ClampedArray"||s instanceof Uint32Array||e==="Uint32Array"||s instanceof Int32Array||e==="Int32Array"||s instanceof DataView||e==="DataView"||s instanceof Int8Array||e==="Int8Array"||s instanceof Int16Array||e==="Int16Array"||s instanceof Uint16Array||e==="Uint16Array"||s instanceof Float64Array||e==="Float64Array"||s instanceof BigInt64Array||e==="BigInt64Array"||s instanceof BigUint64Array||e==="BigUint64Array"?s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset):void 0}function absolute_path_in_nodejs(s){return G.nodejs.path.join(__dirname,"..",s)}const G=global,default_all_debug_flag=localStorage.DEFAULT_ALL_DEBUG;if(default_all_debug_flag!=null&&(G.DEFAULT_ALL_DEBUG=localStorage.DEFAULT_ALL_DEBUG=="true"),G.CALLER_LINE=function(s=3){const e=function(){try{throw new Error}catch(a){return a}}(),i=e.stack.split(`
`)[s],r=i.indexOf("at ");return`${i.slice(r+2,i.length).split("/").pop()}:${i}`},G.crypto&&G.crypto.randomUUID==null){const s=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];G.crypto.randomUUID=()=>{const e=0|4294967295*Math.random(),i=0|4294967295*Math.random(),r=0|4294967295*Math.random(),o=0|4294967295*Math.random();return(s[255&e]+s[255&e>>8]+s[255&e>>16]+s[255&e>>24]+"-"+s[255&i]+s[255&i>>8]+"-"+s[64|15&i>>16]+s[255&i>>24]+"-"+s[128|63&r]+s[255&r>>8]+"-"+s[255&r>>16]+s[255&r>>24]+s[255&o]+s[255&o>>8]+s[255&o>>16]+s[255&o>>24]).toLowerCase().replace(/-/g,"")}}{const s=navigator.userAgent.toLowerCase();G.is_windows=s.includes("win"),G.is_mac=s.includes("mac"),G.is_x11=s.includes("x11"),G.is_linux=s.includes("linux"),G.is_electron=s.includes("electron"),G.is_brave=navigator.brave||!1;const e=Object.keys({Firefox:"Mozilla Firefox",SamsungBrowser:"Samsung Internet",Opera:"Opera",OPR:"Opera",Trident:"Internet Explorer",Edg:"Microsoft Edge",Chrome:"Chrome",Safari:"Safari"}).find(i=>s.includes(i.toLowerCase()))||"Unknown";G.browser_type=G.is_brave?"Brave":e,G.node_integrated=window.process!==void 0}if(G.TimeDurationChecker=s=>({title:s,tm:performance.now(),finish(){G.debug&&G.debug_performance&&performance.now()-this.tm}}),G.DEFAULT_ALL_DEBUG&&/Android/i.test(navigator.userAgent)){let s=function(r,o=""){const l=document.getElementById("ddd-log-overlay")||document.createElement("div"),a=document.getElementById("ddd-log-output")||document.createElement("div"),c=document.getElementById("ddd-log-button")||document.createElement("button");l.children.length===0&&(l.id="ddd-log-overlay",a.id="ddd-log-output",c.id="ddd-log-button",l.style.cssText="position: fixed;padding: 0px;margin: 0px;top: 70%;left: 0;width: 100%;height: 30%;background-color: rgba(0, 0, 0, 0.8);color: white;z-index: 1000;font-size: 10px;overflow-y: scroll;",a.style.cssText="padding: 0px;margin: 0px;",c.style.cssText="position: fixed;padding: 0px;margin: 0px;top: calc(100% - 22px);left: calc(100% - 102px);width: 100px;height: 20px;background-color: rgba(0, 0, 0, 0.8);color: white;z-index: 1001;font-size: 10px;",l.style.display="none",c.innerText="Show Log",c.onclick=()=>{c.dataset.show=c.dataset.show==="true"?"false":"true",l.style.display=c.dataset.show==="true"?"block":"none"},l.appendChild(a),document.body?.appendChild?.(l),document.body?.appendChild?.(c));const d=document.createElement("div");d.textContent=r,d.style.cssText=o,d.style.whiteSpace="pre-wrap",d.style.fontFamily="monospace",a.appendChild(d),d.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})},e=function(r,o){const l=r[o];r[o]=function(){const a=Array.from(arguments).join(" "),c=new Error,d=c.stack.split(`
`)[2],u=d.match(i);if(u?.[0]){let f=u[0].slice(1,-1).slice(-20).padStart(20," ");arguments.length===2&&typeof arguments[0]=="string"&&arguments[0].indexOf("%c")===0?s(`${f} | `+arguments[0].slice(2),arguments[1]):s(`${f} | `+a),l.apply(console,arguments)}}};const i=/\/([^\/]+):(\d+):/;e(console,"log"),e(console,"error"),e(console,"info"),e(console,"warn"),window.onerror=function(r,o,l,a,c){console.error(c)}}(G.is_electron||G.is_brave)&&(G.is_brave||G.is_electron&&G.node_integrated&&define_process_env_default$2.ELECTRON_ENV=="development")&&(G.DEFAULT_ALL_DEBUG=!0);const DEBUG_ALL=G.debug_all===void 0?G.DEFAULT_ALL_DEBUG:G.debug_all;G._preload_=!0,G.debug=G.debug!==void 0&&G.debug||DEBUG_ALL,G.debug_performance=DEBUG_ALL,G.debug_texture=DEBUG_ALL,G.debug_file_browser=DEBUG_ALL,G.debug_asset_browser=DEBUG_ALL,G.debug_texture_cache=DEBUG_ALL,G.texture_counter=DEBUG_ALL?0:null,G.debug_cache=DEBUG_ALL,G.debug_action=DEBUG_ALL,G.debug_shader=DEBUG_ALL,G.node_api=!0,G.nodejs=null,G.enable_dds_texture=!1,G.__init_promises__=[];const ecma_script_check_list=[()=>{try{eval('undefined ?? "string"')}catch{return null}return"ECMA2020"},()=>{try{"".replaceAll("","")}catch{return null}return"ECMA2021"},()=>{try{[0].at(-1)}catch{return null}return"ECMA2022"},()=>[].findLast===void 0?null:"ECMA2023"];for(let s of ecma_script_check_list)G.js_version=s()||G.js_version;G.js_version==null&&alert("Your browser is not supported. Please install the latest version."),G.is_data_url=is_data_url;class IFrameIPC{channel="";origin="";callback=()=>{};messages=[];ready=!1;constructor(e,i=null,r="app_iframe",o=window.location.origin){this.channel=r,this.origin=o,this.callback=e,this.iframe=i,this._proc_(i?"Parent":"Child")}static CreateParent(e,i,r="app_iframe",o=window.location.origin){return new IFrameIPC(e,i,r,o)}static CreateChild(e,i="app_iframe",r=window.location.origin){return new IFrameIPC(e,null,i,r)}_proc_(e){const i=this;window.addEventListener("message",async r=>{const o=r.data;if(r.origin===window.location.origin){if(o.length==0)return;const l=o;if(l.channel!==i.channel)return;const c=l.op;if(c=="init"){i.ready=!0;const d=i.messages;i.messages=[];for(const u of d)i.post(u);if(l.reply)return;l.reply=!0,i._inner_post_(l)}else c=="data"?i.callback(l.content):console.error(e,"Received message from the same origin:",r)}else console.error(e,"Received message from a different origin:",r.origin)}),this._inner_post_({op:"init"})}_inner_post_(e){const i=this;i.iframe?i.iframe.contentWindow.postMessage(Object.assign({ddd:!0,channel:i.channel},e),i.origin):window.parent.postMessage(Object.assign({ddd:!0,channel:i.channel},e),i.origin)}post(e){const i=this;return i.ready==!1?void i.messages.push(e):void(i.iframe?i.iframe.contentWindow.postMessage({ddd:!0,channel:i.channel,op:"data",content:e},i.origin):window.parent.postMessage({ddd:!0,channel:i.channel,op:"data",content:e},i.origin))}}G.IFrameIPC=IFrameIPC;class SiteStorage{static __databases__={};static initialize(e,i,r,o={}){const l={migration:"error"};o&&Object.assign(l,o);const a=[];for(const d of i)typeof d=="string"?a.push(d):a.push(d.name);const c=new Promise((d,u)=>{const f=m=>{const h=indexedDB.open(e,r);h.onupgradeneeded=_=>{if(_.target instanceof IDBRequest){const b=_.target.result;for(const v of a)b.objectStoreNames.contains(v)||(b.createObjectStore(v,{keyPath:"key"}),window.debug)}},h.onsuccess=_=>{if(_.target instanceof IDBRequest){const b=_.target.result,v=SiteStorage.__databases__[e];for(const w in v)v[w].db=b;d(b)}else u("Invalid request:"+_.toString())},h.onerror=_=>{_.target instanceof IDBRequest?0<m?SiteStorage.deleteDatabase(e).then(()=>{f(m-1)}).catch(b=>{u(b)}):(console.error("DB Error",_.target.error),u(_.target.error)):u("Invalid request:"+_.toString())}};l.migration=="error"?f(0):l.migration=="recreate"?f(1):u("Invalid option.")});for(const d of i){const u=d.name??d,f=new SiteStorage(e,u,d.type??"string");f.db_opener=c,SiteStorage.__databases__[e]==null&&(SiteStorage.__databases__[e]={}),SiteStorage.__databases__[e][u]=f}return SiteStorage.__databases__[e]}dbName="";db=null;schema="";type="string";db_opener=null;constructor(e,i,r="string"){this.dbName=e,this.schema=i,this.type=r,this.db=null}open(){return this.db_opener}_transaction(e){const i=this.schema,r=this.db;return new Promise((o,l)=>{const a=r.transaction([i],"readwrite"),c=a.objectStore(i),d=e(c);d.onsuccess=u=>{o(u.target.result)},d.onerror=u=>{l(u.target.error)}})}async set(e,i){if(e===null)throw new TypeError("key is null");if(i===null)throw new TypeError("value is null");if(this.type==="string"&&typeof i!="string"&&i!==void 0)throw new TypeError("value is not string");if(this.db==null&&await this.open(),i===void 0)return void await this.delete(e);const r=this.schema,o=this.db;return new Promise((l,a)=>{const c=o.transaction([r],"readwrite"),d=c.objectStore(r),u=d.get(e);u.onsuccess=f=>{const m=c.objectStore(r),h=f.target.result;let _=null;h?(h.value=i,_=m.put(h)):_=m.add({key:e,value:i}),_.onsuccess=b=>{l(b.target.result)},_.onerror=b=>{a(b.target.error)}},u.onerror=f=>{a(f.target.error)}})}async get(e,i=void 0){const r=this;this.db==null&&await this.open();const o=this.schema,l=this.db;return new Promise((a,c)=>{const d=l.transaction([o],"readwrite"),u=d.objectStore(o),f=u.get(e);f.onsuccess=async m=>{const h=m.target.result;i===void 0?a(h?h.value:null):h?a(h.value):(await r.set(e,i),a(i))},f.onerror=m=>{c(m.target.error)}})}async delete(e){return this.db==null&&await this.open(),this._transaction(i=>i.delete(e))}async clear(e={}){const i={excludes:[],includes:[]};e&&Object.assign(i,e);const r=0<i.excludes.length?{}:null,o=0<i.includes.length?{}:null;for(const l of i.excludes)r[l]=!0;for(const l of i.includes)o[l]=!0;if(this.db==null&&await this.open(),r){const l=await this.all();for(const a of l)r[a.key]||await this.delete(a.key)}else if(o){const l=await this.all();for(const a of l)o[a.key]&&await this.delete(a.key)}else await this._transaction(l=>l.clear())}async all(){return this.db==null&&await this.open(),this._transaction(e=>e.getAll())}static async databases(){return await indexedDB.databases()}static async deleteDatabase(e){const i=indexedDB.deleteDatabase(e);i.onsuccess=function(){},i.onerror=function(){},i.onblocked=function(){}}static async deleteAllDatabases(){const e=await SiteStorage.databases();for(const i of e)await SiteStorage.deleteDatabase(i.name)}}{const s="__ddd__@"+new URL(location.href).pathname;location.href.indexOf("chrome-")!==0&&(G.__shared_storage__=SiteStorage.initialize("shared",["shared"],20240129,{migration:"recreate"}),G.__storage__=SiteStorage.initialize(s,["system","project","editor","editor_permanent","app"],20240129,{migration:"recreate"}),G.GetProjectPath=async e=>await __storage__.project.get("current_project_path",e),G.SetProjectPath=async e=>(await __storage__.project.set("current_project_path",e),e),G.GetSystemPreferences=async e=>JSON.parse(await __storage__.system.get("system_preferences_flags",JSON.stringify(e))),G.SetSystemPreferences=async e=>(await __storage__.system.set("system_preferences_flags",JSON.stringify(e)),e)),window.SiteStorage=SiteStorage}class CacheManager{constructor(e={}){this.cache_name=e?.name??"CacheManager",this.expire=e?.expire??5e3,this.ref_table={},this.mutex_table={},this.weak_ref=e?.weak_ref??!0,this.debug=e?.debug??G.debug,this.debug_tm=performance.now()}debug_count(){1e3<performance.now()-this.debug_tm&&(this.debug_tm=performance.now())}setExpiration(e){this.expire=e}unlock(e){return e==null?void console.error("Invalid key",e):void(this.mutex_table[e]===void 0?console.warn("The mutex already released.",e):delete this.mutex_table[e])}_sleep_(e){return new Promise(i=>{setTimeout(i,e)})}async lock_and_wait(e,i=50){if(e==null)return void console.error("Invalid key",e);if(this.mutex_table[e]===void 0)this.mutex_table[e]=!0;else{for(;this.mutex_table[e];)await this._sleep_(i),this.debug&&this.debug_count(e);this.mutex_table[e]=!0}}async get_with_transaction(e,i=50){if(G.debug&&G.debug_cache,e==null)return void console.error("Invalid key",e);if(this.mutex_table[e]===void 0)this.mutex_table[e]=!0;else{for(;this.mutex_table[e];)await this._sleep_(i),this.debug&&this.debug_count(e);this.mutex_table[e]=!0}let r=this.get(e);return r?(this.unlock(e),r):null}get(e){if(e==null)return void console.error("Invalid key",e);let i=this.ref_table,r=i[e];if(r&&r.expire>=Date.now())if(this.debug&&G.debug_cache,this.weak_ref){let o=r.instance.deref();if(o)return o}else return r.instance;return r&&(delete i[e],this.debug&&G.debug_cache),null}put(e,i,r=null){if(e==null)return void console.error("Invalid key",e);let o=this.ref_table,l=this.weak_ref?new WeakRef(i):i;o[e]={instance:l,expire:Date.now()+this.expire}}remove(e){if(e==null)return void console.error("Invalid key",e);let i=this.ref_table;i[e]&&(delete i[e],this.debug&&G.debug_cache)}gcx(){let e=this.ref_table;for(let i in e){let r=e[i];r&&r.expire<Date.now()&&(delete e[i],this.debug&&G.debug_cache)}}}if(G.CacheManager=CacheManager,G.TextureCache=new CacheManager,G.debug,G.is_electron&&G.node_integrated){let s={};s.fs=require("fs"),s.os=require("os"),s.path=require("path"),s.net=require("net"),s.child_process=require("child_process"),s.fsExtra=require("fs-extra"),s.systeminformation=require("systeminformation"),s.cpuStats=require("cpu-stats"),s.chokidar=require("chokidar"),delete require.cache[require.resolve("glob")],s.glob=require("glob");const{ipcRenderer:e}=require("electron");s.root_path=s.path.resolve(__dirname).replace(/\\/g,"/"),s.ipcRenderer=e,window.getApplicationArgs=()=>e.invoke("args"),s.startDrag=(i,r)=>e.send("ondragstart",i,r),s.glob_promise=i=>G.nodejs.ipcRenderer.invoke("glob",{absolute_path:i}),s.config=e.sendSync("config"),s.texture_cache_table={},s.file_cache_table={},s.open_debug_tool=function(i={}){let r={all:!0,force_enable:!1};i&&Object.assign(r,i),r.all&&s.ipcRenderer.invoke("OpenDebugTool",r)},document.addEventListener("keydown",i=>{i.shiftKey&&(i.ctrlKey||i.metaKey)&&i.code=="KeyI"&&G.nodejs?.open_debug_tool?.()}),s.open_in_finder=function(i){let r=G.nodejs.path.resolve(i);G.nodejs.fs.lstatSync(r).isDirectory()||(r=G.nodejs.path.dirname(r)),G.is_windows?s.child_process.spawn("explorer.exe",[r]):G.is_mac?s.child_process.execSync(`open "${r}"`):G.is_linux&&s.child_process.execSync(`nautilus "${r}"`)},s.to_array_buffer=to_array_buffer,s.to_nodejs_buffer=function(i){return i instanceof Buffer?i:i instanceof ArrayBuffer?Buffer.from(new Uint8Array(i)):i instanceof Uint8Array?Buffer.from(i):ArrayBuffer.isView(i)?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i)},s.open_in_native=async function(i){if(G.is_windows)if(C.file_type(i)=="image"){let r=await function(o){return new Promise(function(l,a){G.nodejs.glob(o,{},function(c,d){c?a(c):l(d)})})}("C:/Program Files/GIMP 2/bin/gimp-2*.exe");if(r.length){let o=G.nodejs.path.resolve(i).replace(/\\/g,"/");const l=s.child_process.spawn(r[0],[o],{detached:!0});l.on("data",()=>{}),l.on("error",()=>{}),l.on("close",()=>{})}else s.child_process.exec(`"${G.nodejs.path.resolve(i)}"`,o=>{if(o)return void console.error(`[ERROR] ${o}`)})}else s.child_process.exec(`"${G.nodejs.path.resolve(i)}"`,r=>{if(r)return void console.error(`[ERROR] ${r}`)});else G.is_mac?s.child_process.exec(`open "${G.nodejs.path.resolve(i)}"`,r=>{if(r)return void console.error(`[ERROR] ${r}`)}):G.is_linux&&s.child_process.exec(`"${G.nodejs.path.resolve(i)}"`,r=>{if(r)return void console.error(`[ERROR] ${r}`)})},s.ipcRenderer.on("argv",async(i,r)=>{window.received_argv_from_other_process&&r.argv&&window.received_argv_from_other_process(r.argv)}),s.native_screen_capture=function(i){function r(o){const l=document.createElement("video");l.style.cssText="width:6400px;height:480px;position:fixed;top:0;left:0;",l.srcObject=o,l.onloadedmetadata=()=>l.play(),document.body.appendChild(l)}i&&Object.assign({},i),s.ipcRenderer.on("SET_SOURCE",async(o,l)=>{try{const a=await navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:l}}});r(a)}catch{}}),G.nodejs.ipcRenderer.invoke("native_screen_capture")},G.nodejs=s,G.debug}const escape_html=s=>s?(s+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):"";G.terminal_log_params={color:"#eee"},G.terminal_log_counter=0,G.terminal_clear=()=>{G.terminal_log_counter=0;const s=document.getElementById("terminal_badge"),e=document.getElementById("terminal");s&&e&&(e.innerHTML="",s.innerText="")};let __previous_log__="",__previous_log_count__=0,__previous_log_div__=null;G.terminal_log=function(s){s===null?s="null":s===void 0&&(s="undefined");const e=document.getElementById("terminal_badge"),i=document.getElementById("terminal");if(!e||!i)return;G.terminal_log_counter++,document.getElementById("terminal_badge").innerText=G.terminal_log_counter+"";const r=function(){try{throw Error("")}catch(u){return u}}();let o="";for(let u,f=0;f<arguments.length;f++){if(u=arguments[f],u===null){o+="null ";continue}else if(u===void 0){o+="undefined ";continue}if(typeof u!="object")o+=u?.toString?u?.toString()+" ":typeof u+" ";else if(u?.constructor?.name)o+=u?.constructor?.name+" ";else if(u?.toString)o+=u?.constructor?.toString()+" ";else{const m=Object.keys(u).slice(0,3);o+=typeof u+" ";for(const h of m)o+=h+", "}}o=o.slice(0,o.length-1);const l=r.stack.split(`
`)[3],a=l.indexOf("at ");l.slice(a+2,l.length).split("/").pop();const d=document.createElement("div");for(const u in G.terminal_log_params){const f=G.terminal_log_params[u];d.style[u]=f}return o==__previous_log__?(__previous_log_count__++,o=`${__previous_log__}`,__previous_log_div__.innerHTML=`${escape_html(o).replace(/\n/,"<br>")}<span style='color:#777'>(${__previous_log_count__})</span>`):(__previous_log__=o,__previous_log_count__=1,__previous_log_div__=d,d.innerHTML=`${escape_html(o).replace(/\n/,"<br>")}`,i.appendChild(d)),i.scrollTop=i.scrollHeight,!1},G.terminal_error=function(s){function e(){try{throw Error("")}catch(o){return o}}s===null?s="null":s===void 0&&(s="undefined");const i=document.getElementById("terminal_badge"),r=document.getElementById("terminal");if(i&&r){G.terminal_log_counter++,document.getElementById("terminal_badge").innerText=G.terminal_log_counter+"";try{const o=e();let l="";for(let m=0;m<arguments.length;m++)l+=arguments[m]+" ";l=l.slice(0,l.length-1);const a=o.stack.split(`
`)[3],c=a.indexOf("at "),d=a.slice(c+2,a.length),u=d.split("/").pop(),f=document.createElement("div");for(const m in G.terminal_log_params){const h=G.terminal_log_params[m];f.style[m]=h}f.innerHTML=`<span style='color:#777'>${u}: </span><span style='color:red'>${escape_html(l).replace(/\n/,"<br>")}</span>`,document.getElementById("terminal").appendChild(f)}catch{const l=document.createElement("div");for(const a in G.terminal_log_params){const c=G.terminal_log_params[a];l.style[a]=c}l.innerHTML=`${escape_html(s).replace(/\n/,"<br>")}`,document.getElementById("terminal").appendChild(l)}return!1}},G.terminal_dir=function(s){s===null?s="null":s===void 0&&(s="undefined"),G.terminal_log_counter++,document.getElementById("terminal_badge").innerText=G.terminal_log_counter+"";const e=function(){try{throw Error("")}catch(d){return d}}();let i="";for(let d=0;d<arguments.length;d++)i+=typeof arguments[d]=="object"?JSON.stringify(arguments[d],null,2)+" ":arguments[d]+" ";i=i.slice(0,i.length-1);const r=e.stack.split(`
`)[3],o=r.indexOf("at "),l=r.slice(o+2,r.length),a=l.split("/").pop(),c=document.createElement("div");for(const d in G.terminal_log_params){const u=G.terminal_log_params[d];c.style[d]=u}return c.innerHTML=`<span style='color:#777'>${a}: </span><code>${escape_html(i)}</code>`,document.getElementById("terminal").appendChild(c),!1},G.focus_window=async function(s){return G.nodejs?await G.nodejs.ipcRenderer.invoke("FocusWindow",{title:s}):null},G.cross_file_system={async exists(s){return G.external_io?await G.external_io.exists(s):G.nodejs?.fs?G.nodejs.path.isAbsolute(s)?G.nodejs.fs.existsSync(s):G.nodejs.fs.existsSync(absolute_path_in_nodejs(s)):null},async tmp_dir(){if(G.external_io){if(G.external_io.driver=="local")return G.nodejs.os.tmpdir()}else if(G.nodejs?.os)return G.nodejs.os.tmpdir();return"tmp/"},async mkdir(s,e={recursive:!0}){return G.external_io?await G.external_io.mkdir(s,e):G.nodejs?.fs?G.nodejs.path.isAbsolute(s)?G.nodejs.fs.mkdirSync(s,e):G.nodejs.fs.mkdirSync(absolute_path_in_nodejs(s),e):null},async read(s,e){if(G.external_io)return to_array_buffer(await G.external_io.get(s,e));if(G.nodejs?.fs){let i;return i=G.nodejs.path.isAbsolute(s)?await G.nodejs.fs.promises.readFile(s):await G.nodejs.fs.promises.readFile(absolute_path_in_nodejs(s)),i.buffer.slice(i.byteOffset,i.byteLength+i.byteOffset)}return null},async write(s,e,i){return G.external_io?await G.external_io.put(s,to_array_buffer(e)):G.nodejs?.fs?G.nodejs.path.isAbsolute(s)?await G.nodejs.fs.promises.writeFile(s,G.nodejs.to_nodejs_buffer(e),i):await G.nodejs.fs.promises.writeFile(absolute_path_in_nodejs(s),G.nodejs.to_nodejs_buffer(e),i):null},async copy(s,e){s=s.replace(/\\/g,"/"),e=e.replace(/\\/g,"/");const i=0<=e.indexOf("/")?e.slice(0,e.lastIndexOf("/")):"";if(G.external_io){const r=await G.external_io.get(s);return 0<i.length&&!await G.external_io.exists(i)&&await G.external_io.mkdir(i,{recursive:!0}),await G.external_io.put(e,to_array_buffer(r))}if(G.nodejs?.fs){if(G.nodejs.path.isAbsolute(s)==!1)throw new Error("Path must be absolute");if(G.nodejs.path.isAbsolute(e)==!1)throw new Error("Path must be absolute");return 0<i.length&&!G.nodejs.fs.existsSync(i)&&G.nodejs.fs.mkdirSync(i,{recursive:!0}),G.nodejs.fs.copyFileSync(s,e)}return null},async remove(s,e={}){let i={existence_check:!1};if(e&&Object.assign(i,e),G.external_io)return i.existence_check&&!await G.external_io.exists(s)?null:await G.external_io.remove(s);if(G.nodejs?.fs){if(i.existence_check&&!await G.nodejs.fs.existsSync(s))return null;if(G.nodejs.path.isAbsolute(s)==!1)throw new Error("Path must be absolute");return G.nodejs.fs.unlinkSync(s)}return null},async list(s,e){if(G.external_io)return await G.external_io.list(s,e);if(G.nodejs?.fs)throw"Not implemented yet@B329PARSD2";return null},async resolve(s){return G.external_io?G.external_io.driver=="local"?(s=s[0]==="~"?G.nodejs.path.join(define_process_env_default$2.HOME||define_process_env_default$2.USERPROFILE,s.slice(1)):s,G.nodejs.path.resolve(s)):s:G.nodejs?.path?(s=s[0]==="~"?G.nodejs.path.join(define_process_env_default$2.HOME||define_process_env_default$2.USERPROFILE,s.slice(1)):s,G.nodejs?.path.resolve(s)):s},async enable_hidden_attr(s){return null},async open_in_app(s,e){G.external_io?.open_in_app?await G.external_io.open_in_app(s,e):window.nodejs.open_in_native&&window.nodejs.open_in_native(s)},async open_folder(s,e){G.external_io?.open_folder?await G.external_io.open_folder(s,e):window.nodejs.open_in_finder&&window.nodejs.open_in_finder(s)},async open_dialog(s){let e={properties:["openFile"],title:"Select file",defaultPath:define_process_env_default$2.HOME||define_process_env_default$2.USERPROFILE,filters:[]};if(s&&Object.assign(e,s),G.nodejs){e.defaultPath&&(e.defaultPath=G.is_windows?e.defaultPath.replace(/\//g,"\\"):e.defaultPath.replace(/`\\/g,"/"),e.defaultPath=G.nodejs.path.resolve(e.defaultPath));let i=await G.nodejs.ipcRenderer.invoke("OpenFile",e);if(!i.canceled){let r=[];if(i.filePath)r.push(i.filePath);else if(Array.isArray(i.filePaths))r=i.filePaths;else throw new Error("Invalid value.");return r}return null}C.modal_ok_cancel("Error","File dialog is available only application version.")},async save_dialog(s){if(!G.is_electron||!G.node_integrated)return void C.modal_ok_cancel("Error","Dialog box component is only available in app version.",{cancel:!1});let e={properties:["openFile"],title:"Select a destination file",defaultPath:define_process_env_default$2.HOME||define_process_env_default$2.USERPROFILE,filters:[]};if(s&&Object.assign(e,s),G.nodejs){e.defaultPath&&(e.defaultPath=G.is_windows?e.defaultPath.replace(/\//g,"\\"):e.defaultPath.replace(/`\\/g,"/"),e.defaultPath=G.nodejs.path.resolve(e.defaultPath));let i=await G.nodejs.ipcRenderer.invoke("SaveFile",e);if(!i.canceled){let r=[];if(i.filePath)r.push(i.filePath);else if(Array.isArray(i.filePaths))r=i.filePaths;else throw"Something wrong";return r}}else C.modal_ok_cancel("Error","File dialog is available only application version.")},async watch(s,e){return G.external_io?.watch?await G.external_io.watch(s,e):null}},G.wasmFeatureDetect={bigInt:()=>(async s=>{try{return(await WebAssembly.instantiate(s)).instance.exports.b(BigInt(0))===BigInt(0)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,126,1,126,3,2,1,0,7,5,1,1,98,0,0,10,6,1,4,0,32,0,11])),bulkMemory:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),exceptions:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),extendedConst:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,5,3,1,0,1,11,9,1,0,65,1,65,2,106,11,0])),gc:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,10,2,95,1,125,0,96,0,1,107,0,3,2,1,1,10,12,1,10,0,67,0,0,0,0,251,7,0,11])),memory64:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,5,3,1,4,1])),multiValue:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,0,2,127,127,3,2,1,0,10,8,1,6,0,65,0,65,0,11])),mutableGlobals:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,2,8,1,1,97,1,98,3,127,1,6,6,1,127,1,65,0,11,7,5,1,1,97,3,1])),referenceTypes:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,7,1,5,0,208,112,26,11])),relaxedSimd:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,15,1,13,0,65,1,253,15,65,2,253,15,253,128,2,11])),saturatedFloatToInt:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,12,1,10,0,67,0,0,0,0,252,0,26,11])),signExtensions:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,65,0,192,26,11])),simd:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),streamingCompilation:()=>(async()=>"compileStreaming"in WebAssembly)(),tailCall:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,6,1,4,0,18,0,11])),threads:()=>(async s=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(s)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))},G.__FontFaceSet__=G.__FontFaceSet__||new Set,G.debug}const Resizable$1={};Resizable$1.activeContentWindows=[],Resizable$1.activeResizers=[],Resizable$1.currentResizer=null,Resizable$1.Sides={TOP:"TOP",BOTTOM:"BOTTOM",LEFT:"LEFT",RIGHT:"RIGHT"},Resizable$1.Classes={WINDOW_TOP:"resizable-top",WINDOW_BOTTOM:"resizable-bottom",WINDOW_LEFT:"resizable-left",WINDOW_RIGHT:"resizable-right"},Resizable$1.initialise=function(s,e,i){Resizable$1.resizerThickness=i||4,Resizable$1.initialSizes=e;var r=document.getElementById(s),o=new Resizable$1.ContentWindow(null,parseInt(r.style.width,10),parseInt(r.style.height,10),r);Resizable$1.activeContentWindows.push(o),Resizable$1.setupChildren(o)},Resizable$1.setupChildren=function(s){var e=s.findChildWindowElements();if(e.child1!=null){var i;i=Resizable$1.initialSizes[e.child1.id],i==null&&(i=.5),e.isHorizontal?s.splitHorizontally(i,e.child1,e.child2):s.splitVertically(i,e.child1,e.child2);var r=Resizable$1.activeContentWindows[Resizable$1.activeContentWindows.length-2],o=Resizable$1.activeContentWindows[Resizable$1.activeContentWindows.length-1];Resizable$1.setupChildren(r),Resizable$1.setupChildren(o)}},Resizable$1.ContentWindow=class{constructor(s,e,i,r){if(this.parent=s,this.width=e,this.height=i,this.sizeFractionOfParent=.5,r==null){this.divId="contentWindow"+Resizable$1.activeContentWindows.length;var r=document.createElement("div");r.id=this.divId,r.classList.add("contentWindow"),s==null?document.body.insertAdjacentHTML("afterbegin",htmlToAdd):s.getDiv().appendChild(r)}else r.id==""&&(r.id="contentWindow"+Resizable$1.activeContentWindows.length),this.divId=r.id,this.getDiv().classList.add("contentWindow");this.children=[],this.isSplitHorizontally=!1,this.isSplitVertically=!1,this.childResizer=null,this.minWidth=0,this.minHeight=0,this.originalMinSize=0,this.childResizerThickness=Resizable$1.resizerThickness,this.getDiv().style.position="absolute",this.getDiv().style.overflow="hidden",this.getDiv().style.width=Math.round(this.width)+"px",this.getDiv().style.height=Math.round(this.height)+"px",Resizable$1.activeContentWindows.push(this),this.calculateSizeFractionOfParent()}getDiv(){return document.getElementById(this.divId)}getDivId(){return this.divId}findChildWindowElements(){var s,e,i=!1;if(0<document.querySelectorAll(`#${this.divId} > .${Resizable$1.Classes.WINDOW_LEFT}`).length&&(s=document.querySelectorAll(`#${this.divId} > .${Resizable$1.Classes.WINDOW_LEFT}`)[0],0<document.querySelectorAll(`#${this.divId} > .${Resizable$1.Classes.WINDOW_LEFT}`).length?e=document.querySelectorAll(`#${this.divId} > .${Resizable$1.Classes.WINDOW_RIGHT}`)[0]:console.error(`${this.divId} has left child but not right`),i=!0),0<document.querySelectorAll(`#${this.divId} > .${Resizable$1.Classes.WINDOW_TOP}`).length){if(s!=null)return void console.error(`${this.divId} has both left and top children`);s=document.querySelectorAll(`#${this.divId} > .${Resizable$1.Classes.WINDOW_TOP}`)[0],0<document.querySelectorAll(`#${this.divId} > .${Resizable$1.Classes.WINDOW_BOTTOM}`).length?e=document.querySelectorAll(`#${this.divId} > .${Resizable$1.Classes.WINDOW_BOTTOM}`)[0]:console.error(`${this.divId} has top child but not bottom`),i=!1}return{child1:s,child2:e,isHorizontal:i}}resize(s,e){this.parent!=null&&(s===Resizable$1.Sides.TOP?(this.changeSize(this.parent.width,parseInt(this.parent.getDiv().style.height)-e),this.getDiv().style.top=Math.round(e)+"px"):s===Resizable$1.Sides.BOTTOM?this.changeSize(this.parent.width,e-this.getDiv().getBoundingClientRect().top):s===Resizable$1.Sides.LEFT?(this.changeSize(parseInt(this.parent.getDiv().style.width)-e,this.parent.height),this.getDiv().style.left=Math.round(e)+"px"):s===Resizable$1.Sides.RIGHT?this.changeSize(e-this.getDiv().getBoundingClientRect().left,this.parent.height):console.error("Window.resize: incorrect side"),0<this.children.length&&this.childrenResize(),this.parent!=null&&(this.calculateSizeFractionOfParent(),this.getSibling().calculateSizeFractionOfParent(),siblingWindowErrorCorrect(this)),this.repositionChildResizer(),Resizable$1.windowResized())}calculateSizeFractionOfParent(){this.parent==null?this.sizeFractionOfParent=1:this.parent.isSplitHorizontally?this.sizeFractionOfParent=this.width/this.parent.width:this.parent.isSplitVertically&&(this.sizeFractionOfParent=this.height/this.parent.height)}getSibling(){return this.parent==null?null:this.parent.children[0]==this?this.parent.children[1]:this.parent.children[0]}childrenResize(){if(this.children.length!=0){if(this.isSplitHorizontally){var s=this.height;this.children[0].changeSize(this.width*this.children[0].sizeFractionOfParent,s),this.children[1].changeSize(this.width*this.children[1].sizeFractionOfParent,s),this.children[1].getDiv().style.left=parseInt(this.children[0].getDiv().style.width)+this.childResizer.lineThickness+"px"}else this.isSplitVertically&&(this.children[0].changeSize(this.width,this.height*this.children[0].sizeFractionOfParent),this.children[1].changeSize(this.width,this.height*this.children[1].sizeFractionOfParent),this.children[1].getDiv().style.top=parseInt(this.children[0].getDiv().style.height)+this.childResizer.lineThickness+"px");this.children[0].childrenResize(),this.children[1].childrenResize(),this.repositionChildResizer()}}toString(){return`divId = ${this.divId}, parent = ${this.parent.getDivId()}, width = ${this.width}, height = ${this.height}`}changeSize(s,e){s<this.minWidth&&(s=this.minWidth),e<this.minHeight&&(e=this.minHeight),this.parent!=null&&(s>this.parent.width-this.getSibling().minWidth&&this.parent.isSplitHorizontally&&(s=this.parent.width-this.getSibling().minWidth,this.parent.repositionChildResizer()),e>this.parent.height-this.getSibling().minHeight&&this.parent.isSplitVertically&&(e=this.parent.height-this.getSibling().minHeight,this.parent.repositionChildResizer())),this.parent==null?(s>window.innerWidth&&(s=window.innerWidth),e>window.height&&(e=window.innerHeight)):(s>this.parent.width&&(s=this.parent.width),e>this.parent.height&&(e=this.parent.height)),s=Math.round(s),e=Math.round(e),this.getDiv().style.width=s+"px",this.getDiv().style.height=e+"px",this.width=s,this.height=e}repositionChildResizer(){this.childResizer!=null&&this.childResizer.reposition()}calculateMinWidthHeight(){0<this.children.length?(this.children[0].calculateMinWidthHeight(),this.children[1].calculateMinWidthHeight(),this.isSplitHorizontally?(this.minWidth=this.children[0].minWidth+this.children[1].minWidth,this.minHeight=this.children[0].minHeight>this.children[1].minHeight?this.children[0].minHeight:this.children[1].minHeight):this.isSplitVertically&&(this.minHeight=this.children[0].minHeight+this.children[1].minHeight,this.minWidth=this.children[0].minWidth>this.children[1].minWidth?this.children[0].minWidth:this.children[1].minWidth)):(this.minWidth=this.originalMinSize,this.minHeight=this.originalMinSize),this.minWidth=Math.round(this.minWidth),this.minHeight=Math.round(this.minHeight)}getTopLevelParent(){for(var s=this;s.parent!=null;)s=s.parent;return s}splitHorizontally(s,e,i){this.isSplitHorizontally=!0;var r=this.width*s-this.childResizerThickness/2;r!=null&&e!=null&&this.getDiv().appendChild(e),i!=null&&this.getDiv().appendChild(i);var o=new Resizable$1.ContentWindow(this,r,this.height,e),l=new Resizable$1.ContentWindow(this,this.width-r-this.childResizerThickness/2,this.height,i);l.getDiv().style.left=Math.round(r+this.childResizerThickness/2)+"px",this.childResizer=new Resizable$1.Resizer(this,o,l,!0),this.childResizer.getDiv().style.left=Math.round(r-this.childResizerThickness/2)+"px",this.children.push(o),this.children.push(l),this.getTopLevelParent().calculateMinWidthHeight()}splitVertically(s,e,i){this.isSplitVertically=!0;var r=this.height*s-this.childResizerThickness/2;e!=null&&this.getDiv().appendChild(e),i!=null&&this.getDiv().appendChild(i);var o=new Resizable$1.ContentWindow(this,this.width,r-this.childResizerThickness/2,e),l=new Resizable$1.ContentWindow(this,this.width,this.height-r-this.childResizerThickness/2,i);l.getDiv().style.top=Math.round(r+this.childResizerThickness/2)+"px",this.childResizer=new Resizable$1.Resizer(this,o,l,!1),this.childResizer.getDiv().style.top=Math.round(r-this.childResizerThickness/2)+"px",this.children.push(o),this.children.push(l),this.getTopLevelParent().calculateMinWidthHeight()}},Resizable$1.parentResize=function(s,e){const i=Resizable$1.activeContentWindows[0];i.changeSize(s,e),i.repositionChildResizer(),0<i.children.length&&i.childrenResize(),i.parent!=null&&(i.calculateSizeFractionOfParent(),i.getSibling().calculateSizeFractionOfParent(),siblingWindowErrorCorrect(i)),i.repositionChildResizer(),Resizable$1.windowResized()};function resizerMouseDown(s){s.preventDefault(),Resizable$1.resizingStarted(),s.stopPropagation(),Resizable$1.currentResizer=getResizerFromDiv(this.id),window.addEventListener("mousemove",Resizable$1.currentResizer.resize),window.addEventListener("mouseup",Resizable$1.currentResizer.cancelResize)}function resizerTouchStart(){Resizable$1.resizingStarted(),Resizable$1.currentResizer=getResizerFromDiv(this.id),window.addEventListener("touchmove",Resizable$1.currentResizer.resize),window.addEventListener("touchend",Resizable$1.currentResizer.cancelResize)}function attachResizerEvents(){var s=document.querySelectorAll(".resizer");s&&s.forEach(function(e){e.addEventListener("mousedown",resizerMouseDown),e.addEventListener("touchstart",resizerTouchStart,{passive:!0})})}function clearResizerEvents(){var s=document.querySelectorAll(".resizer");s&&s.forEach(function(e){e.removeEventListener("mousedown",resizerMouseDown),e.removeEventListener("touchstart",resizerTouchStart)})}function getResizerFromDiv(s){for(var e=0;e<Resizable$1.activeResizers.length;e++)if(Resizable$1.activeResizers[e].getDivId()==s)return Resizable$1.activeResizers[e];return console.error("getResizerFromDiv failed to find resizer"),null}function siblingWindowErrorCorrect(s){s.getSibling().sizeFractionOfParent=1-s.sizeFractionOfParent}Resizable$1.windowResized=function(){},Resizable$1.resizingEnded=function(){},Resizable$1.resizingStarted=function(){},Resizable$1.Resizer=class{constructor(s,e,i,r){this.parent=s,this.isHorizontal=r,this.isHorizontal?(this.leftWindow=e,this.rightWindow=i):(this.topWindow=e,this.bottomWindow=i),this.divId=`resizer${Resizable$1.activeResizers.length}`;var o=document.createElement("div");o.id=this.divId,o.classList.add("resizer"),s.getDiv().appendChild(o),this.isHorizontal?(this.getDiv().classList.add("horizontalResizer"),this.getDiv().style.cursor="ew-resize"):(this.getDiv().classList.add("verticalResizer"),this.getDiv().style.cursor="ns-resize"),this.getDiv().style.position="absolute",this.lineThickness=Resizable$1.resizerThickness,r?(this.getDiv().style.width=Math.round(this.lineThickness)+"px",this.getDiv().style.height=this.parent.height+"px"):(this.getDiv().style.width=this.parent.width+"px",this.getDiv().style.height=this.lineThickness+"px"),this.reposition(),Resizable$1.activeResizers.push(this),clearResizerEvents(),attachResizerEvents()}getDiv(){return document.getElementById(this.divId)}getDivId(){return this.divId}reposition(){this.isHorizontal?(this.getDiv().style.left=this.leftWindow.getDiv().style.width,this.getDiv().style.height=this.parent.getDiv().style.height):(this.getDiv().style.top=this.topWindow.getDiv().style.height,this.getDiv().style.width=this.parent.getDiv().style.width)}resize(s){document.dispatchEvent(new CustomEvent("resizable.resize"));var e=s.pageX,i=s.pageY;if(e==null&&(e=s.changedTouches[0].pageX),i==null?i=s.changedTouches[0].pageY:s.preventDefault(),Resizable$1.currentResizer==null)for(var r=0;r<Resizable$1.activeResizers.length;r++)Resizable$1.activeResizers[r].getDiv()==s.target&&(Resizable$1.currentResizer=Resizable$1.activeResizers[r]);Resizable$1.currentResizer.isHorizontal?(Resizable$1.currentResizer.leftWindow.resize(Resizable$1.Sides.RIGHT,e),Resizable$1.currentResizer.getDiv().style.left=Resizable$1.currentResizer.leftWindow.getDiv().style.width,Resizable$1.currentResizer.rightWindow.resize(Resizable$1.Sides.LEFT,parseInt(Resizable$1.currentResizer.getDiv().style.left))):(Resizable$1.currentResizer.topWindow.resize(Resizable$1.Sides.BOTTOM,i),Resizable$1.currentResizer.getDiv().style.top=Resizable$1.currentResizer.topWindow.getDiv().style.height,Resizable$1.currentResizer.bottomWindow.resize(Resizable$1.Sides.TOP,parseInt(Resizable$1.currentResizer.getDiv().style.top)))}delete(){for(var s=0;s<Resizable$1.activeResizers.length;s++)Resizable$1.activeResizers[s]==this&&Resizable$1.activeResizers.splice(s,1);this.getDiv().parentNode.removeChild(this.getDiv())}cancelResize(){window.removeEventListener("mousemove",Resizable$1.currentResizer.resize),window.removeEventListener("mouseup",Resizable$1.currentResizer.cancelResize),window.removeEventListener("touchmove",Resizable$1.currentResizer.resize),window.removeEventListener("touchend",Resizable$1.currentResizer.cancelResize),Resizable$1.currentResizer=null,Resizable$1.resizingEnded()}},window.Resizable=Resizable$1,function(s,e){window.TomSelect=e()}(void 0,function(){function s(ae,j){ae.split(/\s+/).forEach(ee=>{j(ee)})}function e(ae,j){var ee=Object.assign({},ge,j),ne=ee.dataAttr,le=ee.labelField,he=ee.valueField,Me=ee.disabledField,Ne=ee.optgroupField,je=ee.optgroupLabelField,fe=ee.optgroupValueField,ce=ae.tagName.toLowerCase(),ye=ae.getAttribute("placeholder")||ae.getAttribute("data-placeholder");if(!ye&&!ee.allowEmptyOption){let ot=ae.querySelector('option[value=""]');ot&&(ye=ot.textContent)}var Pe,Ve,Qe,at,ht,xt,Ze={placeholder:ye,options:[],optgroups:[],items:[],maxItems:null};return ce==="select"?(Ve=Ze.options,Qe={},at=1,ht=ot=>{var mt=Object.assign({},ot.dataset),pt=ne&&mt[ne];return typeof pt=="string"&&pt.length&&(mt=Object.assign(mt,JSON.parse(pt))),mt},xt=(ot,mt)=>{var pt=Ee(ot.value);if(pt!=null&&(pt||ee.allowEmptyOption)){if(Qe.hasOwnProperty(pt)){if(mt){var _t=Qe[pt][Ne];_t?Array.isArray(_t)?_t.push(mt):Qe[pt][Ne]=[_t,mt]:Qe[pt][Ne]=mt}}else{var bt=ht(ot);bt[le]=bt[le]||ot.textContent,bt[he]=bt[he]||pt,bt[Me]=bt[Me]||ot.disabled,bt[Ne]=bt[Ne]||mt,bt.$option=ot,Qe[pt]=bt,Ve.push(bt)}ot.selected&&Ze.items.push(pt)}},Ze.maxItems=ae.hasAttribute("multiple")?null:1,te(ae.children,ot=>{var mt,pt,bt;(Pe=ot.tagName.toLowerCase())==="optgroup"?((bt=ht(mt=ot))[je]=bt[je]||mt.getAttribute("label")||"",bt[fe]=bt[fe]||at++,bt[Me]=bt[Me]||mt.disabled,Ze.optgroups.push(bt),pt=bt[fe],te(mt.children,_t=>{xt(_t,pt)})):Pe==="option"&&xt(ot)})):(()=>{const ot=ae.getAttribute(ne);if(ot)Ze.options=JSON.parse(ot),te(Ze.options,pt=>{Ze.items.push(pt[he])});else{var mt=ae.value.trim()||"";if(!ee.allowEmptyOption&&!mt.length)return;const pt=mt.split(ee.delimiter);te(pt,bt=>{const _t={};_t[le]=bt,_t[he]=bt,Ze.options.push(_t)}),Ze.items=pt}})(),Object.assign({},ge,Ze,j)}class i{constructor(){this._events=void 0,this._events={}}on(j,ee){s(j,ne=>{const le=this._events[ne]||[];le.push(ee),this._events[ne]=le})}off(j,ee){var ne=arguments.length;ne===0?this._events={}:s(j,le=>{if(ne===1)return void delete this._events[le];const he=this._events[le];he!==void 0&&(he.splice(he.indexOf(ee),1),this._events[le]=he)})}trigger(j,...ee){var ne=this;s(j,le=>{const he=ne._events[le];he!==void 0&&he.forEach(Me=>{Me.apply(ne,ee)})})}}const r=ae=>2>(ae=ae.filter(Boolean)).length?ae[0]||"":d(ae)==1?"["+ae.join("")+"]":"(?:"+ae.join("|")+")",o=ae=>{if(!a(ae))return ae.join("");let j="",ee=0;const ne=()=>{1<ee&&(j+="{"+ee+"}")};return ae.forEach((le,he)=>{le===ae[he-1]?ee++:(ne(),j+=le,ee=1)}),ne(),j},l=ae=>{let j=f(ae);return r(j)},a=ae=>new Set(ae).size!==ae.length,c=ae=>(ae+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),d=ae=>ae.reduce((j,ee)=>Math.max(j,u(ee)),0),u=ae=>f(ae).length,f=ae=>Array.from(ae),m=ae=>{if(ae.length===1)return[[ae]];let j=[];const ee=ae.substring(1);return m(ee).forEach(function(ne){let le=ne.slice(0);le[0]=ae.charAt(0)+le[0],j.push(le),le=ne.slice(0),le.unshift(ae.charAt(0)),j.push(le)}),j},h=[[0,65535]];let _,b;const v={},w={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let ae in w){let j=w[ae]||"";for(let ee,ne=0;ne<j.length;ne++)ee=j.substring(ne,ne+1),v[ee]=ae}const y=new RegExp(Object.keys(v).join("|")+"|[̀-ͯ·ʾʼ]","gu"),M=(ae,j="NFKD")=>ae.normalize(j),S=ae=>f(ae).reduce((j,ee)=>j+D(ee),""),D=ae=>(ae=M(ae).toLowerCase().replace(y,j=>v[j]||""),M(ae,"NFC")),k=ae=>{const j={},ee=(ne,le)=>{const he=j[ne]||new Set,Me=new RegExp("^"+l(he)+"$","iu");le.match(Me)||(he.add(c(le)),j[ne]=he)};for(let ne of function*(le){for(const[he,Me]of le)for(let Ne=he;Ne<=Me;Ne++){let je=String.fromCharCode(Ne),fe=S(je);fe!=je.toLowerCase()&&(3<fe.length||fe.length!=0&&(yield{folded:fe,composed:je,code_point:Ne}))}}(ae))ee(ne.folded,ne.folded),ee(ne.folded,ne.composed);return j},O=ae=>{const j=k(ae),ee={};let ne=[];for(let he in j){let Me=j[he];Me&&(ee[he]=l(Me)),1<he.length&&ne.push(c(he))}ne.sort((he,Me)=>Me.length-he.length);const le=r(ne);return b=new RegExp("^"+le,"u"),ee},L=(ae,j=1)=>(j=Math.max(j,ae.length-1),r(m(ae).map(ee=>((ne,le=1)=>{let he=0;return ne=ne.map(Me=>(_[Me]&&(he+=Me.length),_[Me]||Me)),he>=le?o(ne):""})(ee,j)))),P=(ae,j=!0)=>{let ee=1<ae.length?1:0;return r(ae.map(ne=>{let le=[];const he=j?ne.length():ne.length()-1;for(let Me=0;Me<he;Me++)le.push(L(ne.substrs[Me]||"",ee));return o(le)}))},N=(ae,j)=>{for(const ee of j){if(ee.start!=ae.start||ee.end!=ae.end||ee.substrs.join("")!==ae.substrs.join(""))continue;let ne=ae.parts;const le=he=>{for(const Me of ne){if(Me.start===he.start&&Me.substr===he.substr)return!1;if(he.length!=1&&Me.length!=1&&(he.start<Me.start&&he.end>Me.start||Me.start<he.start&&Me.end>he.start))return!0}return!1};if(!(0<ee.parts.filter(le).length))return!0}return!1};class z{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(j){j&&(this.parts.push(j),this.substrs.push(j.substr),this.start=Math.min(j.start,this.start),this.end=Math.max(j.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(j,ee){let ne=new z,le=JSON.parse(JSON.stringify(this.parts)),he=le.pop();for(const je of le)ne.add(je);let Me=ee.substr.substring(0,j-he.start),Ne=Me.length;return ne.add({start:he.start,end:he.start+Ne,length:Ne,substr:Me}),ne}}const K=ae=>{_===void 0&&(_=O(h)),ae=S(ae);let j="",ee=[new z];for(let ne,le=0;le<ae.length;le++){ne=ae.substring(le).match(b);const he=ae.substring(le,le+1),Me=ne?ne[0]:null;let Ne=[],je=new Set;for(const fe of ee){const ce=fe.last();if(!ce||ce.length==1||ce.end<=le)if(Me){const ye=Me.length;fe.add({start:le,end:le+ye,length:ye,substr:Me}),je.add("1")}else fe.add({start:le,end:le+1,length:1,substr:he}),je.add("2");else if(Me){let ye=fe.clone(le,ce);const Pe=Me.length;ye.add({start:le,end:le+Pe,length:Pe,substr:Me}),Ne.push(ye)}else je.add("3")}if(0<Ne.length){Ne=Ne.sort((fe,ce)=>fe.length()-ce.length());for(let fe of Ne)N(fe,ee)||ee.push(fe)}else if(0<le&&je.size==1&&!je.has("3")){j+=P(ee,!1);let fe=new z;const ce=ee[0];ce&&fe.add(ce.last()),ee=[fe]}}return j+=P(ee,!0),j},Z=(ae,j)=>{if(ae)return ae[j]},V=(ae,j)=>{if(ae){for(var ee,ne=j.split(".");(ee=ne.shift())&&(ae=ae[ee]););return ae}},H=(ae,j,ee)=>{var ne,le;return ae?(ae+="",j.regex==null||(le=ae.search(j.regex))===-1?0:(ne=j.string.length/ae.length,le===0&&(ne+=.5),ne*ee)):0},Y=(ae,j)=>{var ee=ae[j];return typeof ee=="function"?ee:void(ee&&!Array.isArray(ee)&&(ae[j]=[ee]))},q=(ae,j)=>{if(Array.isArray(ae))ae.forEach(j);else for(var ee in ae)ae.hasOwnProperty(ee)&&j(ae[ee],ee)},J=(ae,j)=>typeof ae=="number"&&typeof j=="number"?ae>j?1:ae<j?-1:0:(ae=S(ae+"").toLowerCase())>(j=S(j+"").toLowerCase())?1:j>ae?-1:0;class W{constructor(j,ee){this.items=void 0,this.settings=void 0,this.items=j,this.settings=ee||{diacritics:!0}}tokenize(j,ee,ne){if(!j||!j.length)return[];const le=[],he=j.split(/\s+/);var Me;return ne&&(Me=new RegExp("^("+Object.keys(ne).map(c).join("|")+"):(.*)$")),he.forEach(Ne=>{let je,fe=null,ce=null;Me&&(je=Ne.match(Me))&&(fe=je[1],Ne=je[2]),0<Ne.length&&(ce=this.settings.diacritics?K(Ne)||null:c(Ne),ce&&ee&&(ce="\\b"+ce)),le.push({string:Ne,regex:ce?new RegExp(ce,"iu"):null,field:fe})}),le}getScoreFunction(j,ee){var ne=this.prepareSearch(j,ee);return this._getScoreFunction(ne)}_getScoreFunction(j){const ee=j.tokens,ne=ee.length;if(!ne)return function(){return 0};const le=j.options.fields,he=j.weights,Me=le.length,Ne=j.getAttrFn;if(!Me)return function(){return 1};const je=Me===1?function(fe,ce){const ye=le[0].field;return H(Ne(ce,ye),fe,he[ye]||1)}:function(fe,ce){var ye=0;if(fe.field){const Pe=Ne(ce,fe.field);ye+=!fe.regex&&Pe?1/Me:H(Pe,fe,1)}else q(he,(Pe,Ve)=>{ye+=H(Ne(ce,Ve),fe,Pe)});return ye/Me};return ne===1?function(fe){return je(ee[0],fe)}:j.options.conjunction==="and"?function(fe){var ce,ye=0;for(let Pe of ee){if(0>=(ce=je(Pe,fe)))return 0;ye+=ce}return ye/ne}:function(fe){var ce=0;return q(ee,ye=>{ce+=je(ye,fe)}),ce/ne}}getSortFunction(j,ee){var ne=this.prepareSearch(j,ee);return this._getSortFunction(ne)}_getSortFunction(j){var ee,ne=[];const le=this,he=j.options,Me=!j.query&&he.sort_empty?he.sort_empty:he.sort;if(typeof Me=="function")return Me.bind(this);const Ne=function(je,fe){return je==="$score"?fe.score:j.getAttrFn(le.items[fe.id],je)};if(Me)for(let je of Me)(j.query||je.field!=="$score")&&ne.push(je);if(j.query){ee=!0;for(let je of ne)if(je.field==="$score"){ee=!1;break}ee&&ne.unshift({field:"$score",direction:"desc"})}else ne=ne.filter(je=>je.field!=="$score");return ne.length?function(je,fe){var ce,ye;for(let Pe of ne)if(ye=Pe.field,ce=(Pe.direction==="desc"?-1:1)*J(Ne(ye,je),Ne(ye,fe)))return ce;return 0}:null}prepareSearch(j,ee){const ne={};var le=Object.assign({},ee);if(Y(le,"sort"),Y(le,"sort_empty"),le.fields){Y(le,"fields");const he=[];le.fields.forEach(Me=>{typeof Me=="string"&&(Me={field:Me,weight:1}),he.push(Me),ne[Me.field]="weight"in Me?Me.weight:1}),le.fields=he}return{options:le,query:j.toLowerCase().trim(),tokens:this.tokenize(j,le.respect_word_boundaries,ne),total:0,items:[],weights:ne,getAttrFn:le.nesting?V:Z}}search(j,ee){var ne,le,he=this;le=this.prepareSearch(j,ee),ee=le.options,j=le.query;const Me=ee.score||he._getScoreFunction(le);j.length?q(he.items,(je,fe)=>{ne=Me(je),(ee.filter===!1||0<ne)&&le.items.push({score:ne,id:fe})}):q(he.items,(je,fe)=>{le.items.push({score:1,id:fe})});const Ne=he._getSortFunction(le);return Ne&&le.items.sort(Ne),le.total=le.items.length,typeof ee.limit=="number"&&(le.items=le.items.slice(0,ee.limit)),le}}const te=(ae,j)=>{if(Array.isArray(ae))ae.forEach(j);else for(var ee in ae)ae.hasOwnProperty(ee)&&j(ae[ee],ee)},ie=ae=>{if(ae.jquery)return ae[0];if(ae instanceof HTMLElement)return ae;if(oe(ae)){var j=document.createElement("template");return j.innerHTML=ae.trim(),j.content.firstChild}return document.querySelector(ae)},oe=ae=>typeof ae=="string"&&-1<ae.indexOf("<"),Ce=(ae,j)=>{var ee=document.createEvent("HTMLEvents");ee.initEvent(j,!0,!1),ae.dispatchEvent(ee)},ve=(ae,j)=>{Object.assign(ae.style,j)},we=(ae,...j)=>{var ee=Re(j);(ae=Fe(ae)).map(ne=>{ee.map(le=>{ne.classList.add(le)})})},Se=(ae,...j)=>{var ee=Re(j);(ae=Fe(ae)).map(ne=>{ee.map(le=>{ne.classList.remove(le)})})},Re=ae=>{var j=[];return te(ae,ee=>{typeof ee=="string"&&(ee=ee.trim().split(/[\11\12\14\15\40]/)),Array.isArray(ee)&&(j=j.concat(ee))}),j.filter(Boolean)},Fe=ae=>(Array.isArray(ae)||(ae=[ae]),ae),$e=(ae,j,ee)=>{if(!ee||ee.contains(ae))for(;ae&&ae.matches;){if(ae.matches(j))return ae;ae=ae.parentNode}},Ue=(ae,j=0)=>0<j?ae[ae.length-1]:ae[0],qe=(ae,j)=>{if(!ae)return-1;j=j||ae.nodeName;for(var ee=0;ae=ae.previousElementSibling;)ae.matches(j)&&ee++;return ee},_e=(ae,j)=>{te(j,(ee,ne)=>{ee==null?ae.removeAttribute(ne):ae.setAttribute(ne,""+ee)})},be=(ae,j)=>{ae.parentNode&&ae.parentNode.replaceChild(j,ae)},De=(ae,j)=>{if(j===null)return;if(typeof j=="string"){if(!j.length)return;j=new RegExp(j,"i")}const ee=ne=>ne.nodeType===3?(le=>{var he=le.data.match(j);if(he&&0<le.data.length){var Me=document.createElement("span");Me.className="highlight";var Ne=le.splitText(he.index);Ne.splitText(he[0].length);var je=Ne.cloneNode(!0);return Me.appendChild(je),be(Ne,Me),1}return 0})(ne):((le=>{le.nodeType!==1||!le.childNodes||/(script|style)/i.test(le.tagName)||le.className==="highlight"&&le.tagName==="SPAN"||Array.from(le.childNodes).forEach(he=>{ee(he)})})(ne),0);ee(ae)},Te=typeof navigator<"u"&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey";var ge={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(ae){return 0<ae.length},render:{}};const Ee=ae=>ae==null?null:Ie(ae),Ie=ae=>typeof ae=="boolean"?ae?"1":"0":ae+"",Be=ae=>(ae+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Oe=(ae,j)=>{var ee;return function(ne,le){var he=this;ee&&(he.loading=Math.max(he.loading-1,0),clearTimeout(ee)),ee=setTimeout(function(){ee=null,he.loadedSearches[ne]=!0,ae.call(he,ne,le)},j)}},ue=(ae,j,ee)=>{var ne,le=ae.trigger,he={};for(ne of(ae.trigger=function(){var Me=arguments[0];return j.indexOf(Me)===-1?le.apply(ae,arguments):void(he[Me]=arguments)},ee.apply(ae,[]),ae.trigger=le,j))ne in he&&le.apply(ae,he[ne])},re=(ae,j=!1)=>{ae&&(ae.preventDefault(),j&&ae.stopPropagation())},ke=(ae,j,ee,ne)=>{ae.addEventListener(j,ee,ne)},We=(ae,j)=>!!j&&!!j[ae]&&(j.altKey?1:0)+(j.ctrlKey?1:0)+(j.shiftKey?1:0)+(j.metaKey?1:0)==1,Xe=(ae,j)=>ae.getAttribute("id")||(ae.setAttribute("id",j),j),Ye=ae=>ae.replace(/[\\"']/g,"\\$&"),it=(ae,j)=>{j&&ae.append(j)};var tt=0;class Ke extends function(j){return j.plugins={},class extends j{constructor(...ee){super(...ee),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(ee,ne){j.plugins[ee]={name:ee,fn:ne}}initializePlugins(ee){var ne,le;const he=this,Me=[];if(Array.isArray(ee))ee.forEach(Ne=>{typeof Ne=="string"?Me.push(Ne):(he.plugins.settings[Ne.name]=Ne.options,Me.push(Ne.name))});else if(ee)for(ne in ee)ee.hasOwnProperty(ne)&&(he.plugins.settings[ne]=ee[ne],Me.push(ne));for(;le=Me.shift();)he.require(le)}loadPlugin(ee){var ne=this,le=ne.plugins,he=j.plugins[ee];if(!j.plugins.hasOwnProperty(ee))throw new Error('Unable to find "'+ee+'" plugin');le.requested[ee]=!0,le.loaded[ee]=he.fn.apply(ne,[ne.plugins.settings[ee]||{}]),le.names.push(ee)}require(ee){var ne=this,le=ne.plugins;if(!ne.plugins.loaded.hasOwnProperty(ee)){if(le.requested[ee])throw new Error('Plugin has circular dependency ("'+ee+'")');ne.loadPlugin(ee)}return le.loaded[ee]}}}(i){constructor(j,ee){var ne;super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],tt++;var le=ie(j);if(le.tomselect)throw new Error("Tom Select already initialized on this element");le.tomselect=this,ne=(window.getComputedStyle&&window.getComputedStyle(le,null)).getPropertyValue("direction");const he=e(le,ee);this.settings=he,this.input=le,this.tabIndex=le.tabIndex||0,this.is_select_tag=le.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(ne),this.inputId=Xe(le,"tomselect-"+tt),this.isRequired=le.required,this.sifter=new W(this.options,{diacritics:he.diacritics}),he.mode=he.mode||(he.maxItems===1?"single":"multi"),typeof he.hideSelected!="boolean"&&(he.hideSelected=he.mode==="multi"),typeof he.hidePlaceholder!="boolean"&&(he.hidePlaceholder=he.mode!=="multi");var Me=he.createFilter;typeof Me!="function"&&(typeof Me=="string"&&(Me=new RegExp(Me)),he.createFilter=Me instanceof RegExp?Qe=>Me.test(Qe):Qe=>this.settings.duplicates||!this.options[Qe]),this.initializePlugins(he.plugins),this.setupCallbacks(),this.setupTemplates();const Ne=ie("<div>"),je=ie("<div>"),fe=this._render("dropdown"),ce=ie('<div role="listbox" tabindex="-1">'),ye=this.input.getAttribute("class")||"",Pe=he.mode;var Ve;we(Ne,he.wrapperClass,ye,Pe),we(je,he.controlClass),it(Ne,je),we(fe,he.dropdownClass,Pe),he.copyClassesToDropdown&&we(fe,ye),we(ce,he.dropdownContentClass),it(fe,ce),ie(he.dropdownParent||Ne).appendChild(fe),oe(he.controlInput)?(Ve=ie(he.controlInput),q(["autocorrect","autocapitalize","autocomplete"],Qe=>{le.getAttribute(Qe)&&_e(Ve,{[Qe]:le.getAttribute(Qe)})}),Ve.tabIndex=-1,je.appendChild(Ve),this.focus_node=Ve):he.controlInput?(Ve=ie(he.controlInput),this.focus_node=Ve):(Ve=ie("<input/>"),this.focus_node=je),this.wrapper=Ne,this.dropdown=fe,this.dropdown_content=ce,this.control=je,this.control_input=Ve,this.setup()}setup(){const j=this,ee=j.settings,ne=j.control_input,le=j.dropdown,he=j.dropdown_content,Me=j.wrapper,Ne=j.control,je=j.input,fe=j.focus_node,ce={passive:!0},ye=j.inputId+"-ts-dropdown";_e(he,{id:ye}),_e(fe,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":ye});const Pe=Xe(fe,j.inputId+"-ts-control"),Ve="label[for='"+(Ze=>Ze.replace(/['"\\]/g,"\\$&"))(j.inputId)+"']",Qe=document.querySelector(Ve),at=j.focus.bind(j);if(Qe){ke(Qe,"click",at),_e(Qe,{for:Pe});const Ze=Xe(Qe,j.inputId+"-ts-label");_e(fe,{"aria-labelledby":Ze}),_e(he,{"aria-labelledby":Ze})}if(Me.style.width=je.style.width,j.plugins.names.length){const Ze="plugin-"+j.plugins.names.join(" plugin-");we([Me,le],Ze)}(ee.maxItems===null||1<ee.maxItems)&&j.is_select_tag&&_e(je,{multiple:"multiple"}),ee.placeholder&&_e(ne,{placeholder:ee.placeholder}),!ee.splitOn&&ee.delimiter&&(ee.splitOn=new RegExp("\\s*"+c(ee.delimiter)+"+\\s*")),ee.load&&ee.loadThrottle&&(ee.load=Oe(ee.load,ee.loadThrottle)),j.control_input.type=je.type,ke(le,"mousemove",()=>{j.ignoreHover=!1}),ke(le,"mouseenter",Ze=>{var ot=$e(Ze.target,"[data-selectable]",le);ot&&j.onOptionHover(Ze,ot)},{capture:!0}),ke(le,"click",Ze=>{const ot=$e(Ze.target,"[data-selectable]");ot&&(j.onOptionSelect(Ze,ot),re(Ze,!0))}),ke(Ne,"click",Ze=>{var ot=$e(Ze.target,"[data-ts-item]",Ne);ot&&j.onItemSelect(Ze,ot)?re(Ze,!0):ne.value==""&&(j.onClick(),re(Ze,!0))}),ke(fe,"keydown",Ze=>j.onKeyDown(Ze)),ke(ne,"keypress",Ze=>j.onKeyPress(Ze)),ke(ne,"input",Ze=>j.onInput(Ze)),ke(fe,"blur",Ze=>j.onBlur(Ze)),ke(fe,"focus",Ze=>j.onFocus(Ze)),ke(ne,"paste",Ze=>j.onPaste(Ze));const ht=Ze=>{const ot=Ze.composedPath()[0];return Me.contains(ot)||le.contains(ot)?void(ot==ne&&j.isOpen?Ze.stopPropagation():re(Ze,!0)):(j.isFocused&&j.blur(),void j.inputState())},xt=()=>{j.isOpen&&j.positionDropdown()};ke(document,"mousedown",ht),ke(window,"scroll",xt,ce),ke(window,"resize",xt,ce),this._destroy=()=>{document.removeEventListener("mousedown",ht),window.removeEventListener("scroll",xt),window.removeEventListener("resize",xt),Qe&&Qe.removeEventListener("click",at)},this.revertSettings={innerHTML:je.innerHTML,tabIndex:je.tabIndex},je.tabIndex=-1,je.insertAdjacentElement("afterend",j.wrapper),j.sync(!1),ee.items=[],delete ee.optgroups,delete ee.options,ke(je,"invalid",()=>{j.isValid&&(j.isValid=!1,j.isInvalid=!0,j.refreshState())}),j.updateOriginalInput(),j.refreshItems(),j.close(!1),j.inputState(),j.isSetup=!0,je.disabled?j.disable():j.enable(),j.on("change",this.onChange),we(je,"tomselected","ts-hidden-accessible"),j.trigger("initialize"),ee.preload===!0&&j.preload()}setupOptions(j=[],ee=[]){this.addOptions(j),q(ee,ne=>{this.registerOptionGroup(ne)})}setupTemplates(){var j=this,ee=j.settings.labelField,ne=j.settings.optgroupLabelField,le={optgroup:he=>{let Me=document.createElement("div");return Me.className="optgroup",Me.appendChild(he.options),Me},optgroup_header:(he,Me)=>'<div class="optgroup-header">'+Me(he[ne])+"</div>",option:(he,Me)=>"<div>"+Me(he[ee])+"</div>",item:(he,Me)=>"<div>"+Me(he[ee])+"</div>",option_create:(he,Me)=>'<div class="create">Add <strong>'+Me(he.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};j.settings.render=Object.assign({},le,j.settings.render)}setupCallbacks(){var j,ee,ne={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(j in ne)(ee=this.settings[ne[j]])&&this.on(j,ee)}sync(j=!0){const ee=this,ne=j?e(ee.input,{delimiter:ee.settings.delimiter}):ee.settings;ee.setupOptions(ne.options,ne.optgroups),ee.setValue(ne.items||[],!0),ee.lastQuery=null}onClick(){var j=this;return 0<j.activeItems.length?(j.clearActiveItems(),void j.focus()):void(j.isFocused&&j.isOpen?j.blur():j.focus())}onMouseDown(){}onChange(){Ce(this.input,"input"),Ce(this.input,"change")}onPaste(j){var ee=this;ee.isInputHidden||ee.isLocked?re(j):ee.settings.splitOn&&setTimeout(()=>{var ne=ee.inputValue();if(ne.match(ee.settings.splitOn)){var le=ne.trim().split(ee.settings.splitOn);q(le,he=>{Ee(he)&&(this.options[he]?ee.addItem(he):ee.createItem(he))})}},0)}onKeyPress(j){var ee=this;if(!ee.isLocked){var ne=String.fromCharCode(j.keyCode||j.which);return ee.settings.create&&ee.settings.mode==="multi"&&ne===ee.settings.delimiter?(ee.createItem(),void re(j)):void 0}re(j)}onKeyDown(j){var ee=this;if(ee.ignoreHover=!0,ee.isLocked)j.keyCode!==9&&re(j);else{switch(j.keyCode){case 65:if(We(Te,j)&&ee.control_input.value=="")return re(j),void ee.selectAll();break;case 27:return ee.isOpen&&(re(j,!0),ee.close()),void ee.clearActiveItems();case 40:if(!ee.isOpen&&ee.hasOptions)ee.open();else if(ee.activeOption){let ne=ee.getAdjacent(ee.activeOption,1);ne&&ee.setActiveOption(ne)}return void re(j);case 38:if(ee.activeOption){let ne=ee.getAdjacent(ee.activeOption,-1);ne&&ee.setActiveOption(ne)}return void re(j);case 13:return void(ee.canSelect(ee.activeOption)?(ee.onOptionSelect(j,ee.activeOption),re(j)):(ee.settings.create&&ee.createItem()||document.activeElement==ee.control_input&&ee.isOpen)&&re(j));case 37:return void ee.advanceSelection(-1,j);case 39:return void ee.advanceSelection(1,j);case 9:return void(ee.settings.selectOnTab&&(ee.canSelect(ee.activeOption)&&(ee.onOptionSelect(j,ee.activeOption),re(j)),ee.settings.create&&ee.createItem()&&re(j)));case 8:case 46:return void ee.deleteSelection(j)}ee.isInputHidden&&!We(Te,j)&&re(j)}}onInput(j){var ee=this;if(!ee.isLocked){var ne=ee.inputValue();ee.lastValue!==ne&&(ee.lastValue=ne,ee.settings.shouldLoad.call(ee,ne)&&ee.load(ne),ee.refreshOptions(),ee.trigger("type",ne))}}onOptionHover(j,ee){this.ignoreHover||this.setActiveOption(ee,!1)}onFocus(j){var ee=this,ne=ee.isFocused;return ee.isDisabled?(ee.blur(),void re(j)):void(ee.ignoreFocus||(ee.isFocused=!0,ee.settings.preload==="focus"&&ee.preload(),ne||ee.trigger("focus"),ee.activeItems.length||(ee.showInput(),ee.refreshOptions(!!ee.settings.openOnFocus)),ee.refreshState()))}onBlur(j){if(document.hasFocus()!==!1){var ee=this;if(ee.isFocused){ee.isFocused=!1,ee.ignoreFocus=!1;var ne=()=>{ee.close(),ee.setActiveItem(),ee.setCaret(ee.items.length),ee.trigger("blur")};ee.settings.create&&ee.settings.createOnBlur?ee.createItem(null,ne):ne()}}}onOptionSelect(j,ee){var ne,le=this;ee.parentElement&&ee.parentElement.matches("[data-disabled]")||(ee.classList.contains("create")?le.createItem(null,()=>{le.settings.closeAfterSelect&&le.close()}):(ne=ee.dataset.value)!==void 0&&(le.lastQuery=null,le.addItem(ne),le.settings.closeAfterSelect&&le.close(),!le.settings.hideSelected&&j.type&&/click/.test(j.type)&&le.setActiveOption(ee)))}canSelect(j){return!!(this.isOpen&&j&&this.dropdown_content.contains(j))}onItemSelect(j,ee){var ne=this;return!ne.isLocked&&ne.settings.mode==="multi"&&(re(j),ne.setActiveItem(ee,j),!0)}canLoad(j){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(j)}load(j){const ee=this;if(ee.canLoad(j)){we(ee.wrapper,ee.settings.loadingClass),ee.loading++;const ne=ee.loadCallback.bind(ee);ee.settings.load.call(ee,j,ne)}}loadCallback(j,ee){const ne=this;ne.loading=Math.max(ne.loading-1,0),ne.lastQuery=null,ne.clearActiveOption(),ne.setupOptions(j,ee),ne.refreshOptions(ne.isFocused&&!ne.isInputHidden),ne.loading||Se(ne.wrapper,ne.settings.loadingClass),ne.trigger("load",j,ee)}preload(){var j=this.wrapper.classList;j.contains("preloaded")||(j.add("preloaded"),this.load(""))}setTextboxValue(j=""){var ee=this.control_input;ee.value!==j&&(ee.value=j,Ce(ee,"update"),this.lastValue=j)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(j,ee){ue(this,ee?[]:["change"],()=>{this.clear(ee),this.addItems(j,ee)})}setMaxItems(j){j===0&&(j=null),this.settings.maxItems=j,this.refreshState()}setActiveItem(j,ee){var ne,le,he,Me,Ne,je,fe=this;if(fe.settings.mode!=="single"){if(!j)return fe.clearActiveItems(),void(fe.isFocused&&fe.showInput());if((ne=ee&&ee.type.toLowerCase())==="click"&&We("shiftKey",ee)&&fe.activeItems.length){for(je=fe.getLastActive(),(he=Array.prototype.indexOf.call(fe.control.children,je))>(Me=Array.prototype.indexOf.call(fe.control.children,j))&&(Ne=he,he=Me,Me=Ne),le=he;le<=Me;le++)j=fe.control.children[le],fe.activeItems.indexOf(j)===-1&&fe.setActiveItemClass(j);re(ee)}else ne==="click"&&We(Te,ee)||ne==="keydown"&&We("shiftKey",ee)?j.classList.contains("active")?fe.removeActiveItem(j):fe.setActiveItemClass(j):(fe.clearActiveItems(),fe.setActiveItemClass(j));fe.hideInput(),fe.isFocused||fe.focus()}}setActiveItemClass(j){const ee=this,ne=ee.control.querySelector(".last-active");ne&&Se(ne,"last-active"),we(j,"active last-active"),ee.trigger("item_select",j),ee.activeItems.indexOf(j)==-1&&ee.activeItems.push(j)}removeActiveItem(j){var ee=this.activeItems.indexOf(j);this.activeItems.splice(ee,1),Se(j,"active")}clearActiveItems(){Se(this.activeItems,"active"),this.activeItems=[]}setActiveOption(j,ee=!0){j!==this.activeOption&&(this.clearActiveOption(),j&&(this.activeOption=j,_e(this.focus_node,{"aria-activedescendant":j.getAttribute("id")}),_e(j,{"aria-selected":"true"}),we(j,"active"),ee&&this.scrollToOption(j)))}scrollToOption(j,ee){if(j){const ne=this.dropdown_content,le=ne.clientHeight,he=ne.scrollTop||0,Me=j.offsetHeight,Ne=j.getBoundingClientRect().top-ne.getBoundingClientRect().top+he;Ne+Me>le+he?this.scroll(Ne-le+Me,ee):Ne<he&&this.scroll(Ne,ee)}}scroll(j,ee){const ne=this.dropdown_content;ee&&(ne.style.scrollBehavior=ee),ne.scrollTop=j,ne.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(Se(this.activeOption,"active"),_e(this.activeOption,{"aria-selected":null})),this.activeOption=null,_e(this.focus_node,{"aria-activedescendant":null})}selectAll(){const j=this;if(j.settings.mode!=="single"){const ee=j.controlChildren();ee.length&&(j.hideInput(),j.close(),j.activeItems=ee,q(ee,ne=>{j.setActiveItemClass(ne)}))}}inputState(){var j=this;j.control.contains(j.control_input)&&(_e(j.control_input,{placeholder:j.settings.placeholder}),0<j.activeItems.length||!j.isFocused&&j.settings.hidePlaceholder&&0<j.items.length?(j.setTextboxValue(),j.isInputHidden=!0):(j.settings.hidePlaceholder&&0<j.items.length&&_e(j.control_input,{placeholder:""}),j.isInputHidden=!1),j.wrapper.classList.toggle("input-hidden",j.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var j=this;j.isDisabled||(j.ignoreFocus=!0,j.control_input.offsetWidth?j.control_input.focus():j.focus_node.focus(),setTimeout(()=>{j.ignoreFocus=!1,j.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(j){return this.sifter.getScoreFunction(j,this.getSearchOptions())}getSearchOptions(){var j=this.settings,ee=j.sortField;return typeof j.sortField=="string"&&(ee=[{field:j.sortField}]),{fields:j.searchField,conjunction:j.searchConjunction,sort:ee,nesting:j.nesting}}search(j){var ee,ne,le=this,he=this.getSearchOptions();if(le.settings.score&&typeof(ne=le.settings.score.call(le,j))!="function")throw new Error('Tom Select "score" setting must be a function that returns a function');return j===le.lastQuery?ee=Object.assign({},le.currentResults):(le.lastQuery=j,ee=le.sifter.search(j,Object.assign(he,{score:ne})),le.currentResults=ee),le.settings.hideSelected&&(ee.items=ee.items.filter(Me=>{let Ne=Ee(Me.id);return!(Ne&&le.items.indexOf(Ne)!==-1)})),ee}refreshOptions(j=!0){var ee,ne,le,he,Me,Ne,je,fe,ce,ye;const Pe={},Ve=[];var Qe=this,at=Qe.inputValue();const ht=at===Qe.lastQuery||at==""&&Qe.lastQuery==null;var xt,Ze=Qe.search(at),ot=null,mt=Qe.settings.shouldOpen||!1,pt=Qe.dropdown_content;for(ht&&(ot=Qe.activeOption)&&(ce=ot.closest("[data-group]")),he=Ze.items.length,typeof Qe.settings.maxOptions=="number"&&(he=Math.min(he,Qe.settings.maxOptions)),0<he&&(mt=!0),ee=0;ee<he;ee++){let _t=Ze.items[ee];if(!_t)continue;let Mt=_t.id,Tt=Qe.options[Mt];if(Tt===void 0)continue;let Bt=Ie(Mt),kt=Qe.getOption(Bt,!0);for(Qe.settings.hideSelected||kt.classList.toggle("selected",Qe.items.includes(Bt)),Me=Tt[Qe.settings.optgroupField]||"",ne=0,le=(Ne=Array.isArray(Me)?Me:[Me])&&Ne.length;ne<le;ne++){Me=Ne[ne],Qe.optgroups.hasOwnProperty(Me)||(Me="");let Lt=Pe[Me];Lt===void 0&&(Lt=document.createDocumentFragment(),Ve.push(Me)),0<ne&&(kt=kt.cloneNode(!0),_e(kt,{id:Tt.$id+"-clone-"+ne,"aria-selected":null}),kt.classList.add("ts-cloned"),Se(kt,"active"),Qe.activeOption&&Qe.activeOption.dataset.value==Mt&&ce&&ce.dataset.group===Me.toString()&&(ot=kt)),Lt.appendChild(kt),Pe[Me]=Lt}}Qe.settings.lockOptgroupOrder&&Ve.sort((_t,Mt)=>{const Tt=Qe.optgroups[_t],Bt=Qe.optgroups[Mt];return(Tt&&Tt.$order||0)-(Bt&&Bt.$order||0)}),je=document.createDocumentFragment(),q(Ve,_t=>{let Mt=Pe[_t];if(Mt&&Mt.children.length){let Tt=Qe.optgroups[_t];if(Tt!==void 0){let Bt=document.createDocumentFragment(),kt=Qe.render("optgroup_header",Tt);it(Bt,kt),it(Bt,Mt);let Lt=Qe.render("optgroup",{group:Tt,options:Bt});it(je,Lt)}else it(je,Mt)}}),pt.innerHTML="",it(pt,je),Qe.settings.highlight&&(xt=pt.querySelectorAll("span.highlight"),Array.prototype.forEach.call(xt,function(_t){var Mt=_t.parentNode;Mt.replaceChild(_t.firstChild,_t),Mt.normalize()}),Ze.query.length&&Ze.tokens.length&&q(Ze.tokens,_t=>{De(pt,_t.regex)}));var bt=_t=>{let Mt=Qe.render(_t,{input:at});return Mt&&(mt=!0,pt.insertBefore(Mt,pt.firstChild)),Mt};if(Qe.loading?bt("loading"):Qe.settings.shouldLoad.call(Qe,at)?Ze.items.length===0&&bt("no_results"):bt("not_loading"),(fe=Qe.canCreate(at))&&(ye=bt("option_create")),Qe.hasOptions=0<Ze.items.length||fe,mt){if(!(0<Ze.items.length))ye&&(ot=ye);else if(ot||Qe.settings.mode!=="single"||Qe.items[0]==null||(ot=Qe.getOption(Qe.items[0])),!pt.contains(ot)){let _t=0;ye&&!Qe.settings.addPrecedence&&(_t=1),ot=Qe.selectable()[_t]}j&&!Qe.isOpen&&(Qe.open(),Qe.scrollToOption(ot,"auto")),Qe.setActiveOption(ot)}else Qe.clearActiveOption(),j&&Qe.isOpen&&Qe.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(j,ee=!1){const ne=this;if(Array.isArray(j))return ne.addOptions(j,ee),!1;const le=Ee(j[ne.settings.valueField]);return le!==null&&!ne.options.hasOwnProperty(le)&&(j.$order=j.$order||++ne.order,j.$id=ne.inputId+"-opt-"+j.$order,ne.options[le]=j,ne.lastQuery=null,ee&&(ne.userOptions[le]=ee,ne.trigger("option_add",le,j)),le)}addOptions(j,ee=!1){q(j,ne=>{this.addOption(ne,ee)})}registerOption(j){return this.addOption(j)}registerOptionGroup(j){var ee=Ee(j[this.settings.optgroupValueField]);return ee!==null&&(j.$order=j.$order||++this.order,this.optgroups[ee]=j,ee)}addOptionGroup(j,ee){var ne;ee[this.settings.optgroupValueField]=j,(ne=this.registerOptionGroup(ee))&&this.trigger("optgroup_add",ne,ee)}removeOptionGroup(j){this.optgroups.hasOwnProperty(j)&&(delete this.optgroups[j],this.clearCache(),this.trigger("optgroup_remove",j))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(j,ee){const ne=this;var le,he;const Me=Ee(j),Ne=Ee(ee[ne.settings.valueField]);if(Me!==null){const je=ne.options[Me];if(je!=null){if(typeof Ne!="string")throw new Error("Value must be set in option data");const fe=ne.getOption(Me),ce=ne.getItem(Me);if(ee.$order=ee.$order||je.$order,delete ne.options[Me],ne.uncacheValue(Ne),ne.options[Ne]=ee,fe){if(ne.dropdown_content.contains(fe)){const ye=ne._render("option",ee);be(fe,ye),ne.activeOption===fe&&ne.setActiveOption(ye)}fe.remove()}ce&&((he=ne.items.indexOf(Me))!==-1&&ne.items.splice(he,1,Ne),le=ne._render("item",ee),ce.classList.contains("active")&&we(le,"active"),be(ce,le)),ne.lastQuery=null}}}removeOption(j,ee){const ne=this;j=Ie(j),ne.uncacheValue(j),delete ne.userOptions[j],delete ne.options[j],ne.lastQuery=null,ne.trigger("option_remove",j),ne.removeItem(j,ee)}clearOptions(j){const ee=(j||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const ne={};q(this.options,(le,he)=>{ee(le,he)&&(ne[he]=le)}),this.options=this.sifter.items=ne,this.lastQuery=null,this.trigger("option_clear")}clearFilter(j,ee){return 0<=this.items.indexOf(ee)}getOption(j,ee=!1){const ne=Ee(j);if(ne===null)return null;const le=this.options[ne];if(le!=null){if(le.$div)return le.$div;if(ee)return this._render("option",le)}return null}getAdjacent(j,ee,ne="option"){var le;if(!j)return null;le=ne=="item"?this.controlChildren():this.dropdown_content.querySelectorAll("[data-selectable]");for(let he=0;he<le.length;he++)if(le[he]==j)return 0<ee?le[he+1]:le[he-1];return null}getItem(j){if(typeof j=="object")return j;var ee=Ee(j);return ee===null?null:this.control.querySelector(`[data-value="${Ye(ee)}"]`)}addItems(j,ee){var ne=this,le=Array.isArray(j)?j:[j];const he=(le=le.filter(Me=>ne.items.indexOf(Me)===-1))[le.length-1];le.forEach(Me=>{ne.isPending=Me!==he,ne.addItem(Me,ee)})}addItem(j,ee){ue(this,ee?[]:["change","dropdown_close"],()=>{var ne,le;const he=this,Me=he.settings.mode,Ne=Ee(j);if((!Ne||he.items.indexOf(Ne)===-1||(Me==="single"&&he.close(),Me!=="single"&&he.settings.duplicates))&&Ne!==null&&he.options.hasOwnProperty(Ne)&&(Me==="single"&&he.clear(ee),Me!=="multi"||!he.isFull())){if(ne=he._render("item",he.options[Ne]),he.control.contains(ne)&&(ne=ne.cloneNode(!0)),le=he.isFull(),he.items.splice(he.caretPos,0,Ne),he.insertAtCaret(ne),he.isSetup){if(!he.isPending&&he.settings.hideSelected){let je=he.getOption(Ne),fe=he.getAdjacent(je,1);fe&&he.setActiveOption(fe)}he.isPending||he.settings.closeAfterSelect||he.refreshOptions(he.isFocused&&Me!=="single"),he.settings.closeAfterSelect!=0&&he.isFull()?he.close():he.isPending||he.positionDropdown(),he.trigger("item_add",Ne,ne),he.isPending||he.updateOriginalInput({silent:ee})}he.isPending&&(le||!he.isFull())||(he.inputState(),he.refreshState())}})}removeItem(j=null,ee){const ne=this;if(j=ne.getItem(j)){var le,he;const Me=j.dataset.value;le=qe(j),j.remove(),j.classList.contains("active")&&(he=ne.activeItems.indexOf(j),ne.activeItems.splice(he,1),Se(j,"active")),ne.items.splice(le,1),ne.lastQuery=null,!ne.settings.persist&&ne.userOptions.hasOwnProperty(Me)&&ne.removeOption(Me,ee),le<ne.caretPos&&ne.setCaret(ne.caretPos-1),ne.updateOriginalInput({silent:ee}),ne.refreshState(),ne.positionDropdown(),ne.trigger("item_remove",Me,j)}}createItem(j=null,ee=()=>{}){arguments.length===3&&(ee=arguments[2]),typeof ee!="function"&&(ee=()=>{});var ne,le=this,he=le.caretPos;if(j=j||le.inputValue(),!le.canCreate(j))return ee(),!1;le.lock();var Me=!1,Ne=je=>{if(le.unlock(),!je||typeof je!="object")return ee();var fe=Ee(je[le.settings.valueField]);return typeof fe=="string"?(le.setTextboxValue(),le.addOption(je,!0),le.setCaret(he),le.addItem(fe),ee(je),void(Me=!0)):ee()};return ne=typeof le.settings.create=="function"?le.settings.create.call(this,j,Ne):{[le.settings.labelField]:j,[le.settings.valueField]:j},Me||Ne(ne),!0}refreshItems(){var j=this;j.lastQuery=null,j.isSetup&&j.addItems(j.items),j.updateOriginalInput(),j.refreshState()}refreshState(){const j=this;j.refreshValidityState();const ee=j.isFull(),ne=j.isLocked;j.wrapper.classList.toggle("rtl",j.rtl);const le=j.wrapper.classList;var he;le.toggle("focus",j.isFocused),le.toggle("disabled",j.isDisabled),le.toggle("required",j.isRequired),le.toggle("invalid",!j.isValid),le.toggle("locked",ne),le.toggle("full",ee),le.toggle("input-active",j.isFocused&&!j.isInputHidden),le.toggle("dropdown-active",j.isOpen),le.toggle("has-options",(he=j.options,Object.keys(he).length===0)),le.toggle("has-items",0<j.items.length)}refreshValidityState(){var j=this;j.input.validity&&(j.isValid=j.input.validity.valid,j.isInvalid=!j.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(j={}){const ee=this;var ne,le;const he=ee.input.querySelector('option[value=""]');if(ee.is_select_tag){let Me=function(fe,ce,ye){return fe||(fe=ie('<option value="'+Be(ce)+'">'+Be(ye)+"</option>")),fe!=he&&ee.input.append(fe),Ne.push(fe),(fe!=he||0<je)&&(fe.selected=!0),fe};const Ne=[],je=ee.input.querySelectorAll("option:checked").length;ee.input.querySelectorAll("option:checked").forEach(fe=>{fe.selected=!1}),ee.items.length==0&&ee.settings.mode=="single"?Me(he,"",""):ee.items.forEach(fe=>{ne=ee.options[fe],le=ne[ee.settings.labelField]||"",Ne.includes(ne.$option)?Me(ee.input.querySelector(`option[value="${Ye(fe)}"]:not(:checked)`),fe,le):ne.$option=Me(ne.$option,fe,le)})}else ee.input.value=ee.getValue();ee.isSetup&&(j.silent||ee.trigger("change",ee.getValue()))}open(){var j=this;j.isLocked||j.isOpen||j.settings.mode==="multi"&&j.isFull()||(j.isOpen=!0,_e(j.focus_node,{"aria-expanded":"true"}),j.refreshState(),ve(j.dropdown,{visibility:"hidden",display:"block"}),j.positionDropdown(),ve(j.dropdown,{visibility:"visible",display:"block"}),j.focus(),j.trigger("dropdown_open",j.dropdown))}close(j=!0){var ee=this,ne=ee.isOpen;j&&(ee.setTextboxValue(),ee.settings.mode==="single"&&ee.items.length&&ee.hideInput()),ee.isOpen=!1,_e(ee.focus_node,{"aria-expanded":"false"}),ve(ee.dropdown,{display:"none"}),ee.settings.hideSelected&&ee.clearActiveOption(),ee.refreshState(),ne&&ee.trigger("dropdown_close",ee.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var j=this.control,ee=j.getBoundingClientRect(),ne=j.offsetHeight+ee.top+window.scrollY,le=ee.left+window.scrollX;ve(this.dropdown,{width:ee.width+"px",top:ne+"px",left:le+"px"})}}clear(j){var ee=this;if(ee.items.length){var ne=ee.controlChildren();q(ne,le=>{ee.removeItem(le,!0)}),ee.showInput(),j||ee.updateOriginalInput(),ee.trigger("clear")}}insertAtCaret(j){const ee=this,ne=ee.caretPos,le=ee.control;le.insertBefore(j,le.children[ne]||null),ee.setCaret(ne+1)}deleteSelection(j){var ee,ne,le,he,Me,Ne=this;ee=j&&j.keyCode===8?-1:1,ne={start:(Me=Ne.control_input).selectionStart||0,length:(Me.selectionEnd||0)-(Me.selectionStart||0)};const je=[];if(Ne.activeItems.length)he=Ue(Ne.activeItems,ee),le=qe(he),0<ee&&le++,q(Ne.activeItems,fe=>je.push(fe));else if((Ne.isFocused||Ne.settings.mode==="single")&&Ne.items.length){const fe=Ne.controlChildren();let ce;0>ee&&ne.start===0&&ne.length===0?ce=fe[Ne.caretPos-1]:0<ee&&ne.start===Ne.inputValue().length&&(ce=fe[Ne.caretPos]),ce!==void 0&&je.push(ce)}if(!Ne.shouldDelete(je,j))return!1;for(re(j,!0),le!==void 0&&Ne.setCaret(le);je.length;)Ne.removeItem(je.pop());return Ne.showInput(),Ne.positionDropdown(),Ne.refreshOptions(!1),!0}shouldDelete(j,ee){const ne=j.map(le=>le.dataset.value);return ne.length&&(typeof this.settings.onDelete!="function"||this.settings.onDelete(ne,ee)!==!1)}advanceSelection(j,ee){var ne,le,he=this;he.rtl&&(j*=-1),he.inputValue().length||(We(Te,ee)||We("shiftKey",ee)?(le=(ne=he.getLastActive(j))?ne.classList.contains("active")?he.getAdjacent(ne,j,"item"):ne:0<j?he.control_input.nextElementSibling:he.control_input.previousElementSibling)&&(le.classList.contains("active")&&he.removeActiveItem(ne),he.setActiveItemClass(le)):he.moveCaret(j))}moveCaret(j){}getLastActive(j){let ee=this.control.querySelector(".last-active");if(ee)return ee;var ne=this.control.querySelectorAll(".active");return ne?Ue(ne,j):void 0}setCaret(j){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var j=this;j.input.disabled=!0,j.control_input.disabled=!0,j.focus_node.tabIndex=-1,j.isDisabled=!0,this.close(),j.lock()}enable(){var j=this;j.input.disabled=!1,j.control_input.disabled=!1,j.focus_node.tabIndex=j.tabIndex,j.isDisabled=!1,j.unlock()}destroy(){var j=this,ee=j.revertSettings;j.trigger("destroy"),j.off(),j.wrapper.remove(),j.dropdown.remove(),j.input.innerHTML=ee.innerHTML,j.input.tabIndex=ee.tabIndex,Se(j.input,"tomselected","ts-hidden-accessible"),j._destroy(),delete j.input.tomselect}render(j,ee){var ne,le;const he=this;if(typeof this.settings.render[j]!="function"||!(le=he.settings.render[j].call(this,ee,Be)))return null;if(le=ie(le),j==="option"||j==="option_create"?ee[he.settings.disabledField]?_e(le,{"aria-disabled":"true"}):_e(le,{"data-selectable":""}):j==="optgroup"&&(ne=ee.group[he.settings.optgroupValueField],_e(le,{"data-group":ne}),ee.group[he.settings.disabledField]&&_e(le,{"data-disabled":""})),j==="option"||j==="item"){const Me=Ie(ee[he.settings.valueField]);_e(le,{"data-value":Me}),j==="item"?(we(le,he.settings.itemClass),_e(le,{"data-ts-item":""})):(we(le,he.settings.optionClass),_e(le,{role:"option",id:ee.$id}),ee.$div=le,he.options[Me]=ee)}return le}_render(j,ee){const ne=this.render(j,ee);if(ne==null)throw"HTMLElement expected";return ne}clearCache(){q(this.options,j=>{j.$div&&(j.$div.remove(),delete j.$div)})}uncacheValue(j){const ee=this.getOption(j);ee&&ee.remove()}canCreate(j){return this.settings.create&&0<j.length&&this.settings.createFilter.call(this,j)}hook(j,ee,ne){var le=this,he=le[ee];le[ee]=function(){var Me,Ne;return j==="after"&&(Me=he.apply(le,arguments)),Ne=ne.apply(le,arguments),j==="instead"?Ne:(j=="before"&&(Me=he.apply(le,arguments)),Me)}}}return Ke.define("change_listener",function(){ke(this.input,"change",()=>{this.sync()})}),Ke.define("checkbox_options",function(){var ae=this,j=ae.onOptionSelect;ae.settings.hideSelected=!1;var ee=function(ne){setTimeout(()=>{var le=ne.querySelector("input");le instanceof HTMLInputElement&&(ne.classList.contains("selected")?le.checked=!0:le.checked=!1)},1)};ae.hook("after","setupTemplates",()=>{var ne=ae.settings.render.option;ae.settings.render.option=(le,he)=>{var Me=ie(ne.call(ae,le,he)),Ne=document.createElement("input");Ne.addEventListener("click",function(fe){re(fe)}),Ne.type="checkbox";const je=Ee(le[ae.settings.valueField]);return je&&-1<ae.items.indexOf(je)&&(Ne.checked=!0),Me.prepend(Ne),Me}}),ae.on("item_remove",ne=>{var le=ae.getOption(ne);le&&(le.classList.remove("selected"),ee(le))}),ae.on("item_add",ne=>{var le=ae.getOption(ne);le&&ee(le)}),ae.hook("instead","onOptionSelect",(ne,le)=>le.classList.contains("selected")?(le.classList.remove("selected"),ae.removeItem(le.dataset.value),ae.refreshOptions(),void re(ne,!0)):(j.call(ae,ne,le),void ee(le)))}),Ke.define("clear_button",function(ae){const j=this,ee=Object.assign({className:"clear-button",title:"Clear All",html:ne=>`<div class="${ne.className}" title="${ne.title}">&#10799;</div>`},ae);j.on("initialize",()=>{var ne=ie(ee.html(ee));ne.addEventListener("click",le=>{j.isDisabled||(j.clear(),j.settings.mode==="single"&&j.settings.allowEmptyOption&&j.addItem(""),le.preventDefault(),le.stopPropagation())}),j.control.appendChild(ne)})}),Ke.define("drag_drop",function(){var ae=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(ae.settings.mode==="multi"){var j=ae.lock,ee=ae.unlock;ae.hook("instead","lock",()=>{var ne=$(ae.control).data("sortable");return ne&&ne.disable(),j.call(ae)}),ae.hook("instead","unlock",()=>{var ne=$(ae.control).data("sortable");return ne&&ne.enable(),ee.call(ae)}),ae.on("initialize",()=>{var ne=$(ae.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:ae.isLocked,start:(le,he)=>{he.placeholder.css("width",he.helper.css("width")),ne.css({overflow:"visible"})},stop:()=>{ne.css({overflow:"hidden"});var le=[];ne.children("[data-value]").each(function(){this.dataset.value&&le.push(this.dataset.value)}),ae.setValue(le)}})})}}),Ke.define("dropdown_header",function(ae){const j=this,ee=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:ne=>'<div class="'+ne.headerClass+'"><div class="'+ne.titleRowClass+'"><span class="'+ne.labelClass+'">'+ne.title+'</span><a class="'+ne.closeClass+'">&times;</a></div></div>'},ae);j.on("initialize",()=>{var ne=ie(ee.html(ee)),le=ne.querySelector("."+ee.closeClass);le&&le.addEventListener("click",he=>{re(he,!0),j.close()}),j.dropdown.insertBefore(ne,j.dropdown.firstChild)})}),Ke.define("caret_position",function(){var ae=this;ae.hook("instead","setCaret",j=>{ae.settings.mode!=="single"&&ae.control.contains(ae.control_input)?(j=Math.max(0,Math.min(ae.items.length,j)))==ae.caretPos||ae.isPending||ae.controlChildren().forEach((ee,ne)=>{ne<j?ae.control_input.insertAdjacentElement("beforebegin",ee):ae.control.appendChild(ee)}):j=ae.items.length,ae.caretPos=j}),ae.hook("instead","moveCaret",j=>{if(ae.isFocused){const ee=ae.getLastActive(j);if(ee){const ne=qe(ee);ae.setCaret(0<j?ne+1:ne),ae.setActiveItem(),Se(ee,"last-active")}else ae.setCaret(ae.caretPos+j)}})}),Ke.define("dropdown_input",function(){const ae=this;ae.settings.shouldOpen=!0,ae.hook("before","setup",()=>{ae.focus_node=ae.control,we(ae.control_input,"dropdown-input");const j=ie('<div class="dropdown-input-wrap">');j.append(ae.control_input),ae.dropdown.insertBefore(j,ae.dropdown.firstChild);const ee=ie('<input class="items-placeholder" tabindex="-1" />');ee.placeholder=ae.settings.placeholder||"",ae.control.append(ee)}),ae.on("initialize",()=>{ae.control_input.addEventListener("keydown",ee=>{switch(ee.keyCode){case 27:return ae.isOpen&&(re(ee,!0),ae.close()),void ae.clearActiveItems();case 9:ae.focus_node.tabIndex=-1}return ae.onKeyDown.call(ae,ee)}),ae.on("blur",()=>{ae.focus_node.tabIndex=ae.isDisabled?-1:ae.tabIndex}),ae.on("dropdown_open",()=>{ae.control_input.focus()});const j=ae.onBlur;ae.hook("instead","onBlur",ee=>{if(!ee||ee.relatedTarget!=ae.control_input)return j.call(ae)}),ke(ae.control_input,"blur",()=>ae.onBlur()),ae.hook("before","close",()=>{ae.isOpen&&ae.focus_node.focus({preventScroll:!0})})})}),Ke.define("input_autogrow",function(){var ae=this;ae.on("initialize",()=>{var j=document.createElement("span"),ee=ae.control_input;j.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",ae.wrapper.appendChild(j);for(const le of["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"])j.style[le]=ee.style[le];var ne=()=>{j.textContent=ee.value,ee.style.width=j.clientWidth+"px"};ne(),ae.on("update item_add item_remove",ne),ke(ee,"input",ne),ke(ee,"keyup",ne),ke(ee,"blur",ne),ke(ee,"update",ne)})}),Ke.define("no_backspace_delete",function(){var ae=this,j=ae.deleteSelection;this.hook("instead","deleteSelection",ee=>!!ae.activeItems.length&&j.call(ae,ee))}),Ke.define("no_active_items",function(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}),Ke.define("optgroup_columns",function(){var ae=this,j=ae.onKeyDown;ae.hook("instead","onKeyDown",ee=>{var ne,le,he,Me;return ae.isOpen&&(ee.keyCode===37||ee.keyCode===39)?(ae.ignoreHover=!0,Me=$e(ae.activeOption,"[data-group]"),ne=qe(ae.activeOption,"[data-selectable]"),void(Me&&(Me=ee.keyCode===37?Me.previousSibling:Me.nextSibling)&&(le=(he=Me.querySelectorAll("[data-selectable]"))[Math.min(he.length-1,ne)])&&ae.setActiveOption(le))):j.call(ae,ee)})}),Ke.define("remove_button",function(ae){const j=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},ae);var ee=this;if(j.append){var ne='<a href="javascript:void(0)" class="'+j.className+'" tabindex="-1" title="'+Be(j.title)+'">'+j.label+"</a>";ee.hook("after","setupTemplates",()=>{var le=ee.settings.render.item;ee.settings.render.item=(he,Me)=>{var Ne=ie(le.call(ee,he,Me)),je=ie(ne);return Ne.appendChild(je),ke(je,"mousedown",fe=>{re(fe,!0)}),ke(je,"click",fe=>{re(fe,!0),ee.isLocked||ee.shouldDelete([Ne],fe)&&(ee.removeItem(Ne),ee.refreshOptions(!1),ee.inputState())}),Ne}})}}),Ke.define("restore_on_backspace",function(ae){const j=this,ee=Object.assign({text:ne=>ne[j.settings.labelField]},ae);j.on("item_remove",function(ne){if(j.isFocused&&j.control_input.value.trim()===""){var le=j.options[ne];le&&j.setTextboxValue(ee.text.call(j,le))}})}),Ke.define("virtual_scroll",function(){const ae=this,j=ae.canLoad,ee=ae.clearActiveOption,ne=ae.loadCallback;var le,he,Me={},Ne=!1,je=[];if(ae.settings.shouldLoadMore||(ae.settings.shouldLoadMore=()=>{if(.9<le.clientHeight/(le.scrollHeight-le.scrollTop))return!0;if(ae.activeOption){var ye=ae.selectable();if(Array.from(ye).indexOf(ae.activeOption)>=ye.length-2)return!0}return!1}),!ae.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";ae.settings.sortField=[{field:"$order"},{field:"$score"}];const fe=ye=>!(typeof ae.settings.maxOptions=="number"&&le.children.length>=ae.settings.maxOptions)&&ye in Me&&Me[ye],ce=(ye,Pe)=>0<=ae.items.indexOf(Pe)||0<=je.indexOf(Pe);ae.setNextUrl=(ye,Pe)=>{Me[ye]=Pe},ae.getUrl=ye=>{if(ye in Me){const Pe=Me[ye];return Me[ye]=!1,Pe}return Me={},ae.settings.firstUrl.call(ae,ye)},ae.hook("instead","clearActiveOption",()=>{if(!Ne)return ee.call(ae)}),ae.hook("instead","canLoad",ye=>ye in Me?fe(ye):j.call(ae,ye)),ae.hook("instead","loadCallback",(ye,Pe)=>{if(!Ne)ae.clearOptions(ce);else if(he){const Ve=ye[0];Ve!==void 0&&(he.dataset.value=Ve[ae.settings.valueField])}ne.call(ae,ye,Pe),Ne=!1}),ae.hook("after","refreshOptions",()=>{const ye=ae.lastValue;var Pe;fe(ye)?(Pe=ae.render("loading_more",{query:ye}))&&(Pe.setAttribute("data-selectable",""),he=Pe):ye in Me&&!le.querySelector(".no-results")&&(Pe=ae.render("no_more_results",{query:ye})),Pe&&(we(Pe,ae.settings.optionClass),le.append(Pe))}),ae.on("initialize",()=>{je=Object.keys(ae.options),le=ae.dropdown_content,ae.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},ae.settings.render),le.addEventListener("scroll",()=>{ae.settings.shouldLoadMore.call(ae)&&fe(ae.lastValue)&&(Ne||(Ne=!0,ae.load.call(ae,ae.lastValue)))})})}),Ke});if(function(s,e){window.Translator=e()}(void 0,function(){function s(d){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},s(d)}function e(d,u){if(!(d instanceof u))throw new TypeError("Cannot call a class as a function")}function i(d,u){for(var f,m=0;m<u.length;m++)f=u[m],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(d,f.key,f)}function r(d,u){return function(f){if(Array.isArray(f))return f}(d)||function(f,m){var h=f==null?null:typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(h!=null){var _,b,v=[],w=!0,y=!1;try{for(h=h.call(f);!(w=(_=h.next()).done)&&(v.push(_.value),!m||v.length!==m);w=!0);}catch(M){y=!0,b=M}finally{try{w||h.return==null||h.return()}finally{if(y)throw b}}return v}}(d,u)||function(f,m){if(f){if(typeof f=="string")return o(f,m);var h=Object.prototype.toString.call(f).slice(8,-1);return h==="Object"&&f.constructor&&(h=f.constructor.name),h==="Map"||h==="Set"?Array.from(f):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?o(f,m):void 0}}(d,u)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function o(d,u){(u==null||u>d.length)&&(u=d.length);for(var f=0,m=Array(u);f<u;f++)m[f]=d[f];return m}function l(d){return function(u){if(d)try{for(var f=a[u],m=arguments.length,h=Array(1<m?m-1:0),_=1;_<m;_++)h[_-1]=arguments[_];throw new TypeError(f?f.apply(void 0,h):"Unhandled Error")}catch(S){var b=S.stack.split(/\n/g)[1],v=b.split(/@/),w=r(v,2),y=w[0],M=w[1];console.error("".concat(S.message,`

This error happened in the method \``).concat(y,"` from: `").concat(M,`\`.

If you don't want to see these error messages, turn off debugging by passing \`{ debug: false }\` to the constructor.

Error code: `).concat(u,`

Check out the documentation for more details about the API:
https://github.com/andreasremdt/simple-translator#usage
        `))}}}var a={INVALID_PARAM_LANGUAGE:function(d){return"Invalid parameter for `language` provided. Expected a string, but got ".concat(s(d),".")},INVALID_PARAM_JSON:function(d){return"Invalid parameter for `json` provided. Expected an object, but got ".concat(s(d),".")},EMPTY_PARAM_LANGUAGE:function(){return"The parameter for `language` can't be an empty string."},EMPTY_PARAM_JSON:function(){return"The parameter for `json` must have at least one key/value pair."},INVALID_PARAM_KEY:function(d){return"Invalid parameter for `key` provided. Expected a string, but got ".concat(s(d),".")},NO_LANGUAGE_REGISTERED:function(d){return'No translation for language "'.concat(d,'" has been added, yet. Make sure to register that language using the `.add()` method first.')},TRANSLATION_NOT_FOUND:function(d,u){return'No translation found for key "'.concat(d,'" in language "').concat(u,'". Is there a key/value in your translation file?')},INVALID_PARAMETER_SOURCES:function(d){return"Invalid parameter for `sources` provided. Expected either a string or an array, but got ".concat(s(d),".")},FETCH_ERROR:function(d){return'Could not fetch "'.concat(d.url,'": ').concat(d.status," (").concat(d.statusText,")")},INVALID_ENVIRONMENT:function(){return"You are trying to execute the method `translatePageTo()`, which is only available in the browser. Your environment is most likely Node.js"},MODULE_NOT_FOUND:function(d){return d},MISMATCHING_ATTRIBUTES:function(d,u,f){return'The attributes "data-i18n" and "data-i18n-attr" must contain the same number of keys.\n\nValues in `data-i18n`:      ('.concat(d.length,") `").concat(d.join(" "),"`\nValues in `data-i18n-attr`: (").concat(u.length,") `").concat(u.join(" "),`\`

The HTML element is:
`).concat(f.outerHTML)},INVALID_OPTIONS:function(d){return"Invalid config passed to the `Translator` constructor. Expected an object, but got ".concat(s(d),". Using default config instead.")}},c=function(){function d(){var h=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};e(this,d),this.debug=l(!0),(s(h)!="object"||Array.isArray(h))&&(this.debug("INVALID_OPTIONS",h),h={}),this.languages=new Map,this.config=Object.assign(d.defaultConfig,h);var _=this.config,b=_.debug,v=_.registerGlobally,w=_.detectLanguage;this.debug=l(b),v&&(this._globalObject[v]=this.translateForKey.bind(this)),w&&this._env=="browser"&&this._detectLanguage()}var u,f,m;return u=d,f=[{key:"_globalObject",get:function(){return this._env=="browser"?window:global}},{key:"_env",get:function(){return typeof window>"u"&&typeof module<"u"&&module.exports?"node":"browser"}},{key:"_detectLanguage",value:function(){var h=window.localStorage?localStorage.getItem(this.config.persistKey):void 0;if(h)this.config.defaultLanguage=h;else{var _=navigator.languages?navigator.languages[0]:navigator.language;this.config.defaultLanguage=_.substr(0,2)}}},{key:"_getValueFromJSON",value:function(h,_){var b=this.languages.get(_);return h.split(".").reduce(function(v,w){return v?v[w]:null},b)}},{key:"_replace",value:function(h,_){var b,v,w=this,y=(b=h.getAttribute("data-i18n"))===null||b===void 0?void 0:b.split(/\s/g),M=h==null||(v=h.getAttribute("data-i18n-attr"))===null||v===void 0?void 0:v.split(/\s/g);M&&y.length!=M.length&&this.debug("MISMATCHING_ATTRIBUTES",y,M,h),y.forEach(function(S,D){var k=w._getValueFromJSON(S,_),O=M?M[D]:"innerHTML";k?O=="innerHTML"?h[O]=k:h.setAttribute(O,k):w.debug("TRANSLATION_NOT_FOUND",S,_)})}},{key:"translatePageTo",value:function(){var h=this,_=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.config.defaultLanguage;if(this._env=="node")this.debug("INVALID_ENVIRONMENT");else if(typeof _!="string")this.debug("INVALID_PARAM_LANGUAGE",_);else if(_.length==0)this.debug("EMPTY_PARAM_LANGUAGE");else if(this.languages.has(_)){var b=typeof this.config.selector=="string"?Array.from(document.querySelectorAll(this.config.selector)):this.config.selector;b.length&&0<b.length?b.forEach(function(v){return h._replace(v,_)}):b.length==null&&this._replace(b,_),this._currentLanguage=_,document.documentElement.lang=_,this.config.persist&&window.localStorage&&localStorage.setItem(this.config.persistKey,_)}else this.debug("NO_LANGUAGE_REGISTERED",_)}},{key:"translateForKey",value:function(h){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.config.defaultLanguage;if(typeof h!="string")return this.debug("INVALID_PARAM_KEY",h),null;if(!this.languages.has(_))return this.debug("NO_LANGUAGE_REGISTERED",_),null;var b=this._getValueFromJSON(h,_);return b||(this.debug("TRANSLATION_NOT_FOUND",h,_),null)}},{key:"add",value:function(h,_){return typeof h=="string"?h.length==0?(this.debug("EMPTY_PARAM_LANGUAGE"),this):Array.isArray(_)||s(_)!="object"?(this.debug("INVALID_PARAM_JSON",_),this):Object.keys(_).length==0?(this.debug("EMPTY_PARAM_JSON"),this):(this.languages.set(h,_),this):(this.debug("INVALID_PARAM_LANGUAGE",h),this)}},{key:"remove",value:function(h){return typeof h=="string"?h.length==0?(this.debug("EMPTY_PARAM_LANGUAGE"),this):(this.languages.delete(h),this):(this.debug("INVALID_PARAM_LANGUAGE",h),this)}},{key:"fetch",value:function(h){function _(b){return h.apply(this,arguments)}return _.toString=function(){return h.toString()},_}(function(h){var _=this,b=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(h)&&typeof h!="string")return this.debug("INVALID_PARAMETER_SOURCES",h),null;Array.isArray(h)||(h=[h]);var v=h.map(function(w){var y=w.replace(/\.json$/,"").replace(/^\//,""),M=_.config.filesLocation.replace(/\/$/,"");return"".concat(M,"/").concat(y,".json")});return this._env=="browser"?Promise.all(v.map(function(w){return fetch(w)})).then(function(w){return Promise.all(w.map(function(y){return y.ok?y.json():void _.debug("FETCH_ERROR",y)}))}).then(function(w){return w=w.filter(function(y){return y}),b&&w.forEach(function(y,M){_.add(h[M],y)}),1<w.length?w:w[0]}):this._env=="node"?new Promise(function(w){var y=[];v.forEach(function(M,S){try{var D=JSON.parse(require("fs").readFileSync(process.cwd()+M,"utf-8"));b&&_.add(h[S],D),y.push(D)}catch(k){_.debug("MODULE_NOT_FOUND",k.message)}}),w(1<y.length?y:y[0])}):void 0})},{key:"setDefaultLanguage",value:function(h){if(typeof h=="string"){if(h.length!=0)return this.languages.has(h)?void(this.config.defaultLanguage=h):(this.debug("NO_LANGUAGE_REGISTERED",h),null);this.debug("EMPTY_PARAM_LANGUAGE")}else this.debug("INVALID_PARAM_LANGUAGE",h)}},{key:"currentLanguage",get:function(){return this._currentLanguage||this.config.defaultLanguage}},{key:"defaultLanguage",get:function(){return this.config.defaultLanguage}}],m=[{key:"defaultConfig",get:function(){return{defaultLanguage:"en",detectLanguage:!0,selector:"[data-i18n]",debug:!1,registerGlobally:"__",persist:!1,persistKey:"preferred_language",filesLocation:"/i18n"}}}],f&&i(u.prototype,f),m&&i(u,m),d}();return c}),window.ChangeTranslator==null){const s=new Translator({filesLocation:"./ddd/i18n",defaultLanguage:"en"}),e={};window.T=i=>{const r=localStorage.language??navigator.language;return s.translateForKey(i,r)},window.ChangeTranslator=async function(i=null,r=!0){if(i==null&&(i=localStorage.language??navigator.language.split("-")[0]),!e[i]){async function o(l){try{return await s.fetch([l]),window.debug,e[l]=!0,!0}catch{console.warn(l,"not found i18n file.")}return!1}await o(i)||await o("en")}r&&s.translatePageTo(i),localStorage.language=i,window.__prepared__translator__=!0},document.readyState==="interactive"||document.readyState==="complete"?await window.ChangeTranslator():document.addEventListener("DOMContentLoaded",async()=>{await window.ChangeTranslator()})}const REVISION="165",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format$1=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format$1=33778,RGBA_S3TC_DXT5_Format$1=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format$1=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",DisplayP3ColorSpace="display-p3",LinearDisplayP3ColorSpace="display-p3-linear",LinearTransfer="linear",SRGBTransfer="srgb",Rec709Primaries="rec709",P3Primaries="p3",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const o=this._listeners[e];if(o!==void 0){const l=o.indexOf(i);l!==-1&&o.splice(l,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const o=r.slice(0);for(let l=0,a=o.length;l<a;l++)o[l].call(this,e);e.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(_lut[s&255]+_lut[s>>8&255]+_lut[s>>16&255]+_lut[s>>24&255]+"-"+_lut[e&255]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[i&63|128]+_lut[i>>8&255]+"-"+_lut[i>>16&255]+_lut[i>>24&255]+_lut[r&255]+_lut[r>>8&255]+_lut[r>>16&255]+_lut[r>>24&255]).toLowerCase().replace(/-/g,"")}function generateShortID(s=26){const e=[],i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<s;++r)e.push(i[Math.floor(Math.random()*i.length)]);return e.join("")}function clamp(s,e,i){return Math.max(e,Math.min(i,s))}function euclideanModulo(s,e){return(s%e+e)%e}function mapLinear(s,e,i,r,o){return r+(s-e)*(o-r)/(i-e)}function inverseLerp(s,e,i){return s!==e?(i-s)/(e-s):0}function lerp(s,e,i){return(1-i)*s+i*e}function damp(s,e,i,r){return lerp(s,e,1-Math.exp(-i*r))}function pingpong(s,e=1){return e-Math.abs(euclideanModulo(s,e*2)-e)}function smoothstep(s,e,i){return s<=e?0:s>=i?1:(s=(s-e)/(i-e),s*s*(3-2*s))}function smootherstep(s,e,i){return s<=e?0:s>=i?1:(s=(s-e)/(i-e),s*s*s*(s*(s*6-15)+10))}function randInt(s,e){return s+Math.floor(Math.random()*(e-s+1))}function randFloat(s,e){return s+Math.random()*(e-s)}function randFloatSpread(s){return s*(.5-Math.random())}function seededRandom(s){s!==void 0&&(_seed=s);let e=_seed+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function degToRad(s){return s*DEG2RAD}function radToDeg(s){return s*RAD2DEG}function isPowerOfTwo(s){return(s&s-1)===0&&s!==0}function ceilPowerOfTwo(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function floorPowerOfTwo(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function setQuaternionFromProperEuler(s,e,i,r,o){const l=Math.cos,a=Math.sin,c=l(i/2),d=a(i/2),u=l((e+r)/2),f=a((e+r)/2),m=l((e-r)/2),h=a((e-r)/2),_=l((r-e)/2),b=a((r-e)/2);switch(o){case"XYX":s.set(c*f,d*m,d*h,c*u);break;case"YZY":s.set(d*h,c*f,d*m,c*u);break;case"ZXZ":s.set(d*m,d*h,c*f,c*u);break;case"XZX":s.set(c*f,d*b,d*_,c*u);break;case"YXY":s.set(d*_,c*f,d*b,c*u);break;case"ZYZ":s.set(d*b,d*_,c*f,c*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}function denormalize(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function normalize(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(e=0,i=0){Vector2.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,r=this.y,o=e.elements;return this.x=o[0]*i+o[3]*r+o[6],this.y=o[1]*i+o[4]*r+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(clamp(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const r=Math.cos(i),o=Math.sin(i),l=this.x-e.x,a=this.y-e.y;return this.x=l*r-a*o+e.x,this.y=l*o+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(e,i,r,o,l,a,c,d,u){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,r,o,l,a,c,d,u)}set(e,i,r,o,l,a,c,d,u){const f=this.elements;return f[0]=e,f[1]=o,f[2]=c,f[3]=i,f[4]=l,f[5]=d,f[6]=r,f[7]=a,f[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,o=i.elements,l=this.elements,a=r[0],c=r[3],d=r[6],u=r[1],f=r[4],m=r[7],h=r[2],_=r[5],b=r[8],v=o[0],w=o[3],y=o[6],M=o[1],S=o[4],D=o[7],k=o[2],O=o[5],L=o[8];return l[0]=a*v+c*M+d*k,l[3]=a*w+c*S+d*O,l[6]=a*y+c*D+d*L,l[1]=u*v+f*M+m*k,l[4]=u*w+f*S+m*O,l[7]=u*y+f*D+m*L,l[2]=h*v+_*M+b*k,l[5]=h*w+_*S+b*O,l[8]=h*y+_*D+b*L,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[1],o=e[2],l=e[3],a=e[4],c=e[5],d=e[6],u=e[7],f=e[8];return i*a*f-i*c*u-r*l*f+r*c*d+o*l*u-o*a*d}invert(){const e=this.elements,i=e[0],r=e[1],o=e[2],l=e[3],a=e[4],c=e[5],d=e[6],u=e[7],f=e[8],m=f*a-c*u,h=c*d-f*l,_=u*l-a*d,b=i*m+r*h+o*_;if(b===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/b;return e[0]=m*v,e[1]=(o*u-f*r)*v,e[2]=(c*r-o*a)*v,e[3]=h*v,e[4]=(f*i-o*d)*v,e[5]=(o*l-c*i)*v,e[6]=_*v,e[7]=(r*d-u*i)*v,e[8]=(a*i-r*l)*v,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,o,l,a,c){const d=Math.cos(l),u=Math.sin(l);return this.set(r*d,r*u,-r*(d*a+u*c)+a+e,-o*u,o*d,-o*(-u*a+d*c)+c+i,0,0,1),this}scale(e,i){return this.premultiply(_m3.makeScale(e,i)),this}rotate(e){return this.premultiply(_m3.makeRotation(-e)),this}translate(e,i){return this.premultiply(_m3.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,r=e.elements;for(let o=0;o<9;o++)if(i[o]!==r[o])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(s,e){return new TYPED_ARRAYS[s](e)}function createElementNS(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function createCanvasElement(){const s=createElementNS("canvas");return s.style.display="block",s}const _cache={};function warnOnce(s){s in _cache||(_cache[s]=!0,console.warn(s))}function probeAsync(s,e,i){return new Promise(function(r,o){function l(){switch(s.clientWaitSync(e,s.SYNC_FLUSH_COMMANDS_BIT,0)){case s.WAIT_FAILED:o();break;case s.TIMEOUT_EXPIRED:setTimeout(l,i);break;default:r()}}setTimeout(l,i)})}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=new Matrix3().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=new Matrix3().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),COLOR_SPACES={[LinearSRGBColorSpace]:{transfer:LinearTransfer,primaries:Rec709Primaries,toReference:s=>s,fromReference:s=>s},[SRGBColorSpace]:{transfer:SRGBTransfer,primaries:Rec709Primaries,toReference:s=>s.convertSRGBToLinear(),fromReference:s=>s.convertLinearToSRGB()},[LinearDisplayP3ColorSpace]:{transfer:LinearTransfer,primaries:P3Primaries,toReference:s=>s.applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:s=>s.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3)},[DisplayP3ColorSpace]:{transfer:SRGBTransfer,primaries:P3Primaries,toReference:s=>s.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:s=>s.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}},SUPPORTED_WORKING_COLOR_SPACES=new Set([LinearSRGBColorSpace,LinearDisplayP3ColorSpace]),ColorManagement={enabled:!0,_workingColorSpace:LinearSRGBColorSpace,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(s){if(!SUPPORTED_WORKING_COLOR_SPACES.has(s))throw new Error(`Unsupported working color space, "${s}".`);this._workingColorSpace=s},convert:function(s,e,i){if(this.enabled===!1||e===i||!e||!i)return s;const r=COLOR_SPACES[e].toReference,o=COLOR_SPACES[i].fromReference;return o(r(s))},fromWorkingColorSpace:function(s,e){return this.convert(s,this._workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this._workingColorSpace)},getPrimaries:function(s){return COLOR_SPACES[s].primaries},getTransfer:function(s){return s===NoColorSpace?LinearTransfer:COLOR_SPACES[s].transfer}};function SRGBToLinear(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function LinearToSRGB(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=e.width,_canvas.height=e.height;const r=_canvas.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=_canvas}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=createElementNS("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const o=r.getImageData(0,0,e.width,e.height),l=o.data;for(let a=0;a<l.length;a++)l[a]=SRGBToLinear(l[a]/255)*255;return r.putImageData(o,0,0),i}else if(e.data){const i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(SRGBToLinear(i[r]/255)*255):i[r]=SRGBToLinear(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let _sourceId=0;class Source{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},o=this.data;if(o!==null){let l;if(Array.isArray(o)){l=[];for(let a=0,c=o.length;a<c;a++)o[a].isDataTexture?l.push(serializeImage(o[a].image)):l.push(serializeImage(o[a]))}else l=serializeImage(o);r.url=l}return i||(e.images[this.uuid]=r),r}}function serializeImage(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?ImageUtils.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,i=Texture.DEFAULT_MAPPING,r=ClampToEdgeWrapping,o=ClampToEdgeWrapping,l=LinearFilter,a=LinearMipmapLinearFilter,c=RGBAFormat,d=UnsignedByteType,u=Texture.DEFAULT_ANISOTROPY,f=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=o,this.magFilter=l,this.minFilter=a,this.anisotropy=u,this.format=c,this.internalFormat=null,this.type=d,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0,this.source_file=null}get width(){return this.source.data?.naturalWidth||this.source.data?.width}get height(){return this.source.data?.naturalHeight||this.source.data?.height}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this.source_file=e.source_file,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment,source_file:this.source_file};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(e=0,i=0,r=0,o=1){Vector4.prototype.isVector4=!0,this.x=e,this.y=i,this.z=r,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,o){return this.x=e,this.y=i,this.z=r,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,r=this.y,o=this.z,l=this.w,a=e.elements;return this.x=a[0]*i+a[4]*r+a[8]*o+a[12]*l,this.y=a[1]*i+a[5]*r+a[9]*o+a[13]*l,this.z=a[2]*i+a[6]*r+a[10]*o+a[14]*l,this.w=a[3]*i+a[7]*r+a[11]*o+a[15]*l,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,o,l;const d=e.elements,u=d[0],f=d[4],m=d[8],h=d[1],_=d[5],b=d[9],v=d[2],w=d[6],y=d[10];if(Math.abs(f-h)<.01&&Math.abs(m-v)<.01&&Math.abs(b-w)<.01){if(Math.abs(f+h)<.1&&Math.abs(m+v)<.1&&Math.abs(b+w)<.1&&Math.abs(u+_+y-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const S=(u+1)/2,D=(_+1)/2,k=(y+1)/2,O=(f+h)/4,L=(m+v)/4,P=(b+w)/4;return S>D&&S>k?S<.01?(r=0,o=.707106781,l=.707106781):(r=Math.sqrt(S),o=O/r,l=L/r):D>k?D<.01?(r=.707106781,o=0,l=.707106781):(o=Math.sqrt(D),r=O/o,l=P/o):k<.01?(r=.707106781,o=.707106781,l=0):(l=Math.sqrt(k),r=L/l,o=P/l),this.set(r,o,l,i),this}let M=Math.sqrt((w-b)*(w-b)+(m-v)*(m-v)+(h-f)*(h-f));return Math.abs(M)<.001&&(M=1),this.x=(w-b)/M,this.y=(m-v)/M,this.z=(h-f)/M,this.w=Math.acos((u+_+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(e=1,i=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new Vector4(0,0,e,i),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,i);const o={width:e,height:i,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const l=new Texture(o,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);l.flipY=!1,l.generateMipmaps=r.generateMipmaps,l.internalFormat=r.internalFormat,this.textures=[];const a=r.count;for(let c=0;c<a;c++)this.textures[c]=l.clone(),this.textures[c].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,r=1){if(this.width!==e||this.height!==i||this.depth!==r){this.width=e,this.height=i,this.depth=r;for(let o=0,l=this.textures.length;o<l;o++)this.textures[o].image.width=e,this.textures[o].image.height=i,this.textures[o].image.depth=r;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,o=e.textures.length;r<o;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new Source(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(e=1,i=1,r={}){super(e,i,r),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(e=null,i=1,r=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:r,depth:o},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(e=1,i=1,r=1,o={}){super(e,i,o),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new DataArrayTexture(null,e,i,r),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(e=null,i=1,r=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:r,depth:o},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(e=1,i=1,r=1,o={}){super(e,i,o),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new Data3DTexture(null,e,i,r),this.texture.isRenderTargetTexture=!0}}class Quaternion{constructor(e=0,i=0,r=0,o=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=r,this._w=o}static slerpFlat(e,i,r,o,l,a,c){let d=r[o+0],u=r[o+1],f=r[o+2],m=r[o+3];const h=l[a+0],_=l[a+1],b=l[a+2],v=l[a+3];if(c===0){e[i+0]=d,e[i+1]=u,e[i+2]=f,e[i+3]=m;return}if(c===1){e[i+0]=h,e[i+1]=_,e[i+2]=b,e[i+3]=v;return}if(m!==v||d!==h||u!==_||f!==b){let w=1-c;const y=d*h+u*_+f*b+m*v,M=y>=0?1:-1,S=1-y*y;if(S>Number.EPSILON){const k=Math.sqrt(S),O=Math.atan2(k,y*M);w=Math.sin(w*O)/k,c=Math.sin(c*O)/k}const D=c*M;if(d=d*w+h*D,u=u*w+_*D,f=f*w+b*D,m=m*w+v*D,w===1-c){const k=1/Math.sqrt(d*d+u*u+f*f+m*m);d*=k,u*=k,f*=k,m*=k}}e[i]=d,e[i+1]=u,e[i+2]=f,e[i+3]=m}static multiplyQuaternionsFlat(e,i,r,o,l,a){const c=r[o],d=r[o+1],u=r[o+2],f=r[o+3],m=l[a],h=l[a+1],_=l[a+2],b=l[a+3];return e[i]=c*b+f*m+d*_-u*h,e[i+1]=d*b+f*h+u*m-c*_,e[i+2]=u*b+f*_+c*h-d*m,e[i+3]=f*b-c*m-d*h-u*_,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,o){return this._x=e,this._y=i,this._z=r,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const r=e._x,o=e._y,l=e._z,a=e._order,c=Math.cos,d=Math.sin,u=c(r/2),f=c(o/2),m=c(l/2),h=d(r/2),_=d(o/2),b=d(l/2);switch(a){case"XYZ":this._x=h*f*m+u*_*b,this._y=u*_*m-h*f*b,this._z=u*f*b+h*_*m,this._w=u*f*m-h*_*b;break;case"YXZ":this._x=h*f*m+u*_*b,this._y=u*_*m-h*f*b,this._z=u*f*b-h*_*m,this._w=u*f*m+h*_*b;break;case"ZXY":this._x=h*f*m-u*_*b,this._y=u*_*m+h*f*b,this._z=u*f*b+h*_*m,this._w=u*f*m-h*_*b;break;case"ZYX":this._x=h*f*m-u*_*b,this._y=u*_*m+h*f*b,this._z=u*f*b-h*_*m,this._w=u*f*m+h*_*b;break;case"YZX":this._x=h*f*m+u*_*b,this._y=u*_*m+h*f*b,this._z=u*f*b-h*_*m,this._w=u*f*m-h*_*b;break;case"XZY":this._x=h*f*m-u*_*b,this._y=u*_*m-h*f*b,this._z=u*f*b+h*_*m,this._w=u*f*m+h*_*b;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const r=i/2,o=Math.sin(r);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,r=i[0],o=i[4],l=i[8],a=i[1],c=i[5],d=i[9],u=i[2],f=i[6],m=i[10],h=r+c+m;if(h>0){const _=.5/Math.sqrt(h+1);this._w=.25/_,this._x=(f-d)*_,this._y=(l-u)*_,this._z=(a-o)*_}else if(r>c&&r>m){const _=2*Math.sqrt(1+r-c-m);this._w=(f-d)/_,this._x=.25*_,this._y=(o+a)/_,this._z=(l+u)/_}else if(c>m){const _=2*Math.sqrt(1+c-r-m);this._w=(l-u)/_,this._x=(o+a)/_,this._y=.25*_,this._z=(d+f)/_}else{const _=2*Math.sqrt(1+m-r-c);this._w=(a-o)/_,this._x=(l+u)/_,this._y=(d+f)/_,this._z=.25*_}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp(this.dot(e),-1,1)))}rotateTowards(e,i){const r=this.angleTo(e);if(r===0)return this;const o=Math.min(1,i/r);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const r=e._x,o=e._y,l=e._z,a=e._w,c=i._x,d=i._y,u=i._z,f=i._w;return this._x=r*f+a*c+o*u-l*d,this._y=o*f+a*d+l*c-r*u,this._z=l*f+a*u+r*d-o*c,this._w=a*f-r*c-o*d-l*u,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const r=this._x,o=this._y,l=this._z,a=this._w;let c=a*e._w+r*e._x+o*e._y+l*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=a,this._x=r,this._y=o,this._z=l,this;const d=1-c*c;if(d<=Number.EPSILON){const _=1-i;return this._w=_*a+i*this._w,this._x=_*r+i*this._x,this._y=_*o+i*this._y,this._z=_*l+i*this._z,this.normalize(),this}const u=Math.sqrt(d),f=Math.atan2(u,c),m=Math.sin((1-i)*f)/u,h=Math.sin(i*f)/u;return this._w=a*m+this._w*h,this._x=r*m+this._x*h,this._y=o*m+this._y*h,this._z=l*m+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),r=Math.random(),o=Math.sqrt(1-r),l=Math.sqrt(r);return this.set(o*Math.sin(e),o*Math.cos(e),l*Math.sin(i),l*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(e=0,i=0,r=0){Vector3.prototype.isVector3=!0,this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(_quaternion$5.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(_quaternion$5.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,r=this.y,o=this.z,l=e.elements;return this.x=l[0]*i+l[3]*r+l[6]*o,this.y=l[1]*i+l[4]*r+l[7]*o,this.z=l[2]*i+l[5]*r+l[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,r=this.y,o=this.z,l=e.elements,a=1/(l[3]*i+l[7]*r+l[11]*o+l[15]);return this.x=(l[0]*i+l[4]*r+l[8]*o+l[12])*a,this.y=(l[1]*i+l[5]*r+l[9]*o+l[13])*a,this.z=(l[2]*i+l[6]*r+l[10]*o+l[14])*a,this}applyQuaternion(e){const i=this.x,r=this.y,o=this.z,l=e.x,a=e.y,c=e.z,d=e.w,u=2*(a*o-c*r),f=2*(c*i-l*o),m=2*(l*r-a*i);return this.x=i+d*u+a*m-c*f,this.y=r+d*f+c*u-l*m,this.z=o+d*m+l*f-a*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,r=this.y,o=this.z,l=e.elements;return this.x=l[0]*i+l[4]*r+l[8]*o,this.y=l[1]*i+l[5]*r+l[9]*o,this.z=l[2]*i+l[6]*r+l[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const r=e.x,o=e.y,l=e.z,a=i.x,c=i.y,d=i.z;return this.x=o*d-l*c,this.y=l*a-r*d,this.z=r*c-o*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return _vector$e.copy(this).projectOnVector(e),this.sub(_vector$e)}reflect(e){return this.sub(_vector$e.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(clamp(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y,o=this.z-e.z;return i*i+r*r+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){const o=Math.sin(i)*e;return this.x=o*Math.sin(r),this.y=Math.cos(i)*e,this.z=o*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=o,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(e),this.y=i,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$e=new Vector3,_quaternion$5=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),i=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i+=3)this.expandByPoint(_vector$d.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,r=e.count;i<r;i++)this.expandByPoint(_vector$d.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=_vector$d.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const l=r.getAttribute("position");if(i===!0&&l!==void 0&&e.isInstancedMesh!==!0)for(let a=0,c=l.count;a<c;a++)e.isMesh===!0?e.getVertexPosition(a,_vector$d):_vector$d.fromBufferAttribute(l,a),_vector$d.applyMatrix4(e.matrixWorld),this.expandByPoint(_vector$d);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),_box$4.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),_box$4.copy(r.boundingBox)),_box$4.applyMatrix4(e.matrixWorld),this.union(_box$4)}const o=e.children;for(let l=0,a=o.length;l<a;l++)this.expandByObject(o[l],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,_vector$d),_vector$d.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(e.a,_center),_v1$8.subVectors(e.b,_center),_v2$5.subVectors(e.c,_center),_f0.subVectors(_v1$8,_v0$2),_f1.subVectors(_v2$5,_v1$8),_f2.subVectors(_v0$2,_v2$5);let i=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(i,_v0$2,_v1$8,_v2$5,_extents)||(i=[1,0,0,0,1,0,0,0,1],!satForAxes(i,_v0$2,_v1$8,_v2$5,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),i=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(i,_v0$2,_v1$8,_v2$5,_extents))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_vector$d).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_vector$d).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$d=new Vector3,_box$4=new Box3,_v0$2=new Vector3,_v1$8=new Vector3,_v2$5=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(s,e,i,r,o){for(let l=0,a=s.length-3;l<=a;l+=3){_testAxis.fromArray(s,l);const c=o.x*Math.abs(_testAxis.x)+o.y*Math.abs(_testAxis.y)+o.z*Math.abs(_testAxis.z),d=e.dot(_testAxis),u=i.dot(_testAxis),f=r.dot(_testAxis);if(Math.max(-Math.max(d,u,f),Math.min(d,u,f))>c)return!1}return!0}const _box$3=new Box3,_v1$7=new Vector3,_v2$4=new Vector3;class Sphere{constructor(e=new Vector3,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const r=this.center;i!==void 0?r.copy(i):_box$3.setFromPoints(e).getCenter(r);let o=0;for(let l=0,a=e.length;l<a;l++)o=Math.max(o,r.distanceToSquared(e[l]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_v1$7.subVectors(e,this.center);const i=_v1$7.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),o=(r-this.radius)*.5;this.center.addScaledVector(_v1$7,o/r),this.radius+=o}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(_v2$4.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_v1$7.copy(e.center).add(_v2$4)),this.expandByPoint(_v1$7.copy(e.center).sub(_v2$4))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$c=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(e=new Vector3,i=new Vector3(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_vector$c)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=_vector$c.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(_vector$c.copy(this.origin).addScaledVector(this.direction,i),_vector$c.distanceToSquared(e))}distanceSqToSegment(e,i,r,o){_segCenter.copy(e).add(i).multiplyScalar(.5),_segDir.copy(i).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);const l=e.distanceTo(i)*.5,a=-this.direction.dot(_segDir),c=_diff.dot(this.direction),d=-_diff.dot(_segDir),u=_diff.lengthSq(),f=Math.abs(1-a*a);let m,h,_,b;if(f>0)if(m=a*d-c,h=a*c-d,b=l*f,m>=0)if(h>=-b)if(h<=b){const v=1/f;m*=v,h*=v,_=m*(m+a*h+2*c)+h*(a*m+h+2*d)+u}else h=l,m=Math.max(0,-(a*h+c)),_=-m*m+h*(h+2*d)+u;else h=-l,m=Math.max(0,-(a*h+c)),_=-m*m+h*(h+2*d)+u;else h<=-b?(m=Math.max(0,-(-a*l+c)),h=m>0?-l:Math.min(Math.max(-l,-d),l),_=-m*m+h*(h+2*d)+u):h<=b?(m=0,h=Math.min(Math.max(-l,-d),l),_=h*(h+2*d)+u):(m=Math.max(0,-(a*l+c)),h=m>0?l:Math.min(Math.max(-l,-d),l),_=-m*m+h*(h+2*d)+u);else h=a>0?-l:l,m=Math.max(0,-(a*h+c)),_=-m*m+h*(h+2*d)+u;return r&&r.copy(this.origin).addScaledVector(this.direction,m),o&&o.copy(_segCenter).addScaledVector(_segDir,h),_}intersectSphere(e,i){_vector$c.subVectors(e.center,this.origin);const r=_vector$c.dot(this.direction),o=_vector$c.dot(_vector$c)-r*r,l=e.radius*e.radius;if(o>l)return null;const a=Math.sqrt(l-o),c=r-a,d=r+a;return d<0?null:c<0?this.at(d,i):this.at(c,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){const r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,o,l,a,c,d;const u=1/this.direction.x,f=1/this.direction.y,m=1/this.direction.z,h=this.origin;return u>=0?(r=(e.min.x-h.x)*u,o=(e.max.x-h.x)*u):(r=(e.max.x-h.x)*u,o=(e.min.x-h.x)*u),f>=0?(l=(e.min.y-h.y)*f,a=(e.max.y-h.y)*f):(l=(e.max.y-h.y)*f,a=(e.min.y-h.y)*f),r>a||l>o||((l>r||isNaN(r))&&(r=l),(a<o||isNaN(o))&&(o=a),m>=0?(c=(e.min.z-h.z)*m,d=(e.max.z-h.z)*m):(c=(e.max.z-h.z)*m,d=(e.min.z-h.z)*m),r>d||c>o)||((c>r||r!==r)&&(r=c),(d<o||o!==o)&&(o=d),o<0)?null:this.at(r>=0?r:o,i)}intersectsBox(e){return this.intersectBox(e,_vector$c)!==null}intersectTriangle(e,i,r,o,l){_edge1.subVectors(i,e),_edge2.subVectors(r,e),_normal$1.crossVectors(_edge1,_edge2);let a=this.direction.dot(_normal$1),c;if(a>0){if(o)return null;c=1}else if(a<0)c=-1,a=-a;else return null;_diff.subVectors(this.origin,e);const d=c*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(d<0)return null;const u=c*this.direction.dot(_edge1.cross(_diff));if(u<0||d+u>a)return null;const f=-c*_diff.dot(_normal$1);return f<0?null:this.at(f/a,l)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Matrix4{constructor(e,i,r,o,l,a,c,d,u,f,m,h,_,b,v,w){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,r,o,l,a,c,d,u,f,m,h,_,b,v,w)}set(e,i,r,o,l,a,c,d,u,f,m,h,_,b,v,w){const y=this.elements;return y[0]=e,y[4]=i,y[8]=r,y[12]=o,y[1]=l,y[5]=a,y[9]=c,y[13]=d,y[2]=u,y[6]=f,y[10]=m,y[14]=h,y[3]=_,y[7]=b,y[11]=v,y[15]=w,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){const i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,r=e.elements,o=1/_v1$6.setFromMatrixColumn(e,0).length(),l=1/_v1$6.setFromMatrixColumn(e,1).length(),a=1/_v1$6.setFromMatrixColumn(e,2).length();return i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i[3]=0,i[4]=r[4]*l,i[5]=r[5]*l,i[6]=r[6]*l,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,r=e.x,o=e.y,l=e.z,a=Math.cos(r),c=Math.sin(r),d=Math.cos(o),u=Math.sin(o),f=Math.cos(l),m=Math.sin(l);if(e.order==="XYZ"){const h=a*f,_=a*m,b=c*f,v=c*m;i[0]=d*f,i[4]=-d*m,i[8]=u,i[1]=_+b*u,i[5]=h-v*u,i[9]=-c*d,i[2]=v-h*u,i[6]=b+_*u,i[10]=a*d}else if(e.order==="YXZ"){const h=d*f,_=d*m,b=u*f,v=u*m;i[0]=h+v*c,i[4]=b*c-_,i[8]=a*u,i[1]=a*m,i[5]=a*f,i[9]=-c,i[2]=_*c-b,i[6]=v+h*c,i[10]=a*d}else if(e.order==="ZXY"){const h=d*f,_=d*m,b=u*f,v=u*m;i[0]=h-v*c,i[4]=-a*m,i[8]=b+_*c,i[1]=_+b*c,i[5]=a*f,i[9]=v-h*c,i[2]=-a*u,i[6]=c,i[10]=a*d}else if(e.order==="ZYX"){const h=a*f,_=a*m,b=c*f,v=c*m;i[0]=d*f,i[4]=b*u-_,i[8]=h*u+v,i[1]=d*m,i[5]=v*u+h,i[9]=_*u-b,i[2]=-u,i[6]=c*d,i[10]=a*d}else if(e.order==="YZX"){const h=a*d,_=a*u,b=c*d,v=c*u;i[0]=d*f,i[4]=v-h*m,i[8]=b*m+_,i[1]=m,i[5]=a*f,i[9]=-c*f,i[2]=-u*f,i[6]=_*m+b,i[10]=h-v*m}else if(e.order==="XZY"){const h=a*d,_=a*u,b=c*d,v=c*u;i[0]=d*f,i[4]=-m,i[8]=u*f,i[1]=h*m+v,i[5]=a*f,i[9]=_*m-b,i[2]=b*m-_,i[6]=c*f,i[10]=v*m+h}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,i,r){const o=this.elements;return _z.subVectors(e,i),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),_x.lengthSq()===0&&(Math.abs(r.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),o[0]=_x.x,o[4]=_y.x,o[8]=_z.x,o[1]=_x.y,o[5]=_y.y,o[9]=_z.y,o[2]=_x.z,o[6]=_y.z,o[10]=_z.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,o=i.elements,l=this.elements,a=r[0],c=r[4],d=r[8],u=r[12],f=r[1],m=r[5],h=r[9],_=r[13],b=r[2],v=r[6],w=r[10],y=r[14],M=r[3],S=r[7],D=r[11],k=r[15],O=o[0],L=o[4],P=o[8],N=o[12],z=o[1],K=o[5],Z=o[9],V=o[13],H=o[2],Y=o[6],q=o[10],J=o[14],W=o[3],te=o[7],ie=o[11],oe=o[15];return l[0]=a*O+c*z+d*H+u*W,l[4]=a*L+c*K+d*Y+u*te,l[8]=a*P+c*Z+d*q+u*ie,l[12]=a*N+c*V+d*J+u*oe,l[1]=f*O+m*z+h*H+_*W,l[5]=f*L+m*K+h*Y+_*te,l[9]=f*P+m*Z+h*q+_*ie,l[13]=f*N+m*V+h*J+_*oe,l[2]=b*O+v*z+w*H+y*W,l[6]=b*L+v*K+w*Y+y*te,l[10]=b*P+v*Z+w*q+y*ie,l[14]=b*N+v*V+w*J+y*oe,l[3]=M*O+S*z+D*H+k*W,l[7]=M*L+S*K+D*Y+k*te,l[11]=M*P+S*Z+D*q+k*ie,l[15]=M*N+S*V+D*J+k*oe,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[4],o=e[8],l=e[12],a=e[1],c=e[5],d=e[9],u=e[13],f=e[2],m=e[6],h=e[10],_=e[14],b=e[3],v=e[7],w=e[11],y=e[15];return b*(+l*d*m-o*u*m-l*c*h+r*u*h+o*c*_-r*d*_)+v*(+i*d*_-i*u*h+l*a*h-o*a*_+o*u*f-l*d*f)+w*(+i*u*m-i*c*_-l*a*m+r*a*_+l*c*f-r*u*f)+y*(-o*c*f-i*d*m+i*c*h+o*a*m-r*a*h+r*d*f)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=i,o[14]=r),this}invert(){const e=this.elements,i=e[0],r=e[1],o=e[2],l=e[3],a=e[4],c=e[5],d=e[6],u=e[7],f=e[8],m=e[9],h=e[10],_=e[11],b=e[12],v=e[13],w=e[14],y=e[15],M=m*w*u-v*h*u+v*d*_-c*w*_-m*d*y+c*h*y,S=b*h*u-f*w*u-b*d*_+a*w*_+f*d*y-a*h*y,D=f*v*u-b*m*u+b*c*_-a*v*_-f*c*y+a*m*y,k=b*m*d-f*v*d-b*c*h+a*v*h+f*c*w-a*m*w,O=i*M+r*S+o*D+l*k;if(O===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const L=1/O;return e[0]=M*L,e[1]=(v*h*l-m*w*l-v*o*_+r*w*_+m*o*y-r*h*y)*L,e[2]=(c*w*l-v*d*l+v*o*u-r*w*u-c*o*y+r*d*y)*L,e[3]=(m*d*l-c*h*l-m*o*u+r*h*u+c*o*_-r*d*_)*L,e[4]=S*L,e[5]=(f*w*l-b*h*l+b*o*_-i*w*_-f*o*y+i*h*y)*L,e[6]=(b*d*l-a*w*l-b*o*u+i*w*u+a*o*y-i*d*y)*L,e[7]=(a*h*l-f*d*l+f*o*u-i*h*u-a*o*_+i*d*_)*L,e[8]=D*L,e[9]=(b*m*l-f*v*l-b*r*_+i*v*_+f*r*y-i*m*y)*L,e[10]=(a*v*l-b*c*l+b*r*u-i*v*u-a*r*y+i*c*y)*L,e[11]=(f*c*l-a*m*l-f*r*u+i*m*u+a*r*_-i*c*_)*L,e[12]=k*L,e[13]=(f*v*o-b*m*o+b*r*h-i*v*h-f*r*w+i*m*w)*L,e[14]=(b*c*o-a*v*o-b*r*d+i*v*d+a*r*w-i*c*w)*L,e[15]=(a*m*o-f*c*o+f*r*d-i*m*d-a*r*h+i*c*h)*L,this}scale(e){const i=this.elements,r=e.x,o=e.y,l=e.z;return i[0]*=r,i[4]*=o,i[8]*=l,i[1]*=r,i[5]*=o,i[9]*=l,i[2]*=r,i[6]*=o,i[10]*=l,i[3]*=r,i[7]*=o,i[11]*=l,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,o))}makeTranslation(e,i,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const r=Math.cos(i),o=Math.sin(i),l=1-r,a=e.x,c=e.y,d=e.z,u=l*a,f=l*c;return this.set(u*a+r,u*c-o*d,u*d+o*c,0,u*c+o*d,f*c+r,f*d-o*a,0,u*d-o*c,f*d+o*a,l*d*d+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,o,l,a){return this.set(1,r,l,0,e,1,a,0,i,o,1,0,0,0,0,1),this}compose(e,i,r){const o=this.elements,l=i._x,a=i._y,c=i._z,d=i._w,u=l+l,f=a+a,m=c+c,h=l*u,_=l*f,b=l*m,v=a*f,w=a*m,y=c*m,M=d*u,S=d*f,D=d*m,k=r.x,O=r.y,L=r.z;return o[0]=(1-(v+y))*k,o[1]=(_+D)*k,o[2]=(b-S)*k,o[3]=0,o[4]=(_-D)*O,o[5]=(1-(h+y))*O,o[6]=(w+M)*O,o[7]=0,o[8]=(b+S)*L,o[9]=(w-M)*L,o[10]=(1-(h+v))*L,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,i,r){const o=this.elements;let l=_v1$6.set(o[0],o[1],o[2]).length();const a=_v1$6.set(o[4],o[5],o[6]).length(),c=_v1$6.set(o[8],o[9],o[10]).length();this.determinant()<0&&(l=-l),e.x=o[12],e.y=o[13],e.z=o[14],_m1$4.copy(this);const u=1/l,f=1/a,m=1/c;return _m1$4.elements[0]*=u,_m1$4.elements[1]*=u,_m1$4.elements[2]*=u,_m1$4.elements[4]*=f,_m1$4.elements[5]*=f,_m1$4.elements[6]*=f,_m1$4.elements[8]*=m,_m1$4.elements[9]*=m,_m1$4.elements[10]*=m,i.setFromRotationMatrix(_m1$4),r.x=l,r.y=a,r.z=c,this}makePerspective(e,i,r,o,l,a,c=WebGLCoordinateSystem){const d=this.elements,u=2*l/(i-e),f=2*l/(r-o),m=(i+e)/(i-e),h=(r+o)/(r-o);let _,b;if(c===WebGLCoordinateSystem)_=-(a+l)/(a-l),b=-2*a*l/(a-l);else if(c===WebGPUCoordinateSystem)_=-a/(a-l),b=-a*l/(a-l);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+c);return d[0]=u,d[4]=0,d[8]=m,d[12]=0,d[1]=0,d[5]=f,d[9]=h,d[13]=0,d[2]=0,d[6]=0,d[10]=_,d[14]=b,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(e,i,r,o,l,a,c=WebGLCoordinateSystem){const d=this.elements,u=1/(i-e),f=1/(r-o),m=1/(a-l),h=(i+e)*u,_=(r+o)*f;let b,v;if(c===WebGLCoordinateSystem)b=(a+l)*m,v=-2*m;else if(c===WebGPUCoordinateSystem)b=l*m,v=-1*m;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+c);return d[0]=2*u,d[4]=0,d[8]=0,d[12]=-h,d[1]=0,d[5]=2*f,d[9]=0,d[13]=-_,d[2]=0,d[6]=0,d[10]=v,d[14]=-b,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(e){const i=this.elements,r=e.elements;for(let o=0;o<16;o++)if(i[o]!==r[o])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}}const _v1$6=new Vector3,_m1$4=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$4=new Matrix4,_quaternion$4=new Quaternion;class Euler{constructor(e=0,i=0,r=0,o=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=r,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,o=this._order){return this._x=e,this._y=i,this._z=r,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){const o=e.elements,l=o[0],a=o[4],c=o[8],d=o[1],u=o[5],f=o[9],m=o[2],h=o[6],_=o[10];switch(i){case"XYZ":this._y=Math.asin(clamp(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,_),this._z=Math.atan2(-a,l)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(c,_),this._z=Math.atan2(d,u)):(this._y=Math.atan2(-m,l),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-m,_),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(d,l));break;case"ZYX":this._y=Math.asin(-clamp(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(h,_),this._z=Math.atan2(d,l)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(clamp(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-m,l)):(this._x=0,this._y=Math.atan2(c,_));break;case"XZY":this._z=Math.asin(-clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(c,l)):(this._x=Math.atan2(-f,_),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return _matrix$4.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix$4,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return _quaternion$4.setFromEuler(this),this.setFromQuaternion(_quaternion$4,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let _object3DId=0;const _v1$5=new Vector3,_q1=new Quaternion,_m1$3=new Matrix4,_target=new Vector3,_position$4=new Vector3,_scale$3=new Vector3,_quaternion$3=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateShortID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const e=new Vector3,i=new Euler,r=new Quaternion,o=new Vector3(1,1,1);function l(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(l),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={};{let d=function(f,m,h=!1,_=null){const b=m.name;if(f instanceof RegExp){if(b.match(f))if(_)_.push(m);else return m}else if(h){if(b===f)if(_)_.push(m);else return m}else if(b.indexOf(f)>=0)if(_)_.push(m);else return m;for(const v of m.children){let w=null;if(w=d(f,v,h,_),w&&_==null)return w}return null},u=function(f,m=c,h=!1){if(m.material)if(Array.isArray(m.material))for(const _ of m.material){const b=_.name;if(f instanceof RegExp){if(b.match(f))return _}else if(h){if(b===f)return _}else if(b.indexOf(f)>=0)return _}else{const _=m.material.name;if(f instanceof RegExp){if(_.match(f))return m.material}else if(h){if(_===f)return m.material}else if(_.indexOf(f)>=0)return m.material}for(const _ of m.children){let b=null;if(b=u(f,_,h),b)return b}return null};this.script="",this.script_mode=null,this.isMosaicObject=!1,this._collapsible_=!1,this._animation_clock_=0,this.user={updaters:{}},this.ikEnabled=!0;const c=this;this.find=function(f,m=!1){return d(f,c,m)},this.findAll=function(f,m=!1){const h=[];return d(f,c,m,h),h},this.findMaterial=function(f,m=!1){return u(f,c,m)},this.setUpdater=function(f,m){this.user.updaters[f]=m},this.isMMD=!1}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return _q1.setFromAxisAngle(e,i),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(e,i){return _q1.setFromAxisAngle(e,i),this.quaternion.premultiply(_q1),this}rotateX(e){return this.rotateOnAxis(_xAxis,e)}rotateY(e){return this.rotateOnAxis(_yAxis,e)}rotateZ(e){return this.rotateOnAxis(_zAxis,e)}translateOnAxis(e,i){return _v1$5.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$5.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(_xAxis,e)}translateY(e){return this.translateOnAxis(_yAxis,e)}translateZ(e){return this.translateOnAxis(_zAxis,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(_m1$3.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?_target.copy(e):_target.set(e,i,r);const o=this.parent;this.updateWorldMatrix(!0,!1),_position$4.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$3.lookAt(_position$4,_target,this.up):_m1$3.lookAt(_target,_position$4,this.up),this.quaternion.setFromRotationMatrix(_m1$3),o&&(_m1$3.extractRotation(o.matrixWorld),_q1.setFromRotationMatrix(_m1$3),this.quaternion.premultiply(_q1.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(_addedEvent),_childaddedEvent.child=e,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(_removedEvent),_childremovedEvent.child=e,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),_m1$3.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),_m1$3.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$3),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(_addedEvent),_childaddedEvent.child=e,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,o=this.children.length;r<o;r++){const a=this.children[r].getObjectByProperty(e,i);if(a!==void 0)return a}}getObjectsByProperty(e,i,r=[]){this[e]===i&&r.push(this);const o=this.children;for(let l=0,a=o.length;l<a;l++)o[l].getObjectsByProperty(e,i,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$4,e,_scale$3),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$4,_quaternion$3,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let r=0,o=i.length;r<o;r++){const l=i[r];(l.matrixWorldAutoUpdate===!0||e===!0)&&l.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const o=this.children;for(let l=0,a=o.length;l<a;l++){const c=o[l];c.matrixWorldAutoUpdate===!0&&c.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(o.type="BatchedMesh",o.perObjectFrustumCulled=this.perObjectFrustumCulled,o.sortObjects=this.sortObjects,o.drawRanges=this._drawRanges,o.reservedRanges=this._reservedRanges,o.visibility=this._visibility,o.active=this._active,o.bounds=this._bounds.map(c=>({boxInitialized:c.boxInitialized,boxMin:c.box.min.toArray(),boxMax:c.box.max.toArray(),sphereInitialized:c.sphereInitialized,sphereRadius:c.sphere.radius,sphereCenter:c.sphere.center.toArray()})),o.maxGeometryCount=this._maxGeometryCount,o.maxVertexCount=this._maxVertexCount,o.maxIndexCount=this._maxIndexCount,o.geometryInitialized=this._geometryInitialized,o.geometryCount=this._geometryCount,o.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(o.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(o.boundingSphere={center:o.boundingSphere.center.toArray(),radius:o.boundingSphere.radius}),this.boundingBox!==null&&(o.boundingBox={min:o.boundingBox.min.toArray(),max:o.boundingBox.max.toArray()}));function l(c,d){return c[d.uuid]===void 0&&(c[d.uuid]=d.toJSON(e)),d.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=l(e.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const d=c.shapes;if(Array.isArray(d))for(let u=0,f=d.length;u<f;u++){const m=d[u];l(e.shapes,m)}else l(e.shapes,d)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let d=0,u=this.material.length;d<u;d++)c.push(l(e.materials,this.material[d]));o.material=c}else o.material=l(e.materials,this.material);if(this.children.length>0){o.children=[];for(let c=0;c<this.children.length;c++)o.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let c=0;c<this.animations.length;c++){const d=this.animations[c];o.animations.push(l(e.animations,d))}}if(i){const c=a(e.geometries),d=a(e.materials),u=a(e.textures),f=a(e.images),m=a(e.shapes),h=a(e.skeletons),_=a(e.animations),b=a(e.nodes);c.length>0&&(r.geometries=c),d.length>0&&(r.materials=d),u.length>0&&(r.textures=u),f.length>0&&(r.images=f),m.length>0&&(r.shapes=m),h.length>0&&(r.skeletons=h),_.length>0&&(r.animations=_),b.length>0&&(r.nodes=b)}return r.object=o,r;function a(c){const d=[];for(const u in c){const f=c[u];delete f.metadata,d.push(f)}return d}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){const o=e.children[r];this.add(o.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$4=new Vector3,_v2$3=new Vector3,_v3$3=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;class Triangle{constructor(e=new Vector3,i=new Vector3,r=new Vector3){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,o){o.subVectors(r,i),_v0$1.subVectors(e,i),o.cross(_v0$1);const l=o.lengthSq();return l>0?o.multiplyScalar(1/Math.sqrt(l)):o.set(0,0,0)}static getBarycoord(e,i,r,o,l){_v0$1.subVectors(o,i),_v1$4.subVectors(r,i),_v2$3.subVectors(e,i);const a=_v0$1.dot(_v0$1),c=_v0$1.dot(_v1$4),d=_v0$1.dot(_v2$3),u=_v1$4.dot(_v1$4),f=_v1$4.dot(_v2$3),m=a*u-c*c;if(m===0)return l.set(0,0,0),null;const h=1/m,_=(u*d-c*f)*h,b=(a*f-c*d)*h;return l.set(1-_-b,b,_)}static containsPoint(e,i,r,o){return this.getBarycoord(e,i,r,o,_v3$3)===null?!1:_v3$3.x>=0&&_v3$3.y>=0&&_v3$3.x+_v3$3.y<=1}static getInterpolation(e,i,r,o,l,a,c,d){return this.getBarycoord(e,i,r,o,_v3$3)===null?(d.x=0,d.y=0,"z"in d&&(d.z=0),"w"in d&&(d.w=0),null):(d.setScalar(0),d.addScaledVector(l,_v3$3.x),d.addScaledVector(a,_v3$3.y),d.addScaledVector(c,_v3$3.z),d)}static isFrontFacing(e,i,r,o){return _v0$1.subVectors(r,i),_v1$4.subVectors(e,i),_v0$1.cross(_v1$4).dot(o)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,o){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,i,r,o){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,o),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$4.subVectors(this.a,this.b),_v0$1.cross(_v1$4).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Triangle.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,r,o,l){return Triangle.getInterpolation(e,this.a,this.b,this.c,i,r,o,l)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const r=this.a,o=this.b,l=this.c;let a,c;_vab.subVectors(o,r),_vac.subVectors(l,r),_vap.subVectors(e,r);const d=_vab.dot(_vap),u=_vac.dot(_vap);if(d<=0&&u<=0)return i.copy(r);_vbp.subVectors(e,o);const f=_vab.dot(_vbp),m=_vac.dot(_vbp);if(f>=0&&m<=f)return i.copy(o);const h=d*m-f*u;if(h<=0&&d>=0&&f<=0)return a=d/(d-f),i.copy(r).addScaledVector(_vab,a);_vcp.subVectors(e,l);const _=_vab.dot(_vcp),b=_vac.dot(_vcp);if(b>=0&&_<=b)return i.copy(l);const v=_*u-d*b;if(v<=0&&u>=0&&b<=0)return c=u/(u-b),i.copy(r).addScaledVector(_vac,c);const w=f*b-_*m;if(w<=0&&m-f>=0&&_-b>=0)return _vbc.subVectors(l,o),c=(m-f)/(m-f+(_-b)),i.copy(o).addScaledVector(_vbc,c);const y=1/(w+v+h);return a=v*y,c=h*y,i.copy(r).addScaledVector(_vab,a).addScaledVector(_vac,c)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(s,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?s+(e-s)*6*i:i<1/2?e:i<2/3?s+(e-s)*6*(2/3-i):s}class Color{constructor(e,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,r)}set(e,i,r){if(i===void 0&&r===void 0){const o=e;o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o)}else this.setRGB(e,i,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=SRGBColorSpace){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ColorManagement.toWorkingColorSpace(this,i),this}setRGB(e,i,r,o=ColorManagement.workingColorSpace){return this.r=e,this.g=i,this.b=r,ColorManagement.toWorkingColorSpace(this,o),this}setHSL(e,i,r,o=ColorManagement.workingColorSpace){if(e=euclideanModulo(e,1),i=clamp(i,0,1),r=clamp(r,0,1),i===0)this.r=this.g=this.b=r;else{const l=r<=.5?r*(1+i):r+i-r*i,a=2*r-l;this.r=hue2rgb(a,l,e+1/3),this.g=hue2rgb(a,l,e),this.b=hue2rgb(a,l,e-1/3)}return ColorManagement.toWorkingColorSpace(this,o),this}setStyle(e,i=SRGBColorSpace){function r(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(e)){let l;const a=o[1],c=o[2];switch(a){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return r(l[4]),this.setRGB(Math.min(255,parseInt(l[1],10))/255,Math.min(255,parseInt(l[2],10))/255,Math.min(255,parseInt(l[3],10))/255,i);if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return r(l[4]),this.setRGB(Math.min(100,parseInt(l[1],10))/100,Math.min(100,parseInt(l[2],10))/100,Math.min(100,parseInt(l[3],10))/100,i);break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return r(l[4]),this.setHSL(parseFloat(l[1])/360,parseFloat(l[2])/100,parseFloat(l[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const l=o[1],a=l.length;if(a===3)return this.setRGB(parseInt(l.charAt(0),16)/15,parseInt(l.charAt(1),16)/15,parseInt(l.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(l,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=SRGBColorSpace){const r=_colorKeywords[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),e),Math.round(clamp(_color.r*255,0,255))*65536+Math.round(clamp(_color.g*255,0,255))*256+Math.round(clamp(_color.b*255,0,255))}getHexString(e=SRGBColorSpace){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),i);const r=_color.r,o=_color.g,l=_color.b,a=Math.max(r,o,l),c=Math.min(r,o,l);let d,u;const f=(c+a)/2;if(c===a)d=0,u=0;else{const m=a-c;switch(u=f<=.5?m/(a+c):m/(2-a-c),a){case r:d=(o-l)/m+(o<l?6:0);break;case o:d=(l-r)/m+2;break;case l:d=(r-o)/m+4;break}d/=6}return e.h=d,e.s=u,e.l=f,e}getRGB(e,i=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),i),e.r=_color.r,e.g=_color.g,e.b=_color.b,e}getStyle(e=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),e);const i=_color.r,r=_color.g,o=_color.b;return e!==SRGBColorSpace?`color(${e} ${i.toFixed(3)} ${r.toFixed(3)} ${o.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(o*255)})`}offsetHSL(e,i,r){return this.getHSL(_hslA),this.setHSL(_hslA.h+e,_hslA.s+i,_hslA.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(_hslA),e.getHSL(_hslB);const r=lerp(_hslA.h,_hslB.h,i),o=lerp(_hslA.s,_hslB.s,i),l=lerp(_hslA.l,_hslB.l,i);return this.setHSL(r,o,l),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,r=this.g,o=this.b,l=e.elements;return this.r=l[0]*i+l[3]*r+l[6]*o,this.g=l[1]*i+l[4]*r+l[7]*o,this.b=l[2]*i+l[5]*r+l[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher{constructor(){if(super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",window.CALLER_LINE)for(let e=5;e>=3;e--){const i=window.CALLER_LINE(5).split("/").pop();if(i.indexOf("undefined")===-1){this.name=i;break}}this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0,this.receiveDynamicEnvironment=!0,this.castDynamicEnvironment=!0,this.receiveShadow=!0,this.motionBlur=!0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const r=e[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const o=this[i];if(o===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}o&&o.isColor?o.set(r):o&&o.isVector3&&r&&r.isVector3?o.copy(r):this[i]=r}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),this.side!==FrontSide&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(r.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(r.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(r.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.castDynamicEnvironment!==void 0&&(r.castDynamicEnvironment=this.castDynamicEnvironment),this.receiveDynamicEnvironment!==void 0&&(r.receiveDynamicEnvironment=this.receiveDynamicEnvironment),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function o(l){const a=[];for(const c in l){const d=l[c];delete d.metadata,a.push(d)}return a}if(i){const l=o(e.textures),a=o(e.images);l.length>0&&(r.textures=l),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let r=null;if(i!==null){const o=i.length;r=new Array(o);for(let l=0;l!==o;++l)r[l]=i[l].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.castDynamicEnvironment=e.castDynamicEnvironment,this.receiveDynamicEnvironment=e.receiveDynamicEnvironment,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class MeshBasicMaterial extends Material{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const _tables=_generateTables();function _generateTables(){const s=new ArrayBuffer(4),e=new Float32Array(s),i=new Uint32Array(s),r=new Uint32Array(512),o=new Uint32Array(512);for(let d=0;d<256;++d){const u=d-127;u<-27?(r[d]=0,r[d|256]=32768,o[d]=24,o[d|256]=24):u<-14?(r[d]=1024>>-u-14,r[d|256]=1024>>-u-14|32768,o[d]=-u-1,o[d|256]=-u-1):u<=15?(r[d]=u+15<<10,r[d|256]=u+15<<10|32768,o[d]=13,o[d|256]=13):u<128?(r[d]=31744,r[d|256]=64512,o[d]=24,o[d|256]=24):(r[d]=31744,r[d|256]=64512,o[d]=13,o[d|256]=13)}const l=new Uint32Array(2048),a=new Uint32Array(64),c=new Uint32Array(64);for(let d=1;d<1024;++d){let u=d<<13,f=0;for(;!(u&8388608);)u<<=1,f-=8388608;u&=-8388609,f+=947912704,l[d]=u|f}for(let d=1024;d<2048;++d)l[d]=939524096+(d-1024<<13);for(let d=1;d<31;++d)a[d]=d<<23;a[31]=1199570944,a[32]=2147483648;for(let d=33;d<63;++d)a[d]=2147483648+(d-32<<23);a[63]=3347054592;for(let d=1;d<64;++d)d!==32&&(c[d]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:o,mantissaTable:l,exponentTable:a,offsetTable:c}}function toHalfFloat(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=clamp(s,-65504,65504),_tables.floatView[0]=s;const e=_tables.uint32View[0],i=e>>23&511;return _tables.baseTable[i]+((e&8388607)>>_tables.shiftTable[i])}function fromHalfFloat(s){const e=s>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[e]+(s&1023)]+_tables.exponentTable[e],_tables.floatView[0]}const DataUtils={toHalfFloat,fromHalfFloat},_vector$b=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(e,i,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r,this.usage=StaticDrawUsage,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return warnOnce("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let o=0,l=this.itemSize;o<l;o++)this.array[e+o]=i.array[r+o];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)_vector2$1.fromBufferAttribute(this,i),_vector2$1.applyMatrix3(e),this.setXY(i,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)_vector$b.fromBufferAttribute(this,i),_vector$b.applyMatrix3(e),this.setXYZ(i,_vector$b.x,_vector$b.y,_vector$b.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)_vector$b.fromBufferAttribute(this,i),_vector$b.applyMatrix4(e),this.setXYZ(i,_vector$b.x,_vector$b.y,_vector$b.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)_vector$b.fromBufferAttribute(this,i),_vector$b.applyNormalMatrix(e),this.setXYZ(i,_vector$b.x,_vector$b.y,_vector$b.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)_vector$b.fromBufferAttribute(this,i),_vector$b.transformDirection(e),this.setXYZ(i,_vector$b.x,_vector$b.y,_vector$b.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let r=this.array[e*this.itemSize+i];return this.normalized&&(r=denormalize(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=normalize(r,this.array)),this.array[e*this.itemSize+i]=r,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=denormalize(i,this.array)),i}setX(e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=denormalize(i,this.array)),i}setY(e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=denormalize(i,this.array)),i}setZ(e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=denormalize(i,this.array)),i}setW(e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array)),this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,o){return e*=this.itemSize,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array),o=normalize(o,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=o,this}setXYZW(e,i,r,o,l){return e*=this.itemSize,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array),o=normalize(o,this.array),l=normalize(l,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=o,this.array[e+3]=l,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==StaticDrawUsage&&(e.usage=this.usage),e}}class Int8BufferAttribute extends BufferAttribute{constructor(e,i,r){e instanceof Int8Array?super(new Int8Array(e.buffer.slice(0)),i,r):super(new Int8Array(e),i,r)}}class Uint8BufferAttribute extends BufferAttribute{constructor(e,i,r){e instanceof Uint8Array?super(new Uint8Array(e.buffer.slice(0)),i,r):super(new Uint8Array(e),i,r)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(e,i,r){super(new Uint8ClampedArray(e),i,r)}}class Int16BufferAttribute extends BufferAttribute{constructor(e,i,r){super(new Int16Array(e),i,r)}}class Uint16BufferAttribute extends BufferAttribute{constructor(e,i,r){super(new Uint16Array(e),i,r)}}class Int32BufferAttribute extends BufferAttribute{constructor(e,i,r){super(new Int32Array(e),i,r)}}class Uint32BufferAttribute extends BufferAttribute{constructor(e,i,r){super(new Uint32Array(e),i,r)}}class Float16BufferAttribute extends BufferAttribute{constructor(e,i,r){super(new Uint16Array(e),i,r),this.isFloat16BufferAttribute=!0}getX(e){let i=fromHalfFloat(this.array[e*this.itemSize]);return this.normalized&&(i=denormalize(i,this.array)),i}setX(e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[e*this.itemSize]=toHalfFloat(i),this}getY(e){let i=fromHalfFloat(this.array[e*this.itemSize+1]);return this.normalized&&(i=denormalize(i,this.array)),i}setY(e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[e*this.itemSize+1]=toHalfFloat(i),this}getZ(e){let i=fromHalfFloat(this.array[e*this.itemSize+2]);return this.normalized&&(i=denormalize(i,this.array)),i}setZ(e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[e*this.itemSize+2]=toHalfFloat(i),this}getW(e){let i=fromHalfFloat(this.array[e*this.itemSize+3]);return this.normalized&&(i=denormalize(i,this.array)),i}setW(e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[e*this.itemSize+3]=toHalfFloat(i),this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array)),this.array[e+0]=toHalfFloat(i),this.array[e+1]=toHalfFloat(r),this}setXYZ(e,i,r,o){return e*=this.itemSize,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array),o=normalize(o,this.array)),this.array[e+0]=toHalfFloat(i),this.array[e+1]=toHalfFloat(r),this.array[e+2]=toHalfFloat(o),this}setXYZW(e,i,r,o,l){return e*=this.itemSize,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array),o=normalize(o,this.array),l=normalize(l,this.array)),this.array[e+0]=toHalfFloat(i),this.array[e+1]=toHalfFloat(r),this.array[e+2]=toHalfFloat(o),this.array[e+3]=toHalfFloat(l),this}}class Float32BufferAttribute extends BufferAttribute{constructor(e,i,r){e.is_custom?super(e.new_array,i,r):e instanceof Float32Array?super(new Float32Array(e.buffer.slice(0)),i,r):super(new Float32Array(e),i,r)}}let _id$2=0;const _m1$2=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$a=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(arrayNeedsUint32(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const l=new Matrix3().getNormalMatrix(e);r.applyNormalMatrix(l),r.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return _m1$2.makeRotationFromQuaternion(e),this.applyMatrix4(_m1$2),this}rotateX(e){return _m1$2.makeRotationX(e),this.applyMatrix4(_m1$2),this}rotateY(e){return _m1$2.makeRotationY(e),this.applyMatrix4(_m1$2),this}rotateZ(e){return _m1$2.makeRotationZ(e),this.applyMatrix4(_m1$2),this}translate(e,i,r){return _m1$2.makeTranslation(e,i,r),this.applyMatrix4(_m1$2),this}scale(e,i,r){return _m1$2.makeScale(e,i,r),this.applyMatrix4(_m1$2),this}lookAt(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(e){const i=[];for(let r=0,o=e.length;r<o;r++){const l=e[r];i.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new Float32BufferAttribute(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,o=i.length;r<o;r++){const l=i[r];_box$2.setFromBufferAttribute(l),this.morphTargetsRelative?(_vector$a.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$a),_vector$a.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$a)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3,1/0);return}if(e){const r=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(e),i)for(let l=0,a=i.length;l<a;l++){const c=i[l];_boxMorphTargets.setFromBufferAttribute(c),this.morphTargetsRelative?(_vector$a.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$a),_vector$a.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$a)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(r);let o=0;for(let l=0,a=e.count;l<a;l++)_vector$a.fromBufferAttribute(e,l),o=Math.max(o,r.distanceToSquared(_vector$a));if(i)for(let l=0,a=i.length;l<a;l++){const c=i[l],d=this.morphTargetsRelative;for(let u=0,f=c.count;u<f;u++)_vector$a.fromBufferAttribute(c,u),d&&(_offset.fromBufferAttribute(e,u),_vector$a.add(_offset)),o=Math.max(o,r.distanceToSquared(_vector$a))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,o=i.normal,l=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),c=[],d=[];for(let P=0;P<r.count;P++)c[P]=new Vector3,d[P]=new Vector3;const u=new Vector3,f=new Vector3,m=new Vector3,h=new Vector2,_=new Vector2,b=new Vector2,v=new Vector3,w=new Vector3;function y(P,N,z){u.fromBufferAttribute(r,P),f.fromBufferAttribute(r,N),m.fromBufferAttribute(r,z),h.fromBufferAttribute(l,P),_.fromBufferAttribute(l,N),b.fromBufferAttribute(l,z),f.sub(u),m.sub(u),_.sub(h),b.sub(h);const K=1/(_.x*b.y-b.x*_.y);isFinite(K)&&(v.copy(f).multiplyScalar(b.y).addScaledVector(m,-_.y).multiplyScalar(K),w.copy(m).multiplyScalar(_.x).addScaledVector(f,-b.x).multiplyScalar(K),c[P].add(v),c[N].add(v),c[z].add(v),d[P].add(w),d[N].add(w),d[z].add(w))}let M=this.groups;M.length===0&&(M=[{start:0,count:e.count}]);for(let P=0,N=M.length;P<N;++P){const z=M[P],K=z.start,Z=z.count;for(let V=K,H=K+Z;V<H;V+=3)y(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const S=new Vector3,D=new Vector3,k=new Vector3,O=new Vector3;function L(P){k.fromBufferAttribute(o,P),O.copy(k);const N=c[P];S.copy(N),S.sub(k.multiplyScalar(k.dot(N))).normalize(),D.crossVectors(O,N);const K=D.dot(d[P])<0?-1:1;a.setXYZW(P,S.x,S.y,S.z,K)}for(let P=0,N=M.length;P<N;++P){const z=M[P],K=z.start,Z=z.count;for(let V=K,H=K+Z;V<H;V+=3)L(e.getX(V+0)),L(e.getX(V+1)),L(e.getX(V+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new BufferAttribute(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let h=0,_=r.count;h<_;h++)r.setXYZ(h,0,0,0);const o=new Vector3,l=new Vector3,a=new Vector3,c=new Vector3,d=new Vector3,u=new Vector3,f=new Vector3,m=new Vector3;if(e)for(let h=0,_=e.count;h<_;h+=3){const b=e.getX(h+0),v=e.getX(h+1),w=e.getX(h+2);o.fromBufferAttribute(i,b),l.fromBufferAttribute(i,v),a.fromBufferAttribute(i,w),f.subVectors(a,l),m.subVectors(o,l),f.cross(m),c.fromBufferAttribute(r,b),d.fromBufferAttribute(r,v),u.fromBufferAttribute(r,w),c.add(f),d.add(f),u.add(f),r.setXYZ(b,c.x,c.y,c.z),r.setXYZ(v,d.x,d.y,d.z),r.setXYZ(w,u.x,u.y,u.z)}else for(let h=0,_=i.count;h<_;h+=3)o.fromBufferAttribute(i,h+0),l.fromBufferAttribute(i,h+1),a.fromBufferAttribute(i,h+2),f.subVectors(a,l),m.subVectors(o,l),f.cross(m),r.setXYZ(h+0,f.x,f.y,f.z),r.setXYZ(h+1,f.x,f.y,f.z),r.setXYZ(h+2,f.x,f.y,f.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)_vector$a.fromBufferAttribute(e,i),_vector$a.normalize(),e.setXYZ(i,_vector$a.x,_vector$a.y,_vector$a.z)}toNonIndexed(){function e(c,d){const u=c.array,f=c.itemSize,m=c.normalized,h=new u.constructor(d.length*f);let _=0,b=0;for(let v=0,w=d.length;v<w;v++){c.isInterleavedBufferAttribute?_=d[v]*c.data.stride+c.offset:_=d[v]*f;for(let y=0;y<f;y++)h[b++]=u[_++]}return new BufferAttribute(h,f,m)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new BufferGeometry,r=this.index.array,o=this.attributes;for(const c in o){const d=o[c],u=e(d,r);i.setAttribute(c,u)}const l=this.morphAttributes;for(const c in l){const d=[],u=l[c];for(let f=0,m=u.length;f<m;f++){const h=u[f],_=e(h,r);d.push(_)}i.morphAttributes[c]=d}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let c=0,d=a.length;c<d;c++){const u=a[c];i.addGroup(u.start,u.count,u.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const d=this.parameters;for(const u in d)d[u]!==void 0&&(e[u]=d[u]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const d in r){const u=r[d];e.data.attributes[d]=u.toJSON(e.data)}const o={};let l=!1;for(const d in this.morphAttributes){const u=this.morphAttributes[d],f=[];for(let m=0,h=u.length;m<h;m++){const _=u[m];f.push(_.toJSON(e.data))}f.length>0&&(o[d]=f,l=!0)}l&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const c=this.boundingSphere;return c!==null&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(i));const o=e.attributes;for(const u in o){const f=o[u];this.setAttribute(u,f.clone(i))}const l=e.morphAttributes;for(const u in l){const f=[],m=l[u];for(let h=0,_=m.length;h<_;h++)f.push(m[h].clone(i));this.morphAttributes[u]=f}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,f=a.length;u<f;u++){const m=a[u];this.addGroup(m.start,m.count,m.materialIndex)}const c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());const d=e.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$4=new Ray,_sphere$6=new Sphere,_sphereHitAt=new Vector3,_vA$2=new Vector3,_vB$2=new Vector3,_vC$2=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$2=new Vector2,_uvB$2=new Vector2,_uvC$2=new Vector2,_normalA$1=new Vector3,_normalB$1=new Vector3,_normalC$1=new Vector3,_intersectionPoint$1=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(e=new BufferGeometry,i=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isMMDMorph){const i=e.morphAttributes,r=e.morphs,o=Object.keys(i);if(o.length>0&&i[o[0]]!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={},this.morphTargetIndexDictionary=[];for(let a=0,c=r.length;a<c;a++){const d=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=a,this.morphTargetIndexDictionary.push(d)}}}else{const i=e.morphAttributes,r=Object.keys(i);if(r.length>0){const o=i[r[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={},this.morphTargetIndexDictionary=[];for(let l=0,a=o.length;l<a;l++){const c=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=l,this.morphTargetIndexDictionary.push(c)}}}}}getVertexPosition(e,i){const r=this.geometry,o=r.attributes.position,l=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(o,e);const c=this.morphTargetInfluences;if(l&&c){_morphA.set(0,0,0);for(let d=0,u=l.length;d<u;d++){const f=c[d],m=l[d];f!==0&&(_tempA.fromBufferAttribute(m,e),a?_morphA.addScaledVector(_tempA,f):_morphA.addScaledVector(_tempA.sub(i),f))}i.add(_morphA)}return i}raycast(e,i){const r=this.geometry,o=this.material,l=this.matrixWorld;o!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere$6.copy(r.boundingSphere),_sphere$6.applyMatrix4(l),_ray$4.copy(e.ray).recast(e.near),!(_sphere$6.containsPoint(_ray$4.origin)===!1&&(_ray$4.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$4.origin.distanceToSquared(_sphereHitAt)>(e.far-e.near)**2))&&(_inverseMatrix$3.copy(l).invert(),_ray$4.copy(e.ray).applyMatrix4(_inverseMatrix$3),!(r.boundingBox!==null&&_ray$4.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,i,_ray$4)))}_computeIntersections(e,i,r){let o;const l=this.geometry,a=this.material,c=l.index,d=l.attributes.position,u=l.attributes.uv,f=l.attributes.uv1,m=l.attributes.normal,h=l.groups,_=l.drawRange;if(c!==null)if(Array.isArray(a))for(let b=0,v=h.length;b<v;b++){const w=h[b],y=a[w.materialIndex],M=Math.max(w.start,_.start),S=Math.min(c.count,Math.min(w.start+w.count,_.start+_.count));for(let D=M,k=S;D<k;D+=3){const O=c.getX(D),L=c.getX(D+1),P=c.getX(D+2);o=checkGeometryIntersection(this,y,e,r,u,f,m,O,L,P),o&&(o.faceIndex=Math.floor(D/3),o.face.materialIndex=w.materialIndex,i.push(o))}}else{const b=Math.max(0,_.start),v=Math.min(c.count,_.start+_.count);for(let w=b,y=v;w<y;w+=3){const M=c.getX(w),S=c.getX(w+1),D=c.getX(w+2);o=checkGeometryIntersection(this,a,e,r,u,f,m,M,S,D),o&&(o.faceIndex=Math.floor(w/3),i.push(o))}}else if(d!==void 0)if(Array.isArray(a))for(let b=0,v=h.length;b<v;b++){const w=h[b],y=a[w.materialIndex],M=Math.max(w.start,_.start),S=Math.min(d.count,Math.min(w.start+w.count,_.start+_.count));for(let D=M,k=S;D<k;D+=3){const O=D,L=D+1,P=D+2;o=checkGeometryIntersection(this,y,e,r,u,f,m,O,L,P),o&&(o.faceIndex=Math.floor(D/3),o.face.materialIndex=w.materialIndex,i.push(o))}}else{const b=Math.max(0,_.start),v=Math.min(d.count,_.start+_.count);for(let w=b,y=v;w<y;w+=3){const M=w,S=w+1,D=w+2;o=checkGeometryIntersection(this,a,e,r,u,f,m,M,S,D),o&&(o.faceIndex=Math.floor(w/3),i.push(o))}}}}function checkIntersection$2(s,e,i,r,o,l,a,c){let d;if(e.side===BackSide?d=r.intersectTriangle(a,l,o,!0,c):d=r.intersectTriangle(o,l,a,e.side===FrontSide,c),d===null)return null;_intersectionPointWorld.copy(c),_intersectionPointWorld.applyMatrix4(s.matrixWorld);const u=i.ray.origin.distanceTo(_intersectionPointWorld);return u<i.near||u>i.far?null:{distance:u,point:_intersectionPointWorld.clone(),object:s}}function checkGeometryIntersection(s,e,i,r,o,l,a,c,d,u){s.getVertexPosition(c,_vA$2),s.getVertexPosition(d,_vB$2),s.getVertexPosition(u,_vC$2);const f=checkIntersection$2(s,e,i,r,_vA$2,_vB$2,_vC$2,_intersectionPoint$1);if(f){o&&(_uvA$2.fromBufferAttribute(o,c),_uvB$2.fromBufferAttribute(o,d),_uvC$2.fromBufferAttribute(o,u),f.uv=Triangle.getInterpolation(_intersectionPoint$1,_vA$2,_vB$2,_vC$2,_uvA$2,_uvB$2,_uvC$2,new Vector2)),l&&(_uvA$2.fromBufferAttribute(l,c),_uvB$2.fromBufferAttribute(l,d),_uvC$2.fromBufferAttribute(l,u),f.uv1=Triangle.getInterpolation(_intersectionPoint$1,_vA$2,_vB$2,_vC$2,_uvA$2,_uvB$2,_uvC$2,new Vector2)),a&&(_normalA$1.fromBufferAttribute(a,c),_normalB$1.fromBufferAttribute(a,d),_normalC$1.fromBufferAttribute(a,u),f.normal=Triangle.getInterpolation(_intersectionPoint$1,_vA$2,_vB$2,_vC$2,_normalA$1,_normalB$1,_normalC$1,new Vector3),f.normal.dot(r.direction)>0&&f.normal.multiplyScalar(-1));const m={a:c,b:d,c:u,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$2,_vB$2,_vC$2,m.normal),f.face=m}return f}class BoxGeometry extends BufferGeometry{constructor(e=1,i=1,r=1,o=1,l=1,a=1,c={x:0,y:0,z:0}){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:o,heightSegments:l,depthSegments:a};const d=this;o=Math.floor(o),l=Math.floor(l),a=Math.floor(a);const u=[],f=[],m=[],h=[];let _=0,b=0;v("z","y","x",-1,-1,r,i,e,a,l,0),v("z","y","x",1,-1,r,i,-e,a,l,1),v("x","z","y",1,1,e,r,i,o,a,2),v("x","z","y",1,-1,e,r,-i,o,a,3),v("x","y","z",1,-1,e,i,r,o,l,4),v("x","y","z",-1,-1,e,i,-r,o,l,5),this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2));function v(w,y,M,S,D,k,O,L,P,N,z){const K=k/P,Z=O/N,V=k/2,H=O/2,Y=L/2,q=P+1,J=N+1;let W=0,te=0;const ie=new Vector3;for(let oe=0;oe<J;oe++){const Ce=oe*Z-H;for(let ve=0;ve<q;ve++){const we=ve*K-V;ie[w]=we*S,ie[y]=Ce*D,ie[M]=Y,f.push(ie.x+c.x,ie.y+c.y,ie.z+c.z),ie[w]=0,ie[y]=0,ie[M]=L>0?1:-1,m.push(ie.x,ie.y,ie.z),h.push(ve/P),h.push(1-oe/N),W+=1}}for(let oe=0;oe<N;oe++)for(let Ce=0;Ce<P;Ce++){const ve=_+Ce+q*oe,we=_+Ce+q*(oe+1),Se=_+(Ce+1)+q*(oe+1),Re=_+(Ce+1)+q*oe;u.push(ve,we,Re),u.push(we,Se,Re),te+=6}d.addGroup(b,te,z),b+=te,_+=W}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cloneUniforms(s){const e={};for(const i in s){e[i]={};for(const r in s[i]){const o=s[i][r];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?o.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][r]=null):e[i][r]=o.clone():Array.isArray(o)?e[i][r]=o.slice():e[i][r]=o}}return e}function mergeUniforms(s){const e={};for(let i=0;i<s.length;i++){const r=cloneUniforms(s[i]);for(const o in r)e[o]=r[o]}return e}function cloneUniformsGroups(s){const e=[];for(let i=0;i<s.length;i++)e.push(s[i].clone());return e}function getUnlitUniformColorSpace(s){const e=s.getRenderTarget();return e===null?s.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms},default_vertex=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`,default_fragment=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;class ShaderMaterial extends Material{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.uniformsGroups=cloneUniformsGroups(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const o in this.uniforms){const a=this.uniforms[o].value;a&&a.isTexture?i.uniforms[o]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[o]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[o]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[o]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[o]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[o]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[o]={type:"m4",value:a.toArray()}:i.uniforms[o]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const o in this.extensions)this.extensions[o]===!0&&(r[o]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem,this._camera_motion_vmd_distance=0,this._camera_motion_vmd_rotate=new Vector3,this._camera_motion_vmd_euler=new Euler}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v3$2=new Vector3,_minTarget=new Vector2,_maxTarget=new Vector2;class PerspectiveCamera extends Camera{constructor(e=50,i=1,r=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=o,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=RAD2DEG*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,r){_v3$2.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(_v3$2.x,_v3$2.y).multiplyScalar(-e/_v3$2.z),_v3$2.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(_v3$2.x,_v3$2.y).multiplyScalar(-e/_v3$2.z)}getViewSize(e,i){return this.getViewBounds(e,_minTarget,_maxTarget),i.subVectors(_maxTarget,_minTarget)}setViewOffset(e,i,r,o,l,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=o,this.view.width=l,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,r=2*i,o=this.aspect*r,l=-.5*o;const a=this.view;if(this.view!==null&&this.view.enabled){const d=a.fullWidth,u=a.fullHeight;l+=a.offsetX*o/d,i-=a.offsetY*r/u,o*=a.width/d,r*=a.height/u}const c=this.filmOffset;c!==0&&(l+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+o,i,i-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(e,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const o=new PerspectiveCamera(fov,aspect,e,i);o.layers=this.layers,this.add(o);const l=new PerspectiveCamera(fov,aspect,e,i);l.layers=this.layers,this.add(l);const a=new PerspectiveCamera(fov,aspect,e,i);a.layers=this.layers,this.add(a);const c=new PerspectiveCamera(fov,aspect,e,i);c.layers=this.layers,this.add(c);const d=new PerspectiveCamera(fov,aspect,e,i);d.layers=this.layers,this.add(d);const u=new PerspectiveCamera(fov,aspect,e,i);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[r,o,l,a,c,d]=i;for(const u of i)this.remove(u);if(e===WebGLCoordinateSystem)r.up.set(0,1,0),r.lookAt(1,0,0),o.up.set(0,1,0),o.lookAt(-1,0,0),l.up.set(0,0,-1),l.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),c.up.set(0,1,0),c.lookAt(0,0,1),d.up.set(0,1,0),d.lookAt(0,0,-1);else if(e===WebGPUCoordinateSystem)r.up.set(0,-1,0),r.lookAt(-1,0,0),o.up.set(0,-1,0),o.lookAt(1,0,0),l.up.set(0,0,1),l.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),c.up.set(0,-1,0),c.lookAt(0,0,1),d.up.set(0,-1,0),d.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of i)this.add(u),u.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:o}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[l,a,c,d,u,f]=this.children,m=e.getRenderTarget(),h=e.getActiveCubeFace(),_=e.getActiveMipmapLevel(),b=e.xr.enabled;e.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,o),e.render(i,l),e.setRenderTarget(r,1,o),e.render(i,a),e.setRenderTarget(r,2,o),e.render(i,c),e.setRenderTarget(r,3,o),e.render(i,d),e.setRenderTarget(r,4,o),e.render(i,u),r.texture.generateMipmaps=v,e.setRenderTarget(r,5,o),e.render(i,f),e.setRenderTarget(m,h,_),e.xr.enabled=b,r.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(e,i,r,o,l,a,c,d,u,f){e=e!==void 0?e:[],i=i!==void 0?i:CubeReflectionMapping,super(e,i,r,o,l,a,c,d,u,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},o=[r,r,r,r,r,r];this.texture=new CubeTexture(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:LinearFilter}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new BoxGeometry(5,5,5),l=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:BackSide,blending:NoBlending});l.uniforms.tEquirect.value=i;const a=new Mesh(o,l),c=i.minFilter;return i.minFilter===LinearMipmapLinearFilter&&(i.minFilter=LinearFilter),new CubeCamera(1,10,this).update(e,a),i.minFilter=c,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,r,o){const l=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,r,o);e.setRenderTarget(l)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,o){return this.normal.set(e,i,r),this.constant=o,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){const o=_vector1.subVectors(r,i).cross(_vector2.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const r=e.delta(_vector1),o=this.normal.dot(r);if(o===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const l=-(e.start.dot(this.normal)+this.constant)/o;return l<0||l>1?null:i.copy(e.start).addScaledVector(r,l)}intersectsLine(e){const i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const r=i||_normalMatrix.getNormalMatrix(e),o=this.coplanarPoint(_vector1).applyMatrix4(e),l=this.normal.applyMatrix3(r).normalize();return this.constant=-o.dot(l),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$5=new Sphere,_vector$9=new Vector3;class Frustum{constructor(e=new Plane,i=new Plane,r=new Plane,o=new Plane,l=new Plane,a=new Plane){this.planes=[e,i,r,o,l,a]}set(e,i,r,o,l,a){const c=this.planes;return c[0].copy(e),c[1].copy(i),c[2].copy(r),c[3].copy(o),c[4].copy(l),c[5].copy(a),this}copy(e){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,i=WebGLCoordinateSystem){const r=this.planes,o=e.elements,l=o[0],a=o[1],c=o[2],d=o[3],u=o[4],f=o[5],m=o[6],h=o[7],_=o[8],b=o[9],v=o[10],w=o[11],y=o[12],M=o[13],S=o[14],D=o[15];if(r[0].setComponents(d-l,h-u,w-_,D-y).normalize(),r[1].setComponents(d+l,h+u,w+_,D+y).normalize(),r[2].setComponents(d+a,h+f,w+b,D+M).normalize(),r[3].setComponents(d-a,h-f,w-b,D-M).normalize(),r[4].setComponents(d-c,h-m,w-v,D-S).normalize(),i===WebGLCoordinateSystem)r[5].setComponents(d+c,h+m,w+v,D+S).normalize();else if(i===WebGPUCoordinateSystem)r[5].setComponents(c,m,v,S).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),_sphere$5.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),_sphere$5.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(_sphere$5)}intersectsSprite(e){return _sphere$5.center.set(0,0,0),_sphere$5.radius=.7071067811865476,_sphere$5.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$5)}intersectsSphere(e){const i=this.planes,r=e.center,o=-e.radius;for(let l=0;l<6;l++)if(i[l].distanceToPoint(r)<o)return!1;return!0}intersectsBox(e){const i=this.planes;for(let r=0;r<6;r++){const o=i[r];if(_vector$9.x=o.normal.x>0?e.max.x:e.min.x,_vector$9.y=o.normal.y>0?e.max.y:e.min.y,_vector$9.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint(_vector$9)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let s=null,e=!1,i=null,r=null;function o(l,a){i(l,a),r=s.requestAnimationFrame(o)}return{start:function(){e!==!0&&i!==null&&(r=s.requestAnimationFrame(o),e=!0)},stop:function(){s.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(l){i=l},setContext:function(l){s=l}}}function WebGLAttributes(s){const e=new WeakMap;function i(c,d){const u=c.array,f=c.usage,m=u.byteLength,h=s.createBuffer();s.bindBuffer(d,h),s.bufferData(d,u,f),c.onUploadCallback();let _;if(u instanceof Float32Array)_=s.FLOAT;else if(u instanceof Uint16Array)c.isFloat16BufferAttribute?_=s.HALF_FLOAT:_=s.UNSIGNED_SHORT;else if(u instanceof Int16Array)_=s.SHORT;else if(u instanceof Uint32Array)_=s.UNSIGNED_INT;else if(u instanceof Int32Array)_=s.INT;else if(u instanceof Int8Array)_=s.BYTE;else if(u instanceof Uint8Array)_=s.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)_=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:h,type:_,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version,size:m}}function r(c,d,u){const f=d.array,m=d._updateRange,h=d.updateRanges;if(s.bindBuffer(u,c),m.count===-1&&h.length===0&&s.bufferSubData(u,0,f),h.length!==0){for(let _=0,b=h.length;_<b;_++){const v=h[_];s.bufferSubData(u,v.start*f.BYTES_PER_ELEMENT,f,v.start,v.count)}d.clearUpdateRanges()}m.count!==-1&&(s.bufferSubData(u,m.offset*f.BYTES_PER_ELEMENT,f,m.offset,m.count),m.count=-1),d.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),e.get(c)}function l(c){c.isInterleavedBufferAttribute&&(c=c.data);const d=e.get(c);d&&(s.deleteBuffer(d.buffer),e.delete(c))}function a(c,d){if(c.isGLBufferAttribute){const f=e.get(c);(!f||f.version<c.version)&&e.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const u=e.get(c);if(u===void 0)e.set(c,i(c,d));else if(u.version<c.version){if(u.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(u.buffer,c,d),u.version=c.version}}return{get:o,remove:l,update:a}}class PlaneGeometry extends BufferGeometry{constructor(e=1,i=1,r=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:o};const l=e/2,a=i/2,c=Math.floor(r),d=Math.floor(o),u=c+1,f=d+1,m=e/c,h=i/d,_=[],b=[],v=[],w=[];for(let y=0;y<f;y++){const M=y*h-a;for(let S=0;S<u;S++){const D=S*m-l;b.push(D,-M,0),v.push(0,0,1),w.push(S/c),w.push(1-y/d)}}for(let y=0;y<d;y++)for(let M=0;M<c;M++){const S=M+u*y,D=M+u*(y+1),k=M+1+u*(y+1),O=M+1+u*y;_.push(S,D,O),_.push(D,k,O)}this.setIndex(_),this.setAttribute("position",new Float32BufferAttribute(b,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(w,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}}const alphahash_fragment=`
#ifdef USE_ALPHAHASH

	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;

#endif
`,alphahash_pars_fragment=`
#ifdef USE_ALPHAHASH

	/**
	 * See: https://casual-effects.com/research/Wyman2017Hashed/index.html
	 */

	const float ALPHA_HASH_SCALE = 0.05; // Derived from trials only, and may be changed.

	float hash2D( vec2 value ) {

		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );

	}

	float hash3D( vec3 value ) {

		return hash2D( vec2( hash2D( value.xy ), value.z ) );

	}

	float getAlphaHashThreshold( vec3 position ) {

		// Find the discretized derivatives of our coordinates
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );

		// Find two nearest log-discretized noise scales
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);

		// Compute alpha thresholds at our two noise scales
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);

		// Factor to interpolate lerp with
		float lerpFactor = fract( log2( pixScale ) );

		// Interpolate alpha threshold from noise at two scales
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;

		// Pass into CDF to compute uniformly distrib threshold
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);

		// Find our final, uniformly distributed alpha threshold (ατ)
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;

		// Avoids ατ == 0. Could also do ατ =1-ατ
		return clamp( threshold , 1.0e-6, 1.0 );

	}

#endif
`,alphamap_fragment=`
#ifdef USE_ALPHAMAP

	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;

#endif
`,alphamap_pars_fragment=`
#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`,alphatest_fragment=`
#ifdef USE_ALPHATEST

	#ifdef ALPHA_TO_COVERAGE

	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;

	#else

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

#endif
`,alphatest_pars_fragment=`
#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif
`,aomap_fragment=`
#ifdef USE_AOMAP

	// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;

	reflectedLight.indirectDiffuse *= ambientOcclusion;

	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif

	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif

	#if defined( USE_ENVMAP ) && defined( STANDARD )

		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );

		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );

	#endif

#endif
`,aomap_pars_fragment=`
#ifdef USE_AOMAP

	uniform sampler2D aoMap;
	uniform float aoMapIntensity;

#endif
`,batching_pars_vertex=`
#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {

		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );

	}
#endif

#ifdef USE_BATCHING_COLOR

	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {

		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;

	}

#endif
`,batching_vertex=`
#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif
`,begin_vertex=`
vec3 transformed = vec3( position );

#ifdef USE_ALPHAHASH

	vPosition = vec3( position );

#endif
`,beginnormal_vertex=`
vec3 objectNormal = vec3( normal );

#ifdef USE_TANGENT

	vec3 objectTangent = vec3( tangent.xyz );

#endif
`,bsdfs=`

float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {

	// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)
	return 0.25;

}

float D_BlinnPhong( const in float shininess, const in float dotNH ) {

	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );

}

vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );

	vec3 F = F_Schlick( specularColor, 1.0, dotVH );

	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );

	float D = D_BlinnPhong( shininess, dotNH );

	return F * ( G * D );

} // validated

`,iridescence_fragment=`

#ifdef USE_IRIDESCENCE

	// XYZ to linear-sRGB color space
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);

	// Assume air interface for top
	// Note: We don't handle the case fresnel0 == 1
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {

		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );

	}

	// Conversion FO/IOR
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {

		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );

	}

	// ior is a value between 1.0 and 3.0. 1.0 is air interface
	float IorToFresnel0( float transmittedIor, float incidentIor ) {

		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));

	}

	// Fresnel equations for dielectric/dielectric interfaces.
	// Ref: https://belcour.github.io/blog/research/2017/05/01/brdf-thin-film.html
	// Evaluation XYZ sensitivity curves in Fourier space
	vec3 evalSensitivity( float OPD, vec3 shift ) {

		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );

		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;

		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;

	}

	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {

		vec3 I;

		// Force iridescenceIOR -> outsideIOR when thinFilmThickness -> 0.0
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		// Evaluate the cosTheta on the base layer (Snell law)
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );

		// Handle TIR:
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {

			return vec3( 1.0 );

		}

		float cosTheta2 = sqrt( cosTheta2Sq );

		// First interface
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;

		// Second interface
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) ); // guard against 1.0
		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;

		// Phase shift
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;

		// Compound terms
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );

		// Reflectance term for m = 0 (DC term amplitude)
		vec3 C0 = R12 + Rs;
		I = C0;

		// Reflectance term for m > 0 (pairs of diracs)
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {

			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;

		}

		// Since out of gamut colors might be produced, negative color values are clamped to 0.
		return max( I, vec3( 0.0 ) );

	}

#endif

`,bumpmap_pars_fragment=`
#ifdef USE_BUMPMAP

	uniform sampler2D bumpMap;
	uniform float bumpScale;

	// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
	// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

	vec2 dHdxy_fwd() {

		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );

		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;

		return vec2( dBx, dBy );

	}

	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

		// normalize is done to ensure that the bump map looks the same regardless of the texture's scale
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm; // normalized

		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );

		float fDet = dot( vSigmaX, R1 ) * faceDirection;

		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );

	}

#endif
`,clipping_planes_fragment=`
#if NUM_CLIPPING_PLANES > 0

	vec4 plane;

	#ifdef ALPHA_TO_COVERAGE

		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;

		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {

			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );

			if ( clipOpacity == 0.0 ) discard;

		}
		#pragma unroll_loop_end

		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES

			float unionClipOpacity = 1.0;

			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {

				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );

			}
			#pragma unroll_loop_end

			clipOpacity *= 1.0 - unionClipOpacity;

		#endif

		diffuseColor.a *= clipOpacity;

		if ( diffuseColor.a == 0.0 ) discard;

	#else

		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {

			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;

		}
		#pragma unroll_loop_end

		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES

			bool clipped = true;

			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {

				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;

			}
			#pragma unroll_loop_end

			if ( clipped ) discard;

		#endif

	#endif

#endif
`,clipping_planes_pars_fragment=`
#if NUM_CLIPPING_PLANES > 0

	varying vec3 vClipPosition;

	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];

#endif
`,clipping_planes_pars_vertex=`
#if NUM_CLIPPING_PLANES > 0

	varying vec3 vClipPosition;

#endif
`,clipping_planes_vertex=`
#if NUM_CLIPPING_PLANES > 0

	vClipPosition = - mvPosition.xyz;

#endif
`,color_fragment=`
#if defined( USE_COLOR_ALPHA )

	diffuseColor *= vColor;

#elif defined( USE_COLOR )

	diffuseColor.rgb *= vColor;

#endif
`,color_pars_fragment=`
#if defined( USE_COLOR_ALPHA )

	varying vec4 vColor;

#elif defined( USE_COLOR )

	varying vec3 vColor;

#endif
`,color_pars_vertex=`
#if defined( USE_COLOR_ALPHA )

	varying vec4 vColor;

#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )

	varying vec3 vColor;

#endif
`,color_vertex=`
#if defined( USE_COLOR_ALPHA )

	vColor = vec4( 1.0 );

#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )

	vColor = vec3( 1.0 );

#endif

#ifdef USE_COLOR

	vColor *= color;

#endif

#ifdef USE_INSTANCING_COLOR

	vColor.xyz *= instanceColor.xyz;

#endif

#ifdef USE_BATCHING_COLOR

	vec3 batchingColor = getBatchingColor( batchId );

	vColor.xyz *= batchingColor.xyz;

#endif
`,common=`
#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6

#ifndef saturate
// <tonemapping_pars_fragment> may have defined saturate() already
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )

float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }

// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.
// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand( const in vec2 uv ) {

	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );

	return fract( sin( sn ) * c );

}

#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif

struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};

struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};

#ifdef USE_ALPHAHASH

	varying vec3 vPosition;

#endif

vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

}

vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {

	// dir can be either a direction vector or a normal vector
	// upper-left 3x3 of matrix is assumed to be orthogonal

	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );

}

mat3 transposeMat3( const in mat3 m ) {

	mat3 tmp;

	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );

	return tmp;

}

float luminance( const in vec3 rgb ) {

	// assumes rgb is in linear color space with sRGB primaries and D65 white point

	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );

	return dot( weights, rgb );

}

bool isPerspectiveMatrix( mat4 m ) {

	return m[ 2 ][ 3 ] == - 1.0;

}

vec2 equirectUv( in vec3 dir ) {

	// dir is assumed to be unit length

	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;

	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;

	return vec2( u, v );

}

vec3 BRDF_Lambert( const in vec3 diffuseColor ) {

	return RECIPROCAL_PI * diffuseColor;

} // validated

vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {

	// Original approximation by Christophe Schlick '94
	// float fresnel = pow( 1.0 - dotVH, 5.0 );

	// Optimized variant (presented by Epic at SIGGRAPH '13)
	// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );

	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );

} // validated

float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {

	// Original approximation by Christophe Schlick '94
	// float fresnel = pow( 1.0 - dotVH, 5.0 );

	// Optimized variant (presented by Epic at SIGGRAPH '13)
	// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );

	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );

} // validated
`,cube_uv_reflection_fragment=`
#ifdef ENVMAP_TYPE_CUBE_UV

	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0

	// These shader functions convert between the UV coordinates of a single face of
	// a cubemap, the 0-5 integer index of a cube face, and the direction vector for
	// sampling a textureCube (not generally normalized ).

	float getFace( vec3 direction ) {

		vec3 absDirection = abs( direction );

		float face = - 1.0;

		if ( absDirection.x > absDirection.z ) {

			if ( absDirection.x > absDirection.y )

				face = direction.x > 0.0 ? 0.0 : 3.0;

			else

				face = direction.y > 0.0 ? 1.0 : 4.0;

		} else {

			if ( absDirection.z > absDirection.y )

				face = direction.z > 0.0 ? 2.0 : 5.0;

			else

				face = direction.y > 0.0 ? 1.0 : 4.0;

		}

		return face;

	}

	// RH coordinate system; PMREM face-indexing convention
	vec2 getUV( vec3 direction, float face ) {

		vec2 uv;

		if ( face == 0.0 ) {

			uv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x

		} else if ( face == 1.0 ) {

			uv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y

		} else if ( face == 2.0 ) {

			uv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z

		} else if ( face == 3.0 ) {

			uv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x

		} else if ( face == 4.0 ) {

			uv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y

		} else {

			uv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z

		}

		return 0.5 * ( uv + 1.0 );

	}

	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {

		float face = getFace( direction );

		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );

		mipInt = max( mipInt, cubeUV_minMipLevel );

		float faceSize = exp2( mipInt );

		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0; // #25071

		if ( face > 2.0 ) {

			uv.y += faceSize;

			face -= 3.0;

		}

		uv.x += face * faceSize;

		uv.x += filterInt * 3.0 * cubeUV_minTileSize;

		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );

		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;

		#ifdef texture2DGradEXT

			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb; // disable anisotropic filtering

		#else

			return texture2D( envMap, uv ).rgb;

		#endif

	}

	// These defines must match with PMREMGenerator

	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0

	float roughnessToMip( float roughness ) {

		float mip = 0.0;

		if ( roughness >= cubeUV_r1 ) {

			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;

		} else if ( roughness >= cubeUV_r4 ) {

			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;

		} else if ( roughness >= cubeUV_r5 ) {

			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;

		} else if ( roughness >= cubeUV_r6 ) {

			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;

		} else {

			mip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25
		}

		return mip;

	}

	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {

		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );

		float mipF = fract( mip );

		float mipInt = floor( mip );

		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );

		if ( mipF == 0.0 ) {

			return vec4( color0, 1.0 );

		} else {

			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );

			return vec4( mix( color0, color1, mipF ), 1.0 );

		}

	}

#endif
`,defaultnormal_vertex=`

vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT

	vec3 transformedTangent = objectTangent;

#endif

#ifdef USE_BATCHING

	// this is in lieu of a per-instance normal-matrix
	// shear transforms in the instance matrix are not supported

	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;

	#ifdef USE_TANGENT

		transformedTangent = bm * transformedTangent;

	#endif

#endif

#ifdef USE_INSTANCING

	// this is in lieu of a per-instance normal-matrix
	// shear transforms in the instance matrix are not supported

	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;

	#ifdef USE_TANGENT

		transformedTangent = im * transformedTangent;

	#endif

#endif

transformedNormal = normalMatrix * transformedNormal;

#ifdef FLIP_SIDED

	transformedNormal = - transformedNormal;

#endif

#ifdef USE_TANGENT

	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;

	#ifdef FLIP_SIDED

		transformedTangent = - transformedTangent;

	#endif

#endif
`,displacementmap_pars_vertex=`
#ifdef USE_DISPLACEMENTMAP

	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;

#endif
`,displacementmap_vertex=`
#ifdef USE_DISPLACEMENTMAP

	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
    
#endif
`,emissivemap_fragment=`
#ifdef USE_EMISSIVEMAP

	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );

	totalEmissiveRadiance *= emissiveColor.rgb;

#endif
`,emissivemap_pars_fragment=`
#ifdef USE_EMISSIVEMAP

	uniform sampler2D emissiveMap;

#endif
`,colorspace_fragment=`
gl_FragColor = linearToOutputTexel( gl_FragColor );
`,colorspace_pars_fragment=`

// http://www.russellcottrell.com/photo/matrixCalculator.htm

// Linear sRGB => XYZ => Linear Display P3
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);

// Linear Display P3 => XYZ => Linear sRGB
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);

vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}

vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}

vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}

vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}

// @deprecated, r156
vec4 LinearToLinear( in vec4 value ) {
	return value;
}

// @deprecated, r156
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}
`,envmap_fragment=`
#ifdef USE_ENVMAP

	#ifdef ENV_WORLDPOS

		vec3 cameraToFrag;

		if ( isOrthographic ) {

			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );

		} else {

			cameraToFrag = normalize( vWorldPosition - cameraPosition );

		}

		// Transforming Normal Vectors with the Inverse Transformation
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

		#ifdef ENVMAP_MODE_REFLECTION

			vec3 reflectVec = reflect( cameraToFrag, worldNormal );

		#else

			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );

		#endif

	#else

		vec3 reflectVec = vReflect;

	#endif

	#ifdef ENVMAP_TYPE_CUBE

		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );

	#else

		vec4 envColor = vec4( 0.0 );

	#endif

	#ifdef ENVMAP_BLENDING_MULTIPLY

		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );

	#elif defined( ENVMAP_BLENDING_MIX )

		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );

	#elif defined( ENVMAP_BLENDING_ADD )

		outgoingLight += envColor.xyz * specularStrength * reflectivity;

	#endif

#endif
`,envmap_common_pars_fragment=`
#ifdef USE_ENVMAP

	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;

	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif
`,envmap_pars_fragment=`
#ifdef USE_ENVMAP

	uniform float reflectivity;

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )

		#define ENV_WORLDPOS

	#endif

	#ifdef ENV_WORLDPOS

		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif

#endif
`,envmap_pars_vertex=`
#ifdef USE_ENVMAP

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )

		#define ENV_WORLDPOS

	#endif

	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;

	#else

		varying vec3 vReflect;
		uniform float refractionRatio;

	#endif

#endif
`,envmap_vertex=`
#ifdef USE_ENVMAP

	#ifdef ENV_WORLDPOS

		vWorldPosition = worldPosition.xyz;

	#else

		vec3 cameraToVertex;

		if ( isOrthographic ) {

			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );

		} else {

			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );

		}

		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );

		#ifdef ENVMAP_MODE_REFLECTION

			vReflect = reflect( cameraToVertex, worldNormal );

		#else

			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );

		#endif

	#endif

#endif
`,fog_vertex=`
#ifdef USE_FOG

	vFogDepth = - mvPosition.z;

#endif
`,fog_pars_vertex=`
#ifdef USE_FOG

	varying float vFogDepth;

#endif
`,fog_fragment=`
#ifdef USE_FOG

	#ifdef FOG_EXP2

		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );

	#else

		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );

	#endif

	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );

#endif
`,fog_pars_fragment=`
#ifdef USE_FOG

	uniform vec3 fogColor;
	varying float vFogDepth;

	#ifdef FOG_EXP2

		uniform float fogDensity;

	#else

		uniform float fogNear;
		uniform float fogFar;

	#endif

#endif
`,gradientmap_pars_fragment=`

#ifdef USE_GRADIENTMAP

	uniform sampler2D gradientMap;

#endif

vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {

	// dotNL will be from -1.0 to 1.0
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );

	#ifdef USE_GRADIENTMAP

		return vec3( texture2D( gradientMap, coord ).r );

	#else

		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );

	#endif

}
`,lightmap_pars_fragment=`
#ifdef USE_LIGHTMAP

	uniform sampler2D lightMap;
	uniform float lightMapIntensity;

#endif
`,lights_lambert_fragment=`
LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;
`,lights_lambert_pars_fragment=`
varying vec3 vViewPosition;

struct LambertMaterial {

	vec3 diffuseColor;
	float specularStrength;

};

void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
`,lights_pars_begin=`
uniform bool receiveShadow;
uniform vec3 ambientLightColor;

#if defined( USE_LIGHT_PROBES )

	uniform vec3 lightProbe[ 9 ];

#endif

// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere
// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {

	// normal is assumed to have unit length

	float x = normal.x, y = normal.y, z = normal.z;

	// band 0
	vec3 result = shCoefficients[ 0 ] * 0.886227;

	// band 1
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;

	// band 2
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );

	return result;

}

vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {

	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );

	return irradiance;

}

vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {

	vec3 irradiance = ambientLightColor;

	return irradiance;

}

float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {

	// based upon Frostbite 3 Moving to Physically-based Rendering
	// page 32, equation 26: E[window1]
	// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );

	if ( cutoffDistance > 0.0 ) {

		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );

	}

	return distanceFalloff;

}

float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {

	return smoothstep( coneCosine, penumbraCosine, angleCosine );

}

#if NUM_DIR_LIGHTS > 0

	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};

	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];

	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {

		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;

	}

#endif


#if NUM_POINT_LIGHTS > 0

	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};

	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];

	// light is an out parameter as having it as a return value caused compiler errors on some devices
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {

		vec3 lVector = pointLight.position - geometryPosition;

		light.direction = normalize( lVector );

		float lightDistance = length( lVector );

		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );

	}

#endif


#if NUM_SPOT_LIGHTS > 0

	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};

	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];

	// light is an out parameter as having it as a return value caused compiler errors on some devices
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {

		vec3 lVector = spotLight.position - geometryPosition;

		light.direction = normalize( lVector );

		float angleCos = dot( light.direction, spotLight.direction );

		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );

		if ( spotAttenuation > 0.0 ) {

			float lightDistance = length( lVector );

			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );

		} else {

			light.color = vec3( 0.0 );
			light.visible = false;

		}

	}

#endif


#if NUM_RECT_AREA_LIGHTS > 0

	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};

	// Pre-computed values of LinearTransformedCosine approximation of BRDF
	// BRDF approximation Texture is 64x64
	uniform sampler2D ltc_1; // RGBA Float
	uniform sampler2D ltc_2; // RGBA Float

	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];

#endif


#if NUM_HEMI_LIGHTS > 0

	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};

	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];

	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {

		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;

		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );

		return irradiance;

	}

#endif
`,envmap_physical_pars_fragment=`
#ifdef USE_ENVMAP

	vec3 getIBLIrradiance( const in vec3 normal ) {

		#ifdef ENVMAP_TYPE_CUBE_UV

			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );

			return PI * envMapColor.rgb * envMapIntensity;

		#else

			return vec3( 0.0 );

		#endif

	}

	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {

		#ifdef ENVMAP_TYPE_CUBE_UV

			vec3 reflectVec = reflect( - viewDir, normal );

			// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );

			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );

			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );

			return envMapColor.rgb * envMapIntensity;

		#else

			return vec3( 0.0 );

		#endif

	}

	#ifdef USE_ANISOTROPY

		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {

			#ifdef ENVMAP_TYPE_CUBE_UV

			  // https://google.github.io/filament/Filament.md.html#lighting/imagebasedlights/anisotropy
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );

				return getIBLRadiance( viewDir, bentNormal, roughness );

			#else

				return vec3( 0.0 );

			#endif

		}

	#endif

#endif
`,lights_toon_fragment=`
ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
`,lights_toon_pars_fragment=`
varying vec3 vViewPosition;

struct ToonMaterial {

	vec3 diffuseColor;

};

void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
`,lights_phong_fragment=`
BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;
`,lights_phong_pars_fragment=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
`,lights_physical_fragment=`
PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );

vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );

material.roughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.
material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );

#ifdef IOR

	material.ior = ior;

	#ifdef USE_SPECULAR

		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;

		#ifdef USE_SPECULAR_COLORMAP

			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;

		#endif

		#ifdef USE_SPECULAR_INTENSITYMAP

			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;

		#endif

		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );

	#else

		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;

	#endif

	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );

#else

	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;

#endif

#ifdef USE_CLEARCOAT

	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;

	#ifdef USE_CLEARCOATMAP

		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;

	#endif

	#ifdef USE_CLEARCOAT_ROUGHNESSMAP

		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;

	#endif

	material.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model
	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );

#endif

#ifdef USE_DISPERSION

	material.dispersion = dispersion;

#endif

#ifdef USE_IRIDESCENCE

	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;

	#ifdef USE_IRIDESCENCEMAP

		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;

	#endif

	#ifdef USE_IRIDESCENCE_THICKNESSMAP

		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;

	#else

		material.iridescenceThickness = iridescenceThicknessMaximum;

	#endif

#endif

#ifdef USE_SHEEN

	material.sheenColor = sheenColor;

	#ifdef USE_SHEEN_COLORMAP

		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;

	#endif

	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );

	#ifdef USE_SHEEN_ROUGHNESSMAP

		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;

	#endif

#endif

#ifdef USE_ANISOTROPY

	#ifdef USE_ANISOTROPYMAP

		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;

	#else

		vec2 anisotropyV = anisotropyVector;

	#endif

	material.anisotropy = length( anisotropyV );

	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}

	// Roughness along the anisotropy bitangent is the material roughness, while the tangent roughness increases with anisotropy.
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );

	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;

#endif
`,lights_physical_pars_fragment=`

struct PhysicalMaterial {

	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;

	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif

	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif

	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif

	#ifdef IOR
		float ior;
	#endif

	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif

	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif

};

// temporary
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );

vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );

    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {

	float a2 = pow2( alpha );

	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );

	return 0.5 / max( gv + gl, EPSILON );

}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney’s reparameterization
float D_GGX( const in float alpha, const in float dotNH ) {

	float a2 = pow2( alpha );

	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1

	return RECIPROCAL_PI * a2 / pow2( denom );

}

// https://google.github.io/filament/Filament.md.html#materialsystem/anisotropicmodel/anisotropicspecularbrdf
#ifdef USE_ANISOTROPY

	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {

		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );

		return saturate(v);

	}

	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {

		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;

		return RECIPROCAL_PI * a2 * pow2 ( w2 );

	}

#endif

#ifdef USE_CLEARCOAT

	// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {

		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;

		float alpha = pow2( roughness ); // UE4's roughness

		vec3 halfDir = normalize( lightDir + viewDir );

		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );

		vec3 F = F_Schlick( f0, f90, dotVH );

		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );

		float D = D_GGX( alpha, dotNH );

		return F * ( V * D );

	}

#endif

vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {

	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;

	float alpha = pow2( roughness ); // UE4's roughness

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );

	vec3 F = F_Schlick( f0, f90, dotVH );

	#ifdef USE_IRIDESCENCE

		F = mix( F, material.iridescenceFresnel, material.iridescence );

	#endif

	#ifdef USE_ANISOTROPY

		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );

		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );

		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );

	#else

		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );

		float D = D_GGX( alpha, dotNH );

	#endif

	return F * ( V * D );

}

// Rect Area Light

// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines
// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt
// code: https://github.com/selfshadow/ltc_code/

vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {

	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;

	float dotNV = saturate( dot( N, V ) );

	// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );

	uv = uv * LUT_SCALE + LUT_BIAS;

	return uv;

}

float LTC_ClippedSphereFormFactor( const in vec3 f ) {

	// Real-Time Area Lighting: a Journey from Research to Production (p.102)
	// An approximation of the form factor of a horizon-clipped rectangle.

	float l = length( f );

	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );

}

vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {

	float x = dot( v1, v2 );

	float y = abs( x );

	// rational polynomial approximation to theta / sin( theta ) / 2PI
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;

	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;

	return cross( v1, v2 ) * theta_sintheta;

}

vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {

	// bail if point is on back side of plane of light
	// assumes ccw winding order of light vertices
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );

	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );

	// construct orthonormal basis around N
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system

	// compute transform
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );

	// transform rect
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );

	// project rect onto sphere
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );

	// calculate vector form factor
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );

	// adjust for horizon clipping
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );

/*
	// alternate method of adjusting for horizon clipping (see referece)
	// refactoring required
	float len = length( vectorFormFactor );
	float z = vectorFormFactor.z / len;

	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;

	// tabulated horizon-clipped sphere, apparently...
	vec2 uv = vec2( z * 0.5 + 0.5, len );
	uv = uv * LUT_SCALE + LUT_BIAS;

	float scale = texture2D( ltc_2, uv ).w;

	float result = len * scale;
*/

	return vec3( result );

}

// End Rect Area Light

#if defined( USE_SHEEN )

// https://github.com/google/filament/blob/master/shaders/src/brdf.fs
float D_Charlie( float roughness, float dotNH ) {

	float alpha = pow2( roughness );

	// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16

	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );

}

// https://github.com/google/filament/blob/master/shaders/src/brdf.fs
float V_Neubelt( float dotNV, float dotNL ) {

	// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );

}

vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );

	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );

	return sheenColor * ( D * V );

}

#endif

// This is a curve-fit approxmation to the "Charlie sheen" BRDF integrated over the hemisphere from 
// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF". The analysis can be found
// in the Sheen section of https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {

	float dotNV = saturate( dot( normal, viewDir ) );

	float r2 = roughness * roughness;

	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;

	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;

	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );

	return saturate( DG * RECIPROCAL_PI );

}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {

	float dotNV = saturate( dot( normal, viewDir ) );

	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );

	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );

	vec4 r = roughness * c0 + c1;

	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;

	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;

	return fab;

}

vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {

	vec2 fab = DFGApprox( normal, viewDir, roughness );

	return specularColor * fab.x + specularF90 * fab.y;

}

// Fdez-Agüera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif

	vec2 fab = DFGApprox( normal, viewDir, roughness );

	#ifdef USE_IRIDESCENCE

		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );

	#else

		vec3 Fr = specularColor;

	#endif

	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;

	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;

	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619; // 1/21
	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );

	singleScatter += FssEss;
	multiScatter += Fms * Ems;

}

#if NUM_RECT_AREA_LIGHTS > 0

	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;

		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction
		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;

		vec2 uv = LTC_Uv( normal, viewDir, roughness );

		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );

		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);

		// LTC Fresnel Approximation by Stephen Hill
		// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );

		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );

		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );

	}

#endif

void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );

	vec3 irradiance = dotNL * directLight.color;

	#ifdef USE_CLEARCOAT

		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );

		vec3 ccIrradiance = dotNLcc * directLight.color;

		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );

	#endif

	#ifdef USE_SHEEN

		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );

	#endif

	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {

	#ifdef USE_CLEARCOAT

		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );

	#endif

	#ifdef USE_SHEEN

		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );

	#endif

	// Both indirect specular and indirect diffuse light accumulate here

	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;

	#ifdef USE_IRIDESCENCE

		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );

	#else

		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );

	#endif

	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );

	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;

	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;

}

#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical

// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {

	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );

}
`,lights_fragment_begin=`
/**
 * This is a template that can be used to light a material, it uses pluggable
 * RenderEquations (RE)for specific lighting scenarios.
 *
 * Instructions for use:
 * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined
 * - Create a material parameter that is to be passed as the third parameter to your lighting functions.
 *
 * TODO:
 * - Add area light support.
 * - Add sphere light support.
 * - Add diffuse light probe (irradiance cubemap) support.
 */

vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

vec3 geometryClearcoatNormal = vec3( 0.0 );

#ifdef USE_CLEARCOAT

	geometryClearcoatNormal = clearcoatNormal;

#endif

#ifdef USE_IRIDESCENCE

	float dotNVi = saturate( dot( normal, geometryViewDir ) );

	if ( material.iridescenceThickness == 0.0 ) {

		material.iridescence = 0.0;

	} else {

		material.iridescence = saturate( material.iridescence );

	}

	if ( material.iridescence > 0.0 ) {

		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );

		// Iridescence F0 approximation
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );

	}

#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometryPosition, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;

	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometryPosition, directLight );

		// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif

		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif

		#undef SPOT_LIGHT_MAP_INDEX

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	#if defined( USE_LIGHT_PROBES )

		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );

	#endif

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`,lights_fragment_maps=`
#if defined( RE_IndirectDiffuse )

	#ifdef USE_LIGHTMAP

		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;

		irradiance += lightMapIrradiance;

	#endif

	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )

		iblIrradiance += getIBLIrradiance( geometryNormal );

	#endif

#endif

#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )

	#ifdef USE_ANISOTROPY

		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );

	#else

		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );

	#endif

	#ifdef USE_CLEARCOAT

		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );

	#endif

#endif
`,lights_fragment_end=`
#if defined( RE_IndirectDiffuse )

	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

#endif

#if defined( RE_IndirectSpecular )

	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

#endif
`,logdepthbuf_fragment=`
#if defined( USE_LOGDEPTHBUF )

	// Doing a strict comparison with == 1.0 can cause noise artifacts
	// on some platforms. See issue #17623.
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;

#endif
`,logdepthbuf_pars_fragment=`
#if defined( USE_LOGDEPTHBUF )

	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;

#endif
`,logdepthbuf_pars_vertex=`
#ifdef USE_LOGDEPTHBUF

	varying float vFragDepth;
	varying float vIsPerspective;

#endif
`,logdepthbuf_vertex=`
#ifdef USE_LOGDEPTHBUF

	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );

#endif
`,map_fragment=`
#ifdef USE_MAP

	vec4 sampledDiffuseColor = texture2D( map, vMapUv );

	#ifdef DECODE_VIDEO_TEXTURE

		// use inline sRGB decode until browsers properly support SRGB8_ALPHA8 with video textures (#26516)

		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif

	diffuseColor *= sampledDiffuseColor;

#endif
`,map_pars_fragment=`
#ifdef USE_MAP

	uniform sampler2D map;

#endif
`,map_particle_fragment=`
#if defined( USE_MAP ) || defined( USE_ALPHAMAP )

	#if defined( USE_POINTS_UV )

		vec2 uv = vUv;

	#else

		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;

	#endif

#endif

#ifdef USE_MAP

	diffuseColor *= texture2D( map, uv );

#endif

#ifdef USE_ALPHAMAP

	diffuseColor.a *= texture2D( alphaMap, uv ).g;

#endif
`,map_particle_pars_fragment=`
#if defined( USE_POINTS_UV )

	varying vec2 vUv;

#else

	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )

		uniform mat3 uvTransform;

	#endif

#endif

#ifdef USE_MAP

	uniform sampler2D map;

#endif

#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`,metalnessmap_fragment=`
float metalnessFactor = metalness;

#ifdef USE_METALNESSMAP

	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );

	// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	metalnessFactor *= texelMetalness.b;

#endif
`,metalnessmap_pars_fragment=`
#ifdef USE_METALNESSMAP

	uniform sampler2D metalnessMap;

#endif
`,morphinstance_vertex=`
#ifdef USE_INSTANCING_MORPH

	float morphTargetInfluences[ MORPHTARGETS_COUNT ];

	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;

	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;

	}
#endif
`,morphcolor_vertex=`
#if defined( USE_MORPHCOLORS )

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	vColor *= morphTargetBaseInfluence;

	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

		#if defined( USE_COLOR_ALPHA )

			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];

		#elif defined( USE_COLOR )

			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];

		#endif

	}

#endif
`,morphnormal_vertex=`
#ifdef USE_MORPHNORMALS

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	objectNormal *= morphTargetBaseInfluence;

	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];

	}

#endif
`,morphtarget_pars_vertex=`
#ifdef USE_MORPHTARGETS

	#ifndef USE_INSTANCING_MORPH

		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];

	#endif

	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;

	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {

		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;

		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );

	}

#endif
`,morphtarget_vertex=`
#ifdef USE_MORPHTARGETS

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	transformed *= morphTargetBaseInfluence;

	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];

	}

#endif
`,normal_fragment_begin=`
float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;

#ifdef FLAT_SHADED

	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );

#else

	vec3 normal = normalize( vNormal );

	#ifdef DOUBLE_SIDED

		normal *= faceDirection;

	#endif

#endif

#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )

	#ifdef USE_TANGENT

		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );

	#else

		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);

	#endif

	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )

		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;

	#endif

#endif

#ifdef USE_CLEARCOAT_NORMALMAP

	#ifdef USE_TANGENT

		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );

	#else

		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );

	#endif

	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )

		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;

	#endif

#endif

// non perturbed normal for clearcoat among others

vec3 nonPerturbedNormal = normal;

`,normal_fragment_maps=`

#ifdef USE_NORMALMAP_OBJECTSPACE

	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals

	#ifdef FLIP_SIDED

		normal = - normal;

	#endif

	#ifdef DOUBLE_SIDED

		normal = normal * faceDirection;

	#endif

	normal = normalize( normalMatrix * normal );

#elif defined( USE_NORMALMAP_TANGENTSPACE )

	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;

	normal = normalize( tbn * mapN );

#elif defined( USE_BUMPMAP )

	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );

#endif
`,normal_pars_fragment=`
#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif
`,normal_pars_vertex=`
#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif
`,normal_vertex=`
#ifndef FLAT_SHADED // normal is computed with derivatives when FLAT_SHADED

	vNormal = normalize( transformedNormal );

	#ifdef USE_TANGENT

		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );

	#endif

#endif
`,normalmap_pars_fragment=`
#ifdef USE_NORMALMAP

	uniform sampler2D normalMap;
	uniform vec2 normalScale;

#endif

#ifdef USE_NORMALMAP_OBJECTSPACE

	uniform mat3 normalMatrix;

#endif

#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )

	// Normal Mapping Without Precomputed Tangents
	// http://www.thetenthplanet.de/archives/1180

	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {

		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );

		vec3 N = surf_norm; // normalized

		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );

		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;

		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );

		return mat3( T * scale, B * scale, N );

	}

#endif
`,clearcoat_normal_fragment_begin=`
#ifdef USE_CLEARCOAT

	vec3 clearcoatNormal = nonPerturbedNormal;

#endif
`,clearcoat_normal_fragment_maps=`
#ifdef USE_CLEARCOAT_NORMALMAP

	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;

	clearcoatNormal = normalize( tbn2 * clearcoatMapN );

#endif
`,clearcoat_pars_fragment=`

#ifdef USE_CLEARCOATMAP

	uniform sampler2D clearcoatMap;

#endif

#ifdef USE_CLEARCOAT_NORMALMAP

	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;

#endif

#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform sampler2D clearcoatRoughnessMap;

#endif
`,iridescence_pars_fragment=`

#ifdef USE_IRIDESCENCEMAP

	uniform sampler2D iridescenceMap;

#endif

#ifdef USE_IRIDESCENCE_THICKNESSMAP

	uniform sampler2D iridescenceThicknessMap;

#endif
`,opaque_fragment=`
#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif

#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif

gl_FragColor = vec4( outgoingLight, diffuseColor.a );
`,packing=`
vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}

vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}

const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)

const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

const float ShiftRight8 = 1. / 256.;

vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8; // tidy overflow
	return r * PackUpscale;
}

float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}

vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}

float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}

vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}

vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}

// NOTE: viewZ, the z-coordinate in camera space, is negative for points in front of the camera

float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	// -near maps to 0; -far maps to 1
	return ( viewZ + near ) / ( near - far );
}

float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	// maps orthographic depth in [ 0, 1 ] to viewZ
	return depth * ( near - far ) - near;
}

// NOTE: https://twitter.com/gonnavis/status/1377183786949959682

float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	// -near maps to 0; -far maps to 1
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}

float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	// maps perspective depth in [ 0, 1 ] to viewZ
	return ( near * far ) / ( ( far - near ) * depth - far );
}
`,premultiplied_alpha_fragment=`
#ifdef PREMULTIPLIED_ALPHA

	// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.
	gl_FragColor.rgb *= gl_FragColor.a;

#endif
`,project_vertex=`
vec4 mvPosition = vec4( transformed, 1.0 );

#ifdef USE_BATCHING

	mvPosition = batchingMatrix * mvPosition;

#endif

#ifdef USE_INSTANCING

	mvPosition = instanceMatrix * mvPosition;

#endif

mvPosition = modelViewMatrix * mvPosition;

gl_Position = projectionMatrix * mvPosition;
`,dithering_fragment=`
#ifdef DITHERING

	gl_FragColor.rgb = dithering( gl_FragColor.rgb );

#endif
`,dithering_pars_fragment=`
#ifdef DITHERING

	// based on https://www.shadertoy.com/view/MslGR8
	vec3 dithering( vec3 color ) {
		//Calculate grid position
		float grid_position = rand( gl_FragCoord.xy );

		//Shift the individual colors differently, thus making it even harder to see the dithering pattern
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );

		//modify shift according to grid position.
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );

		//shift the color by dither_shift
		return color + dither_shift_RGB;
	}

#endif
`,roughnessmap_fragment=`
float roughnessFactor = roughness;

#ifdef USE_ROUGHNESSMAP

	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );

	// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	roughnessFactor *= texelRoughness.g;

#endif
`,roughnessmap_pars_fragment=`
#ifdef USE_ROUGHNESSMAP

	uniform sampler2D roughnessMap;

#endif
`,shadowmap_pars_fragment=`
#if NUM_SPOT_LIGHT_COORDS > 0

	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];

#endif

#if NUM_SPOT_LIGHT_MAPS > 0

	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];

#endif

#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];

		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};

		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): create uniforms for area light shadows

	#endif
	*/

	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

	}

	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

		return unpackRGBATo2Half( texture2D( shadow, uv ) );

	}

	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

		float occlusion = 1.0;

		vec2 distribution = texture2DDistribution( shadow, uv );

		float hard_shadow = step( compare , distribution.x ); // Hard Shadow

		if (hard_shadow != 1.0 ) {

			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

		}
		return occlusion;

	}

	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

		float shadow = 1.0;

		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;

		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;

		if ( frustumTest ) {

		#if defined( SHADOWMAP_TYPE_PCF )

			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;

			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;

			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );

		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )

			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;

			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;

			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );

		#elif defined( SHADOWMAP_TYPE_VSM )

			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

		#else // no percentage-closer filtering:

			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

		#endif

		}

		return shadow;

	}

	// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
	// vector suitable for 2D texture mapping. This code uses the following layout for the
	// 2D texture:
	//
	// xzXZ
	//  y Y
	//
	// Y - Positive y direction
	// y - Negative y direction
	// X - Positive x direction
	// x - Negative x direction
	// Z - Positive z direction
	// z - Negative z direction
	//
	// Source and test bed:
	// https://gist.github.com/tschw/da10c43c467ce8afd0c4

	vec2 cubeToUV( vec3 v, float texelSizeY ) {

		// Number of texels to avoid at the edge of each square

		vec3 absV = abs( v );

		// Intersect unit cube

		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;

		// Apply scale to avoid seams

		// two texels less per square (one texel will do for NEAREST)
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

		// Unwrap

		// space: -1 ... 1 range for each square
		//
		// #X##		dim    := ( 4 , 2 )
		//  # #		center := ( 1 , 1 )

		vec2 planar = v.xy;

		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;

		if ( absV.z >= almostOne ) {

			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;

		} else if ( absV.x >= almostOne ) {

			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;

		} else if ( absV.y >= almostOne ) {

			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;

		}

		// Transform to UV space

		// scale := 0.5 / dim
		// translate := ( center + 0.5 ) / dim
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

	}

	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

		float shadow = 1.0;

		// for point lights, the uniform @vShadowCoord is re-purposed to hold
		// the vector from the light to the world-space position of the fragment.
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );

		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {

			// dp = normalized distance from light to fragment position
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
			dp += shadowBias;

			// bd3D = base direction 3D
			vec3 bd3D = normalize( lightToPosition );

			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )

				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;

				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );

			#else // no percentage-closer filtering

				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );

			#endif

		}

		return shadow;

	}

#endif
`,shadowmap_pars_vertex=`

#if NUM_SPOT_LIGHT_COORDS > 0

	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];

#endif

#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};

		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): uniforms for area light shadows

	#endif
	*/

#endif
`,shadowmap_vertex=`

#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )

	// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;

#endif

#if defined( USE_SHADOWMAP )

	#if NUM_DIR_LIGHT_SHADOWS > 0

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {

			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;

		}
		#pragma unroll_loop_end

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {

			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;

		}
		#pragma unroll_loop_end

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): update vAreaShadowCoord with area light info

	#endif
	*/

#endif

// spot lights can be evaluated without active shadow mapping (when SpotLight.map is used)

#if NUM_SPOT_LIGHT_COORDS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {

		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;

	}
	#pragma unroll_loop_end

#endif


`,shadowmask_pars_fragment=`
float getShadowMask() {

	float shadow = 1.0;

	#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

	DirectionalLightShadow directionalLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {

		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

	SpotLightShadow spotLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {

		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

	PointLightShadow pointLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {

		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): update shadow for Area light

	#endif
	*/

	#endif

	return shadow;

}
`,skinbase_vertex=`
#ifdef USE_SKINNING

	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );

#endif
`,skinning_pars_vertex=`
#ifdef USE_SKINNING

	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;

	uniform highp sampler2D boneTexture;

	mat4 getBoneMatrix( const in float i ) {

		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );

		return mat4( v1, v2, v3, v4 );

	}

#endif
`,skinning_vertex=`
#ifdef USE_SKINNING

	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );

	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;

	transformed = ( bindMatrixInverse * skinned ).xyz;

#endif
`,skinnormal_vertex=`
#ifdef USE_SKINNING

	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;

	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;

	#ifdef USE_TANGENT

		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;

	#endif

#endif
`,specularmap_fragment=`
float specularStrength;

#ifdef USE_SPECULARMAP

	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;

#else

	specularStrength = 1.0;

#endif
`,specularmap_pars_fragment=`
#ifdef USE_SPECULARMAP

	uniform sampler2D specularMap;

#endif
`,tonemapping_fragment=`
#if defined( TONE_MAPPING )

	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );

#endif
`,tonemapping_pars_fragment=`
#ifndef saturate
// <common> may have defined saturate() already
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif

uniform float toneMappingExposure;

// exposure only
vec3 LinearToneMapping( vec3 color ) {

	return saturate( toneMappingExposure * color );

}

// source: https://www.cs.utah.edu/docs/techreports/2002/pdf/UUCS-02-001.pdf
vec3 ReinhardToneMapping( vec3 color ) {

	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );

}

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
vec3 OptimizedCineonToneMapping( vec3 color ) {

	// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );

}

// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs
vec3 RRTAndODTFit( vec3 v ) {

	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;

}

// this implementation of ACES is modified to accommodate a brighter viewing environment.
// the scale factor of 1/0.6 is subjective. see discussion in #19621.

vec3 ACESFilmicToneMapping( vec3 color ) {

	// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ), // transposed from source
		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);

	// ODT_SAT => XYZ => D60_2_D65 => sRGB
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ), // transposed from source
		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);

	color *= toneMappingExposure / 0.6;

	color = ACESInputMat * color;

	// Apply RRT and ODT
	color = RRTAndODTFit( color );

	color = ACESOutputMat * color;

	// Clamp to [0, 1]
	return saturate( color );

}

// Matrices for rec 2020 <> rec 709 color space conversion
// matrix provided in row-major order so it has been transposed
// https://www.itu.int/pub/R-REP-BT.2407-2017
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);

const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);

// https://iolite-engine.com/blog_posts/minimal_agx_implementation
// Mean error^2: 3.6705141e-06
vec3 agxDefaultContrastApprox( vec3 x ) {

	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;

	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;

}

// AgX Tone Mapping implementation based on Filament, which in turn is based
// on Blender's implementation using rec 2020 primaries
// https://github.com/google/filament/pull/7236
// Inputs and outputs are encoded as Linear-sRGB.

vec3 AgXToneMapping( vec3 color ) {

	// AgX constants
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);

	// explicit AgXOutsetMatrix generated from Filaments AgXOutsetMatrixInv
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);

	// LOG2_MIN      = -10.0
	// LOG2_MAX      =  +6.5
	// MIDDLE_GRAY   =  0.18
	const float AgxMinEv = - 12.47393;  // log2( pow( 2, LOG2_MIN ) * MIDDLE_GRAY )
	const float AgxMaxEv = 4.026069;    // log2( pow( 2, LOG2_MAX ) * MIDDLE_GRAY )

	color *= toneMappingExposure;

	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;

	color = AgXInsetMatrix * color;

	// Log2 encoding
	color = max( color, 1e-10 ); // avoid 0 or negative numbers for log2
	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );

	color = clamp( color, 0.0, 1.0 );

	// Apply sigmoid
	color = agxDefaultContrastApprox( color );

	// Apply AgX look
	// v = agxLook(v, look);

	color = AgXOutsetMatrix * color;

	// Linearize
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );

	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;

	// Gamut mapping. Simple clamp for now.
	color = clamp( color, 0.0, 1.0 );

	return color;

}

// https://modelviewer.dev/examples/tone-mapping

vec3 NeutralToneMapping( vec3 color ) {

	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;

	color *= toneMappingExposure;

	float x = min( color.r, min( color.g, color.b ) );

	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;

	color -= offset;

	float peak = max( color.r, max( color.g, color.b ) );

	if ( peak < StartCompression ) return color;

	float d = 1. - StartCompression;

	float newPeak = 1. - d * d / ( peak + d - StartCompression );

	color *= newPeak / peak;

	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );

	return mix( color, vec3( newPeak ), g );

}

vec3 CustomToneMapping( vec3 color ) { return color; }
`,transmission_fragment=`
#ifdef USE_TRANSMISSION

	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;

	#ifdef USE_TRANSMISSIONMAP

		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;

	#endif

	#ifdef USE_THICKNESSMAP

		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;

	#endif

	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );

	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );

	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );

	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );

#endif
`,transmission_pars_fragment=`
#ifdef USE_TRANSMISSION

	// Transmission code is based on glTF-Sampler-Viewer
	// https://github.com/KhronosGroup/glTF-Sample-Viewer

	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;

	#ifdef USE_TRANSMISSIONMAP

		uniform sampler2D transmissionMap;

	#endif

	#ifdef USE_THICKNESSMAP

		uniform sampler2D thicknessMap;

	#endif

	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;

	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;

	varying vec3 vWorldPosition;

	// Mipped Bicubic Texture Filtering by N8
	// https://www.shadertoy.com/view/Dl2SDW

	float w0( float a ) {

		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );

	}

	float w1( float a ) {

		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );

	}

	float w2( float a ){

		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );

	}

	float w3( float a ) {

		return ( 1.0 / 6.0 ) * ( a * a * a );

	}

	// g0 and g1 are the two amplitude functions
	float g0( float a ) {

		return w0( a ) + w1( a );

	}

	float g1( float a ) {

		return w2( a ) + w3( a );

	}

	// h0 and h1 are the two offset functions
	float h0( float a ) {

		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );

	}

	float h1( float a ) {

		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );

	}

	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {

		uv = uv * texelSize.zw + 0.5;

		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );

		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );

		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;

		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );

	}

	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {

		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );

	}

	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {

		// Direction of refracted light.
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );

		// Compute rotation-independant scaling of the model matrix.
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		// The thickness is specified in local space.
		return normalize( refractionVector ) * thickness * modelScale;

	}

	float applyIorToRoughness( const in float roughness, const in float ior ) {

		// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
		// an IOR of 1.5 results in the default amount of microfacet refraction.
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );

	}

	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {

		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );

	}

	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {

		if ( isinf( attenuationDistance ) ) {

			// Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.
			return vec3( 1.0 );

		} else {

			// Compute light attenuation using Beer's law.
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
			return transmittance;

		}

	}

	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {

		vec4 transmittedLight;
		vec3 transmittance;

		#ifdef USE_DISPERSION

			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );

			for ( int i = 0; i < 3; i ++ ) {

				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				// Sample framebuffer to get pixel the refracted ray hits.
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;

				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];

			}

			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;

			// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;

			// Sample framebuffer to get pixel the refracted ray hits.
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif

		vec3 attenuatedColor = transmittance * transmittedLight.rgb;

		// Get the specular component.
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );

		// As less light is transmitted, the opacity should be increased. This simple approximation does a decent job 
		// of modulating a CSS background, and has no effect when the buffer is opaque, due to a solid object or clear color.
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;

		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );

	}
#endif
`,uv_pars_fragment=`
#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	varying vec2 vUv;

#endif
#ifdef USE_MAP

	varying vec2 vMapUv;

#endif
#ifdef USE_ALPHAMAP

	varying vec2 vAlphaMapUv;

#endif
#ifdef USE_LIGHTMAP

	varying vec2 vLightMapUv;

#endif
#ifdef USE_AOMAP

	varying vec2 vAoMapUv;

#endif
#ifdef USE_BUMPMAP

	varying vec2 vBumpMapUv;

#endif
#ifdef USE_NORMALMAP

	varying vec2 vNormalMapUv;

#endif
#ifdef USE_EMISSIVEMAP

	varying vec2 vEmissiveMapUv;

#endif
#ifdef USE_METALNESSMAP

	varying vec2 vMetalnessMapUv;

#endif
#ifdef USE_ROUGHNESSMAP

	varying vec2 vRoughnessMapUv;

#endif
#ifdef USE_ANISOTROPYMAP

	varying vec2 vAnisotropyMapUv;

#endif
#ifdef USE_CLEARCOATMAP

	varying vec2 vClearcoatMapUv;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	varying vec2 vClearcoatNormalMapUv;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	varying vec2 vClearcoatRoughnessMapUv;

#endif
#ifdef USE_IRIDESCENCEMAP

	varying vec2 vIridescenceMapUv;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	varying vec2 vIridescenceThicknessMapUv;

#endif
#ifdef USE_SHEEN_COLORMAP

	varying vec2 vSheenColorMapUv;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	varying vec2 vSheenRoughnessMapUv;

#endif
#ifdef USE_SPECULARMAP

	varying vec2 vSpecularMapUv;

#endif
#ifdef USE_SPECULAR_COLORMAP

	varying vec2 vSpecularColorMapUv;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	varying vec2 vSpecularIntensityMapUv;

#endif
#ifdef USE_TRANSMISSIONMAP

	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;

#endif
#ifdef USE_THICKNESSMAP

	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;

#endif
`,uv_pars_vertex=`
#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	varying vec2 vUv;

#endif
#ifdef USE_MAP

	uniform mat3 mapTransform;
	varying vec2 vMapUv;

#endif
#ifdef USE_ALPHAMAP

	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;

#endif
#ifdef USE_LIGHTMAP

	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;

#endif
#ifdef USE_AOMAP

	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;

#endif
#ifdef USE_BUMPMAP

	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;

#endif
#ifdef USE_NORMALMAP

	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;

#endif
#ifdef USE_DISPLACEMENTMAP

	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;

#endif
#ifdef USE_EMISSIVEMAP

	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;

#endif
#ifdef USE_METALNESSMAP

	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;

#endif
#ifdef USE_ROUGHNESSMAP

	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;

#endif
#ifdef USE_ANISOTROPYMAP

	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;

#endif
#ifdef USE_CLEARCOATMAP

	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;

#endif
#ifdef USE_SHEEN_COLORMAP

	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;

#endif
#ifdef USE_IRIDESCENCEMAP

	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;

#endif
#ifdef USE_SPECULARMAP

	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;

#endif
#ifdef USE_SPECULAR_COLORMAP

	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;

#endif
#ifdef USE_TRANSMISSIONMAP

	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;

#endif
#ifdef USE_THICKNESSMAP

	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;

#endif
`,uv_vertex=`
#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	vUv = vec3( uv, 1 ).xy;

#endif
#ifdef USE_MAP

	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;

#endif
#ifdef USE_ALPHAMAP

	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_LIGHTMAP

	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_AOMAP

	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_BUMPMAP

	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_NORMALMAP

	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_EMISSIVEMAP

	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_METALNESSMAP

	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_ROUGHNESSMAP

	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_ANISOTROPYMAP

	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_CLEARCOATMAP

	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_SPECULARMAP

	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;

#endif
#ifdef USE_THICKNESSMAP

	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;

#endif
`,worldpos_vertex=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0

	vec4 worldPosition = vec4( transformed, 1.0 );

	#ifdef USE_BATCHING

		worldPosition = batchingMatrix * worldPosition;

	#endif

	#ifdef USE_INSTANCING

		worldPosition = instanceMatrix * worldPosition;

	#endif

	worldPosition = modelMatrix * worldPosition;

#endif
`,vertex$h=`
varying vec2 vUv;
uniform mat3 uvTransform;

void main() {

	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;

	gl_Position = vec4( position.xy, 1.0, 1.0 );

}
`,fragment$h=`
uniform sampler2D t2D;
uniform float backgroundIntensity;

varying vec2 vUv;

void main() {

	vec4 texColor = texture2D( t2D, vUv );

	#ifdef DECODE_VIDEO_TEXTURE

		// use inline sRGB decode until browsers properly support SRGB8_APLHA8 with video textures

		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

	#endif

	texColor.rgb *= backgroundIntensity;

	gl_FragColor = texColor;

	#include <tonemapping_fragment>
	#include <colorspace_fragment>

}
`,vertex$g=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

	gl_Position.z = gl_Position.w; // set z to camera.far

}
`,fragment$g=`

#ifdef ENVMAP_TYPE_CUBE

	uniform samplerCube envMap;

#elif defined( ENVMAP_TYPE_CUBE_UV )

	uniform sampler2D envMap;

#endif

uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;

varying vec3 vWorldDirection;

#include <cube_uv_reflection_fragment>

void main() {

	#ifdef ENVMAP_TYPE_CUBE

		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );

	#elif defined( ENVMAP_TYPE_CUBE_UV )

		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );

	#else

		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );

	#endif

	texColor.rgb *= backgroundIntensity;

	gl_FragColor = texColor;

	#include <tonemapping_fragment>
	#include <colorspace_fragment>

}
`,vertex$f=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

	gl_Position.z = gl_Position.w; // set z to camera.far

}
`,fragment$f=`
uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;

varying vec3 vWorldDirection;

void main() {

	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );

	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;

	#include <tonemapping_fragment>
	#include <colorspace_fragment>

}
`,vertex$e=`
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.
// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for
// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.
varying vec2 vHighPrecisionZW;

void main() {

	#include <uv_vertex>

	#include <batching_vertex>
	#include <skinbase_vertex>

	#include <morphinstance_vertex>

	#ifdef USE_DISPLACEMENTMAP

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vHighPrecisionZW = gl_Position.zw;

}
`,fragment$e=`
#if DEPTH_PACKING == 3200

	uniform float opacity;

#endif

#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

varying vec2 vHighPrecisionZW;

void main() {

	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>

	#if DEPTH_PACKING == 3200

		diffuseColor.a = opacity;

	#endif

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>

	#include <logdepthbuf_fragment>

	// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;

	#if DEPTH_PACKING == 3200

		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );

	#elif DEPTH_PACKING == 3201

		gl_FragColor = packDepthToRGBA( fragCoordZ );

	#endif

}
`,vertex$d=`
#define DISTANCE

varying vec3 vWorldPosition;

#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	#include <batching_vertex>
	#include <skinbase_vertex>

	#include <morphinstance_vertex>

	#ifdef USE_DISPLACEMENTMAP

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>

	vWorldPosition = worldPosition.xyz;

}
`,fragment$d=`
#define DISTANCE

uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;

#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>

void main () {

	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>

	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist ); // clamp to [ 0, 1 ]

	gl_FragColor = packDepthToRGBA( dist );

}
`,vertex$c=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

}
`,fragment$c=`
uniform sampler2D tEquirect;

varying vec3 vWorldDirection;

#include <common>

void main() {

	vec3 direction = normalize( vWorldDirection );

	vec2 sampleUV = equirectUv( direction );

	gl_FragColor = texture2D( tEquirect, sampleUV );

	#include <tonemapping_fragment>
	#include <colorspace_fragment>

}
`,vertex$b=`
uniform float scale;
attribute float lineDistance;

varying float vLineDistance;

#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	vLineDistance = scale * lineDistance;

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

}
`,fragment$b=`
uniform vec3 diffuse;
uniform float opacity;

uniform float dashSize;
uniform float totalSize;

varying float vLineDistance;

#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	if ( mod( vLineDistance, totalSize ) > dashSize ) {

		discard;

	}

	vec3 outgoingLight = vec3( 0.0 );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>

	outgoingLight = diffuseColor.rgb; // simple shader

	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`,vertex$a=`
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>

	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>

}
`,fragment$a=`
uniform vec3 diffuse;
uniform float opacity;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

	// accumulation (baked indirect lighting only)
	#ifdef USE_LIGHTMAP

		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;

	#else

		reflectedLight.indirectDiffuse += vec3( 1.0 );

	#endif

	// modulation
	#include <aomap_fragment>

	reflectedLight.indirectDiffuse *= diffuseColor.rgb;

	vec3 outgoingLight = reflectedLight.indirectDiffuse;

	#include <envmap_fragment>

	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,vertex$9=`
#define LAMBERT

varying vec3 vViewPosition;

#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,fragment$9=`
#define LAMBERT

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,vertex$8=`
#define MATCAP

varying vec3 vViewPosition;

#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>

#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

	vViewPosition = - mvPosition.xyz;

}
`,fragment$8=`
#define MATCAP

uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;

varying vec3 vViewPosition;

#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks

	#ifdef USE_MATCAP

		vec4 matcapColor = texture2D( matcap, uv );

	#else

		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 ); // default if matcap is missing

	#endif

	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;

	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,vertex$7=`
#define NORMAL

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )

	varying vec3 vViewPosition;

#endif

#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <batching_vertex>

	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )

	vViewPosition = - mvPosition.xyz;

#endif

}
`,fragment$7=`
#define NORMAL

uniform float opacity;

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )

	varying vec3 vViewPosition;

#endif

#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	
	#include <alphamap_fragment>
	#include <alphatest_fragment>


	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>

	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );


	#ifdef OPAQUE

		gl_FragColor.a = 1.0;

	#endif

}
`,vertex$6=`
#define PHONG

varying vec3 vViewPosition;

#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>

	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,fragment$6=`
#define PHONG

uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;

	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,vertex$5=`
#define STANDARD

varying vec3 vViewPosition;

#ifdef USE_TRANSMISSION

	varying vec3 vWorldPosition;

#endif

#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

#ifdef USE_TRANSMISSION

	vWorldPosition = worldPosition.xyz;

#endif
}
`,fragment$5=`
#define STANDARD

#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;

#ifdef IOR
	uniform float ior;
#endif

#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;

	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif

	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif

#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif

#ifdef USE_DISPERSION
	uniform float dispersion;
#endif

#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif

#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;

	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif

	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif

#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;

	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif

varying vec3 vViewPosition;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;

	#include <transmission_fragment>

	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;

	#ifdef USE_SHEEN

		// Sheen energy compensation approximation calculation can be found at the end of
		// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );

		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;

	#endif

	#ifdef USE_CLEARCOAT

		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );

		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );

		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;

	#endif

	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,vertex$4=`
#define TOON

varying vec3 vViewPosition;

#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,fragment$4=`
#define TOON

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`,vertex$3=`
uniform float size;
uniform float scale;

#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#ifdef USE_POINTS_UV

	varying vec2 vUv;
	uniform mat3 uvTransform;

#endif

void main() {

	#ifdef USE_POINTS_UV

		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;

	#endif

	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>

	gl_PointSize = size;

	#ifdef USE_SIZEATTENUATION

		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );

	#endif

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>

}
`,fragment$3=`
uniform vec3 diffuse;
uniform float opacity;

#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	vec3 outgoingLight = vec3( 0.0 );

	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>

	outgoingLight = diffuseColor.rgb;

	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`,vertex$2=`
#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>

void main() {

	#include <batching_vertex>

	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,fragment$2=`
uniform vec3 color;
uniform float opacity;

#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>

void main() {

	#include <logdepthbuf_fragment>

	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );

	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>

}
`,vertex$1=`
uniform float rotation;
uniform vec2 center;

#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );

	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

	#ifndef USE_SIZEATTENUATION

		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) scale *= - mvPosition.z;

	#endif

	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;

	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;

	mvPosition.xy += rotatedPosition;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

}
`,fragment$1=`
uniform vec3 diffuse;
uniform float opacity;

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>

	vec3 outgoingLight = vec3( 0.0 );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>

	outgoingLight = diffuseColor.rgb;

	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>

}
`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,batching_pars_vertex,batching_vertex,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphinstance_vertex,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},envMapRotation:{value:new Matrix3},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Matrix3}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0},_e1$1=new Euler,_m1$1=new Matrix4;function WebGLBackground(s,e,i,r,o,l,a){const c=new Color(0);let d=l===!0?0:1,u,f,m=null,h=0,_=null;function b(M){let S=M.isScene===!0?M.background:null;return S&&S.isTexture&&(S=(M.backgroundBlurriness>0?i:e).get(S)),S}function v(M){let S=!1;const D=b(M);D===null?y(c,d):D&&D.isColor&&(y(D,1),S=!0);const k=s.xr.getEnvironmentBlendMode();k==="additive"?r.buffers.color.setClear(0,0,0,1,a):k==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(s.autoClear||S)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil))}function w(M,S){const D=b(S);D&&(D.isCubeTexture||D.mapping===CubeUVReflectionMapping)?(f===void 0&&(f=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(k,O,L){this.matrixWorld.copyPosition(L.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(f)),_e1$1.copy(S.backgroundRotation),_e1$1.x*=-1,_e1$1.y*=-1,_e1$1.z*=-1,D.isCubeTexture&&D.isRenderTargetTexture===!1&&(_e1$1.y*=-1,_e1$1.z*=-1),f.material.uniforms.envMap.value=D,f.material.uniforms.flipEnvMap.value=D.isCubeTexture&&D.isRenderTargetTexture===!1?-1:1,f.material.uniforms.backgroundBlurriness.value=S.backgroundBlurriness,f.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,f.material.uniforms.backgroundRotation.value.setFromMatrix4(_m1$1.makeRotationFromEuler(_e1$1)),f.material.toneMapped=ColorManagement.getTransfer(D.colorSpace)!==SRGBTransfer,(m!==D||h!==D.version||_!==s.toneMapping)&&(f.material.needsUpdate=!0,m=D,h=D.version,_=s.toneMapping),f.layers.enableAll(),M.unshift(f,f.geometry,f.material,0,0,null)):D&&D.isTexture&&(u===void 0&&(u=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(u)),u.material.uniforms.t2D.value=D,u.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,u.material.toneMapped=ColorManagement.getTransfer(D.colorSpace)!==SRGBTransfer,D.matrixAutoUpdate===!0&&D.updateMatrix(),u.material.uniforms.uvTransform.value.copy(D.matrix),(m!==D||h!==D.version||_!==s.toneMapping)&&(u.material.needsUpdate=!0,m=D,h=D.version,_=s.toneMapping),u.layers.enableAll(),M.unshift(u,u.geometry,u.material,0,0,null))}function y(M,S){M.getRGB(_rgb,getUnlitUniformColorSpace(s)),r.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,S,a)}return{getClearColor:function(){return c},setClearColor:function(M,S=1){c.set(M),d=S,y(c,d)},getClearAlpha:function(){return d},setClearAlpha:function(M){d=M,y(c,d)},render:v,addToRenderList:w}}function WebGLBindingStates(s,e){const i=s.getParameter(s.MAX_VERTEX_ATTRIBS),r={},o=h(null);let l=o,a=!1;function c(z,K,Z,V,H){let Y=!1;const q=m(V,Z,K);l!==q&&(l=q,u(l.object)),Y=_(z,V,Z,H),Y&&b(z,V,Z,H),H!==null&&e.update(H,s.ELEMENT_ARRAY_BUFFER),(Y||a)&&(a=!1,D(z,K,Z,V),H!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.get(H).buffer))}function d(){return s.createVertexArray()}function u(z){return s.bindVertexArray(z)}function f(z){return s.deleteVertexArray(z)}function m(z,K,Z){const V=Z.wireframe===!0;let H=r[z.id];H===void 0&&(H={},r[z.id]=H);let Y=H[K.id];Y===void 0&&(Y={},H[K.id]=Y);let q=Y[V];return q===void 0&&(q=h(d()),Y[V]=q),q}function h(z){const K=[],Z=[],V=[];for(let H=0;H<i;H++)K[H]=0,Z[H]=0,V[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:K,enabledAttributes:Z,attributeDivisors:V,object:z,attributes:{},index:null}}function _(z,K,Z,V){const H=l.attributes,Y=K.attributes;let q=0;const J=Z.getAttributes();for(const W in J)if(J[W].location>=0){const ie=H[W];let oe=Y[W];if(oe===void 0&&(W==="instanceMatrix"&&z.instanceMatrix&&(oe=z.instanceMatrix),W==="instanceColor"&&z.instanceColor&&(oe=z.instanceColor)),ie===void 0||ie.attribute!==oe||oe&&ie.data!==oe.data)return!0;q++}return l.attributesNum!==q||l.index!==V}function b(z,K,Z,V){const H={},Y=K.attributes;let q=0;const J=Z.getAttributes();for(const W in J)if(J[W].location>=0){let ie=Y[W];ie===void 0&&(W==="instanceMatrix"&&z.instanceMatrix&&(ie=z.instanceMatrix),W==="instanceColor"&&z.instanceColor&&(ie=z.instanceColor));const oe={};oe.attribute=ie,ie&&ie.data&&(oe.data=ie.data),H[W]=oe,q++}l.attributes=H,l.attributesNum=q,l.index=V}function v(){const z=l.newAttributes;for(let K=0,Z=z.length;K<Z;K++)z[K]=0}function w(z){y(z,0)}function y(z,K){const Z=l.newAttributes,V=l.enabledAttributes,H=l.attributeDivisors;Z[z]=1,V[z]===0&&(s.enableVertexAttribArray(z),V[z]=1),H[z]!==K&&(s.vertexAttribDivisor(z,K),H[z]=K)}function M(){const z=l.newAttributes,K=l.enabledAttributes;for(let Z=0,V=K.length;Z<V;Z++)K[Z]!==z[Z]&&(s.disableVertexAttribArray(Z),K[Z]=0)}function S(z,K,Z,V,H,Y,q){q===!0?s.vertexAttribIPointer(z,K,Z,H,Y):s.vertexAttribPointer(z,K,Z,V,H,Y)}function D(z,K,Z,V){v();const H=V.attributes,Y=Z.getAttributes(),q=K.defaultAttributeValues;for(const J in Y){const W=Y[J];if(W.location>=0){let te=H[J];if(te===void 0&&(J==="instanceMatrix"&&z.instanceMatrix&&(te=z.instanceMatrix),J==="instanceColor"&&z.instanceColor&&(te=z.instanceColor)),te!==void 0){const ie=te.normalized,oe=te.itemSize,Ce=e.get(te);if(Ce===void 0)continue;const ve=Ce.buffer,we=Ce.type,Se=Ce.bytesPerElement,Re=we===s.INT||we===s.UNSIGNED_INT||te.gpuType===IntType;if(te.isInterleavedBufferAttribute){const Fe=te.data,$e=Fe.stride,Ue=te.offset;if(Fe.isInstancedInterleavedBuffer){for(let qe=0;qe<W.locationSize;qe++)y(W.location+qe,Fe.meshPerAttribute);z.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=Fe.meshPerAttribute*Fe.count)}else for(let qe=0;qe<W.locationSize;qe++)w(W.location+qe);s.bindBuffer(s.ARRAY_BUFFER,ve);for(let qe=0;qe<W.locationSize;qe++)S(W.location+qe,oe/W.locationSize,we,ie,$e*Se,(Ue+oe/W.locationSize*qe)*Se,Re)}else{if(te.isInstancedBufferAttribute){for(let Fe=0;Fe<W.locationSize;Fe++)y(W.location+Fe,te.meshPerAttribute);z.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let Fe=0;Fe<W.locationSize;Fe++)w(W.location+Fe);s.bindBuffer(s.ARRAY_BUFFER,ve);for(let Fe=0;Fe<W.locationSize;Fe++)S(W.location+Fe,oe/W.locationSize,we,ie,oe*Se,oe/W.locationSize*Fe*Se,Re)}}else if(q!==void 0){const ie=q[J];if(ie!==void 0)switch(ie.length){case 2:s.vertexAttrib2fv(W.location,ie);break;case 3:s.vertexAttrib3fv(W.location,ie);break;case 4:s.vertexAttrib4fv(W.location,ie);break;default:s.vertexAttrib1fv(W.location,ie)}}}}M()}function k(){P();for(const z in r){const K=r[z];for(const Z in K){const V=K[Z];for(const H in V)f(V[H].object),delete V[H];delete K[Z]}delete r[z]}}function O(z){if(r[z.id]===void 0)return;const K=r[z.id];for(const Z in K){const V=K[Z];for(const H in V)f(V[H].object),delete V[H];delete K[Z]}delete r[z.id]}function L(z){for(const K in r){const Z=r[K];if(Z[z.id]===void 0)continue;const V=Z[z.id];for(const H in V)f(V[H].object),delete V[H];delete Z[z.id]}}function P(){N(),a=!0,l!==o&&(l=o,u(l.object))}function N(){o.geometry=null,o.program=null,o.wireframe=!1}return{setup:c,reset:P,resetDefaultState:N,dispose:k,releaseStatesOfGeometry:O,releaseStatesOfProgram:L,initAttributes:v,enableAttribute:w,disableUnusedAttributes:M}}function WebGLBufferRenderer(s,e,i){let r;function o(u){r=u}function l(u,f){s.drawArrays(r,u,f),i.update(f,r,1)}function a(u,f,m){m!==0&&(s.drawArraysInstanced(r,u,f,m),i.update(f,r,m))}function c(u,f,m){if(m===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let _=0;_<m;_++)this.render(u[_],f[_]);else{h.multiDrawArraysWEBGL(r,u,0,f,0,m);let _=0;for(let b=0;b<m;b++)_+=f[b];i.update(_,r,1)}}function d(u,f,m,h){if(m===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let b=0;b<u.length;b++)a(u[b],f[b],h[b]);else{_.multiDrawArraysInstancedWEBGL(r,u,0,f,0,h,0,m);let b=0;for(let v=0;v<m;v++)b+=f[v];for(let v=0;v<h.length;v++)i.update(b,r,h[v])}}this.setMode=o,this.render=l,this.renderInstances=a,this.renderMultiDraw=c,this.renderMultiDrawInstances=d}function WebGLCapabilities(s,e,i,r){let o;function l(){if(o!==void 0)return o;if(e.has("EXT_texture_filter_anisotropic")===!0){const O=e.get("EXT_texture_filter_anisotropic");o=s.getParameter(O.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else o=0;return o}function a(O){return!(O!==RGBAFormat&&r.convert(O)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT))}function c(O){const L=O===HalfFloatType&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(O!==UnsignedByteType&&r.convert(O)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE)&&O!==FloatType&&!L)}function d(O){if(O==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";O="mediump"}return O==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=i.precision!==void 0?i.precision:"highp";const f=d(u);f!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",f,"instead."),u=f);const m=i.logarithmicDepthBuffer===!0,h=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),_=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),b=s.getParameter(s.MAX_TEXTURE_SIZE),v=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),w=s.getParameter(s.MAX_VERTEX_ATTRIBS),y=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),M=s.getParameter(s.MAX_VARYING_VECTORS),S=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),D=_>0,k=s.getParameter(s.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:l,getMaxPrecision:d,textureFormatReadable:a,textureTypeReadable:c,precision:u,logarithmicDepthBuffer:m,maxTextures:h,maxVertexTextures:_,maxTextureSize:b,maxCubemapSize:v,maxAttributes:w,maxVertexUniforms:y,maxVaryings:M,maxFragmentUniforms:S,vertexTextures:D,maxSamples:k}}function WebGLClipping(s){const e=this;let i=null,r=0,o=!1,l=!1;const a=new Plane,c=new Matrix3,d={value:null,needsUpdate:!1};this.uniform=d,this.numPlanes=0,this.numIntersection=0,this.init=function(m,h){const _=m.length!==0||h||r!==0||o;return o=h,r=m.length,_},this.beginShadows=function(){l=!0,f(null)},this.endShadows=function(){l=!1},this.setGlobalState=function(m,h){i=f(m,h,0)},this.setState=function(m,h,_){const b=m.clippingPlanes,v=m.clipIntersection,w=m.clipShadows,y=s.get(m);if(!o||b===null||b.length===0||l&&!w)l?f(null):u();else{const M=l?0:r,S=M*4;let D=y.clippingState||null;d.value=D,D=f(b,h,S,_);for(let k=0;k!==S;++k)D[k]=i[k];y.clippingState=D,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=M}};function u(){d.value!==i&&(d.value=i,d.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function f(m,h,_,b){const v=m!==null?m.length:0;let w=null;if(v!==0){if(w=d.value,b!==!0||w===null){const y=_+v*4,M=h.matrixWorldInverse;c.getNormalMatrix(M),(w===null||w.length<y)&&(w=new Float32Array(y));for(let S=0,D=_;S!==v;++S,D+=4)a.copy(m[S]).applyMatrix4(M,c),a.normal.toArray(w,D),w[D+3]=a.constant}d.value=w,d.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,w}}function WebGLCubeMaps(s){let e=new WeakMap;function i(a,c){return c===EquirectangularReflectionMapping?a.mapping=CubeReflectionMapping:c===EquirectangularRefractionMapping&&(a.mapping=CubeRefractionMapping),a}function r(a){if(a&&a.isTexture){const c=a.mapping;if(c===EquirectangularReflectionMapping||c===EquirectangularRefractionMapping)if(e.has(a)){const d=e.get(a).texture;return i(d,a.mapping)}else{const d=a.image;if(d&&d.height>0){const u=new WebGLCubeRenderTarget(d.height);return u.fromEquirectangularTexture(s,a),e.set(a,u),a.addEventListener("dispose",o),i(u.texture,a.mapping)}else return null}}return a}function o(a){const c=a.target;c.removeEventListener("dispose",o);const d=e.get(c);d!==void 0&&(e.delete(c),d.dispose())}function l(){e=new WeakMap}return{get:r,dispose:l}}class OrthographicCamera extends Camera{constructor(e=-1,i=1,r=1,o=-1,l=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=o,this.near=l,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,o,l,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=o,this.view.width=l,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let l=r-e,a=r+e,c=o+i,d=o-i;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=u*this.view.offsetX,a=l+u*this.view.width,c-=f*this.view.offsetY,d=c-f*this.view.height}this.projectionMatrix.makeOrthographic(l,a,c,d,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0,_oldXrEnabled=!1;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(-PHI,INV_PHI,0),new Vector3(PHI,INV_PHI,0),new Vector3(-INV_PHI,0,PHI),new Vector3(INV_PHI,0,PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(0,PHI,INV_PHI),new Vector3(-1,1,-1),new Vector3(1,1,-1),new Vector3(-1,1,1),new Vector3(1,1,1)];class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,r=.1,o=100){_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,r,o,l),i>0&&this._blur(l,0,0,i),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),this._renderer.xr.enabled=_oldXrEnabled,e.scissorTest=!1,_setViewport(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},o=_createRenderTarget(e,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(e,i,r);const{_lodMax:l}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(l)),this._blurMaterial=_getBlurShader(l,e,i)}return o}_compileMaterial(e){const i=new Mesh(this._lodPlanes[0],e);this._renderer.compile(i,_flatCamera)}_sceneToCubeUV(e,i,r,o){const c=new PerspectiveCamera(90,1,i,r),d=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],f=this._renderer,m=f.autoClear,h=f.toneMapping;f.getClearColor(_clearColor),f.toneMapping=NoToneMapping,f.autoClear=!1;const _=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),b=new Mesh(new BoxGeometry,_);let v=!1;const w=e.background;w?w.isColor&&(_.color.copy(w),e.background=null,v=!0):(_.color.copy(_clearColor),v=!0);for(let y=0;y<6;y++){const M=y%3;M===0?(c.up.set(0,d[y],0),c.lookAt(u[y],0,0)):M===1?(c.up.set(0,0,d[y]),c.lookAt(0,u[y],0)):(c.up.set(0,d[y],0),c.lookAt(0,0,u[y]));const S=this._cubeSize;_setViewport(o,M*S,y>2?S:0,S,S),f.setRenderTarget(o),v&&f.render(b,c),f.render(e,c)}b.geometry.dispose(),b.material.dispose(),f.toneMapping=h,f.autoClear=m,e.background=w}_textureToCubeUV(e,i){const r=this._renderer,o=e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping;o?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const l=o?this._cubemapMaterial:this._equirectMaterial,a=new Mesh(this._lodPlanes[0],l),c=l.uniforms;c.envMap.value=e;const d=this._cubeSize;_setViewport(i,0,0,3*d,2*d),r.setRenderTarget(i),r.render(a,_flatCamera)}_applyPMREM(e){const i=this._renderer,r=i.autoClear;i.autoClear=!1;const o=this._lodPlanes.length;for(let l=1;l<o;l++){const a=Math.sqrt(this._sigmas[l]*this._sigmas[l]-this._sigmas[l-1]*this._sigmas[l-1]),c=_axisDirections[(o-l-1)%_axisDirections.length];this._blur(e,l-1,l,a,c)}i.autoClear=r}_blur(e,i,r,o,l){const a=this._pingPongRenderTarget;this._halfBlur(e,a,i,r,o,"latitudinal",l),this._halfBlur(a,e,r,r,o,"longitudinal",l)}_halfBlur(e,i,r,o,l,a,c){const d=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,m=new Mesh(this._lodPlanes[o],u),h=u.uniforms,_=this._sizeLods[r]-1,b=isFinite(l)?Math.PI/(2*_):2*Math.PI/(2*MAX_SAMPLES-1),v=l/b,w=isFinite(l)?1+Math.floor(f*v):MAX_SAMPLES;w>MAX_SAMPLES&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${w} samples when the maximum is set to ${MAX_SAMPLES}`);const y=[];let M=0;for(let L=0;L<MAX_SAMPLES;++L){const P=L/v,N=Math.exp(-P*P/2);y.push(N),L===0?M+=N:L<w&&(M+=2*N)}for(let L=0;L<y.length;L++)y[L]=y[L]/M;h.envMap.value=e.texture,h.samples.value=w,h.weights.value=y,h.latitudinal.value=a==="latitudinal",c&&(h.poleAxis.value=c);const{_lodMax:S}=this;h.dTheta.value=b,h.mipInt.value=S-r;const D=this._sizeLods[o],k=3*D*(o>S-LOD_MIN?o-S+LOD_MIN:0),O=4*(this._cubeSize-D);_setViewport(i,k,O,3*D,2*D),d.setRenderTarget(i),d.render(m,_flatCamera)}}function _createPlanes(s){const e=[],i=[],r=[];let o=s;const l=s-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let a=0;a<l;a++){const c=Math.pow(2,o);i.push(c);let d=1/c;a>s-LOD_MIN?d=EXTRA_LOD_SIGMA[a-s+LOD_MIN-1]:a===0&&(d=0),r.push(d);const u=1/(c-2),f=-u,m=1+u,h=[f,f,m,f,m,m,f,f,m,m,f,m],_=6,b=6,v=3,w=2,y=1,M=new Float32Array(v*b*_),S=new Float32Array(w*b*_),D=new Float32Array(y*b*_);for(let O=0;O<_;O++){const L=O%3*2/3-1,P=O>2?0:-1,N=[L,P,0,L+2/3,P,0,L+2/3,P+1,0,L,P,0,L+2/3,P+1,0,L,P+1,0];M.set(N,v*b*O),S.set(h,w*b*O);const z=[O,O,O,O,O,O];D.set(z,y*b*O)}const k=new BufferGeometry;k.setAttribute("position",new BufferAttribute(M,v)),k.setAttribute("uv",new BufferAttribute(S,w)),k.setAttribute("faceIndex",new BufferAttribute(D,y)),e.push(k),o>LOD_MIN&&o--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function _createRenderTarget(s,e,i){const r=new WebGLRenderTarget(s,e,i);return r.texture.mapping=CubeUVReflectionMapping,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function _setViewport(s,e,i,r,o){s.viewport.set(e,i,r,o),s.scissor.set(e,i,r,o)}function _getBlurShader(s,e,i){const r=new Float32Array(MAX_SAMPLES),o=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(s){let e=new WeakMap,i=null;function r(c){if(c&&c.isTexture){const d=c.mapping,u=d===EquirectangularReflectionMapping||d===EquirectangularRefractionMapping,f=d===CubeReflectionMapping||d===CubeRefractionMapping;if(u||f){let m=e.get(c);const h=m!==void 0?m.texture.pmremVersion:0;if(c.isRenderTargetTexture&&c.pmremVersion!==h)return i===null&&(i=new PMREMGenerator(s)),m=u?i.fromEquirectangular(c,m):i.fromCubemap(c,m),m.texture.pmremVersion=c.pmremVersion,e.set(c,m),m.texture;if(m!==void 0)return m.texture;{const _=c.image;return u&&_&&_.height>0||f&&_&&o(_)?(i===null&&(i=new PMREMGenerator(s)),m=u?i.fromEquirectangular(c):i.fromCubemap(c),m.texture.pmremVersion=c.pmremVersion,e.set(c,m),c.addEventListener("dispose",l),m.texture):null}}}return c}function o(c){let d=0;const u=6;for(let f=0;f<u;f++)c[f]!==void 0&&d++;return d===u}function l(c){const d=c.target;d.removeEventListener("dispose",l);const u=e.get(d);u!==void 0&&(e.delete(d),u.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function WebGLExtensions(s){const e={};function i(r){if(e[r]!==void 0)return e[r];let o;switch(r){case"WEBGL_depth_texture":o=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=s.getExtension(r)}return e[r]=o,o}return{has:function(r){return i(r)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(r){const o=i(r);return o===null&&warnOnce("THREE.WebGLRenderer: "+r+" extension not supported."),o}}}function WebGLGeometries(s,e,i,r){const o={},l=new WeakMap;function a(m){const h=m.target;h.index!==null&&e.remove(h.index);for(const b in h.attributes)e.remove(h.attributes[b]);for(const b in h.morphAttributes){const v=h.morphAttributes[b];for(let w=0,y=v.length;w<y;w++)e.remove(v[w])}h.removeEventListener("dispose",a),delete o[h.id];const _=l.get(h);_&&(e.remove(_),l.delete(h)),r.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,i.memory.geometries--}function c(m,h){return o[h.id]===!0||(h.addEventListener("dispose",a),o[h.id]=!0,i.memory.geometries++),h}function d(m){const h=m.attributes;for(const b in h)e.update(h[b],s.ARRAY_BUFFER);const _=m.morphAttributes;for(const b in _){const v=_[b];for(let w=0,y=v.length;w<y;w++)e.update(v[w],s.ARRAY_BUFFER)}}function u(m){const h=[],_=m.index,b=m.attributes.position;let v=0;if(_!==null){const M=_.array;v=_.version;for(let S=0,D=M.length;S<D;S+=3){const k=M[S+0],O=M[S+1],L=M[S+2];h.push(k,O,O,L,L,k)}}else if(b!==void 0){const M=b.array;v=b.version;for(let S=0,D=M.length/3-1;S<D;S+=3){const k=S+0,O=S+1,L=S+2;h.push(k,O,O,L,L,k)}}else return;const w=new(arrayNeedsUint32(h)?Uint32BufferAttribute:Uint16BufferAttribute)(h,1);w.version=v;const y=l.get(m);y&&e.remove(y),l.set(m,w)}function f(m){const h=l.get(m);if(h){const _=m.index;_!==null&&h.version<_.version&&u(m)}else u(m);return l.get(m)}return{get:c,update:d,getWireframeAttribute:f}}function WebGLIndexedBufferRenderer(s,e,i){let r;function o(h){r=h}let l,a;function c(h){l=h.type,a=h.bytesPerElement}function d(h,_){s.drawElements(r,_,l,h*a),i.update(_,r,1)}function u(h,_,b){b!==0&&(s.drawElementsInstanced(r,_,l,h*a,b),i.update(_,r,b))}function f(h,_,b){if(b===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let w=0;w<b;w++)this.render(h[w]/a,_[w]);else{v.multiDrawElementsWEBGL(r,_,0,l,h,0,b);let w=0;for(let y=0;y<b;y++)w+=_[y];i.update(w,r,1)}}function m(h,_,b,v){if(b===0)return;const w=e.get("WEBGL_multi_draw");if(w===null)for(let y=0;y<h.length;y++)u(h[y]/a,_[y],v[y]);else{w.multiDrawElementsInstancedWEBGL(r,_,0,l,h,0,v,0,b);let y=0;for(let M=0;M<b;M++)y+=_[M];for(let M=0;M<v.length;M++)i.update(y,r,v[M])}}this.setMode=o,this.setIndex=c,this.render=d,this.renderInstances=u,this.renderMultiDraw=f,this.renderMultiDrawInstances=m}function WebGLInfo(s){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(l,a,c){switch(i.calls++,a){case s.TRIANGLES:i.triangles+=c*(l/3);break;case s.LINES:i.lines+=c*(l/2);break;case s.LINE_STRIP:i.lines+=c*(l-1);break;case s.LINE_LOOP:i.lines+=c*l;break;case s.POINTS:i.points+=c*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function o(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:o,update:r}}function WebGLMorphtargets(s,e,i){const r=new WeakMap,o=new WeakMap,l=new Vector4;function a(d,u,f,m){d.morphTargetInfluences;let h=null;if(d.morphTargetInfluences_backup&&d.morphTargetInfluences_cache){const w=d.morphTargetInfluences,y=d.morphTargetInfluences_backup,M=d.morphTargetInfluences_cache,S=d.morphTargetInfluences_coef,D=d.morphTargetInfluences_result;h=o.get(d)?.tmp_influences,h==null&&(h=new Float32Array(u.morphAttributes.position.length)),o.set(d,{tmp_influences:h});let k=0;const O=u.influenceMasks;if(O)for(let L=0,P=w.length;L<P;++L){const N=w[L];y[L]=N;const z=D[L]=(N+M[L])*S[L],K=O[L],Z=w[L]=z*K;K>0&&(h[k++]=Z)}else for(let L=0,P=w.length;L<P;++L){const N=w[L];y[L]=N;const z=D[L]=(N+M[L])*S[L],K=w[L]=z;h[k++]=K}}else h=d.morphTargetInfluences;const _=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,b=_!==void 0?_.length:0;let v=r.get(u);if(v===void 0||v.count!==b){let Z=function(){z.dispose(),r.delete(u),u.removeEventListener("dispose",Z)};v!==void 0&&v.texture.dispose();const w=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,M=u.morphAttributes.color!==void 0,S=u.morphAttributes.position||[],D=u.morphAttributes.normal||[],k=u.morphAttributes.color||[];let O=0;w===!0&&(O=1),y===!0&&(O=2),M===!0&&(O=3);let L=u.attributes.position.count*O,P=1;L>e.maxTextureSize&&(P=Math.ceil(L/e.maxTextureSize),L=e.maxTextureSize);const N=new Float32Array(L*P*4*b),z=new DataArrayTexture(N,L,P,b);z.type=FloatType,z.needsUpdate=!0;const K=O*4;for(let V=0;V<b;V++){const H=S[V],Y=D[V],q=k[V],J=L*P*4*V;for(let W=0;W<H.count;W++){const te=W*K;w===!0&&(l.fromBufferAttribute(H,W),N[J+te+0]=l.x,N[J+te+1]=l.y,N[J+te+2]=l.z,N[J+te+3]=0),y===!0&&(l.fromBufferAttribute(Y,W),N[J+te+4]=l.x,N[J+te+5]=l.y,N[J+te+6]=l.z,N[J+te+7]=0),M===!0&&(l.fromBufferAttribute(q,W),N[J+te+8]=l.x,N[J+te+9]=l.y,N[J+te+10]=l.z,N[J+te+11]=q.itemSize===4?l.w:1)}}v={count:b,texture:z,size:new Vector2(L,P)},r.set(u,v),u.addEventListener("dispose",Z)}if(d.isInstancedMesh===!0&&d.morphTexture!==null)m.getUniforms().setValue(s,"morphTexture",d.morphTexture,i);else{let w=0;for(let M=0;M<h.length;M++)w+=h[M];const y=u.morphTargetsRelative?1:1-w;m.getUniforms().setValue(s,"morphTargetBaseInfluence",y),h.length>0&&m.getUniforms().setValue(s,"morphTargetInfluences",h)}m.getUniforms().setValue(s,"morphTargetsTexture",v.texture,i),m.getUniforms().setValue(s,"morphTargetsTextureSize",v.size)}function c(d,u){if(d.morphTargetInfluences_backup&&d.morphTargetInfluences_cache){const f=d.morphTargetInfluences,m=d.morphTargetInfluences_backup;for(let h=0,_=m.length;h<_;h++)f[h]=m[h]}}return{update:a,store:c}}function WebGLObjects(s,e,i,r){let o=new WeakMap;function l(d){const u=r.render.frame,f=d.geometry,m=e.get(d,f);if(o.get(m)!==u&&(e.update(m),o.set(m,u)),d.isInstancedMesh&&(d.hasEventListener("dispose",c)===!1&&d.addEventListener("dispose",c),o.get(d)!==u&&(i.update(d.instanceMatrix,s.ARRAY_BUFFER),d.instanceColor!==null&&i.update(d.instanceColor,s.ARRAY_BUFFER),o.set(d,u))),d.isSkinnedMesh){const h=d.skeleton;o.get(h)!==u&&(h.update(),o.set(h,u))}return m}function a(){o=new WeakMap}function c(d){const u=d.target;u.removeEventListener("dispose",c),i.remove(u.instanceMatrix),u.instanceColor!==null&&i.remove(u.instanceColor)}return{update:l,dispose:a}}class DepthTexture extends Texture{constructor(e,i,r,o,l,a,c,d,u,f=DepthFormat){if(f!==DepthFormat&&f!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&f===DepthFormat&&(r=UnsignedIntType),r===void 0&&f===DepthStencilFormat&&(r=UnsignedInt248Type),super(null,o,l,a,c,d,f,r,u),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=c!==void 0?c:NearestFilter,this.minFilter=d!==void 0?d:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const emptyTexture=new Texture,emptyShadowTexture=new DepthTexture(1,1);emptyShadowTexture.compareFunction=LessEqualCompare;const emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(s,e,i){const r=s[0];if(r<=0||r>0)return s;const o=e*i;let l=arrayCacheF32[o];if(l===void 0&&(l=new Float32Array(o),arrayCacheF32[o]=l),e!==0){r.toArray(l,0);for(let a=1,c=0;a!==e;++a)c+=i,s[a].toArray(l,c)}return l}function arraysEqual(s,e){if(s.length!==e.length)return!1;for(let i=0,r=s.length;i<r;i++)if(s[i]!==e[i])return!1;return!0}function copyArray(s,e){for(let i=0,r=e.length;i<r;i++)s[i]=e[i]}function allocTexUnits(s,e){let i=arrayCacheI32[e];i===void 0&&(i=new Int32Array(e),arrayCacheI32[e]=i);for(let r=0;r!==e;++r)i[r]=s.allocateTextureUnit();return i}function setValueV1f(s,e){const i=this.cache;i[0]!==e&&(s.uniform1f(this.addr,e),i[0]=e)}function setValueV2f(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(arraysEqual(i,e))return;s.uniform2fv(this.addr,e),copyArray(i,e)}}function setValueV3f(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(arraysEqual(i,e))return;s.uniform3fv(this.addr,e),copyArray(i,e)}}function setValueV4f(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(arraysEqual(i,e))return;s.uniform4fv(this.addr,e),copyArray(i,e)}}function setValueM2(s,e){const i=this.cache,r=e.elements;if(r===void 0){if(arraysEqual(i,e))return;s.uniformMatrix2fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,r))return;mat2array.set(r),s.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(i,r)}}function setValueM3(s,e){const i=this.cache,r=e.elements;if(r===void 0){if(arraysEqual(i,e))return;s.uniformMatrix3fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,r))return;mat3array.set(r),s.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(i,r)}}function setValueM4(s,e){const i=this.cache,r=e.elements;if(r===void 0){if(arraysEqual(i,e))return;s.uniformMatrix4fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,r))return;mat4array.set(r),s.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(i,r)}}function setValueV1i(s,e){const i=this.cache;i[0]!==e&&(s.uniform1i(this.addr,e),i[0]=e)}function setValueV2i(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(arraysEqual(i,e))return;s.uniform2iv(this.addr,e),copyArray(i,e)}}function setValueV3i(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(arraysEqual(i,e))return;s.uniform3iv(this.addr,e),copyArray(i,e)}}function setValueV4i(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(arraysEqual(i,e))return;s.uniform4iv(this.addr,e),copyArray(i,e)}}function setValueV1ui(s,e){const i=this.cache;i[0]!==e&&(s.uniform1ui(this.addr,e),i[0]=e)}function setValueV2ui(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(arraysEqual(i,e))return;s.uniform2uiv(this.addr,e),copyArray(i,e)}}function setValueV3ui(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(arraysEqual(i,e))return;s.uniform3uiv(this.addr,e),copyArray(i,e)}}function setValueV4ui(s,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(arraysEqual(i,e))return;s.uniform4uiv(this.addr,e),copyArray(i,e)}}function setValueT1(s,e,i){const r=this.cache,o=i.allocateTextureUnit();r[0]!==o&&(s.uniform1i(this.addr,o),r[0]=o);const l=this.type===s.SAMPLER_2D_SHADOW?emptyShadowTexture:emptyTexture;i.setTexture2D(e||l,o)}function setValueT3D1(s,e,i){const r=this.cache,o=i.allocateTextureUnit();r[0]!==o&&(s.uniform1i(this.addr,o),r[0]=o),i.setTexture3D(e||empty3dTexture,o)}function setValueT6(s,e,i){const r=this.cache,o=i.allocateTextureUnit();r[0]!==o&&(s.uniform1i(this.addr,o),r[0]=o),i.setTextureCube(e||emptyCubeTexture,o)}function setValueT2DArray1(s,e,i){const r=this.cache,o=i.allocateTextureUnit();r[0]!==o&&(s.uniform1i(this.addr,o),r[0]=o),i.setTexture2DArray(e||emptyArrayTexture,o)}function getSingularSetter(s){switch(s){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(s,e){s.uniform1fv(this.addr,e)}function setValueV2fArray(s,e){const i=flatten(e,this.size,2);s.uniform2fv(this.addr,i)}function setValueV3fArray(s,e){const i=flatten(e,this.size,3);s.uniform3fv(this.addr,i)}function setValueV4fArray(s,e){const i=flatten(e,this.size,4);s.uniform4fv(this.addr,i)}function setValueM2Array(s,e){const i=flatten(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(s,e){const i=flatten(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(s,e){const i=flatten(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,i)}function setValueV1iArray(s,e){s.uniform1iv(this.addr,e)}function setValueV2iArray(s,e){s.uniform2iv(this.addr,e)}function setValueV3iArray(s,e){s.uniform3iv(this.addr,e)}function setValueV4iArray(s,e){s.uniform4iv(this.addr,e)}function setValueV1uiArray(s,e){s.uniform1uiv(this.addr,e)}function setValueV2uiArray(s,e){s.uniform2uiv(this.addr,e)}function setValueV3uiArray(s,e){s.uniform3uiv(this.addr,e)}function setValueV4uiArray(s,e){s.uniform4uiv(this.addr,e)}function setValueT1Array(s,e,i){const r=this.cache,o=e.length,l=allocTexUnits(i,o);arraysEqual(r,l)||(s.uniform1iv(this.addr,l),copyArray(r,l));for(let a=0;a!==o;++a)i.setTexture2D(e[a]||emptyTexture,l[a])}function setValueT3DArray(s,e,i){const r=this.cache,o=e.length,l=allocTexUnits(i,o);arraysEqual(r,l)||(s.uniform1iv(this.addr,l),copyArray(r,l));for(let a=0;a!==o;++a)i.setTexture3D(e[a]||empty3dTexture,l[a])}function setValueT6Array(s,e,i){const r=this.cache,o=e.length,l=allocTexUnits(i,o);arraysEqual(r,l)||(s.uniform1iv(this.addr,l),copyArray(r,l));for(let a=0;a!==o;++a)i.setTextureCube(e[a]||emptyCubeTexture,l[a])}function setValueT2DArrayArray(s,e,i){const r=this.cache,o=e.length,l=allocTexUnits(i,o);arraysEqual(r,l)||(s.uniform1iv(this.addr,l),copyArray(r,l));for(let a=0;a!==o;++a)i.setTexture2DArray(e[a]||emptyArrayTexture,l[a])}function getPureArraySetter(s){switch(s){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.type=i.type,this.setValue=getSingularSetter(i.type)}}class PureArrayUniform{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=getPureArraySetter(i.type)}}class StructuredUniform{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,r){const o=this.seq;for(let l=0,a=o.length;l!==a;++l){const c=o[l];c.setValue(e,i[c.id],r)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(s,e){s.seq.push(e),s.map[e.id]=e}function parseUniform(s,e,i){const r=s.name,o=r.length;for(RePathPart.lastIndex=0;;){const l=RePathPart.exec(r),a=RePathPart.lastIndex;let c=l[1];const d=l[2]==="]",u=l[3];if(d&&(c=c|0),u===void 0||u==="["&&a+2===o){addUniform(i,u===void 0?new SingleUniform(c,s,e):new PureArrayUniform(c,s,e));break}else{let m=i.map[c];m===void 0&&(m=new StructuredUniform(c),addUniform(i,m)),i=m}}}class WebGLUniforms{constructor(e,i){this.seq=[],this.map={};const r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let o=0;o<r;++o){const l=e.getActiveUniform(i,o),a=e.getUniformLocation(i,l.name);parseUniform(l,a,this)}}setValue(e,i,r,o){const l=this.map[i];l!==void 0&&l.setValue(e,r,o)}setOptional(e,i,r){const o=i[r];o!==void 0&&this.setValue(e,r,o)}static upload(e,i,r,o){for(let l=0,a=i.length;l!==a;++l){const c=i[l],d=r[c.id];d.needsUpdate!==!1&&c.setValue(e,d.value,o)}}static seqWithValue(e,i){const r=[];for(let o=0,l=e.length;o!==l;++o){const a=e[o];a.id in i&&r.push(a)}return r}}function WebGLShader(s,e,i){const r=s.createShader(e);return s.shaderSource(r,i),s.compileShader(r),r}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(s,e){const i=s.split(`
`),r=[],o=Math.max(e-6,0),l=Math.min(e+6,i.length);for(let a=o;a<l;a++){const c=a+1;r.push(`${c===e?">":" "} ${c}: ${i[a]}`)}return r.join(`
`)}function getEncodingComponents(s){const e=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),i=ColorManagement.getPrimaries(s);let r;switch(e===i?r="":e===P3Primaries&&i===Rec709Primaries?r="LinearDisplayP3ToLinearSRGB":e===Rec709Primaries&&i===P3Primaries&&(r="LinearSRGBToLinearDisplayP3"),s){case LinearSRGBColorSpace:case LinearDisplayP3ColorSpace:return[r,"LinearTransferOETF"];case SRGBColorSpace:case DisplayP3ColorSpace:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",s),[r,"LinearTransferOETF"]}}function getShaderErrors(s,e,i){const r=s.getShaderParameter(e,s.COMPILE_STATUS),o=s.getShaderInfoLog(e).trim();if(r&&o==="")return"";const l=/ERROR: 0:(\d+)/.exec(o);if(l){const a=parseInt(l[1]);return i.toUpperCase()+`

`+o+`

`+handleSource(s.getShaderSource(e),a)}else return o}function getTexelEncodingFunction(s,e){const i=getEncodingComponents(e);return`vec4 ${s}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function getToneMappingFunction(s,e){let i;switch(e){case LinearToneMapping:i="Linear";break;case ReinhardToneMapping:i="Reinhard";break;case CineonToneMapping:i="OptimizedCineon";break;case ACESFilmicToneMapping:i="ACESFilmic";break;case AgXToneMapping:i="AgX";break;case NeutralToneMapping:i="Neutral";break;case CustomToneMapping:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+s+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function generateVertexExtensions(s){return[s.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",s.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(filterEmptyLine).join(`
`)}function generateDefines(s){const e=[];for(const i in s){const r=s[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function fetchAttributeLocations(s,e){const i={},r=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let o=0;o<r;o++){const l=s.getActiveAttrib(e,o),a=l.name;let c=1;l.type===s.FLOAT_MAT2&&(c=2),l.type===s.FLOAT_MAT3&&(c=3),l.type===s.FLOAT_MAT4&&(c=4),i[a]={type:l.type,location:s.getAttribLocation(e,a),locationSize:c}}return i}function filterEmptyLine(s){return s!==""}function replaceLightNums(s,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function replaceClippingPlaneNums(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(s){return s.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map;function includeReplacer(s,e){let i=ShaderChunk[e];if(i===void 0){const r=shaderChunkMap.get(e);if(r!==void 0)i=ShaderChunk[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return resolveIncludes(i)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(s){return s.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(s,e,i,r){let o="";for(let l=parseInt(e);l<parseInt(i);l++)o+=r.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return o}function generatePrecision(s){let e=`precision ${s.precision} float;
	precision ${s.precision} int;
	precision ${s.precision} sampler2D;
	precision ${s.precision} samplerCube;
	precision ${s.precision} sampler3D;
	precision ${s.precision} sampler2DArray;
	precision ${s.precision} sampler2DShadow;
	precision ${s.precision} samplerCubeShadow;
	precision ${s.precision} sampler2DArrayShadow;
	precision ${s.precision} isampler2D;
	precision ${s.precision} isampler3D;
	precision ${s.precision} isamplerCube;
	precision ${s.precision} isampler2DArray;
	precision ${s.precision} usampler2D;
	precision ${s.precision} usampler3D;
	precision ${s.precision} usamplerCube;
	precision ${s.precision} usampler2DArray;
	`;return s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function generateShadowMapTypeDefine(s){let e="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===PCFShadowMap?e="SHADOWMAP_TYPE_PCF":s.shadowMapType===PCFSoftShadowMap?e="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===VSMShadowMap&&(e="SHADOWMAP_TYPE_VSM"),e}function generateEnvMapTypeDefine(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:e="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:e="ENVMAP_TYPE_CUBE_UV";break}return e}function generateEnvMapModeDefine(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case CubeRefractionMapping:e="ENVMAP_MODE_REFRACTION";break}return e}function generateEnvMapBlendingDefine(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case MultiplyOperation:e="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:e="ENVMAP_BLENDING_MIX";break;case AddOperation:e="ENVMAP_BLENDING_ADD";break}return e}function generateCubeUVSize(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function WebGLProgram(s,e,i,r){const o=s.getContext(),l=i.defines;let a=i.vertexShader,c=i.fragmentShader;const d=generateShadowMapTypeDefine(i),u=generateEnvMapTypeDefine(i),f=generateEnvMapModeDefine(i),m=generateEnvMapBlendingDefine(i),h=generateCubeUVSize(i),_=generateVertexExtensions(i),b=generateDefines(l),v=o.createProgram();let w,y,M=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(w=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,b].filter(filterEmptyLine).join(`
`),w.length>0&&(w+=`
`),y=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,b].filter(filterEmptyLine).join(`
`),y.length>0&&(y+=`
`)):(w=[generatePrecision(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,b,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+f:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+d:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),y=[generatePrecision(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,b,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+f:"",i.envMap?"#define "+m:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+d:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",i.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",i.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),a=resolveIncludes(a),a=replaceLightNums(a,i),a=replaceClippingPlaneNums(a,i),c=resolveIncludes(c),c=replaceLightNums(c,i),c=replaceClippingPlaneNums(c,i),a=unrollLoops(a),c=unrollLoops(c),i.isRawShaderMaterial!==!0&&(M=`#version 300 es
`,w=[_,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+w,y=["#define varying in",i.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const S=M+w+a,D=M+y+c,k=WebGLShader(o,o.VERTEX_SHADER,S),O=WebGLShader(o,o.FRAGMENT_SHADER,D);o.attachShader(v,k),o.attachShader(v,O),i.index0AttributeName!==void 0?o.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&o.bindAttribLocation(v,0,"position"),o.linkProgram(v);function L(K){if(s.debug.checkShaderErrors){const Z=o.getProgramInfoLog(v).trim(),V=o.getShaderInfoLog(k).trim(),H=o.getShaderInfoLog(O).trim();let Y=!0,q=!0;if(o.getProgramParameter(v,o.LINK_STATUS)===!1)if(Y=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(o,v,k,O);else{const J=getShaderErrors(o,k,"vertex"),W=getShaderErrors(o,O,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(v,o.VALIDATE_STATUS)+`

Material Name: `+K.name+`
Material Type: `+K.type+`

Program Info Log: `+Z+`
`+J+`
`+W)}else Z!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Z):(V===""||H==="")&&(q=!1);q&&(K.diagnostics={runnable:Y,programLog:Z,vertexShader:{log:V,prefix:w},fragmentShader:{log:H,prefix:y}})}o.deleteShader(k),o.deleteShader(O),P=new WebGLUniforms(o,v),N=fetchAttributeLocations(o,v)}let P;this.getUniforms=function(){return P===void 0&&L(this),P};let N;this.getAttributes=function(){return N===void 0&&L(this),N};let z=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return z===!1&&(z=o.getProgramParameter(v,COMPLETION_STATUS_KHR)),z},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(v),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=programIdCount++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=k,this.fragmentShader=O,this}let _id$1=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,r=e.fragmentShader,o=this._getShaderStage(i),l=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(o)===!1&&(a.add(o),o.usedTimes++),a.has(l)===!1&&(a.add(l),l.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let r=i.get(e);return r===void 0&&(r=new Set,i.set(e,r)),r}_getShaderStage(e){const i=this.shaderCache;let r=i.get(e);return r===void 0&&(r=new WebGLShaderStage(e),i.set(e,r)),r}}class WebGLShaderStage{constructor(e){this.id=_id$1++,this.code=e,this.usedTimes=0}}function WebGLPrograms(s,e,i,r,o,l,a){const c=new Layers,d=new WebGLShaderCache,u=new Set,f=[],m=o.logarithmicDepthBuffer,h=o.vertexTextures;let _=o.precision;const b={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(N){return u.add(N),N===0?"uv":`uv${N}`}function w(N,z,K,Z,V){const H=Z.fog,Y=V.geometry,q=N.isMeshStandardMaterial?Z.environment:null,J=(N.isMeshStandardMaterial?i:e).get(N.envMap||q),W=J&&J.mapping===CubeUVReflectionMapping?J.image.height:null,te=b[N.type];N.precision!==null&&(_=o.getMaxPrecision(N.precision),_!==N.precision&&console.warn("THREE.WebGLProgram.getParameters:",N.precision,"not supported, using",_,"instead."));const ie=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,oe=ie!==void 0?ie.length:0;let Ce=0;Y.morphAttributes.position!==void 0&&(Ce=1),Y.morphAttributes.normal!==void 0&&(Ce=2),Y.morphAttributes.color!==void 0&&(Ce=3);let ve,we,Se,Re;if(te){const Ze=ShaderLib[te];ve=Ze.vertexShader,we=Ze.fragmentShader}else ve=N.vertexShader,we=N.fragmentShader,d.update(N),Se=d.getVertexShaderID(N),Re=d.getFragmentShaderID(N);const Fe=s.getRenderTarget(),$e=V.isInstancedMesh===!0,Ue=V.isBatchedMesh===!0,qe=!!N.map,_e=!!N.matcap,be=!!J,De=!!N.aoMap,Te=!!N.lightMap,ge=!!N.bumpMap,Ee=!!N.normalMap,Ie=!!N.displacementMap,Be=!!N.emissiveMap,Oe=!!N.metalnessMap,ue=!!N.roughnessMap,re=N.anisotropy>0,ke=N.clearcoat>0,We=N.dispersion>0,Xe=N.iridescence>0,Ye=N.sheen>0,it=N.transmission>0,tt=re&&!!N.anisotropyMap,Ke=ke&&!!N.clearcoatMap,ae=ke&&!!N.clearcoatNormalMap,j=ke&&!!N.clearcoatRoughnessMap,ee=Xe&&!!N.iridescenceMap,ne=Xe&&!!N.iridescenceThicknessMap,le=Ye&&!!N.sheenColorMap,he=Ye&&!!N.sheenRoughnessMap,Me=!!N.specularMap,Ne=!!N.specularColorMap,je=!!N.specularIntensityMap,fe=it&&!!N.transmissionMap,ce=it&&!!N.thicknessMap,ye=!!N.gradientMap,Pe=!!N.alphaMap,Ve=N.alphaTest>0,Qe=!!N.alphaHash,at=!!N.extensions;let ht=NoToneMapping;N.toneMapped&&(Fe===null||Fe.isXRRenderTarget===!0)&&(ht=s.toneMapping);const xt={shaderID:te,shaderType:N.type,shaderName:N.name,vertexShader:ve,fragmentShader:we,defines:N.defines,customVertexShaderID:Se,customFragmentShaderID:Re,isRawShaderMaterial:N.isRawShaderMaterial===!0,glslVersion:N.glslVersion,precision:_,batching:Ue,batchingColor:Ue&&V._colorsTexture!==null,instancing:$e,instancingColor:$e&&V.instanceColor!==null,instancingMorph:$e&&V.morphTexture!==null,supportsVertexTextures:h,outputColorSpace:Fe===null?s.outputColorSpace:Fe.isXRRenderTarget===!0?Fe.texture.colorSpace:LinearSRGBColorSpace,alphaToCoverage:!!N.alphaToCoverage,map:qe,matcap:_e,envMap:be,envMapMode:be&&J.mapping,envMapCubeUVHeight:W,aoMap:De,lightMap:Te,bumpMap:ge,normalMap:Ee,displacementMap:h&&Ie,emissiveMap:Be,normalMapObjectSpace:Ee&&N.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:Ee&&N.normalMapType===TangentSpaceNormalMap,metalnessMap:Oe,roughnessMap:ue,anisotropy:re,anisotropyMap:tt,clearcoat:ke,clearcoatMap:Ke,clearcoatNormalMap:ae,clearcoatRoughnessMap:j,dispersion:We,iridescence:Xe,iridescenceMap:ee,iridescenceThicknessMap:ne,sheen:Ye,sheenColorMap:le,sheenRoughnessMap:he,specularMap:Me,specularColorMap:Ne,specularIntensityMap:je,transmission:it,transmissionMap:fe,thicknessMap:ce,gradientMap:ye,opaque:N.transparent===!1&&N.blending===NormalBlending&&N.alphaToCoverage===!1,alphaMap:Pe,alphaTest:Ve,alphaHash:Qe,combine:N.combine,mapUv:qe&&v(N.map.channel),aoMapUv:De&&v(N.aoMap.channel),lightMapUv:Te&&v(N.lightMap.channel),bumpMapUv:ge&&v(N.bumpMap.channel),normalMapUv:Ee&&v(N.normalMap.channel),displacementMapUv:Ie&&v(N.displacementMap.channel),emissiveMapUv:Be&&v(N.emissiveMap.channel),metalnessMapUv:Oe&&v(N.metalnessMap.channel),roughnessMapUv:ue&&v(N.roughnessMap.channel),anisotropyMapUv:tt&&v(N.anisotropyMap.channel),clearcoatMapUv:Ke&&v(N.clearcoatMap.channel),clearcoatNormalMapUv:ae&&v(N.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:j&&v(N.clearcoatRoughnessMap.channel),iridescenceMapUv:ee&&v(N.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&v(N.iridescenceThicknessMap.channel),sheenColorMapUv:le&&v(N.sheenColorMap.channel),sheenRoughnessMapUv:he&&v(N.sheenRoughnessMap.channel),specularMapUv:Me&&v(N.specularMap.channel),specularColorMapUv:Ne&&v(N.specularColorMap.channel),specularIntensityMapUv:je&&v(N.specularIntensityMap.channel),transmissionMapUv:fe&&v(N.transmissionMap.channel),thicknessMapUv:ce&&v(N.thicknessMap.channel),alphaMapUv:Pe&&v(N.alphaMap.channel),vertexTangents:!!Y.attributes.tangent&&(Ee||re),vertexColors:N.vertexColors,vertexAlphas:N.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!Y.attributes.uv&&(qe||Pe),fog:!!H,useFog:N.fog===!0,fogExp2:!!H&&H.isFogExp2,flatShading:N.flatShading===!0,sizeAttenuation:N.sizeAttenuation===!0,logarithmicDepthBuffer:m,skinning:V.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:oe,morphTextureStride:Ce,numDirLights:z.directional.length,numPointLights:z.point.length,numSpotLights:z.spot.length,numSpotLightMaps:z.spotLightMap.length,numRectAreaLights:z.rectArea.length,numHemiLights:z.hemi.length,numDirLightShadows:z.directionalShadowMap.length,numPointLightShadows:z.pointShadowMap.length,numSpotLightShadows:z.spotShadowMap.length,numSpotLightShadowsWithMaps:z.numSpotLightShadowsWithMaps,numLightProbes:z.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:N.dithering,shadowMapEnabled:s.shadowMap.enabled&&K.length>0&&N.receiveShadow,shadowMapType:s.shadowMap.type,toneMapping:ht,decodeVideoTexture:qe&&N.map.isVideoTexture===!0&&ColorManagement.getTransfer(N.map.colorSpace)===SRGBTransfer,premultipliedAlpha:N.premultipliedAlpha,doubleSided:N.side===DoubleSide,flipSided:N.side===BackSide,useDepthPacking:N.depthPacking>=0,depthPacking:N.depthPacking||0,index0AttributeName:N.index0AttributeName,extensionClipCullDistance:at&&N.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:at&&N.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:N.customProgramCacheKey()};return xt.vertexUv1s=u.has(1),xt.vertexUv2s=u.has(2),xt.vertexUv3s=u.has(3),u.clear(),xt}function y(N){const z=[];if(N.shaderID?z.push(N.shaderID):(z.push(N.customVertexShaderID),z.push(N.customFragmentShaderID)),N.defines!==void 0)for(const K in N.defines)z.push(K),z.push(N.defines[K]);return N.isRawShaderMaterial===!1&&(M(z,N),S(z,N),z.push(s.outputColorSpace)),z.push(N.customProgramCacheKey),z.join()}function M(N,z){N.push(z.precision),N.push(z.outputColorSpace),N.push(z.envMapMode),N.push(z.envMapCubeUVHeight),N.push(z.mapUv),N.push(z.alphaMapUv),N.push(z.lightMapUv),N.push(z.aoMapUv),N.push(z.bumpMapUv),N.push(z.normalMapUv),N.push(z.displacementMapUv),N.push(z.emissiveMapUv),N.push(z.metalnessMapUv),N.push(z.roughnessMapUv),N.push(z.anisotropyMapUv),N.push(z.clearcoatMapUv),N.push(z.clearcoatNormalMapUv),N.push(z.clearcoatRoughnessMapUv),N.push(z.iridescenceMapUv),N.push(z.iridescenceThicknessMapUv),N.push(z.sheenColorMapUv),N.push(z.sheenRoughnessMapUv),N.push(z.specularMapUv),N.push(z.specularColorMapUv),N.push(z.specularIntensityMapUv),N.push(z.transmissionMapUv),N.push(z.thicknessMapUv),N.push(z.combine),N.push(z.fogExp2),N.push(z.sizeAttenuation),N.push(z.morphTargetsCount),N.push(z.morphAttributeCount),N.push(z.numDirLights),N.push(z.numPointLights),N.push(z.numSpotLights),N.push(z.numSpotLightMaps),N.push(z.numHemiLights),N.push(z.numRectAreaLights),N.push(z.numDirLightShadows),N.push(z.numPointLightShadows),N.push(z.numSpotLightShadows),N.push(z.numSpotLightShadowsWithMaps),N.push(z.numLightProbes),N.push(z.shadowMapType),N.push(z.toneMapping),N.push(z.numClippingPlanes),N.push(z.numClipIntersection),N.push(z.depthPacking)}function S(N,z){c.disableAll(),z.supportsVertexTextures&&c.enable(0),z.instancing&&c.enable(1),z.instancingColor&&c.enable(2),z.instancingMorph&&c.enable(3),z.matcap&&c.enable(4),z.envMap&&c.enable(5),z.normalMapObjectSpace&&c.enable(6),z.normalMapTangentSpace&&c.enable(7),z.clearcoat&&c.enable(8),z.iridescence&&c.enable(9),z.alphaTest&&c.enable(10),z.vertexColors&&c.enable(11),z.vertexAlphas&&c.enable(12),z.vertexUv1s&&c.enable(13),z.vertexUv2s&&c.enable(14),z.vertexUv3s&&c.enable(15),z.vertexTangents&&c.enable(16),z.anisotropy&&c.enable(17),z.alphaHash&&c.enable(18),z.batching&&c.enable(19),z.dispersion&&c.enable(20),z.batchingColor&&c.enable(21),N.push(c.mask),c.disableAll(),z.fog&&c.enable(0),z.useFog&&c.enable(1),z.flatShading&&c.enable(2),z.logarithmicDepthBuffer&&c.enable(3),z.skinning&&c.enable(4),z.morphTargets&&c.enable(5),z.morphNormals&&c.enable(6),z.morphColors&&c.enable(7),z.premultipliedAlpha&&c.enable(8),z.shadowMapEnabled&&c.enable(9),z.doubleSided&&c.enable(10),z.flipSided&&c.enable(11),z.useDepthPacking&&c.enable(12),z.dithering&&c.enable(13),z.transmission&&c.enable(14),z.sheen&&c.enable(15),z.opaque&&c.enable(16),z.pointsUvs&&c.enable(17),z.decodeVideoTexture&&c.enable(18),z.alphaToCoverage&&c.enable(19),N.push(c.mask)}function D(N){const z=b[N.type];let K;if(z){const Z=ShaderLib[z];K=UniformsUtils.clone(Z.uniforms)}else K=N.uniforms;return K}function k(N,z){let K;for(let Z=0,V=f.length;Z<V;Z++){const H=f[Z];if(H.cacheKey===z){K=H,++K.usedTimes;break}}return K===void 0&&(K=new WebGLProgram(s,z,N,l),f.push(K)),K}function O(N){if(--N.usedTimes===0){const z=f.indexOf(N);f[z]=f[f.length-1],f.pop(),N.destroy()}}function L(N){d.remove(N)}function P(){d.dispose()}return{getParameters:w,getProgramCacheKey:y,getUniforms:D,acquireProgram:k,releaseProgram:O,releaseShaderCache:L,programs:f,dispose:P}}function WebGLProperties(){let s=new WeakMap;function e(l){let a=s.get(l);return a===void 0&&(a={},s.set(l,a)),a}function i(l){s.delete(l)}function r(l,a,c){s.get(l)[a]=c}function o(){s=new WeakMap}return{get:e,remove:i,update:r,dispose:o}}function painterSortStable(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function reversePainterSortStable(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function WebGLRenderList(){const s=[];let e=0;const i=[],r=[],o=[];function l(){e=0,i.length=0,r.length=0,o.length=0}function a(m,h,_,b,v,w){let y=s[e];return y===void 0?(y={id:m.id,object:m,geometry:h,material:_,groupOrder:b,renderOrder:m.renderOrder,z:v,group:w},s[e]=y):(y.id=m.id,y.object=m,y.geometry=h,y.material=_,y.groupOrder=b,y.renderOrder=m.renderOrder,y.z=v,y.group=w),e++,y}function c(m,h,_,b,v,w){const y=a(m,h,_,b,v,w);_.transmission>0?r.push(y):_.transparent===!0?o.push(y):i.push(y)}function d(m,h,_,b,v,w){const y=a(m,h,_,b,v,w);_.transmission>0?r.unshift(y):_.transparent===!0?o.unshift(y):i.unshift(y)}function u(m,h){i.length>1&&i.sort(m||painterSortStable),r.length>1&&r.sort(h||reversePainterSortStable),o.length>1&&o.sort(h||reversePainterSortStable)}function f(){for(let m=e,h=s.length;m<h;m++){const _=s[m];if(_.id===null)break;_.id=null,_.object=null,_.geometry=null,_.material=null,_.group=null}}return{opaque:i,transmissive:r,transparent:o,init:l,push:c,unshift:d,finish:f,sort:u}}function WebGLRenderLists(){let s=new WeakMap;function e(r,o){const l=s.get(r);let a;return l===void 0?(a=new WebGLRenderList,s.set(r,[a])):o>=l.length?(a=new WebGLRenderList,l.push(a)):a=l[o],a}function i(){s=new WeakMap}return{get:e,dispose:i}}function UniformsCache(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return s[e.id]=i,i}}}function ShadowUniformsCache(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=i,i}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function WebGLLights(s){const e=new UniformsCache,i=ShadowUniformsCache(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new Vector3);const o=new Vector3,l=new Matrix4,a=new Matrix4;function c(u){let f=0,m=0,h=0;for(let N=0;N<9;N++)r.probe[N].set(0,0,0);let _=0,b=0,v=0,w=0,y=0,M=0,S=0,D=0,k=0,O=0,L=0;u.sort(shadowCastingAndTexturingLightsFirst);for(let N=0,z=u.length;N<z;N++){const K=u[N],Z=K.color,V=K.intensity,H=K.distance,Y=K.shadow&&K.shadow.map?K.shadow.map.texture:null;if(K.isAmbientLight)f+=Z.r*V,m+=Z.g*V,h+=Z.b*V;else if(K.isLightProbe){for(let q=0;q<9;q++)r.probe[q].addScaledVector(K.sh.coefficients[q],V);L++}else if(K.isDirectionalLight){const q=e.get(K);if(q.color.copy(K.color).multiplyScalar(K.intensity),K.castShadow){const J=K.shadow,W=i.get(K);W.shadowBias=J.bias,W.shadowNormalBias=J.normalBias,W.shadowRadius=J.radius,W.shadowMapSize=J.mapSize,r.directionalShadow[_]=W,r.directionalShadowMap[_]=Y,r.directionalShadowMatrix[_]=K.shadow.matrix,M++}r.directional[_]=q,_++}else if(K.isSpotLight){const q=e.get(K);q.position.setFromMatrixPosition(K.matrixWorld),q.color.copy(Z).multiplyScalar(V),q.distance=H,q.coneCos=Math.cos(K.angle),q.penumbraCos=Math.cos(K.angle*(1-K.penumbra)),q.decay=K.decay,r.spot[v]=q;const J=K.shadow;if(K.map&&(r.spotLightMap[k]=K.map,k++,J.updateMatrices(K),K.castShadow&&O++),r.spotLightMatrix[v]=J.matrix,K.castShadow){const W=i.get(K);W.shadowBias=J.bias,W.shadowNormalBias=J.normalBias,W.shadowRadius=J.radius,W.shadowMapSize=J.mapSize,r.spotShadow[v]=W,r.spotShadowMap[v]=Y,D++}v++}else if(K.isRectAreaLight){const q=e.get(K);q.color.copy(Z).multiplyScalar(V),q.halfWidth.set(K.width*.5,0,0),q.halfHeight.set(0,K.height*.5,0),r.rectArea[w]=q,w++}else if(K.isPointLight){const q=e.get(K);if(q.color.copy(K.color).multiplyScalar(K.intensity),q.distance=K.distance,q.decay=K.decay,K.castShadow){const J=K.shadow,W=i.get(K);W.shadowBias=J.bias,W.shadowNormalBias=J.normalBias,W.shadowRadius=J.radius,W.shadowMapSize=J.mapSize,W.shadowCameraNear=J.camera.near,W.shadowCameraFar=J.camera.far,r.pointShadow[b]=W,r.pointShadowMap[b]=Y,r.pointShadowMatrix[b]=K.shadow.matrix,S++}r.point[b]=q,b++}else if(K.isHemisphereLight){const q=e.get(K);q.skyColor.copy(K.color).multiplyScalar(V),q.groundColor.copy(K.groundColor).multiplyScalar(V),r.hemi[y]=q,y++}}w>0&&(s.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,r.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):(r.rectAreaLTC1=UniformsLib.LTC_HALF_1,r.rectAreaLTC2=UniformsLib.LTC_HALF_2)),r.ambient[0]=f,r.ambient[1]=m,r.ambient[2]=h;const P=r.hash;(P.directionalLength!==_||P.pointLength!==b||P.spotLength!==v||P.rectAreaLength!==w||P.hemiLength!==y||P.numDirectionalShadows!==M||P.numPointShadows!==S||P.numSpotShadows!==D||P.numSpotMaps!==k||P.numLightProbes!==L)&&(r.directional.length=_,r.spot.length=v,r.rectArea.length=w,r.point.length=b,r.hemi.length=y,r.directionalShadow.length=M,r.directionalShadowMap.length=M,r.pointShadow.length=S,r.pointShadowMap.length=S,r.spotShadow.length=D,r.spotShadowMap.length=D,r.directionalShadowMatrix.length=M,r.pointShadowMatrix.length=S,r.spotLightMatrix.length=D+k-O,r.spotLightMap.length=k,r.numSpotLightShadowsWithMaps=O,r.numLightProbes=L,P.directionalLength=_,P.pointLength=b,P.spotLength=v,P.rectAreaLength=w,P.hemiLength=y,P.numDirectionalShadows=M,P.numPointShadows=S,P.numSpotShadows=D,P.numSpotMaps=k,P.numLightProbes=L,r.version=nextVersion++)}function d(u,f){let m=0,h=0,_=0,b=0,v=0;const w=f.matrixWorldInverse;for(let y=0,M=u.length;y<M;y++){const S=u[y];if(S.isDirectionalLight){const D=r.directional[m];D.direction.setFromMatrixPosition(S.matrixWorld),o.setFromMatrixPosition(S.target.matrixWorld),D.direction.sub(o),D.direction.transformDirection(w),m++}else if(S.isSpotLight){const D=r.spot[_];D.position.setFromMatrixPosition(S.matrixWorld),D.position.applyMatrix4(w),D.direction.setFromMatrixPosition(S.matrixWorld),o.setFromMatrixPosition(S.target.matrixWorld),D.direction.sub(o),D.direction.transformDirection(w),_++}else if(S.isRectAreaLight){const D=r.rectArea[b];D.position.setFromMatrixPosition(S.matrixWorld),D.position.applyMatrix4(w),a.identity(),l.copy(S.matrixWorld),l.premultiply(w),a.extractRotation(l),D.halfWidth.set(S.width*.5,0,0),D.halfHeight.set(0,S.height*.5,0),D.halfWidth.applyMatrix4(a),D.halfHeight.applyMatrix4(a),b++}else if(S.isPointLight){const D=r.point[h];D.position.setFromMatrixPosition(S.matrixWorld),D.position.applyMatrix4(w),h++}else if(S.isHemisphereLight){const D=r.hemi[v];D.direction.setFromMatrixPosition(S.matrixWorld),D.direction.transformDirection(w),v++}}}return{setup:c,setupView:d,state:r}}function WebGLRenderState(s){const e=new WebGLLights(s),i=[],r=[];function o(f){u.camera=f,i.length=0,r.length=0}function l(f){i.push(f)}function a(f){r.push(f)}function c(){e.setup(i)}function d(f){e.setupView(i,f)}const u={lightsArray:i,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:o,state:u,setupLights:c,setupLightsView:d,pushLight:l,pushShadow:a}}function WebGLRenderStates(s){let e=new WeakMap;function i(o,l=0){const a=e.get(o);let c;return a===void 0?(c=new WebGLRenderState(s),e.set(o,[c])):l>=a.length?(c=new WebGLRenderState(s),a.push(c)):c=a[l],c}function r(){e=new WeakMap}return{get:i,dispose:r}}class MeshDepthMaterial extends Material{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const vertex=`
void main() {

	gl_Position = vec4( position, 1.0 );

}
`,fragment=`
uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;

#include <packing>

void main() {

	const float samples = float( VSM_SAMPLES );

	float mean = 0.0;
	float squared_mean = 0.0;

	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {

		float uvOffset = uvStart + i * uvStride;

		#ifdef HORIZONTAL_PASS

			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;

		#else

			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;

		#endif

	}

	mean = mean / samples;
	squared_mean = squared_mean / samples;

	float std_dev = sqrt( squared_mean - mean * mean );

	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );

}
`;function WebGLShadowMap(s,e,i){let r=new Frustum;const o=new Vector2,l=new Vector2,a=new Vector4,c=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),d=new MeshDistanceMaterial,u={},f=i.maxTextureSize,m={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},h=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),_=h.clone();_.defines.HORIZONTAL_PASS=1;const b=new BufferGeometry;b.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new Mesh(b,h),w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let y=this.type;this.render=function(O,L,P){if(w.enabled===!1||w.autoUpdate===!1&&w.needsUpdate===!1||O.length===0)return;const N=s.getRenderTarget(),z=s.getActiveCubeFace(),K=s.getActiveMipmapLevel(),Z=s.state;Z.setBlending(NoBlending),Z.buffers.color.setClear(1,1,1,1),Z.buffers.depth.setTest(!0),Z.setScissorTest(!1);const V=y!==VSMShadowMap&&this.type===VSMShadowMap,H=y===VSMShadowMap&&this.type!==VSMShadowMap;for(let Y=0,q=O.length;Y<q;Y++){const J=O[Y],W=J.shadow;if(W===void 0){console.warn("THREE.WebGLShadowMap:",J,"has no shadow.");continue}if(W.autoUpdate===!1&&W.needsUpdate===!1)continue;o.copy(W.mapSize);const te=W.getFrameExtents();if(o.multiply(te),l.copy(W.mapSize),(o.x>f||o.y>f)&&(o.x>f&&(l.x=Math.floor(f/te.x),o.x=l.x*te.x,W.mapSize.x=l.x),o.y>f&&(l.y=Math.floor(f/te.y),o.y=l.y*te.y,W.mapSize.y=l.y)),W.map===null||V===!0||H===!0){const oe=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};W.map!==null&&W.map.dispose(),W.map=new WebGLRenderTarget(o.x,o.y,oe),W.map.texture.name=J.name+".shadowMap",W.camera.updateProjectionMatrix()}s.setRenderTarget(W.map),s.clear();const ie=W.getViewportCount();for(let oe=0;oe<ie;oe++){const Ce=W.getViewport(oe);a.set(l.x*Ce.x,l.y*Ce.y,l.x*Ce.z,l.y*Ce.w),Z.viewport(a),W.updateMatrices(J,oe),r=W.getFrustum(),D(L,P,W.camera,J,this.type)}W.isPointLightShadow!==!0&&this.type===VSMShadowMap&&M(W,P),W.needsUpdate=!1}y=this.type,w.needsUpdate=!1,s.setRenderTarget(N,z,K)};function M(O,L){const P=e.update(v);h.defines.VSM_SAMPLES!==O.blurSamples&&(h.defines.VSM_SAMPLES=O.blurSamples,_.defines.VSM_SAMPLES=O.blurSamples,h.needsUpdate=!0,_.needsUpdate=!0),O.mapPass===null&&(O.mapPass=new WebGLRenderTarget(o.x,o.y)),h.uniforms.shadow_pass.value=O.map.texture,h.uniforms.resolution.value=O.mapSize,h.uniforms.radius.value=O.radius,s.setRenderTarget(O.mapPass),s.clear(),s.renderBufferDirect(L,null,P,h,v,null),_.uniforms.shadow_pass.value=O.mapPass.texture,_.uniforms.resolution.value=O.mapSize,_.uniforms.radius.value=O.radius,s.setRenderTarget(O.map),s.clear(),s.renderBufferDirect(L,null,P,_,v,null)}function S(O,L,P,N){let z=null;const K=P.isPointLight===!0?O.customDistanceMaterial:O.customDepthMaterial;if(K!==void 0)z=K;else if(z=P.isPointLight===!0?d:c,s.localClippingEnabled&&L.clipShadows===!0&&Array.isArray(L.clippingPlanes)&&L.clippingPlanes.length!==0||L.displacementMap&&L.displacementScale!==0||L.alphaMap&&L.alphaTest>0||L.map&&L.alphaTest>0){const Z=z.uuid,V=L.uuid;let H=u[Z];H===void 0&&(H={},u[Z]=H);let Y=H[V];Y===void 0&&(Y=z.clone(),H[V]=Y,L.addEventListener("dispose",k)),z=Y}if(z.visible=L.visible,z.wireframe=L.wireframe,N===VSMShadowMap?z.side=L.shadowSide!==null?L.shadowSide:L.side:z.side=L.shadowSide!==null?L.shadowSide:m[L.side],z.alphaMap=L.alphaMap,z.alphaTest=L.alphaTest,z.map=L.map,z.clipShadows=L.clipShadows,z.clippingPlanes=L.clippingPlanes,z.clipIntersection=L.clipIntersection,z.displacementMap=L.displacementMap,z.displacementScale=L.displacementScale,z.displacementBias=L.displacementBias,z.wireframeLinewidth=L.wireframeLinewidth,z.linewidth=L.linewidth,P.isPointLight===!0&&z.isMeshDistanceMaterial===!0){const Z=s.properties.get(z);Z.light=P}return z}function D(O,L,P,N,z){if(O.visible===!1)return;if(O.layers.test(L.layers)&&(O.isMesh||O.isLine||O.isPoints)&&(O.castShadow||O.receiveShadow&&z===VSMShadowMap)&&(!O.frustumCulled||r.intersectsObject(O))){O.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,O.matrixWorld);const V=e.update(O),H=O.material;if(Array.isArray(H)){const Y=V.groups;for(let q=0,J=Y.length;q<J;q++){const W=Y[q],te=H[W.materialIndex];if(te&&te.visible){const ie=S(O,te,N,z);O.onBeforeShadow(s,O,L,P,V,ie,W),s.renderBufferDirect(P,null,V,ie,O,W),O.onAfterShadow(s,O,L,P,V,ie,W)}}}else if(H.visible){const Y=S(O,H,N,z);O.onBeforeShadow(s,O,L,P,V,Y,null),s.renderBufferDirect(P,null,V,Y,O,null),O.onAfterShadow(s,O,L,P,V,Y,null)}}const Z=O.children;for(let V=0,H=Z.length;V<H;V++)D(Z[V],L,P,N,z)}function k(O){O.target.removeEventListener("dispose",k);for(const P in u){const N=u[P],z=O.target.uuid;z in N&&(N[z].dispose(),delete N[z])}}}function WebGLState(s){function e(){let fe=!1;const ce=new Vector4;let ye=null;const Pe=new Vector4(0,0,0,0);return{setMask:function(Ve){ye!==Ve&&!fe&&(s.colorMask(Ve,Ve,Ve,Ve),ye=Ve)},setLocked:function(Ve){fe=Ve},setClear:function(Ve,Qe,at,ht,xt){xt===!0&&(Ve*=ht,Qe*=ht,at*=ht),ce.set(Ve,Qe,at,ht),Pe.equals(ce)===!1&&(s.clearColor(Ve,Qe,at,ht),Pe.copy(ce))},reset:function(){fe=!1,ye=null,Pe.set(-1,0,0,0)}}}function i(){let fe=!1,ce=null,ye=null,Pe=null;return{setTest:function(Ve){Ve?Re(s.DEPTH_TEST):Fe(s.DEPTH_TEST)},setMask:function(Ve){ce!==Ve&&!fe&&(s.depthMask(Ve),ce=Ve)},setFunc:function(Ve){if(ye!==Ve){switch(Ve){case NeverDepth:s.depthFunc(s.NEVER);break;case AlwaysDepth:s.depthFunc(s.ALWAYS);break;case LessDepth:s.depthFunc(s.LESS);break;case LessEqualDepth:s.depthFunc(s.LEQUAL);break;case EqualDepth:s.depthFunc(s.EQUAL);break;case GreaterEqualDepth:s.depthFunc(s.GEQUAL);break;case GreaterDepth:s.depthFunc(s.GREATER);break;case NotEqualDepth:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}ye=Ve}},setLocked:function(Ve){fe=Ve},setClear:function(Ve){Pe!==Ve&&(s.clearDepth(Ve),Pe=Ve)},reset:function(){fe=!1,ce=null,ye=null,Pe=null}}}function r(){let fe=!1,ce=null,ye=null,Pe=null,Ve=null,Qe=null,at=null,ht=null,xt=null;return{setTest:function(Ze){fe||(Ze?Re(s.STENCIL_TEST):Fe(s.STENCIL_TEST))},setMask:function(Ze){ce!==Ze&&!fe&&(s.stencilMask(Ze),ce=Ze)},setFunc:function(Ze,ot,mt){(ye!==Ze||Pe!==ot||Ve!==mt)&&(s.stencilFunc(Ze,ot,mt),ye=Ze,Pe=ot,Ve=mt)},setOp:function(Ze,ot,mt){(Qe!==Ze||at!==ot||ht!==mt)&&(s.stencilOp(Ze,ot,mt),Qe=Ze,at=ot,ht=mt)},setLocked:function(Ze){fe=Ze},setClear:function(Ze){xt!==Ze&&(s.clearStencil(Ze),xt=Ze)},reset:function(){fe=!1,ce=null,ye=null,Pe=null,Ve=null,Qe=null,at=null,ht=null,xt=null}}}const o=new e,l=new i,a=new r,c=new WeakMap,d=new WeakMap;let u={},f={},m=new WeakMap,h=[],_=null,b=!1,v=null,w=null,y=null,M=null,S=null,D=null,k=null,O=new Color(0,0,0),L=0,P=!1,N=null,z=null,K=null,Z=null,V=null;const H=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Y=!1,q=0;const J=s.getParameter(s.VERSION);J.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\d)/.exec(J)[1]),Y=q>=1):J.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),Y=q>=2);let W=null,te={};const ie=s.getParameter(s.SCISSOR_BOX),oe=s.getParameter(s.VIEWPORT),Ce=new Vector4().fromArray(ie),ve=new Vector4().fromArray(oe);function we(fe,ce,ye,Pe){const Ve=new Uint8Array(4),Qe=s.createTexture();s.bindTexture(fe,Qe),s.texParameteri(fe,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(fe,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let at=0;at<ye;at++)fe===s.TEXTURE_3D||fe===s.TEXTURE_2D_ARRAY?s.texImage3D(ce,0,s.RGBA,1,1,Pe,0,s.RGBA,s.UNSIGNED_BYTE,Ve):s.texImage2D(ce+at,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,Ve);return Qe}const Se={};Se[s.TEXTURE_2D]=we(s.TEXTURE_2D,s.TEXTURE_2D,1),Se[s.TEXTURE_CUBE_MAP]=we(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),Se[s.TEXTURE_2D_ARRAY]=we(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),Se[s.TEXTURE_3D]=we(s.TEXTURE_3D,s.TEXTURE_3D,1,1),o.setClear(0,0,0,1),l.setClear(1),a.setClear(0),Re(s.DEPTH_TEST),l.setFunc(LessEqualDepth),ge(!1),Ee(CullFaceBack),Re(s.CULL_FACE),De(NoBlending);function Re(fe){u[fe]!==!0&&(s.enable(fe),u[fe]=!0)}function Fe(fe){u[fe]!==!1&&(s.disable(fe),u[fe]=!1)}function $e(fe,ce){return f[fe]!==ce?(s.bindFramebuffer(fe,ce),f[fe]=ce,fe===s.DRAW_FRAMEBUFFER&&(f[s.FRAMEBUFFER]=ce),fe===s.FRAMEBUFFER&&(f[s.DRAW_FRAMEBUFFER]=ce),!0):!1}function Ue(fe,ce){let ye=h,Pe=!1;if(fe){ye=m.get(ce),ye===void 0&&(ye=[],m.set(ce,ye));const Ve=fe.textures;if(ye.length!==Ve.length||ye[0]!==s.COLOR_ATTACHMENT0){for(let Qe=0,at=Ve.length;Qe<at;Qe++)ye[Qe]=s.COLOR_ATTACHMENT0+Qe;ye.length=Ve.length,Pe=!0}}else ye[0]!==s.BACK&&(ye[0]=s.BACK,Pe=!0);Pe&&s.drawBuffers(ye)}function qe(fe){return _!==fe?(s.useProgram(fe),_=fe,!0):!1}const _e={[AddEquation]:s.FUNC_ADD,[SubtractEquation]:s.FUNC_SUBTRACT,[ReverseSubtractEquation]:s.FUNC_REVERSE_SUBTRACT};_e[MinEquation]=s.MIN,_e[MaxEquation]=s.MAX;const be={[ZeroFactor]:s.ZERO,[OneFactor]:s.ONE,[SrcColorFactor]:s.SRC_COLOR,[SrcAlphaFactor]:s.SRC_ALPHA,[SrcAlphaSaturateFactor]:s.SRC_ALPHA_SATURATE,[DstColorFactor]:s.DST_COLOR,[DstAlphaFactor]:s.DST_ALPHA,[OneMinusSrcColorFactor]:s.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:s.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:s.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:s.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:s.CONSTANT_COLOR,[OneMinusConstantColorFactor]:s.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:s.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:s.ONE_MINUS_CONSTANT_ALPHA};function De(fe,ce,ye,Pe,Ve,Qe,at,ht,xt,Ze){if(fe===NoBlending){b===!0&&(Fe(s.BLEND),b=!1);return}if(b===!1&&(Re(s.BLEND),b=!0),fe!==CustomBlending){if(fe!==v||Ze!==P){if((w!==AddEquation||S!==AddEquation)&&(s.blendEquation(s.FUNC_ADD),w=AddEquation,S=AddEquation),Ze)switch(fe){case NormalBlending:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:s.blendFunc(s.ONE,s.ONE);break;case SubtractiveBlending:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case MultiplyBlending:s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",fe);break}else switch(fe){case NormalBlending:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:s.blendFunc(s.SRC_ALPHA,s.ONE);break;case SubtractiveBlending:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case MultiplyBlending:s.blendFunc(s.ZERO,s.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",fe);break}y=null,M=null,D=null,k=null,O.set(0,0,0),L=0,v=fe,P=Ze}return}Ve=Ve||ce,Qe=Qe||ye,at=at||Pe,(ce!==w||Ve!==S)&&(s.blendEquationSeparate(_e[ce],_e[Ve]),w=ce,S=Ve),(ye!==y||Pe!==M||Qe!==D||at!==k)&&(s.blendFuncSeparate(be[ye],be[Pe],be[Qe],be[at]),y=ye,M=Pe,D=Qe,k=at),(ht.equals(O)===!1||xt!==L)&&(s.blendColor(ht.r,ht.g,ht.b,xt),O.copy(ht),L=xt),v=fe,P=!1}function Te(fe,ce){fe.side===DoubleSide?Fe(s.CULL_FACE):Re(s.CULL_FACE);let ye=fe.side===BackSide;ce&&(ye=!ye),ge(ye),fe.blending===NormalBlending&&fe.transparent===!1?De(NoBlending):De(fe.blending,fe.blendEquation,fe.blendSrc,fe.blendDst,fe.blendEquationAlpha,fe.blendSrcAlpha,fe.blendDstAlpha,fe.blendColor,fe.blendAlpha,fe.premultipliedAlpha),l.setFunc(fe.depthFunc),l.setTest(fe.depthTest),l.setMask(fe.depthWrite),o.setMask(fe.colorWrite);const Pe=fe.stencilWrite;a.setTest(Pe),Pe&&(a.setMask(fe.stencilWriteMask),a.setFunc(fe.stencilFunc,fe.stencilRef,fe.stencilFuncMask),a.setOp(fe.stencilFail,fe.stencilZFail,fe.stencilZPass)),Be(fe.polygonOffset,fe.polygonOffsetFactor,fe.polygonOffsetUnits),fe.alphaToCoverage===!0?Re(s.SAMPLE_ALPHA_TO_COVERAGE):Fe(s.SAMPLE_ALPHA_TO_COVERAGE)}function ge(fe){N!==fe&&(fe?s.frontFace(s.CW):s.frontFace(s.CCW),N=fe)}function Ee(fe){fe!==CullFaceNone?(Re(s.CULL_FACE),fe!==z&&(fe===CullFaceBack?s.cullFace(s.BACK):fe===CullFaceFront?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):Fe(s.CULL_FACE),z=fe}function Ie(fe){fe!==K&&(Y&&s.lineWidth(fe),K=fe)}function Be(fe,ce,ye){fe?(Re(s.POLYGON_OFFSET_FILL),(Z!==ce||V!==ye)&&(s.polygonOffset(ce,ye),Z=ce,V=ye)):Fe(s.POLYGON_OFFSET_FILL)}function Oe(fe){fe?Re(s.SCISSOR_TEST):Fe(s.SCISSOR_TEST)}function ue(fe){fe===void 0&&(fe=s.TEXTURE0+H-1),W!==fe&&(s.activeTexture(fe),W=fe)}function re(fe,ce,ye){ye===void 0&&(W===null?ye=s.TEXTURE0+H-1:ye=W);let Pe=te[ye];Pe===void 0&&(Pe={type:void 0,texture:void 0},te[ye]=Pe),(Pe.type!==fe||Pe.texture!==ce)&&(W!==ye&&(s.activeTexture(ye),W=ye),s.bindTexture(fe,ce||Se[fe]),Pe.type=fe,Pe.texture=ce)}function ke(){const fe=te[W];fe!==void 0&&fe.type!==void 0&&(s.bindTexture(fe.type,null),fe.type=void 0,fe.texture=void 0)}function We(){try{s.compressedTexImage2D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function Xe(){try{s.compressedTexImage3D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function Ye(){try{s.texSubImage2D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function it(){try{s.texSubImage3D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function tt(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function Ke(){try{s.compressedTexSubImage3D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function ae(){try{s.texStorage2D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function j(){try{s.texStorage3D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function ee(){try{s.texImage2D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function ne(){try{s.texImage3D.apply(s,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function le(fe){Ce.equals(fe)===!1&&(s.scissor(fe.x,fe.y,fe.z,fe.w),Ce.copy(fe))}function he(fe){ve.equals(fe)===!1&&(s.viewport(fe.x,fe.y,fe.z,fe.w),ve.copy(fe))}function Me(fe,ce){let ye=d.get(ce);ye===void 0&&(ye=new WeakMap,d.set(ce,ye));let Pe=ye.get(fe);Pe===void 0&&(Pe=s.getUniformBlockIndex(ce,fe.name),ye.set(fe,Pe))}function Ne(fe,ce){const Pe=d.get(ce).get(fe);c.get(ce)!==Pe&&(s.uniformBlockBinding(ce,Pe,fe.__bindingPointIndex),c.set(ce,Pe))}function je(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.blendColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),u={},W=null,te={},f={},m=new WeakMap,h=[],_=null,b=!1,v=null,w=null,y=null,M=null,S=null,D=null,k=null,O=new Color(0,0,0),L=0,P=!1,N=null,z=null,K=null,Z=null,V=null,Ce.set(0,0,s.canvas.width,s.canvas.height),ve.set(0,0,s.canvas.width,s.canvas.height),o.reset(),l.reset(),a.reset()}return{buffers:{color:o,depth:l,stencil:a},enable:Re,disable:Fe,bindFramebuffer:$e,drawBuffers:Ue,useProgram:qe,setBlending:De,setMaterial:Te,setFlipSided:ge,setCullFace:Ee,setLineWidth:Ie,setPolygonOffset:Be,setScissorTest:Oe,activeTexture:ue,bindTexture:re,unbindTexture:ke,compressedTexImage2D:We,compressedTexImage3D:Xe,texImage2D:ee,texImage3D:ne,updateUBOMapping:Me,uniformBlockBinding:Ne,texStorage2D:ae,texStorage3D:j,texSubImage2D:Ye,texSubImage3D:it,compressedTexSubImage2D:tt,compressedTexSubImage3D:Ke,scissor:le,viewport:he,reset:je}}function WebGLTextures(s,e,i,r,o,l,a){const c=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,d=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new Vector2,f=new WeakMap;let m;const h=new WeakMap;let _=!1;try{_=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(ue,re){return _?new OffscreenCanvas(ue,re):createElementNS("canvas")}function v(ue,re,ke){let We=1;const Xe=Oe(ue);if((Xe.width>ke||Xe.height>ke)&&(We=ke/Math.max(Xe.width,Xe.height)),We<1)if(typeof HTMLImageElement<"u"&&ue instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ue instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ue instanceof ImageBitmap||typeof VideoFrame<"u"&&ue instanceof VideoFrame){const Ye=Math.floor(We*Xe.width),it=Math.floor(We*Xe.height);m===void 0&&(m=b(Ye,it));const tt=re?b(Ye,it):m;return tt.width=Ye,tt.height=it,tt.getContext("2d").drawImage(ue,0,0,Ye,it),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Xe.width+"x"+Xe.height+") to ("+Ye+"x"+it+")."),tt}else return"data"in ue&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Xe.width+"x"+Xe.height+")."),ue;return ue}function w(ue){return ue.generateMipmaps&&ue.minFilter!==NearestFilter&&ue.minFilter!==LinearFilter}function y(ue){s.generateMipmap(ue)}function M(ue,re,ke,We,Xe=!1){if(ue!==null){if(s[ue]!==void 0)return s[ue];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ue+"'")}let Ye=re;if(re===s.RED&&(ke===s.FLOAT&&(Ye=s.R32F),ke===s.HALF_FLOAT&&(Ye=s.R16F),ke===s.UNSIGNED_BYTE&&(Ye=s.R8)),re===s.RED_INTEGER&&(ke===s.UNSIGNED_BYTE&&(Ye=s.R8UI),ke===s.UNSIGNED_SHORT&&(Ye=s.R16UI),ke===s.UNSIGNED_INT&&(Ye=s.R32UI),ke===s.BYTE&&(Ye=s.R8I),ke===s.SHORT&&(Ye=s.R16I),ke===s.INT&&(Ye=s.R32I)),re===s.RG&&(ke===s.FLOAT&&(Ye=s.RG32F),ke===s.HALF_FLOAT&&(Ye=s.RG16F),ke===s.UNSIGNED_BYTE&&(Ye=s.RG8)),re===s.RG_INTEGER&&(ke===s.UNSIGNED_BYTE&&(Ye=s.RG8UI),ke===s.UNSIGNED_SHORT&&(Ye=s.RG16UI),ke===s.UNSIGNED_INT&&(Ye=s.RG32UI),ke===s.BYTE&&(Ye=s.RG8I),ke===s.SHORT&&(Ye=s.RG16I),ke===s.INT&&(Ye=s.RG32I)),re===s.RGB&&ke===s.UNSIGNED_INT_5_9_9_9_REV&&(Ye=s.RGB9_E5),re===s.RGBA){const it=Xe?LinearTransfer:ColorManagement.getTransfer(We);ke===s.FLOAT&&(Ye=s.RGBA32F),ke===s.HALF_FLOAT&&(Ye=s.RGBA16F),ke===s.UNSIGNED_BYTE&&(Ye=it===SRGBTransfer?s.SRGB8_ALPHA8:s.RGBA8),ke===s.UNSIGNED_SHORT_4_4_4_4&&(Ye=s.RGBA4),ke===s.UNSIGNED_SHORT_5_5_5_1&&(Ye=s.RGB5_A1)}return(Ye===s.R16F||Ye===s.R32F||Ye===s.RG16F||Ye===s.RG32F||Ye===s.RGBA16F||Ye===s.RGBA32F)&&e.get("EXT_color_buffer_float"),Ye}function S(ue,re){let ke;return ue?re===null||re===UnsignedIntType||re===UnsignedInt248Type?ke=s.DEPTH24_STENCIL8:re===FloatType?ke=s.DEPTH32F_STENCIL8:re===UnsignedShortType&&(ke=s.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):re===null||re===UnsignedIntType||re===UnsignedInt248Type?ke=s.DEPTH_COMPONENT24:re===FloatType?ke=s.DEPTH_COMPONENT32F:re===UnsignedShortType&&(ke=s.DEPTH_COMPONENT16),ke}function D(ue,re){return w(ue)===!0||ue.isFramebufferTexture&&ue.minFilter!==NearestFilter&&ue.minFilter!==LinearFilter?Math.log2(Math.max(re.width,re.height))+1:ue.mipmaps!==void 0&&ue.mipmaps.length>0?ue.mipmaps.length:ue.isCompressedTexture&&Array.isArray(ue.image)?re.mipmaps.length:1}function k(ue){const re=ue.target;re.removeEventListener("dispose",k),L(re),re.isVideoTexture&&f.delete(re)}function O(ue){const re=ue.target;re.removeEventListener("dispose",O),N(re)}function L(ue){const re=r.get(ue);if(re.__webglInit===void 0)return;const ke=ue.source,We=h.get(ke);if(We){const Xe=We[re.__cacheKey];Xe.usedTimes--,Xe.usedTimes===0&&P(ue),Object.keys(We).length===0&&h.delete(ke)}r.remove(ue)}function P(ue){const re=r.get(ue);s.deleteTexture(re.__webglTexture);const ke=ue.source,We=h.get(ke);delete We[re.__cacheKey],a.memory.textures--}function N(ue){const re=r.get(ue);if(ue.depthTexture&&ue.depthTexture.dispose(),ue.isWebGLCubeRenderTarget)for(let We=0;We<6;We++){if(Array.isArray(re.__webglFramebuffer[We]))for(let Xe=0;Xe<re.__webglFramebuffer[We].length;Xe++)s.deleteFramebuffer(re.__webglFramebuffer[We][Xe]);else s.deleteFramebuffer(re.__webglFramebuffer[We]);re.__webglDepthbuffer&&s.deleteRenderbuffer(re.__webglDepthbuffer[We])}else{if(Array.isArray(re.__webglFramebuffer))for(let We=0;We<re.__webglFramebuffer.length;We++)s.deleteFramebuffer(re.__webglFramebuffer[We]);else s.deleteFramebuffer(re.__webglFramebuffer);if(re.__webglDepthbuffer&&s.deleteRenderbuffer(re.__webglDepthbuffer),re.__webglMultisampledFramebuffer&&s.deleteFramebuffer(re.__webglMultisampledFramebuffer),re.__webglColorRenderbuffer)for(let We=0;We<re.__webglColorRenderbuffer.length;We++)re.__webglColorRenderbuffer[We]&&s.deleteRenderbuffer(re.__webglColorRenderbuffer[We]);re.__webglDepthRenderbuffer&&s.deleteRenderbuffer(re.__webglDepthRenderbuffer)}const ke=ue.textures;for(let We=0,Xe=ke.length;We<Xe;We++){const Ye=r.get(ke[We]);Ye.__webglTexture&&(s.deleteTexture(Ye.__webglTexture),a.memory.textures--),r.remove(ke[We])}r.remove(ue)}let z=0;function K(){z=0}function Z(){const ue=z;return ue>=o.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ue+" texture units while this GPU supports only "+o.maxTextures),z+=1,ue}function V(ue){const re=[];return re.push(ue.wrapS),re.push(ue.wrapT),re.push(ue.wrapR||0),re.push(ue.magFilter),re.push(ue.minFilter),re.push(ue.anisotropy),re.push(ue.internalFormat),re.push(ue.format),re.push(ue.type),re.push(ue.generateMipmaps),re.push(ue.premultiplyAlpha),re.push(ue.flipY),re.push(ue.unpackAlignment),re.push(ue.colorSpace),re.join()}function H(ue,re){const ke=r.get(ue);if(ue.isVideoTexture&&Ie(ue),ue.isRenderTargetTexture===!1&&ue.version>0&&ke.__version!==ue.version){const We=ue.image;if(We===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(We.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ve(ke,ue,re);return}}i.bindTexture(s.TEXTURE_2D,ke.__webglTexture,s.TEXTURE0+re)}function Y(ue,re){const ke=r.get(ue);if(ue.version>0&&ke.__version!==ue.version){ve(ke,ue,re);return}i.bindTexture(s.TEXTURE_2D_ARRAY,ke.__webglTexture,s.TEXTURE0+re)}function q(ue,re){const ke=r.get(ue);if(ue.version>0&&ke.__version!==ue.version){ve(ke,ue,re);return}i.bindTexture(s.TEXTURE_3D,ke.__webglTexture,s.TEXTURE0+re)}function J(ue,re){const ke=r.get(ue);if(ue.version>0&&ke.__version!==ue.version){we(ke,ue,re);return}i.bindTexture(s.TEXTURE_CUBE_MAP,ke.__webglTexture,s.TEXTURE0+re)}const W={[RepeatWrapping]:s.REPEAT,[ClampToEdgeWrapping]:s.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:s.MIRRORED_REPEAT},te={[NearestFilter]:s.NEAREST,[NearestMipmapNearestFilter]:s.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:s.NEAREST_MIPMAP_LINEAR,[LinearFilter]:s.LINEAR,[LinearMipmapNearestFilter]:s.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:s.LINEAR_MIPMAP_LINEAR},ie={[NeverCompare]:s.NEVER,[AlwaysCompare]:s.ALWAYS,[LessCompare]:s.LESS,[LessEqualCompare]:s.LEQUAL,[EqualCompare]:s.EQUAL,[GreaterEqualCompare]:s.GEQUAL,[GreaterCompare]:s.GREATER,[NotEqualCompare]:s.NOTEQUAL};function oe(ue,re){if(re.type===FloatType&&e.has("OES_texture_float_linear")===!1&&(re.magFilter===LinearFilter||re.magFilter===LinearMipmapNearestFilter||re.magFilter===NearestMipmapLinearFilter||re.magFilter===LinearMipmapLinearFilter||re.minFilter===LinearFilter||re.minFilter===LinearMipmapNearestFilter||re.minFilter===NearestMipmapLinearFilter||re.minFilter===LinearMipmapLinearFilter)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),s.texParameteri(ue,s.TEXTURE_WRAP_S,W[re.wrapS]),s.texParameteri(ue,s.TEXTURE_WRAP_T,W[re.wrapT]),(ue===s.TEXTURE_3D||ue===s.TEXTURE_2D_ARRAY)&&s.texParameteri(ue,s.TEXTURE_WRAP_R,W[re.wrapR]),s.texParameteri(ue,s.TEXTURE_MAG_FILTER,te[re.magFilter]),s.texParameteri(ue,s.TEXTURE_MIN_FILTER,te[re.minFilter]),re.compareFunction&&(s.texParameteri(ue,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(ue,s.TEXTURE_COMPARE_FUNC,ie[re.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(re.magFilter===NearestFilter||re.minFilter!==NearestMipmapLinearFilter&&re.minFilter!==LinearMipmapLinearFilter||re.type===FloatType&&e.has("OES_texture_float_linear")===!1)return;if(re.anisotropy>1||r.get(re).__currentAnisotropy){const ke=e.get("EXT_texture_filter_anisotropic");s.texParameterf(ue,ke.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(re.anisotropy,o.getMaxAnisotropy())),r.get(re).__currentAnisotropy=re.anisotropy}}}function Ce(ue,re){let ke=!1;ue.__webglInit===void 0&&(ue.__webglInit=!0,re.addEventListener("dispose",k));const We=re.source;let Xe=h.get(We);Xe===void 0&&(Xe={},h.set(We,Xe));const Ye=V(re);if(Ye!==ue.__cacheKey){Xe[Ye]===void 0&&(Xe[Ye]={texture:s.createTexture(),usedTimes:0},a.memory.textures++,ke=!0),Xe[Ye].usedTimes++;const it=Xe[ue.__cacheKey];it!==void 0&&(Xe[ue.__cacheKey].usedTimes--,it.usedTimes===0&&P(re)),ue.__cacheKey=Ye,ue.__webglTexture=Xe[Ye].texture}return ke}function ve(ue,re,ke){let We=s.TEXTURE_2D;(re.isDataArrayTexture||re.isCompressedArrayTexture)&&(We=s.TEXTURE_2D_ARRAY),re.isData3DTexture&&(We=s.TEXTURE_3D);const Xe=Ce(ue,re),Ye=re.source;i.bindTexture(We,ue.__webglTexture,s.TEXTURE0+ke);const it=r.get(Ye);if(Ye.version!==it.__version||Xe===!0){i.activeTexture(s.TEXTURE0+ke);const tt=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),Ke=re.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(re.colorSpace),ae=re.colorSpace===NoColorSpace||tt===Ke?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,re.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,re.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,re.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,ae);let j=v(re.image,!1,o.maxTextureSize);j=Be(re,j);const ee=l.convert(re.format,re.colorSpace),ne=l.convert(re.type);let le=M(re.internalFormat,ee,ne,re.colorSpace,re.isVideoTexture);oe(We,re);let he;const Me=re.mipmaps,Ne=re.isVideoTexture!==!0,je=it.__version===void 0||Xe===!0,fe=Ye.dataReady,ce=D(re,j);if(re.isDepthTexture)le=S(re.format===DepthStencilFormat,re.type),je&&(Ne?i.texStorage2D(s.TEXTURE_2D,1,le,j.width,j.height):i.texImage2D(s.TEXTURE_2D,0,le,j.width,j.height,0,ee,ne,null));else if(re.isDataTexture)if(Me.length>0){Ne&&je&&i.texStorage2D(s.TEXTURE_2D,ce,le,Me[0].width,Me[0].height);for(let ye=0,Pe=Me.length;ye<Pe;ye++)he=Me[ye],Ne?fe&&i.texSubImage2D(s.TEXTURE_2D,ye,0,0,he.width,he.height,ee,ne,he.data):i.texImage2D(s.TEXTURE_2D,ye,le,he.width,he.height,0,ee,ne,he.data);re.generateMipmaps=!1}else Ne?(je&&i.texStorage2D(s.TEXTURE_2D,ce,le,j.width,j.height),fe&&i.texSubImage2D(s.TEXTURE_2D,0,0,0,j.width,j.height,ee,ne,j.data)):i.texImage2D(s.TEXTURE_2D,0,le,j.width,j.height,0,ee,ne,j.data);else if(re.isCompressedTexture)if(re.isCompressedArrayTexture){Ne&&je&&i.texStorage3D(s.TEXTURE_2D_ARRAY,ce,le,Me[0].width,Me[0].height,j.depth);for(let ye=0,Pe=Me.length;ye<Pe;ye++)if(he=Me[ye],re.format!==RGBAFormat)if(ee!==null)if(Ne){if(fe)if(re.layerUpdates.size>0){for(const Ve of re.layerUpdates){const Qe=he.width*he.height;i.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,ye,0,0,Ve,he.width,he.height,1,ee,he.data.slice(Qe*Ve,Qe*(Ve+1)),0,0)}re.clearLayerUpdates()}else i.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,ye,0,0,0,he.width,he.height,j.depth,ee,he.data,0,0)}else i.compressedTexImage3D(s.TEXTURE_2D_ARRAY,ye,le,he.width,he.height,j.depth,0,he.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ne?fe&&i.texSubImage3D(s.TEXTURE_2D_ARRAY,ye,0,0,0,he.width,he.height,j.depth,ee,ne,he.data):i.texImage3D(s.TEXTURE_2D_ARRAY,ye,le,he.width,he.height,j.depth,0,ee,ne,he.data)}else{Ne&&je&&i.texStorage2D(s.TEXTURE_2D,ce,le,Me[0].width,Me[0].height);for(let ye=0,Pe=Me.length;ye<Pe;ye++)he=Me[ye],re.format!==RGBAFormat?ee!==null?Ne?fe&&i.compressedTexSubImage2D(s.TEXTURE_2D,ye,0,0,he.width,he.height,ee,he.data):i.compressedTexImage2D(s.TEXTURE_2D,ye,le,he.width,he.height,0,he.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ne?fe&&i.texSubImage2D(s.TEXTURE_2D,ye,0,0,he.width,he.height,ee,ne,he.data):i.texImage2D(s.TEXTURE_2D,ye,le,he.width,he.height,0,ee,ne,he.data)}else if(re.isDataArrayTexture)if(Ne){if(je&&i.texStorage3D(s.TEXTURE_2D_ARRAY,ce,le,j.width,j.height,j.depth),fe)if(re.layerUpdates.size>0){let ye;switch(ne){case s.UNSIGNED_BYTE:switch(ee){case s.ALPHA:ye=1;break;case s.LUMINANCE:ye=1;break;case s.LUMINANCE_ALPHA:ye=2;break;case s.RGB:ye=3;break;case s.RGBA:ye=4;break;default:throw new Error(`Unknown texel size for format ${ee}.`)}break;case s.UNSIGNED_SHORT_4_4_4_4:case s.UNSIGNED_SHORT_5_5_5_1:case s.UNSIGNED_SHORT_5_6_5:ye=1;break;default:throw new Error(`Unknown texel size for type ${ne}.`)}const Pe=j.width*j.height*ye;for(const Ve of re.layerUpdates)i.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,Ve,j.width,j.height,1,ee,ne,j.data.slice(Pe*Ve,Pe*(Ve+1)));re.clearLayerUpdates()}else i.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,j.width,j.height,j.depth,ee,ne,j.data)}else i.texImage3D(s.TEXTURE_2D_ARRAY,0,le,j.width,j.height,j.depth,0,ee,ne,j.data);else if(re.isData3DTexture)Ne?(je&&i.texStorage3D(s.TEXTURE_3D,ce,le,j.width,j.height,j.depth),fe&&i.texSubImage3D(s.TEXTURE_3D,0,0,0,0,j.width,j.height,j.depth,ee,ne,j.data)):i.texImage3D(s.TEXTURE_3D,0,le,j.width,j.height,j.depth,0,ee,ne,j.data);else if(re.isFramebufferTexture){if(je)if(Ne)i.texStorage2D(s.TEXTURE_2D,ce,le,j.width,j.height);else{let ye=j.width,Pe=j.height;for(let Ve=0;Ve<ce;Ve++)i.texImage2D(s.TEXTURE_2D,Ve,le,ye,Pe,0,ee,ne,null),ye>>=1,Pe>>=1}}else if(Me.length>0){if(Ne&&je){const ye=Oe(Me[0]);i.texStorage2D(s.TEXTURE_2D,ce,le,ye.width,ye.height)}for(let ye=0,Pe=Me.length;ye<Pe;ye++)he=Me[ye],Ne?fe&&i.texSubImage2D(s.TEXTURE_2D,ye,0,0,ee,ne,he):i.texImage2D(s.TEXTURE_2D,ye,le,ee,ne,he);re.generateMipmaps=!1}else if(Ne){if(j.is_dummy)je&&i.texStorage2D(s.TEXTURE_2D,ce,le,j.width,j.height),i.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,j.image_data);else if(je){const ye=Oe(j);i.texStorage2D(s.TEXTURE_2D,ce,le,ye.width,ye.height)}fe&&i.texSubImage2D(s.TEXTURE_2D,0,0,0,ee,ne,j)}else j.is_dummy?i.texImage2D(s.TEXTURE_2D,0,le,j.width,j.height,0,ee,ne,j.data):i.texImage2D(s.TEXTURE_2D,0,le,ee,ne,j);w(re)&&y(We),it.__version=Ye.version,re.onUpdate&&re.onUpdate(re)}ue.__version=re.version}function we(ue,re,ke){if(re.image.length!==6)return;const We=Ce(ue,re),Xe=re.source;i.bindTexture(s.TEXTURE_CUBE_MAP,ue.__webglTexture,s.TEXTURE0+ke);const Ye=r.get(Xe);if(Xe.version!==Ye.__version||We===!0){i.activeTexture(s.TEXTURE0+ke);const it=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),tt=re.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(re.colorSpace),Ke=re.colorSpace===NoColorSpace||it===tt?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,re.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,re.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,re.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ke);const ae=re.isCompressedTexture||re.image[0].isCompressedTexture,j=re.image[0]&&re.image[0].isDataTexture,ee=[];for(let Pe=0;Pe<6;Pe++)!ae&&!j?ee[Pe]=v(re.image[Pe],!0,o.maxCubemapSize):ee[Pe]=j?re.image[Pe].image:re.image[Pe],ee[Pe]=Be(re,ee[Pe]);const ne=ee[0],le=l.convert(re.format,re.colorSpace),he=l.convert(re.type),Me=M(re.internalFormat,le,he,re.colorSpace),Ne=re.isVideoTexture!==!0,je=Ye.__version===void 0||We===!0,fe=Xe.dataReady;let ce=D(re,ne);oe(s.TEXTURE_CUBE_MAP,re);let ye;if(ae){Ne&&je&&i.texStorage2D(s.TEXTURE_CUBE_MAP,ce,Me,ne.width,ne.height);for(let Pe=0;Pe<6;Pe++){ye=ee[Pe].mipmaps;for(let Ve=0;Ve<ye.length;Ve++){const Qe=ye[Ve];re.format!==RGBAFormat?le!==null?Ne?fe&&i.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ve,0,0,Qe.width,Qe.height,le,Qe.data):i.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ve,Me,Qe.width,Qe.height,0,Qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ne?fe&&i.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ve,0,0,Qe.width,Qe.height,le,he,Qe.data):i.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ve,Me,Qe.width,Qe.height,0,le,he,Qe.data)}}}else{if(ye=re.mipmaps,Ne&&je){ye.length>0&&ce++;const Pe=Oe(ee[0]);i.texStorage2D(s.TEXTURE_CUBE_MAP,ce,Me,Pe.width,Pe.height)}for(let Pe=0;Pe<6;Pe++)if(j){Ne?fe&&i.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,0,0,ee[Pe].width,ee[Pe].height,le,he,ee[Pe].data):i.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,Me,ee[Pe].width,ee[Pe].height,0,le,he,ee[Pe].data);for(let Ve=0;Ve<ye.length;Ve++){const at=ye[Ve].image[Pe].image;Ne?fe&&i.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ve+1,0,0,at.width,at.height,le,he,at.data):i.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ve+1,Me,at.width,at.height,0,le,he,at.data)}}else{Ne?fe&&i.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,0,0,le,he,ee[Pe]):i.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,Me,le,he,ee[Pe]);for(let Ve=0;Ve<ye.length;Ve++){const Qe=ye[Ve];Ne?fe&&i.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ve+1,0,0,le,he,Qe.image[Pe]):i.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ve+1,Me,le,he,Qe.image[Pe])}}}w(re)&&y(s.TEXTURE_CUBE_MAP),Ye.__version=Xe.version,re.onUpdate&&re.onUpdate(re)}ue.__version=re.version}function Se(ue,re,ke,We,Xe,Ye){const it=l.convert(ke.format,ke.colorSpace),tt=l.convert(ke.type),Ke=M(ke.internalFormat,it,tt,ke.colorSpace);if(!r.get(re).__hasExternalTextures){const j=Math.max(1,re.width>>Ye),ee=Math.max(1,re.height>>Ye);Xe===s.TEXTURE_3D||Xe===s.TEXTURE_2D_ARRAY?i.texImage3D(Xe,Ye,Ke,j,ee,re.depth,0,it,tt,null):i.texImage2D(Xe,Ye,Ke,j,ee,0,it,tt,null)}i.bindFramebuffer(s.FRAMEBUFFER,ue),Ee(re)?c.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,We,Xe,r.get(ke).__webglTexture,0,ge(re)):(Xe===s.TEXTURE_2D||Xe>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&Xe<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,We,Xe,r.get(ke).__webglTexture,Ye),i.bindFramebuffer(s.FRAMEBUFFER,null)}function Re(ue,re,ke){if(s.bindRenderbuffer(s.RENDERBUFFER,ue),re.depthBuffer){const We=re.depthTexture,Xe=We&&We.isDepthTexture?We.type:null,Ye=S(re.stencilBuffer,Xe),it=re.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,tt=ge(re);Ee(re)?c.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,tt,Ye,re.width,re.height):ke?s.renderbufferStorageMultisample(s.RENDERBUFFER,tt,Ye,re.width,re.height):s.renderbufferStorage(s.RENDERBUFFER,Ye,re.width,re.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,it,s.RENDERBUFFER,ue)}else{const We=re.textures;for(let Xe=0;Xe<We.length;Xe++){const Ye=We[Xe],it=l.convert(Ye.format,Ye.colorSpace),tt=l.convert(Ye.type),Ke=M(Ye.internalFormat,it,tt,Ye.colorSpace),ae=ge(re);ke&&Ee(re)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,ae,Ke,re.width,re.height):Ee(re)?c.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,ae,Ke,re.width,re.height):s.renderbufferStorage(s.RENDERBUFFER,Ke,re.width,re.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function Fe(ue,re){if(re&&re.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(s.FRAMEBUFFER,ue),!(re.depthTexture&&re.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(re.depthTexture).__webglTexture||re.depthTexture.image.width!==re.width||re.depthTexture.image.height!==re.height)&&(re.depthTexture.image.width=re.width,re.depthTexture.image.height=re.height,re.depthTexture.needsUpdate=!0),H(re.depthTexture,0);const We=r.get(re.depthTexture).__webglTexture,Xe=ge(re);if(re.depthTexture.format===DepthFormat)Ee(re)?c.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,We,0,Xe):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,We,0);else if(re.depthTexture.format===DepthStencilFormat)Ee(re)?c.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,We,0,Xe):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,We,0);else throw new Error("Unknown depthTexture format")}function $e(ue){const re=r.get(ue),ke=ue.isWebGLCubeRenderTarget===!0;if(ue.depthTexture&&!re.__autoAllocateDepthBuffer){if(ke)throw new Error("target.depthTexture not supported in Cube render targets");Fe(re.__webglFramebuffer,ue)}else if(ke){re.__webglDepthbuffer=[];for(let We=0;We<6;We++)i.bindFramebuffer(s.FRAMEBUFFER,re.__webglFramebuffer[We]),re.__webglDepthbuffer[We]=s.createRenderbuffer(),Re(re.__webglDepthbuffer[We],ue,!1)}else i.bindFramebuffer(s.FRAMEBUFFER,re.__webglFramebuffer),re.__webglDepthbuffer=s.createRenderbuffer(),Re(re.__webglDepthbuffer,ue,!1);i.bindFramebuffer(s.FRAMEBUFFER,null)}function Ue(ue,re,ke){const We=r.get(ue);re!==void 0&&Se(We.__webglFramebuffer,ue,ue.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,0),ke!==void 0&&$e(ue)}function qe(ue){const re=ue.texture,ke=r.get(ue),We=r.get(re);ue.addEventListener("dispose",O);const Xe=ue.textures,Ye=ue.isWebGLCubeRenderTarget===!0,it=Xe.length>1;if(it||(We.__webglTexture===void 0&&(We.__webglTexture=s.createTexture()),We.__version=re.version,a.memory.textures++),Ye){ke.__webglFramebuffer=[];for(let tt=0;tt<6;tt++)if(re.mipmaps&&re.mipmaps.length>0){ke.__webglFramebuffer[tt]=[];for(let Ke=0;Ke<re.mipmaps.length;Ke++)ke.__webglFramebuffer[tt][Ke]=s.createFramebuffer()}else ke.__webglFramebuffer[tt]=s.createFramebuffer()}else{if(re.mipmaps&&re.mipmaps.length>0){ke.__webglFramebuffer=[];for(let tt=0;tt<re.mipmaps.length;tt++)ke.__webglFramebuffer[tt]=s.createFramebuffer()}else ke.__webglFramebuffer=s.createFramebuffer();if(it)for(let tt=0,Ke=Xe.length;tt<Ke;tt++){const ae=r.get(Xe[tt]);ae.__webglTexture===void 0&&(ae.__webglTexture=s.createTexture(),a.memory.textures++)}if(ue.samples>0&&Ee(ue)===!1){ke.__webglMultisampledFramebuffer=s.createFramebuffer(),ke.__webglColorRenderbuffer=[],i.bindFramebuffer(s.FRAMEBUFFER,ke.__webglMultisampledFramebuffer);for(let tt=0;tt<Xe.length;tt++){const Ke=Xe[tt];ke.__webglColorRenderbuffer[tt]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,ke.__webglColorRenderbuffer[tt]);const ae=l.convert(Ke.format,Ke.colorSpace),j=l.convert(Ke.type),ee=M(Ke.internalFormat,ae,j,Ke.colorSpace,ue.isXRRenderTarget===!0),ne=ge(ue);s.renderbufferStorageMultisample(s.RENDERBUFFER,ne,ee,ue.width,ue.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+tt,s.RENDERBUFFER,ke.__webglColorRenderbuffer[tt])}s.bindRenderbuffer(s.RENDERBUFFER,null),ue.depthBuffer&&(ke.__webglDepthRenderbuffer=s.createRenderbuffer(),Re(ke.__webglDepthRenderbuffer,ue,!0)),i.bindFramebuffer(s.FRAMEBUFFER,null)}}if(Ye){i.bindTexture(s.TEXTURE_CUBE_MAP,We.__webglTexture),oe(s.TEXTURE_CUBE_MAP,re);for(let tt=0;tt<6;tt++)if(re.mipmaps&&re.mipmaps.length>0)for(let Ke=0;Ke<re.mipmaps.length;Ke++)Se(ke.__webglFramebuffer[tt][Ke],ue,re,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+tt,Ke);else Se(ke.__webglFramebuffer[tt],ue,re,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+tt,0);w(re)&&y(s.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(it){for(let tt=0,Ke=Xe.length;tt<Ke;tt++){const ae=Xe[tt],j=r.get(ae);i.bindTexture(s.TEXTURE_2D,j.__webglTexture),oe(s.TEXTURE_2D,ae),Se(ke.__webglFramebuffer,ue,ae,s.COLOR_ATTACHMENT0+tt,s.TEXTURE_2D,0),w(ae)&&y(s.TEXTURE_2D)}i.unbindTexture()}else{let tt=s.TEXTURE_2D;if((ue.isWebGL3DRenderTarget||ue.isWebGLArrayRenderTarget)&&(tt=ue.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY),i.bindTexture(tt,We.__webglTexture),oe(tt,re),re.mipmaps&&re.mipmaps.length>0)for(let Ke=0;Ke<re.mipmaps.length;Ke++)Se(ke.__webglFramebuffer[Ke],ue,re,s.COLOR_ATTACHMENT0,tt,Ke);else Se(ke.__webglFramebuffer,ue,re,s.COLOR_ATTACHMENT0,tt,0);w(re)&&y(tt),i.unbindTexture()}ue.depthBuffer&&$e(ue)}function _e(ue){const re=ue.textures;for(let ke=0,We=re.length;ke<We;ke++){const Xe=re[ke];if(w(Xe)){const Ye=ue.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D,it=r.get(Xe).__webglTexture;i.bindTexture(Ye,it),y(Ye),i.unbindTexture()}}}const be=[],De=[];function Te(ue){if(ue.samples>0){if(Ee(ue)===!1){const re=ue.textures,ke=ue.width,We=ue.height;let Xe=s.COLOR_BUFFER_BIT;const Ye=ue.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,it=r.get(ue),tt=re.length>1;if(tt)for(let Ke=0;Ke<re.length;Ke++)i.bindFramebuffer(s.FRAMEBUFFER,it.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ke,s.RENDERBUFFER,null),i.bindFramebuffer(s.FRAMEBUFFER,it.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ke,s.TEXTURE_2D,null,0);i.bindFramebuffer(s.READ_FRAMEBUFFER,it.__webglMultisampledFramebuffer),i.bindFramebuffer(s.DRAW_FRAMEBUFFER,it.__webglFramebuffer);for(let Ke=0;Ke<re.length;Ke++){if(ue.resolveDepthBuffer&&(ue.depthBuffer&&(Xe|=s.DEPTH_BUFFER_BIT),ue.stencilBuffer&&ue.resolveStencilBuffer&&(Xe|=s.STENCIL_BUFFER_BIT)),tt){s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,it.__webglColorRenderbuffer[Ke]);const ae=r.get(re[Ke]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,ae,0)}s.blitFramebuffer(0,0,ke,We,0,0,ke,We,Xe,s.NEAREST),d===!0&&(be.length=0,De.length=0,be.push(s.COLOR_ATTACHMENT0+Ke),ue.depthBuffer&&ue.resolveDepthBuffer===!1&&(be.push(Ye),De.push(Ye),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,De)),s.invalidateFramebuffer(s.READ_FRAMEBUFFER,be))}if(i.bindFramebuffer(s.READ_FRAMEBUFFER,null),i.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),tt)for(let Ke=0;Ke<re.length;Ke++){i.bindFramebuffer(s.FRAMEBUFFER,it.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ke,s.RENDERBUFFER,it.__webglColorRenderbuffer[Ke]);const ae=r.get(re[Ke]).__webglTexture;i.bindFramebuffer(s.FRAMEBUFFER,it.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ke,s.TEXTURE_2D,ae,0)}i.bindFramebuffer(s.DRAW_FRAMEBUFFER,it.__webglMultisampledFramebuffer)}else if(ue.depthBuffer&&ue.resolveDepthBuffer===!1&&d){const re=ue.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[re])}}}function ge(ue){return Math.min(o.maxSamples,ue.samples)}function Ee(ue){const re=r.get(ue);return ue.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&re.__useRenderToTexture!==!1}function Ie(ue){const re=a.render.frame;f.get(ue)!==re&&(f.set(ue,re),ue.update())}function Be(ue,re){const ke=ue.colorSpace,We=ue.format,Xe=ue.type;return ue.isCompressedTexture===!0||ue.isVideoTexture===!0||ke!==LinearSRGBColorSpace&&ke!==NoColorSpace&&(ColorManagement.getTransfer(ke)===SRGBTransfer?(We!==RGBAFormat||Xe!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ke)),re}function Oe(ue){return typeof HTMLImageElement<"u"&&ue instanceof HTMLImageElement?(u.width=ue.naturalWidth||ue.width,u.height=ue.naturalHeight||ue.height):typeof VideoFrame<"u"&&ue instanceof VideoFrame?(u.width=ue.displayWidth,u.height=ue.displayHeight):(u.width=ue.width,u.height=ue.height),u}this.allocateTextureUnit=Z,this.resetTextureUnits=K,this.setTexture2D=H,this.setTexture2DArray=Y,this.setTexture3D=q,this.setTextureCube=J,this.rebindTextures=Ue,this.setupRenderTarget=qe,this.updateRenderTargetMipmap=_e,this.updateMultisampleRenderTarget=Te,this.setupDepthRenderbuffer=$e,this.setupFrameBufferTexture=Se,this.useMultisampledRTT=Ee}function WebGLUtils(s,e){function i(r,o=NoColorSpace){let l;const a=ColorManagement.getTransfer(o);if(r===UnsignedByteType)return s.UNSIGNED_BYTE;if(r===UnsignedShort4444Type)return s.UNSIGNED_SHORT_4_4_4_4;if(r===UnsignedShort5551Type)return s.UNSIGNED_SHORT_5_5_5_1;if(r===UnsignedInt5999Type)return s.UNSIGNED_INT_5_9_9_9_REV;if(r===ByteType)return s.BYTE;if(r===ShortType)return s.SHORT;if(r===UnsignedShortType)return s.UNSIGNED_SHORT;if(r===IntType)return s.INT;if(r===UnsignedIntType)return s.UNSIGNED_INT;if(r===FloatType)return s.FLOAT;if(r===HalfFloatType)return s.HALF_FLOAT;if(r===AlphaFormat)return s.ALPHA;if(r===RGBFormat)return s.RGB;if(r===RGBAFormat)return s.RGBA;if(r===LuminanceFormat)return s.LUMINANCE;if(r===LuminanceAlphaFormat)return s.LUMINANCE_ALPHA;if(r===DepthFormat)return s.DEPTH_COMPONENT;if(r===DepthStencilFormat)return s.DEPTH_STENCIL;if(r===RedFormat)return s.RED;if(r===RedIntegerFormat)return s.RED_INTEGER;if(r===RGFormat)return s.RG;if(r===RGIntegerFormat)return s.RG_INTEGER;if(r===RGBAIntegerFormat)return s.RGBA_INTEGER;if(r===RGB_S3TC_DXT1_Format$1||r===RGBA_S3TC_DXT1_Format||r===RGBA_S3TC_DXT3_Format$1||r===RGBA_S3TC_DXT5_Format$1)if(a===SRGBTransfer)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(r===RGB_S3TC_DXT1_Format$1)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT1_Format)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT3_Format$1)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===RGBA_S3TC_DXT5_Format$1)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(r===RGB_S3TC_DXT1_Format$1)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT1_Format)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT3_Format$1)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===RGBA_S3TC_DXT5_Format$1)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===RGB_PVRTC_4BPPV1_Format||r===RGB_PVRTC_2BPPV1_Format||r===RGBA_PVRTC_4BPPV1_Format||r===RGBA_PVRTC_2BPPV1_Format)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(r===RGB_PVRTC_4BPPV1_Format)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===RGB_PVRTC_2BPPV1_Format)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===RGBA_PVRTC_4BPPV1_Format)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===RGBA_PVRTC_2BPPV1_Format)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===RGB_ETC1_Format$1||r===RGB_ETC2_Format||r===RGBA_ETC2_EAC_Format)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(r===RGB_ETC1_Format$1||r===RGB_ETC2_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(r===RGBA_ETC2_EAC_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===RGBA_ASTC_4x4_Format||r===RGBA_ASTC_5x4_Format||r===RGBA_ASTC_5x5_Format||r===RGBA_ASTC_6x5_Format||r===RGBA_ASTC_6x6_Format||r===RGBA_ASTC_8x5_Format||r===RGBA_ASTC_8x6_Format||r===RGBA_ASTC_8x8_Format||r===RGBA_ASTC_10x5_Format||r===RGBA_ASTC_10x6_Format||r===RGBA_ASTC_10x8_Format||r===RGBA_ASTC_10x10_Format||r===RGBA_ASTC_12x10_Format||r===RGBA_ASTC_12x12_Format)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(r===RGBA_ASTC_4x4_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===RGBA_ASTC_5x4_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===RGBA_ASTC_5x5_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===RGBA_ASTC_6x5_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===RGBA_ASTC_6x6_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===RGBA_ASTC_8x5_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===RGBA_ASTC_8x6_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===RGBA_ASTC_8x8_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===RGBA_ASTC_10x5_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===RGBA_ASTC_10x6_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===RGBA_ASTC_10x8_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===RGBA_ASTC_10x10_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===RGBA_ASTC_12x10_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===RGBA_ASTC_12x12_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===RGBA_BPTC_Format||r===RGB_BPTC_SIGNED_Format||r===RGB_BPTC_UNSIGNED_Format)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(r===RGBA_BPTC_Format)return a===SRGBTransfer?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===RGB_BPTC_SIGNED_Format)return l.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===RGB_BPTC_UNSIGNED_Format)return l.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===RED_RGTC1_Format||r===SIGNED_RED_RGTC1_Format||r===RED_GREEN_RGTC2_Format||r===SIGNED_RED_GREEN_RGTC2_Format)if(l=e.get("EXT_texture_compression_rgtc"),l!==null){if(r===RGBA_BPTC_Format)return l.COMPRESSED_RED_RGTC1_EXT;if(r===SIGNED_RED_RGTC1_Format)return l.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===RED_GREEN_RGTC2_Format)return l.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===SIGNED_RED_GREEN_RGTC2_Format)return l.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===UnsignedInt248Type?s.UNSIGNED_INT_24_8:s[r]!==void 0?s[r]:null}return{convert:i}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const r of e.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,r){let o=null,l=null,a=null;const c=this._targetRay,d=this._grip,u=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(u&&e.hand){a=!0;for(const v of e.hand.values()){const w=i.getJointPose(v,r),y=this._getHandJoint(u,v);w!==null&&(y.matrix.fromArray(w.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=w.radius),y.visible=w!==null}const f=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],h=f.position.distanceTo(m.position),_=.02,b=.005;u.inputState.pinching&&h>_+b?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&h<=_-b&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else d!==null&&e.gripSpace&&(l=i.getPose(e.gripSpace,r),l!==null&&(d.matrix.fromArray(l.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,l.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(l.linearVelocity)):d.hasLinearVelocity=!1,l.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(l.angularVelocity)):d.hasAngularVelocity=!1));c!==null&&(o=i.getPose(e.targetRaySpace,r),o===null&&l!==null&&(o=l),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return c!==null&&(c.visible=o!==null),d!==null&&(d.visible=l!==null),u!==null&&(u.visible=a!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const r=new Group;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[i.jointName]=r,e.add(r)}return e.joints[i.jointName]}}const _occlusion_vertex=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,_occlusion_fragment=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WebXRDepthSensing{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,r){if(this.texture===null){const o=new Texture,l=e.properties.get(o);l.__webglTexture=i.texture,(i.depthNear!=r.depthNear||i.depthFar!=r.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=o}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,r=new ShaderMaterial({vertexShader:_occlusion_vertex,fragmentShader:_occlusion_fragment,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new Mesh(new PlaneGeometry(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}}class WebXRManager extends EventDispatcher{constructor(e,i){super();const r=this;let o=null,l=1,a=null,c="local-floor",d=1,u=null,f=null,m=null,h=null,_=null,b=null;const v=new WebXRDepthSensing,w=i.getContextAttributes();let y=null,M=null;const S=[],D=[],k=new Vector2;let O=null;const L=new PerspectiveCamera;L.layers.enable(1),L.viewport=new Vector4;const P=new PerspectiveCamera;P.layers.enable(2),P.viewport=new Vector4;const N=[L,P],z=new ArrayCamera;z.layers.enable(1),z.layers.enable(2);let K=null,Z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(we){let Se=S[we];return Se===void 0&&(Se=new WebXRController,S[we]=Se),Se.getTargetRaySpace()},this.getControllerGrip=function(we){let Se=S[we];return Se===void 0&&(Se=new WebXRController,S[we]=Se),Se.getGripSpace()},this.getHand=function(we){let Se=S[we];return Se===void 0&&(Se=new WebXRController,S[we]=Se),Se.getHandSpace()};function V(we){const Se=D.indexOf(we.inputSource);if(Se===-1)return;const Re=S[Se];Re!==void 0&&(Re.update(we.inputSource,we.frame,u||a),Re.dispatchEvent({type:we.type,data:we.inputSource}))}function H(){o.removeEventListener("select",V),o.removeEventListener("selectstart",V),o.removeEventListener("selectend",V),o.removeEventListener("squeeze",V),o.removeEventListener("squeezestart",V),o.removeEventListener("squeezeend",V),o.removeEventListener("end",H),o.removeEventListener("inputsourceschange",Y);for(let we=0;we<S.length;we++){const Se=D[we];Se!==null&&(D[we]=null,S[we].disconnect(Se))}K=null,Z=null,v.reset(),e.setRenderTarget(y),_=null,h=null,m=null,o=null,M=null,ve.stop(),r.isPresenting=!1,e.setPixelRatio(O),e.setSize(k.width,k.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(we){l=we,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(we){c=we,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(we){u=we},this.getBaseLayer=function(){return h!==null?h:_},this.getBinding=function(){return m},this.getFrame=function(){return b},this.getSession=function(){return o},this.setSession=async function(we){if(o=we,o!==null){if(y=e.getRenderTarget(),o.addEventListener("select",V),o.addEventListener("selectstart",V),o.addEventListener("selectend",V),o.addEventListener("squeeze",V),o.addEventListener("squeezestart",V),o.addEventListener("squeezeend",V),o.addEventListener("end",H),o.addEventListener("inputsourceschange",Y),w.xrCompatible!==!0&&await i.makeXRCompatible(),O=e.getPixelRatio(),e.getSize(k),o.renderState.layers===void 0){const Se={antialias:w.antialias,alpha:!0,depth:w.depth,stencil:w.stencil,framebufferScaleFactor:l};_=new XRWebGLLayer(o,i,Se),o.updateRenderState({baseLayer:_}),e.setPixelRatio(1),e.setSize(_.framebufferWidth,_.framebufferHeight,!1),M=new WebGLRenderTarget(_.framebufferWidth,_.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:e.outputColorSpace,stencilBuffer:w.stencil})}else{let Se=null,Re=null,Fe=null;w.depth&&(Fe=w.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,Se=w.stencil?DepthStencilFormat:DepthFormat,Re=w.stencil?UnsignedInt248Type:UnsignedIntType);const $e={colorFormat:i.RGBA8,depthFormat:Fe,scaleFactor:l};m=new XRWebGLBinding(o,i),h=m.createProjectionLayer($e),o.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),M=new WebGLRenderTarget(h.textureWidth,h.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(h.textureWidth,h.textureHeight,Re,void 0,void 0,void 0,void 0,void 0,void 0,Se),stencilBuffer:w.stencil,colorSpace:e.outputColorSpace,samples:w.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1})}M.isXRRenderTarget=!0,this.setFoveation(d),u=null,a=await o.requestReferenceSpace(c),ve.setContext(o),ve.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(o!==null)return o.environmentBlendMode};function Y(we){for(let Se=0;Se<we.removed.length;Se++){const Re=we.removed[Se],Fe=D.indexOf(Re);Fe>=0&&(D[Fe]=null,S[Fe].disconnect(Re))}for(let Se=0;Se<we.added.length;Se++){const Re=we.added[Se];let Fe=D.indexOf(Re);if(Fe===-1){for(let Ue=0;Ue<S.length;Ue++)if(Ue>=D.length){D.push(Re),Fe=Ue;break}else if(D[Ue]===null){D[Ue]=Re,Fe=Ue;break}if(Fe===-1)break}const $e=S[Fe];$e&&$e.connect(Re)}}const q=new Vector3,J=new Vector3;function W(we,Se,Re){q.setFromMatrixPosition(Se.matrixWorld),J.setFromMatrixPosition(Re.matrixWorld);const Fe=q.distanceTo(J),$e=Se.projectionMatrix.elements,Ue=Re.projectionMatrix.elements,qe=$e[14]/($e[10]-1),_e=$e[14]/($e[10]+1),be=($e[9]+1)/$e[5],De=($e[9]-1)/$e[5],Te=($e[8]-1)/$e[0],ge=(Ue[8]+1)/Ue[0],Ee=qe*Te,Ie=qe*ge,Be=Fe/(-Te+ge),Oe=Be*-Te;Se.matrixWorld.decompose(we.position,we.quaternion,we.scale),we.translateX(Oe),we.translateZ(Be),we.matrixWorld.compose(we.position,we.quaternion,we.scale),we.matrixWorldInverse.copy(we.matrixWorld).invert();const ue=qe+Be,re=_e+Be,ke=Ee-Oe,We=Ie+(Fe-Oe),Xe=be*_e/re*ue,Ye=De*_e/re*ue;we.projectionMatrix.makePerspective(ke,We,Xe,Ye,ue,re),we.projectionMatrixInverse.copy(we.projectionMatrix).invert()}function te(we,Se){Se===null?we.matrixWorld.copy(we.matrix):we.matrixWorld.multiplyMatrices(Se.matrixWorld,we.matrix),we.matrixWorldInverse.copy(we.matrixWorld).invert()}this.updateCamera=function(we){if(o===null)return;v.texture!==null&&(we.near=v.depthNear,we.far=v.depthFar),z.near=P.near=L.near=we.near,z.far=P.far=L.far=we.far,(K!==z.near||Z!==z.far)&&(o.updateRenderState({depthNear:z.near,depthFar:z.far}),K=z.near,Z=z.far,L.near=K,L.far=Z,P.near=K,P.far=Z,L.updateProjectionMatrix(),P.updateProjectionMatrix(),we.updateProjectionMatrix());const Se=we.parent,Re=z.cameras;te(z,Se);for(let Fe=0;Fe<Re.length;Fe++)te(Re[Fe],Se);Re.length===2?W(z,L,P):z.projectionMatrix.copy(L.projectionMatrix),ie(we,z,Se)};function ie(we,Se,Re){Re===null?we.matrix.copy(Se.matrixWorld):(we.matrix.copy(Re.matrixWorld),we.matrix.invert(),we.matrix.multiply(Se.matrixWorld)),we.matrix.decompose(we.position,we.quaternion,we.scale),we.updateMatrixWorld(!0),we.projectionMatrix.copy(Se.projectionMatrix),we.projectionMatrixInverse.copy(Se.projectionMatrixInverse),we.isPerspectiveCamera&&(we.fov=RAD2DEG*2*Math.atan(1/we.projectionMatrix.elements[5]),we.zoom=1)}this.getCamera=function(){return z},this.getFoveation=function(){if(!(h===null&&_===null))return d},this.setFoveation=function(we){d=we,h!==null&&(h.fixedFoveation=we),_!==null&&_.fixedFoveation!==void 0&&(_.fixedFoveation=we)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(z)};let oe=null;function Ce(we,Se){if(f=Se.getViewerPose(u||a),b=Se,f!==null){const Re=f.views;_!==null&&(e.setRenderTargetFramebuffer(M,_.framebuffer),e.setRenderTarget(M));let Fe=!1;Re.length!==z.cameras.length&&(z.cameras.length=0,Fe=!0);for(let Ue=0;Ue<Re.length;Ue++){const qe=Re[Ue];let _e=null;if(_!==null)_e=_.getViewport(qe);else{const De=m.getViewSubImage(h,qe);_e=De.viewport,Ue===0&&(e.setRenderTargetTextures(M,De.colorTexture,h.ignoreDepthValues?void 0:De.depthStencilTexture),e.setRenderTarget(M))}let be=N[Ue];be===void 0&&(be=new PerspectiveCamera,be.layers.enable(Ue),be.viewport=new Vector4,N[Ue]=be),be.matrix.fromArray(qe.transform.matrix),be.matrix.decompose(be.position,be.quaternion,be.scale),be.projectionMatrix.fromArray(qe.projectionMatrix),be.projectionMatrixInverse.copy(be.projectionMatrix).invert(),be.viewport.set(_e.x,_e.y,_e.width,_e.height),Ue===0&&(z.matrix.copy(be.matrix),z.matrix.decompose(z.position,z.quaternion,z.scale)),Fe===!0&&z.cameras.push(be)}const $e=o.enabledFeatures;if($e&&$e.includes("depth-sensing")){const Ue=m.getDepthInformation(Re[0]);Ue&&Ue.isValid&&Ue.texture&&v.init(e,Ue,o.renderState)}}for(let Re=0;Re<S.length;Re++){const Fe=D[Re],$e=S[Re];Fe!==null&&$e!==void 0&&$e.update(Fe,Se,u||a)}oe&&oe(we,Se),Se.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Se}),b=null}const ve=new WebGLAnimation;ve.setAnimationLoop(Ce),this.setAnimationLoop=function(we){oe=we},this.dispose=function(){}}}const _e1=new Euler,_m1=new Matrix4;function WebGLMaterials(s,e){function i(w,y){w.matrixAutoUpdate===!0&&w.updateMatrix(),y.value.copy(w.matrix)}function r(w,y){y.color.getRGB(w.fogColor.value,getUnlitUniformColorSpace(s)),y.isFog?(w.fogNear.value=y.near,w.fogFar.value=y.far):y.isFogExp2&&(w.fogDensity.value=y.density)}function o(w,y,M,S,D){y.isMeshBasicMaterial||y.isMeshLambertMaterial?l(w,y):y.isMeshToonMaterial?(l(w,y),m(w,y)):y.isMeshPhongMaterial?(l(w,y),f(w,y)):y.isMeshStandardMaterial?(l(w,y),h(w,y),y.isMeshPhysicalMaterial&&_(w,y,D)):y.isMeshMatcapMaterial?(l(w,y),b(w,y)):y.isMeshDepthMaterial?l(w,y):y.isMeshDistanceMaterial?(l(w,y),v(w,y)):y.isMeshNormalMaterial?l(w,y):y.isLineBasicMaterial?(a(w,y),y.isLineDashedMaterial&&c(w,y)):y.isPointsMaterial?d(w,y,M,S):y.isSpriteMaterial?u(w,y):y.isShadowMaterial?(w.color.value.copy(y.color),w.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function l(w,y){w.opacity.value=y.opacity,y.color&&w.diffuse.value.copy(y.color),y.emissive&&w.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(w.map.value=y.map,i(y.map,w.mapTransform)),y.alphaMap&&(w.alphaMap.value=y.alphaMap,i(y.alphaMap,w.alphaMapTransform)),y.bumpMap&&(w.bumpMap.value=y.bumpMap,i(y.bumpMap,w.bumpMapTransform),w.bumpScale.value=y.bumpScale,y.side===BackSide&&(w.bumpScale.value*=-1)),y.normalMap&&(w.normalMap.value=y.normalMap,i(y.normalMap,w.normalMapTransform),w.normalScale.value.copy(y.normalScale),y.side===BackSide&&w.normalScale.value.negate()),y.displacementMap&&(w.displacementMap.value=y.displacementMap,i(y.displacementMap,w.displacementMapTransform),w.displacementScale.value=y.displacementScale,w.displacementBias.value=y.displacementBias),y.emissiveMap&&(w.emissiveMap.value=y.emissiveMap,i(y.emissiveMap,w.emissiveMapTransform)),y.specularMap&&(w.specularMap.value=y.specularMap,i(y.specularMap,w.specularMapTransform)),y.alphaTest>0&&(w.alphaTest.value=y.alphaTest);const M=e.get(y),S=M.envMap,D=M.envMapRotation;S&&(w.envMap.value=S,_e1.copy(D),_e1.x*=-1,_e1.y*=-1,_e1.z*=-1,S.isCubeTexture&&S.isRenderTargetTexture===!1&&(_e1.y*=-1,_e1.z*=-1),w.envMapRotation.value.setFromMatrix4(_m1.makeRotationFromEuler(_e1)),w.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,w.reflectivity.value=y.reflectivity,w.ior.value=y.ior,w.refractionRatio.value=y.refractionRatio),y.lightMap&&(w.lightMap.value=y.lightMap,w.lightMapIntensity.value=y.lightMapIntensity,i(y.lightMap,w.lightMapTransform)),y.aoMap&&(w.aoMap.value=y.aoMap,w.aoMapIntensity.value=y.aoMapIntensity,i(y.aoMap,w.aoMapTransform))}function a(w,y){w.diffuse.value.copy(y.color),w.opacity.value=y.opacity,y.map&&(w.map.value=y.map,i(y.map,w.mapTransform))}function c(w,y){w.dashSize.value=y.dashSize,w.totalSize.value=y.dashSize+y.gapSize,w.scale.value=y.scale}function d(w,y,M,S){w.diffuse.value.copy(y.color),w.opacity.value=y.opacity,w.size.value=y.size*M,w.scale.value=S*.5,y.map&&(w.map.value=y.map,i(y.map,w.uvTransform)),y.alphaMap&&(w.alphaMap.value=y.alphaMap,i(y.alphaMap,w.alphaMapTransform)),y.alphaTest>0&&(w.alphaTest.value=y.alphaTest)}function u(w,y){w.diffuse.value.copy(y.color),w.opacity.value=y.opacity,w.rotation.value=y.rotation,y.map&&(w.map.value=y.map,i(y.map,w.mapTransform)),y.alphaMap&&(w.alphaMap.value=y.alphaMap,i(y.alphaMap,w.alphaMapTransform)),y.alphaTest>0&&(w.alphaTest.value=y.alphaTest)}function f(w,y){w.specular.value.copy(y.specular),w.shininess.value=Math.max(y.shininess,1e-4)}function m(w,y){y.gradientMap&&(w.gradientMap.value=y.gradientMap)}function h(w,y){w.metalness.value=y.metalness,y.metalnessMap&&(w.metalnessMap.value=y.metalnessMap,i(y.metalnessMap,w.metalnessMapTransform)),w.roughness.value=y.roughness,y.roughnessMap&&(w.roughnessMap.value=y.roughnessMap,i(y.roughnessMap,w.roughnessMapTransform)),y.envMap&&(w.envMapIntensity.value=y.envMapIntensity)}function _(w,y,M){w.ior.value=y.ior,y.sheen>0&&(w.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),w.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(w.sheenColorMap.value=y.sheenColorMap,i(y.sheenColorMap,w.sheenColorMapTransform)),y.sheenRoughnessMap&&(w.sheenRoughnessMap.value=y.sheenRoughnessMap,i(y.sheenRoughnessMap,w.sheenRoughnessMapTransform))),y.clearcoat>0&&(w.clearcoat.value=y.clearcoat,w.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(w.clearcoatMap.value=y.clearcoatMap,i(y.clearcoatMap,w.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(w.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,i(y.clearcoatRoughnessMap,w.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(w.clearcoatNormalMap.value=y.clearcoatNormalMap,i(y.clearcoatNormalMap,w.clearcoatNormalMapTransform),w.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===BackSide&&w.clearcoatNormalScale.value.negate())),y.dispersion>0&&(w.dispersion.value=y.dispersion),y.iridescence>0&&(w.iridescence.value=y.iridescence,w.iridescenceIOR.value=y.iridescenceIOR,w.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],w.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(w.iridescenceMap.value=y.iridescenceMap,i(y.iridescenceMap,w.iridescenceMapTransform)),y.iridescenceThicknessMap&&(w.iridescenceThicknessMap.value=y.iridescenceThicknessMap,i(y.iridescenceThicknessMap,w.iridescenceThicknessMapTransform))),y.transmission>0&&(w.transmission.value=y.transmission,w.transmissionSamplerMap.value=M.texture,w.transmissionSamplerSize.value.set(M.width,M.height),y.transmissionMap&&(w.transmissionMap.value=y.transmissionMap,i(y.transmissionMap,w.transmissionMapTransform)),w.thickness.value=y.thickness,y.thicknessMap&&(w.thicknessMap.value=y.thicknessMap,i(y.thicknessMap,w.thicknessMapTransform)),w.attenuationDistance.value=y.attenuationDistance,w.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(w.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(w.anisotropyMap.value=y.anisotropyMap,i(y.anisotropyMap,w.anisotropyMapTransform))),w.specularIntensity.value=y.specularIntensity,w.specularColor.value.copy(y.specularColor),y.specularColorMap&&(w.specularColorMap.value=y.specularColorMap,i(y.specularColorMap,w.specularColorMapTransform)),y.specularIntensityMap&&(w.specularIntensityMap.value=y.specularIntensityMap,i(y.specularIntensityMap,w.specularIntensityMapTransform))}function b(w,y){y.matcap&&(w.matcap.value=y.matcap)}function v(w,y){const M=e.get(y).light;w.referencePosition.value.setFromMatrixPosition(M.matrixWorld),w.nearDistance.value=M.shadow.camera.near,w.farDistance.value=M.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:o}}function WebGLUniformsGroups(s,e,i,r){let o={},l={},a=[];const c=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS);function d(M,S){const D=S.program;r.uniformBlockBinding(M,D)}function u(M,S){let D=o[M.id];D===void 0&&(b(M),D=f(M),o[M.id]=D,M.addEventListener("dispose",w));const k=S.program;r.updateUBOMapping(M,k);const O=e.render.frame;l[M.id]!==O&&(h(M),l[M.id]=O)}function f(M){const S=m();M.__bindingPointIndex=S;const D=s.createBuffer(),k=M.__size,O=M.usage;return s.bindBuffer(s.UNIFORM_BUFFER,D),s.bufferData(s.UNIFORM_BUFFER,k,O),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,S,D),D}function m(){for(let M=0;M<c;M++)if(a.indexOf(M)===-1)return a.push(M),M;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(M){const S=o[M.id],D=M.uniforms,k=M.__cache;s.bindBuffer(s.UNIFORM_BUFFER,S);for(let O=0,L=D.length;O<L;O++){const P=Array.isArray(D[O])?D[O]:[D[O]];for(let N=0,z=P.length;N<z;N++){const K=P[N];if(_(K,O,N,k)===!0){const Z=K.__offset,V=Array.isArray(K.value)?K.value:[K.value];let H=0;for(let Y=0;Y<V.length;Y++){const q=V[Y],J=v(q);typeof q=="number"||typeof q=="boolean"?(K.__data[0]=q,s.bufferSubData(s.UNIFORM_BUFFER,Z+H,K.__data)):q.isMatrix3?(K.__data[0]=q.elements[0],K.__data[1]=q.elements[1],K.__data[2]=q.elements[2],K.__data[3]=0,K.__data[4]=q.elements[3],K.__data[5]=q.elements[4],K.__data[6]=q.elements[5],K.__data[7]=0,K.__data[8]=q.elements[6],K.__data[9]=q.elements[7],K.__data[10]=q.elements[8],K.__data[11]=0):(q.toArray(K.__data,H),H+=J.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,Z,K.__data)}}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function _(M,S,D,k){const O=M.value,L=S+"_"+D;if(k[L]===void 0)return typeof O=="number"||typeof O=="boolean"?k[L]=O:k[L]=O.clone(),!0;{const P=k[L];if(typeof O=="number"||typeof O=="boolean"){if(P!==O)return k[L]=O,!0}else if(P.equals(O)===!1)return P.copy(O),!0}return!1}function b(M){const S=M.uniforms;let D=0;const k=16;for(let L=0,P=S.length;L<P;L++){const N=Array.isArray(S[L])?S[L]:[S[L]];for(let z=0,K=N.length;z<K;z++){const Z=N[z],V=Array.isArray(Z.value)?Z.value:[Z.value];for(let H=0,Y=V.length;H<Y;H++){const q=V[H],J=v(q),W=D%k;W!==0&&k-W<J.boundary&&(D+=k-W),Z.__data=new Float32Array(J.storage/Float32Array.BYTES_PER_ELEMENT),Z.__offset=D,D+=J.storage}}}const O=D%k;return O>0&&(D+=k-O),M.__size=D,M.__cache={},this}function v(M){const S={boundary:0,storage:0};return typeof M=="number"||typeof M=="boolean"?(S.boundary=4,S.storage=4):M.isVector2?(S.boundary=8,S.storage=8):M.isVector3||M.isColor?(S.boundary=16,S.storage=12):M.isVector4?(S.boundary=16,S.storage=16):M.isMatrix3?(S.boundary=48,S.storage=48):M.isMatrix4?(S.boundary=64,S.storage=64):M.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",M),S}function w(M){const S=M.target;S.removeEventListener("dispose",w);const D=a.indexOf(S.__bindingPointIndex);a.splice(D,1),s.deleteBuffer(o[S.id]),delete o[S.id],delete l[S.id]}function y(){for(const M in o)s.deleteBuffer(o[M]);a=[],o={},l={}}return{bind:d,update:u,dispose:y}}class WebGLRenderer{constructor(e={}){const{canvas:i=createCanvasElement(),context:r=null,depth:o=!0,stencil:l=!1,alpha:a=!1,antialias:c=!1,premultipliedAlpha:d=!0,preserveDrawingBuffer:u=!1,powerPreference:f="default",failIfMajorPerformanceCaveat:m=!1}=e;this.isWebGLRenderer=!0;let h;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=r.getContextAttributes().alpha}else h=a;const _=new Uint32Array(4),b=new Int32Array(4);let v=null,w=null;const y=[],M=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const S=this;let D=!1,k=0,O=0,L=null,P=-1,N=null;const z=new Vector4,K=new Vector4;let Z=null;const V=new Color(0);let H=0,Y=i.width,q=i.height,J=1,W=null,te=null;const ie=new Vector4(0,0,Y,q),oe=new Vector4(0,0,Y,q);let Ce=!1;const ve=new Frustum;let we=!1,Se=!1;const Re=new Matrix4,Fe=new Vector3,$e={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ue=!1;function qe(){return L===null?J:1}let _e=r;function be(me,Le){return i.getContext(me,Le)}try{const me={alpha:!0,depth:o,stencil:l,antialias:c,premultipliedAlpha:d,preserveDrawingBuffer:u,powerPreference:f,failIfMajorPerformanceCaveat:m};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${REVISION}`),i.addEventListener("webglcontextlost",ce,!1),i.addEventListener("webglcontextrestored",ye,!1),i.addEventListener("webglcontextcreationerror",Pe,!1),_e===null){const Le="webgl2";if(_e=be(Le,me),_e===null)throw be(Le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(me){throw console.error("THREE.WebGLRenderer: "+me.message),me}let De,Te,ge,Ee,Ie,Be,Oe,ue,re,ke,We,Xe,Ye,it,tt,Ke,ae,j,ee,ne,le,he,Me,Ne;function je(){De=new WebGLExtensions(_e),De.init(),he=new WebGLUtils(_e,De),Te=new WebGLCapabilities(_e,De,e,he),ge=new WebGLState(_e),Ee=new WebGLInfo(_e),Ie=new WebGLProperties,Be=new WebGLTextures(_e,De,ge,Ie,Te,he,Ee),Oe=new WebGLCubeMaps(S),ue=new WebGLCubeUVMaps(S),re=new WebGLAttributes(_e),Me=new WebGLBindingStates(_e,re),ke=new WebGLGeometries(_e,re,Ee,Me),We=new WebGLObjects(_e,ke,re,Ee),ee=new WebGLMorphtargets(_e,Te,Be),Ke=new WebGLClipping(Ie),Xe=new WebGLPrograms(S,Oe,ue,De,Te,Me,Ke),Ye=new WebGLMaterials(S,Ie),it=new WebGLRenderLists,tt=new WebGLRenderStates(De),j=new WebGLBackground(S,Oe,ue,ge,We,h,d),ae=new WebGLShadowMap(S,We,Te),Ne=new WebGLUniformsGroups(_e,Ee,Te,ge),ne=new WebGLBufferRenderer(_e,De,Ee),le=new WebGLIndexedBufferRenderer(_e,De,Ee),Ee.programs=Xe.programs,S.capabilities=Te,S.extensions=De,S.properties=Ie,S.renderLists=it,S.shadowMap=ae,S.state=ge,S.info=Ee}je();const fe=new WebXRManager(S,_e);this.xr=fe,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const me=De.get("WEBGL_lose_context");me&&me.loseContext()},this.forceContextRestore=function(){const me=De.get("WEBGL_lose_context");me&&me.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(me){me!==void 0&&(J=me,this.setSize(Y,q,!1))},this.getSize=function(me){return me.set(Y,q)},this.setSize=function(me,Le,ze=!0){if(fe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Y=me,q=Le,i.width=Math.floor(me*J),i.height=Math.floor(Le*J),ze===!0&&(i.style.width=me+"px",i.style.height=Le+"px"),this.setViewport(0,0,me,Le)},this.getDrawingBufferSize=function(me){return me.set(Y*J,q*J).floor()},this.setDrawingBufferSize=function(me,Le,ze){Y=me,q=Le,J=ze,i.width=Math.floor(me*ze),i.height=Math.floor(Le*ze),this.setViewport(0,0,me,Le)},this.getCurrentViewport=function(me){return me.copy(z)},this.getViewport=function(me){return me.copy(ie)},this.setViewport=function(me,Le,ze,He){me.isVector4?ie.set(me.x,me.y,me.z,me.w):ie.set(me,Le,ze,He),ge.viewport(z.copy(ie).multiplyScalar(J).round())},this.getScissor=function(me){return me.copy(oe)},this.setScissor=function(me,Le,ze,He){me.isVector4?oe.set(me.x,me.y,me.z,me.w):oe.set(me,Le,ze,He),ge.scissor(K.copy(oe).multiplyScalar(J).round())},this.getScissorTest=function(){return Ce},this.setScissorTest=function(me){ge.setScissorTest(Ce=me)},this.setOpaqueSort=function(me){W=me},this.setTransparentSort=function(me){te=me},this.getClearColor=function(me){return me.copy(j.getClearColor())},this.setClearColor=function(){j.setClearColor.apply(j,arguments)},this.getClearAlpha=function(){return j.getClearAlpha()},this.setClearAlpha=function(){j.setClearAlpha.apply(j,arguments)},this.clear=function(me=!0,Le=!0,ze=!0){let He=0;if(me){let Ge=!1;if(L!==null){const et=L.texture.format;Ge=et===RGBAIntegerFormat||et===RGIntegerFormat||et===RedIntegerFormat}if(Ge){const et=L.texture.type,Je=et===UnsignedByteType||et===UnsignedIntType||et===UnsignedShortType||et===UnsignedInt248Type||et===UnsignedShort4444Type||et===UnsignedShort5551Type,st=j.getClearColor(),rt=j.getClearAlpha(),ut=st.r,At=st.g,vt=st.b;Je?(_[0]=ut,_[1]=At,_[2]=vt,_[3]=rt,_e.clearBufferuiv(_e.COLOR,0,_)):(b[0]=ut,b[1]=At,b[2]=vt,b[3]=rt,_e.clearBufferiv(_e.COLOR,0,b))}else He|=_e.COLOR_BUFFER_BIT}Le&&(He|=_e.DEPTH_BUFFER_BIT),ze&&(He|=_e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),_e.clear(He)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",ce,!1),i.removeEventListener("webglcontextrestored",ye,!1),i.removeEventListener("webglcontextcreationerror",Pe,!1),it.dispose(),tt.dispose(),Ie.dispose(),Oe.dispose(),ue.dispose(),We.dispose(),Me.dispose(),Ne.dispose(),Xe.dispose(),fe.dispose(),fe.removeEventListener("sessionstart",ot),fe.removeEventListener("sessionend",mt),pt.stop()};function ce(me){me.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),D=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),D=!1;const me=Ee.autoReset,Le=ae.enabled,ze=ae.autoUpdate,He=ae.needsUpdate,Ge=ae.type;je(),Ee.autoReset=me,ae.enabled=Le,ae.autoUpdate=ze,ae.needsUpdate=He,ae.type=Ge}function Pe(me){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",me.statusMessage)}function Ve(me){const Le=me.target;Le.removeEventListener("dispose",Ve),Qe(Le)}function Qe(me){at(me),Ie.remove(me)}function at(me){const Le=Ie.get(me).programs;Le!==void 0&&(Le.forEach(function(ze){Xe.releaseProgram(ze)}),me.isShaderMaterial&&Xe.releaseShaderCache(me))}this.renderBufferDirect=function(me,Le,ze,He,Ge,et){Le===null&&(Le=$e);const Je=Ge.isMesh&&Ge.matrixWorld.determinant()<0,st=Xt(me,Le,ze,He,Ge);ge.setMaterial(He,Je);let rt=ze.index,ut=1;if(He.wireframe===!0){if(rt=ke.getWireframeAttribute(ze),rt===void 0)return;ut=2}const At=ze.drawRange,vt=ze.attributes.position;let wt=At.start*ut,ft=(At.start+At.count)*ut;et!==null&&(wt=Math.max(wt,et.start*ut),ft=Math.min(ft,(et.start+et.count)*ut)),rt!==null?(wt=Math.max(wt,0),ft=Math.min(ft,rt.count)):vt!=null&&(wt=Math.max(wt,0),ft=Math.min(ft,vt.count));const St=ft-wt;if(St<0||St===1/0)return;Me.setup(Ge,He,st,ze,rt);let Pt,Ct=ne;if(rt!==null&&(Pt=re.get(rt),Ct=le,Ct.setIndex(Pt)),Ge.isMesh)He.wireframe===!0?(ge.setLineWidth(He.wireframeLinewidth*qe()),Ct.setMode(_e.LINES)):Ct.setMode(_e.TRIANGLES);else if(Ge.isLine){let lt=He.linewidth;lt===void 0&&(lt=1),ge.setLineWidth(lt*qe()),Ge.isLineSegments?Ct.setMode(_e.LINES):Ge.isLineLoop?Ct.setMode(_e.LINE_LOOP):Ct.setMode(_e.LINE_STRIP)}else Ge.isPoints?Ct.setMode(_e.POINTS):Ge.isSprite&&Ct.setMode(_e.TRIANGLES);if(Ge.isBatchedMesh)Ge._multiDrawInstances!==null?Ct.renderMultiDrawInstances(Ge._multiDrawStarts,Ge._multiDrawCounts,Ge._multiDrawCount,Ge._multiDrawInstances):Ct.renderMultiDraw(Ge._multiDrawStarts,Ge._multiDrawCounts,Ge._multiDrawCount);else if(Ge.isInstancedMesh)Ct.renderInstances(wt,St,Ge.count);else if(ze.isInstancedBufferGeometry){const lt=ze._maxInstanceCount!==void 0?ze._maxInstanceCount:1/0,Dt=Math.min(ze.instanceCount,lt);Ct.renderInstances(wt,St,Dt)}else Ct.render(wt,St);(ze.morphAttributes.position!==void 0||ze.morphAttributes.normal!==void 0)&&ee.store(Ge,ze)};function ht(me,Le,ze){me.transparent===!0&&me.side===DoubleSide&&me.forceSinglePass===!1?(me.side=BackSide,me.needsUpdate=!0,kt(me,Le,ze),me.side=FrontSide,me.needsUpdate=!0,kt(me,Le,ze),me.side=DoubleSide):kt(me,Le,ze)}this.compile=function(me,Le,ze=null){ze===null&&(ze=me),w=tt.get(ze),w.init(Le),M.push(w),ze.traverseVisible(function(Ge){Ge.isLight&&Ge.layers.test(Le.layers)&&(w.pushLight(Ge),Ge.castShadow&&w.pushShadow(Ge))}),me!==ze&&me.traverseVisible(function(Ge){Ge.isLight&&Ge.layers.test(Le.layers)&&(w.pushLight(Ge),Ge.castShadow&&w.pushShadow(Ge))}),w.setupLights();const He=new Set;return me.traverse(function(Ge){const et=Ge.material;if(et)if(Array.isArray(et))for(let Je=0;Je<et.length;Je++){const st=et[Je];ht(st,ze,Ge),He.add(st)}else ht(et,ze,Ge),He.add(et)}),M.pop(),w=null,He},this.compileAsync=function(me,Le,ze=null){const He=this.compile(me,Le,ze);return new Promise(Ge=>{function et(){if(He.forEach(function(Je){Ie.get(Je).currentProgram.isReady()&&He.delete(Je)}),He.size===0){Ge(me);return}setTimeout(et,10)}De.get("KHR_parallel_shader_compile")!==null?et():setTimeout(et,10)})};let xt=null;function Ze(me){xt&&xt(me)}function ot(){pt.stop()}function mt(){pt.start()}const pt=new WebGLAnimation;pt.setAnimationLoop(Ze),typeof self<"u"&&pt.setContext(self),this.setAnimationLoop=function(me){xt=me,fe.setAnimationLoop(me),me===null?pt.stop():pt.start()},fe.addEventListener("sessionstart",ot),fe.addEventListener("sessionend",mt),this.render=function(me,Le){if(Le!==void 0&&Le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(D===!0)return;if(me.matrixWorldAutoUpdate===!0&&me.updateMatrixWorld(),Le.parent===null&&Le.matrixWorldAutoUpdate===!0&&Le.updateMatrixWorld(),fe.enabled===!0&&fe.isPresenting===!0&&(fe.cameraAutoUpdate===!0&&fe.updateCamera(Le),Le=fe.getCamera()),me.isScene===!0&&me.onBeforeRender(S,me,Le,L),w=tt.get(me,M.length),w.init(Le),M.push(w),Re.multiplyMatrices(Le.projectionMatrix,Le.matrixWorldInverse),ve.setFromProjectionMatrix(Re),Se=this.localClippingEnabled,we=Ke.init(this.clippingPlanes,Se),v=it.get(me,y.length),v.init(),y.push(v),fe.enabled===!0&&fe.isPresenting===!0){const et=S.xr.getDepthSensingMesh();et!==null&&bt(et,Le,-1/0,S.sortObjects)}bt(me,Le,0,S.sortObjects),v.finish(),S.sortObjects===!0&&v.sort(W,te),Ue=fe.enabled===!1||fe.isPresenting===!1||fe.hasDepthSensing()===!1,Ue&&j.addToRenderList(v,me),this.info.render.frame++,we===!0&&Ke.beginShadows();const ze=w.state.shadowsArray;ae.render(ze,me,Le),we===!0&&Ke.endShadows(),this.info.autoReset===!0&&this.info.reset();const He=v.opaque,Ge=v.transmissive;if(w.setupLights(),Le.isArrayCamera){const et=Le.cameras;if(Ge.length>0)for(let Je=0,st=et.length;Je<st;Je++){const rt=et[Je];Mt(He,Ge,me,rt)}Ue&&j.render(me);for(let Je=0,st=et.length;Je<st;Je++){const rt=et[Je];_t(v,me,rt,rt.viewport)}}else Ge.length>0&&Mt(He,Ge,me,Le),Ue&&j.render(me),_t(v,me,Le);L!==null&&(Be.updateMultisampleRenderTarget(L),Be.updateRenderTargetMipmap(L)),me.isScene===!0&&me.onAfterRender(S,me,Le),Me.resetDefaultState(),P=-1,N=null,M.pop(),M.length>0?(w=M[M.length-1],we===!0&&Ke.setGlobalState(S.clippingPlanes,w.state.camera)):w=null,y.pop(),y.length>0?v=y[y.length-1]:v=null};function bt(me,Le,ze,He){if(me.visible===!1)return;if(me.layers.test(Le.layers)){if(me.isGroup)ze=me.renderOrder;else if(me.isLOD)me.autoUpdate===!0&&me.update(Le);else if(me.isLight)w.pushLight(me),me.castShadow&&w.pushShadow(me);else if(me.isSprite){if(!me.frustumCulled||ve.intersectsSprite(me)){He&&Fe.setFromMatrixPosition(me.matrixWorld).applyMatrix4(Re);const Je=We.update(me),st=me.material;st.visible&&v.push(me,Je,st,ze,Fe.z,null)}}else if((me.isMesh||me.isLine||me.isPoints)&&(!me.frustumCulled||ve.intersectsObject(me))){const Je=We.update(me),st=me.material;if(He&&(me.boundingSphere!==void 0?(me.boundingSphere===null&&me.computeBoundingSphere(),Fe.copy(me.boundingSphere.center)):(Je.boundingSphere===null&&Je.computeBoundingSphere(),Fe.copy(Je.boundingSphere.center)),Fe.applyMatrix4(me.matrixWorld).applyMatrix4(Re)),Array.isArray(st)){const rt=Je.groups;for(let ut=0,At=rt.length;ut<At;ut++){const vt=rt[ut],wt=st[vt.materialIndex];wt&&wt.visible&&v.push(me,Je,wt,ze,Fe.z,vt)}}else st.visible&&v.push(me,Je,st,ze,Fe.z,null)}}const et=me.children;for(let Je=0,st=et.length;Je<st;Je++)bt(et[Je],Le,ze,He)}function _t(me,Le,ze,He){const Ge=me.opaque,et=me.transmissive,Je=me.transparent;w.setupLightsView(ze),we===!0&&Ke.setGlobalState(S.clippingPlanes,ze),He&&ge.viewport(z.copy(He)),Ge.length>0&&Tt(Ge,Le,ze),et.length>0&&Tt(et,Le,ze),Je.length>0&&Tt(Je,Le,ze),ge.buffers.depth.setTest(!0),ge.buffers.depth.setMask(!0),ge.buffers.color.setMask(!0),ge.setPolygonOffset(!1)}function Mt(me,Le,ze,He){if((ze.isScene===!0?ze.overrideMaterial:null)!==null)return;w.state.transmissionRenderTarget[He.id]===void 0&&(w.state.transmissionRenderTarget[He.id]=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:De.has("EXT_color_buffer_half_float")||De.has("EXT_color_buffer_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:4,stencilBuffer:l,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ColorManagement.workingColorSpace}));const et=w.state.transmissionRenderTarget[He.id],Je=He.viewport||z;et.setSize(Je.z,Je.w);const st=S.getRenderTarget();S.setRenderTarget(et),S.getClearColor(V),H=S.getClearAlpha(),H<1&&S.setClearColor(16777215,.5),Ue?j.render(ze):S.clear();const rt=S.toneMapping;S.toneMapping=NoToneMapping;const ut=He.viewport;if(He.viewport!==void 0&&(He.viewport=void 0),w.setupLightsView(He),we===!0&&Ke.setGlobalState(S.clippingPlanes,He),Tt(me,ze,He),Be.updateMultisampleRenderTarget(et),Be.updateRenderTargetMipmap(et),De.has("WEBGL_multisampled_render_to_texture")===!1){let At=!1;for(let vt=0,wt=Le.length;vt<wt;vt++){const ft=Le[vt],St=ft.object,Pt=ft.geometry,Ct=ft.material,lt=ft.group;if(Ct.side===DoubleSide&&St.layers.test(He.layers)){const Dt=Ct.side;Ct.side=BackSide,Ct.needsUpdate=!0,Bt(St,ze,He,Pt,Ct,lt),Ct.side=Dt,Ct.needsUpdate=!0,At=!0}}At===!0&&(Be.updateMultisampleRenderTarget(et),Be.updateRenderTargetMipmap(et))}S.setRenderTarget(st),S.setClearColor(V,H),ut!==void 0&&(He.viewport=ut),S.toneMapping=rt}function Tt(me,Le,ze){const He=Le.isScene===!0?Le.overrideMaterial:null;for(let Ge=0,et=me.length;Ge<et;Ge++){const Je=me[Ge],st=Je.object,rt=Je.geometry,ut=He===null?Je.material:He,At=Je.group;st.layers.test(ze.layers)&&Bt(st,Le,ze,rt,ut,At)}}function Bt(me,Le,ze,He,Ge,et){me.onBeforeRender(S,Le,ze,He,Ge,et),me.modelViewMatrix.multiplyMatrices(ze.matrixWorldInverse,me.matrixWorld),me.normalMatrix.getNormalMatrix(me.modelViewMatrix);const Je=Ge.onBeforeRender(S,Le,ze,He,me,et);(Je==null||Je==!0)&&(Ge.transparent===!0&&Ge.side===DoubleSide&&Ge.forceSinglePass===!1?(Ge.side=BackSide,Ge.needsUpdate=!0,S.renderBufferDirect(ze,Le,He,Ge,me,et),Ge.side=FrontSide,Ge.needsUpdate=!0,S.renderBufferDirect(ze,Le,He,Ge,me,et),Ge.side=DoubleSide):S.renderBufferDirect(ze,Le,He,Ge,me,et)),Ge.onAfterRender?.(S,Le,ze,He,me,et),me.onAfterRender(S,Le,ze,He,Ge,et)}function kt(me,Le,ze){const He=performance.now();Le.isScene!==!0&&(Le=$e);const Ge=Ie.get(me),et=tt.get(Le),Je=et.state.lights,st=et.state.shadowsArray,rt=Je.state.version,ut=Xe.getParameters(me,Je.state,st,Le,ze),At=Xe.getProgramCacheKey(ut);let vt=Ge.programs;Ge.environment=me.isMeshStandardMaterial?Le.environment:null,Ge.fog=Le.fog,Ge.envMap=(me.isMeshStandardMaterial?ue:Oe).get(me.envMap||Ge.environment),Ge.envMapRotation=Ge.environment!==null&&me.envMap===null?Le.environmentRotation:me.envMapRotation,vt===void 0&&(me.addEventListener("dispose",Ve),vt=new Map,Ge.programs=vt);let wt=vt.get(At);if(wt!==void 0){if(Ge.currentProgram===wt&&Ge.lightsStateVersion===rt)return Wt(me,ut),wt}else ut.uniforms=Xe.getUniforms(me),me.onBuild(ze,ut,S),me.onBeforeCompile(ut,S),wt=Xe.acquireProgram(ut,At),vt.set(At,wt),Ge.uniforms=ut.uniforms;const ft=Ge.uniforms;if((!me.isShaderMaterial&&!me.isRawShaderMaterial||me.clipping===!0)&&(ft.clippingPlanes=Ke.uniform),Wt(me,ut),Ge.needsLights=Kt(me),Ge.lightsStateVersion=rt,Ge.needsLights&&(ft.ambientLightColor.value=Je.state.ambient,ft.lightProbe.value=Je.state.probe,ft.directionalLights.value=Je.state.directional,ft.directionalLightShadows.value=Je.state.directionalShadow,ft.spotLights.value=Je.state.spot,ft.spotLightShadows.value=Je.state.spotShadow,ft.rectAreaLights.value=Je.state.rectArea,ft.ltc_1.value=Je.state.rectAreaLTC1,ft.ltc_2.value=Je.state.rectAreaLTC2,ft.pointLights.value=Je.state.point,ft.pointLightShadows.value=Je.state.pointShadow,ft.hemisphereLights.value=Je.state.hemi,ft.directionalShadowMap.value=Je.state.directionalShadowMap,ft.directionalShadowMatrix.value=Je.state.directionalShadowMatrix,ft.spotShadowMap.value=Je.state.spotShadowMap,ft.spotLightMatrix.value=Je.state.spotLightMatrix,ft.spotLightMap.value=Je.state.spotLightMap,ft.pointShadowMap.value=Je.state.pointShadowMap,ft.pointShadowMatrix.value=Je.state.pointShadowMatrix),window.debug&&window.debug_performance){const St=wt.getUniforms(),Pt=WebGLUniforms.seqWithValue(St.seq,ft);performance.now()-He>10&&console.log(`getUniforms@"${me.name}"-${me.constructor.name}`,Math.floor(performance.now()-He),"ms"),Ge.currentProgram=wt,Ge.uniformsList=Pt}else Ge.currentProgram=wt,Ge.uniformsList=null;return wt}function Lt(me){if(me.uniformsList===null){const Le=me.currentProgram.getUniforms();me.uniformsList=WebGLUniforms.seqWithValue(Le.seq,me.uniforms)}return me.uniformsList}function Wt(me,Le){const ze=Ie.get(me);ze.outputColorSpace=Le.outputColorSpace,ze.batching=Le.batching,ze.batchingColor=Le.batchingColor,ze.instancing=Le.instancing,ze.instancingColor=Le.instancingColor,ze.instancingMorph=Le.instancingMorph,ze.skinning=Le.skinning,ze.morphTargets=Le.morphTargets,ze.morphNormals=Le.morphNormals,ze.morphColors=Le.morphColors,ze.morphTargetsCount=Le.morphTargetsCount,ze.numClippingPlanes=Le.numClippingPlanes,ze.numIntersection=Le.numClipIntersection,ze.vertexAlphas=Le.vertexAlphas,ze.vertexTangents=Le.vertexTangents,ze.toneMapping=Le.toneMapping}function Xt(me,Le,ze,He,Ge){Le.isScene!==!0&&(Le=$e),Be.resetTextureUnits();const et=Le.fog,Je=He.isMeshStandardMaterial?Le.environment:null,st=L===null?S.outputColorSpace:L.isXRRenderTarget===!0?L.texture.colorSpace:LinearSRGBColorSpace,rt=(He.isMeshStandardMaterial?ue:Oe).get(He.envMap||Je),ut=He.vertexColors===!0&&!!ze.attributes.color&&ze.attributes.color.itemSize===4,At=!!ze.attributes.tangent&&(!!He.normalMap||He.anisotropy>0),vt=!!ze.morphAttributes.position,wt=!!ze.morphAttributes.normal,ft=!!ze.morphAttributes.color;let St=NoToneMapping;He.toneMapped&&(L===null||L.isXRRenderTarget===!0)&&(St=S.toneMapping);const Pt=ze.morphAttributes.position||ze.morphAttributes.normal||ze.morphAttributes.color,Ct=Pt!==void 0?Pt.length:0,lt=Ie.get(He),Dt=tt.get(Le),Vt=Dt.state.lights;if(we===!0&&(Se===!0||me!==N)){const Rt=me===N&&He.id===P;Ke.setState(He,me,Rt)}let Et=!1;He.version===lt.__version?(lt.needsLights&&lt.lightsStateVersion!==Vt.state.version||lt.outputColorSpace!==st||Ge.isBatchedMesh&&lt.batching===!1||!Ge.isBatchedMesh&&lt.batching===!0||Ge.isBatchedMesh&&lt.batchingColor===!0&&Ge.colorTexture===null||Ge.isBatchedMesh&&lt.batchingColor===!1&&Ge.colorTexture!==null||Ge.isInstancedMesh&&lt.instancing===!1||!Ge.isInstancedMesh&&lt.instancing===!0||Ge.isSkinnedMesh&&lt.skinning===!1||!Ge.isSkinnedMesh&&lt.skinning===!0||Ge.isInstancedMesh&&lt.instancingColor===!0&&Ge.instanceColor===null||Ge.isInstancedMesh&&lt.instancingColor===!1&&Ge.instanceColor!==null||Ge.isInstancedMesh&&lt.instancingMorph===!0&&Ge.morphTexture===null||Ge.isInstancedMesh&&lt.instancingMorph===!1&&Ge.morphTexture!==null||lt.envMap!==rt||He.fog===!0&&lt.fog!==et||lt.numClippingPlanes!==void 0&&(lt.numClippingPlanes!==Ke.numPlanes||lt.numIntersection!==Ke.numIntersection)||lt.vertexAlphas!==ut||lt.vertexTangents!==At||lt.morphTargets!==vt||lt.morphNormals!==wt||lt.morphColors!==ft||lt.toneMapping!==St||lt.morphTargetsCount!==Ct)&&(Et=!0):(Et=!0,lt.__version=He.version);let Ut=lt.currentProgram;Et===!0&&(Ut=kt(He,Le,Ge));let zt=!1,Gt=!1,Ht=!1;const It=Ut.getUniforms(),Nt=lt.uniforms;if(ge.useProgram(Ut.program)&&(zt=!0,Gt=!0,Ht=!0),He.id!==P&&(P=He.id,Gt=!0),zt||N!==me){It.setValue(_e,"projectionMatrix",me.projectionMatrix),It.setValue(_e,"viewMatrix",me.matrixWorldInverse);const Rt=It.map.cameraPosition;Rt!==void 0&&Rt.setValue(_e,Fe.setFromMatrixPosition(me.matrixWorld)),Te.logarithmicDepthBuffer&&It.setValue(_e,"logDepthBufFC",2/(Math.log(me.far+1)/Math.LN2)),(He.isMeshPhongMaterial||He.isMeshToonMaterial||He.isMeshLambertMaterial||He.isMeshBasicMaterial||He.isMeshStandardMaterial||He.isShaderMaterial)&&It.setValue(_e,"isOrthographic",me.isOrthographicCamera===!0),N!==me&&(N=me,Gt=!0,Ht=!0)}if(Ge.isSkinnedMesh){It.setOptional(_e,Ge,"bindMatrix"),It.setOptional(_e,Ge,"bindMatrixInverse");const Rt=Ge.skeleton;Rt&&(Rt.boneTexture===null&&Rt.computeBoneTexture(),It.setValue(_e,"boneTexture",Rt.boneTexture,Be))}Ge.isBatchedMesh&&(It.setOptional(_e,Ge,"batchingTexture"),It.setValue(_e,"batchingTexture",Ge._matricesTexture,Be),It.setOptional(_e,Ge,"batchingColorTexture"),Ge._colorsTexture!==null&&It.setValue(_e,"batchingColorTexture",Ge._colorsTexture,Be));const Qt=ze.morphAttributes;if((Qt.position!==void 0||Qt.normal!==void 0||Qt.color!==void 0)&&ee.update(Ge,ze,He,Ut),(Gt||lt.receiveShadow!==Ge.receiveShadow)&&(lt.receiveShadow=Ge.receiveShadow,It.setValue(_e,"receiveShadow",Ge.receiveShadow)),He.isMeshGouraudMaterial&&He.envMap!==null&&(Nt.envMap.value=rt,Nt.flipEnvMap.value=rt.isCubeTexture&&rt.isRenderTargetTexture===!1?-1:1),He.isMeshStandardMaterial&&He.envMap===null&&Le.environment!==null&&(Nt.envMapIntensity.value=Le.environmentIntensity),Gt&&(It.setValue(_e,"toneMappingExposure",S.toneMappingExposure),lt.needsLights&&Yt(Nt,Ht),et&&He.fog===!0&&Ye.refreshFogUniforms(Nt,et),Ye.refreshMaterialUniforms(Nt,He,J,q,Dt.state.transmissionRenderTarget[me.id]),WebGLUniforms.upload(_e,Lt(lt),Nt,Be)),He.isShaderMaterial&&He.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(_e,Lt(lt),Nt,Be),He.uniformsNeedUpdate=!1),He.isSpriteMaterial&&It.setValue(_e,"center",Ge.center),It.setValue(_e,"modelViewMatrix",Ge.modelViewMatrix),It.setValue(_e,"normalMatrix",Ge.normalMatrix),It.setValue(_e,"modelMatrix",Ge.matrixWorld),He.isShaderMaterial||He.isRawShaderMaterial){const Rt=He.uniformsGroups;for(let jt=0,Jt=Rt.length;jt<Jt;jt++){const qt=Rt[jt];Ne.update(qt,Ut),Ne.bind(qt,Ut)}}return Ut}function Yt(me,Le){me.ambientLightColor.needsUpdate=Le,me.lightProbe.needsUpdate=Le,me.directionalLights.needsUpdate=Le,me.directionalLightShadows.needsUpdate=Le,me.pointLights.needsUpdate=Le,me.pointLightShadows.needsUpdate=Le,me.spotLights.needsUpdate=Le,me.spotLightShadows.needsUpdate=Le,me.rectAreaLights.needsUpdate=Le,me.hemisphereLights.needsUpdate=Le}function Kt(me){return me.isMeshLambertMaterial||me.isMeshToonMaterial||me.isMeshPhongMaterial||me.isMeshStandardMaterial||me.isShadowMaterial||me.isShaderMaterial&&me.lights===!0}this.getActiveCubeFace=function(){return k},this.getActiveMipmapLevel=function(){return O},this.getRenderTarget=function(){return L},this.setRenderTargetTextures=function(me,Le,ze){Ie.get(me.texture).__webglTexture=Le,Ie.get(me.depthTexture).__webglTexture=ze;const He=Ie.get(me);He.__hasExternalTextures=!0,He.__autoAllocateDepthBuffer=ze===void 0,He.__autoAllocateDepthBuffer||De.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),He.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(me,Le){const ze=Ie.get(me);ze.__webglFramebuffer=Le,ze.__useDefaultFramebuffer=Le===void 0},this.setRenderTarget=function(me,Le=0,ze=0){L=me,k=Le,O=ze;let He=!0,Ge=null,et=!1,Je=!1;if(me){const rt=Ie.get(me);rt.__useDefaultFramebuffer!==void 0?(ge.bindFramebuffer(_e.FRAMEBUFFER,null),He=!1):rt.__webglFramebuffer===void 0?Be.setupRenderTarget(me):rt.__hasExternalTextures&&Be.rebindTextures(me,Ie.get(me.texture).__webglTexture,Ie.get(me.depthTexture).__webglTexture);const ut=me.texture;(ut.isData3DTexture||ut.isDataArrayTexture||ut.isCompressedArrayTexture)&&(Je=!0);const At=Ie.get(me).__webglFramebuffer;me.isWebGLCubeRenderTarget?(Array.isArray(At[Le])?Ge=At[Le][ze]:Ge=At[Le],et=!0):me.samples>0&&Be.useMultisampledRTT(me)===!1?Ge=Ie.get(me).__webglMultisampledFramebuffer:Array.isArray(At)?Ge=At[ze]:Ge=At,z.copy(me.viewport),K.copy(me.scissor),Z=me.scissorTest}else z.copy(ie).multiplyScalar(J).floor(),K.copy(oe).multiplyScalar(J).floor(),Z=Ce;if(ge.bindFramebuffer(_e.FRAMEBUFFER,Ge)&&He&&ge.drawBuffers(me,Ge),ge.viewport(z),ge.scissor(K),ge.setScissorTest(Z),et){const rt=Ie.get(me.texture);_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+Le,rt.__webglTexture,ze)}else if(Je){const rt=Ie.get(me.texture),ut=Le||0;_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,rt.__webglTexture,ze||0,ut)}P=-1},this.readRenderTargetPixels=function(me,Le,ze,He,Ge,et,Je){if(!(me&&me.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let st=Ie.get(me).__webglFramebuffer;if(me.isWebGLCubeRenderTarget&&Je!==void 0&&(st=st[Je]),st){ge.bindFramebuffer(_e.FRAMEBUFFER,st);try{const rt=me.texture,ut=rt.format,At=rt.type;if(!Te.textureFormatReadable(ut)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Te.textureTypeReadable(At)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Le>=0&&Le<=me.width-He&&ze>=0&&ze<=me.height-Ge&&_e.readPixels(Le,ze,He,Ge,he.convert(ut),he.convert(At),et)}finally{const rt=L!==null?Ie.get(L).__webglFramebuffer:null;ge.bindFramebuffer(_e.FRAMEBUFFER,rt)}}},this.readRenderTargetPixelsAsync=async function(me,Le,ze,He,Ge,et,Je){if(!(me&&me.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let st=Ie.get(me).__webglFramebuffer;if(me.isWebGLCubeRenderTarget&&Je!==void 0&&(st=st[Je]),st){ge.bindFramebuffer(_e.FRAMEBUFFER,st);try{const rt=me.texture,ut=rt.format,At=rt.type;if(!Te.textureFormatReadable(ut))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Te.textureTypeReadable(At))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Le>=0&&Le<=me.width-He&&ze>=0&&ze<=me.height-Ge){const vt=_e.createBuffer();_e.bindBuffer(_e.PIXEL_PACK_BUFFER,vt),_e.bufferData(_e.PIXEL_PACK_BUFFER,et.byteLength,_e.STREAM_READ),_e.readPixels(Le,ze,He,Ge,he.convert(ut),he.convert(At),0),_e.flush();const wt=_e.fenceSync(_e.SYNC_GPU_COMMANDS_COMPLETE,0);await probeAsync(_e,wt,4);try{_e.bindBuffer(_e.PIXEL_PACK_BUFFER,vt),_e.getBufferSubData(_e.PIXEL_PACK_BUFFER,0,et)}finally{_e.deleteBuffer(vt),_e.deleteSync(wt)}return et}}finally{const rt=L!==null?Ie.get(L).__webglFramebuffer:null;ge.bindFramebuffer(_e.FRAMEBUFFER,rt)}}},this.copyFramebufferToTexture=function(me,Le=null,ze=0){me.isTexture!==!0&&(console.warn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Le=arguments[0]||null,me=arguments[1]);const He=Math.pow(2,-ze),Ge=Math.floor(me.image.width*He),et=Math.floor(me.image.height*He),Je=Le!==null?Le.x:0,st=Le!==null?Le.y:0;Be.setTexture2D(me,0),_e.copyTexSubImage2D(_e.TEXTURE_2D,ze,0,0,Je,st,Ge,et),ge.unbindTexture()},this.copyTextureToTexture=function(me,Le,ze=null,He=null,Ge=0){me.isTexture!==!0&&(console.warn("WebGLRenderer: copyTextureToTexture function signature has changed."),He=arguments[0]||null,me=arguments[1],Le=arguments[2],Ge=arguments[3]||0,ze=null);let et,Je,st,rt,ut,At;ze!==null?(et=ze.max.x-ze.min.x,Je=ze.max.y-ze.min.y,st=ze.min.x,rt=ze.min.y):(et=me.image.width,Je=me.image.height,st=0,rt=0),He!==null?(ut=He.x,At=He.y):(ut=0,At=0);const vt=he.convert(Le.format),wt=he.convert(Le.type);Be.setTexture2D(Le,0),_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,Le.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Le.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,Le.unpackAlignment);const ft=_e.getParameter(_e.UNPACK_ROW_LENGTH),St=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),Pt=_e.getParameter(_e.UNPACK_SKIP_PIXELS),Ct=_e.getParameter(_e.UNPACK_SKIP_ROWS),lt=_e.getParameter(_e.UNPACK_SKIP_IMAGES),Dt=me.isCompressedTexture?me.mipmaps[Ge]:me.image;_e.pixelStorei(_e.UNPACK_ROW_LENGTH,Dt.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,Dt.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,st),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,rt),me.isDataTexture?_e.texSubImage2D(_e.TEXTURE_2D,Ge,ut,At,et,Je,vt,wt,Dt.data):me.isCompressedTexture?_e.compressedTexSubImage2D(_e.TEXTURE_2D,Ge,ut,At,Dt.width,Dt.height,vt,Dt.data):_e.texSubImage2D(_e.TEXTURE_2D,Ge,ut,At,vt,wt,Dt),_e.pixelStorei(_e.UNPACK_ROW_LENGTH,ft),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,St),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,Pt),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,Ct),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,lt),Ge===0&&Le.generateMipmaps&&_e.generateMipmap(_e.TEXTURE_2D),ge.unbindTexture()},this.copyTextureToTexture3D=function(me,Le,ze=null,He=null,Ge=0){me.isTexture!==!0&&(console.warn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),ze=arguments[0]||null,He=arguments[1]||null,me=arguments[2],Le=arguments[3],Ge=arguments[4]||0);let et,Je,st,rt,ut,At,vt,wt,ft;const St=me.isCompressedTexture?me.mipmaps[Ge]:me.image;ze!==null?(et=ze.max.x-ze.min.x,Je=ze.max.y-ze.min.y,st=ze.max.z-ze.min.z,rt=ze.min.x,ut=ze.min.y,At=ze.min.z):(et=St.width,Je=St.height,st=St.depth,rt=0,ut=0,At=0),He!==null?(vt=He.x,wt=He.y,ft=He.z):(vt=0,wt=0,ft=0);const Pt=he.convert(Le.format),Ct=he.convert(Le.type);let lt;if(Le.isData3DTexture)Be.setTexture3D(Le,0),lt=_e.TEXTURE_3D;else if(Le.isDataArrayTexture||Le.isCompressedArrayTexture)Be.setTexture2DArray(Le,0),lt=_e.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,Le.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Le.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,Le.unpackAlignment);const Dt=_e.getParameter(_e.UNPACK_ROW_LENGTH),Vt=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),Et=_e.getParameter(_e.UNPACK_SKIP_PIXELS),Ut=_e.getParameter(_e.UNPACK_SKIP_ROWS),zt=_e.getParameter(_e.UNPACK_SKIP_IMAGES);_e.pixelStorei(_e.UNPACK_ROW_LENGTH,St.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,St.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,rt),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,ut),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,At),me.isDataTexture||me.isData3DTexture?_e.texSubImage3D(lt,Ge,vt,wt,ft,et,Je,st,Pt,Ct,St.data):Le.isCompressedArrayTexture?_e.compressedTexSubImage3D(lt,Ge,vt,wt,ft,et,Je,st,Pt,St.data):_e.texSubImage3D(lt,Ge,vt,wt,ft,et,Je,st,Pt,Ct,St),_e.pixelStorei(_e.UNPACK_ROW_LENGTH,Dt),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,Vt),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,Et),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,Ut),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,zt),Ge===0&&Le.generateMipmaps&&_e.generateMipmap(lt),ge.unbindTexture()},this.initRenderTarget=function(me){Ie.get(me).__webglFramebuffer===void 0&&Be.setupRenderTarget(me)},this.initTexture=function(me){me.isCubeTexture?Be.setTextureCube(me,0):me.isData3DTexture?Be.setTexture3D(me,0):me.isDataArrayTexture||me.isCompressedArrayTexture?Be.setTexture2DArray(me,0):Be.setTexture2D(me,0),ge.unbindTexture()},this.resetState=function(){k=0,O=0,L=null,ge.reset(),Me.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorSpace=e===DisplayP3ColorSpace?"display-p3":"srgb",i.unpackColorSpace=ColorManagement.workingColorSpace===LinearDisplayP3ColorSpace?"display-p3":"srgb"}}class FogExp2{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(e),this.density=i}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fog{constructor(e,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new Color(e),this.near=i,this.far=r}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,this.isXRMode=!1,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class InterleavedBuffer{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=StaticDrawUsage,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return warnOnce("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,r){e*=this.stride,r*=i.stride;for(let o=0,l=this.stride;o<l;o++)this.array[e+o]=i.array[r+o];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$8=new Vector3;class InterleavedBufferAttribute{constructor(e,i,r,o=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=r,this.normalized=o}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,r=this.data.count;i<r;i++)_vector$8.fromBufferAttribute(this,i),_vector$8.applyMatrix4(e),this.setXYZ(i,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)_vector$8.fromBufferAttribute(this,i),_vector$8.applyNormalMatrix(e),this.setXYZ(i,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)_vector$8.fromBufferAttribute(this,i),_vector$8.transformDirection(e),this.setXYZ(i,_vector$8.x,_vector$8.y,_vector$8.z);return this}getComponent(e,i){let r=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(r=denormalize(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=normalize(r,this.array)),this.data.array[e*this.data.stride+this.offset+i]=r,this}setX(e,i){return this.normalized&&(i=normalize(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=normalize(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=normalize(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=normalize(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=denormalize(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=denormalize(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=denormalize(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=denormalize(i,this.array)),i}setXY(e,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this}setXYZ(e,i,r,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array),o=normalize(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=o,this}setXYZW(e,i,r,o,l){return e=e*this.data.stride+this.offset,this.normalized&&(i=normalize(i,this.array),r=normalize(r,this.array),o=normalize(o,this.array),l=normalize(l,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=o,this.data.array[e+3]=l,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const o=r*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)i.push(this.data.array[o+l])}return new BufferAttribute(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const o=r*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)i.push(this.data.array[o+l])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let _geometry$2;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2;class Sprite extends Object3D{constructor(e=new SpriteMaterial){if(super(),this.isSprite=!0,this.type="Sprite",_geometry$2===void 0){_geometry$2=new BufferGeometry;const i=new Float32Array([-.5,-.5,0,0,0,1,0,0,.5,-.5,0,0,0,1,1,0,.5,.5,0,0,0,1,1,1,-.5,.5,0,0,0,1,0,1]),r=new InterleavedBuffer(i,8);_geometry$2.setIndex([0,1,2,0,2,3]),_geometry$2.setAttribute("position",new InterleavedBufferAttribute(r,3,0,!1)),_geometry$2.setAttribute("normal",new InterleavedBufferAttribute(r,3,3,!1)),_geometry$2.setAttribute("uv",new InterleavedBufferAttribute(r,2,6,!1))}this.geometry=_geometry$2,this.material=e,this.center=new Vector2(.5,.5)}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const r=this.material.rotation;let o,l;r!==0&&(l=Math.cos(r),o=Math.sin(r));const a=this.center;transformVertex(_vA$1.set(-.5,-.5,0),_mvPosition,a,_worldScale,o,l),transformVertex(_vB$1.set(.5,-.5,0),_mvPosition,a,_worldScale,o,l),transformVertex(_vC$1.set(.5,.5,0),_mvPosition,a,_worldScale,o,l),_uvA$1.set(0,0),_uvB$1.set(1,0),_uvC$1.set(1,1);let c=e.ray.intersectTriangle(_vA$1,_vB$1,_vC$1,!1,_intersectPoint);if(c===null&&(transformVertex(_vB$1.set(-.5,.5,0),_mvPosition,a,_worldScale,o,l),_uvB$1.set(0,1),c=e.ray.intersectTriangle(_vA$1,_vC$1,_vB$1,!1,_intersectPoint),c===null))return;const d=e.ray.origin.distanceTo(_intersectPoint);d<e.near||d>e.far||i.push({distance:d,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function transformVertex(s,e,i,r,o,l){_alignedPosition.subVectors(s,i).addScalar(.5).multiply(r),o!==void 0?(_rotatedPosition.x=l*_alignedPosition.x-o*_alignedPosition.y,_rotatedPosition.y=o*_alignedPosition.x+l*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),s.copy(e),s.x+=_rotatedPosition.x,s.y+=_rotatedPosition.y,s.applyMatrix4(_viewWorldMatrix)}const _v1$3=new Vector3,_v2$2=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const i=e.levels;for(let r=0,o=i.length;r<o;r++){const l=i[r];this.addLevel(l.object.clone(),l.distance,l.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,i=0,r=0){i=Math.abs(i);const o=this.levels;let l;for(l=0;l<o.length&&!(i<o[l].distance);l++);return o.splice(l,0,{distance:i,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const i=this.levels;if(i.length>0){let r,o;for(r=1,o=i.length;r<o;r++){let l=i[r].distance;if(i[r].object.visible&&(l-=l*i[r].hysteresis),e<l)break}return i[r-1].object}return null}raycast(e,i){if(this.levels.length>0){_v1$3.setFromMatrixPosition(this.matrixWorld);const o=e.ray.origin.distanceTo(_v1$3);this.getObjectForDistance(o).raycast(e,i)}}update(e){const i=this.levels;if(i.length>1){_v1$3.setFromMatrixPosition(e.matrixWorld),_v2$2.setFromMatrixPosition(this.matrixWorld);const r=_v1$3.distanceTo(_v2$2)/e.zoom;i[0].object.visible=!0;let o,l;for(o=1,l=i.length;o<l;o++){let a=i[o].distance;if(i[o].object.visible&&(a-=a*i[o].hysteresis),r>=a)i[o-1].object.visible=!1,i[o].object.visible=!0;else break}for(this._currentLevel=o-1;o<l;o++)i[o].object.visible=!1}}toJSON(e){const i=super.toJSON(e);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let o=0,l=r.length;o<l;o++){const a=r[o];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const _basePosition=new Vector3,_skinIndex$1=new Vector4,_skinWeight$1=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$4=new Sphere,_inverseMatrix$2=new Matrix4,_ray$3=new Ray;class SkinnedMesh extends Mesh{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const r=this.material,o=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(o),e.ray.intersectsSphere(_sphere$4)!==!1&&(_inverseMatrix$2.copy(o).invert(),_ray$3.copy(e.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$3.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,_ray$3)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Vector4,i=this.geometry.attributes.skinWeight;for(let r=0,o=i.count;r<o;r++){e.fromBufferAttribute(i,r);const l=1/e.manhattanLength();l!==1/0?e.multiplyScalar(l):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const r=this.skeleton,o=this.geometry;_skinIndex$1.fromBufferAttribute(o.attributes.skinIndex,e),_skinWeight$1.fromBufferAttribute(o.attributes.skinWeight,e),_basePosition.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let l=0;l<4;l++){const a=_skinWeight$1.getComponent(l);if(a!==0){const c=_skinIndex$1.getComponent(l);_matrix4.multiplyMatrices(r.bones[c].matrixWorld,r.boneInverses[c]),i.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(e=null,i=1,r=1,o,l,a,c,d,u=NearestFilter,f=NearestFilter,m,h){super(null,a,c,d,u,f,o,l,m,h),this.isDataTexture=!0,this.image={data:e,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix$1=new Matrix4;class Skeleton{constructor(e=[],i=[]){this.uuid=generateUUID(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const r=new Matrix4;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,i=this.boneInverses,r=this.boneMatrices,o=this.boneTexture;for(let l=0,a=e.length;l<a;l++){const c=e[l]?e[l].matrixWorld:_identityMatrix$1;_offsetMatrix.multiplyMatrices(c,i[l]),r.set(_offsetMatrix.elements,l*16)}o!==null&&(o.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const r=new DataTexture(i,e,e,RGBAFormat,FloatType);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(e){for(let i=0,r=this.bones.length;i<r;i++){const o=this.bones[i];if(o.name===e)return o}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let r=0,o=e.bones.length;r<o;r++){const l=e.bones[r];let a=i[l];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",l),a=new Bone),this.bones.push(a),this.boneInverses.push(new Matrix4().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let o=0,l=i.length;o<l;o++){const a=i[o];e.bones.push(a.uuid);const c=r[o];e.boneInverses.push(c.toArray())}return e}}class InstancedBufferAttribute extends BufferAttribute{constructor(e,i,r,o=1){super(e,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=o}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$3=new Sphere;class InstancedMesh extends Mesh{constructor(e,i,r){super(e,i),this.isInstancedMesh=!0;const o=new Float32Array(r*16),l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let a=0;a<r*16;a+=16)for(let c=0;c<16;++c)o[a+c]=l[c];this.instanceMatrix=new InstancedBufferAttribute(o,16),this.max_count=r,this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let a=0;a<r;a++)this.setMatrixAt(a,_identity)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,_instanceLocalMatrix),_box3.copy(e.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,_instanceLocalMatrix),_sphere$3.copy(e.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$3)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const r=i.morphTargetInfluences,o=this.morphTexture.source.data.data,l=r.length+1,a=e*l+1;for(let c=0;c<r.length;c++)r[c]=o[a+c]}raycast(e,i){const r=this.matrixWorld,o=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,_mesh$1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$3.copy(this.boundingSphere),_sphere$3.applyMatrix4(r),e.ray.intersectsSphere(_sphere$3)!==!1))for(let l=0;l<o;l++){this.getMatrixAt(l,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(r,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(e,_instanceIntersects);for(let a=0,c=_instanceIntersects.length;a<c;a++){const d=_instanceIntersects[a];d.instanceId=l,d.object=this,i.push(d)}_instanceIntersects.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const r=i.morphTargetInfluences,o=r.length+1;this.morphTexture===null&&(this.morphTexture=new DataTexture(new Float32Array(o*this.count),o,this.count,RedFormat,FloatType));const l=this.morphTexture.source.data.data;let a=0;for(let u=0;u<r.length;u++)a+=r[u];const c=this.geometry.morphTargetsRelative?1:1-a,d=o*e;l[d]=c,l.set(r,d+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function sortOpaque(s,e){return s.z-e.z}function sortTransparent(s,e){return e.z-s.z}class MultiDrawRenderList{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i){const r=this.pool,o=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const l=r[this.index];o.push(l),this.index++,l.start=e.start,l.count=e.count,l.z=i}reset(){this.list.length=0,this.index=0}}const ID_ATTR_NAME="batchId",_matrix$3=new Matrix4,_invMatrixWorld=new Matrix4,_identityMatrix=new Matrix4,_whiteColor=new Color(1,1,1),_projScreenMatrix$2=new Matrix4,_frustum=new Frustum,_box$1=new Box3,_sphere$2=new Sphere,_vector$7=new Vector3,_forward=new Vector3,_temp$1=new Vector3,_renderList=new MultiDrawRenderList,_mesh=new Mesh,_batchIntersects=[];function copyAttributeData(s,e,i=0){const r=e.itemSize;if(s.isInterleavedBufferAttribute||s.array.constructor!==e.array.constructor){const o=s.count;for(let l=0;l<o;l++)for(let a=0;a<r;a++)e.setComponent(l+i,a,s.getComponent(l,a))}else e.array.set(s.array,i*r);e.needsUpdate=!0}class BatchedMesh extends Mesh{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,i,r=i*2,o){super(new BufferGeometry,o),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=i,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture(),this._colorsTexture=null}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),r=new DataTexture(i,e,e,RGBAFormat,FloatType);this._matricesTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxGeometryCount);e=Math.ceil(e);const i=new Float32Array(e*e*4).fill(1),r=new DataTexture(i,e,e,RGBAFormat,FloatType);r.colorSpace=ColorManagement.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const i=this.geometry,r=this._maxVertexCount,o=this._maxGeometryCount,l=this._maxIndexCount;if(this._geometryInitialized===!1){for(const c in e.attributes){const d=e.getAttribute(c),{array:u,itemSize:f,normalized:m}=d,h=new u.constructor(r*f),_=new BufferAttribute(h,f,m);i.setAttribute(c,_)}if(e.getIndex()!==null){const c=r>65536?new Uint32Array(l):new Uint16Array(l);i.setIndex(new BufferAttribute(c,1))}const a=o>65536?new Uint32Array(r):new Uint16Array(r);i.setAttribute(ID_ATTR_NAME,new BufferAttribute(a,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(ID_ATTR_NAME))throw new Error(`BatchedMesh: Geometry cannot use attribute "${ID_ATTR_NAME}"`);const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in i.attributes){if(r===ID_ATTR_NAME)continue;if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const o=e.getAttribute(r),l=i.getAttribute(r);if(o.itemSize!==l.itemSize||o.normalized!==l.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const e=this._geometryCount,i=this.boundingBox,r=this._active;i.makeEmpty();for(let o=0;o<e;o++)r[o]!==!1&&(this.getMatrixAt(o,_matrix$3),this.getBoundingBoxAt(o,_box$1).applyMatrix4(_matrix$3),i.union(_box$1))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const e=this._geometryCount,i=this.boundingSphere,r=this._active;i.makeEmpty();for(let o=0;o<e;o++)r[o]!==!1&&(this.getMatrixAt(o,_matrix$3),this.getBoundingSphereAt(o,_sphere$2).applyMatrix4(_matrix$3),i.union(_sphere$2))}addGeometry(e,i=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const o={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let l=null;const a=this._reservedRanges,c=this._drawRanges,d=this._bounds;this._geometryCount!==0&&(l=a[a.length-1]),i===-1?o.vertexCount=e.getAttribute("position").count:o.vertexCount=i,l===null?o.vertexStart=0:o.vertexStart=l.vertexStart+l.vertexCount;const u=e.getIndex(),f=u!==null;if(f&&(r===-1?o.indexCount=u.count:o.indexCount=r,l===null?o.indexStart=0:o.indexStart=l.indexStart+l.indexCount),o.indexStart!==-1&&o.indexStart+o.indexCount>this._maxIndexCount||o.vertexStart+o.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const m=this._visibility,h=this._active,_=this._matricesTexture,b=this._matricesTexture.image.data,v=this._colorsTexture;m.push(!0),h.push(!0);const w=this._geometryCount;this._geometryCount++,_identityMatrix.toArray(b,w*16),_.needsUpdate=!0,v!==null&&(_whiteColor.toArray(v.image.data,w*4),v.needsUpdate=!0),a.push(o),c.push({start:f?o.indexStart:o.vertexStart,count:-1}),d.push({boxInitialized:!1,box:new Box3,sphereInitialized:!1,sphere:new Sphere});const y=this.geometry.getAttribute(ID_ATTR_NAME);for(let M=0;M<o.vertexCount;M++)y.setX(o.vertexStart+M,w);return y.needsUpdate=!0,this.setGeometryAt(w,e),w}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const r=this.geometry,o=r.getIndex()!==null,l=r.getIndex(),a=i.getIndex(),c=this._reservedRanges[e];if(o&&a.count>c.indexCount||i.attributes.position.count>c.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const d=c.vertexStart,u=c.vertexCount;for(const _ in r.attributes){if(_===ID_ATTR_NAME)continue;const b=i.getAttribute(_),v=r.getAttribute(_);copyAttributeData(b,v,d);const w=b.itemSize;for(let y=b.count,M=u;y<M;y++){const S=d+y;for(let D=0;D<w;D++)v.setComponent(S,D,0)}v.needsUpdate=!0,v.addUpdateRange(d*w,u*w)}if(o){const _=c.indexStart;for(let b=0;b<a.count;b++)l.setX(_+b,d+a.getX(b));for(let b=a.count,v=c.indexCount;b<v;b++)l.setX(_+b,d);l.needsUpdate=!0,l.addUpdateRange(_,c.indexCount)}const f=this._bounds[e];i.boundingBox!==null?(f.box.copy(i.boundingBox),f.boxInitialized=!0):f.boxInitialized=!1,i.boundingSphere!==null?(f.sphere.copy(i.boundingSphere),f.sphereInitialized=!0):f.sphereInitialized=!1;const m=this._drawRanges[e],h=i.getAttribute("position");return m.count=o?a.count:h.count,this._visibilityChanged=!0,e}deleteGeometry(e){const i=this._active;return e>=i.length||i[e]===!1?this:(i[e]=!1,this._visibilityChanged=!0,this)}getInstanceCountAt(e){return this._multiDrawInstances===null?null:this._multiDrawInstances[e]}setInstanceCountAt(e,i){return this._multiDrawInstances===null&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[e]=i,e}getBoundingBoxAt(e,i){if(this._active[e]===!1)return null;const o=this._bounds[e],l=o.box,a=this.geometry;if(o.boxInitialized===!1){l.makeEmpty();const c=a.index,d=a.attributes.position,u=this._drawRanges[e];for(let f=u.start,m=u.start+u.count;f<m;f++){let h=f;c&&(h=c.getX(h)),l.expandByPoint(_vector$7.fromBufferAttribute(d,h))}o.boxInitialized=!0}return i.copy(l),i}getBoundingSphereAt(e,i){if(this._active[e]===!1)return null;const o=this._bounds[e],l=o.sphere,a=this.geometry;if(o.sphereInitialized===!1){l.makeEmpty(),this.getBoundingBoxAt(e,_box$1),_box$1.getCenter(l.center);const c=a.index,d=a.attributes.position,u=this._drawRanges[e];let f=0;for(let m=u.start,h=u.start+u.count;m<h;m++){let _=m;c&&(_=c.getX(_)),_vector$7.fromBufferAttribute(d,_),f=Math.max(f,l.center.distanceToSquared(_vector$7))}l.radius=Math.sqrt(f),o.sphereInitialized=!0}return i.copy(l),i}setMatrixAt(e,i){const r=this._active,o=this._matricesTexture,l=this._matricesTexture.image.data,a=this._geometryCount;return e>=a||r[e]===!1?this:(i.toArray(l,e*16),o.needsUpdate=!0,this)}getMatrixAt(e,i){const r=this._active,o=this._matricesTexture.image.data,l=this._geometryCount;return e>=l||r[e]===!1?null:i.fromArray(o,e*16)}setColorAt(e,i){this._colorsTexture===null&&this._initColorsTexture();const r=this._active,o=this._colorsTexture,l=this._colorsTexture.image.data,a=this._geometryCount;return e>=a||r[e]===!1?this:(i.toArray(l,e*4),o.needsUpdate=!0,this)}getColorAt(e,i){const r=this._active,o=this._colorsTexture.image.data,l=this._geometryCount;return e>=l||r[e]===!1?null:i.fromArray(o,e*4)}setVisibleAt(e,i){const r=this._visibility,o=this._active,l=this._geometryCount;return e>=l||o[e]===!1||r[e]===i?this:(r[e]=i,this._visibilityChanged=!0,this)}getVisibleAt(e){const i=this._visibility,r=this._active,o=this._geometryCount;return e>=o||r[e]===!1?!1:i[e]}raycast(e,i){const r=this._visibility,o=this._active,l=this._drawRanges,a=this._geometryCount,c=this.matrixWorld,d=this.geometry;_mesh.material=this.material,_mesh.geometry.index=d.index,_mesh.geometry.attributes=d.attributes,_mesh.geometry.boundingBox===null&&(_mesh.geometry.boundingBox=new Box3),_mesh.geometry.boundingSphere===null&&(_mesh.geometry.boundingSphere=new Sphere);for(let u=0;u<a;u++){if(!r[u]||!o[u])continue;const f=l[u];_mesh.geometry.setDrawRange(f.start,f.count),this.getMatrixAt(u,_mesh.matrixWorld).premultiply(c),this.getBoundingBoxAt(u,_mesh.geometry.boundingBox),this.getBoundingSphereAt(u,_mesh.geometry.boundingSphere),_mesh.raycast(e,_batchIntersects);for(let m=0,h=_batchIntersects.length;m<h;m++){const _=_batchIntersects[m];_.object=this,_.batchId=u,i.push(_)}_batchIntersects.length=0}_mesh.material=null,_mesh.geometry.index=null,_mesh.geometry.attributes={},_mesh.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(i=>({...i})),this._reservedRanges=e._reservedRanges.map(i=>({...i})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(i=>({boxInitialized:i.boxInitialized,box:i.box.clone(),sphereInitialized:i.sphereInitialized,sphere:i.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,i,r,o,l){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=o.getIndex(),c=a===null?1:a.array.BYTES_PER_ELEMENT,d=this._active,u=this._visibility,f=this._multiDrawStarts,m=this._multiDrawCounts,h=this._drawRanges,_=this.perObjectFrustumCulled;_&&(_projScreenMatrix$2.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),_frustum.setFromProjectionMatrix(_projScreenMatrix$2,e.coordinateSystem));let b=0;if(this.sortObjects){_invMatrixWorld.copy(this.matrixWorld).invert(),_vector$7.setFromMatrixPosition(r.matrixWorld).applyMatrix4(_invMatrixWorld),_forward.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(_invMatrixWorld);for(let y=0,M=u.length;y<M;y++)if(u[y]&&d[y]){this.getMatrixAt(y,_matrix$3),this.getBoundingSphereAt(y,_sphere$2).applyMatrix4(_matrix$3);let S=!1;if(_&&(S=!_frustum.intersectsSphere(_sphere$2)),!S){const D=_temp$1.subVectors(_sphere$2.center,_vector$7).dot(_forward);_renderList.push(h[y],D)}}const v=_renderList.list,w=this.customSort;w===null?v.sort(l.transparent?sortTransparent:sortOpaque):w.call(this,v,r);for(let y=0,M=v.length;y<M;y++){const S=v[y];f[b]=S.start*c,m[b]=S.count,b++}_renderList.reset()}else for(let v=0,w=u.length;v<w;v++)if(u[v]&&d[v]){let y=!1;if(_&&(this.getMatrixAt(v,_matrix$3),this.getBoundingSphereAt(v,_sphere$2).applyMatrix4(_matrix$3),y=!_frustum.intersectsSphere(_sphere$2)),!y){const M=h[v];f[b]=M.start*c,m[b]=M.count,b++}}this._multiDrawCount=b,this._visibilityChanged=!1}onBeforeShadow(e,i,r,o,l,a){this.onBeforeRender(e,null,o,l,a)}}class LineBasicMaterial extends Material{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _vStart=new Vector3,_vEnd=new Vector3,_inverseMatrix$1=new Matrix4,_ray$2=new Ray,_sphere$1=new Sphere,_intersectPointOnRay=new Vector3,_intersectPointOnSegment=new Vector3;class Line extends Object3D{constructor(e=new BufferGeometry,i=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[0];for(let o=1,l=i.count;o<l;o++)_vStart.fromBufferAttribute(i,o-1),_vEnd.fromBufferAttribute(i,o),r[o]=r[o-1],r[o]+=_vStart.distanceTo(_vEnd);e.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const r=this.geometry,o=this.matrixWorld,l=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere$1.copy(r.boundingSphere),_sphere$1.applyMatrix4(o),_sphere$1.radius+=l,e.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(o).invert(),_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$1);const c=l/((this.scale.x+this.scale.y+this.scale.z)/3),d=c*c,u=this.isLineSegments?2:1,f=r.index,h=r.attributes.position;if(f!==null){const _=Math.max(0,a.start),b=Math.min(f.count,a.start+a.count);for(let v=_,w=b-1;v<w;v+=u){const y=f.getX(v),M=f.getX(v+1),S=checkIntersection$1(this,e,_ray$2,d,y,M);S&&i.push(S)}if(this.isLineLoop){const v=f.getX(b-1),w=f.getX(_),y=checkIntersection$1(this,e,_ray$2,d,v,w);y&&i.push(y)}}else{const _=Math.max(0,a.start),b=Math.min(h.count,a.start+a.count);for(let v=_,w=b-1;v<w;v+=u){const y=checkIntersection$1(this,e,_ray$2,d,v,v+1);y&&i.push(y)}if(this.isLineLoop){const v=checkIntersection$1(this,e,_ray$2,d,b-1,_);v&&i.push(v)}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const o=i[r[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,a=o.length;l<a;l++){const c=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=l}}}}}function checkIntersection$1(s,e,i,r,o,l){const a=s.geometry.attributes.position;if(_vStart.fromBufferAttribute(a,o),_vEnd.fromBufferAttribute(a,l),i.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>r)return;_intersectPointOnRay.applyMatrix4(s.matrixWorld);const d=e.ray.origin.distanceTo(_intersectPointOnRay);if(!(d<e.near||d>e.far))return{distance:d,point:_intersectPointOnSegment.clone().applyMatrix4(s.matrixWorld),index:o,face:null,faceIndex:null,object:s}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[];for(let o=0,l=i.count;o<l;o+=2)_start.fromBufferAttribute(i,o),_end.fromBufferAttribute(i,o+1),r[o]=o===0?0:r[o-1],r[o+1]=r[o]+_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _inverseMatrix=new Matrix4,_ray$1=new Ray,_sphere=new Sphere,_position$3=new Vector3;class Points extends Object3D{constructor(e=new BufferGeometry,i=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){const r=this.geometry,o=this.matrixWorld,l=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere.copy(r.boundingSphere),_sphere.applyMatrix4(o),_sphere.radius+=l,e.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(o).invert(),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix);const c=l/((this.scale.x+this.scale.y+this.scale.z)/3),d=c*c,u=r.index,m=r.attributes.position;if(u!==null){const h=Math.max(0,a.start),_=Math.min(u.count,a.start+a.count);for(let b=h,v=_;b<v;b++){const w=u.getX(b);_position$3.fromBufferAttribute(m,w),testPoint(_position$3,w,d,o,e,i,this)}}else{const h=Math.max(0,a.start),_=Math.min(m.count,a.start+a.count);for(let b=h,v=_;b<v;b++)_position$3.fromBufferAttribute(m,b),testPoint(_position$3,b,d,o,e,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const o=i[r[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,a=o.length;l<a;l++){const c=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=l}}}}}function testPoint(s,e,i,r,o,l,a){const c=_ray$1.distanceSqToPoint(s);if(c<i){const d=new Vector3;_ray$1.closestPointToPoint(s,d),d.applyMatrix4(r);const u=o.ray.origin.distanceTo(d);if(u<o.near||u>o.far)return;l.push({distance:u,distanceToRay:Math.sqrt(c),point:d,index:e,face:null,object:a})}}class VideoTexture extends Texture{constructor(e,i,r,o,l,a,c,d,u){super(e,i,r,o,l,a,c,d,u),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:LinearFilter,this.magFilter=l!==void 0?l:LinearFilter,this.generateMipmaps=!1;const f=this;function m(){f.needsUpdate=!0,e.requestVideoFrameCallback(m)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(m)}clone(){return new this.constructor(this.image).copy(this)}getVideo(){return this.image}get width(){return this.image.videoWidth}get height(){return this.image.videoHeight}play(){const e=this.image;!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA||e.play()}getDuration(){return this.image.duration}setCurrentTime(e){this.image.currentTime=e}getCurrentTime(){return this.image.currentTime}pause(){this.image.pause()}setVolume(e){e<1e-4?this.image.muted=!0:this.image.muted=!1,this.image.volume=e,console.log(e)}setAutoPlay(e){this.image.autoplay=e}getAutoPlay(){return this.image.autoplay}enableAutoPlay(e=!0){console.warn("Deprecated: Use setAutoPlay instead of enableAutoPlay."),e?this.image.autoplay=!0:this.image.autoplay=!1}getVolume(e){return this.image.volume}setLoop(e){this.image.loop=e}getLoop(e){return this.image.loop}getMuted(){return this.image.muted}setMuted(e){this.image.muted=e}stop(){this.image.pause(),this.setCurrentTime(0)}dispose(){super.dispose();try{this.image.pause()}catch{}this.image.currentTime=0}toJSON(){const e=super.toJSON();return e.video_loop=this.image.loop,e.video_volume=this.image.volume,e.video_muted=this.image.muted,e}copy(e){return super.copy(e),e.video_loop!==void 0?(this.image.loop=e.video_loop,this.image.volume=e.video_volume,this.image.muted=e.video_muted):this.image?.loop!==void 0&&e.image?.loop!==void 0&&(this.image.loop=e.image.loop,this.image.volume=e.image.volume,this.image.muted=e.image.muted),this}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class FramebufferTexture extends Texture{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(e,i,r,o,l,a,c,d,u,f,m,h){super(null,a,c,d,u,f,o,l,m,h),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(e,i,r,o,l,a){super(e,i,r,l,a),this.isCompressedArrayTexture=!0,this.image.depth=o,this.wrapR=ClampToEdgeWrapping,this.layerUpdates=new Set}addLayerUpdates(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class CompressedCubeTexture extends CompressedTexture{constructor(e,i,r){super(void 0,e[0].width,e[0].height,i,r,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class CanvasTexture extends Texture{constructor(e,i,r,o,l,a,c,d,u){super(e,i,r,o,l,a,c,d,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){const r=this.getUtoTmapping(e);return this.getPoint(r,i)}getPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return i}getSpacedPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPointAt(r/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,o=this.getPoint(0),l=0;i.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),l+=r.distanceTo(o),i.push(l),o=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){const r=this.getLengths();let o=0;const l=r.length;let a;i?a=i:a=e*r[l-1];let c=0,d=l-1,u;for(;c<=d;)if(o=Math.floor(c+(d-c)/2),u=r[o]-a,u<0)c=o+1;else if(u>0)d=o-1;else{d=o;break}if(o=d,r[o]===a)return o/(l-1);const f=r[o],h=r[o+1]-f,_=(a-f)/h;return(o+_)/(l-1)}getTangent(e,i){let o=e-1e-4,l=e+1e-4;o<0&&(o=0),l>1&&(l=1);const a=this.getPoint(o),c=this.getPoint(l),d=i||(a.isVector2?new Vector2:new Vector3);return d.copy(c).sub(a).normalize(),d}getTangentAt(e,i){const r=this.getUtoTmapping(e);return this.getTangent(r,i)}computeFrenetFrames(e,i){const r=new Vector3,o=[],l=[],a=[],c=new Vector3,d=new Matrix4;for(let _=0;_<=e;_++){const b=_/e;o[_]=this.getTangentAt(b,new Vector3)}l[0]=new Vector3,a[0]=new Vector3;let u=Number.MAX_VALUE;const f=Math.abs(o[0].x),m=Math.abs(o[0].y),h=Math.abs(o[0].z);f<=u&&(u=f,r.set(1,0,0)),m<=u&&(u=m,r.set(0,1,0)),h<=u&&r.set(0,0,1),c.crossVectors(o[0],r).normalize(),l[0].crossVectors(o[0],c),a[0].crossVectors(o[0],l[0]);for(let _=1;_<=e;_++){if(l[_]=l[_-1].clone(),a[_]=a[_-1].clone(),c.crossVectors(o[_-1],o[_]),c.length()>Number.EPSILON){c.normalize();const b=Math.acos(clamp(o[_-1].dot(o[_]),-1,1));l[_].applyMatrix4(d.makeRotationAxis(c,b))}a[_].crossVectors(o[_],l[_])}if(i===!0){let _=Math.acos(clamp(l[0].dot(l[e]),-1,1));_/=e,o[0].dot(c.crossVectors(l[0],l[e]))>0&&(_=-_);for(let b=1;b<=e;b++)l[b].applyMatrix4(d.makeRotationAxis(o[b],_*b)),a[b].crossVectors(o[b],l[b])}return{tangents:o,normals:l,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(e=0,i=0,r=1,o=1,l=0,a=Math.PI*2,c=!1,d=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=r,this.yRadius=o,this.aStartAngle=l,this.aEndAngle=a,this.aClockwise=c,this.aRotation=d}getPoint(e,i=new Vector2){const r=i,o=Math.PI*2;let l=this.aEndAngle-this.aStartAngle;const a=Math.abs(l)<Number.EPSILON;for(;l<0;)l+=o;for(;l>o;)l-=o;l<Number.EPSILON&&(a?l=0:l=o),this.aClockwise===!0&&!a&&(l===o?l=-o:l=l-o);const c=this.aStartAngle+e*l;let d=this.aX+this.xRadius*Math.cos(c),u=this.aY+this.yRadius*Math.sin(c);if(this.aRotation!==0){const f=Math.cos(this.aRotation),m=Math.sin(this.aRotation),h=d-this.aX,_=u-this.aY;d=h*f-_*m+this.aX,u=h*m+_*f+this.aY}return r.set(d,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(e,i,r,o,l,a){super(e,i,r,r,o,l,a),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let s=0,e=0,i=0,r=0;function o(l,a,c,d){s=l,e=c,i=-3*l+3*a-2*c-d,r=2*l-2*a+c+d}return{initCatmullRom:function(l,a,c,d,u){o(a,c,u*(c-l),u*(d-a))},initNonuniformCatmullRom:function(l,a,c,d,u,f,m){let h=(a-l)/u-(c-l)/(u+f)+(c-a)/f,_=(c-a)/f-(d-a)/(f+m)+(d-c)/m;h*=f,_*=f,o(a,c,h,_)},calc:function(l){const a=l*l,c=a*l;return s+e*l+i*a+r*c}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(e=[],i=!1,r="centripetal",o=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=r,this.tension=o}getPoint(e,i=new Vector3){const r=i,o=this.points,l=o.length,a=(l-(this.closed?0:1))*e;let c=Math.floor(a),d=a-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:d===0&&c===l-1&&(c=l-2,d=1);let u,f;this.closed||c>0?u=o[(c-1)%l]:(tmp.subVectors(o[0],o[1]).add(o[0]),u=tmp);const m=o[c%l],h=o[(c+1)%l];if(this.closed||c+2<l?f=o[(c+2)%l]:(tmp.subVectors(o[l-1],o[l-2]).add(o[l-1]),f=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const _=this.curveType==="chordal"?.5:.25;let b=Math.pow(u.distanceToSquared(m),_),v=Math.pow(m.distanceToSquared(h),_),w=Math.pow(h.distanceToSquared(f),_);v<1e-4&&(v=1),b<1e-4&&(b=v),w<1e-4&&(w=v),px.initNonuniformCatmullRom(u.x,m.x,h.x,f.x,b,v,w),py.initNonuniformCatmullRom(u.y,m.y,h.y,f.y,b,v,w),pz.initNonuniformCatmullRom(u.z,m.z,h.z,f.z,b,v,w)}else this.curveType==="catmullrom"&&(px.initCatmullRom(u.x,m.x,h.x,f.x,this.tension),py.initCatmullRom(u.y,m.y,h.y,f.y,this.tension),pz.initCatmullRom(u.z,m.z,h.z,f.z,this.tension));return r.set(px.calc(d),py.calc(d),pz.calc(d)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const o=e.points[i];this.points.push(o.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const o=this.points[i];e.points.push(o.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const o=e.points[i];this.points.push(new Vector3().fromArray(o))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function CatmullRom(s,e,i,r,o){const l=(r-e)*.5,a=(o-i)*.5,c=s*s,d=s*c;return(2*i-2*r+l+a)*d+(-3*i+3*r-2*l-a)*c+l*s+i}function QuadraticBezierP0(s,e){const i=1-s;return i*i*e}function QuadraticBezierP1(s,e){return 2*(1-s)*s*e}function QuadraticBezierP2(s,e){return s*s*e}function QuadraticBezier(s,e,i,r){return QuadraticBezierP0(s,e)+QuadraticBezierP1(s,i)+QuadraticBezierP2(s,r)}function CubicBezierP0(s,e){const i=1-s;return i*i*i*e}function CubicBezierP1(s,e){const i=1-s;return 3*i*i*s*e}function CubicBezierP2(s,e){return 3*(1-s)*s*s*e}function CubicBezierP3(s,e){return s*s*s*e}function CubicBezier(s,e,i,r,o){return CubicBezierP0(s,e)+CubicBezierP1(s,i)+CubicBezierP2(s,r)+CubicBezierP3(s,o)}class CubicBezierCurve extends Curve{constructor(e=new Vector2,i=new Vector2,r=new Vector2,o=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=r,this.v3=o}getPoint(e,i=new Vector2){const r=i,o=this.v0,l=this.v1,a=this.v2,c=this.v3;return r.set(CubicBezier(e,o.x,l.x,a.x,c.x),CubicBezier(e,o.y,l.y,a.y,c.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class CubicBezierCurve3 extends Curve{constructor(e=new Vector3,i=new Vector3,r=new Vector3,o=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=r,this.v3=o}getPoint(e,i=new Vector3){const r=i,o=this.v0,l=this.v1,a=this.v2,c=this.v3;return r.set(CubicBezier(e,o.x,l.x,a.x,c.x),CubicBezier(e,o.y,l.y,a.y,c.y),CubicBezier(e,o.z,l.z,a.z,c.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class LineCurve extends Curve{constructor(e=new Vector2,i=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new Vector2){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Vector2){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class LineCurve3 extends Curve{constructor(e=new Vector3,i=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new Vector3){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Vector3){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QuadraticBezierCurve extends Curve{constructor(e=new Vector2,i=new Vector2,r=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new Vector2){const r=i,o=this.v0,l=this.v1,a=this.v2;return r.set(QuadraticBezier(e,o.x,l.x,a.x),QuadraticBezier(e,o.y,l.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(e=new Vector3,i=new Vector3,r=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new Vector3){const r=i,o=this.v0,l=this.v1,a=this.v2;return r.set(QuadraticBezier(e,o.x,l.x,a.x),QuadraticBezier(e,o.y,l.y,a.y),QuadraticBezier(e,o.z,l.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class SplineCurve extends Curve{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new Vector2){const r=i,o=this.points,l=(o.length-1)*e,a=Math.floor(l),c=l-a,d=o[a===0?a:a-1],u=o[a],f=o[a>o.length-2?o.length-1:a+1],m=o[a>o.length-3?o.length-1:a+2];return r.set(CatmullRom(c,d.x,u.x,f.x,m.x),CatmullRom(c,d.y,u.y,f.y,m.y)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const o=e.points[i];this.points.push(o.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const o=this.points[i];e.points.push(o.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const o=e.points[i];this.points.push(new Vector2().fromArray(o))}return this}}const Curves=Object.freeze(Object.defineProperty({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve},Symbol.toStringTag,{value:"Module"}));class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Curves[r](i,e))}return this}getPoint(e,i){const r=e*this.getLength(),o=this.getCurveLengths();let l=0;for(;l<o.length;){if(o[l]>=r){const a=o[l]-r,c=this.curves[l],d=c.getLength(),u=d===0?0:1-a/d;return c.getPointAt(u,i)}l++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let r=0,o=this.curves.length;r<o;r++)i+=this.curves[r].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let r;for(let o=0,l=this.curves;o<l.length;o++){const a=l[o],c=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,d=a.getPoints(c);for(let u=0;u<d.length;u++){const f=d[u];r&&r.equals(f)||(i.push(f),r=f)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const o=e.curves[i];this.curves.push(o.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const o=this.curves[i];e.curves.push(o.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const o=e.curves[i];this.curves.push(new Curves[o.type]().fromJSON(o))}return this}}class Path extends CurvePath{constructor(e){super(),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,r=e.length;i<r;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const r=new LineCurve(this.currentPoint.clone(),new Vector2(e,i));return this.curves.push(r),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,r,o){const l=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,i),new Vector2(r,o));return this.curves.push(l),this.currentPoint.set(r,o),this}bezierCurveTo(e,i,r,o,l,a){const c=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,i),new Vector2(r,o),new Vector2(l,a));return this.curves.push(c),this.currentPoint.set(l,a),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),r=new SplineCurve(i);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,r,o,l,a){const c=this.currentPoint.x,d=this.currentPoint.y;return this.absarc(e+c,i+d,r,o,l,a),this}absarc(e,i,r,o,l,a){return this.absellipse(e,i,r,r,o,l,a),this}ellipse(e,i,r,o,l,a,c,d){const u=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+u,i+f,r,o,l,a,c,d),this}absellipse(e,i,r,o,l,a,c,d){const u=new EllipseCurve(e,i,r,o,l,a,c,d);if(this.curves.length>0){const m=u.getPoint(0);m.equals(this.currentPoint)||this.lineTo(m.x,m.y)}this.curves.push(u);const f=u.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(e=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],i=12,r=0,o=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:r,phiLength:o},i=Math.floor(i),o=clamp(o,0,Math.PI*2);const l=[],a=[],c=[],d=[],u=[],f=1/i,m=new Vector3,h=new Vector2,_=new Vector3,b=new Vector3,v=new Vector3;let w=0,y=0;for(let M=0;M<=e.length-1;M++)switch(M){case 0:w=e[M+1].x-e[M].x,y=e[M+1].y-e[M].y,_.x=y*1,_.y=-w,_.z=y*0,v.copy(_),_.normalize(),d.push(_.x,_.y,_.z);break;case e.length-1:d.push(v.x,v.y,v.z);break;default:w=e[M+1].x-e[M].x,y=e[M+1].y-e[M].y,_.x=y*1,_.y=-w,_.z=y*0,b.copy(_),_.x+=v.x,_.y+=v.y,_.z+=v.z,_.normalize(),d.push(_.x,_.y,_.z),v.copy(b)}for(let M=0;M<=i;M++){const S=r+M*f*o,D=Math.sin(S),k=Math.cos(S);for(let O=0;O<=e.length-1;O++){m.x=e[O].x*D,m.y=e[O].y,m.z=e[O].x*k,a.push(m.x,m.y,m.z),h.x=M/i,h.y=O/(e.length-1),c.push(h.x,h.y);const L=d[3*O+0]*D,P=d[3*O+1],N=d[3*O+0]*k;u.push(L,P,N)}}for(let M=0;M<i;M++)for(let S=0;S<e.length-1;S++){const D=S+M*e.length,k=D,O=D+e.length,L=D+e.length+1,P=D+1;l.push(k,O,P),l.push(L,P,O)}this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2)),this.setAttribute("normal",new Float32BufferAttribute(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LatheGeometry(e.points,e.segments,e.phiStart,e.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(e=1,i=1,r=4,o=8){const l=new Path;l.absarc(0,-i/2,e,Math.PI*1.5,0),l.absarc(0,i/2,e,0,Math.PI*.5),super(l.getPoints(r),o),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:r,radialSegments:o}}static fromJSON(e){return new CapsuleGeometry(e.radius,e.length,e.capSegments,e.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(e=1,i=32,r=0,o=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:r,thetaLength:o},i=Math.max(3,i);const l=[],a=[],c=[],d=[],u=new Vector3,f=new Vector2;a.push(0,0,0),c.push(0,0,1),d.push(.5,.5);for(let m=0,h=3;m<=i;m++,h+=3){const _=r+m/i*o;u.x=e*Math.cos(_),u.y=e*Math.sin(_),a.push(u.x,u.y,u.z),c.push(0,0,1),f.x=(a[h]/e+1)/2,f.y=(a[h+1]/e+1)/2,d.push(f.x,f.y)}for(let m=1;m<=i;m++)l.push(m,m+1,0);this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(e=1,i=1,r=1,o=32,l=1,a=!1,c=0,d=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:r,radialSegments:o,heightSegments:l,openEnded:a,thetaStart:c,thetaLength:d};const u=this;o=Math.floor(o),l=Math.floor(l);const f=[],m=[],h=[],_=[];let b=0;const v=[],w=r/2;let y=0;M(),a===!1&&(e>0&&S(!0),i>0&&S(!1)),this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2));function M(){const D=new Vector3,k=new Vector3;let O=0;const L=(i-e)/r;for(let P=0;P<=l;P++){const N=[],z=P/l,K=z*(i-e)+e;for(let Z=0;Z<=o;Z++){const V=Z/o,H=V*d+c,Y=Math.sin(H),q=Math.cos(H);k.x=K*Y,k.y=-z*r+w,k.z=K*q,m.push(k.x,k.y,k.z),D.set(Y,L,q).normalize(),h.push(D.x,D.y,D.z),_.push(V,1-z),N.push(b++)}v.push(N)}for(let P=0;P<o;P++)for(let N=0;N<l;N++){const z=v[N][P],K=v[N+1][P],Z=v[N+1][P+1],V=v[N][P+1];f.push(z,K,V),f.push(K,Z,V),O+=6}u.addGroup(y,O,0),y+=O}function S(D){const k=b,O=new Vector2,L=new Vector3;let P=0;const N=D===!0?e:i,z=D===!0?1:-1;for(let Z=1;Z<=o;Z++)m.push(0,w*z,0),h.push(0,z,0),_.push(.5,.5),b++;const K=b;for(let Z=0;Z<=o;Z++){const H=Z/o*d+c,Y=Math.cos(H),q=Math.sin(H);L.x=N*q,L.y=w*z,L.z=N*Y,m.push(L.x,L.y,L.z),h.push(0,z,0),O.x=Y*.5+.5,O.y=q*.5*z+.5,_.push(O.x,O.y),b++}for(let Z=0;Z<o;Z++){const V=k+Z,H=K+Z;D===!0?f.push(H,H+1,V):f.push(H+1,H,V),P+=3}u.addGroup(y,P,D===!0?1:2),y+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(e=1,i=1,r=32,o=1,l=!1,a=0,c=Math.PI*2){super(0,e,i,r,o,l,a,c),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:r,heightSegments:o,openEnded:l,thetaStart:a,thetaLength:c}}static fromJSON(e){return new ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(e=[],i=[],r=1,o=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:r,detail:o};const l=[],a=[];c(o),u(r),f(),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(l.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(a,2)),o===0?this.computeVertexNormals():this.normalizeNormals();function c(M){const S=new Vector3,D=new Vector3,k=new Vector3;for(let O=0;O<i.length;O+=3)_(i[O+0],S),_(i[O+1],D),_(i[O+2],k),d(S,D,k,M)}function d(M,S,D,k){const O=k+1,L=[];for(let P=0;P<=O;P++){L[P]=[];const N=M.clone().lerp(D,P/O),z=S.clone().lerp(D,P/O),K=O-P;for(let Z=0;Z<=K;Z++)Z===0&&P===O?L[P][Z]=N:L[P][Z]=N.clone().lerp(z,Z/K)}for(let P=0;P<O;P++)for(let N=0;N<2*(O-P)-1;N++){const z=Math.floor(N/2);N%2===0?(h(L[P][z+1]),h(L[P+1][z]),h(L[P][z])):(h(L[P][z+1]),h(L[P+1][z+1]),h(L[P+1][z]))}}function u(M){const S=new Vector3;for(let D=0;D<l.length;D+=3)S.x=l[D+0],S.y=l[D+1],S.z=l[D+2],S.normalize().multiplyScalar(M),l[D+0]=S.x,l[D+1]=S.y,l[D+2]=S.z}function f(){const M=new Vector3;for(let S=0;S<l.length;S+=3){M.x=l[S+0],M.y=l[S+1],M.z=l[S+2];const D=w(M)/2/Math.PI+.5,k=y(M)/Math.PI+.5;a.push(D,1-k)}b(),m()}function m(){for(let M=0;M<a.length;M+=6){const S=a[M+0],D=a[M+2],k=a[M+4],O=Math.max(S,D,k),L=Math.min(S,D,k);O>.9&&L<.1&&(S<.2&&(a[M+0]+=1),D<.2&&(a[M+2]+=1),k<.2&&(a[M+4]+=1))}}function h(M){l.push(M.x,M.y,M.z)}function _(M,S){const D=M*3;S.x=e[D+0],S.y=e[D+1],S.z=e[D+2]}function b(){const M=new Vector3,S=new Vector3,D=new Vector3,k=new Vector3,O=new Vector2,L=new Vector2,P=new Vector2;for(let N=0,z=0;N<l.length;N+=9,z+=6){M.set(l[N+0],l[N+1],l[N+2]),S.set(l[N+3],l[N+4],l[N+5]),D.set(l[N+6],l[N+7],l[N+8]),O.set(a[z+0],a[z+1]),L.set(a[z+2],a[z+3]),P.set(a[z+4],a[z+5]),k.copy(M).add(S).add(D).divideScalar(3);const K=w(k);v(O,z+0,M,K),v(L,z+2,S,K),v(P,z+4,D,K)}}function v(M,S,D,k){k<0&&M.x===1&&(a[S]=M.x-1),D.x===0&&D.z===0&&(a[S]=k/2/Math.PI+.5)}function w(M){return Math.atan2(M.z,-M.x)}function y(M){return Math.atan2(-M.y,Math.sqrt(M.x*M.x+M.z*M.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PolyhedronGeometry(e.vertices,e.indices,e.radius,e.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,o=1/r,l=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-r,0,-o,r,0,o,-r,0,o,r,-o,-r,0,-o,r,0,o,-r,0,o,r,0,-r,0,-o,r,0,-o,-r,0,o,r,0,o],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(l,a,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new DodecahedronGeometry(e.radius,e.detail)}}const _v0=new Vector3,_v1$2=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const o=Math.pow(10,4),l=Math.cos(DEG2RAD*i),a=e.getIndex(),c=e.getAttribute("position"),d=a?a.count:c.count,u=[0,0,0],f=["a","b","c"],m=new Array(3),h={},_=[];for(let b=0;b<d;b+=3){a?(u[0]=a.getX(b),u[1]=a.getX(b+1),u[2]=a.getX(b+2)):(u[0]=b,u[1]=b+1,u[2]=b+2);const{a:v,b:w,c:y}=_triangle;if(v.fromBufferAttribute(c,u[0]),w.fromBufferAttribute(c,u[1]),y.fromBufferAttribute(c,u[2]),_triangle.getNormal(_normal),m[0]=`${Math.round(v.x*o)},${Math.round(v.y*o)},${Math.round(v.z*o)}`,m[1]=`${Math.round(w.x*o)},${Math.round(w.y*o)},${Math.round(w.z*o)}`,m[2]=`${Math.round(y.x*o)},${Math.round(y.y*o)},${Math.round(y.z*o)}`,!(m[0]===m[1]||m[1]===m[2]||m[2]===m[0]))for(let M=0;M<3;M++){const S=(M+1)%3,D=m[M],k=m[S],O=_triangle[f[M]],L=_triangle[f[S]],P=`${D}_${k}`,N=`${k}_${D}`;N in h&&h[N]?(_normal.dot(h[N].normal)<=l&&(_.push(O.x,O.y,O.z),_.push(L.x,L.y,L.z)),h[N]=null):P in h||(h[P]={index0:u[M],index1:u[S],normal:_normal.clone()})}}for(const b in h)if(h[b]){const{index0:v,index1:w}=h[b];_v0.fromBufferAttribute(c,v),_v1$2.fromBufferAttribute(c,w),_.push(_v0.x,_v0.y,_v0.z),_.push(_v1$2.x,_v1$2.y,_v1$2.z)}this.setAttribute("position",new Float32BufferAttribute(_,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Shape extends Path{constructor(e){super(e),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let r=0,o=this.holes.length;r<o;r++)i[r]=this.holes[r].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const o=e.holes[i];this.holes.push(o.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const o=this.holes[i];e.holes.push(o.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const o=e.holes[i];this.holes.push(new Path().fromJSON(o))}return this}}const Earcut={triangulate:function(s,e,i=2){const r=e&&e.length,o=r?e[0]*i:s.length;let l=linkedList(s,0,o,i,!0);const a=[];if(!l||l.next===l.prev)return a;let c,d,u,f,m,h,_;if(r&&(l=eliminateHoles(s,e,l,i)),s.length>80*i){c=u=s[0],d=f=s[1];for(let b=i;b<o;b+=i)m=s[b],h=s[b+1],m<c&&(c=m),h<d&&(d=h),m>u&&(u=m),h>f&&(f=h);_=Math.max(u-c,f-d),_=_!==0?32767/_:0}return earcutLinked(l,a,i,c,d,_,0),a}};function linkedList(s,e,i,r,o){let l,a;if(o===signedArea(s,e,i,r)>0)for(l=e;l<i;l+=r)a=insertNode(l,s[l],s[l+1],a);else for(l=i-r;l>=e;l-=r)a=insertNode(l,s[l],s[l+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(s,e){if(!s)return s;e||(e=s);let i=s,r;do if(r=!1,!i.steiner&&(equals(i,i.next)||area(i.prev,i,i.next)===0)){if(removeNode(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function earcutLinked(s,e,i,r,o,l,a){if(!s)return;!a&&l&&indexCurve(s,r,o,l);let c=s,d,u;for(;s.prev!==s.next;){if(d=s.prev,u=s.next,l?isEarHashed(s,r,o,l):isEar(s)){e.push(d.i/i|0),e.push(s.i/i|0),e.push(u.i/i|0),removeNode(s),s=u.next,c=u.next;continue}if(s=u,s===c){a?a===1?(s=cureLocalIntersections(filterPoints(s),e,i),earcutLinked(s,e,i,r,o,l,2)):a===2&&splitEarcut(s,e,i,r,o,l):earcutLinked(filterPoints(s),e,i,r,o,l,1);break}}}function isEar(s){const e=s.prev,i=s,r=s.next;if(area(e,i,r)>=0)return!1;const o=e.x,l=i.x,a=r.x,c=e.y,d=i.y,u=r.y,f=o<l?o<a?o:a:l<a?l:a,m=c<d?c<u?c:u:d<u?d:u,h=o>l?o>a?o:a:l>a?l:a,_=c>d?c>u?c:u:d>u?d:u;let b=r.next;for(;b!==e;){if(b.x>=f&&b.x<=h&&b.y>=m&&b.y<=_&&pointInTriangle(o,c,l,d,a,u,b.x,b.y)&&area(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function isEarHashed(s,e,i,r){const o=s.prev,l=s,a=s.next;if(area(o,l,a)>=0)return!1;const c=o.x,d=l.x,u=a.x,f=o.y,m=l.y,h=a.y,_=c<d?c<u?c:u:d<u?d:u,b=f<m?f<h?f:h:m<h?m:h,v=c>d?c>u?c:u:d>u?d:u,w=f>m?f>h?f:h:m>h?m:h,y=zOrder(_,b,e,i,r),M=zOrder(v,w,e,i,r);let S=s.prevZ,D=s.nextZ;for(;S&&S.z>=y&&D&&D.z<=M;){if(S.x>=_&&S.x<=v&&S.y>=b&&S.y<=w&&S!==o&&S!==a&&pointInTriangle(c,f,d,m,u,h,S.x,S.y)&&area(S.prev,S,S.next)>=0||(S=S.prevZ,D.x>=_&&D.x<=v&&D.y>=b&&D.y<=w&&D!==o&&D!==a&&pointInTriangle(c,f,d,m,u,h,D.x,D.y)&&area(D.prev,D,D.next)>=0))return!1;D=D.nextZ}for(;S&&S.z>=y;){if(S.x>=_&&S.x<=v&&S.y>=b&&S.y<=w&&S!==o&&S!==a&&pointInTriangle(c,f,d,m,u,h,S.x,S.y)&&area(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;D&&D.z<=M;){if(D.x>=_&&D.x<=v&&D.y>=b&&D.y<=w&&D!==o&&D!==a&&pointInTriangle(c,f,d,m,u,h,D.x,D.y)&&area(D.prev,D,D.next)>=0)return!1;D=D.nextZ}return!0}function cureLocalIntersections(s,e,i){let r=s;do{const o=r.prev,l=r.next.next;!equals(o,l)&&intersects(o,r,r.next,l)&&locallyInside(o,l)&&locallyInside(l,o)&&(e.push(o.i/i|0),e.push(r.i/i|0),e.push(l.i/i|0),removeNode(r),removeNode(r.next),r=s=l),r=r.next}while(r!==s);return filterPoints(r)}function splitEarcut(s,e,i,r,o,l){let a=s;do{let c=a.next.next;for(;c!==a.prev;){if(a.i!==c.i&&isValidDiagonal(a,c)){let d=splitPolygon(a,c);a=filterPoints(a,a.next),d=filterPoints(d,d.next),earcutLinked(a,e,i,r,o,l,0),earcutLinked(d,e,i,r,o,l,0);return}c=c.next}a=a.next}while(a!==s)}function eliminateHoles(s,e,i,r){const o=[];let l,a,c,d,u;for(l=0,a=e.length;l<a;l++)c=e[l]*r,d=l<a-1?e[l+1]*r:s.length,u=linkedList(s,c,d,r,!1),u===u.next&&(u.steiner=!0),o.push(getLeftmost(u));for(o.sort(compareX),l=0;l<o.length;l++)i=eliminateHole(o[l],i);return i}function compareX(s,e){return s.x-e.x}function eliminateHole(s,e){const i=findHoleBridge(s,e);if(!i)return e;const r=splitPolygon(i,s);return filterPoints(r,r.next),filterPoints(i,i.next)}function findHoleBridge(s,e){let i=e,r=-1/0,o;const l=s.x,a=s.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const h=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(h<=l&&h>r&&(r=h,o=i.x<i.next.x?i:i.next,h===l))return o}i=i.next}while(i!==e);if(!o)return null;const c=o,d=o.x,u=o.y;let f=1/0,m;i=o;do l>=i.x&&i.x>=d&&l!==i.x&&pointInTriangle(a<u?l:r,a,d,u,a<u?r:l,a,i.x,i.y)&&(m=Math.abs(a-i.y)/(l-i.x),locallyInside(i,s)&&(m<f||m===f&&(i.x>o.x||i.x===o.x&&sectorContainsSector(o,i)))&&(o=i,f=m)),i=i.next;while(i!==c);return o}function sectorContainsSector(s,e){return area(s.prev,s,e.prev)<0&&area(e.next,s,s.next)<0}function indexCurve(s,e,i,r){let o=s;do o.z===0&&(o.z=zOrder(o.x,o.y,e,i,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==s);o.prevZ.nextZ=null,o.prevZ=null,sortLinked(o)}function sortLinked(s){let e,i,r,o,l,a,c,d,u=1;do{for(i=s,s=null,l=null,a=0;i;){for(a++,r=i,c=0,e=0;e<u&&(c++,r=r.nextZ,!!r);e++);for(d=u;c>0||d>0&&r;)c!==0&&(d===0||!r||i.z<=r.z)?(o=i,i=i.nextZ,c--):(o=r,r=r.nextZ,d--),l?l.nextZ=o:s=o,o.prevZ=l,l=o;i=r}l.nextZ=null,u*=2}while(a>1);return s}function zOrder(s,e,i,r,o){return s=(s-i)*o|0,e=(e-r)*o|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function getLeftmost(s){let e=s,i=s;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==s);return i}function pointInTriangle(s,e,i,r,o,l,a,c){return(o-a)*(e-c)>=(s-a)*(l-c)&&(s-a)*(r-c)>=(i-a)*(e-c)&&(i-a)*(l-c)>=(o-a)*(r-c)}function isValidDiagonal(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!intersectsPolygon(s,e)&&(locallyInside(s,e)&&locallyInside(e,s)&&middleInside(s,e)&&(area(s.prev,s,e.prev)||area(s,e.prev,e))||equals(s,e)&&area(s.prev,s,s.next)>0&&area(e.prev,e,e.next)>0)}function area(s,e,i){return(e.y-s.y)*(i.x-e.x)-(e.x-s.x)*(i.y-e.y)}function equals(s,e){return s.x===e.x&&s.y===e.y}function intersects(s,e,i,r){const o=sign(area(s,e,i)),l=sign(area(s,e,r)),a=sign(area(i,r,s)),c=sign(area(i,r,e));return!!(o!==l&&a!==c||o===0&&onSegment(s,i,e)||l===0&&onSegment(s,r,e)||a===0&&onSegment(i,s,r)||c===0&&onSegment(i,e,r))}function onSegment(s,e,i){return e.x<=Math.max(s.x,i.x)&&e.x>=Math.min(s.x,i.x)&&e.y<=Math.max(s.y,i.y)&&e.y>=Math.min(s.y,i.y)}function sign(s){return s>0?1:s<0?-1:0}function intersectsPolygon(s,e){let i=s;do{if(i.i!==s.i&&i.next.i!==s.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,s,e))return!0;i=i.next}while(i!==s);return!1}function locallyInside(s,e){return area(s.prev,s,s.next)<0?area(s,e,s.next)>=0&&area(s,s.prev,e)>=0:area(s,e,s.prev)<0||area(s,s.next,e)<0}function middleInside(s,e){let i=s,r=!1;const o=(s.x+e.x)/2,l=(s.y+e.y)/2;do i.y>l!=i.next.y>l&&i.next.y!==i.y&&o<(i.next.x-i.x)*(l-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==s);return r}function splitPolygon(s,e){const i=new Node(s.i,s.x,s.y),r=new Node(e.i,e.x,e.y),o=s.next,l=e.prev;return s.next=e,e.prev=s,i.next=o,o.prev=i,r.next=i,i.prev=r,l.next=r,r.prev=l,r}function insertNode(s,e,i,r){const o=new Node(s,e,i);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function removeNode(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Node(s,e,i){this.i=s,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(s,e,i,r){let o=0;for(let l=e,a=i-r;l<i;l+=r)o+=(s[a]-s[l])*(s[l+1]+s[a+1]),a=l;return o}class ShapeUtils{static area(e){const i=e.length;let r=0;for(let o=i-1,l=0;l<i;o=l++)r+=e[o].x*e[l].y-e[l].x*e[o].y;return r*.5}static isClockWise(e){return ShapeUtils.area(e)<0}static triangulateShape(e,i){const r=[],o=[],l=[];removeDupEndPts(e),addContour(r,e);let a=e.length;i.forEach(removeDupEndPts);for(let d=0;d<i.length;d++)o.push(a),a+=i[d].length,addContour(r,i[d]);const c=Earcut.triangulate(r,o);for(let d=0;d<c.length;d+=3)l.push(c.slice(d,d+3));return l}}function removeDupEndPts(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function addContour(s,e){for(let i=0;i<e.length;i++)s.push(e[i].x),s.push(e[i].y)}class ExtrudeGeometry extends BufferGeometry{constructor(e=new Shape([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const r=this,o=[],l=[];for(let c=0,d=e.length;c<d;c++){const u=e[c];a(u)}this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2)),this.computeVertexNormals();function a(c){const d=[],u=i.curveSegments!==void 0?i.curveSegments:12,f=i.steps!==void 0?i.steps:1,m=i.depth!==void 0?i.depth:1;let h=i.bevelEnabled!==void 0?i.bevelEnabled:!0,_=i.bevelThickness!==void 0?i.bevelThickness:.2,b=i.bevelSize!==void 0?i.bevelSize:_-.1,v=i.bevelOffset!==void 0?i.bevelOffset:0,w=i.bevelSegments!==void 0?i.bevelSegments:3;const y=i.extrudePath,M=i.UVGenerator!==void 0?i.UVGenerator:WorldUVGenerator;let S,D=!1,k,O,L,P;y&&(S=y.getSpacedPoints(f),D=!0,h=!1,k=y.computeFrenetFrames(f,!1),O=new Vector3,L=new Vector3,P=new Vector3),h||(w=0,_=0,b=0,v=0);const N=c.extractPoints(u);let z=N.shape;const K=N.holes;if(!ShapeUtils.isClockWise(z)){z=z.reverse();for(let be=0,De=K.length;be<De;be++){const Te=K[be];ShapeUtils.isClockWise(Te)&&(K[be]=Te.reverse())}}const V=ShapeUtils.triangulateShape(z,K),H=z;for(let be=0,De=K.length;be<De;be++){const Te=K[be];z=z.concat(Te)}function Y(be,De,Te){return De||console.error("THREE.ExtrudeGeometry: vec does not exist"),be.clone().addScaledVector(De,Te)}const q=z.length,J=V.length;function W(be,De,Te){let ge,Ee,Ie;const Be=be.x-De.x,Oe=be.y-De.y,ue=Te.x-be.x,re=Te.y-be.y,ke=Be*Be+Oe*Oe,We=Be*re-Oe*ue;if(Math.abs(We)>Number.EPSILON){const Xe=Math.sqrt(ke),Ye=Math.sqrt(ue*ue+re*re),it=De.x-Oe/Xe,tt=De.y+Be/Xe,Ke=Te.x-re/Ye,ae=Te.y+ue/Ye,j=((Ke-it)*re-(ae-tt)*ue)/(Be*re-Oe*ue);ge=it+Be*j-be.x,Ee=tt+Oe*j-be.y;const ee=ge*ge+Ee*Ee;if(ee<=2)return new Vector2(ge,Ee);Ie=Math.sqrt(ee/2)}else{let Xe=!1;Be>Number.EPSILON?ue>Number.EPSILON&&(Xe=!0):Be<-Number.EPSILON?ue<-Number.EPSILON&&(Xe=!0):Math.sign(Oe)===Math.sign(re)&&(Xe=!0),Xe?(ge=-Oe,Ee=Be,Ie=Math.sqrt(ke)):(ge=Be,Ee=Oe,Ie=Math.sqrt(ke/2))}return new Vector2(ge/Ie,Ee/Ie)}const te=[];for(let be=0,De=H.length,Te=De-1,ge=be+1;be<De;be++,Te++,ge++)Te===De&&(Te=0),ge===De&&(ge=0),te[be]=W(H[be],H[Te],H[ge]);const ie=[];let oe,Ce=te.concat();for(let be=0,De=K.length;be<De;be++){const Te=K[be];oe=[];for(let ge=0,Ee=Te.length,Ie=Ee-1,Be=ge+1;ge<Ee;ge++,Ie++,Be++)Ie===Ee&&(Ie=0),Be===Ee&&(Be=0),oe[ge]=W(Te[ge],Te[Ie],Te[Be]);ie.push(oe),Ce=Ce.concat(oe)}for(let be=0;be<w;be++){const De=be/w,Te=_*Math.cos(De*Math.PI/2),ge=b*Math.sin(De*Math.PI/2)+v;for(let Ee=0,Ie=H.length;Ee<Ie;Ee++){const Be=Y(H[Ee],te[Ee],ge);Fe(Be.x,Be.y,-Te)}for(let Ee=0,Ie=K.length;Ee<Ie;Ee++){const Be=K[Ee];oe=ie[Ee];for(let Oe=0,ue=Be.length;Oe<ue;Oe++){const re=Y(Be[Oe],oe[Oe],ge);Fe(re.x,re.y,-Te)}}}const ve=b+v;for(let be=0;be<q;be++){const De=h?Y(z[be],Ce[be],ve):z[be];D?(L.copy(k.normals[0]).multiplyScalar(De.x),O.copy(k.binormals[0]).multiplyScalar(De.y),P.copy(S[0]).add(L).add(O),Fe(P.x,P.y,P.z)):Fe(De.x,De.y,0)}for(let be=1;be<=f;be++)for(let De=0;De<q;De++){const Te=h?Y(z[De],Ce[De],ve):z[De];D?(L.copy(k.normals[be]).multiplyScalar(Te.x),O.copy(k.binormals[be]).multiplyScalar(Te.y),P.copy(S[be]).add(L).add(O),Fe(P.x,P.y,P.z)):Fe(Te.x,Te.y,m/f*be)}for(let be=w-1;be>=0;be--){const De=be/w,Te=_*Math.cos(De*Math.PI/2),ge=b*Math.sin(De*Math.PI/2)+v;for(let Ee=0,Ie=H.length;Ee<Ie;Ee++){const Be=Y(H[Ee],te[Ee],ge);Fe(Be.x,Be.y,m+Te)}for(let Ee=0,Ie=K.length;Ee<Ie;Ee++){const Be=K[Ee];oe=ie[Ee];for(let Oe=0,ue=Be.length;Oe<ue;Oe++){const re=Y(Be[Oe],oe[Oe],ge);D?Fe(re.x,re.y+S[f-1].y,S[f-1].x+Te):Fe(re.x,re.y,m+Te)}}}we(),Se();function we(){const be=o.length/3;if(h){let De=0,Te=q*De;for(let ge=0;ge<J;ge++){const Ee=V[ge];$e(Ee[2]+Te,Ee[1]+Te,Ee[0]+Te)}De=f+w*2,Te=q*De;for(let ge=0;ge<J;ge++){const Ee=V[ge];$e(Ee[0]+Te,Ee[1]+Te,Ee[2]+Te)}}else{for(let De=0;De<J;De++){const Te=V[De];$e(Te[2],Te[1],Te[0])}for(let De=0;De<J;De++){const Te=V[De];$e(Te[0]+q*f,Te[1]+q*f,Te[2]+q*f)}}r.addGroup(be,o.length/3-be,0)}function Se(){const be=o.length/3;let De=0;Re(H,De),De+=H.length;for(let Te=0,ge=K.length;Te<ge;Te++){const Ee=K[Te];Re(Ee,De),De+=Ee.length}r.addGroup(be,o.length/3-be,1)}function Re(be,De){let Te=be.length;for(;--Te>=0;){const ge=Te;let Ee=Te-1;Ee<0&&(Ee=be.length-1);for(let Ie=0,Be=f+w*2;Ie<Be;Ie++){const Oe=q*Ie,ue=q*(Ie+1),re=De+ge+Oe,ke=De+Ee+Oe,We=De+Ee+ue,Xe=De+ge+ue;Ue(re,ke,We,Xe)}}}function Fe(be,De,Te){d.push(be),d.push(De),d.push(Te)}function $e(be,De,Te){qe(be),qe(De),qe(Te);const ge=o.length/3,Ee=M.generateTopUV(r,o,ge-3,ge-2,ge-1);_e(Ee[0]),_e(Ee[1]),_e(Ee[2])}function Ue(be,De,Te,ge){qe(be),qe(De),qe(ge),qe(De),qe(Te),qe(ge);const Ee=o.length/3,Ie=M.generateSideWallUV(r,o,Ee-6,Ee-3,Ee-2,Ee-1);_e(Ie[0]),_e(Ie[1]),_e(Ie[3]),_e(Ie[1]),_e(Ie[2]),_e(Ie[3])}function qe(be){o.push(d[be*3+0]),o.push(d[be*3+1]),o.push(d[be*3+2])}function _e(be){l.push(be.x),l.push(be.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return toJSON$1(i,r,e)}static fromJSON(e,i){const r=[];for(let l=0,a=e.shapes.length;l<a;l++){const c=i[e.shapes[l]];r.push(c)}const o=e.options.extrudePath;return o!==void 0&&(e.options.extrudePath=new Curves[o.type]().fromJSON(o)),new ExtrudeGeometry(r,e.options)}}const WorldUVGenerator={generateTopUV:function(s,e,i,r,o){const l=e[i*3],a=e[i*3+1],c=e[r*3],d=e[r*3+1],u=e[o*3],f=e[o*3+1];return[new Vector2(l,a),new Vector2(c,d),new Vector2(u,f)]},generateSideWallUV:function(s,e,i,r,o,l){const a=e[i*3],c=e[i*3+1],d=e[i*3+2],u=e[r*3],f=e[r*3+1],m=e[r*3+2],h=e[o*3],_=e[o*3+1],b=e[o*3+2],v=e[l*3],w=e[l*3+1],y=e[l*3+2];return Math.abs(c-f)<Math.abs(a-u)?[new Vector2(a,1-d),new Vector2(u,1-m),new Vector2(h,1-b),new Vector2(v,1-y)]:[new Vector2(c,1-d),new Vector2(f,1-m),new Vector2(_,1-b),new Vector2(w,1-y)]}};function toJSON$1(s,e,i){if(i.shapes=[],Array.isArray(s))for(let r=0,o=s.length;r<o;r++){const l=s[r];i.shapes.push(l.uuid)}else i.shapes.push(s.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class IcosahedronGeometry extends PolyhedronGeometry{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,o=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],l=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(o,l,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new IcosahedronGeometry(e.radius,e.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(e=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,o,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new OctahedronGeometry(e.radius,e.detail)}}class RingGeometry extends BufferGeometry{constructor(e=.5,i=1,r=32,o=1,l=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:r,phiSegments:o,thetaStart:l,thetaLength:a},r=Math.max(3,r),o=Math.max(1,o);const c=[],d=[],u=[],f=[];let m=e;const h=(i-e)/o,_=new Vector3,b=new Vector2;for(let v=0;v<=o;v++){for(let w=0;w<=r;w++){const y=l+w/r*a;_.x=m*Math.cos(y),_.y=m*Math.sin(y),d.push(_.x,_.y,_.z),u.push(0,0,1),b.x=(_.x/i+1)/2,b.y=(_.y/i+1)/2,f.push(b.x,b.y)}m+=h}for(let v=0;v<o;v++){const w=v*(r+1);for(let y=0;y<r;y++){const M=y+w,S=M,D=M+r+1,k=M+r+2,O=M+1;c.push(S,D,O),c.push(D,k,O)}}this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(e=new Shape([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const r=[],o=[],l=[],a=[];let c=0,d=0;if(Array.isArray(e)===!1)u(e);else for(let f=0;f<e.length;f++)u(e[f]),this.addGroup(c,d,f),c+=d,d=0;this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2));function u(f){const m=o.length/3,h=f.extractPoints(i);let _=h.shape;const b=h.holes;ShapeUtils.isClockWise(_)===!1&&(_=_.reverse());for(let w=0,y=b.length;w<y;w++){const M=b[w];ShapeUtils.isClockWise(M)===!0&&(b[w]=M.reverse())}const v=ShapeUtils.triangulateShape(_,b);for(let w=0,y=b.length;w<y;w++){const M=b[w];_=_.concat(M)}for(let w=0,y=_.length;w<y;w++){const M=_[w];o.push(M.x,M.y,0),l.push(0,0,1),a.push(M.x,M.y)}for(let w=0,y=v.length;w<y;w++){const M=v[w],S=M[0]+m,D=M[1]+m,k=M[2]+m;r.push(S,D,k),d+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return toJSON(i,e)}static fromJSON(e,i){const r=[];for(let o=0,l=e.shapes.length;o<l;o++){const a=i[e.shapes[o]];r.push(a)}return new ShapeGeometry(r,e.curveSegments)}}function toJSON(s,e){if(e.shapes=[],Array.isArray(s))for(let i=0,r=s.length;i<r;i++){const o=s[i];e.shapes.push(o.uuid)}else e.shapes.push(s.uuid);return e}class SphereGeometry extends BufferGeometry{constructor(e=1,i=32,r=16,o=0,l=Math.PI*2,a=0,c=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:r,phiStart:o,phiLength:l,thetaStart:a,thetaLength:c},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const d=Math.min(a+c,Math.PI);let u=0;const f=[],m=new Vector3,h=new Vector3,_=[],b=[],v=[],w=[];for(let y=0;y<=r;y++){const M=[],S=y/r;let D=0;y===0&&a===0?D=.5/i:y===r&&d===Math.PI&&(D=-.5/i);for(let k=0;k<=i;k++){const O=k/i;m.x=-e*Math.cos(o+O*l)*Math.sin(a+S*c),m.y=e*Math.cos(a+S*c),m.z=e*Math.sin(o+O*l)*Math.sin(a+S*c),b.push(m.x,m.y,m.z),h.copy(m).normalize(),v.push(h.x,h.y,h.z),w.push(O+D,1-S),M.push(u++)}f.push(M)}for(let y=0;y<r;y++)for(let M=0;M<i;M++){const S=f[y][M+1],D=f[y][M],k=f[y+1][M],O=f[y+1][M+1];(y!==0||a>0)&&_.push(S,D,O),(y!==r-1||d<Math.PI)&&_.push(D,k,O)}this.setIndex(_),this.setAttribute("position",new Float32BufferAttribute(b,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(w,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(e=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],o=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,o,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new TetrahedronGeometry(e.radius,e.detail)}}class TorusGeometry extends BufferGeometry{constructor(e=1,i=.4,r=12,o=48,l=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:r,tubularSegments:o,arc:l},r=Math.floor(r),o=Math.floor(o);const a=[],c=[],d=[],u=[],f=new Vector3,m=new Vector3,h=new Vector3;for(let _=0;_<=r;_++)for(let b=0;b<=o;b++){const v=b/o*l,w=_/r*Math.PI*2;m.x=(e+i*Math.cos(w))*Math.cos(v),m.y=(e+i*Math.cos(w))*Math.sin(v),m.z=i*Math.sin(w),c.push(m.x,m.y,m.z),f.x=e*Math.cos(v),f.y=e*Math.sin(v),h.subVectors(m,f).normalize(),d.push(h.x,h.y,h.z),u.push(b/o),u.push(_/r)}for(let _=1;_<=r;_++)for(let b=1;b<=o;b++){const v=(o+1)*_+b-1,w=(o+1)*(_-1)+b-1,y=(o+1)*(_-1)+b,M=(o+1)*_+b;a.push(v,w,M),a.push(w,y,M)}this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(c,3)),this.setAttribute("normal",new Float32BufferAttribute(d,3)),this.setAttribute("uv",new Float32BufferAttribute(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(e=1,i=.4,r=64,o=8,l=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:r,radialSegments:o,p:l,q:a},r=Math.floor(r),o=Math.floor(o);const c=[],d=[],u=[],f=[],m=new Vector3,h=new Vector3,_=new Vector3,b=new Vector3,v=new Vector3,w=new Vector3,y=new Vector3;for(let S=0;S<=r;++S){const D=S/r*l*Math.PI*2;M(D,l,a,e,_),M(D+.01,l,a,e,b),w.subVectors(b,_),y.addVectors(b,_),v.crossVectors(w,y),y.crossVectors(v,w),v.normalize(),y.normalize();for(let k=0;k<=o;++k){const O=k/o*Math.PI*2,L=-i*Math.cos(O),P=i*Math.sin(O);m.x=_.x+(L*y.x+P*v.x),m.y=_.y+(L*y.y+P*v.y),m.z=_.z+(L*y.z+P*v.z),d.push(m.x,m.y,m.z),h.subVectors(m,_).normalize(),u.push(h.x,h.y,h.z),f.push(S/r),f.push(k/o)}}for(let S=1;S<=r;S++)for(let D=1;D<=o;D++){const k=(o+1)*(S-1)+(D-1),O=(o+1)*S+(D-1),L=(o+1)*S+D,P=(o+1)*(S-1)+D;c.push(k,O,P),c.push(O,L,P)}this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2));function M(S,D,k,O,L){const P=Math.cos(S),N=Math.sin(S),z=k/D*S,K=Math.cos(z);L.x=O*(2+K)*.5*P,L.y=O*(2+K)*N*.5,L.z=O*Math.sin(z)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TorusKnotGeometry(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class TubeGeometry extends BufferGeometry{constructor(e=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),i=64,r=1,o=8,l=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:r,radialSegments:o,closed:l};const a=e.computeFrenetFrames(i,l);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const c=new Vector3,d=new Vector3,u=new Vector2;let f=new Vector3;const m=[],h=[],_=[],b=[];v(),this.setIndex(b),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2));function v(){for(let S=0;S<i;S++)w(S);w(l===!1?i:0),M(),y()}function w(S){f=e.getPointAt(S/i,f);const D=a.normals[S],k=a.binormals[S];for(let O=0;O<=o;O++){const L=O/o*Math.PI*2,P=Math.sin(L),N=-Math.cos(L);d.x=N*D.x+P*k.x,d.y=N*D.y+P*k.y,d.z=N*D.z+P*k.z,d.normalize(),h.push(d.x,d.y,d.z),c.x=f.x+r*d.x,c.y=f.y+r*d.y,c.z=f.z+r*d.z,m.push(c.x,c.y,c.z)}}function y(){for(let S=1;S<=i;S++)for(let D=1;D<=o;D++){const k=(o+1)*(S-1)+(D-1),O=(o+1)*S+(D-1),L=(o+1)*S+D,P=(o+1)*(S-1)+D;b.push(k,O,P),b.push(O,L,P)}}function M(){for(let S=0;S<=i;S++)for(let D=0;D<=o;D++)u.x=S/i,u.y=D/o,_.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new TubeGeometry(new Curves[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class WireframeGeometry extends BufferGeometry{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],r=new Set,o=new Vector3,l=new Vector3;if(e.index!==null){const a=e.attributes.position,c=e.index;let d=e.groups;d.length===0&&(d=[{start:0,count:c.count,materialIndex:0}]);for(let u=0,f=d.length;u<f;++u){const m=d[u],h=m.start,_=m.count;for(let b=h,v=h+_;b<v;b+=3)for(let w=0;w<3;w++){const y=c.getX(b+w),M=c.getX(b+(w+1)%3);o.fromBufferAttribute(a,y),l.fromBufferAttribute(a,M),isUniqueEdge(o,l,r)===!0&&(i.push(o.x,o.y,o.z),i.push(l.x,l.y,l.z))}}}else{const a=e.attributes.position;for(let c=0,d=a.count/3;c<d;c++)for(let u=0;u<3;u++){const f=3*c+u,m=3*c+(u+1)%3;o.fromBufferAttribute(a,f),l.fromBufferAttribute(a,m),isUniqueEdge(o,l,r)===!0&&(i.push(o.x,o.y,o.z),i.push(l.x,l.y,l.z))}}this.setAttribute("position",new Float32BufferAttribute(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function isUniqueEdge(s,e,i){const r=`${s.x},${s.y},${s.z}-${e.x},${e.y},${e.z}`,o=`${e.x},${e.y},${e.z}-${s.x},${s.y},${s.z}`;return i.has(r)===!0||i.has(o)===!0?!1:(i.add(r),i.add(o),!0)}const Geometries=Object.freeze(Object.defineProperty({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry},Symbol.toStringTag,{value:"Module"}));class ShadowMaterial extends Material{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MeshToonMaterial extends Material{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class MeshNormalMaterial extends Material{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class MeshLambertMaterial extends Material{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MeshMatcapMaterial extends Material{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function convertArray(s,e,i){return!s||!i&&s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function isTypedArray(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function getKeyframeOrder(s){function e(o,l){return s[o]-s[l]}const i=s.length,r=new Array(i);for(let o=0;o!==i;++o)r[o]=o;return r.sort(e),r}function sortedArray(s,e,i){const r=s.length,o=new s.constructor(r);for(let l=0,a=0;a!==r;++l){const c=i[l]*e;for(let d=0;d!==e;++d)o[a++]=s[c+d]}return o}function flattenJSON(s,e,i,r){let o=1,l=s[0];for(;l!==void 0&&l[r]===void 0;)l=s[o++];if(l===void 0)return;let a=l[r];if(a!==void 0)if(Array.isArray(a))do a=l[r],a!==void 0&&(e.push(l.time),i.push.apply(i,a)),l=s[o++];while(l!==void 0);else if(a.toArray!==void 0)do a=l[r],a!==void 0&&(e.push(l.time),a.toArray(i,i.length)),l=s[o++];while(l!==void 0);else do a=l[r],a!==void 0&&(e.push(l.time),i.push(a)),l=s[o++];while(l!==void 0)}function subclip(s,e,i,r,o=30){const l=s.clone();l.name=e;const a=[];for(let d=0;d<l.tracks.length;++d){const u=l.tracks[d],f=u.getValueSize(),m=[],h=[];for(let _=0;_<u.times.length;++_){const b=u.times[_]*o;if(!(b<i||b>=r)){m.push(u.times[_]);for(let v=0;v<f;++v)h.push(u.values[_*f+v])}}m.length!==0&&(u.times=convertArray(m,u.times.constructor),u.values=convertArray(h,u.values.constructor),a.push(u))}l.tracks=a;let c=1/0;for(let d=0;d<l.tracks.length;++d)c>l.tracks[d].times[0]&&(c=l.tracks[d].times[0]);for(let d=0;d<l.tracks.length;++d)l.tracks[d].shift(-1*c);return l.resetDuration(),l}function makeClipAdditive(s,e=0,i=s,r=30){r<=0&&(r=30);const o=i.tracks.length,l=e/r;for(let a=0;a<o;++a){const c=i.tracks[a],d=c.ValueTypeName;if(d==="bool"||d==="string")continue;const u=s.tracks.find(function(y){return y.name===c.name&&y.ValueTypeName===d});if(u===void 0)continue;let f=0;const m=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=m/3);let h=0;const _=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=_/3);const b=c.times.length-1;let v;if(l<=c.times[0]){const y=f,M=m-f;v=c.values.slice(y,M)}else if(l>=c.times[b]){const y=b*m+f,M=y+m-f;v=c.values.slice(y,M)}else{const y=c.createInterpolant(),M=f,S=m-f;y.evaluate(l),v=y.resultBuffer.slice(M,S)}d==="quaternion"&&new Quaternion().fromArray(v).normalize().conjugate().toArray(v);const w=u.times.length;for(let y=0;y<w;++y){const M=y*_+h;if(d==="quaternion")Quaternion.multiplyQuaternionsFlat(u.values,M,v,0,u.values,M);else{const S=_-h*2;for(let D=0;D<S;++D)u.values[M+D]-=v[D]}}}return s.blendMode=AdditiveAnimationBlendMode,s}const AnimationUtils={convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(e,i,r,o){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=o!==void 0?o:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let r=this._cachedIndex,o=i[r],l=i[r-1];e:{t:{let a;i:{n:if(!(e<o)){for(let c=r+2;;){if(o===void 0){if(e<l)break n;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===c)break;if(l=o,o=i[++r],e<o)break t}a=i.length;break i}if(!(e>=l)){const c=i[1];e<c&&(r=2,l=c);for(let d=r-2;;){if(l===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===d)break;if(o=l,l=i[--r-1],e>=l)break t}a=r,r=0;break i}break e}for(;r<a;){const c=r+a>>>1;e<i[c]?a=c:r=c+1}if(o=i[r],l=i[r-1],l===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(o===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,l,o)}return this.interpolate_(r,l,e,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,r=this.sampleValues,o=this.valueSize,l=e*o;for(let a=0;a!==o;++a)i[a]=r[l+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(e,i,r,o){super(e,i,r,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(e,i,r){const o=this.parameterPositions;let l=e-2,a=e+1,c=o[l],d=o[a];if(c===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:l=e,c=2*i-r;break;case WrapAroundEnding:l=o.length-2,c=i+o[l]-o[l+1];break;default:l=e,c=r}if(d===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:a=e,d=2*r-i;break;case WrapAroundEnding:a=1,d=r+o[1]-o[0];break;default:a=e-1,d=i}const u=(r-i)*.5,f=this.valueSize;this._weightPrev=u/(i-c),this._weightNext=u/(d-r),this._offsetPrev=l*f,this._offsetNext=a*f}interpolate_(e,i,r,o){const l=this.resultBuffer,a=this.sampleValues,c=this.valueSize,d=e*c,u=d-c,f=this._offsetPrev,m=this._offsetNext,h=this._weightPrev,_=this._weightNext,b=(r-i)/(o-i),v=b*b,w=v*b,y=-h*w+2*h*v-h*b,M=(1+h)*w+(-1.5-2*h)*v+(-.5+h)*b+1,S=(-1-_)*w+(1.5+_)*v+.5*b,D=_*w-_*v;for(let k=0;k!==c;++k)l[k]=y*a[f+k]+M*a[u+k]+S*a[d+k]+D*a[m+k];return l}}class LinearInterpolant extends Interpolant{constructor(e,i,r,o){super(e,i,r,o)}interpolate_(e,i,r,o){const l=this.resultBuffer,a=this.sampleValues,c=this.valueSize,d=e*c,u=d-c,f=(r-i)/(o-i),m=1-f;for(let h=0;h!==c;++h)l[h]=a[u+h]*m+a[d+h]*f;return l}}class DiscreteInterpolant extends Interpolant{constructor(e,i,r,o){super(e,i,r,o)}interpolate_(e){return this.copySampleValue_(e-1)}}class KeyframeTrack{constructor(e,i,r,o){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=convertArray(i,this.TimeBufferType),this.values=convertArray(r,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(e);else{r={name:e.name,times:convertArray(e.times,Array),values:convertArray(e.values,Array)};const o=e.getInterpolation();o!==e.DefaultInterpolation&&(r.interpolation=o)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case InterpolateDiscrete:i=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:i=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let r=0,o=i.length;r!==o;++r)i[r]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let r=0,o=i.length;r!==o;++r)i[r]*=e}return this}trim(e,i){const r=this.times,o=r.length;let l=0,a=o-1;for(;l!==o&&r[l]<e;)++l;for(;a!==-1&&r[a]>i;)--a;if(++a,l!==0||a!==o){l>=a&&(a=Math.max(a,1),l=a-1);const c=this.getValueSize();this.times=r.slice(l,a),this.values=this.values.slice(l*c,a*c)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,o=this.values,l=r.length;l===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let c=0;c!==l;c++){const d=r[c];if(typeof d=="number"&&isNaN(d)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,c,d),e=!1;break}if(a!==null&&a>d){console.error("THREE.KeyframeTrack: Out of order keys.",this,c,d,a),e=!1;break}a=d}if(o!==void 0&&isTypedArray(o))for(let c=0,d=o.length;c!==d;++c){const u=o[c];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),o=this.getInterpolation()===InterpolateSmooth,l=e.length-1;let a=1;for(let c=1;c<l;++c){let d=!1;const u=e[c],f=e[c+1];if(u!==f&&(c!==1||u!==e[0]))if(o)d=!0;else{const m=c*r,h=m-r,_=m+r;for(let b=0;b!==r;++b){const v=i[m+b];if(v!==i[h+b]||v!==i[_+b]){d=!0;break}}}if(d){if(c!==a){e[a]=e[c];const m=c*r,h=a*r;for(let _=0;_!==r;++_)i[h+_]=i[m+_]}++a}}if(l>0){e[a]=e[l];for(let c=l*r,d=a*r,u=0;u!==r;++u)i[d+u]=i[c+u];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*r)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),r=this.constructor,o=new r(this.name,e,i);return o.createInterpolant=this.createInterpolant,o}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(e,i,r){super(e,i,r)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(e,i,r,o){super(e,i,r,o)}interpolate_(e,i,r,o){const l=this.resultBuffer,a=this.sampleValues,c=this.valueSize,d=(r-i)/(o-i);let u=e*c;for(let f=u+c;u!==f;u+=4)Quaternion.slerpFlat(l,0,a,u-c,a,u,d);return l}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(e,i,r){super(e,i,r)}}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(e="",i=-1,r=[],o=NormalAnimationBlendMode){this.name=e,this.tracks=r,this.duration=i,this.blendMode=o,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],r=e.tracks,o=1/(e.fps||1);for(let a=0,c=r.length;a!==c;++a)i.push(parseKeyframeTrack(r[a]).scale(o));const l=new this(e.name,e.duration,i,e.blendMode);return l.uuid=e.uuid,l}static toJSON(e){const i=[],r=e.tracks,o={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let l=0,a=r.length;l!==a;++l)i.push(KeyframeTrack.toJSON(r[l]));return o}static CreateFromMorphTargetSequence(e,i,r,o){const l=i.length,a=[];for(let c=0;c<l;c++){let d=[],u=[];d.push((c+l-1)%l,c,(c+1)%l),u.push(0,1,0);const f=getKeyframeOrder(d);d=sortedArray(d,1,f),u=sortedArray(u,1,f),!o&&d[0]===0&&(d.push(l),u.push(u[0])),a.push(new NumberKeyframeTrack(".morphTargetInfluences["+i[c].name+"]",d,u).scale(1/r))}return new this(e,-1,a)}static findByName(e,i){let r=e;if(!Array.isArray(e)){const o=e;r=o.geometry&&o.geometry.animations||o.animations}for(let o=0;o<r.length;o++)if(r[o].name===i)return r[o];return null}static CreateClipsFromMorphTargetSequences(e,i,r){const o={},l=/^([\w-]*?)([\d]+)$/;for(let c=0,d=e.length;c<d;c++){const u=e[c],f=u.name.match(l);if(f&&f.length>1){const m=f[1];let h=o[m];h||(o[m]=h=[]),h.push(u)}}const a=[];for(const c in o)a.push(this.CreateFromMorphTargetSequence(c,o[c],i,r));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(m,h,_,b,v){if(_.length!==0){const w=[],y=[];flattenJSON(_,w,y,b),w.length!==0&&v.push(new m(h,w,y))}},o=[],l=e.name||"default",a=e.fps||30,c=e.blendMode;let d=e.length||-1;const u=e.hierarchy||[];for(let m=0;m<u.length;m++){const h=u[m].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const _={};let b;for(b=0;b<h.length;b++)if(h[b].morphTargets)for(let v=0;v<h[b].morphTargets.length;v++)_[h[b].morphTargets[v]]=-1;for(const v in _){const w=[],y=[];for(let M=0;M!==h[b].morphTargets.length;++M){const S=h[b];w.push(S.time),y.push(S.morphTarget===v?1:0)}o.push(new NumberKeyframeTrack(".morphTargetInfluence["+v+"]",w,y))}d=_.length*a}else{const _=".bones["+i[m].name+"]";r(VectorKeyframeTrack,_+".position",h,"pos",o),r(QuaternionKeyframeTrack,_+".quaternion",h,"rot",o),r(VectorKeyframeTrack,_+".scale",h,"scl",o)}}return o.length===0?null:new this(l,d,o,c)}resetDuration(){const e=this.tracks;let i=0;for(let r=0,o=e.length;r!==o;++r){const l=this.tracks[r];i=Math.max(i,l.times[l.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function parseKeyframeTrack(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=getTrackTypeForValueTypeName(s.type);if(s.times===void 0){const i=[],r=[];flattenJSON(s.keys,i,r,"value"),s.times=i,s.values=r}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const Cache={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class LoadingManager{constructor(e,i,r){const o=this;let l=!1,a=0,c=0,d;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(f){c++,l===!1&&o.onStart!==void 0&&o.onStart(f,a,c),l=!0},this.itemEnd=function(f){a++,o.onProgress!==void 0&&o.onProgress(f,a,c),a===c&&(l=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(f){o.onError!==void 0&&o.onError(f)},this.resolveURL=function(f){return d?d(f):f},this.setURLModifier=function(f){return d=f,this},this.addHandler=function(f,m){return u.push(f,m),this},this.removeHandler=function(f){const m=u.indexOf(f);return m!==-1&&u.splice(m,2),this},this.getHandler=function(f){for(let m=0,h=u.length;m<h;m+=2){const _=u[m],b=u[m+1];if(_.global&&(_.lastIndex=0),_.test(f))return b}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(e){this.manager=e!==void 0?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const r=this;return new Promise(function(o,l){r.load(e,o,i,l)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(e,i){super(e),this.response=i}}class FileLoader extends Loader{constructor(e,i={}){super(e),this.params={file_system:"external_io"},i&&Object.assign(this.params,i)}load(e,i,r,o){const l=this,a=window.is_data_url(e),c=l.params.file_system;if(window.external_io&&a==!1&&c=="external_io"){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const d=Cache.get(e);if(d!=null)return l.manager.itemStart(e),setTimeout(function(){i&&i(d),l.manager.itemEnd(e)},0),d;window.external_io.get(e).then(f=>{let m;const h=(l.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":const _=f;if(h==="blob"){const v="application/octet-stream";m=new Blob([_.buffer],{type:v})}else _?.buffer instanceof ArrayBuffer?m=_.buffer:_ instanceof ArrayBuffer&&(m=_);break;case"document":console.error("Deprecated");break;case"json":const b=new TextDecoder().decode(f);m=JSON.parse(b);break;case"text":m=new TextDecoder().decode(f);break;default:m=f;break}Cache.add(e,m),i&&i(m),l.manager.itemEnd(e)}).catch(f=>{o&&o(f),l.manager.itemError(e),l.manager.itemEnd(e)})}else{if(window.nodejs&&!window.external_io&&a==!1&&c=="system_resource"){e=l.manager.resolveURL(e);const d=Cache.get(e);if(d!=null)return l.manager.itemStart(e),setTimeout(function(){i&&i(d),l.manager.itemEnd(e)},0),d;const u=window.nodejs;try{const f=u.fs.readFileSync(e);Cache.add(e,f),i&&i(f),l.manager.itemEnd(e)}catch(f){console.error("FileLoader: ",f),o(f)}l.manager.itemEnd(e);return}return this._load_(e,i,r,o)}}_load_(e,i,r,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=Cache.get(e);if(l!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(l),this.manager.itemEnd(e)},0),l;if(loading[e]!==void 0){loading[e].push({onLoad:i,onProgress:r,onError:o});return}loading[e]=[],loading[e].push({onLoad:i,onProgress:r,onError:o});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),c=this.mimeType,d=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const f=loading[e],m=u.body.getReader(),h=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),_=h?parseInt(h):0,b=_!==0;let v=0;const w=new ReadableStream({start(y){M();function M(){m.read().then(({done:S,value:D})=>{if(S)y.close();else{v+=D.byteLength;const k=new ProgressEvent("progress",{lengthComputable:b,loaded:v,total:_});for(let O=0,L=f.length;O<L;O++){const P=f[O];P.onProgress&&P.onProgress(k)}y.enqueue(D),M()}},S=>{y.error(S)})}}});return new Response(w)}else throw new HttpError(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(d){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(f=>new DOMParser().parseFromString(f,c));case"json":return u.json();default:if(c===void 0)return u.text();{const m=/charset="?([^;"\s]*)"?/i.exec(c),h=m&&m[1]?m[1].toLowerCase():void 0,_=new TextDecoder(h);return u.arrayBuffer().then(b=>_.decode(b))}}}).then(u=>{Cache.add(e,u);const f=loading[e];delete loading[e];for(let m=0,h=f.length;m<h;m++){const _=f[m];_.onLoad&&_.onLoad(u)}}).catch(u=>{const f=loading[e];if(f===void 0)throw this.manager.itemError(e),u;delete loading[e];for(let m=0,h=f.length;m<h;m++){const _=f[m];_.onError&&_.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class AnimationLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=this,a=new FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{i(l.parse(JSON.parse(c)))}catch(d){o?o(d):console.error(d),l.manager.itemError(e)}},r,o)}parse(e){const i=[];for(let r=0;r<e.length;r++){const o=AnimationClip.parse(e[r]);i.push(o)}return i}}class CompressedTextureLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=this,a=[],c=new CompressedTexture,d=new FileLoader(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(l.withCredentials);let u=0;function f(m){d.load(e[m],function(h){const _=l.parse(h,!0);a[m]={width:_.width,height:_.height,format:_.format,mipmaps:_.mipmaps},u+=1,u===6&&(_.mipmapCount===1&&(c.minFilter=LinearFilter),c.image=a,c.format=_.format,c.needsUpdate=!0,i&&i(c))},r,o)}if(Array.isArray(e))for(let m=0,h=e.length;m<h;++m)f(m);else d.load(e,function(m){const h=l.parse(m,!0);if(h.isCubemap){const _=h.mipmaps.length/h.mipmapCount;for(let b=0;b<_;b++){a[b]={mipmaps:[]};for(let v=0;v<h.mipmapCount;v++)a[b].mipmaps.push(h.mipmaps[b*h.mipmapCount+v]),a[b].format=h.format,a[b].width=h.width,a[b].height=h.height}c.image=a}else c.image.width=h.width,c.image.height=h.height,c.mipmaps=h.mipmaps;h.mipmapCount===1&&(c.minFilter=LinearFilter),c.format=h.format,c.needsUpdate=!0,i&&i(c)},r,o);return c}}class ImageLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=window.is_data_url(e),a=this;let c=null;if(l||(this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e),c=Cache.get(e)),c!=null)return l||a.manager.itemStart(e),setTimeout(function(){i&&i(c),l||a.manager.itemEnd(e)},0),c;const d=new Image;function u(){m(),l||Cache.add(e,this),i&&i(this),l||a.manager.itemEnd(e)}function f(b){window.terminal_error&&window.terminal_error("Fail to load:",e),m(),o&&o(b),l||(a.manager.itemError(e),a.manager.itemEnd(e))}function m(){d.removeEventListener("load",u,!1),d.removeEventListener("error",f,!1)}d.addEventListener("load",u,!1),d.addEventListener("error",f,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(d.crossOrigin=this.crossOrigin),l||a.manager.itemStart(e);function h(b){function v(Ue){switch(Ue.image_type){case N:case Z:(Ue.colormap_length>256||Ue.colormap_size!==24||Ue.colormap_type!==1)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case z:case K:case V:case H:Ue.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case P:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',Ue.image_type)}(Ue.width<=0||Ue.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),Ue.pixel_size!==8&&Ue.pixel_size!==16&&Ue.pixel_size!==24&&Ue.pixel_size!==32&&console.error('THREE.TGALoader: Invalid pixel size "%s".',Ue.pixel_size)}function w(Ue,qe,_e,be,De){let Te,ge;const Ee=_e.pixel_size>>3,Ie=_e.width*_e.height*Ee;if(qe&&(ge=De.subarray(be,be+=_e.colormap_length*(_e.colormap_size>>3))),Ue){Te=new Uint8Array(Ie);let Be,Oe,ue,re=0;const ke=new Uint8Array(Ee);for(;re<Ie;)if(Be=De[be++],Oe=(Be&127)+1,Be&128){for(ue=0;ue<Ee;++ue)ke[ue]=De[be++];for(ue=0;ue<Oe;++ue)Te.set(ke,re+ue*Ee);re+=Ee*Oe}else{for(Oe*=Ee,ue=0;ue<Oe;++ue)Te[re+ue]=De[be++];re+=Oe}}else Te=De.subarray(be,be+=qe?_e.width*_e.height:Ie);return{pixel_data:Te,palettes:ge}}function y(Ue,qe,_e,be,De,Te,ge,Ee,Ie){const Be=Ie;let Oe,ue=0,re,ke;const We=ve.width;for(ke=qe;ke!==be;ke+=_e)for(re=De;re!==ge;re+=Te,ue++)Oe=Ee[ue],Ue[(re+We*ke)*4+3]=255,Ue[(re+We*ke)*4+2]=Be[Oe*3+0],Ue[(re+We*ke)*4+1]=Be[Oe*3+1],Ue[(re+We*ke)*4+0]=Be[Oe*3+2];return Ue}function M(Ue,qe,_e,be,De,Te,ge,Ee){let Ie,Be=0,Oe,ue;const re=ve.width;for(ue=qe;ue!==be;ue+=_e)for(Oe=De;Oe!==ge;Oe+=Te,Be+=2)Ie=Ee[Be+0]+(Ee[Be+1]<<8),Ue[(Oe+re*ue)*4+0]=(Ie&31744)>>7,Ue[(Oe+re*ue)*4+1]=(Ie&992)>>2,Ue[(Oe+re*ue)*4+2]=(Ie&31)>>3,Ue[(Oe+re*ue)*4+3]=Ie&32768?0:255;return Ue}function S(Ue,qe,_e,be,De,Te,ge,Ee){let Ie=0,Be,Oe;const ue=ve.width;for(Oe=qe;Oe!==be;Oe+=_e)for(Be=De;Be!==ge;Be+=Te,Ie+=3)Ue[(Be+ue*Oe)*4+3]=255,Ue[(Be+ue*Oe)*4+2]=Ee[Ie+0],Ue[(Be+ue*Oe)*4+1]=Ee[Ie+1],Ue[(Be+ue*Oe)*4+0]=Ee[Ie+2];return Ue}function D(Ue,qe,_e,be,De,Te,ge,Ee){let Ie=0,Be,Oe;const ue=ve.width;for(Oe=qe;Oe!==be;Oe+=_e)for(Be=De;Be!==ge;Be+=Te,Ie+=4)Ue[(Be+ue*Oe)*4+2]=Ee[Ie+0],Ue[(Be+ue*Oe)*4+1]=Ee[Ie+1],Ue[(Be+ue*Oe)*4+0]=Ee[Ie+2],Ue[(Be+ue*Oe)*4+3]=Ee[Ie+3];return Ue}function k(Ue,qe,_e,be,De,Te,ge,Ee){let Ie,Be=0,Oe,ue;const re=ve.width;for(ue=qe;ue!==be;ue+=_e)for(Oe=De;Oe!==ge;Oe+=Te,Be++)Ie=Ee[Be],Ue[(Oe+re*ue)*4+0]=Ie,Ue[(Oe+re*ue)*4+1]=Ie,Ue[(Oe+re*ue)*4+2]=Ie,Ue[(Oe+re*ue)*4+3]=255;return Ue}function O(Ue,qe,_e,be,De,Te,ge,Ee){let Ie=0,Be,Oe;const ue=ve.width;for(Oe=qe;Oe!==be;Oe+=_e)for(Be=De;Be!==ge;Be+=Te,Ie+=2)Ue[(Be+ue*Oe)*4+0]=Ee[Ie+0],Ue[(Be+ue*Oe)*4+1]=Ee[Ie+0],Ue[(Be+ue*Oe)*4+2]=Ee[Ie+0],Ue[(Be+ue*Oe)*4+3]=Ee[Ie+1];return Ue}function L(Ue,qe,_e,be,De){let Te,ge,Ee,Ie,Be,Oe;switch((ve.flags&Y)>>q){default:case te:Te=0,Ee=1,Be=qe,ge=0,Ie=1,Oe=_e;break;case J:Te=0,Ee=1,Be=qe,ge=_e-1,Ie=-1,Oe=-1;break;case ie:Te=qe-1,Ee=-1,Be=-1,ge=0,Ie=1,Oe=_e;break;case W:Te=qe-1,Ee=-1,Be=-1,ge=_e-1,Ie=-1,Oe=-1;break}if(Re)switch(ve.pixel_size){case 8:k(Ue,ge,Ie,Oe,Te,Ee,Be,be);break;case 16:O(Ue,ge,Ie,Oe,Te,Ee,Be,be);break;default:console.error("THREE.TGALoader: Format not supported.");break}else switch(ve.pixel_size){case 8:y(Ue,ge,Ie,Oe,Te,Ee,Be,be,De);break;case 16:M(Ue,ge,Ie,Oe,Te,Ee,Be,be);break;case 24:S(Ue,ge,Ie,Oe,Te,Ee,Be,be);break;case 32:D(Ue,ge,Ie,Oe,Te,Ee,Be,be);break;default:console.error("THREE.TGALoader: Format not supported.");break}return Ue}const P=0,N=1,z=2,K=3,Z=9,V=10,H=11,Y=48,q=4,J=0,W=1,te=2,ie=3;b.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");let oe=0;const Ce=new Uint8Array(b),ve={id_length:Ce[oe++],colormap_type:Ce[oe++],image_type:Ce[oe++],colormap_index:Ce[oe++]|Ce[oe++]<<8,colormap_length:Ce[oe++]|Ce[oe++]<<8,colormap_size:Ce[oe++],origin:[Ce[oe++]|Ce[oe++]<<8,Ce[oe++]|Ce[oe++]<<8],width:Ce[oe++]|Ce[oe++]<<8,height:Ce[oe++]|Ce[oe++]<<8,pixel_size:Ce[oe++],flags:Ce[oe++]};v(ve),ve.id_length+oe>b.length&&console.error("THREE.TGALoader: No data."),oe+=ve.id_length;let we=!1,Se=!1,Re=!1;switch(ve.image_type){case Z:we=!0,Se=!0;break;case N:Se=!0;break;case V:we=!0;break;case z:break;case H:we=!0,Re=!0;break;case K:Re=!0;break}const Fe=new Uint8Array(ve.width*ve.height*4),$e=w(we,Se,ve,oe,Ce);return L(Fe,ve.width,ve.height,$e.pixel_data,$e.palettes),{data:Fe,width:ve.width,height:ve.height}}let _=null;if(l||(_=e.split(".").pop(),_=_.toLowerCase()),!l&&window.external_io)e=e.replace(/\\/g,"/"),window.external_io.get(e).then(b=>{if(_=="tga"){window.debug&&console.log("TGA loader");try{const v=h(b),w=new ImageData(new Uint8ClampedArray(v.data),v.width,v.height),y=document.createElement("canvas"),M=y.getContext("2d");y.width=w.width,y.height=w.height,M.putImageData(w,0,0);const S=function(){window.debug&&console.log("Canvas to data url.",e),d.removeEventListener("load",S,!1),d.removeEventListener("error",D,!1)},D=function(k){console.error(k),d.removeEventListener("load",S,!1),d.removeEventListener("error",D,!1)};d.addEventListener("load",S,!1),d.addEventListener("error",D,!1),d.src=y.toDataURL()}catch(v){console.error(v),f(v)}}else if(_){_=="jpg"&&(_="jpeg"),_=="tif"&&(_="tiff");const v=new Blob([b],{type:"image/"+_}),w=window.URL.createObjectURL(v),y=function(){window.URL.revokeObjectURL(w),d.removeEventListener("load",y,!1),d.removeEventListener("error",M,!1)},M=function(){window.URL.revokeObjectURL(w),d.removeEventListener("load",y,!1),d.removeEventListener("error",M,!1)};d.addEventListener("load",y,!1),d.addEventListener("error",M,!1),d.src=w}else console.error("Unknown Ext: "+_),f(new Error("Unknown Ext: "+_))}).catch(b=>{window.terminal_log&&window.terminal_log(b+" "+e),console.warn(b),f(b),d.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="});else if(_=="tga")try{const b=window.nodejs.fs.readFileSync(e),v=h(b),w=new ImageData(new Uint8ClampedArray(v.data),v.width,v.height),y=document.createElement("canvas"),M=y.getContext("2d");y.width=w.width,y.height=w.height,M.putImageData(w,0,0);const S=function(){window.debug&&console.log("Canvas to data url.",e),d.removeEventListener("load",S,!1),d.removeEventListener("error",D,!1)},D=function(k){console.error(k),d.removeEventListener("load",S,!1),d.removeEventListener("error",D,!1)};d.addEventListener("load",S,!1),d.addEventListener("error",D,!1),d.src=y.toDataURL()}catch(b){console.error(b),f(b)}else d.src=e;return d}_load(e,i,r,o){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,a=Cache.get(e);if(a!==void 0)return l.manager.itemStart(e),setTimeout(function(){i&&i(a),l.manager.itemEnd(e)},0),a;const c=createElementNS("img");function d(){f(),Cache.add(e,this),i&&i(this),l.manager.itemEnd(e)}function u(m){f(),o&&o(m),l.manager.itemError(e),l.manager.itemEnd(e)}function f(){c.removeEventListener("load",d,!1),c.removeEventListener("error",u,!1)}return c.addEventListener("load",d,!1),c.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(c.crossOrigin=this.crossOrigin),l.manager.itemStart(e),c.src=e,c}}class CubeTextureLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=new CubeTexture;l.colorSpace=SRGBColorSpace;const a=new ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let c=0;function d(u){a.load(e[u],function(f){l.images[u]=f,c++,c===6&&(l.needsUpdate=!0,i&&i(l))},void 0,o)}for(let u=0;u<e.length;++u)d(u);return l}}class DataTextureLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=this,a=new DataTexture,c=new FileLoader(this.manager);return c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setPath(this.path),c.setWithCredentials(l.withCredentials),c.load(e,function(d){let u;try{u=l.parse(d)}catch(f){if(o!==void 0)o(f);else{console.error(f);return}}u.image!==void 0?a.image=u.image:u.data!==void 0&&(a.image.width=u.width,a.image.height=u.height,a.image.data=u.data),a.wrapS=u.wrapS!==void 0?u.wrapS:ClampToEdgeWrapping,a.wrapT=u.wrapT!==void 0?u.wrapT:ClampToEdgeWrapping,a.magFilter=u.magFilter!==void 0?u.magFilter:LinearFilter,a.minFilter=u.minFilter!==void 0?u.minFilter:LinearFilter,a.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.colorSpace!==void 0&&(a.colorSpace=u.colorSpace),u.flipY!==void 0&&(a.flipY=u.flipY),u.format!==void 0&&(a.format=u.format),u.type!==void 0&&(a.type=u.type),u.mipmaps!==void 0&&(a.mipmaps=u.mipmaps,a.minFilter=LinearMipmapLinearFilter),u.mipmapCount===1&&(a.minFilter=LinearFilter),u.generateMipmaps!==void 0&&(a.generateMipmaps=u.generateMipmaps),a.needsUpdate=!0,i&&i(a,u)},r,o),a}}class TextureLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=e,a=new Texture;window.is_data_url(e)||(a._source_file_=(this.path+l).replace(/\\/g,"/"));const d=new ImageLoader(this.manager);d.setCrossOrigin(this.crossOrigin),d.setPath(this.path);{const u=this.path+l,f=window.TimeDurationChecker(`TextureLoader:load-N: ${u.slice(0,100).split("/").pop()}`);d.load(u,function(m){a.image=m,a.needsUpdate=!0,i!==void 0&&i(a),f.finish()},r,o)}return a}_load(e,i,r,o){const l=new Texture,a=new ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(c){l.image=c,l.needsUpdate=!0,i!==void 0&&i(l)},r,o),l}}class Light extends Object3D{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}class HemisphereLight extends Light{constructor(e,i,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,r=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(e.matrixWorld),i.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(_lookTarget$1),i.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(_projScreenMatrix$1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,r=RAD2DEG*2*e.angle*this.focus,o=this.mapSize.width/this.mapSize.height,l=e.distance||i.far;(r!==i.fov||o!==i.aspect||l!==i.far)&&(i.fov=r,i.aspect=o,i.far=l,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class SpotLight extends Light{constructor(e,i,r=0,o=Math.PI/3,l=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=r,this.angle=o,this.penumbra=l,this.decay=a,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(e,i=0){const r=this.camera,o=this.matrix,l=e.distance||r.far;l!==r.far&&(r.far=l,r.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(e.matrixWorld),r.position.copy(_lightPositionWorld),_lookTarget.copy(r.position),_lookTarget.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(_lookTarget),r.updateMatrixWorld(),o.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(e,i,r=0,o=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=o,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class AmbientLight extends Light{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(e,i,r=10,o=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=o}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Vector3)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const r=e.x,o=e.y,l=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*o),i.addScaledVector(a[2],.488603*l),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*o)),i.addScaledVector(a[5],1.092548*(o*l)),i.addScaledVector(a[6],.315392*(3*l*l-1)),i.addScaledVector(a[7],1.092548*(r*l)),i.addScaledVector(a[8],.546274*(r*r-o*o)),i}getIrradianceAt(e,i){const r=e.x,o=e.y,l=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*o),i.addScaledVector(a[2],2*.511664*l),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*o),i.addScaledVector(a[5],2*.429043*o*l),i.addScaledVector(a[6],.743125*l*l-.247708),i.addScaledVector(a[7],2*.429043*r*l),i.addScaledVector(a[8],.429043*(r*r-o*o)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const r=this.coefficients;for(let o=0;o<9;o++)r[o].fromArray(e,i+o*3);return this}toArray(e=[],i=0){const r=this.coefficients;for(let o=0;o<9;o++)r[o].toArray(e,i+o*3);return e}static getBasisAt(e,i){const r=e.x,o=e.y,l=e.z;i[0]=.282095,i[1]=.488603*o,i[2]=.488603*l,i[3]=.488603*r,i[4]=1.092548*r*o,i[5]=1.092548*o*l,i[6]=.315392*(3*l*l-1),i[7]=1.092548*r*l,i[8]=.546274*(r*r-o*o)}}class LightProbe extends Light{constructor(e=new SphericalHarmonics3,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class MaterialLoader extends Loader{constructor(e){super(e),this.textures={}}load(e,i,r,o){const l=this,a=new FileLoader(l.manager);a.setPath(l.path),a.setRequestHeader(l.requestHeader),a.setWithCredentials(l.withCredentials),a.load(e,function(c){try{i(l.parse(JSON.parse(c)))}catch(d){o?o(d):console.error(d),l.manager.itemError(e)}},r,o)}parse(e){const i=this.textures;function r(l){return i[l]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",l),i[l]}const o=MaterialLoader.createMaterialFromType(e.type);if(e.uuid!==void 0&&(o.uuid=e.uuid),e.name!==void 0&&(o.name=e.name),e.color!==void 0&&o.color!==void 0&&o.color.setHex(e.color),e.roughness!==void 0&&(o.roughness=e.roughness),e.metalness!==void 0&&(o.metalness=e.metalness),e.sheen!==void 0&&(o.sheen=e.sheen),e.sheenColor!==void 0&&(o.sheenColor=new Color().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(o.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&o.emissive!==void 0&&o.emissive.setHex(e.emissive),e.specular!==void 0&&o.specular!==void 0&&o.specular.setHex(e.specular),e.specularIntensity!==void 0&&(o.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&o.specularColor!==void 0&&o.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(o.shininess=e.shininess),e.clearcoat!==void 0&&(o.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(o.dispersion=e.dispersion),e.iridescence!==void 0&&(o.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(o.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(o.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(o.transmission=e.transmission),e.thickness!==void 0&&(o.thickness=e.thickness),e.attenuationDistance!==void 0&&(o.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&o.attenuationColor!==void 0&&o.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(o.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(o.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(o.fog=e.fog),e.flatShading!==void 0&&(o.flatShading=e.flatShading),e.blending!==void 0&&(o.blending=e.blending),e.combine!==void 0&&(o.combine=e.combine),e.side!==void 0&&(o.side=e.side),e.shadowSide!==void 0&&(o.shadowSide=e.shadowSide),e.opacity!==void 0&&(o.opacity=e.opacity),e.transparent!==void 0&&(o.transparent=e.transparent),e.alphaTest!==void 0&&(o.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(o.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(o.depthFunc=e.depthFunc),e.depthTest!==void 0&&(o.depthTest=e.depthTest),e.depthWrite!==void 0&&(o.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(o.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(o.blendSrc=e.blendSrc),e.blendDst!==void 0&&(o.blendDst=e.blendDst),e.blendEquation!==void 0&&(o.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(o.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(o.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(o.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&o.blendColor!==void 0&&o.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(o.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(o.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(o.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(o.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(o.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(o.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(o.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(o.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(o.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(o.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(o.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(o.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(o.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(o.rotation=e.rotation),e.linewidth!==void 0&&(o.linewidth=e.linewidth),e.dashSize!==void 0&&(o.dashSize=e.dashSize),e.gapSize!==void 0&&(o.gapSize=e.gapSize),e.scale!==void 0&&(o.scale=e.scale),e.polygonOffset!==void 0&&(o.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(o.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(o.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(o.dithering=e.dithering),e.alphaToCoverage!==void 0&&(o.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(o.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(o.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(o.visible=e.visible),e.toneMapped!==void 0&&(o.toneMapped=e.toneMapped),e.userData!==void 0&&(o.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?o.vertexColors=e.vertexColors>0:o.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const l in e.uniforms){const a=e.uniforms[l];switch(o.uniforms[l]={},a.type){case"t":o.uniforms[l].value=r(a.value);break;case"c":o.uniforms[l].value=new Color().setHex(a.value);break;case"v2":o.uniforms[l].value=new Vector2().fromArray(a.value);break;case"v3":o.uniforms[l].value=new Vector3().fromArray(a.value);break;case"v4":o.uniforms[l].value=new Vector4().fromArray(a.value);break;case"m3":o.uniforms[l].value=new Matrix3().fromArray(a.value);break;case"m4":o.uniforms[l].value=new Matrix4().fromArray(a.value);break;default:o.uniforms[l].value=a.value}}if(e.defines!==void 0&&(o.defines=e.defines),e.vertexShader!==void 0&&(o.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(o.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(o.glslVersion=e.glslVersion),e.extensions!==void 0)for(const l in e.extensions)o.extensions[l]=e.extensions[l];if(e.lights!==void 0&&(o.lights=e.lights),e.clipping!==void 0&&(o.clipping=e.clipping),e.size!==void 0&&(o.size=e.size),e.sizeAttenuation!==void 0&&(o.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(o.map=r(e.map)),e.matcap!==void 0&&(o.matcap=r(e.matcap)),e.alphaMap!==void 0&&(o.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(o.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(o.bumpScale=e.bumpScale),e.normalMap!==void 0&&(o.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(o.normalMapType=e.normalMapType),e.normalScale!==void 0){let l=e.normalScale;Array.isArray(l)===!1&&(l=[l,l]),o.normalScale=new Vector2().fromArray(l)}return e.displacementMap!==void 0&&(o.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(o.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(o.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(o.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(o.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(o.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(o.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(o.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(o.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(o.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(o.envMap=r(e.envMap)),e.envMapRotation!==void 0&&o.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(o.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(o.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(o.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(o.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(o.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(o.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(o.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(o.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(o.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(o.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(o.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(o.clearcoatNormalScale=new Vector2().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(o.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(o.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(o.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(o.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(o.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(o.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(o.sheenRoughnessMap=r(e.sheenRoughnessMap)),o}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const i={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new i[e]}}class LoaderUtils{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let r=0,o=e.length;r<o;r++)i+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=window.nodejs;if(i&&i.path.isAbsolute(e))return e.slice(-1)=="/"?e.replace(/\//g,"/"):i.path.dirname(e).replace(/\//g,"/")+"/";const r=e.lastIndexOf("/");return r===-1?"./":e.slice(0,r+1)}static resolveURL(e,i){if(typeof e!="string"||e==="")return"";if(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))return e;let r=i+e;return window.external_io?.driver!="http"&&(r=decodeURI(r)),r}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class BufferGeometryLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=this,a=new FileLoader(l.manager);a.setPath(l.path),a.setRequestHeader(l.requestHeader),a.setWithCredentials(l.withCredentials),a.load(e,function(c){try{i(l.parse(JSON.parse(c)))}catch(d){o?o(d):console.error(d),l.manager.itemError(e)}},r,o)}parse(e){const i={},r={};function o(_,b){if(i[b]!==void 0)return i[b];const w=_.interleavedBuffers[b],y=l(_,w.buffer),M=getTypedArray(w.type,y),S=new InterleavedBuffer(M,w.stride);return S.uuid=w.uuid,i[b]=S,S}function l(_,b){if(r[b]!==void 0)return r[b];const w=_.arrayBuffers[b],y=new Uint32Array(w).buffer;return r[b]=y,y}const a=e.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,c=e.data.index;if(c!==void 0){const _=getTypedArray(c.type,c.array);a.setIndex(new BufferAttribute(_,1))}const d=e.data.attributes;for(const _ in d){const b=d[_];let v;if(b.isInterleavedBufferAttribute){const w=o(e.data,b.data);v=new InterleavedBufferAttribute(w,b.itemSize,b.offset,b.normalized)}else{const w=getTypedArray(b.type,b.array),y=b.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;v=new y(w,b.itemSize,b.normalized)}b.name!==void 0&&(v.name=b.name),b.usage!==void 0&&v.setUsage(b.usage),a.setAttribute(_,v)}const u=e.data.morphAttributes;if(u)for(const _ in u){const b=u[_],v=[];for(let w=0,y=b.length;w<y;w++){const M=b[w];let S;if(M.isInterleavedBufferAttribute){const D=o(e.data,M.data);S=new InterleavedBufferAttribute(D,M.itemSize,M.offset,M.normalized)}else{const D=getTypedArray(M.type,M.array);S=new BufferAttribute(D,M.itemSize,M.normalized)}M.name!==void 0&&(S.name=M.name),v.push(S)}a.morphAttributes[_]=v}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const m=e.data.groups||e.data.drawcalls||e.data.offsets;if(m!==void 0)for(let _=0,b=m.length;_!==b;++_){const v=m[_];a.addGroup(v.start,v.count,v.materialIndex)}const h=e.data.boundingSphere;if(h!==void 0){const _=new Vector3;h.center!==void 0&&_.fromArray(h.center),a.boundingSphere=new Sphere(_,h.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class ObjectLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=this,a=this.path===""?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const c=new FileLoader(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(d){let u=null;try{u=JSON.parse(d)}catch(m){o!==void 0&&o(m),console.error("THREE:ObjectLoader: Can't parse "+e+".",m.message);return}const f=u.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry"){o!==void 0&&o(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}l.parse(u,i)},r,o)}async loadAsync(e,i){const r=this,o=this.path===""?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const l=new FileLoader(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials);const a=await l.loadAsync(e,i),c=JSON.parse(a),d=c.metadata;if(d===void 0||d.type===void 0||d.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(c)}parse(e,i){const r=this.parseAnimations(e.animations),o=this.parseShapes(e.shapes),l=this.parseGeometries(e.geometries,o),a=this.parseImages(e.images,function(){i!==void 0&&i(u)}),c=this.parseTextures(e.textures,a),d=this.parseMaterials(e.materials,c),u=this.parseObject(e.object,l,d,c,r),f=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,f),i!==void 0){let m=!1;for(const h in a)if(a[h].data instanceof HTMLImageElement){m=!0;break}m===!1&&i(u)}return u}async parseAsync(e){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,r),l=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,l),c=this.parseMaterials(e.materials,a),d=this.parseObject(e.object,o,c,a,i),u=this.parseSkeletons(e.skeletons,d);return this.bindSkeletons(d,u),d}parseShapes(e){const i={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const l=new Shape().fromJSON(e[r]);i[l.uuid]=l}return i}parseSkeletons(e,i){const r={},o={};if(i.traverse(function(l){l.isBone&&(o[l.uuid]=l)}),e!==void 0)for(let l=0,a=e.length;l<a;l++){const c=new Skeleton().fromJSON(e[l],o);r[c.uuid]=c}return r}parseGeometries(e,i){const r={};if(e!==void 0){const o=new BufferGeometryLoader;for(let l=0,a=e.length;l<a;l++){let c;const d=e[l];switch(d.type){case"BufferGeometry":case"InstancedBufferGeometry":c=o.parse(d);break;default:d.type in Geometries?c=Geometries[d.type].fromJSON(d,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${d.type}"`)}c.uuid=d.uuid,d.name!==void 0&&(c.name=d.name),d.userData!==void 0&&(c.userData=d.userData),r[d.uuid]=c}}return r}parseMaterials(e,i){const r={},o={};if(e!==void 0){const l=new MaterialLoader;l.setTextures(i);for(let a=0,c=e.length;a<c;a++){const d=e[a];r[d.uuid]===void 0&&(r[d.uuid]=l.parse(d)),o[d.uuid]=r[d.uuid]}}return o}parseAnimations(e){const i={};if(e!==void 0)for(let r=0;r<e.length;r++){const o=e[r],l=AnimationClip.parse(o);i[l.uuid]=l}return i}parseImages(e,i){const r=this,o={};let l;function a(d){return r.manager.itemStart(d),l.load(d,function(){r.manager.itemEnd(d)},void 0,function(){r.manager.itemError(d),r.manager.itemEnd(d)})}function c(d){if(typeof d=="string"){const u=d,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:r.resourcePath+u;return a(f)}else return d.data?{data:getTypedArray(d.type,d.data),width:d.width,height:d.height}:null}if(e!==void 0&&e.length>0){const d=new LoadingManager(i);l=new ImageLoader(d),l.setCrossOrigin(this.crossOrigin);for(let u=0,f=e.length;u<f;u++){const m=e[u],h=m.url;if(Array.isArray(h)){const _=[];for(let b=0,v=h.length;b<v;b++){const w=h[b],y=c(w);y!==null&&(y instanceof HTMLImageElement?_.push(y):_.push(new DataTexture(y.data,y.width,y.height)))}o[m.uuid]=new Source(_)}else{const _=c(m.url);o[m.uuid]=new Source(_)}}}return o}async parseImagesAsync(e){const i=this,r={};let o;async function l(a){if(typeof a=="string"){const c=a,d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return await o.loadAsync(d)}else return a.data?{data:getTypedArray(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){o=new ImageLoader(this.manager),o.setCrossOrigin(this.crossOrigin);for(let a=0,c=e.length;a<c;a++){const d=e[a],u=d.url;if(Array.isArray(u)){const f=[];for(let m=0,h=u.length;m<h;m++){const _=u[m],b=await l(_);b!==null&&(b instanceof HTMLImageElement?f.push(b):f.push(new DataTexture(b.data,b.width,b.height)))}r[d.uuid]=new Source(f)}else{const f=await l(d.url);r[d.uuid]=new Source(f)}}}return r}parseTextures(e,i){function r(l,a){return typeof l=="number"?l:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",l),a[l])}const o={};if(e!==void 0)for(let l=0,a=e.length;l<a;l++){const c=e[l];c.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',c.uuid),i[c.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",c.image);const d=i[c.image],u=d.data;let f;Array.isArray(u)?(f=new CubeTexture,u.length===6&&(f.needsUpdate=!0)):(u&&u.data?f=new DataTexture:f=new Texture,u&&(f.needsUpdate=!0)),f.source=d,f.uuid=c.uuid,c.name!==void 0&&(f.name=c.name),c.mapping!==void 0&&(f.mapping=r(c.mapping,TEXTURE_MAPPING)),c.channel!==void 0&&(f.channel=c.channel),c.offset!==void 0&&f.offset.fromArray(c.offset),c.repeat!==void 0&&f.repeat.fromArray(c.repeat),c.center!==void 0&&f.center.fromArray(c.center),c.rotation!==void 0&&(f.rotation=c.rotation),c.wrap!==void 0&&(f.wrapS=r(c.wrap[0],TEXTURE_WRAPPING),f.wrapT=r(c.wrap[1],TEXTURE_WRAPPING)),c.format!==void 0&&(f.format=c.format),c.internalFormat!==void 0&&(f.internalFormat=c.internalFormat),c.type!==void 0&&(f.type=c.type),c.colorSpace!==void 0&&(f.colorSpace=c.colorSpace),c.minFilter!==void 0&&(f.minFilter=r(c.minFilter,TEXTURE_FILTER)),c.magFilter!==void 0&&(f.magFilter=r(c.magFilter,TEXTURE_FILTER)),c.anisotropy!==void 0&&(f.anisotropy=c.anisotropy),c.flipY!==void 0&&(f.flipY=c.flipY),c.generateMipmaps!==void 0&&(f.generateMipmaps=c.generateMipmaps),c.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=c.premultiplyAlpha),c.unpackAlignment!==void 0&&(f.unpackAlignment=c.unpackAlignment),c.compareFunction!==void 0&&(f.compareFunction=c.compareFunction),c.userData!==void 0&&(f.userData=c.userData),o[c.uuid]=f}return o}parseObject(e,i,r,o,l){let a;function c(h){return i[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",h),i[h]}function d(h){if(h!==void 0){if(Array.isArray(h)){const _=[];for(let b=0,v=h.length;b<v;b++){const w=h[b];r[w]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",w),_.push(r[w])}return _}return r[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",h),r[h]}}function u(h){return o[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",h),o[h]}let f,m;switch(e.type){case"Scene":a=new Scene,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Color(e.background):a.background=u(e.background)),e.environment!==void 0&&(a.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new FogExp2(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":a=new DirectionalLight(e.color,e.intensity);break;case"PointLight":a=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new LightProbe().fromJSON(e);break;case"SkinnedMesh":f=c(e.geometry),m=d(e.material),a=new SkinnedMesh(f,m),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":f=c(e.geometry),m=d(e.material),a=new Mesh(f,m);break;case"InstancedMesh":f=c(e.geometry),m=d(e.material);const h=e.count,_=e.instanceMatrix,b=e.instanceColor;a=new InstancedMesh(f,m,h),a.instanceMatrix=new InstancedBufferAttribute(new Float32Array(_.array),16),b!==void 0&&(a.instanceColor=new InstancedBufferAttribute(new Float32Array(b.array),b.itemSize));break;case"BatchedMesh":f=c(e.geometry),m=d(e.material),a=new BatchedMesh(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,m),a.geometry=f,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(v=>{const w=new Box3;w.min.fromArray(v.boxMin),w.max.fromArray(v.boxMax);const y=new Sphere;return y.radius=v.sphereRadius,y.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:w,sphereInitialized:v.sphereInitialized,sphere:y}}),a._maxGeometryCount=e.maxGeometryCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=u(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=u(e.colorsTexture.uuid));break;case"LOD":a=new LOD;break;case"Line":a=new Line(c(e.geometry),d(e.material));break;case"LineLoop":a=new LineLoop(c(e.geometry),d(e.material));break;case"LineSegments":a=new LineSegments(c(e.geometry),d(e.material));break;case"PointCloud":case"Points":a=new Points(c(e.geometry),d(e.material));break;case"Sprite":a=new Sprite(d(e.material));break;case"Group":a=new Group;break;case"Bone":a=new Bone;break;default:a=new Object3D}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const h=e.children;for(let _=0;_<h.length;_++)a.add(this.parseObject(h[_],i,r,o,l))}if(e.animations!==void 0){const h=e.animations;for(let _=0;_<h.length;_++){const b=h[_];a.animations.push(l[b])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const h=e.levels;for(let _=0;_<h.length;_++){const b=h[_],v=a.getObjectByProperty("uuid",b.object);v!==void 0&&a.addLevel(v,b.distance,b.hysteresis)}}return a}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const o=i[r.skeleton];o===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(o,r.bindMatrix)}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,i,r,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,a=Cache.get(e);if(a!==void 0)return l.manager.itemStart(e),setTimeout(function(){i&&i(a),l.manager.itemEnd(e)},0),a;if(e.indexOf(":")==-1&&window.external_io){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const c=this,d=Cache.get(e);if(d!==void 0)return c.manager.itemStart(e),setTimeout(function(){i&&i(d),c.manager.itemEnd(e)},0),d;{const u=window.external_io;return c.manager.itemStart(e),u.get(e).then(f=>{const m=new Blob([f],{type:"application/octet-stream"});createImageBitmap(m,Object.assign(c.options,{colorSpaceConversion:"none"})).then(h=>{console.warn(h),Cache.add(e,h),i&&i(h),c.manager.itemEnd(e)}).catch(h=>{console.error(h),o&&o(h),c.manager.itemError(e),c.manager.itemEnd(e)})}).catch(f=>{console.error(f),o&&o(f),c.manager.itemError(e),c.manager.itemEnd(e)}),null}}else return this._load_(e,i,r,o)}_load_(e,i,r,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,a=Cache.get(e);if(a!==void 0){if(l.manager.itemStart(e),a.then){a.then(u=>{i&&i(u),l.manager.itemEnd(e)}).catch(u=>{o&&o(u)});return}return setTimeout(function(){i&&i(a),l.manager.itemEnd(e)},0),a}const c={};c.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",c.headers=this.requestHeader;const d=fetch(e,c).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(l.options,{colorSpaceConversion:"none"}))}).then(function(u){return Cache.add(e,u),i&&i(u),l.manager.itemEnd(e),u}).catch(function(u){o&&o(u),Cache.remove(e),l.manager.itemError(e),l.manager.itemEnd(e)});Cache.add(e,d),l.manager.itemStart(e)}}let _context;class AudioContext{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(e){_context=e}}class AudioLoader extends Loader{constructor(e){super(e)}load(e,i,r,o){const l=this;if(window.nodejs&&window.external_io==null){try{const d=window.nodejs.to_array_buffer(window.nodejs.fs.readFileSync(e));AudioContext.getContext().decodeAudioData(d,function(f){i(f)},o)}catch(d){o(d)}return}const a=new FileLoader(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(d){try{const u=d.slice(0);AudioContext.getContext().decodeAudioData(u,function(m){i(m)}).catch(c)}catch(u){c(u)}},r,o);function c(d){o?o(d):console.error(d),l.manager.itemError(e)}}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,_projectionMatrix.copy(e.projectionMatrix);const o=i.eyeSep/2,l=o*i.near/i.focus,a=i.near*Math.tan(DEG2RAD*i.fov*.5)/i.zoom;let c,d;_eyeLeft.elements[12]=-o,_eyeRight.elements[12]=o,c=-a*i.aspect+l,d=a*i.aspect+l,_projectionMatrix.elements[0]=2*i.near/(d-c),_projectionMatrix.elements[8]=(d+c)/(d-c),this.cameraL.projectionMatrix.copy(_projectionMatrix),c=-a*i.aspect-l,d=a*i.aspect-l,_projectionMatrix.elements[0]=2*i.near/(d-c),_projectionMatrix.elements[8]=(d+c)/(d-c),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}}class Clock{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=now();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function now(){return(typeof performance>"u"?Date:performance).now()}const _position$2=new Vector3,_quaternion$2=new Quaternion,_scale$2=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$2,_quaternion$2,_scale$2),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$2),i.positionX){const o=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(_position$2.x,o),i.positionY.linearRampToValueAtTime(_position$2.y,o),i.positionZ.linearRampToValueAtTime(_position$2.z,o),i.forwardX.linearRampToValueAtTime(_orientation$1.x,o),i.forwardY.linearRampToValueAtTime(_orientation$1.y,o),i.forwardZ.linearRampToValueAtTime(_orientation$1.z,o),i.upX.linearRampToValueAtTime(r.x,o),i.upY.linearRampToValueAtTime(r.y,o),i.upZ.linearRampToValueAtTime(r.z,o)}else i.setPosition(_position$2.x,_position$2.y,_position$2.z),i.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,r.x,r.y,r.z)}}let Audio$1=class extends Object3D{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[],this.prepare(e)}prepare(e){if(e&&(this.listener=e,this.context=e.context),this.source==null&&this.context&&(this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.buffer))try{this.source.start(this._startedAt,this._progress+this.offset,this.duration),this.source.stop()}catch(i){console.error(i)}}setVolume(e){return window.DMC?.sound_listener&&this.source==null&&this.prepare(window.DMC.sound_listener),this.gain?this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01):console.warn("No gain."),this}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}if(window.DMC?.sound_listener&&this.source==null&&this.prepare(window.DMC.sound_listener),this.context==null){console.warn("Audio object must prepare audio context before play.");return}e=Math.max(e,0),this._startedAt=this.context.currentTime+e;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.__on_started_audio__&&this.__on_started_audio__(),this.connect()}time(){return this.isPlaying===!0?this._progress+this.offset+Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate:this._progress+this.offset}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}};const _position$1=new Vector3,_quaternion$1=new Quaternion,_scale$1=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio$1{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation.set(0,0,1).applyQuaternion(_quaternion$1);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(_position$1.x,r),i.positionY.linearRampToValueAtTime(_position$1.y,r),i.positionZ.linearRampToValueAtTime(_position$1.z,r),i.orientationX.linearRampToValueAtTime(_orientation.x,r),i.orientationY.linearRampToValueAtTime(_orientation.y,r),i.orientationZ.linearRampToValueAtTime(_orientation.z,r)}else i.setPosition(_position$1.x,_position$1.y,_position$1.z),i.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)e+=i[r];return e/i.length}}class PropertyMixer{constructor(e,i,r){this.binding=e,this.valueSize=r;let o,l,a;switch(i){case"quaternion":o=this._slerp,l=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":o=this._select,l=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:o=this._lerp,l=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=o,this._mixBufferRegionAdditive=l,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const r=this.buffer,o=this.valueSize,l=e*o+o;let a=this.cumulativeWeight;if(a===0){for(let c=0;c!==o;++c)r[l+c]=r[c];a=i}else{a+=i;const c=i/a;this._mixBufferRegion(r,l,0,c,o)}this.cumulativeWeight=a}accumulateAdditive(e){const i=this.buffer,r=this.valueSize,o=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,o,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,r=this.buffer,o=e*i+i,l=this.cumulativeWeight,a=this.cumulativeWeightAdditive,c=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,l<1){const d=i*this._origIndex;this._mixBufferRegion(r,o,d,1-l,i)}a>0&&this._mixBufferRegionAdditive(r,o,this._addIndex*i,1,i);for(let d=i,u=i+i;d!==u;++d)if(r[d]!==r[d+i]){c.setValue(r,o);break}}saveOriginalState(){const e=this.binding,i=this.buffer,r=this.valueSize,o=r*this._origIndex;e.getValue(i,o);for(let l=r,a=o;l!==a;++l)i[l]=i[o+l%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let r=e;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[e+r]}_select(e,i,r,o,l){if(o>=.5)for(let a=0;a!==l;++a)e[i+a]=e[r+a]}_slerp(e,i,r,o){Quaternion.slerpFlat(e,i,e,i,e,r,o)}_slerpAdditive(e,i,r,o,l){const a=this._workIndex*l;Quaternion.multiplyQuaternionsFlat(e,a,e,i,e,r),Quaternion.slerpFlat(e,i,e,i,e,a,o)}_lerp(e,i,r,o,l){const a=1-o;for(let c=0;c!==l;++c){const d=i+c;e[d]=e[d]*a+e[r+c]*o}}_lerpAdditive(e,i,r,o,l){for(let a=0;a!==l;++a){const c=i+a;e[c]=e[c]+e[r+a]*o}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(e,i,r){const o=r||PropertyBinding.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,o)}getValue(e,i){this.bind();const r=this._targetGroup.nCachedObjects_,o=this._bindings[r];o!==void 0&&o.getValue(e,i)}setValue(e,i){const r=this._bindings;for(let o=this._targetGroup.nCachedObjects_,l=r.length;o!==l;++o)r[o].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].unbind()}}class PropertyBinding{constructor(e,i,r){this.path=i,this.parsedPath=r||PropertyBinding.parseTrackName(i),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,r){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,i,r):new PropertyBinding(e,i,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(e){const i=_trackRe.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},o=r.nodeName&&r.nodeName.lastIndexOf(".");if(o!==void 0&&o!==-1){const l=r.nodeName.substring(o+1);_supportedObjectNames.indexOf(l)!==-1&&(r.nodeName=r.nodeName.substring(0,o),r.objectName=l)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(i);if(r!==void 0)return r}if(e.children){const r=function(l){for(let a=0;a<l.length;a++){const c=l[a];if(c.name===i||c.uuid===i)return c;const d=r(c.children);if(d)return d}return null},o=r(e.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)e[i++]=r[o]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,r=i.objectName,o=i.propertyName;let l=i.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let u=i.objectIndex;switch(r){case"materials":if(!e.material){console.warn("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.warn("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.warn("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===u){u=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.warn("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.warn("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){window.debug&&console.warn("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(u!==void 0){if(e[u]===void 0){window.debug&&console.warn("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const a=e[o];if(a===void 0){const u=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+o+" but it wasn't found.",e);return}let c=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);let d=this.BindingType.Direct;if(l!==void 0){if(o==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[l]!==void 0&&(l=e.morphTargetDictionary[l])}d=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=l}else a.fromArray!==void 0&&a.toArray!==void 0?(d=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(d=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=o;this.getValue=this.GetterByBindingType[d],this.setValue=this.SetterByBindingTypeAndVersioning[d][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,o=arguments.length;r!==o;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,r=this._paths,o=this._parsedPaths,l=this._bindings,a=l.length;let c,d=e.length,u=this.nCachedObjects_;for(let f=0,m=arguments.length;f!==m;++f){const h=arguments[f],_=h.uuid;let b=i[_];if(b===void 0){b=d++,i[_]=b,e.push(h);for(let v=0,w=a;v!==w;++v)l[v].push(new PropertyBinding(h,r[v],o[v]))}else if(b<u){c=e[b];const v=--u,w=e[v];i[w.uuid]=b,e[b]=w,i[_]=v,e[v]=h;for(let y=0,M=a;y!==M;++y){const S=l[y],D=S[v];let k=S[b];S[b]=D,k===void 0&&(k=new PropertyBinding(h,r[y],o[y])),S[v]=k}}else e[b]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,o=r.length;let l=this.nCachedObjects_;for(let a=0,c=arguments.length;a!==c;++a){const d=arguments[a],u=d.uuid,f=i[u];if(f!==void 0&&f>=l){const m=l++,h=e[m];i[h.uuid]=f,e[f]=h,i[u]=m,e[m]=d;for(let _=0,b=o;_!==b;++_){const v=r[_],w=v[m],y=v[f];v[f]=w,v[m]=y}}}this.nCachedObjects_=l}uncache(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,o=r.length;let l=this.nCachedObjects_,a=e.length;for(let c=0,d=arguments.length;c!==d;++c){const u=arguments[c],f=u.uuid,m=i[f];if(m!==void 0)if(delete i[f],m<l){const h=--l,_=e[h],b=--a,v=e[b];i[_.uuid]=m,e[m]=_,i[v.uuid]=h,e[h]=v,e.pop();for(let w=0,y=o;w!==y;++w){const M=r[w],S=M[h],D=M[b];M[m]=S,M[h]=D,M.pop()}}else{const h=--a,_=e[h];h>0&&(i[_.uuid]=m),e[m]=_,e.pop();for(let b=0,v=o;b!==v;++b){const w=r[b];w[m]=w[h],w.pop()}}}this.nCachedObjects_=l}subscribe_(e,i){const r=this._bindingsIndicesByPath;let o=r[e];const l=this._bindings;if(o!==void 0)return l[o];const a=this._paths,c=this._parsedPaths,d=this._objects,u=d.length,f=this.nCachedObjects_,m=new Array(u);o=l.length,r[e]=o,a.push(e),c.push(i),l.push(m);for(let h=f,_=d.length;h!==_;++h){const b=d[h];m[h]=new PropertyBinding(b,e,i)}return m}unsubscribe_(e){const i=this._bindingsIndicesByPath,r=i[e];if(r!==void 0){const o=this._paths,l=this._parsedPaths,a=this._bindings,c=a.length-1,d=a[c],u=e[c];i[u]=r,a[r]=d,a.pop(),l[r]=l[c],l.pop(),o[r]=o[c],o.pop()}}}class AnimationAction{constructor(e,i,r=null,o=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=r,this.blendMode=o;const l=i.tracks,a=l.length,c=new Array(a),d={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let u=0;u!==a;++u){const f=l[u].createInterpolant(null);c[u]=f,f.settings=d}this._interpolantSettings=d,this._interpolants=c,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeOffset=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,r){if(e.fadeOut(i),this.fadeIn(i),r){const o=this._clip.duration,l=e._clip.duration,a=l/o,c=o/l;e.warp(1,a,i),this.warp(c,1,i)}return this}crossFadeTo(e,i,r){return e.crossFadeFrom(this,i,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,r){const o=this._mixer,l=o.time,a=this.timeScale;let c=this._timeScaleInterpolant;c===null&&(c=o._lendControlInterpolant(),this._timeScaleInterpolant=c);const d=c.parameterPositions,u=c.sampleValues;return d[0]=l,d[1]=l+r,u[0]=e/a,u[1]=i/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,r,o){if(!this.enabled){this._updateWeight(e);return}const l=this._startTime;if(l!==null){const d=(e-l)*r;d<0||r===0?i=0:(this._startTime=null,i=r*d)}i*=this._updateTimeScale(e);const a=this._updateTime(i),c=this._updateWeight(e);if(c>0){const d=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let f=0,m=d.length;f!==m;++f)d[f].evaluate(a),u[f].accumulateAdditive(c);break;case NormalAnimationBlendMode:default:for(let f=0,m=d.length;f!==m;++f)d[f].evaluate(a),u[f].accumulate(o,c)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const o=r.evaluate(e)[0];i*=o,e>r.parameterPositions[1]&&(this.stopFading(),o===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const o=r.evaluate(e)[0];i*=o,e>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,r=this.loop;let o=this.time+e,l=this._loopCount;const a=r===LoopPingPong;if(e===0)return l===-1?o:a&&(l&1)===1?i-o:o;if(r===LoopOnce){l===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(!(o>=i))if(o<0)o=0;else{this.time=o;break e}this.clampWhenFinished&&(this.paused=!0),this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(l===-1&&(e>=0?(l=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),o>=i||o<0){const c=Math.floor(o/i);o-=i*c,l+=Math.abs(c);const d=this.repetitions-l;if(d<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o=e>0?i:0,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(d===1){const u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=l,this.time=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:c})}}else this.time=o;if(a&&(l&1)===1)return i-o}return o}_setEndings(e,i,r){const o=this._interpolantSettings;r?(o.endingStart=ZeroSlopeEnding,o.endingEnd=ZeroSlopeEnding):(e?o.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:o.endingStart=WrapAroundEnding,i?o.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:o.endingEnd=WrapAroundEnding)}_scheduleFading(e,i,r){const o=this._mixer,l=o.time;let a=this._weightInterpolant;a===null&&(a=o._lendControlInterpolant(),this._weightInterpolant=a);const c=a.parameterPositions,d=a.sampleValues;return c[0]=l,d[0]=i,c[1]=l+e,d[1]=r,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const r=e._localRoot||this._root,o=e._clip.tracks,l=o.length,a=e._propertyBindings,c=e._interpolants,d=r.uuid,u=this._bindingsByRootAndName;let f=u[d];f===void 0&&(f={},u[d]=f);for(let m=0;m!==l;++m){const h=o[m],_=h.name;let b=f[_];if(b!==void 0)++b.referenceCount,a[m]=b;else{if(b=a[m],b!==void 0){b._cacheIndex===null&&(++b.referenceCount,this._addInactiveBinding(b,d,_));continue}const v=i&&i._propertyBindings[m].binding.parsedPath;b=new PropertyMixer(PropertyBinding.create(r,_,v),h.ValueTypeName,h.getValueSize()),++b.referenceCount,this._addInactiveBinding(b,d,_),a[m]=b}c[m].resultBuffer=b.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,o=e._clip.uuid,l=this._actionsByClip[o];this._bindAction(e,l&&l.knownActions[0]),this._addInactiveAction(e,o,r)}const i=e._propertyBindings;for(let r=0,o=i.length;r!==o;++r){const l=i[r];l.useCount++===0&&(this._lendBinding(l),l.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let r=0,o=i.length;r!==o;++r){const l=i[r];--l.useCount===0&&(l.restoreOriginalState(),this._takeBackBinding(l))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,r){const o=this._actions,l=this._actionsByClip;let a=l[i];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,l[i]=a;else{const c=a.knownActions;e._byClipCacheIndex=c.length,c.push(e)}e._cacheIndex=o.length,o.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const i=this._actions,r=i[i.length-1],o=e._cacheIndex;r._cacheIndex=o,i[o]=r,i.pop(),e._cacheIndex=null;const l=e._clip.uuid,a=this._actionsByClip,c=a[l],d=c.knownActions,u=d[d.length-1],f=e._byClipCacheIndex;u._byClipCacheIndex=f,d[f]=u,d.pop(),e._byClipCacheIndex=null;const m=c.actionByRoot,h=(e._localRoot||this._root).uuid;delete m[h],d.length===0&&delete a[l],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let r=0,o=i.length;r!==o;++r){const l=i[r];--l.referenceCount===0&&this._removeInactiveBinding(l)}}_lendAction(e){const i=this._actions,r=e._cacheIndex,o=this._nActiveActions++,l=i[o];e._cacheIndex=o,i[o]=e,l._cacheIndex=r,i[r]=l}_takeBackAction(e){const i=this._actions,r=e._cacheIndex,o=--this._nActiveActions,l=i[o];e._cacheIndex=o,i[o]=e,l._cacheIndex=r,i[r]=l}_addInactiveBinding(e,i,r){const o=this._bindingsByRootAndName,l=this._bindings;let a=o[i];a===void 0&&(a={},o[i]=a),a[r]=e,e._cacheIndex=l.length,l.push(e)}_removeInactiveBinding(e){const i=this._bindings,r=e.binding,o=r.rootNode.uuid,l=r.path,a=this._bindingsByRootAndName,c=a[o],d=i[i.length-1],u=e._cacheIndex;d._cacheIndex=u,i[u]=d,i.pop(),delete c[l],Object.keys(c).length===0&&delete a[o]}_lendBinding(e){const i=this._bindings,r=e._cacheIndex,o=this._nActiveBindings++,l=i[o];e._cacheIndex=o,i[o]=e,l._cacheIndex=r,i[r]=l}_takeBackBinding(e){const i=this._bindings,r=e._cacheIndex,o=--this._nActiveBindings,l=i[o];e._cacheIndex=o,i[o]=e,l._cacheIndex=r,i[r]=l}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=e[i];return r===void 0&&(r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),r.__cacheIndex=i,e[i]=r),r}_takeBackControlInterpolant(e){const i=this._controlInterpolants,r=e.__cacheIndex,o=--this._nActiveControlInterpolants,l=i[o];e.__cacheIndex=o,i[o]=e,l.__cacheIndex=r,i[r]=l}clipAction(e,i,r){const o=i||this._root,l=o.uuid;let a=typeof e=="string"?AnimationClip.findByName(o,e):e;const c=a!==null?a.uuid:e,d=this._actionsByClip[c];let u=null;if(r===void 0&&(a!==null?r=a.blendMode:r=NormalAnimationBlendMode),d!==void 0){const m=d.actionByRoot[l];if(m!==void 0&&m.blendMode===r)return m;u=d.knownActions[0],a===null&&(a=u._clip)}if(a===null)return null;const f=new AnimationAction(this,a,i,r);return this._bindAction(f,u),this._addInactiveAction(f,c,l),f}existingAction(e,i){const r=i||this._root,o=r.uuid,l=typeof e=="string"?AnimationClip.findByName(r,e):e,a=l?l.uuid:e,c=this._actionsByClip[a];return c!==void 0&&c.actionByRoot[o]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const i=this._actions,r=this._nActiveActions,o=this.time+=e,l=Math.sign(e),a=this._accuIndex^=1;for(let u=0;u!==r;++u)i[u]._update(o,e,l,a);const c=this._bindings,d=this._nActiveBindings;for(let u=0;u!==d;++u)c[u].apply(a);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,r=e.uuid,o=this._actionsByClip,l=o[r];if(l!==void 0){const a=l.knownActions;for(let c=0,d=a.length;c!==d;++c){const u=a[c];this._deactivateAction(u);const f=u._cacheIndex,m=i[i.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,m._cacheIndex=f,i[f]=m,i.pop(),this._removeInactiveBindingsForAction(u)}delete o[r]}}uncacheRoot(e){const i=e.uuid,r=this._actionsByClip;for(const a in r){const c=r[a].actionByRoot,d=c[i];d!==void 0&&(this._deactivateAction(d),this._removeInactiveAction(d))}const o=this._bindingsByRootAndName,l=o[i];if(l!==void 0)for(const a in l){const c=l[a];c.restoreOriginalState(),this._removeInactiveBinding(c)}}uncacheAction(e,i){const r=this.existingAction(e,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class Uniform{constructor(e){this.value=e}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let _id=0;class UniformsGroup extends EventDispatcher{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let r=0,o=i.length;r<o;r++){const l=Array.isArray(i[r])?i[r]:[i[r]];for(let a=0;a<l.length;a++)this.uniforms.push(l[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(e,i,r=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class GLBufferAttribute{constructor(e,i,r,o,l){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=r,this.elementSize=o,this.count=l,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const _matrix$2=new Matrix4;class Raycaster{constructor(e,i,r=0,o=1/0){this.ray=new Ray(e,i),this.near=r,this.far=o,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return _matrix$2.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_matrix$2),this}intersectObject(e,i=!0,r=[]){return intersect(e,this,r,i),r.sort(ascSort),r}intersectObjects(e,i=!0,r=[]){for(let o=0,l=e.length;o<l;o++)intersect(e[o],this,r,i);return r.sort(ascSort),r}}function ascSort(s,e){return s.distance-e.distance}function intersect(s,e,i,r){let o=!0;if(s.layers.test(e.layers)&&s.raycast(e,i)===!1&&(o=!1),o===!0&&r===!0){const l=s.children;for(let a=0,c=l.length;a<c;a++)intersect(l[a],e,i,!0)}}class Spherical{constructor(e=1,i=0,r=0){return this.radius=e,this.phi=i,this.theta=r,this}set(e,i,r){return this.radius=e,this.phi=i,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(clamp(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(e=1,i=0,r=0){return this.radius=e,this.theta=i,this.y=r,this}set(e,i,r){return this.radius=e,this.theta=i,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}const _vector$6=new Vector2;class Box2{constructor(e=new Vector2(1/0,1/0),i=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=_vector$6.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_vector$6).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(e=new Vector3,i=new Vector3){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){_startP.subVectors(e,this.start),_startEnd.subVectors(this.end,this.start);const r=_startEnd.dot(_startEnd);let l=_startEnd.dot(_startP)/r;return i&&(l=clamp(l,0,1)),l}closestPointToPoint(e,i,r){const o=this.closestPointToPointParameter(e,i);return this.delta(r).multiplyScalar(o).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$5=new Vector3;class SpotLightHelper extends Object3D{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new BufferGeometry,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,c=1,d=32;a<d;a++,c++){const u=a/d*Math.PI*2,f=c/d*Math.PI*2;o.push(Math.cos(u),Math.sin(u),1,Math.cos(f),Math.sin(f),1)}r.setAttribute("position",new Float32BufferAttribute(o,3));const l=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(r,l),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),_vector$5.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$5),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$4=new Vector3,_boneMatrix$2=new Matrix4,_matrixWorldInv$2=new Matrix4;let SkeletonHelper$1=class extends LineSegments{constructor(e){const i=getBoneList$1(e),r=new BufferGeometry,o=[],l=[],a=new Color(0,0,1),c=new Color(0,1,0);for(let u=0;u<i.length;u++){const f=i[u];f.parent&&f.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),l.push(a.r,a.g,a.b),l.push(c.r,c.g,c.b))}r.setAttribute("position",new Float32BufferAttribute(o,3)),r.setAttribute("color",new Float32BufferAttribute(l,3));const d=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,d),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const i=this.bones,r=this.geometry,o=r.getAttribute("position");_matrixWorldInv$2.copy(this.root.matrixWorld).invert();for(let l=0,a=0;l<i.length;l++){const c=i[l];c.parent&&c.parent.isBone&&(_boneMatrix$2.multiplyMatrices(_matrixWorldInv$2,c.matrixWorld),_vector$4.setFromMatrixPosition(_boneMatrix$2),o.setXYZ(a,_vector$4.x,_vector$4.y,_vector$4.z),_boneMatrix$2.multiplyMatrices(_matrixWorldInv$2,c.parent.matrixWorld),_vector$4.setFromMatrixPosition(_boneMatrix$2),o.setXYZ(a+1,_vector$4.x,_vector$4.y,_vector$4.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}};function getBoneList$1(s){const e=[];s.isBone===!0&&e.push(s);for(let i=0;i<s.children.length;i++)e.push.apply(e,getBoneList$1(s.children[i]));return e}class PointLightHelper extends Mesh{constructor(e,i,r){const o=new SphereGeometry(i,4,2),l=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(o,l),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$3=new Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const o=new OctahedronGeometry(i);o.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const l=o.getAttribute("position"),a=new Float32Array(l.count*3);o.setAttribute("color",new BufferAttribute(a,3)),this.add(new Mesh(o,this.material)),this.update()}dispose(){this.children[0]?.geometry?.dispose?.(),this.children[0]?.material?.dispose?.()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let r=0,o=i.count;r<o;r++){const l=r<o/2?_color1:_color2;i.setXYZ(r,l.r,l.g,l.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(_vector$3.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(e=10,i=10,r=4473924,o=8947848){r=new Color(r),o=new Color(o);const l=i/2,a=e/i,c=e/2,d=[],u=[];for(let h=0,_=0,b=-c;h<=i;h++,b+=a){d.push(-c,0,b,c,0,b),d.push(b,0,-c,b,0,c);const v=h===l?r:o;v.toArray(u,_),_+=3,v.toArray(u,_),_+=3,v.toArray(u,_),_+=3,v.toArray(u,_),_+=3}const f=new BufferGeometry;f.setAttribute("position",new Float32BufferAttribute(d,3)),f.setAttribute("color",new Float32BufferAttribute(u,3));const m=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(f,m),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(e=10,i=16,r=8,o=64,l=4473924,a=8947848){l=new Color(l),a=new Color(a);const c=[],d=[];if(i>1)for(let m=0;m<i;m++){const h=m/i*(Math.PI*2),_=Math.sin(h)*e,b=Math.cos(h)*e;c.push(0,0,0),c.push(_,0,b);const v=m&1?l:a;d.push(v.r,v.g,v.b),d.push(v.r,v.g,v.b)}for(let m=0;m<r;m++){const h=m&1?l:a,_=e-e/r*m;for(let b=0;b<o;b++){let v=b/o*(Math.PI*2),w=Math.sin(v)*_,y=Math.cos(v)*_;c.push(w,0,y),d.push(h.r,h.g,h.b),v=(b+1)/o*(Math.PI*2),w=Math.sin(v)*_,y=Math.cos(v)*_,c.push(w,0,y),d.push(h.r,h.g,h.b)}}const u=new BufferGeometry;u.setAttribute("position",new Float32BufferAttribute(c,3)),u.setAttribute("color",new Float32BufferAttribute(d,3));const f=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(u,f),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1$1=new Vector3,_v2$1=new Vector3,_v3$1=new Vector3;class DirectionalLightHelper extends Object3D{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let o=new BufferGeometry;o.setAttribute("position",new Float32BufferAttribute([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const l=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(o,l),this.add(this.lightPlane),o=new BufferGeometry,o.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(o,l),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1$1.setFromMatrixPosition(this.light.matrixWorld),_v2$1.setFromMatrixPosition(this.light.target.matrixWorld),_v3$1.subVectors(_v2$1,_v1$1),this.lightPlane.lookAt(_v2$1),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$1),this.targetLine.scale.z=_v3$1.length()}}const _vector$1=new Vector3,_camera$1=new Camera;class CameraHelper extends LineSegments{constructor(e){const i=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],l=[],a={};c("n1","n2"),c("n2","n4"),c("n4","n3"),c("n3","n1"),c("f1","f2"),c("f2","f4"),c("f4","f3"),c("f3","f1"),c("n1","f1"),c("n2","f2"),c("n3","f3"),c("n4","f4"),c("p","n1"),c("p","n2"),c("p","n3"),c("p","n4"),c("u1","u2"),c("u2","u3"),c("u3","u1"),c("c","t"),c("p","c"),c("cn1","cn2"),c("cn3","cn4"),c("cf1","cf2"),c("cf3","cf4");function c(b,v){d(b),d(v)}function d(b){o.push(0,0,0),l.push(0,0,0),a[b]===void 0&&(a[b]=[]),a[b].push(o.length/3-1)}i.setAttribute("position",new Float32BufferAttribute(o,3)),i.setAttribute("color",new Float32BufferAttribute(l,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const u=new Color(16755200),f=new Color(16711680),m=new Color(43775),h=new Color(16777215),_=new Color(3355443);this.setColors(u,f,m,h,_)}setColors(e,i,r,o,l){const c=this.geometry.getAttribute("color");c.setXYZ(0,e.r,e.g,e.b),c.setXYZ(1,e.r,e.g,e.b),c.setXYZ(2,e.r,e.g,e.b),c.setXYZ(3,e.r,e.g,e.b),c.setXYZ(4,e.r,e.g,e.b),c.setXYZ(5,e.r,e.g,e.b),c.setXYZ(6,e.r,e.g,e.b),c.setXYZ(7,e.r,e.g,e.b),c.setXYZ(8,e.r,e.g,e.b),c.setXYZ(9,e.r,e.g,e.b),c.setXYZ(10,e.r,e.g,e.b),c.setXYZ(11,e.r,e.g,e.b),c.setXYZ(12,e.r,e.g,e.b),c.setXYZ(13,e.r,e.g,e.b),c.setXYZ(14,e.r,e.g,e.b),c.setXYZ(15,e.r,e.g,e.b),c.setXYZ(16,e.r,e.g,e.b),c.setXYZ(17,e.r,e.g,e.b),c.setXYZ(18,e.r,e.g,e.b),c.setXYZ(19,e.r,e.g,e.b),c.setXYZ(20,e.r,e.g,e.b),c.setXYZ(21,e.r,e.g,e.b),c.setXYZ(22,e.r,e.g,e.b),c.setXYZ(23,e.r,e.g,e.b),c.setXYZ(24,i.r,i.g,i.b),c.setXYZ(25,i.r,i.g,i.b),c.setXYZ(26,i.r,i.g,i.b),c.setXYZ(27,i.r,i.g,i.b),c.setXYZ(28,i.r,i.g,i.b),c.setXYZ(29,i.r,i.g,i.b),c.setXYZ(30,i.r,i.g,i.b),c.setXYZ(31,i.r,i.g,i.b),c.setXYZ(32,r.r,r.g,r.b),c.setXYZ(33,r.r,r.g,r.b),c.setXYZ(34,r.r,r.g,r.b),c.setXYZ(35,r.r,r.g,r.b),c.setXYZ(36,r.r,r.g,r.b),c.setXYZ(37,r.r,r.g,r.b),c.setXYZ(38,o.r,o.g,o.b),c.setXYZ(39,o.r,o.g,o.b),c.setXYZ(40,l.r,l.g,l.b),c.setXYZ(41,l.r,l.g,l.b),c.setXYZ(42,l.r,l.g,l.b),c.setXYZ(43,l.r,l.g,l.b),c.setXYZ(44,l.r,l.g,l.b),c.setXYZ(45,l.r,l.g,l.b),c.setXYZ(46,l.r,l.g,l.b),c.setXYZ(47,l.r,l.g,l.b),c.setXYZ(48,l.r,l.g,l.b),c.setXYZ(49,l.r,l.g,l.b),c.needsUpdate=!0}update(){const e=this.geometry,i=this.pointMap,r=1,o=1;_camera$1.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",i,e,_camera$1,0,0,-1),setPoint("t",i,e,_camera$1,0,0,1),setPoint("n1",i,e,_camera$1,-r,-o,-1),setPoint("n2",i,e,_camera$1,r,-o,-1),setPoint("n3",i,e,_camera$1,-r,o,-1),setPoint("n4",i,e,_camera$1,r,o,-1),setPoint("f1",i,e,_camera$1,-r,-o,1),setPoint("f2",i,e,_camera$1,r,-o,1),setPoint("f3",i,e,_camera$1,-r,o,1),setPoint("f4",i,e,_camera$1,r,o,1),setPoint("u1",i,e,_camera$1,r*.7,o*1.1,-1),setPoint("u2",i,e,_camera$1,-r*.7,o*1.1,-1),setPoint("u3",i,e,_camera$1,0,o*2,-1),setPoint("cf1",i,e,_camera$1,-r,0,1),setPoint("cf2",i,e,_camera$1,r,0,1),setPoint("cf3",i,e,_camera$1,0,-o,1),setPoint("cf4",i,e,_camera$1,0,o,1),setPoint("cn1",i,e,_camera$1,-r,0,-1),setPoint("cn2",i,e,_camera$1,r,0,-1),setPoint("cn3",i,e,_camera$1,0,-o,-1),setPoint("cn4",i,e,_camera$1,0,o,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(s,e,i,r,o,l,a){_vector$1.set(o,l,a).unproject(r);const c=e[s];if(c!==void 0){const d=i.getAttribute("position");for(let u=0,f=c.length;u<f;u++)d.setXYZ(c[u],_vector$1.x,_vector$1.y,_vector$1.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(8*3),l=new BufferGeometry;l.setIndex(new BufferAttribute(r,1)),l.setAttribute("position",new BufferAttribute(o,3)),super(l,new LineBasicMaterial({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&_box.setFromObject(this.object),_box.isEmpty())return;const i=_box.min,r=_box.max,o=this.geometry.attributes.position,l=o.array;l[0]=r.x,l[1]=r.y,l[2]=r.z,l[3]=i.x,l[4]=r.y,l[5]=r.z,l[6]=i.x,l[7]=i.y,l[8]=r.z,l[9]=r.x,l[10]=i.y,l[11]=r.z,l[12]=r.x,l[13]=r.y,l[14]=i.z,l[15]=i.x,l[16]=r.y,l[17]=i.z,l[18]=i.x,l[19]=i.y,l[20]=i.z,l[21]=r.x,l[22]=i.y,l[23]=i.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],l=new BufferGeometry;l.setIndex(new BufferAttribute(r,1)),l.setAttribute("position",new Float32BufferAttribute(o,3)),super(l,new LineBasicMaterial({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(e,i=1,r=16776960){const o=r,l=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new BufferGeometry;a.setAttribute("position",new Float32BufferAttribute(l,3)),a.computeBoundingSphere(),super(a,new LineBasicMaterial({color:o,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const c=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],d=new BufferGeometry;d.setAttribute("position",new Float32BufferAttribute(c,3)),d.computeBoundingSphere(),this.add(new Mesh(d,new MeshBasicMaterial({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis$1=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(e=new Vector3(0,0,1),i=new Vector3(0,0,0),r=1,o=16776960,l=r*.2,a=l*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(i),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:o,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:o,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,l,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis$1.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle(_axis$1,i)}}setLength(e,i=e*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(e=1){const i=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],o=new BufferGeometry;o.setAttribute("position",new Float32BufferAttribute(i,3)),o.setAttribute("color",new Float32BufferAttribute(r,3));const l=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(o,l),this.type="AxesHelper"}setColors(e,i,r){const o=new Color,l=this.geometry.attributes.color.array;return o.set(e),o.toArray(l,0),o.toArray(l,3),o.set(i),o.toArray(l,6),o.toArray(l,9),o.set(r),o.toArray(l,12),o.toArray(l,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,r,o){return this.currentPath.quadraticCurveTo(e,i,r,o),this}bezierCurveTo(e,i,r,o,l,a){return this.currentPath.bezierCurveTo(e,i,r,o,l,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(y){const M=[];for(let S=0,D=y.length;S<D;S++){const k=y[S],O=new Shape;O.curves=k.curves,M.push(O)}return M}function r(y,M){const S=M.length;let D=!1;for(let k=S-1,O=0;O<S;k=O++){let L=M[k],P=M[O],N=P.x-L.x,z=P.y-L.y;if(Math.abs(z)>Number.EPSILON){if(z<0&&(L=M[O],N=-N,P=M[k],z=-z),y.y<L.y||y.y>P.y)continue;if(y.y===L.y){if(y.x===L.x)return!0}else{const K=z*(y.x-L.x)-N*(y.y-L.y);if(K===0)return!0;if(K<0)continue;D=!D}}else{if(y.y!==L.y)continue;if(P.x<=y.x&&y.x<=L.x||L.x<=y.x&&y.x<=P.x)return!0}}return D}const o=ShapeUtils.isClockWise,l=this.subPaths;if(l.length===0)return[];let a,c,d;const u=[];if(l.length===1)return c=l[0],d=new Shape,d.curves=c.curves,u.push(d),u;let f=!o(l[0].getPoints());f=e?!f:f;const m=[],h=[];let _=[],b=0,v;h[b]=void 0,_[b]=[];for(let y=0,M=l.length;y<M;y++)c=l[y],v=c.getPoints(),a=o(v),a=e?!a:a,a?(!f&&h[b]&&b++,h[b]={s:new Shape,p:v},h[b].s.curves=c.curves,f&&b++,_[b]=[]):_[b].push({h:c,p:v[0]});if(!h[0])return i(l);if(h.length>1){let y=!1,M=0;for(let S=0,D=h.length;S<D;S++)m[S]=[];for(let S=0,D=h.length;S<D;S++){const k=_[S];for(let O=0;O<k.length;O++){const L=k[O];let P=!0;for(let N=0;N<h.length;N++)r(L.p,h[N].p)&&(S!==N&&M++,P?(P=!1,m[N].push(L)):y=!0);P&&m[S].push(L)}}M>0&&y===!1&&(_=m)}let w;for(let y=0,M=h.length;y<M;y++){d=h[y].s,u.push(d),w=_[y];for(let S=0,D=w.length;S<D;S++)d.holes.push(w[S].h)}return u}}class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(e=1,i=1,r=1,o={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,i,{...o,count:r}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);const THREE$1=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping,AddEquation,AddOperation,AdditiveAnimationBlendMode,AdditiveBlending,AgXToneMapping,AlphaFormat,AlwaysCompare,AlwaysDepth,AlwaysStencilFunc,AmbientLight,AnimationAction,AnimationClip,AnimationLoader,AnimationMixer,AnimationObjectGroup,AnimationUtils,ArcCurve,ArrayCamera,ArrowHelper,AttachedBindMode,Audio:Audio$1,AudioAnalyser,AudioContext,AudioListener,AudioLoader,AxesHelper,BackSide,BasicDepthPacking,BasicShadowMap,BatchedMesh,Bone,BooleanKeyframeTrack,Box2,Box3,Box3Helper,BoxGeometry,BoxHelper,BufferAttribute,BufferGeometry,BufferGeometryLoader,ByteType,Cache,Camera,CameraHelper,CanvasTexture,CapsuleGeometry,CatmullRomCurve3,CineonToneMapping,CircleGeometry,ClampToEdgeWrapping,Clock,Color,ColorKeyframeTrack,ColorManagement,CompressedArrayTexture,CompressedCubeTexture,CompressedTexture,CompressedTextureLoader,ConeGeometry,ConstantAlphaFactor,ConstantColorFactor,CubeCamera,CubeReflectionMapping,CubeRefractionMapping,CubeTexture,CubeTextureLoader,CubeUVReflectionMapping,CubicBezierCurve,CubicBezierCurve3,CubicInterpolant,CullFaceBack,CullFaceFront,CullFaceFrontBack,CullFaceNone,Curve,CurvePath,CustomBlending,CustomToneMapping,CylinderGeometry,Cylindrical,Data3DTexture,DataArrayTexture,DataTexture,DataTextureLoader,DataUtils,DecrementStencilOp,DecrementWrapStencilOp,DefaultLoadingManager,DepthFormat,DepthStencilFormat,DepthTexture,DetachedBindMode,DirectionalLight,DirectionalLightHelper,DiscreteInterpolant,DisplayP3ColorSpace,DodecahedronGeometry,DoubleSide,DstAlphaFactor,DstColorFactor,DynamicCopyUsage,DynamicDrawUsage,DynamicReadUsage,EdgesGeometry,EllipseCurve,EqualCompare,EqualDepth,EqualStencilFunc,EquirectangularReflectionMapping,EquirectangularRefractionMapping,Euler,EventDispatcher,ExtrudeGeometry,FileLoader,Float16BufferAttribute,Float32BufferAttribute,FloatType,Fog,FogExp2,FramebufferTexture,FrontSide,Frustum,GLBufferAttribute,GLSL1,GLSL3,GreaterCompare,GreaterDepth,GreaterEqualCompare,GreaterEqualDepth,GreaterEqualStencilFunc,GreaterStencilFunc,GridHelper,Group,HalfFloatType,HemisphereLight,HemisphereLightHelper,IcosahedronGeometry,ImageBitmapLoader,ImageLoader,ImageUtils,IncrementStencilOp,IncrementWrapStencilOp,InstancedBufferAttribute,InstancedBufferGeometry,InstancedInterleavedBuffer,InstancedMesh,Int16BufferAttribute,Int32BufferAttribute,Int8BufferAttribute,IntType,InterleavedBuffer,InterleavedBufferAttribute,Interpolant,InterpolateDiscrete,InterpolateLinear,InterpolateSmooth,InvertStencilOp,KeepStencilOp,KeyframeTrack,LOD,LatheGeometry,Layers,LessCompare,LessDepth,LessEqualCompare,LessEqualDepth,LessEqualStencilFunc,LessStencilFunc,Light,LightProbe,LightShadow,Line,Line3,LineBasicMaterial,LineCurve,LineCurve3,LineDashedMaterial,LineLoop,LineSegments,LinearDisplayP3ColorSpace,LinearFilter,LinearInterpolant,LinearMipMapLinearFilter,LinearMipMapNearestFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,LinearSRGBColorSpace,LinearToneMapping,LinearTransfer,Loader,LoaderUtils,LoadingManager,LoopOnce,LoopPingPong,LoopRepeat,LuminanceAlphaFormat,LuminanceFormat,MOUSE,Material,MaterialLoader,MathUtils,Matrix3,Matrix4,MaxEquation,Mesh,MeshBasicMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshLambertMaterial,MeshMatcapMaterial,MeshNormalMaterial,MeshPhongMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshToonMaterial,MinEquation,MirroredRepeatWrapping,MixOperation,MultiplyBlending,MultiplyOperation,NearestFilter,NearestMipMapLinearFilter,NearestMipMapNearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,NeutralToneMapping,NeverCompare,NeverDepth,NeverStencilFunc,NoBlending,NoColorSpace,NoToneMapping,NormalAnimationBlendMode,NormalBlending,NotEqualCompare,NotEqualDepth,NotEqualStencilFunc,NumberKeyframeTrack,Object3D,ObjectLoader,ObjectSpaceNormalMap,OctahedronGeometry,OneFactor,OneMinusConstantAlphaFactor,OneMinusConstantColorFactor,OneMinusDstAlphaFactor,OneMinusDstColorFactor,OneMinusSrcAlphaFactor,OneMinusSrcColorFactor,OrthographicCamera,P3Primaries,PCFShadowMap,PCFSoftShadowMap,PMREMGenerator,Path,PerspectiveCamera,Plane,PlaneGeometry,PlaneHelper,PointLight,PointLightHelper,Points,PointsMaterial,PolarGridHelper,PolyhedronGeometry,PositionalAudio,PropertyBinding,PropertyMixer,QuadraticBezierCurve,QuadraticBezierCurve3,Quaternion,QuaternionKeyframeTrack,QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format,RED_RGTC1_Format,REVISION,RGBADepthPacking,RGBAFormat,RGBAIntegerFormat,RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:RGBA_S3TC_DXT3_Format$1,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format$1,RGBFormat,RGB_BPTC_SIGNED_Format,RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format:RGB_ETC1_Format$1,RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:RGB_S3TC_DXT1_Format$1,RGFormat,RGIntegerFormat,RawShaderMaterial,Ray,Raycaster,Rec709Primaries,RectAreaLight,RedFormat,RedIntegerFormat,ReinhardToneMapping,RenderTarget,RepeatWrapping,ReplaceStencilOp,ReverseSubtractEquation,RingGeometry,SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format,SRGBColorSpace,SRGBTransfer,Scene,ShaderChunk,ShaderLib,ShaderMaterial,ShadowMaterial,Shape,ShapeGeometry,ShapePath,ShapeUtils,ShortType,Skeleton,SkeletonHelper:SkeletonHelper$1,SkinnedMesh,Source,Sphere,SphereGeometry,Spherical,SphericalHarmonics3,SplineCurve,SpotLight,SpotLightHelper,Sprite,SpriteMaterial,SrcAlphaFactor,SrcAlphaSaturateFactor,SrcColorFactor,StaticCopyUsage,StaticDrawUsage,StaticReadUsage,StereoCamera,StreamCopyUsage,StreamDrawUsage,StreamReadUsage,StringKeyframeTrack,SubtractEquation,SubtractiveBlending,TOUCH,TangentSpaceNormalMap,TetrahedronGeometry,Texture,TextureLoader,TorusGeometry,TorusKnotGeometry,Triangle,TriangleFanDrawMode,TriangleStripDrawMode,TrianglesDrawMode,TubeGeometry,UVMapping,Uint16BufferAttribute,Uint32BufferAttribute,Uint8BufferAttribute,Uint8ClampedBufferAttribute,Uniform,UniformsGroup,UniformsLib,UniformsUtils,UnsignedByteType,UnsignedInt248Type,UnsignedInt5999Type,UnsignedIntType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedShortType,VSMShadowMap,Vector2,Vector3,Vector4,VectorKeyframeTrack,VideoTexture,WebGL3DRenderTarget,WebGLArrayRenderTarget,WebGLCoordinateSystem,WebGLCubeRenderTarget,WebGLMultipleRenderTargets,WebGLRenderTarget,WebGLRenderer,WebGLUtils,WebGPUCoordinateSystem,WireframeGeometry,WrapAroundEnding,ZeroCurvatureEnding,ZeroFactor,ZeroSlopeEnding,ZeroStencilOp,createCanvasElement},Symbol.toStringTag,{value:"Module"}));let c_base_url="";function set_base_url(s){c_base_url=s}function GenerateShortID$1(s=26){const e=[],i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<s;++r)e.push(i[Math.floor(Math.random()*i.length)]);return e.join("")}const md5=new function(){const e=[1732584193,4023233417,2562383102,271733878],i=e.length;this.hex=function(w){return d(r(w))},this.dec=function(w){return r(w)},this.bin=function(w){return h(r(w))};const r=function(w){let y=[];return o(w)?y=w:l(w)&&(y=m(w)),y=c(y),a(y)},o=function(w){return w&&w.constructor===[].constructor},l=function(w){return typeof w=="string"},a=function(w){let y=[],M=[],S,D,k,O=[];for(D=0;D<i;D++)y[D]=e[D];for(S=0;S<w.length;S+=64){for(D=0;D<i;D++)M[D]=y[D];for(O=f(w.slice(S,S+64)),D=0;D<64;D++)D<16?k=y[1]&y[2]|~y[1]&y[3]:D<32?k=y[1]&y[3]|y[2]&~y[3]:D<48?k=y[1]^y[2]^y[3]:k=y[2]^(y[1]|~y[3]),k+=O[_[D]]+v[D]+y[0],y[0]=y[1]+(k<<b[D]|k>>>32-b[D]),y=[y[3],y[0],y[1],y[2]];for(D=0;D<i;D++)y[D]+=M[D]}return u(y)},c=function(w){let y=w.length,M=y;for(w[M++]=128;M%64!=56;)w[M++]=0;return y*=8,w.concat(u([y]),0,0,0,0)},d=function(w){let y="";for(let M=0,S=w.length;M<S;M++)y+=(w[M]>15?"":"0")+w[M].toString(16);return y},u=function(w){const y=[];for(let M=0,S=0;S<w.length;S++)y[M++]=w[S]&255,y[M++]=w[S]>>>8&255,y[M++]=w[S]>>>16&255,y[M++]=w[S]>>>24&255;return y},f=function(w){const y=[];let M,S;for(S=M=0;M<w.length;M+=4,S++)y[S]=w[M+3]<<24|w[M+2]<<16|w[M+1]<<8|w[M];return y},m=function(w){let y,M,S,D=[];for(M=y=0;y<w.length;y++)S=w.charCodeAt(y),S<=255?D[M++]=S:(D[M++]=S>>>8,D[M++]=S&255);return D},h=function(w){let y,M="";for(y in w)M+=String.fromCharCode(w[y]);return M},_=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],b=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],v=[3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745]};async function any_hash(s){return md5.hex(s)}function generate_unique_name(s,e){if(e){let i=0;return e.traverse(r=>{s+String(i)==r?.name&&i++}),s+String(i)}return s}function get_url_query(s){const i=window.location.search.substring(1).split("&");for(let r=0;r<i.length;r++){const o=i[r].split("=");if(o[0]==s)return o[1]}}function get_window_width(){return window.innerWidth&&document.documentElement.clientWidth?Math.min(window.innerWidth,document.documentElement.clientWidth):window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth}function get_window_height(){return window.innerHeight&&document.documentElement.clientHeight?Math.min(window.innerHeight,document.documentElement.clientHeight):window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight}function find_object(s,e,i=5,r=0,o=["root"]){if(!s||typeof s!="object"||r==i)return;let l="";for(let a=0;a<r;a++)l+="  ";for(const a in s)a.toLocaleLowerCase().indexOf(e.toLowerCase())>=0&&console.log(l,o.concat([a]).join(" > ")),find_object(s[a],e,i,r+1,o.concat([a]))}function find_scene(s,e,i=null,r=5,o=0){let l=[];if(!s||typeof s!="object"||o==r)return l;(e==null||s.name.toLocaleLowerCase().indexOf(e.toLowerCase())>=0)&&(l.push(s),i&&i(s));for(const a in s.children)l=l.concat(find_scene(s.children[a],e,i,r,o+1));return l}function prevent_drag_and_drop_same_area(s){console.log(s);function e(i,r){if(i==r)return!0;let o=!1;for(let l=0;l<i.children.length;l++)o=o||e(i.children[l],r);return o}return e(s.target,document.activeElement)}function DPath(s){let e=s.replace(/\\/g,"/").normalize("NFC");e.indexOf("../")==-1&&(e=e.replace(/\.\//g,""));{let u=e;for(;u.indexOf("./")==0;)u=u.slice(2,u.length);e=u}const i=e.split("/").pop(),r=(i.lastIndexOf(".")>=0?i.split(".").pop():"").toLowerCase(),o=i.slice(0,i.lastIndexOf(".")>=0?i.lastIndexOf("."):i.length),l=e.slice(0,e.length-i.length),a=e.slice(0,10);let c=!1;(e.indexOf(":/")>0||e[0]=="/")&&(c=!0);let d=a.indexOf(":")>=0?a.split(":")[0]:"";return d.length>0&&(["http","https","s3","ftp","ftps"].includes(d.toLowerCase())||(d="file")),{is_absolute_path:c,protocol:d,path:e,name:o,basename:i,dirname:l,ext:r}}function DPathJoin(s,e){let i=[];for(let c=0;c<arguments.length;c++)if(Array.isArray(arguments[c]))for(let d=0;d<arguments[c].length;d++)i=i.concat(DPath(arguments[c][d]).path);else i=i.concat(DPath(arguments[c]).path);let r=[];for(let c=0;c<i.length;c++){let d=i[c];d.length>0&&(d.indexOf("//")>=0&&(d="/"+d.split("//").pop()),d[0]=="/"&&(r=[]),r.push(i[c]))}i=r;const o="/",l=new RegExp(o+"{1,}","g");return i.join(o).replace(l,o)}function path_join(s,e){const i=e||"/",r=new RegExp(i+"{1,}","g");return s.join(i).replace(r,i)}function path_basename(s){return s.split("/").pop()}function path_dirname(s){const e=s.split("/");return e.pop(),e.join("/")}function copy_prop(s,e){function i(r,o){for(let l in o)o[l]!==void 0&&(o[l]==null||typeof o[l]=="number"||typeof o[l]=="bigint"||typeof o[l]=="boolean"||typeof o[l]=="string"?r[l]=o[l]:typeof o[l]=="object"&&(r[l]==null&&(r[l]={}),i(r[l],o[l])))}i(s,e)}function sleep(s){return new Promise((e,i)=>setTimeout(e,s))}function to_array_buffer(s){const e=s?.constructor?.name;if(s instanceof ArrayBuffer||e==="ArrayBuffer")return s;if(s instanceof Uint8Array||e==="Uint8Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(typeof s=="string")return new TextEncoder().encode(s).buffer;if(e=="Buffer")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof Float32Array||e==="Float32Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof Uint8ClampedArray||e==="Uint8ClampedArray")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof Uint32Array||e==="Uint32Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof Int32Array||e==="Int32Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof DataView||e==="DataView")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof Int8Array||e==="Int8Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof Int16Array||e==="Int16Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof Uint16Array||e==="Uint16Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof Float64Array||e==="Float64Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof BigInt64Array||e==="BigInt64Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset);if(s instanceof BigUint64Array||e==="BigUint64Array")return s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset)}function to_uint8array(s){const e=s?.constructor?.name;if(s instanceof ArrayBuffer||e==="ArrayBuffer")return new Uint8Array(s);if(s instanceof Uint8Array||e==="Uint8Array")return s;if(typeof s=="string")return new TextEncoder().encode(s);if(e==="Buffer")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof Float32Array||e==="Float32Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof Uint8ClampedArray||e==="Uint8ClampedArray")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof Uint32Array||e==="Uint32Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof Int32Array||e==="Int32Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof DataView||e==="DataView")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof Int8Array||e==="Int8Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof Int16Array||e==="Int16Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof Uint16Array||e==="Uint16Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof Float64Array||e==="Float64Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof BigInt64Array||e==="BigInt64Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset));if(s instanceof BigUint64Array||e==="BigUint64Array")return new Uint8Array(s.buffer.slice(s.byteOffset,s.byteLength+s.byteOffset))}async function url_to_array_buffer(s){return(await fetch(s)).arrayBuffer()}async function blob_to_array_buffer(s){let e=to_array_buffer(s);if(e==null){if(s instanceof Blob)return await s.arrayBuffer()}else return e;return null}async function data_url_to_blob(s,e){let i=s.split(","),r=i[0].match(/:(.*?);/)[1],o=window.atob(i[1]),l=o.length,a=new Uint8Array(l);for(;l--;)a[l]=o.charCodeAt(l);const c=new Blob([a],{type:r});return e&&e(c),c}function blob_to_data_url(s,e){return new Promise((i,r)=>{const o=new FileReader;o.onload=function(l){e&&e(l.target.result),i(l.target.result)},o.onerror=function(l){e&&e(l),r(l)},o.readAsDataURL(s)})}function check_local_storage_sizes(){let s=0;for(const e in localStorage){if(!localStorage.hasOwnProperty(e))continue;const i=(localStorage[e].length+e.length)*2;s+=i,console.log(e.slice(0,50)+" = "+(i/1024).toFixed(2)+" KB")}console.log("Total = "+(s/1024).toFixed(2)+" KB")}function date_str(){const s=new Date,e=s.getMonth(),i=s.getDay(),r=s.getFullYear()+"",o=s.getHours(),l=s.getMinutes(),a=s.getSeconds(),c=String(i).padStart(2,"0"),d=String(e).padStart(2,"0"),u=String(o).padStart(2,"0"),f=String(l).padStart(2,"0"),m=String(a).padStart(2,"0");return`${r}-${d}-${c}_${u}-${f}-${m}`}function canvas_to_buffer(s,e={jpeg_quality:.95}){return new Promise((i,r)=>{const l=s.toDataURL("image/jpeg",e.jpeg_quality).replace(/^data:image\/(png|jpeg);base64,/,""),a=window.atob(l),c=new Uint8Array(a.length);for(let d=0;d<a.length;d++)c[d]=a.charCodeAt(d);i(c)})}let __modal_ok_cancel__=null,__modal_ok_input_behavior__=!0;function close_modal_confirmation(s){const e={force:!1};s&&Object.assign(e,s),__modal_ok_cancel__=null;const i=document.getElementById("common_modal_ok_cancel");i&&(e.force?i.remove():(setTimeout(()=>{i.remove()},100),i.style.animationName="fadeout_zoomout",i.style.animationDuration="0.1s")),window.removeEventListener("click",__modal_ok_cancel_on_click__,__modal_ok_input_behavior__),document.removeEventListener("keydown",__modal_ok_cancel_on_keydown__,__modal_ok_input_behavior__)}function __modal_ok_cancel_on_click__(s){}function __modal_ok_cancel_on_keydown__(s){if(s.code=="Escape")close_modal_confirmation();else if(s.code=="Enter"){const e=document.querySelector(".modalview_okbtn");e instanceof HTMLElement&&e.click(),close_modal_confirmation()}__modal_ok_input_behavior__&&(s.stopPropagation(),s.preventDefault())}function modal_ok_cancel(s,e,i={},r=o=>{}){document.getElementById("common_modal_ok_cancel")?.remove?.();const o=document.createElement("div");o.id="common_modal_ok_cancel",o.classList.add("modalview_modal"),o.style.cssText="animation-name: fadein_zoomin;animation-duration: 0.1s;",o.style.zIndex="999";const l={ok:"OK",cancel:"Cancel",prevent_input:!0};for(const _ in i)l[_]=i[_];l.prevent_input!==void 0&&(__modal_ok_input_behavior__=l.prevent_input);const a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("h1"),u=document.createElement("p"),f=document.createElement("div"),m=document.createElement("button"),h=document.createElement("button");o.appendChild(a),a.appendChild(c),c.appendChild(d),c.appendChild(u),c.appendChild(f),f.appendChild(m),f.appendChild(h),a.classList.add("modalview_modal_content"),c.classList.add("modalview_container"),d.classList.add("modalview_title"),u.classList.add("modalview_description"),typeof e=="string"?u.innerHTML=e:e instanceof HTMLElement&&u.appendChild(e),typeof s=="string"?d.innerHTML=s:s instanceof HTMLElement&&d.appendChild(s),u.style.padding="10px",f.classList.add("modalview_clearfix"),m.classList.add("modalview_cancelbtn"),h.classList.add("modalview_okbtn"),m.innerHTML=l.cancel,h.innerHTML=l.ok,l.cancel?m.style.display="inline-block":m.style.display="none",h.style.display="inline-block",h.style.boxShadow="0 0 0 1pt #AAAAFF77",document.body.appendChild(o),__modal_ok_cancel__=o,h.onclick=_=>{r(!0),close_modal_confirmation()},m.onclick=_=>{r(!1),close_modal_confirmation()},o.style.display="block",document.addEventListener("keydown",__modal_ok_cancel_on_keydown__,__modal_ok_input_behavior__),window.addEventListener("click",__modal_ok_cancel_on_click__,__modal_ok_input_behavior__)}function modal_ok(s,e,i={},r=o=>{}){const o=i||{};return o.cancel=null,modal_ok_cancel(s,e,o,r)}function modal_ok_cancel_promise(s,e,i={}){return new Promise((r,o)=>{const l=document.createElement("div");document.getElementById("common_modal_ok_cancel")?.remove?.(),close_modal_processing(),l.id="common_modal_ok_cancel",l.classList.add("modalview_modal"),l.style.cssText="animation-name: fadein_zoomin;animation-duration: 0.1s;",l.style.zIndex="999";const a={ok:"OK",cancel:"Cancel",prevent_input:!0};i&&Object.assign(a,i),a.prevent_input!==void 0&&(__modal_ok_input_behavior__=a.prevent_input),e instanceof HTMLElement?(l.innerHTML=`
<form class="modalview_modal_content"><div class="modalview_container">
<h1 class="modalview_title">${s}</h1>
<p style="padding:10px;" class="modalview_description"></p>
<div class="modalview_clearfix">
<button type="button" class="modalview_cancelbtn" style="${a.cancel==null?"display:none":"display:inline-block;"}">${a.cancel}</button>
<button type="button" class="modalview_okbtn" style='display:inline-block;box-shadow: 0 0 0 1pt #AAAAFF77;'>${a.ok}</button>
</div>
</div></form>
        `,l.getElementsByClassName("modalview_description")[0].appendChild(e)):l.innerHTML=`
      <form class="modalview_modal_content">
      <div class="modalview_container">
        <h1 class="modalview_title">${s}</h1>
        <p style="padding:10px;" class="modalview_description">${e}</p>
        <div class="modalview_clearfix">
        <button type="button" class="modalview_cancelbtn" style="${a.cancel==null?"display:none":"display:inline-block;"}">${a.cancel}</button>
        <button type="button" class="modalview_okbtn" style='display:inline-block;box-shadow: 0 0 0 1pt #AAAAFF77;'>${a.ok}</button>
        </div>
      </div>
      </form>
        `,document.body.appendChild(l),setTimeout(function(){__modal_ok_cancel__=document.querySelector(".modalview_modal");const c=__modal_ok_cancel__.querySelector(".modalview_okbtn"),d=__modal_ok_cancel__.querySelector(".modalview_cancelbtn");__modal_ok_cancel__ instanceof HTMLElement&&(__modal_ok_cancel__.style.display="block"),c instanceof HTMLElement&&(c.onclick=u=>{r(!0),close_modal_confirmation()}),d instanceof HTMLElement&&(d.onclick=u=>{r(!1),close_modal_confirmation()}),document.addEventListener("keydown",__modal_ok_cancel_on_keydown__,__modal_ok_input_behavior__),window.addEventListener("click",__modal_ok_cancel_on_click__,__modal_ok_input_behavior__)},1)})}let __modal_image__=null;function close_modal_image(s){const e={force:!1};s&&Object.assign(e,s);const i=document.getElementById("common_modalview_modal_image");i&&(e.force?i.remove():setTimeout(()=>{i.remove()},100)),window.removeEventListener("click",__modal_image__onclick__,!0),document.removeEventListener("keyup",__modal_image__on_keydown__,!0),__modal_image__=null}function __modal_image__onclick__(s){s.target==__modal_image__&&close_modal_image(),s.preventDefault(),s.stopPropagation()}function __modal_image__on_keydown__(s){close_modal_image()}function modal_image(s){const e=document.createElement("div");document.getElementById("common_modalview_modal_image")?.remove?.(),e.id="common_modalview_modal_image",e.classList.add("modalview_modal_image"),e.innerHTML=`
  <img draggable="false" src="${s}" style="animation-name: fadein_zoomin;animation-duration: 0.05s;object-fit: contain;width:calc( 100% - 200px );height:calc( 100% - 200px );padding:100px;pointer-events: none;" onclick="close_modal_image()">
  `,document.body.appendChild(e),__modal_image__=document.querySelector(".modalview_modal_image");const i=document.querySelector(".modalview_modal_image");i instanceof HTMLElement&&(i.style.display="block"),window.addEventListener("click",__modal_image__onclick__,!0),document.addEventListener("keyup",__modal_image__on_keydown__,!0)}function close_modal_processing(){const s=document.getElementById("common_modal_processing");s&&s.remove()}function stop_processing_icon(){const s=document.getElementById("common_modal_loading_icon");s&&s.remove()}function modal_processing(s,e,i={}){const r={facein_animation:!0,loading_icon:!0,no_alpha:!1};i&&Object.assign(r,i);const o=document.createElement("div");o.id="common_modal_processing",o.classList.add("modalview_modal"),r.no_alpha&&o.classList.add("modalview_modal_no_alpha"),o.style.cssText=`${r.facein_animation?"animation-name: fadein_zoomin;animation-duration: 0.05s;":""}`,o.style.zIndex="999",o.innerHTML=`<form class="modalview_modal_content">
<div class="modalview_container">
<h1 class="modalview_title">${s}</h1>
${r.loading_icon?'<p><div id="common_modal_loading_icon" class="loader"></div></p>':""}
<p style="padding:10px;overflow:hidden;" class="modalview_description" id="modalview_description">${e||""}</p>
</div>
</form>`,document.body.appendChild(o);const l=document.querySelector(".modalview_modal");return l instanceof HTMLElement&&(l.style.display="block"),close_modal_processing}function modal_processing_update_description(s){const e=document.getElementById("modalview_description");e&&(e.innerHTML=s)}function modal_processing_update_progress(s,e,i){const r=document.getElementById("modalview_description");let o=`
  <progress id="_processing_" max="1" value="${s/e}" style="width:100%;margin:0px;padding:0px;height:4px"></progress><br>
  ${s}/${e}<br>
  ${i||""}
  `;r&&(r.innerHTML=o)}function modal_processing_replace_description_by_id(s,e){const i=document.getElementById("modalview_description");if(i){const r="_"+md5.hex(s),o=i.querySelector("#"+r);if(o)o.innerHTML=e;else{const l=document.createElement("div");l.id=r,l.innerHTML=e,i.appendChild(l)}}}function modal_processing_delete_description_by_id(s){const e=document.getElementById("modalview_description");if(e){const i="_"+md5.hex(s),r=e.querySelector("#"+i);r&&r.remove()}}function bind_as_drop_component(s,e){const i=navigator.userAgent.toLowerCase().indexOf("electron")!==-1,r=window.UC,o=async function(c){c.preventDefault(),c.stopPropagation(),s.classList.remove("dragover");const d=c.dataTransfer.types.includes("Files"),u=c.dataTransfer.types.includes("json"),f=c.dataTransfer.getData("json");if(u&&f.length>0){const m=JSON.parse(f);if(m.target_file_paths){const h=m.target_file_paths[0];h&&e(h.absolute_path)}}else if(d){const h=(await r.get_dropped_items(c)).files;if(c.dataTransfer.items&&h.length>0){const _=h[0];if(i){const b=_.file.path;e(b.replace(/\\/g,"/"))}else{const v=await function(w){return new Promise((y,M)=>{const S=new FileReader;S.readAsDataURL(w),S.onloadend=function(){y(S.result)},S.onerror=function(D){M(D)}})}(_.file);e(v)}}}};function l(c){s.classList.add("dragover"),c.stopPropagation(),c.preventDefault()}function a(c){s.classList.remove("dragover"),c.stopPropagation(),c.preventDefault()}s.ondrop=o,s.ondragover=l,s.ondragleave=a}function popup_menu(s,e,i,r){setTimeout(()=>{const l=document.createElement("div");l.style.zIndex="100",l.classList.add("popup_menu_dropdown-content");let a=0;for(const _ of e){if(_==null)continue;const b=typeof _=="string"?_:_.key,v=typeof _=="string"?_:_.value;if(b=="---"){const w=document.createElement("hr");w.style.border="0px",w.style.borderTop="1px solid #555",w.style.marginTop="3px",w.style.marginBottom="3px",l.appendChild(w)}else if(b!=""){const w=document.createElement("a");w.innerHTML=b;const y=a;w.onmousedown=function(M){M.stopPropagation(),M.preventDefault()},w.onclick=function(M){M.stopPropagation(),M.preventDefault()},w.onmouseup=function(M){M.stopPropagation(),M.preventDefault(),r(v,y,_),l.remove()},l.appendChild(w)}a++}l.classList.add("no_select"),i?.dom?i.dom.appendChild(l):document.body.appendChild(l);const c=l.getBoundingClientRect(),d=s.clientX,u=s.clientY,f=Math.floor(c.height),m=Math.floor(c.width);window.innerHeight<u+f?window.innerHeight<f?l.style.top=`${u}px`:l.style.top=`${window.innerHeight-f}px`:l.style.top=u-2+"px",window.innerWidth<d+m?window.innerWidth<m?l.style.left=`${window.innerWidth-m/2}px`:l.style.left=`${window.innerWidth-m}px`:l.style.left=d+3+"px";function h(_){i?.event_listener&&i.event_listener(_),setTimeout(()=>{l.remove(),window.removeEventListener("click",h,!1),window.removeEventListener("contextmenu",h,!1),window.removeEventListener("focus",h,!1),window.removeEventListener("blur",h,!1),document.removeEventListener("keydown",h,!1)},0)}setTimeout(()=>{window.addEventListener("contextmenu",h,!1),window.addEventListener("focus",h,!1),window.addEventListener("blur",h,!1),window.addEventListener("click",h,!1),document.addEventListener("keydown",h,!1)},0)},navigator.userAgent.toLowerCase().indexOf("electron")!==-1?1:100)}function extract_zip(s,e={tmp:!1}){const i={tmp:!1};return e&&Object.assign(i,e),new Promise(async(r,o)=>{if(s.length>0)await __vitePreload(()=>import("./jszip.min@TY6z0PXt.js"),[],import.meta.url);else{r();return}const l=C.clone(s).filter(c=>C.DPath(c).ext.toLowerCase()=="zip");if(l.length==0){r();return}let a=0;for(const c of l){console.log("Loading:",c);const d=await window.cross_file_system.read(c);console.log("Extracting:",c);const u=await JSZip.loadAsync(d,{createFolders:!0,checkCRC32:!0});let f=0;const m=Object.keys(u.files);for(const h of m){const _=await u.files[h].async("arrayBuffer");f++,console.log(`Extracting1:(${f}/${m.length})`);const b=C.DPath(c);let v=C.DPathJoin(b.dirname,b.name);i.tmp&&(v=await window.cross_file_system.tmp_dir());const w=C.DPath(C.DPathJoin(v,h));if(console.log(`Extracting2:(${f}/${m.length})`),await window.cross_file_system.mkdir(w.dirname,{recursive:!0}),console.log(`Extracting3:(${f}/${m.length})`,h),C.modal_processing_update_progress(f,m.length,h),h[h.length-1]=="/")continue;console.log(`Extracting4:(${f}/${m.length})`,w.path),await window.cross_file_system.write(w.path,_);const y=C.file_type(w.path);(y=="model"||y=="project"||y=="j_object")&&s.push(w.path),console.log(f,m.length),f==m.length&&(a++,a==l.length&&r())}}})}function assertPath(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function normalizeStringPosix(s,e){let i="",r=0,o=-1,l=0,a;for(let c=0;c<=s.length;++c){if(c<s.length)a=s.charCodeAt(c);else{if(a===47)break;a=47}if(a===47){if(!(o===c-1||l===1))if(o!==c-1&&l===2){if(i.length<2||r!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){let d=i.lastIndexOf("/");if(d!==i.length-1){d===-1?(i="",r=0):(i=i.slice(0,d),r=i.length-1-i.lastIndexOf("/")),o=c,l=0;continue}}else if(i.length===2||i.length===1){i="",r=0,o=c,l=0;continue}}e&&(i.length>0?i+="/..":i="..",r=2)}else i.length>0?i+="/"+s.slice(o+1,c):i=s.slice(o+1,c),r=c-o-1;o=c,l=0}else a===46&&l!==-1?++l:l=-1}return i}function _format(s,e){let i=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return i?i===e.root?i+r:i+s+r:r}let posix={resolve:function s(){let e="",i=!1,r;for(let o=arguments.length-1;o>=-1&&!i;o--){let l;o>=0?l=arguments[o]:(r===void 0&&(r=process.cwd()),l=r),assertPath(l),l.length!==0&&(e=l+"/"+e,i=l.charCodeAt(0)===47)}return e=normalizeStringPosix(e,!i),i?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function s(e){if(assertPath(e),e.length===0)return".";let i=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=normalizeStringPosix(e,!i),e.length===0&&!i&&(e="."),e.length>0&&r&&(e+="/"),i?"/"+e:e},isAbsolute:function s(e){return assertPath(e),e.length>0&&e.charCodeAt(0)===47},join:function s(){if(arguments.length===0)return".";let e;for(let i=0;i<arguments.length;++i){let r=arguments[i];assertPath(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":posix.normalize(e)},relative:function s(e,i){if(assertPath(e),assertPath(i),e===i||(e=posix.resolve(e),i=posix.resolve(i),e===i))return"";let r=1;for(;r<e.length&&e.charCodeAt(r)===47;++r);let o=e.length,l=o-r,a=1;for(;a<i.length&&i.charCodeAt(a)===47;++a);let d=i.length-a,u=l<d?l:d,f=-1,m=0;for(;m<=u;++m){if(m===u){if(d>u){if(i.charCodeAt(a+m)===47)return i.slice(a+m+1);if(m===0)return i.slice(a+m)}else l>u&&(e.charCodeAt(r+m)===47?f=m:m===0&&(f=0));break}let _=e.charCodeAt(r+m),b=i.charCodeAt(a+m);if(_!==b)break;_===47&&(f=m)}let h="";for(m=r+f+1;m<=o;++m)(m===o||e.charCodeAt(m)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+i.slice(a+f):(a+=f,i.charCodeAt(a)===47&&++a,i.slice(a))},_makeLong:function s(e){return e},dirname:function s(e){if(assertPath(e),e.length===0)return".";let i=e.charCodeAt(0),r=i===47,o=-1,l=!0;for(let a=e.length-1;a>=1;--a)if(i=e.charCodeAt(a),i===47){if(!l){o=a;break}}else l=!1;return o===-1?r?"/":".":r&&o===1?"//":e.slice(0,o)},basename:function s(e,i){if(i!==void 0&&typeof i!="string")throw new TypeError('"ext" argument must be a string');assertPath(e);let r=0,o=-1,l=!0,a;if(i!==void 0&&i.length>0&&i.length<=e.length){if(i.length===e.length&&i===e)return"";let c=i.length-1,d=-1;for(a=e.length-1;a>=0;--a){let u=e.charCodeAt(a);if(u===47){if(!l){r=a+1;break}}else d===-1&&(l=!1,d=a+1),c>=0&&(u===i.charCodeAt(c)?--c===-1&&(o=a):(c=-1,o=d))}return r===o?o=d:o===-1&&(o=e.length),e.slice(r,o)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!l){r=a+1;break}}else o===-1&&(l=!1,o=a+1);return o===-1?"":e.slice(r,o)}},extname:function s(e){assertPath(e);let i=-1,r=0,o=-1,l=!0,a=0;for(let c=e.length-1;c>=0;--c){let d=e.charCodeAt(c);if(d===47){if(!l){r=c+1;break}continue}o===-1&&(l=!1,o=c+1),d===46?i===-1?i=c:a!==1&&(a=1):i!==-1&&(a=-1)}return i===-1||o===-1||a===0||a===1&&i===o-1&&i===r+1?"":e.slice(i,o)},format:function s(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return _format("/",e)},parse:function s(e){assertPath(e);let i={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return i;let r=e.charCodeAt(0),o=r===47,l;o?(i.root="/",l=1):l=0;let a=-1,c=0,d=-1,u=!0,f=e.length-1,m=0;for(;f>=l;--f){if(r=e.charCodeAt(f),r===47){if(!u){c=f+1;break}continue}d===-1&&(u=!1,d=f+1),r===46?a===-1?a=f:m!==1&&(m=1):a!==-1&&(m=-1)}return a===-1||d===-1||m===0||m===1&&a===d-1&&a===c+1?d!==-1&&(c===0&&o?i.base=i.name=e.slice(1,d):i.base=i.name=e.slice(c,d)):(c===0&&o?(i.name=e.slice(1,a),i.base=e.slice(1,d)):(i.name=e.slice(c,a),i.base=e.slice(c,d)),i.ext=e.slice(a,d)),c>0?i.dir=e.slice(0,c-1):o&&(i.dir="/"),i},sep:"/",delimiter:":",win32:null,posix:null};posix.posix=posix;function is_image_ext(s){return["png","jpg","jpeg","gif","bmp","tiff","tif","webp","avif","svg","tga","hdr","hdri","exr","etc","etc1","etc2","ktx","ktx2","dds","s3tc","pvr","pvrtc"].includes(s)}function is_env_image_ext(s){return["hdr","hdri","exr"].includes(s)}function is_sound_ext(s){return["wav","mp3","m3a","m4a","aac","ogg","aiff","oga","mogg","opus","raw","wma"].includes(s)}function is_video_ext(s){return["webm","mp4","avi","3gp","ogv","mpeg","mov","mkv","flv","wmv","m4v"].includes(s)}function is_model_ext(s){return["pmx","gltf","glb","obj","vrm","3ds","dae","fbx","lwo","drc","stl","ply","mqo","usdz"].includes(s)}function is_motion_ext(s){return["vmd","bvh","fba","gla"].includes(s)}function is_pose_ext(s){return["vpd"].includes(s)}function is_etc_ext(s){return["mtl"].includes(s)}function is_j_object_ext(s){return["scene","object","motion","operator","material"].includes(s)}function is_script_ext(s){return["js","mjs","txt","json","css","scss","html","ts","c","cpp","md","cs","py","jsm","wasm","rb","csv"].includes(s)}function file_type(s){s=s.replace(/\\/g,"/");let e=s.split(".").pop().toLowerCase();return is_model_ext(e)?"model":is_motion_ext(e)?"motion":is_pose_ext(e)?"pose":is_sound_ext(e)?"sound":is_video_ext(e)?"video":is_image_ext(e)?"image":is_script_ext(e)?"script":is_etc_ext(e)?"etc":is_j_object_ext(e)?"j_object":e=="mmd"||e=="ddd"?"project":"unknown"}function file_type2(s){s=s.replace(/\\/g,"/");let e=s.split(".").pop().toLowerCase();return is_model_ext(e)||is_j_object_ext(e)?"model+j_object":is_motion_ext(e)||is_pose_ext(e)||is_sound_ext(e)?"action+sound":is_image_ext(e)?"image":is_video_ext(e)?"video":is_script_ext(e)?"script":is_etc_ext(e)?"etc":e=="mmd"||e=="ddd"?"project":"unknown"}const available_app_exts=["pmx","gltf","glb","fbx","obj","vrm","3ds","dar","lwo","drc","stl","ply","mtl","wav","mp3","m3a","acc","ogg","m4a","js","mjs","json","vmd","bvh","vpd","hdr","exr","object","material","motion","operator","ddd","mmd"];function nodejs_finder_sync(s,e=[]){const i=window.nodejs.fs,r=window.nodejs.path,o=["isBlockDevice","isCharacterDevice","isDirectory","isFIFO","isFile","isSocket","isSymbolicLink"];e=e.map(c=>c.toLowerCase());function l(c,d){const u={name:d.name};for(let m of o)u[m]=d[m]();const f=r.join(c,d.name);if(u.real_path=u.absolute_path=f,u.isSymbolicLink)try{u.real_path=i.realpathSync(f);const m=i.statSync(u.real_path);for(const h of o)u[h]=m[h]()}catch(m){console.error(m)}return u.isFile&&(u.ext=r.extname(u.name).split(".").pop().toLowerCase()),u}const a=(c,d=[])=>{const u=i.readdirSync(c,{withFileTypes:!0}),f=[];for(const m of u){const h=l(c,m);h.isDirectory?f.push(a(h.absolute_path,d)):h.isFile&&(d.length==0||d.includes(h.ext))&&f.push(h)}return f.flat()};return a(s,e)}async function nodejs_finder(s,e=[]){const i=window.nodejs.fs.promises,r=window.nodejs.path,o=["isBlockDevice","isCharacterDevice","isDirectory","isFIFO","isFile","isSocket","isSymbolicLink"];e=e.map(c=>c.toLowerCase());async function l(c,d){const u={name:d.name};for(let m of o)u[m]=d[m]();const f=r.join(c,d.name);if(u.real_path=u.absolute_path=f,u.isSymbolicLink)try{u.real_path=await i.realpath(f);const m=await i.stat(u.real_path);for(const h of o)u[h]=m[h]()}catch(m){console.error(m)}return u.isFile&&(u.ext=r.extname(u.name).split(".").pop().toLowerCase()),u}const a=async(c,d=[])=>{const u=await i.readdir(c,{withFileTypes:!0}),f=[],m=[];for(const b of u)m.push(l(c,b));const h=await Promise.all(m),_=[];for(const b of h)b.isDirectory?_.push(a(b.absolute_path,d)):b.isFile&&(d.length==0||d.includes(b.ext))&&f.push(b);for(const b of _)f.push(await b);return f.flat()};return await a(s,e)}function load_js(s){console.error(s);const e=DPathJoin("ddd",s);return new Promise((i,r)=>{const o=document.createElement("script");o.onload=function(l){i(l)},o.onerror=function(l){r(l)},o.src=e,document.documentElement.firstChild.appendChild(o)})}function clone(s,e=void 0,i=void 0){return JSON.parse(JSON.stringify(s,e,i))}let COMMON_WORKER=null;function get_common_worker(){return COMMON_WORKER==null&&(COMMON_WORKER=new Worker(DPathJoin(c_base_url,"common.worker.js")),COMMON_WORKER.mutex=!1),COMMON_WORKER}async function execute_in_other_thread(s,e={},i={}){const r={transfers:[]};return i&&Object.assign(r,i),new Promise(async(o,l)=>{const a=get_common_worker();for(;a.mutex;)await sleep(50);a.mutex=!0,a.onmessage=c=>{a.mutex=!1,o(c?.data)},a.onerror=c=>{a.mutex=!1,l(c)},a.postMessage({code:s,params:e},r.transfers)})}async function s_encode_and_store(s,e){const i={file_path:s,data:e};if(s==null)throw new Error("file_path is null");return execute_in_other_thread(`async function func() {
try {
    const obj = JSON.stringify(params.data);
    const j = JSON.stringify(obj).normalize("NFC");
    const encoder = new TextEncoder();
    const data_uint8array = encoder.encode(j);
    if (!(data_uint8array instanceof Uint8Array)) console.warn("encode:data_uint8array is not an Uint8Array");
    const compressedStream = new Blob([data_uint8array]).stream().pipeThrough(new CompressionStream("gzip"));

    
    let compressed_buffer;
    if (typeof process !== 'undefined' && process.versions && process.versions.electron) {
        const reader = compressedStream.getReader();
        let chunks = [];
        let done, value;
        while ({ done, value } = await reader.read(), !done) {
            chunks.push(value);
        }
        const compressedBuffer = new Uint8Array(chunks.reduce((acc, chunk) => acc + chunk.length, 0));
        let offset = 0;
        for (let chunk of chunks) {
            compressedBuffer.set(chunk, offset);
            offset += chunk.length;
        }
        compressed_buffer = compressedBuffer.buffer;
    } else {
        compressed_buffer = await new Response(compressedStream).arrayBuffer();
    }

    if (!(compressed_buffer instanceof ArrayBuffer)) console.warn("decode:extracted_buffer is not an ArrayBuffer");
    nodejs.fs.writeFileSync(params.file_path,new Uint8Array(compressed_buffer));
    console.log("Saved to", params.file_path);
    return null;
} catch(e) {
    console.error(e);
}};func();
  `,i)}async function s_decode_async(s){if(window.nodejs){const r=(await window.nodejs.util.promisify(window.nodejs.zlib.gunzip)(s)).toString("utf-8");return JSON.parse(r)}else{const e=new Blob([s]).stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(e).json()}}async function s_encode_async(s){const e=JSON.stringify(s).normalize("NFC"),r=new TextEncoder().encode(e);r instanceof Uint8Array||console.warn("encode:data_uint8array is not an Uint8Array");const o=new Blob([r]).stream().pipeThrough(new CompressionStream("gzip"));if(window.nodejs){const l=o.getReader();let a=[],c,d;for(;{done:c,value:d}=await l.read(),!c;)a.push(d);const u=new Uint8Array(a.reduce((m,h)=>m+h.length,0));let f=0;for(let m of a)u.set(m,f),f+=m.length;return to_array_buffer(u)}else{const l=await new Response(o).arrayBuffer();return l instanceof ArrayBuffer||console.warn("decode:extracted_buffer is not an ArrayBuffer"),to_uint8array(l)}}function b_decode(s){const i=new TextDecoder().decode(to_uint8array(s));return JSON.parse(i)}function undo_redo_controller(){const s={stack:[],index:0,undo(){s.index--,s.index<0?s.index=0:s.stack[s.index]?.undo?.()},redo(){s.index++,s.index>s.stack.length?s.index=s.stack.length:s.stack[s.index-1]?.redo?.()},push(e){const i=s.stack.slice(0,s.index),r=s.stack.slice(i.length,s.stack.length);for(const o of r)o.destroy();s.stack=i,s.stack.push(e),s.index++}};return s}function make_thumbnail_path(s){s=s.replace(/\\/g,"/");const e=s.split("/").pop(),i=e.lastIndexOf(".")>=0?e.split(".").pop():"";return s.slice(0,s.length-e.length)+"."+e.slice(0,e.length-i.length)+"avif"}function _load_icon_(s,e,i){return new Promise((r,o)=>{const l=document.createElement("img");l.onload=function(){let a=l.naturalWidth,c=0,d=0;if(l.naturalWidth>l.naturalHeight){const h=l.naturalWidth-l.naturalHeight;a=l.naturalHeight,c=Math.round(h/2)}else{const h=l.naturalHeight-l.naturalWidth;a=l.naturalWidth,d=Math.round(h/2)}const u=document.createElement("canvas"),f=u.getContext("2d");f.canvas.width=e,f.canvas.height=i,f.imageSmoothingEnabled=!1,f.drawImage(l,c,d,a,a,0,0,e,i);const m=document.createElement("img");m.src=u.toDataURL(),m.onload=function(){r(m)}},l.onerror=function(a){console.error(a),o(a)},l.src=s})}function _load_image_(s){return new Promise(async(e,i)=>{const r=document.createElement("img");let o=null;try{typeof s=="string"?o=await window.cross_file_system.read(s):o=to_array_buffer(s);const l=new Blob([o],{type:"application/octet-binary"}),a=window.URL.createObjectURL(l);r.onload=function(){window.URL.revokeObjectURL(a),e(r)},r.onerror=function(c){window.URL.revokeObjectURL(a),i(c)},r.src=a}catch(l){i(l)}})}function make_thumbnail_from_input(s,e={}){const i={type:"buffer",w:null,h:null,jpeg_quality:.8,square:!1,icon_path:null};return e&&Object.assign(i,e),new Promise(async(r,o)=>{try{const l=await _load_image_(s),a=document.createElement("canvas"),c=a.getContext("2d");if(i.square){let d=l.naturalWidth,u=0,f=0;if(l.naturalWidth>l.naturalHeight){const h=l.naturalWidth-l.naturalHeight;d=l.naturalHeight,u=Math.round(h/2)}else{const h=l.naturalHeight-l.naturalWidth;d=l.naturalWidth,f=Math.round(h/2)}c.imageSmoothingEnabled=!1;const m=i.w||d;if(c.canvas.width=m,c.canvas.height=m,c.drawImage(l,u,f,d,d,0,0,m,m),i.icon_path){const h=await _load_icon_(i.icon_path,m/3,m/3);c.drawImage(h,m/3*2,m/3*2)}sharpen(c,d,d,.25)}else{c.imageSmoothingEnabled=!1;const d=c.canvas.width,u=c.canvas.height,f=c.canvas.width=i.w||d,m=c.canvas.height=i.h||u;if(c.drawImage(l,0,0,l.naturalWidth,l.naturalHeight,0,0,f,m),i.icon_path){const h=await _load_icon_(i.icon_path,f/3,f/3);c.drawImage(h,d/3*2,d/3*2)}sharpen(c,d,d,.25)}if(i.type=="buffer"){const u=a.toDataURL("image/jpeg",i.jpeg_quality).replace(/^data:image\/(png|jpeg);base64,/,""),f=window.atob(u),m=new Uint8Array(f.length);for(let h=0;h<f.length;h++)m[h]=f.charCodeAt(h);r(m)}else if(i.type=="canvas")r(a);else{const u=a.toDataURL("image/jpeg",i.jpeg_quality).replace(/^data:image\/(png|jpeg);base64,/,""),f=window.atob(u),m=new Uint8Array(f.length);for(let h=0;h<f.length;h++)m[h]=f.charCodeAt(h);r({buffer:m,canvas:a})}}catch(l){o(l)}})}function sharpen(s,e,i,r){let o=[0,-1,0,-1,5,-1,0,-1,0],l=Math.round(Math.sqrt(o.length)),a=l*.5|0,c=s.createImageData(e,i),d=c.data,u=s.getImageData(0,0,e,i).data,f=i;for(;f--;){let m=e;for(;m--;){let h=f,_=m,b=(f*e+m)*4,v=0,w=0,y=0,M=0;for(let S=0;S<l;S++)for(let D=0;D<l;D++){let k=h+S-a,O=_+D-a;if(k>=0&&k<i&&O>=0&&O<e){let L=(k*e+O)*4,P=o[S*l+D];v+=u[L]*P,w+=u[L+1]*P,y+=u[L+2]*P,M+=u[L+3]*P}}d[b]=v*r+u[b]*(1-r),d[b+1]=w*r+u[b+1]*(1-r),d[b+2]=y*r+u[b+2]*(1-r),d[b+3]=u[b+3]}}s.putImageData(c,0,0)}function take_screenshot_raw(s={}){const e=DMC;window.debug&&console.log("take_screenshot_raw");const i={type:"buffer",filename:s?.thumbnail?"canvas.avif":"canvas.png",sharpen:0,w:null,h:null,jpeg_quality:.8,avif_quality:90,square:!1,icon_path:null};return s&&Object.assign(i,s),new Promise((r,o)=>{const l=e.base_renderer,a=e.current.camera||e.camera,c=e.scene;e.getRenderer().render(c,a,0);const u=C.DPath(i.filename).ext.toLowerCase();if(i.type=="download"){const _=document.createElement("a");_.href=l.domElement.toDataURL().replace("image/png","image/octet-stream"),_.download=i.filename,_.click(),setTimeout(()=>{r(null)},1e3);return}let f="image/jpeg";u=="png"?f="image/png":u=="jpg"||u=="jpeg"?f="image/jpeg":u=="gif"&&(f="image/gif");const m=new Image;m.src=l.domElement.toDataURL(f);const h=setTimeout(()=>{o("Your browser is having critical issue. Required relaunch the browser.(Not reload)")},5e3);m.onload=async function(){clearTimeout(h);const _=document.createElement("canvas");_.width=l.domElement.width,_.height=l.domElement.height;const b=_.getContext("2d");if(i.square){let v=m.naturalWidth,w=0,y=0;if(m.naturalWidth>m.naturalHeight){const S=m.naturalWidth-m.naturalHeight;v=m.naturalHeight,w=Math.round(S/2)}else{const S=m.naturalHeight-m.naturalWidth;v=m.naturalWidth,y=Math.round(S/2)}b.imageSmoothingEnabled=!1;let M=i.w||v;if(b.canvas.width=M,b.canvas.height=M,b.drawImage(m,w,y,v,v,0,0,M,M),i.icon_path){let S=await _load_icon_(i.icon_path,M/3,M/3);b.drawImage(S,M/3*2,M/3*2)}i.sharpen>0&&sharpen(b,v,v,i.sharpen)}else{b.imageSmoothingEnabled=!1;let v=b.canvas.width,w=b.canvas.height,y=b.canvas.width=i.w||v,M=b.canvas.height=i.h||w;if(b.drawImage(m,0,0,m.naturalWidth,m.naturalHeight,0,0,y,M),i.icon_path){const S=await _load_icon_(i.icon_path,y/3,y/3);b.drawImage(S,v/3*2,v/3*2)}i.sharpen>0&&sharpen(b,v,v,i.sharpen)}if(i.type=="buffer")if(u=="avif"){const v=await __vitePreload(()=>import("./avif@Na9ph3od.js"),[],import.meta.url),y=b.getImageData(0,0,b.canvas.width,b.canvas.height).data.buffer,M=await v.avif(new Uint8Array(y),b.canvas.width,b.canvas.height,i.avif_quality,6);r(M)}else{const w=_.toDataURL(f,i.jpeg_quality).replace(/^data:image\/(png|jpeg|gif);base64,/,""),y=window.atob(w),M=new Uint8Array(y.length);for(let S=0,D=y.length;S<D;++S)M[S]=y.charCodeAt(S);r(M)}else if(i.type=="canvas")r(_);else{const w=_.toDataURL(f,i.jpeg_quality).replace(/^data:image\/(png|jpeg|gif);base64,/,""),y=window.atob(w),M=new Uint8Array(y.length);for(let S=0,D=y.length;S<D;++S)M[S]=y.charCodeAt(S);r({buffer:M,canvas:_})}},m.onerror=function(_){clearTimeout(h),console.error(_),o(_)}})}function to_image(s){return new Promise(async(e,i)=>{const r=new Image;function o(l){return new Promise(async(a,c)=>{console.log(l);const d=new Blob([l],{type:"application/octet-binary"}),u=URL.createObjectURL(d),f=new Image;f.onload=()=>{URL.revokeObjectURL(u),a(f)},f.onerror=m=>{console.error(m),URL.revokeObjectURL(u),c(m)},f.src=u})}if(typeof s=="string")r.src=s,r.onload=function(){e(r)},r.onerror=function(l){i(l)};else if(s instanceof ArrayBuffer)e(await o(to_array_buffer(s)));else if(s instanceof Uint8Array)e(await o(to_array_buffer(s)));else if(s instanceof Uint8ClampedArray)e(await o(to_array_buffer(s)));else if(s?.constructor?.name=="Buffer")e(await o(to_array_buffer(s)));else if(s instanceof ImageData){const l=document.createElement("canvas"),a=l.getContext("2d");l.width=s.width,l.height=s.height,a.putImageData(s,0,0),r.src=l.toDataURL(),r.onload=()=>{e(r)},r.onerror=i}else s instanceof HTMLImageElement?e(await o(to_array_buffer(s))):s instanceof HTMLCanvasElement?(r.src=s.toDataURL("image/png"),r.onload=function(){e(r)},r.onerror=function(l){console.error(l),i(l)}):i(new TypeError)})}async function to_image_buffer(s){const e=await to_canvas(s);return e.getContext("2d").getImageData(0,0,Number(e.width),Number(e.height))}function to_canvas(s){return new Promise(async(e,i)=>{const r=s?.constructor?.name,o=document.createElement("canvas"),l=o.getContext("2d");function a(c){o.width=c.width,o.height=c.height,l.drawImage(c,0,0)}typeof s=="string"?(a(await to_image(s)),e(o)):s instanceof ArrayBuffer?(a(await to_image(s)),e(o)):s instanceof Uint8Array?(a(await to_image(s)),e(o)):s instanceof Uint8ClampedArray?(a(await to_image(s)),e(o)):r=="Buffer"?(a(await to_image(s)),e(o)):s instanceof HTMLImageElement?(a(s),e(o)):s instanceof ImageData?(a(await to_image(s)),e(o)):s instanceof Image?(a(s),e(o)):s instanceof HTMLCanvasElement?e(s):i(new TypeError)})}function to_compressed_buffer(s,e={quality:.95,ext:"jpeg"}){return new Promise(async(i,r)=>{let o=await to_canvas(s);if(e.ext=="gif"){await __vitePreload(()=>import("./gif@DJx2jrbY.js"),[],import.meta.url);const l=window.GIF,a=new l({workers:1,quality:10});a.addFrame(o,{delay:0}),a.on("finished",async function(c){i(new Uint8Array(await blob_to_array_buffer(c)))}),a.render()}else try{const a=o.toDataURL("image/"+e.ext,e.quality).replace(/^data:image\/(png|jpeg);base64,/,""),c=window.atob(a),d=new Uint8Array(c.length);for(let u=0,f=c.length;u<f;u++)d[u]=c.charCodeAt(u);i(d)}catch(l){r(l)}})}function take_screenshot_as_apng(s={}){const e=DMC;C.modal_processing("Processing....");const i={type:"buffer",sharpen:!1,alpha:!0,delay:0,w:null,duration:100,frame:25,quality:10,workers:2,square:!1,icon_path:null,download:!1};return console.log("take_screenshot_as_apng",s),s&&Object.assign(i,s),new Promise(async(r,o)=>{for(;!e.main_is_ready3;)await C.sleep(40);if(window.UPNG==null){const{UPNG:h}=await __vitePreload(()=>import("./UPNG@DClqjSi1.js"),[],import.meta.url);await __vitePreload(()=>import("./pako@aYzIuDlj.js"),[],import.meta.url),window.UPNG=h}e.base_renderer.setAnimationLoop(null),e.renderer_observer(!1);function l(){e.update_display()}class a{constructor(_){this.frames=[],this.canvas=_}to_img(){return new Promise(_=>{const b=new Image;b.src=this.canvas.toDataURL("image/png"),b.onload=async function(){_(b)}})}async frame(){l();const _=await this.to_img(),b=await C.to_image_buffer(_),v=Math.floor(performance.now());this.frames.push({data:b,time:v})}encode(){this.frames.shift();let b=this.frames[0].time;return UPNG.encode(this.frames.map(v=>v.data.data),this.canvas.width,this.canvas.height,0,this.frames.map(v=>{let w=v.time-b;return b=v.time,Math.floor(w)}))}}const c=new a(e.base_renderer.domElement);let d=performance.now(),u=i.duration,f=i.frame;performance.now();for(let h=0;h<f;h++)await c.frame(),await C.sleep(u-(performance.now()-d)),d=performance.now(),C.modal_processing_update_progress(h,f);C.modal_processing_update_progress(f,f),await C.sleep(100);const m=c.encode();C.download(m,"animated.png"),e.base_renderer.setAnimationLoop(e.registered_request_display_function),e.renderer_observer(!0),r(),C.close_modal_processing()})}function take_screenshot_as_gif(s={}){const e=DMC;let i={type:"buffer",ui:!0,sharpen:!1,alpha:!0,delay:0,w:null,duration:100,frame:25,quality:10,workers:2,square:!1,icon_path:null,download:!1,onFrame:o=>!0};console.log("take_screenshot_as_gif",s),s&&Object.assign(i,s),i.ui&&C.modal_processing("Processing....");const r=document.createElement("canvas");return new Promise(async(o,l)=>{await __vitePreload(()=>import("./gif@DJx2jrbY.js"),[],import.meta.url);const a=window.GIF,c=new a({workers:i.workers,quality:i.quality,transparent:i.alpha?65280:null});function d(){e.update_display()}class u{constructor(w){this.frames=[],this.canvas=w,this.tmp_canvas=document.createElement("canvas"),this.c2d=this.tmp_canvas.getContext("2d",{willReadFrequently:!0})}to_img(){return new Promise(w=>{const y=new Image;y.src=this.canvas.toDataURL("image/png"),y.onload=async function(){w(y)}})}async frame(){d();const w=await this.to_img(),y=await this.crop(w);this.time==null&&(this.time=performance.now()),this.frames.push({data:y,time:Math.floor(performance.now()-this.time)}),this.time=performance.now()}async crop(w){const y=this.c2d;if(i.square){let M=w.naturalWidth,S=0,D=0;if(w.naturalWidth>w.naturalHeight){const O=w.naturalWidth-w.naturalHeight;M=w.naturalHeight,S=Math.round(O/2)}else{const O=w.naturalHeight-w.naturalWidth;M=w.naturalWidth,D=Math.round(O/2)}let k=i.w!=null?i.w/M:1;if(y.imageSmoothingEnabled=!1,y.canvas.width=Math.floor(M*k),y.canvas.height=Math.floor(M*k),y.drawImage(w,S,D,M,M,0,0,Math.floor(M*k),Math.floor(M*k)),i.sharpen&&sharpen(y,M,M,.04),i.icon_path){let O=await _load_icon_(i.icon_path,M/3,M/3);y.drawImage(O,M/3*2,M/3*2)}}else{y.imageSmoothingEnabled=!1;const M=y.canvas.width=w.naturalWidth,S=y.canvas.height=w.naturalHeight,D=M<S?S:M,k=i.w!=null?i.w/D:1;if(y.canvas.width=Math.floor(M*k),y.canvas.height=Math.floor(S*k),y.drawImage(w,0,0,M,S,0,0,Math.floor(M*k),Math.floor(S*k)),i.sharpen&&sharpen(y,M,M,.04),i.icon_path){const O=await _load_icon_(i.icon_path,M/3,M/3);y.drawImage(O,M/3*2,M/3*2)}}if(i.alpha){const M=r.width*r.height*4,S=y.getImageData(0,0,r.width,r.height),D=S.data;for(let k=0;k<M;k+=4)D[k+3]<128&&(D[k+0]=0,D[k+1]=255,D[k+2]=0,D[k+3]=255);y.putImageData(S,0,0)}return y.getImageData(0,0,y.canvas.width,y.canvas.height)}encode(){return new Promise(async w=>{for(const y of this.frames)c.addFrame(y.data,{delay:y.time});c.on("finished",async function(y){const M=new Uint8Array(await blob_to_array_buffer(y));w(M)}),c.render()})}}const f=new u(e.base_renderer.domElement);await C.sleep(i.delay),e.show_helper_semaphore++,e.base_renderer.setAnimationLoop(null),e.renderer_observer(!1);let m=performance.now(),h=i.duration,_=i.frame;for(let v=0;v<_;v++)if(await f.frame(),await C.sleep(h-(performance.now()-m)),m=performance.now(),C.modal_processing_update_progress(v,_),i.onFrame(r)==!1){e.show_helper_semaphore--,i.ui&&C.close_modal_processing(),o(null);return}C.modal_processing_update_progress(_,_),await C.sleep(100);const b=await f.encode();return e.show_helper_semaphore--,i.ui&&C.close_modal_processing(),i.download&&C.download(b,"animation.gif"),e.base_renderer.setAnimationLoop(e.registered_request_display_function),e.renderer_observer(!0),C.close_modal_processing(),o(b)})}class CanvasTextureReplacer{canvas3d;renderer;scene;camera;sprite;initialize(){if(this.canvas3d)return;const e=document.createElement("canvas"),i=new THREE.WebGLRenderer({canvas:e,alpha:!1,premultipliedAlpha:!1,antialias:!1,stencil:!1,depth:!1,logarithmicDepthBuffer:!1});i.domElement.style.cssText="display:none;position:fixed;left:10px;top:100px;z-index:1;",document.body.appendChild(i.domElement),i.setSize(1,1),i.setViewport(0,0,1,1),i.outputColorSpace=THREE.SRGBColorSpace,i.autoClear=!1;const r=new THREE.Scene;r.background=new THREE.Color("white");const o=new THREE.OrthographicCamera(0,1,0,1,-1,1e4);this.renderer=i,this.canvas3d=e,this.scene=r,this.camera=o;const l=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1}),a=new THREE.Sprite(l);r.add(a),this.sprite=a}show(){this.renderer&&(this.renderer.domElement.style.display="block")}hide(){this.renderer&&(this.renderer.domElement.style.display="none")}dispose(){const e=this.renderer;this.renderer=null,e.domElement.remove(),console.log("dispose"),e.dispose()}draw_image_to_canvas_texture(e,i,r){const o={onpaint:({})=>{}};if(r&&Object.assign(o,r),!(e instanceof THREE.CanvasTexture)){console.error("First arg must be CanvasTexture.");return}if(!(i instanceof THREE.Texture)){console.error("Second arg must be Texture.");return}this.initialize();const l=o.width??i.width,a=o.height??i.height,c=this.renderer,d=this.canvas3d,u=this.sprite,f=this.scene,m=this.camera;d.width=l,d.height=a,c.setSize(l,a),c.setViewport(0,0,l,a),m.left=-l*.5,m.right=l*.5,m.top=a*.5,m.bottom=-a*.5,u.position.set(.5,.5,-9999),u.material.map=i,c.render(f,m),u.material.map=null;const h=e.canvas2d;h.width=l,h.height=a;const _=e.context2d;o.onpaint?o.onpaint({ctx:_,canvas:h,image:c.domElement}):_.drawImage(c.domElement,0,0);const b=c.domElement;b.style.width="128px",b.style.height="128px"}replace(e,i){const r={width:null,height:null};i&&Object.assign(r,i),this.initialize();const o=r.width??e.width,l=r.height??e.height,a=this.renderer,c=this.canvas3d,d=this.sprite,u=this.scene,f=this.camera;c.width=o,c.height=l,a.setSize(o,l),a.setViewport(0,0,o,l),f.left=-o*.5,f.right=o*.5,f.top=l*.5,f.bottom=-l*.5,d.position.set(.5,.5,-9999),d.material.map=e,a.render(u,f),d.material.map=null;const m=document.createElement("canvas"),h=new THREE.CanvasTexture(m);h.canvas2d=m,m.width=o,m.height=l;const _=m.getContext("2d");_.drawImage(a.domElement,0,0,o,l),h.context2d=_,h.flipY=e.flipY,h.source_file=e.source_file,h._modified_source_file_=e._modified_source_file_,h._source_file_=e._source_file_,h.minFilter=e.minFilter,h.magFilter=e.magFilter,h.generateMipmaps=e.generateMipmaps,h.rotation=e.rotation,h.colorSpace=e.colorSpace,h.anisotropy=e.anisotropy,h.matrixAutoUpdate=e.matrixAutoUpdate,h.needsPMREMUpdate=e.needsPMREMUpdate,h.premultiplyAlpha=e.premultiplyAlpha,h.userData=JSON.parse(JSON.stringify(e.userData)),h.name=e.name,h.wrapS=e.wrapS,h.wrapT=e.wrapT,h.offset.copy(e.offset),h.center.copy(e.center),h.repeat.copy(e.repeat),h.matrix.copy(e.matrix);const b=a.domElement;return b.style.width="128px",b.style.height="128px",h}}const offscreen_canvas={cache_table:new Map,cache_tex2img_table:new WeakMap,canvas:null,renderer:null,counter:0};let cache_material=null,cache_scene2d=null,cache_camera2d=null;function make_thumbnail_texture_to_image(s,e,i){const r={cache:!0,render:!0,width:64,height:64,offscreen_width:null,offscreen_height:null},o=r.width,l=r.height,a=r.offscreen_width??r.width,c=r.offscreen_height??r.height;e&&Object.assign(r,e);const d=window.THREE;if(s==null){const u=new Image;return u.style.objectFit="contain",u.style.width=o+"px",u.style.height=l+"px",u}if(offscreen_canvas.canvas==null){const u=document.createElement("canvas");document.body.appendChild(u),u.style.position="fixed",u.style.left="0px",u.style.top="0px",u.style.zIndex="1000",u.style.width=a+"px",u.style.height=c+"px",u.width=a,u.height=c,u.style.display="none";const f=new d.WebGLRenderer({canvas:u,alpha:!1,premultipliedAlpha:!1,antialias:!1,stencil:!1,depth:!1,logarithmicDepthBuffer:!1});f.setSize(a,c),f.setViewport(0,0,a,c),f.outputColorSpace=d.SRGBColorSpace,f.autoClear=!1,offscreen_canvas.canvas=u,offscreen_canvas.renderer=f}{const u=new Image;if(u.style.objectFit="contain",u.style.width=o+"px",u.style.height=l+"px",u.onload=function(){i&&i(null,u)},u.onerror=function(m){console.error(m),i&&i(m,u)},offscreen_canvas.counter++>25){for(const m in offscreen_canvas.cache_table){const h=offscreen_canvas.cache_table[m];(h==null||h.deref()==null)&&delete offscreen_canvas.cache_table[m]}offscreen_canvas.counter=0}const f=async function(){const m=s._source_file_;let h=null;{let _=offscreen_canvas.cache_tex2img_table.get(s);if(_){for(;_.img==null;)await C.sleep(100),_=offscreen_canvas.cache_tex2img_table.get(s);if(_){const b=_.img.src;b&&(h=b.slice())}}}if(r.cache&&m&&s.image?.data?.length>4*8*8){let _=offscreen_canvas.cache_table.get(m);for(;_===null;)await C.sleep(100),_=offscreen_canvas.cache_table.get(m);if(_){const b=_.deref()?.src;b&&(h=b.slice())}}if(h==null||h?.length<=174){if(r.render){offscreen_canvas.cache_tex2img_table.set(s,{}),offscreen_canvas.cache_table.set(m,null);const _=offscreen_canvas.renderer,b=offscreen_canvas.canvas;b.style.width=a+"px",b.style.height=c+"px",b.width=a,b.height=c,_.setSize(a,c),_.setViewport(0,0,a,c);const v=s;if(cache_scene2d==null){const D=new d.MeshBasicMaterial({color:16777215,side:d.DoubleSide});cache_scene2d=new d.Scene,cache_scene2d.background=new d.Color("white"),cache_camera2d=new d.OrthographicCamera(0,a,0,c,.001,1e4);const k=new d.Sprite(D);cache_material=k.material,k.position.set(a*.5,c*.5,-9999),k.scale.set(a,v.flipY?-c:c,1),cache_scene2d.add(k)}const w=v.offset.clone(),y=v.center.clone(),M=v.repeat.clone(),S=v.rotation;v.rotation=0,v.offset.set(0,0),v.center.set(0,0),v.repeat.set(1,1),cache_material.map=v,_.clear(),_.render(cache_scene2d,cache_camera2d),u.src=_.domElement.toDataURL("image/png"),offscreen_canvas.cache_table.set(m,new WeakRef(u)),offscreen_canvas.cache_tex2img_table.set(s,{img:u}),v.offset.copy(w),v.center.copy(y),v.repeat.copy(M),v.rotation=S,cache_material.map=null}}else u.src=h};return DMC.draw_thread_after_runner.push(f),u}}function download(s,e,i="binary"){return new Promise((r,o)=>{let l=null;s instanceof Blob?l=s:l=new Blob([to_array_buffer(s)],{type:i});const a=document.createElement("a"),c=window.URL.createObjectURL(l);a.href=c,a.download=a.innerText=e,a.target="_blank",a.hidden=!0,document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(c),r()},300)})}async function encode_to_ogg(s){await __vitePreload(()=>import("./WasmMediaEncoder.min@BMzX7eYn.js"),[],import.meta.url);const e=new(window.AudioContext||window.webkitAudioContext);let i=null;if(typeof s=="string")i=await C.url_or_buffer(s);else if(typeof s=="object")s instanceof Blob?i=await C.blob_to_array_buffer(s):i=C.to_array_buffer(s);else throw new TypeError("Invalid type.");const r=await e.decodeAudioData(i),o=await window.WasmMediaEncoder.createOggEncoder();o.configure({sampleRate:r.sampleRate,channels:r.numberOfChannels,vbrQuality:2});let l=new Uint8Array(1024*1024),a=0,c=!0;const d=[];for(let f=0;f<r.numberOfChannels;f++)d.push(r.getChannelData(f).slice());for(;;){const f=c?o.encode(d):o.finalize();if(f.length+a>l.length){const m=new Uint8Array(f.length+a);m.set(l),l=m}if(l.set(f,a),a+=f.length,!c)break;c=!1}return new Uint8Array(l.buffer,0,a)}async function encode_to_mp3(s){await __vitePreload(()=>import("./WasmMediaEncoder.min@BMzX7eYn.js"),[],import.meta.url);const e=new(window.AudioContext||window.webkitAudioContext);let i=null;if(typeof s=="string")i=await C.url_or_buffer(s);else if(typeof s=="object")s instanceof Blob?i=await C.blob_to_array_buffer(s):i=C.to_array_buffer(s);else throw new TypeError("Invalid type.");const r=await e.decodeAudioData(i),o=await window.WasmMediaEncoder.createMp3Encoder();o.configure({sampleRate:r.sampleRate,channels:r.numberOfChannels,vbrQuality:2});let l=new Uint8Array(1024*1024),a=0,c=!0;const d=[];for(let f=0;f<r.numberOfChannels;f++)d.push(r.getChannelData(f).slice());for(;;){const f=c?o.encode(d):o.finalize();if(f.length+a>l.length){const m=new Uint8Array(f.length+a);m.set(l),l=m}if(l.set(f,a),a+=f.length,!c)break;c=!1}return new Uint8Array(l.buffer,0,a)}async function screenshot(s,e={}){const i={type:"download",thumbnail:!1};let r=null;if(e&&Object.assign(i,e),console.log("Screenshot:",s,i),i.thumbnail){const o=make_thumbnail_path(s),l=DPath(o).ext,a={};Object.assign(a,i),a.type=null,a.type="buffer";const c=l=="gif"?await C.take_screenshot_as_gif(Object.assign({quality:1,w:128,square:!0,delay:0,duration:50,frame:40},a)):await C.take_screenshot_raw(Object.assign({square:!0,w:256},a));c&&(r={path:o,buffer:c.buffer?c.buffer:r,canvas:c.canvas?c.canvas:null}),i.type=="save"?await window.cross_file_system.write(o,c.buffer?c.buffer:r):i.type=="download"&&download(r.buffer,o??"download.png")}else{const o={};Object.assign(o,i),o.type=null;const l=await take_screenshot_raw(o);l&&(r={path:s,buffer:l.buffer?l.buffer:r,canvas:l.canvas?l.canvas:null}),i.type=="save"?await window.cross_file_system.write(s,l.buffer?l.buffer:r):i.type=="download"&&download(r.buffer,s??"download.png")}return r}class ScreenCapture{constructor(){this.media_params={mimeType:'video/webm;codecs="vp9,opus"',audioBitsPerSecond:1e3*256,videoBitsPerSecond:1e3*1e3*5},this.filename="download",this.width=null,this.height=null,this.video=!0,this.audio=!0,this.v_stream=null,this.a_stream=null,this.stream=null,this.onstart=null,this.onfinish=null,this.onstop=null,this.fps=60,this.fadeIn=0,this.fadeOut=0}setFPS(e){this.fps=e}calculateVideoBitrate(e,i,r){}_resize_(){const e=window.DMC,i=this.width,r=this.height;e.setSizeToBaseRenderer(i,r);const o=e.getCameras();for(const l of o)l.aspect=i/r,l.updateProjectionMatrix();for(const l in e.render_passes){const a=e.render_passes[l];a.setSize&&a.setSize(i,r)}for(const l in e.renderers)e.renderers[l]?.setSize&&e.renderers[l].setSize(i,r)}init(){const e=window.DMC;if(this._resize_(),this.v_stream==null){const r=e.base_renderer.domElement;this.v_stream=r.captureStream(this.fps)}let i=null;if(e.scene.traverse(r=>{r instanceof THREE.AudioListener&&(i=r)}),console.log(i),i){const o=THREE.AudioContext.getContext().createMediaStreamDestination(),l=i.getInput();l.connect(o),this.gain_node=l,this.a_stream=o.stream}this.video||(this.v_stream=null),this.audio||(this.a_stream=null),this.a_stream!=null&&this.v_stream!=null?this.stream=new MediaStream([...this.v_stream.getTracks(),this.a_stream.getAudioTracks()[0]]):this.v_stream?this.stream=new MediaStream([...this.v_stream.getTracks()]):this.a_stream&&(this.stream=new MediaStream([...this.a_stream.getTracks()]))}isRecording(){return!!(this.recorder&&this.recorder.state=="recording")}isPaused(){return!!(this.recorder&&this.recorder.state=="paused")}start(e){const i=this,r=this.fadeIn,o=this.fadeOut,l=this.gain_node?.gain,a=ScreenCapture.GetExtensionFromMimeType(this.media_params.mimeType),c=new MediaRecorder(this.stream,this.media_params);if(this.onstart&&this.onstart(),l&&(l.value=1,r>0)){let f=function(m,h){const _=m/h;if(_>1){l.value=1,window.DMC?.setBlackout?.(1);return}l.value=_,window.DMC?.setBlackout?.(_),setTimeout(()=>{if(i.force_stop){d();return}const b=performance.now()/1e3;f(m+b-u,h),u=b},30)};l.value=0;let u=performance.now()/1e3;f(0,r)}const d=()=>{this.force_stop&&(l.value=1,window.DMC?.setBlackout?.(1))};if(c.start(),c.ondataavailable=u=>{if(this.force_stop){d();return}const f=new Blob([u.data],{type:u.data.type}),m=window.URL.createObjectURL(f),h=document.createElement("a");h.href=m,h.download=i.filename+"."+a,h.click(),window.URL.revokeObjectURL(m),i.onfinish&&i.onfinish(),window.dispatchEvent(new Event("resize"))},e!=null){if(l&&o>0){let f=function(m,h){const _=m/h;if(_>1){l.value=0,window.DMC?.setBlackout?.(0);return}l.value=1-_,window.DMC?.setBlackout?.(1-_),setTimeout(()=>{if(i.force_stop){d();return}const b=performance.now()/1e3;f(m+b-u,h),u=b},30)},u=performance.now()/1e3;setTimeout(()=>{if(i.force_stop){d();return}u=performance.now()/1e3,f(0,o)},Math.floor(1e3*(e-o)))}setTimeout(()=>{if(this.force_stop){d();return}setTimeout(()=>{if(this.force_stop){d();return}i.stop(this.force_stop),l&&setTimeout(()=>{l.value=1,window.DMC?.setBlackout?.(1)},1e3)},1)},Math.floor(1e3*e))}this.recorder=c}stop(e=!1){e&&(this.force_stop=!0),this.recorder?.stop?.(),this.recorder=null,window.dispatchEvent(new Event("resize")),this.onstop&&this.onstop(e)}setupSize(e){e=="2160p"?(this.width=3840,this.height=2160):e=="1440p"?(this.width=2560,this.height=1440):e=="1080p"?(this.width=1920,this.height=1080):e=="720p"?(this.width=1280,this.height=720):e=="480p"&&(this.width=854,this.height=480)}setupAs4K(){this.setupSize("2160p")}setupAs2K(){this.setupSize("1080p")}static GetExtensionFromMimeType(e){const[i,r]=e.split("/");let[o,l]=r.split(";");return o=="x-matroska"&&(o="mkv"),o}static GetAvailableMimeTypes(){function e(f,m,h){const _=MediaRecorder.isTypeSupported,b=[];return m.forEach(v=>{const w=`${f}/${v}`;h.forEach(y=>[`${w};codecs=${y}`].forEach(M=>{_(M)&&b.push({mimeType:M,codec:y})})),_(w)&&b.push({mimeType:w})}),b}const i=["webm","ogg","mp4","x-matroska","mpeg"],r=["webm","ogg","mp3","x-matroska","wav"],o=["should-not-be-supported","vp9","vp9.0","vp9.02.10.10.01.09.16.09.01","vp8","vp8.0","opus","pcm","avc1.64001E","avc1.58A01E","avc1.42E01E","avc1.4D401E","avc1.4d002a","mp4v.20.240","mp4a.40.2","mp4v.20.8","avc1","av1","h265","h.265","h264","h.264","aac","mpeg","mp4a","wav","adpcm","pcm_s16le","vorbis","daala","mpeg4","theora","speex","flac","dirac","samr"],l=e("video",i,o),a=e("audio",r,o),c=[];for(let f of l)if(f.codec){for(let m of a)if(m.codec){const h=`${f.codec},${m.codec}`;c.push(h)}}const d=["avc1.64001E,mp4a.40.2","avc1.58A01E,mp4a.40.2","avc1.4D401E,mp4a.40.2","avc1.42E01E,mp4a.40.2","mp4v.20.8,mp4a.40.2","mp4v.20.240,mp4a.40.2","mp4v.20.8,samr"];for(const f of d)c.filter(m=>m==f).length==0&&c.push(f);const u=e("video",i,c);return{top:{video:l[0],audio:a[0],av:u[0]},all:{video:l,audio:a,av:u}}}static GetRecommendedProfile(e=!0,i=!0,r=90,o=720,l=60,a=!1){const c=r/100;let d=1e3*128;d={0:1e3*64,1:1e3*128,2:1e3*160,3:1e3*192,4:1e3*256,5:1e3*320}[Math.floor(c*.5*10)];const f={h264:{480:750*1.5,720:1500*1.5,1080:3e3*1.5,1440:6e3*1.5,2160:12e3*1.5},avc1:{480:750*1.5,720:1500*1.5,1080:3e3*1.5,1440:6e3*1.5,2160:12e3*1.5},vp8:{480:750*1.2,720:1500*1.2,1080:3e3*1.2,1440:6e3*1.2,2160:12e3*1.2},vp9:{480:750,720:1500,1080:3e3,1440:6e3,2160:12e3}},m=this.GetAvailableMimeTypes();let h=m.top.av;if(e&&!i){if(h=m.top.video,a){for(const S of m.all.av)if(S.codec.indexOf("vp9.02.10.10.01.09.16.09.01")==0){h=S;break}}}else if(!e&&i)h=m.top.audio;else if(a){for(const S of m.all.av)if(S.codec.indexOf("vp9.02.10.10.01.09.16.09.01")==0){h=S;break}}if(h==null)return console.error("There is no codec."),null;const _=h.mimeType;let b=null;for(const S in f)if(m.top.av.codec.indexOf(S)==0){b=f[S];break}if(b==null)return console.error("There is no template profile."),null;let v=null,w=1e6;for(const S in b)Math.abs(Number(S)-o)<w&&(w=Math.abs(Number(S)-o),v=b[S]);if(v==null)return console.error("There is no template profile."),null;const y=Math.floor((v+v*c*10)*(l/60)*1e3);return{mimeType:_,audioBitsPerSecond:i?d:null,videoBitsPerSecond:e?y:null}}}class ScreenCapture2{BUFFER_SIZE=8192;_resize_(e,i){const r=window.DMC,o=e,l=i;r.setSizeToBaseRenderer(o,l);const a=r.getCameras();for(const c of a)c.aspect=o/l,c.updateProjectionMatrix();for(const c in r.render_passes){const d=r.render_passes[c];d.setSize&&d.setSize(o,l)}for(const c in r.renderers)r.renderers[c]?.setSize&&r.renderers[c].setSize(o,l);console.log("Resize:",o,l)}async prepare(e){this.params={fps:60,width:320,height:240,quality:null,format:"webm"},e&&Object.assign(this.params,e);const i=this.params.width<this.params.height?this.params.width:this.params.height;if(window.VideoEncoder==null)throw new Error("VideoEncoder is not available.");if(window.AudioEncoder==null)throw new Error("AudioEncoder is not available.");let r=null,o=null;if(this.params.format=="webm"){const{Muxer:w,ArrayBufferTarget:y}=await __vitePreload(()=>import("./webm-muxer@C1mJMcWQ.js"),[],import.meta.url);r=w,o=y}else{const{Muxer:w,ArrayBufferTarget:y}=await __vitePreload(()=>import("./mp4-muxer@BBplf3BZ.js"),[],import.meta.url);r=w,o=y}this._is_recording=!1,this._is_paused=!1;const l=window.DMC;l.base_renderer.domElement;let a=null;if(l.scene.traverse(w=>{w instanceof THREE.AudioListener&&(a=w)}),!a)throw new Error("Could not refer AudioListener.");console.log(a),this._listener=a;const c=THREE.AudioContext.getContext(),d=c.createScriptProcessor(this.BUFFER_SIZE,2,2),u=a.getInput();a.setFilter(d),this.gain_node=u,this.scriptNode=d,this.audio_context=c;const f={target:new o,video:{codec:"V_VP9",width:this.params.width,height:this.params.height},audio:{codec:"A_OPUS",numberOfChannels:2,sampleRate:48e3}},m=new r(f),h=new VideoEncoder({output:(w,y)=>m.addVideoChunk(w,y),error:w=>console.error(w)}),_=new AudioEncoder({output:(w,y)=>m.addAudioChunk(w,y),error:w=>console.error(w)});let b=1217e3;const v=.75+.5*(this.params.fps/60);this.params.quality==null?b=Math.floor(4*(1.77*i*i*v)*.9):b=Math.floor(4*(1.77*i*i*v)*(this.params.quality/100)),console.log(b,i,v,this.params.quality/100),h.configure({codec:"vp09.00.10.08",width:this.params.width,height:this.params.height,bitrate:b,framerate:this.params.fps}),this._muxer=m,this._videoEncoder=h,this._audioEncoder=_,this._resize_(this.params.width,this.params.height)}async begin_video_phase(e){this._listener;const i=window.DMC.base_renderer.domElement;this._muxer;const r=this._videoEncoder;this._audioEncoder,this._resize_(this.params.width,this.params.height);let o=0;for(;await e();){const l=new VideoFrame(i,{timestamp:o/this.params.fps*1e3*1e3});r.encode(l),l.close(),o++,await sleep(o%15==0?1:0)}return this}async end_video_phase(e={}){this._listener,window.DMC.base_renderer.domElement,this._muxer;const i=this._videoEncoder;return this._audioEncoder,await i.flush(),this}async finalize(){return this._muxer.finalize(),this._videoEncoder.close(),this._audioEncoder.close(),this}async toBlob(){let{buffer:e}=this._muxer.target;return new Blob([e],{type:"video/webm"})}async download(e="video.webm"){const i=await this.toBlob(),r=document.createElement("a"),o=URL.createObjectURL(i);r.style.display="none",r.href=o,r.download=e,document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r),o&&window.URL.revokeObjectURL(o)},100)}stop_audio(){const e=this,i=this._listener;e._audio_recording=!1,i&&(i.removeFilter(),this._listener=null)}async end_audio_phase(){this._listener,window.DMC.base_renderer.domElement,this.stop_audio(),this._muxer,this._videoEncoder;const e=this._audioEncoder,i=new Float32Array(this.BUFFER_SIZE*2);for(const r of this._audio_buffers){const o=r.tm,l=r.sampleRate,a=r.audioData,c=r.audioData2;for(let u=0;u<this.BUFFER_SIZE;++u)i[u*2+0]=a[u],i[u*2+1]=c[u];const d=new AudioData({format:"f32",sampleRate:l,numberOfChannels:2,numberOfFrames:this.BUFFER_SIZE,timestamp:o*1e3*1e3,data:i.buffer});e.encode(d),d.close()}return await e.flush(),this}record_audio(){this._audio_recording=!0}async begin_audio_phase(){const e=this;this._listener,window.DMC.base_renderer.domElement,this._muxer,this._videoEncoder;const i=this._audioEncoder,r=this.scriptNode,o=this.audio_context;this._resize_(320,240);{const l={codec:"opus",numberOfChannels:2,sampleRate:o.sampleRate,bitrate:192e3};i.configure(l);let a=null;this._audio_buffers=[],r.onaudioprocess=c=>{if(e._audio_recording==!1)return;c.outputBuffer;const d=c.inputBuffer,u=d.getChannelData(0),f=d.getChannelData(1);a==null&&(a=c.playbackTime);const m=c.playbackTime-a;this._audio_buffers.push({tm:m,sampleRate:o.sampleRate,audioData:u.slice(),audioData2:f.slice()})}}return e._audio_recording=!0,this}stop(e=!1){e&&(this.force_stop=!0),window.dispatchEvent(new Event("resize"))}}async function video_capture(s,e={}){let i={recoder:{audioBitsPerSecond:null,videoBitsPerSecond:null,mimeType:'video/webm;codecs="vp9,opus"'},width:1280,height:720,finish:null};e&&Object.assign(i,e);const r=new ScreenCapture;r.width=i.width,r.height=i.height,r.callback_finish=i.finish,r.init(),r.start(30)}function no_propagation(s){s.onmousedown=s.onmousemove=s.onmouseup=s.onclick=s.onpointerup=s.onpointercancel=s.onpointerdown=function(e){e.stopPropagation()}}function get_ddd_links(s,e=[],i=!0){if(s==null)return e;s.source_file&&e.push({get(){return s.source_file},set(o){s.source_file=o}}),s._source_file_&&e.push({get(){return s._source_file_},set(o){s._source_file_=o}});const r=s._dp_;if(r){if(r._source_file_&&e.push({get(){return r._source_file_},set(o){r._source_file_=o}}),r.source_file&&e.push({get(){return r.source_file},set(o){r.source_file=o}}),r.actions)for(let o of r.actions)e.push({get(){return o.source_file},set(l){o.source_file=l}});if(r.action)for(let o of r.action.sources)e.push({get(){return o.source_file},set(l){o.source_file=l}})}if(s.children&&i)for(let o in s.children)get_ddd_links(s.children[o],e,i);if(s.list&&i)for(let o in s.list)get_ddd_links(s.list[o],e,i);return e}const C$2={set_base_url,GenerateShortID:GenerateShortID$1,md5,any_hash,generate_unique_name,copy_prop,get_window_width,get_window_height,is_image_ext,is_env_image_ext,is_etc_ext,is_j_object_ext,is_script_ext,is_pose_ext,is_motion_ext,is_sound_ext,is_model_ext,file_type,file_type2,available_app_exts,nodejs_finder_sync,nodejs_finder,load_js,bind_as_drop_component,undo_redo_controller,prevent_drag_and_drop_same_area,check_local_storage_sizes,date_str,canvas_to_buffer,b_decode,clone,s_encode_and_store,s_decode_async,s_encode_async,extract_zip,take_screenshot_raw,take_screenshot_as_gif,take_screenshot_as_apng,make_thumbnail_path,make_thumbnail_from_input,make_thumbnail_texture_to_image,screenshot,download,video_capture,ScreenCapture,ScreenCapture2,to_array_buffer,to_uint8array,blob_to_array_buffer,url_to_array_buffer,to_image,to_canvas,to_image_buffer,to_compressed_buffer,encode_to_ogg,encode_to_mp3,get_ddd_links,no_propagation,CanvasTextureReplacer:new CanvasTextureReplacer,close_modal_image,close_modal_confirmation,modal_processing_update_progress,modal_processing_replace_description_by_id,modal_processing_delete_description_by_id,get_url_query,data_url_to_blob,blob_to_data_url,path:posix,find_object,find_scene,path_join,DPath,DPathJoin,path_basename,path_dirname,sleep,modal_ok_cancel,modal_ok,modal_ok_cancel_promise,modal_image,close_modal_processing,stop_processing_icon,modal_processing,modal_processing_update_description,popup_menu},GeometryLoader=new BufferGeometryLoader;function GenerateShortID(s=26){const e=[],i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<s;++r)e.push(i[Math.floor(Math.random()*i.length)]);return e.join("")}function DGenerateSoundKeyFrame(){return{playback_rate:1,volume:1,detune:0,offset:0,duration:void 0,delay:0,distance_model:"inverse",ref_distance:10,max_distance:1e4,rolloff_factor:1}}function DApplyAudioProperty(s,e=0,i=0){s._dp_.audio==null&&(s._dp_.audio={loop:!1,auto_start:!0,mute:!1,synchronize:!1,enable_fft:!1,fft_size:32,playback_rate_random:0,use_3d_sound:!1,use_keyframes:!1,base:DGenerateSoundKeyFrame(),keyframes:[],instance:null}),DMC?.sound_listener&&s.prepare(DMC.sound_listener);const r=s._dp_?.audio,o=s,l=DMC.ui.system_flags,c=DMC.ui.system_flags?.system_volume??.8,d=l.playbackRate??1;if(r){let u=r.base;const f=r.keyframes;if(r.use_keyframes&&f.length>0){const h=e-i;let _=f.length>>1;h<=f[_].time?(_=_>>1,h<=f[_].time&&(_=0)):h<=f[(_>>1)+_].time||(_=(_>>1)+_);for(let b=_,v=f.length;b<v;++b)if(h<=f[b].time){u=f[b];break}}let m=!1;if(r.use_keyframes?u&&e-i<=u.time&&u.time<e&&(m=!0,o.offset=Math.max(u.offset+u.delay,0),o.setPlaybackRate(u.playback_rate*d)):(m=!0,o.offset=Math.max(e+u.offset+u.delay,0),o.setPlaybackRate(r.playback_rate_random*.5+u.playback_rate*d)),m)return o.setLoop(r.loop),o.setVolume(u.volume*c*c),o.detune=u.detune,o.duration=u.duration==null?void 0:u.duration,o instanceof PositionalAudio&&(r.use_3d_sound?(o.setDistanceModel(u.distance_model),o.setMaxDistance(u.max_distance),o.setRefDistance(u.ref_distance),o.setRolloffFactor(u.rolloff_factor)):(o.setDistanceModel("linear"),o.setMaxDistance(1e5),o.setRefDistance(1e5),o.setRolloffFactor(0))),u}return null}var DDDAttr=function(s){const e=this;this.uuid=GenerateShortID(),this.overwrite={material:null,morph:null},this.type=null,this.kind=null,this.restore=!0,this.restore_geometry=!1,this.active_camera=!1,this.is_background=!1,this.is_helper_scene=!1,this.draggable_on_tree=!0,this.droppable_on_tree=!0,this.draggable_on_3d=!0,this.droppable_on_3d=!0,this.drawable=!0,this.controllable_geometry=!0,this.transform_controller=!0,this.removable=!0,this.cast_shadow=!0,this.receive_shadow=!0,this.physics=!0,this.animation=!0,this.source_file=null,this.managed=!0,this.dof_target=!1,this.dof_dynamic=!1,this.dof_needsUpdate=!1,this.object_attach_to_flag=!1,this.object_attach_to=null,this.object_attach_rotation=new Euler,this.object_attach_offset=new Vector3,this.apply_attach_object=function(r){if(this.object_attach_to&&this.object_attach_to_flag){let o=null;if(DMC.scene.traverse(l=>{l.getDDDProperties?.()?.uuid==i.object_attach_to&&(o=l)}),o){let d=function(u,f){f.multiply(u.scale),u.parent&&d(u.parent,f)};const l=new Vector3,a=new Vector3,c=new Quaternion;l.copy(i.object_attach_offset),r.user.updaters.__update_attached__=u=>{this.object_attach_to_flag&&(o.matrixWorld.decompose(r.position,r.quaternion,a),d(o,a),r.position.x*=a.x,r.position.y*=a.y,r.position.z*=a.z,l.copy(i.object_attach_offset),l.applyQuaternion(r.quaternion),c.setFromEuler(i.object_attach_rotation),r.position.add(l),r.quaternion.multiply(c),r.updateWorldMatrix(!0))}}}},this.ui={object:{},rigid_body:{},constraint:{},light:{},bone:{},material:{}},s&&Object.assign(this,s);const i=this;if(!(i.object_attach_offset instanceof Vector3))if(i.object_attach_offset){const r=new Vector3(0,0,0);r.copy(i.object_attach_offset),i.object_attach_offset=r}else i.object_attach_offset=new Vector3(0,0,0);if(!(i.object_attach_rotation instanceof Euler))if(i.object_attach_rotation){const r=new Euler(0,0,0);r.copy(i.object_attach_rotation),i.object_attach_rotation=r}else i.object_attach_rotation=new Euler(0,0,0);this.destructors=[],this.destruct=function(){for(let r=0;r<e.destructors.length;r++)e.destructors[r]();e.destructors=[]}};function getDDDProperties(s){return s._dp_}function SanitizeOlderProperties(s){function e(i,r){if(i&&(r(i),i.children))for(let o=0;o<i.children.length;o++)e(i.children[o],r)}e(s,i=>{if(i?.material)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++){const o=i.material[r],l=i.material_overwrite?.[r];delete o._visible_,l&&delete l._visible_}else{const r=i.material,o=i.material_overwrite;delete r._visible_,o&&delete o._visible_}})}function BindObjectAsDDD(s,e,i=!1){if(s.getDDDProperties!=null)return s;if(s._dp_=new DDDAttr(e),s.getDDDProperties=function(){return getDDDProperties(this)},s.frustumCulled!=null&&(s.frustumCulled=!1),i)for(const r of s.children)BindObjectAsDDD(r,e,i);return s}window.BindObjectAsDDD=BindObjectAsDDD;const ExcludeDecoProperties={source_file:!0,_source_file_:!0,j_object_source_file:!0,type:!0,binary_license_summary:!0,source_license_summary:!0};function RegenerateUUIDForDecoProp(s){const e=s.getDDDProperties?.();e&&(e.uuid=GenerateShortID());for(const i of s.children)RegenerateUUIDForDecoProp(i)}function CopyObjectDecoProperties(s,e,i={}){const r=getDDDProperties(s),o=getDDDProperties(e);for(const d in r){if(ExcludeDecoProperties[d]||i[d])continue;const u=typeof r[d],f=typeof o[d];u===f&&(u==="boolean"||r[d]instanceof Boolean||u==="number"||r[d]instanceof Number||u==="string"||r[d]instanceof String)&&(r[d]=o[d])}const l=new Set(["__vmd_animation__","instance","__previous_vmd__","destructors","__action_tmp__"]);if(o?.destructors?.length>0)for(;o.destructors.length>0;){const d=o.destructors.pop();d&&d()}function a(d,u,f=new Set){if(d&&u)for(const m in u)l.has(m)||typeof d[m]=="function"||typeof u[m]=="function"||(typeof u[m]=="object"&&!(u[m]instanceof Number)&&!(u[m]instanceof String)&&!(u[m]instanceof Boolean)?u.hasOwnProperty(m)&&(Array.isArray(u[m])&&d[m]==null?d[m]=[]:d[m]==null&&(d[m]={}),f.has(u[m])||(f.add(u[m]),d[m]==null&&u[m]!=null&&(d[m]={}),a(d[m],u[m],f))):d[m]=u[m])}o.audio!=null&&r.audio==null&&(r.audio={}),a(r.audio,o.audio),o.action!=null&&r.action==null&&(r.action={});const c=o.action?.toJSON?.()??o.action;if(a(r.action,c),o.fft){r.fft={};const d=JSON.parse(JSON.stringify(o.fft));a(r.fft,d),r.fft_enabled=o.fft_enabled}}function SaveMaterialProperties(s,e,i){const r={background:!0,__gltf__inner__id__:!0,__prevent__motion_blur__:!0};i&&Object.assign(r,i);let o=null;if(e.material_overwrite&&typeof e.material_overwrite=="object"||e.material&&typeof e.material=="object"){const l=e.material_overwrite,a=e.material_original,c=l||e.material;if(Array.isArray(c)){o=[];for(let d=0;d<c.length;d++){const u=c[d],f=l?.[d],m=a?.[d],h={};SaveObjectProperties(h,u,r);try{h.userData=JSON.parse(JSON.stringify(u.userData))}catch(_){console.error(_)}if(f){const _=f.map?.source_file;u.map?.source_file;const b=m.map?.source_file;_&&b===_&&(delete h.map.source_file,delete h.map._source_file_)}o.push(h)}}else{const d={};SaveObjectProperties(d,c,r);try{d.userData=JSON.parse(JSON.stringify(c.userData))}catch(u){console.error(u)}o=d}}o&&(s.material=o)}function SaveObjectProperties(s,e,i){const r={__prevent__motion_blur__:!0};if(i&&Object.assign(r,i),e.matrixAutoUpdate&&(r.matrixWorld=!0,r.matrix=!0),e instanceof InstancedMesh)if(s instanceof InstancedMesh){const o=new Matrix4;for(let l=0;l<s.max_count&&l<e.max_count;l++)e.getMatrixAt(l,o),s.setMatrixAt(l,o)}else s instanceof Object3D||(s.__instance_mesh_matrix_buffer__=Array.from(e.instanceMatrix.array.slice(0,e.count*16)));for(const o in e){if(r[o])continue;if(o==="_source_file_"){if(e[o]&&window.is_data_url(e[o]))continue}else if(o==="source_file"){if(e[o]&&window.is_data_url(e[o]))continue}else if(o==="__source_dependencies__"){s[o]=e[o].slice();continue}const l=typeof e[o];if(l==="string")s[o]=e[o];else if(l==="number")s[o]=e[o];else if(l==="boolean")s[o]=e[o];else if(l==="object"){if(o==="userData"){s[o]=JSON.parse(JSON.stringify(e[o]));continue}if(e[o]===null)s[o]=null;else if(e[o]===void 0)s[o]=void 0;else if(e[o]instanceof Vector2)s[o]=e[o].clone(),s[o].__class__name__=e[o].constructor.name;else if(e[o]instanceof Vector3)s[o]=e[o].clone(),s[o].__class__name__=e[o].constructor.name;else if(e[o]instanceof Vector4)s[o]=e[o].clone(),s[o].__class__name__=e[o].constructor.name;else if(!(e[o]instanceof Quaternion))if(e[o]instanceof Color){const a=e[o];s[o]={color:a.clone(),r:a.r,g:a.g,b:a.b},s[o].__class__name__=e[o].constructor.name}else if(e[o]instanceof Euler)s[o]=e[o].clone(),s[o].__class__name__=e[o].constructor.name;else if(e[o]instanceof Matrix3)s[o]=e[o].clone(),s[o].__class__name__=e[o].constructor.name;else if(e[o]instanceof Matrix4)s[o]=e[o].clone(),s[o].__class__name__=e[o].constructor.name;else if(e[o]instanceof FogExp2)s[o]=e[o].clone(),s[o].__class__name__=e[o].constructor.name;else if(e[o]instanceof VideoTexture)s[o]={},CopyTextureProperties$1(s[o],e[o]),s[o].__class__name__=e[o].constructor.name;else if(e[o]instanceof CubeTexture)s[o]={},CopyTextureProperties$1(s[o],e[o]),s[o].__class__name__=e[o].constructor.name;else if(e[o]instanceof Texture){s[o]={};const a={unpackAlignment:!0,version:!0,isTexture:!0,isDataTexture2DArray:!0,isCanvasTexture:!0,isCompressedTexture:!0,isCubeTexture:!0,isDataTexture:!0,isDataTexture3D:!0,isDepthTexture:!0,isVideoTexture:!0,isRenderTargetTexture:!0,format:!0,anisotropy:!0};SaveObjectProperties(s[o],e[o],a),s[o].__class__name__=e[o].constructor.name}else e[o]instanceof LightShadow?(s[o]={},SaveObjectProperties(s[o],e[o],r)):e[o]instanceof Camera?(s[o]={},SaveObjectProperties(s[o],e[o],Object.assign({aspect:!0},r))):e[o]instanceof Fog&&(s[o]=e[o].clone(),s[o].__class__name__=e[o].constructor.name)}}e.morphTargetInfluences_cache&&(s.morphTargetInfluences_cache=e.morphTargetInfluences_cache.slice(),s.morphTargetInfluences_coef=e.morphTargetInfluences_coef.slice(),s.morphTargetDictionary=JSON.parse(JSON.stringify(e.morphTargetDictionary)))}function InitializeMaterialsExtField(s){const e=s.material;if(e)if(Array.isArray(e))for(let i=0;i<e.length;i++){const r=s.material[i];if(r.ui)continue;const o=s.material_original[i],l=s.material_overwrite[i];l.visible=!0,r.ui={index:i,selected:!1,maps:{}},o.ui={index:i,selected:!1,maps:{}},l.ui={index:i,selected:!1,maps:{}}}else{const i=s.material;if(i.ui)return;const r=s.material_original,o=s.material_overwrite;i.ui={index:0,selected:!1,maps:{}},r.ui={index:0,selected:!1,maps:{}},o.ui={index:0,selected:!1,maps:{}}}}function InitializeMaterials(s){if(s){const e=s.material;if(e&&s.material_overwrite==null)if(Array.isArray(e)){s.material_original=[],s.material_overwrite=[];for(let i=0;i<e.length;i++){const r=e[i],o=r.clone(),l=r.clone();s.material_original.push(o),s.material_overwrite.push(l)}}else s.material_original=e.clone(),s.material_overwrite=e.clone();for(const i of s.children)InitializeMaterials(i);InitializeMaterialsExtField(s)}}function ConvertMaterialType(s,e){if(e.material==null||s.material==null)return;function i(r,o){const l={type:!0,id:!0,uuid:!0};for(const a in o)l[a]||r[a]!==void 0&&o[a]!==void 0&&(r[a]=o[a])}if(Array.isArray(s.material)){const r=e.material[0].type,o=s.material[0].type;if(r!=o&&o&&r)for(let l=0;l<s.material.length;l++){const a=r,c=s.material[l],d=s.material_overwrite[l],u=new THREE$1[a],f=new THREE$1[a];s.material[l]=u,s.material_overwrite[l]=f,i(s.material[l],c),i(s.material_overwrite[l],d),c.dispose(),d.dispose(),s.material[l].needsUpdate=!0}}else if(e.material.type!=s.material.type){const r=e.material.type,o=new THREE$1[r],l=new THREE$1[r],a=s.material,c=s.material_overwrite;s.material=o,s.material_overwrite=l,s.material.copy(a),s.material_overwrite.copy(c),a.dispose(),c.dispose(),s.material.needsUpdate=!0}InitializeMaterialsExtField(s)}function LoadMaterialProperties(s,e,i,r={}){const o={uuid:!0,type:!0,id:!0,__prevent__motion_blur__:!0},l={force_copy_texture:!1,log:!1};r&&Object.assign(l,r),i&&Object.assign(o,i);const a=e.material_overwrite??e.material,c=s.material;if(c&&InitializeMaterials(s),l.breakpoint)debugger;const d=s.material_overwrite;if(c&&a&&d){if(Array.isArray(c)&&Array.isArray(a))if(l.match_by_name){const u={},f={},m={};let h=!1;for(let _=0;_<c.length;_++)u[c[_].name]?(h=!0,console.warn(`Detected same material name in model: "${c[_].name}"
Clean up in authoring tool before.`)):u[c[_].name]=c[_];for(let _=0;_<d.length;_++)m[d[_].name]?h=!0:m[d[_].name]=d[_];for(let _=0;_<a.length;_++)f[a[_].name]?h=!0:f[a[_].name]=a[_];if(h)console.warn("Multi material should avoid same material name.");else for(const _ in u)if(f[_]){const b=f[_],v=u[_],w=m[_];LoadObjectProperties(v,b,o,{parent_src:e,parent_dst:s,force_copy_texture:l.force_copy_texture,log:l.log}),LoadObjectProperties(w,b,o,{parent_src:e,parent_dst:s,force_copy_texture:l.force_copy_texture,log:l.log}),l.log&&console.log("Replace-M:",b.name,v.normalMap,w.normalMap,b.normalMap);try{b.userData&&(v.userData=JSON.parse(JSON.stringify(b.userData)),w.userData=JSON.parse(JSON.stringify(b.userData)))}catch(y){console.error(y)}}}else{let u=!0;if(c.length!=a.length&&(u=!1),u)for(let f=0;f<c.length;f++)c[f].name!=a[f].name&&(u=!1);if(u)for(let f=0;f<c.length;f++){if(c[f]==null||a[f]==null)debugger;LoadObjectProperties(c[f],a[f],o,{parent_src:e,parent_dst:s,force_copy_texture:l.force_copy_texture,log:l.log}),LoadObjectProperties(d[f],a[f],o,{parent_src:e,parent_dst:s,force_copy_texture:l.force_copy_texture,log:l.log});try{a[f].userData&&(c[f].userData=JSON.parse(JSON.stringify(a[f].userData)),d[f].userData=JSON.parse(JSON.stringify(a[f].userData)))}catch(m){console.error(m)}}else console.warn("Material structure is different.")}else if(typeof c=="object"&&typeof a=="object"){if(LoadObjectProperties(c,a,o,{parent_src:e,parent_dst:s,force_copy_texture:l.force_copy_texture,log:l.log}),LoadObjectProperties(d,a,o,{parent_src:e,parent_dst:s,force_copy_texture:l.force_copy_texture,log:l.log}),a.userData)try{c.userData=JSON.parse(JSON.stringify(a.userData)),d.userData=JSON.parse(JSON.stringify(a.userData))}catch(u){console.error(u)}}else console.error("Invalid material:",s,e);ConvertMaterialType(s,e)}}function CopyTextureProperties$1(s,e){{e.source_file!=null&&(s.source_file=e.source_file),e.name!=null&&(s.name=e.name),e.mapping!=null&&(s.mapping=e.mapping),e.wrapS!=null&&(s.wrapS=e.wrapS),e.wrapT!=null&&(s.wrapT=e.wrapT),e.minFilter!=null&&(s.minFilter=e.minFilter),e.magFilter!=null&&(s.magFilter=e.magFilter),e.offset?.x!==void 0?s.offset==null?s.offset={x:e.offset.x,y:e.offset.y}:s.offset.copy(e.offset):Array.isArray(e.offset)&&s.offset.copy({x:e.offset[0],y:e.offset[1]}),e.center?.x!==void 0?s.center==null?s.center={x:e.center.x,y:e.center.y}:s.center.copy(e.center):Array.isArray(e.center)&&s.center.copy({x:e.center[0],y:e.center[1]}),e.repeat?.x!==void 0?s.repeat==null?s.repeat={x:e.repeat.x,y:e.repeat.y}:s.repeat.copy(e.repeat):Array.isArray(e.repeat)&&s.repeat.copy({x:e.repeat[0],y:e.repeat[1]}),e.rotation&&(s.rotation=e.rotation),e.matrixAutoUpdate!=null&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s instanceof CompressedTexture?s.generateMipmaps=!1:s.generateMipmaps=e.generateMipmaps,s.premultiplyAlpha=e.premultiplyAlpha,s.flipY=e.flipY,e.encoding!=null?(e.encoding===3e3?s.colorSpace=NoColorSpace:e.encoding===3001?s.colorSpace=SRGBColorSpace:s.colorSpace=NoColorSpace,delete s.encoding,delete e.encoding):e.colorSpace!=null&&(s.colorSpace=e.colorSpace),s instanceof VideoTexture&&e instanceof VideoTexture?(s.image.volume=e.image.volume,s.image.loop=e.image.loop,s.image.muted=e.image.muted,s.image.autoplay=e.image.autoplay):s instanceof VideoTexture?(e.video_loop!==void 0&&(s.image.loop=e.video_loop),e.video_volume!==void 0&&(s.image.volume=e.video_volume),e.video_muted!==void 0&&(s.image.muted=e.video_muted),e.video_autoplay!==void 0&&(s.image.autoplay=e.video_autoplay)):e instanceof VideoTexture&&(s.video_loop=e.image.loop,s.video_volume=e.image.volume,s.video_muted=e.image.muted,s.video_autoplay=e.image.autoplay),s.needsUpdate!==void 0&&(s.needsUpdate=!0);return}}const CONST_EXCLUDE_LIST={isMeshBasicMaterial:!0,isMeshLambertMaterial:!0,isMeshToonMaterial:!0,isMeshPhongMaterial:!0,isMeshStandardMaterial:!0,isMeshPhysicalMaterial:!0,isMeshMatcapMaterial:!0,isMeshDepthMaterial:!0,isMeshDistanceMaterial:!0,isMeshNormalMaterial:!0,isLineBasicMaterial:!0,isPointsMaterial:!0,isShadowMaterial:!0,isMMD:!0,isInstancedMesh:!0,isMesh:!0,isSkinnedMesh:!0};function LoadObjectProperties(s,e,i,r){const o={parent_src:null,parent_dst:null,log:!0,force_copy_texture:!1};r&&Object.assign(o,r);const l={uuid:!0,type:!0,__class__name__:!0,background:!0,__gltf__inner__id__:!0},a={};if(i)for(const _ in i)if(_.indexOf("*")>=0){const b=_.split("*")[0];a[b]=b}else l[_]=!0;const c=e.type,d=e.name,u=e.constructor?.name,f=o?.parent_src?.name,m=o?.parent_src?.constructor?.name;let h="";if(m&&m.length>0&&(h+=`sPPC[${m}]`),f&&f.length>0&&(h+=`sPPN[${f}]`),u&&u.length>0&&(h+=`sPC[${u}]`),d&&d.length>0&&(h+=`sPN[${d}]`),c&&c.length>0&&(h+=`sOT[${c}]`),e instanceof InstancedMesh)if(s instanceof InstancedMesh){const _=new Matrix4;for(let b=0;b<s.max_count&&b<e.max_count;b++)e.getMatrixAt(b,_),s.setMatrixAt(b,_)}else s instanceof Object3D||(s.__instance_mesh_matrix_buffer__=Array.from(e.instanceMatrix.array.slice(0,e.count*16)));else if(s instanceof InstancedMesh&&!(e instanceof Object3D)){const _=s.instanceMatrix.array,b=e.__instance_mesh_matrix_buffer__,v=s.max_count*16,w=e.count*16;for(let y=0;y<v&&y<w;y++)_[y]=b[y]}for(const _ in e){if(l[_]||s instanceof Camera&&_=="aspect"||CONST_EXCLUDE_LIST[_])continue;let b=!1;for(const w in a)if(_.indexOf(w)===0){b=!0;break}if(b)continue;if(_==="userData"){s[_]=JSON.parse(JSON.stringify(e[_]));continue}const v=e[_]instanceof Texture&&o.force_copy_texture;if(e[_]!==void 0||v){o.log&&v&&console.log(_,e[_],e[_]?.__class__name__);const w=typeof e[_],y=typeof s[_];let M=e[_]?.__class__name__;if(M==null&&v&&(M="Texture"),M)if(THREE$1[M])if(M==="Color")s[_]=new THREE$1[M],typeof e[_].color=="number"||e[_].color instanceof Number?s[_].setHex(e[_].color):e[_].color.r!=null&&s[_].setRGB(e[_].color.r,e[_].color.g,e[_].color.b);else if(e[_]instanceof Texture||M==="Texture"||M==="CanvasTexture"||M==="CompressedTexture"||M==="CubeTexture"||M==="DataTexture"||M==="DataTexture2DArray"||M==="DataTexture3D"||M==="DepthTexture"||M==="VideoTexture"){if(v){const S=s[_];s[_]=e[_].clone(),CopyTextureProperties$1(s[_],e[_]),o.log&&console.warn("CopyProp:"+_,S,s[_],e[_])}else if(s[_])if(o.log&&console.log(e[_].source_file),e[_]?.source_file){const S=Builder3D.load_texture(e[_].source_file,(D,k)=>{D?console.error(D):k&&(s[_]&&s[_].dispose(),s[_]=k,CopyTextureProperties$1(s[_],e[_]),k.needsUpdate=!0,s.needsUpdate=!0)});window.__init_promises__&&window.__init_promises__.push(S)}else{const S=s[_];o.force_copy_texture?(s[_]=e[_].clone(),CopyTextureProperties$1(s[_],e[_]),o.log&&console.warn("CopyProp:"+_,S,s[_],e[_])):(CopyTextureProperties$1(s[_],e[_]),o.log&&s[_]&&console.warn("CopyProp:"+_,S,s[_],e[_]))}else if(e[_]?.source_file){o.log&&console.log(e[_].source_file);const S=Builder3D.load_texture(e[_].source_file,(D,k)=>{D?console.error(D):k&&(s[_]=k,o.force_copy_texture?(s[_]=e[_].clone(),CopyTextureProperties$1(s[_],e[_]),o.log&&console.warn("CopyProp:"+_,s[_],e[_])):(CopyTextureProperties$1(s[_],e[_]),o.log&&s[_]&&console.warn("CopyProp:"+_,s[_],e[_])),k.needsUpdate=!0,s.needsUpdate=!0)});window.__init_promises__&&window.__init_promises__.push(S)}}else s[_]||(s[_]=new THREE$1[M]),s[_].copy(e[_]);else M==="GeometryBuffer"&&(s[_].dispose?.(),s[_]=GeometryLoader.parse(e[_]));else y==="object"?s[_]instanceof Vector2||s[_]instanceof Vector3||s[_]instanceof Vector4?s[_].copy(e[_]):s[_]instanceof Quaternion||(s[_]instanceof Color?(typeof e[_]=="number"||e[_]instanceof Number?s[_].setHex(e[_]):e[_].r!=null&&s[_].setRGB(e[_].r,e[_].g,e[_].b),s[_].copy(e[_])):s[_]instanceof Euler||s[_]instanceof Matrix4||s[_]instanceof Matrix3?s[_].copy(e[_]):s[_]instanceof FogExp2?(typeof e[_].color=="number"||e[_].color instanceof Number?s[_].color.setHex(e[_].color):e[_].color.r!=null&&s[_].color.setRGB(e[_].color.r,e[_].color.g,e[_].color.b),s[_].density=e[_].density):s[_]instanceof Fog?s[_].copy(e[_]):s[_]instanceof LightShadow||s[_]instanceof Camera?LoadObjectProperties(s[_],e[_],i,o):s[_]===null&&(typeof e[_]=="number"||e[_]instanceof Number||typeof e[_]=="string"||e[_]instanceof String||typeof e[_]=="boolean"||e[_]instanceof Boolean)&&(window.debug&&console.log(_,s[_],"<=",e[_]),s[_]=e[_])):w==="number"?(y!=w&&console.warn(`Dtype: ${h} sProp('${_}') Dst:"${y}"<=Src:"${w}"`),s[_]=e[_]):w==="boolean"?(y!=w&&console.warn(`Dtype: ${h} sProp('${_}') Dst:"${y}"<=Src:"${w}"`),s[_]=e[_]):w==="string"?(y!=w&&console.warn(`Dtype: ${h} sProp('${_}') Dst:"${y}"<=Src:"${w}"`),s[_]=e[_]):w===null&&s[_]!==void 0&&(s[_]=null)}s.needsUpdate!==void 0&&(s.needsUpdate=!0)}if(s.morphTargetInfluences&&e.morphTargetInfluences_cache){s.morphTargetInfluences_cache=s.morphTargetInfluences.slice(),s.morphTargetInfluences_backup=s.morphTargetInfluences.slice(),s.morphTargetInfluences_coef=s.morphTargetInfluences.slice(),s.morphTargetInfluences_result=s.morphTargetInfluences.slice(),s.morphTargetInfluences.fill(0),s.morphTargetInfluences_cache.fill(0),s.morphTargetInfluences_backup.fill(0),s.morphTargetInfluences_result.fill(0),s.morphTargetInfluences_coef.fill(1);{const _=s.morphTargetInfluences_cache,b=e.morphTargetInfluences_cache;if(b){const v=e.morphTargetDictionary,w=s.morphTargetDictionary;if(v&&w)for(const y in w)v[y]!=null&&(_[w[y]]=b[v[y]])}}{const _=s.morphTargetInfluences_coef,b=e.morphTargetInfluences_coef;if(b){const v=e.morphTargetDictionary,w=s.morphTargetDictionary;if(v&&w)for(const y in w)v[y]!=null&&(_[w[y]]=b[v[y]])}}}}var debug$a=window.debug;class SynchronizedClock{constructor(e,i){this.current_time_func=e,this.t=this.current_time_func(),this.destructor=i}getDelta(){const e=this.t,i=this.current_time_func();return this.t=i,i-e}destructor=null}const PLAYING_STATE={NONE:0,PLAYING:1,PAUSING:2};let card_info=null,native_gl_context=null;class MainContext{constructor(e){const i=this;this.selectObject=function(r){},this.event_listener=null,this.ui={system_flags:{ik:!0,physics:!0,loop:!0,no_end_time:!1,grant:!0},generic_flags:{},renderer_flags:{render_passes:{}},material_flags:{},rigid_body_flags:{},bone_flags:{},light_flags:{}},this.editing_scripts={},this.canvas=e,this.scene=null,this.helper_scene=null,this.renderers={},this.effects={},this.draggable=!0,this.droppable=!0,this.current={_ground:null,_renderer:null,_object:null,set object(r){i.selectObject(r),this._object=r},get object(){return this._object},set renderer(r){this._renderer=r},get renderer(){return this._renderer},set ground(r){this._ground=r},get ground(){return this._ground}},this.transform_controls=null,this.clock=null,this.animation_world_time=0,this.delta_queue=[],this.ready=!1,this.builder=null,this.sound_listener=null,this.PLAYING_STATE=PLAYING_STATE,this.playing_state=PLAYING_STATE.NONE,this.playbackRate=1,this.project_setting={},this.helper_view_behavior=1,this.draw_thread_after_runner=[],this.draw_thread_before_runner=[],this.resize_event_after_runner=[],this.show_helper_semaphore=0,this.stacked_error=[],this.static_clock=null,this.backgrounds=new Map,this.overlays=new Map,this.needsPrecompile=!0,this.mmd_animation_helper=null,this.main_mode="geometry_controller",document.addEventListener("mousemove",r=>{this.mouse_point_x=r.clientX,this.mouse_point_y=r.clientY}),this.object_callbacks={on_start:[],on_pause:[],on_resume:[],on_stop:[]},this.plugins_flags={},this.global_event_listener={},this.G_CPU_ObserverTimer=null,this.ammo_state=0,this.xr=null}async initialize(){this.plugins_flags=JSON.parse(await __storage__.editor_permanent.get("plugins_flags","{}"))}async initialize_physics(){if(this.ammo_state==1)for(;this.ammo_state==1;)await new Promise(e=>setTimeout(e,100));this.ammo_state==0&&(this.ammo_state=1,await __vitePreload(()=>import("./ammo.wasm@BN1wDPbS.js"),[],import.meta.url),window.Ammo=await window.Ammo.bind(window)(),await Ammo.ready,console.log("Ammo: ready"),this.ammo_state=2)}getVideoCardInfo(){if(card_info)return card_info;const e=native_gl_context||document.createElement("canvas").getContext("webgl");if(!e)return alert("Error: No WebGL"),{error:"no webgl"};const i=e.getExtension("WEBGL_debug_renderer_info"),r=i?e.getParameter(i.UNMASKED_RENDERER_WEBGL):e.getParameter(e.RENDERER);let o="unknown";r&&(r.indexOf("Apple M")>=0?o="low":r.indexOf("NVIDIA")>=0||r.indexOf("Radeon")>=0?o="high":r.indexOf("Intel")>=0&&(o="low")),window.isSmartPhone&&(o="low");const l={renderer:r||"None",grade:o};return card_info=l,l}async getGlobalUIFlags(){const e=JSON.parse(await __storage__.editor_permanent.get("global_ui_flags","{}"));return e.replace_mode_object_prop=e.replace_mode_object_prop??!1,e.replace_mode_trs=e.replace_mode_trs??!0,e.replace_mode_material=e.replace_mode_material??!1,e.replace_mode_morphing=e.replace_mode_morphing??!1,e.replace_mode_action=e.replace_mode_action??!0,e.replace_mode_deco_prop=e.replace_mode_deco_prop??!0,e}async setGlobalUIFlags(e){await __storage__.editor_permanent.set("global_ui_flags",JSON.stringify(e))}setSynchronizeClock(e,i){this.synchronized_clock&&(this.synchronized_clock.destructor?.(),this.synchronized_clock=null),e&&(this.synchronized_clock=new SynchronizedClock(e,i))}setSizeToBaseRenderer(e=DMC.canvas.clientWidth,i=DMC.canvas.clientHeight){const r=this,o=r.ui.renderer_flags,l=r.base_renderer;o.use_retina?(l.setPixelRatio(window.devicePixelRatio),l.setSize(e,i)):(l.setPixelRatio(1),l.setSize(e,i,!1))}set_gl_context(e){native_gl_context=e}removeEventListener(e,i){this.global_event_listener[e]&&delete this.global_event_listener[e][i]}addEventListener(e,i){this.global_event_listener[e]||(this.global_event_listener[e]={}),this.global_event_listener[e][i]=i}setEventListener(e,i){this.global_event_listener[e]={},this.global_event_listener[e][i]=i}dispatchEvent(e,i){if(this.global_event_listener[e])for(const r in this.global_event_listener[e])this.global_event_listener[e][r](i)}apply_deferred_effect(){}get_selected_objects(){const e=this,i=document.querySelectorAll(".tree_component_item.active"),r=[];for(let o=0;o<i.length;o++){const l=i[o];e.scene.traverse(a=>{a.uuid==l.dataset.uuid&&r.push(a)})}return{doms:i,objects:r}}getObjectByDecoType(e){if(e==null)return null;const i=this.getObjectsByDecoType();return i.length>0?i[0]:null}getObjectsByDecoType(e){if(e==null)return[];const i=this,r=[];return i.scene.traverse(o=>{o.getDDDProperties?.()?.type==e&&r.push(o)}),r}getLights(){const e=this,i=[];return e.scene.traverse(r=>{r.getDDDProperties?.()?.is_light&&i.push(r)}),i}getBackgrounds(){const e=this,i=[];return e.scene.traverse(r=>{r.getDDDProperties?.()?.is_background&&i.push(r)}),i}getMeshes(){const e=this,i=[];return e.scene.traverse(r=>{r.isMesh&&i.push(r)}),i}getMaterials(){const e=this;let i=[];return e.scene.traverse(r=>{r.material&&(i=i.concat(Array.isArray(r.material)?r.material:[r.material]))}),i}onChangeCamera(e){const i=this;i.current.camera=e||i.camera;for(const r in i.render_passes){const l=i.render_passes[r].pass;l&&l.camera&&(l.camera=i.current.camera)}i.viewport_overlay.camera=i.transform_controls.camera=i.current.camera}apply_shadow_map(e){const i=this,r=i.base_renderer;if(e+""=="null")r.shadowMap.enabled=!1,i.needsPrecompile=!0,debug$a&&console.log("none");else if(e=="pcss")r.shadowMap.type=THREE.PCFSoftShadowMap,r.shadowMap.enabled=!0,i.needsPrecompile=!0,debug$a&&console.log("pcss");else{const o=Number(e);o==THREE.VSMShadowMap?(r.shadowMap.type=THREE.VSMShadowMap,r.shadowMap.enabled=!0,i.needsPrecompile=!0,debug$a&&console.log("VSMShadowMap")):o==THREE.PCFShadowMap?(r.shadowMap.type=THREE.PCFShadowMap,r.shadowMap.enabled=!0,i.needsPrecompile=!0,debug$a&&console.log("PCFShadowMap")):o==THREE.PCFSoftShadowMap?(r.shadowMap.type=THREE.PCFSoftShadowMap,r.shadowMap.enabled=!0,i.needsPrecompile=!0,debug$a&&console.log("PCFSoftShadowMap")):o==THREE.BasicShadowMap?(r.shadowMap.type=THREE.BasicShadowMap,r.shadowMap.enabled=!0,i.needsPrecompile=!0,debug$a&&console.log("BasicShadowMap")):console.error("Invalid ShadowMap type",o)}}getCameras(){const e=[];return this.scene.traverse(i=>{i.isCamera&&e.push(i)}),e}getObjectBySubUUID(e){let i=null;return this.scene.traverse(r=>{const o=r.getDDDProperties?.();o?.uuid&&o.uuid==e&&(i=r)}),i}getObjectByUUID(e){let i=null;return this.scene.traverse(r=>{r.uuid==e&&(i=r)}),i}removeHelper(e){const i=[];this.helper_scene.traverse(r=>{e(r)&&i.push(r)});for(const r of i)this.helper_scene.remove(r)}reload(){window.external_io==null&&window.nodejs&&window.nodejs.ipcRenderer.invoke("close_sub_windows");const e=document.createElement("div");e.style.cssText="position:fixed;width:100%;height:100%;top:0;left:0;background:#222;z-index:1000000;opacity:0;",document.body.appendChild(e);const i=r=>{r<=0?(e.style.opacity="1",location.reload()):(e.style.opacity=`${1-r}`,setTimeout(()=>{i(r-.1)},20))};i(1)}cpu_observer=async(e=void 0)=>{if(window.nodejs?.os==null)return;const i=this;function r(l){debug$a&&l&&console.log("Enabled CPU Observer",l);let a=document.getElementById("cpu_observer");if(!l){i.G_CPU_ObserverTimer&&clearInterval(i.G_CPU_ObserverTimer),a&&(a.innerHTML="",a.remove());return}const d=window.nodejs.os.cpus(),u=document.getElementById("main_frame");a==null?(a=document.createElement("div"),a.id="cpu_observer",u.appendChild(a)):a.innerHTML="",i.G_CPU_ObserverTimer&&clearInterval(i.G_CPU_ObserverTimer);const f=4,m=d.length*f+d.length*1,h=25;a.style.cssText=`position:absolute;left:95px;top:5px;width:${m}px;height:${h}px;background:#000;border:1px solid #444`,a.style.zIndex="1";const _=window.nodejs.cpuStats;i.G_CPU_ObserverTimer=setInterval(()=>{_(1e3,function(b,v){if(b)return console.error(b);if(a.innerHTML="",i.G_CPU_ObserverTimer){for(const w of v){const y=document.createElement("div");y.style.cssText=`width:${Math.floor(f)}px;height:${Math.floor(h*(1-w.cpu/100))}px;background:#333;`;const M=document.createElement("div");M.style.cssText=`width:${Math.floor(f)}px;height:${h}px;background:#7AF;float:left;margin-right:1px;`,M.appendChild(y),a.append(M)}if(process?.memoryUsage){const w=document.createElement("div");w.style.cssText="color:#8EF;font-family:monospace;font-size:10px;text-shadow: #000 0px 0 1px;",w.innerText=`${(process.memoryUsage().heapUsed/1e6).toFixed(1)}MB`,a.appendChild(w)}}else a.remove()})},1e3)}const o=await GetSystemPreferences();r(e||o.ui.system_flags.cpu_observer)};async gpu_observer(e=void 0){const i=this,r=await GetSystemPreferences(),o=e||r.ui.system_flags.gpu_observer;if(o)debug$a&&console.log("Enabled GPU Observer",o),i.draw_call_status?.timer&&clearInterval(i.draw_call_status.timer),i.draw_call_status={},i.draw_call_status.timer=setInterval(()=>{for(const l in i.draw_call_status){if(l=="timer")continue;const a=i.draw_call_status[l];typeof a!="object"&&i.display_meta_information(l,a,l)}},1e3);else{for(const l in i.draw_call_status)typeof i.draw_call_status[l]!="object"&&i.display_meta_information(l,void 0,l);i.draw_call_status?.timer&&clearInterval(i.draw_call_status.timer),i.draw_call_status=null}}start_gpu_status_check(){this.base_renderer.info.reset()}end_gpu_status_check(){const e=this,i=e.draw_call_status,r=e.base_renderer;i&&(i.geometries=r.info.memory.geometries,i.textures=r.info.memory.textures,i.calls=r.info.render.calls,i.triangles=r.info.render.triangles,i.points=r.info.render.points,i.lines=r.info.render.lines,i.shaders=r.info.programs.length)}texture_observer(){const e=this;function i(){const l="ws://localhost:33951";e.ws_texture_updater_table={},e.ws_texture_updater_socket=null,e.ws_texture_updater_socket_is_preparing=!1,e.ws_texture_updater_server_socket=null;function a(m,h){h.wrapS&&(m.wrapS=h.wrapS),h.wrapT&&(m.wrapT=h.wrapT),h.magFilter&&(m.magFilter=h.magFilter),h.minFilter&&(m.minFilter=h.minFilter),h.colorSpace&&(m.colorSpace=h.colorSpace),h.flipY&&(m.flipY=h.flipY),h.anisotropy&&(m.anisotropy=h.anisotropy),h.rotation&&(m.rotation=h.rotation),h.premultiplyAlpha&&(m.premultiplyAlpha=h.premultiplyAlpha),h._source_file_&&(m._source_file_=h._source_file_),h.source_file&&(m.source_file=h.source_file),h.repeat&&(m.repeat?m.repeat.copy(h.repeat):m.repeat=h.repeat.clone()),h.offset&&(m.offset?m.offset.copy(h.offset):m.offset=h.offset.clone()),h.center&&(m.center?m.center.copy(h.center):m.center=h.center.clone()),m instanceof THREE.CompressedTexture||m instanceof THREE.VideoTexture?m.generateMipmaps=!1:m.generateMipmaps=h.generateMipmaps,m instanceof THREE.VideoTexture&&h instanceof THREE.VideoTexture&&(m.image.volume=h.image.volume,m.image.loop=h.image.loop,m.image.muted=h.image.muted,m.image.autoplay=h.image.autoplay),m.needsUpdate=!0}function c(m,h,_,b){const v=h[b];let w=v.source_file||v._source_file_;w&&(w=w.replace(/\\/g,"/"),e.ws_texture_updater_table[w]||(e.ws_texture_updater_table[w]=[]),e.ws_texture_updater_table[w].push(y=>{const M=y.clone();a(M,v),_>=0?m.material_overwrite?m.material[_][b]=m.material_overwrite[_][b]=M:m.material[_][b]=M:m.material_overwrite?m.material[b]=m.material_overwrite[b]=M:m.material[b]=M,v.dispose()}))}function d(m="absolute_path"){e.scene.traverse(h=>{if(h.isMesh&&h.material){const _=h.material;if(Array.isArray(_))for(let b=0;b<h.material.length;b++)for(const v in _[b])_[b][v]&&_[b][v]instanceof THREE.Texture&&c(h,_[b],b,v);else for(const b in _)_[b]&&_[b]instanceof THREE.Texture&&c(h,_,-1,b)}})}function u(){e.ws_texture_updater_table={},e.ws_texture_updater_socket&&e.ws_texture_updater_socket.close(),e.ws_texture_updater_server_socket&&e.ws_texture_updater_server_socket.close(),e.ws_texture_updater_server_socket=null,e.ws_texture_updater_socket=null,e.ws_texture_updater_socket_is_preparing=!1}function f(m,h){if(window.nodejs){const _=window.nodejs.net;if(e.ws_texture_updater_server_socket=_.createServer(b=>{e.ws_texture_updater_table={},d();const v=[];b.on("data",w=>{v.push(w)}),b.on("close",()=>{const w=Buffer.concat(v),y=w.slice(0,1024),M=w.slice(1024,w.length),S=JSON.parse(y.toString("utf-8"));if(S.key=S.key.replace(/\\/g,"/"),e.ws_texture_updater_table[S.key]){const D=S.params,k=M,O=new THREE.DataTexture(k,D.width,D.height),L=e.ws_texture_updater_table[S.key];for(const P of L)P(O);UI.event_notify("Updated: "+S.key)}})}),process.platform=="win32")e.ws_texture_updater_server_socket.listen(33952);else{try{window.nodejs.fs.unlinkSync("/tmp/texture_updater_unix.sock")}catch{}e.ws_texture_updater_server_socket.listen("/tmp/texture_updater_unix.sock")}}else if(e.ws_texture_updater_socket==null&&e.ws_texture_updater_socket_is_preparing==!1){e.ws_texture_updater_socket_is_preparing=!0;let _=null;try{_=new WebSocket(l)}catch(b){return console.error(b),e.ws_texture_updater_socket_is_preparing=!1,e.ws_texture_updater_socket=null,e.ws_texture_updater_table={},!1}_.onopen=function(b){e.ws_texture_updater_socket_is_preparing=!1,e.ws_texture_updater_socket=_,e.ws_texture_updater_socket.send(JSON.stringify({event:"bind",params:{}})),d()},_.onclose=function(b){e.ws_texture_updater_socket_is_preparing=!1,e.ws_texture_updater_socket=null,e.ws_texture_updater_table={}},_.onerror=function(b){e.ws_texture_updater_socket_is_preparing=!1,e.ws_texture_updater_socket=null,e.ws_texture_updater_table={}},_.onmessage=function(b){const v=JSON.parse(b.data);if(v.event!="bound"){if(v.event=="update_texture"&&e.ws_texture_updater_table[v.key]){const w=v.params,y=w.buffer,M=window.atob(y),S=M.length,D=new Uint8ClampedArray(S);for(let L=0;L<S;L++)D[L]=M.charCodeAt(L);const k=new THREE.DataTexture(D,w.width,w.height),O=e.ws_texture_updater_table[v.key];for(const L of O)L(k)}}}}}return{enable_ws_texture_updater:f,disable_ws_texture_updater:u}}const r=i(),o=setInterval(async()=>{e.main_is_ready&&(clearInterval(o),(await GetSystemPreferences()).ui.system_flags.texture_network_updater?(r.enable_ws_texture_updater(),e.display_meta_information("TexNet","Y","texture_network_updater")):(r.disable_ws_texture_updater(),e.display_meta_information("TexNet",void 0,"texture_network_updater")))},1e3)}apply_material_conditions(e){const i=this;function r(o){if(Array.isArray(o))for(let l=0;l<o.length;l++){const a=o[l];e(a),a.needsUpdate=!0}else e(o),o.needsUpdate=!0}i.scene.traverse(o=>{o.material&&r(o.material),o.material_overwrite&&r(o.material_overwrite)})}update_user_defined_property_on_system_panel(){}apply_anisotropic_texture(){if(window.anisotropy!==void 0){const e=Number(window.anisotropy);debug$a&&console.log("Anisotropy:",window.anisotropy),e!==void 0&&this.apply_material_conditions(i=>{for(const r in i)i[r]instanceof THREE.Texture&&i[r].anisotropy!=e&&(i[r].anisotropy=e,i[r].needsUpdate=!0)})}}apply_global_plugins(){const e=this;e.plugins={global:{},tool:{},ui:{},render:{},material:{},tree:{},fs:{}}}update_material(){this.apply_material_conditions(e=>{e.needsUpdate=!0})}play(){this.prepare_audio_context(),this._play()}stop(){this.prepare_audio_context(),this._stop()}_play(){const e=this;e.overlay_canvas2d.getContext("2d").clearRect(0,0,e.overlay_canvas2d.width,e.overlay_canvas2d.height);const r=e.ui.system_flags.ik??!0,o=e.ui.system_flags.grant??!0;if(e.playing_state===PLAYING_STATE.PLAYING){e.playing_state=PLAYING_STATE.PAUSING;for(const l of e.object_callbacks.on_pause)l();this.pause_media(),e.mmd_animation_helper&&(e.mmd_animation_helper.enable("animation",!1),e.mmd_animation_helper.enable("ik",r),e.mmd_animation_helper.enable("grant",o),e.mmd_animation_helper.enable("cameraAnimation",!1));for(const l of e.helper_doms)l.style.display=l.dataset.display;e.dispatchEvent("paused@scene",{})}else if(e.playing_state===PLAYING_STATE.PAUSING){e.playing_state=PLAYING_STATE.PLAYING,e.transform_controls.detach(),e.mmd_animation_helper&&(e.mmd_animation_helper.enable("animation",!0),e.mmd_animation_helper.enable("ik",r),e.mmd_animation_helper.enable("grant",o),e.mmd_animation_helper.enable("cameraAnimation",!0)),e.play_media();for(const l of e.object_callbacks.on_resume)l();e.dispatchEvent("resumed@scene",{})}else{if(e.ui.renderer_flags.fps==0){C.modal_ok_cancel("Error","<div>FPS must be -1 or not zero.</div><div>Setup FPS value on graphics panel.</div>",{cancel:null});return}window.__DUMMY_AUDIO__.play().then(a=>{}).catch(a=>{}),window.__DUMMY_AUDIO__.pause();const l=e.camera_posture_backup=new Map;e.scene.traverse(a=>{if(a.isCamera){const c={position:a.position.clone(),quaternion:a.quaternion.clone(),up:a.up.clone(),near:a.near,far:a.far,fov:a.fov,zoom:a.zoom,target:a.target?.clone?.()};l.set(a,c)}});{let c=e.ui.system_flags.start_time??0;c+=e.animation_world_time,performance.now(),e.reset_animation(c),e.playing_state=PLAYING_STATE.PLAYING,e.transform_controls.detach(),e.scene.traverse(d=>{if((d.getDDDProperties?.()||{}).audio?.apply_and_warmup?.(),d.script?.length>0&&window.script_runner(d),d.isMesh&&(d.__prevent__motion_blur__=!0),d.isMMD){const f=d._skelton_helper?.parent,m=d._ikHelper?.parent,h=d._physicsHelper?.parent;(f||m||h)&&d.getDDDProperties().recreate_helpers()}}),e.recreate_cache_table(),e.play_media({is_start:!0}),e.mmd_animation_helper.enable("animation",!0),e.mmd_animation_helper.enable("ik",r),e.mmd_animation_helper.enable("grant",o),e.mmd_animation_helper.enable("cameraAnimation",!0);for(const d of e.object_callbacks.on_start)d();e.scene.traverse(d=>{const u=d.user?.updaters;if(u)for(const f in u)u[f](c)}),e.dispatchEvent("started@scene",{})}}}_stop(){const e=this;e.playing_state=PLAYING_STATE.NONE,e.animation_world_time=0;for(const l of e.object_callbacks.on_stop)l();e.stop_media(),e.animation_world_time=0;function i(l){if(l.isMMD){try{e.mmd_animation_helper.remove(l)}catch{}l.pose?.();try{e.mmd_animation_helper.add(l)}catch{}l.morphTargetInfluences?.fill?.(0),l.morphTargetInfluences_backup?.fill?.(0)}}i(e.current.camera||e.camera),e.scene.traverse(l=>{l._animation_clock_!=null&&(l._animation_clock_=0),l.initializeAction?.()}),e.reset_animation(-1e-5),e.renderer_animation_update(0,1e-5),e.scene.traverse(l=>{if(l.isCamera){const a=e.camera_posture_backup?.get?.(l),c=l.getCurrentAction?.()?.index??-1;a&&c!=-1&&(a.target&&l.target.copy(a.target),l.position.copy(a.position),l.quaternion.copy(a.quaternion),l.up.copy(a.up),l.near=a.near,l.far=a.far,l.fov=a.fov,l.zoom=a.zoom,l.updateProjectionMatrix())}if(l.isMesh&&(l.__prevent__motion_blur__=!0),l.isMMD){const a=l._skelton_helper,c=l._ikHelper,d=l._physicsHelper;(a||c||d)&&l.getDDDProperties().recreate_helpers()}});const r=e.ui.system_flags.ik??!0,o=e.ui.system_flags.grant??!0;e.mmd_animation_helper.enable("animation",!1),e.mmd_animation_helper.enable("ik",r),e.mmd_animation_helper.enable("grant",o),e.mmd_animation_helper.enable("cameraAnimation",!1);for(const l of e.helper_doms)l.style.display=l.dataset.display;e.dispatchEvent("ended@scene",{}),e.scene.traverse(l=>{l.updateProbe&&l.updateProbe()})}recreate_cache_table(){const e=this,i=e.object_callbacks={on_start:[],on_pause:[],on_resume:[],on_stop:[]};e.scene.traverse(r=>{r.onPaused&&i.on_pause.push(r.onPaused),r.onStarted&&i.on_start.push(r.onStarted),r.onStopped&&i.on_stop.push(r.onStopped),r.onResumed&&i.on_resume.push(r.onResumed);const o=r.getDDDProperties?.()||{};if(o.audio?.instance){const l=o.audio.instance;try{l.offset=0,l.play()}catch(a){console.warn(a)}try{l.pause()}catch(a){console.warn(a)}}if(r.isMesh&&r.material)if(Array.isArray(r.material))for(let l=0;l<r.material.length;l++){const a=r.material[l];for(const c in a)a[c]instanceof THREE.VideoTexture&&(a[c].play&&a[c].play(),a[c].pause&&a[c].pause())}else{const l=r.material;for(const a in l)l[a]instanceof THREE.VideoTexture&&(l[a].play&&l[a].play(),l[a].pause&&l[a].pause())}})}sound_play(e,i){if(e instanceof THREE.Audio){const o=(e.getDDDProperties?.()||{}).audio;if(o){const l=e;try{l.stop()}catch{}try{o.auto_start&&!o.use_keyframes&&o.apply_and_play(i)}catch(a){console.warn(a)}}}}sound_pause(e){if(e instanceof THREE.Audio)try{e.pause?.()}catch(i){console.warn(i)}}sound_stop(e){if(e instanceof THREE.Audio&&e.isPlaying)try{e.stop?.()}catch(i){console.warn(i)}}prepare_audio_context(e=!0){const i=this;i.sound_listener==null&&(window.__DUMMY_AUDIO__.play().then(o=>{}).catch(o=>{}),window.__DUMMY_AUDIO__.pause(),i.sound_listener=BindObjectAsDDD(new THREE.AudioListener,{is_background:!0,type:"audio_listener",kind:"audio_listener",restore:!1,draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,transform_controller:!1,drawable:!1,cast_shadow:!1,receive_shadow:!1}));const r=i.current.camera||i.camera;if(r&&i.sound_listener){const o=[];i.scene.traverse(l=>{l instanceof THREE.AudioListener&&o.push(()=>{l.parent&&l.parent.remove(l)})});for(const l of o)l();r.add(i.sound_listener)}else debug$a&&e&&console.warn("Required camera object in scene.")}_play_video_texture_(e){const i=this;i.ui.system_flags.loop;const o=i.animation_world_time;if(e instanceof THREE.VideoTexture&&e.play){e.play();const l=e.getCurrentTime();Math.abs(l-o)>1&&e.setCurrentTime(o)}}_stop_video_texture_(e){e instanceof THREE.VideoTexture&&e.stop&&e.stop()}_pause_video_texture_(e){e instanceof THREE.VideoTexture&&e.pause&&e.pause()}play_media(e={is_start:!1}){const i=this;i.scene.traverse(r=>{if(i.sound_play(r),r.isMesh&&r.material)if(Array.isArray(r.material))for(let o=0,l=r.material.length;o<l;++o){const a=r.material[o];for(const c in a)this._play_video_texture_(a[c])}else{const o=r.material;for(const l in o)this._play_video_texture_(o[l])}else r.map&&this._play_video_texture_(r.map)})}stop_media(){const e=this;e.scene.traverse(i=>{if(e.sound_stop(i),i.isMesh&&i.material)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++){const o=i.material[r];for(const l in o)this._stop_video_texture_(o[l])}else{const r=i.material;for(const o in r)this._stop_video_texture_(r[o])}else i.map&&this._stop_video_texture_(i.map)})}pause_media(){const e=this;e.scene.traverse(i=>{e.sound_pause(i);const r=i.getDDDProperties?.()||{};if(r.audio?.instance)try{r.audio.instance.pause()}catch(o){console.warn(o)}if(i.isMesh&&i.material)if(Array.isArray(i.material))for(let o=0;o<i.material.length;o++){const l=i.material[o];for(const a in l)this._pause_video_texture_(l[a])}else{const o=i.material;for(const l in o)this._pause_video_texture_(o[l])}else i.map&&this._pause_video_texture_(i.map)})}reset_physics(){const e=this;if(e.mmd_animation_helper){const i=e.mmd_animation_helper.is_enabled("physics");e.mmd_animation_helper.enable("physics",!1);const r=e.animation_world_time;e.scene.traverse(l=>{if(l.isMMD&&!l.isCamera){try{e.mmd_animation_helper.remove(l)}catch{}l.pose?.();try{e.mmd_animation_helper.add(l,{warmup:30*3})}catch{}const a=l.getDDDProperties?.();a&&a.recreate_helpers&&a.recreate_helpers(),l.initializeAction?.(),l.updateActions?.(r)}}),e.mmd_animation_helper.reset_physics();const o={force_update_physics:!1,force_update_animation:!0,force_update_ik:!0,force_update_grant:!0,delta:1e-7};e.mmd_animation_helper.update(1e-7,o),e.mmd_animation_helper.reset_physics(),e.mmd_animation_helper.enable("physics",i)}}reset_animation_of_single_object(e){if(e==null)return;const i=this,r=i.mmd_animation_helper.enabled.physics;if(i.mmd_animation_helper.enable("physics",!1),e.isMMD){try{i.mmd_animation_helper.remove(e)}catch{}e.pose?.();try{i.mmd_animation_helper.add(e)}catch{}e.morphTargetInfluences?.fill?.(0),e.morphTargetInfluences_backup?.fill?.(0);const c=e.getDDDProperties?.();c&&c.recreate_helpers&&c.recreate_helpers()}e.initializeAction?.(),e.isCamera||e.updateActions?.(e._animation_clock_??1e-7);const o=i.mmd_animation_helper.enabled.animation,l=i.mmd_animation_helper.enabled.ik,a=i.mmd_animation_helper.enabled.grant;i.mmd_animation_helper.enable("animation",!0),i.mmd_animation_helper.enable("ik",!0),i.mmd_animation_helper.enable("grant",!0),i.renderer_animation_update(0,1e-7,0,e),i.mmd_animation_helper.reset_physics_of_single_object(e),i.renderer_animation_update(0,1e-7,0,e),i.mmd_animation_helper.enable("animation",o),i.mmd_animation_helper.enable("ik",l),i.mmd_animation_helper.enable("grant",a),i.mmd_animation_helper.enable("physics",r)}reset_animation(e=null){const i=this;{i.animation_world_time=e;const r=i.mmd_animation_helper.enabled.physics;i.mmd_animation_helper.enable("physics",!1),i.scene.traverse(c=>{if(c.isMMD){try{i.mmd_animation_helper.remove(c)}catch{}c.pose?.();try{i.mmd_animation_helper.add(c,{warmup:0})}catch{}c.morphTargetInfluences?.fill?.(0),c.morphTargetInfluences_backup?.fill?.(0);const d=c.getDDDProperties?.();d&&d.recreate_helpers&&d.recreate_helpers()}c.initializeAction?.(),c.updateActions?.((e??0)+1e-5)});const o=i.mmd_animation_helper.enabled.animation,l=i.mmd_animation_helper.enabled.ik,a=i.mmd_animation_helper.enabled.grant;i.mmd_animation_helper.enable("animation",!0),i.mmd_animation_helper.enable("ik",!0),i.mmd_animation_helper.enable("grant",!0),e!=null?(debug$a&&console.log("reset_animation:Jump update",0,e+1e-6),i.renderer_animation_update(0,1e-6,0)):(debug$a&&console.log("reset_animation:Seq update",1e-6,0),i.renderer_animation_update(1e-6,0,0)),i.mmd_animation_helper.reset_physics(),e!=null?(debug$a&&console.log("reset_animation:Jump update",0,e+1e-6),i.renderer_animation_update(0,1e-6,0)):(debug$a&&console.log("reset_animation:Seq update",1e-6,0),i.renderer_animation_update(1e-6,0,0)),i.mmd_animation_helper.enable("animation",o),i.mmd_animation_helper.enable("ik",l),i.mmd_animation_helper.enable("grant",a),i.mmd_animation_helper.enable("physics",r)}}async reset_camera(){const e=DMC,i=e?.current?.camera;if(i)if(e.xr?.isEntered)e.xr.reset_camera(!0);else{const r=e.scene.isXRMode?.1:1;i.target.set(0,13*r,0),i.position.set(0,13*r,15*r),i.up.set(0,1,0),i.fov=45,i.near=1*r*r,i.far=1e5*r*r,i.updateMatrixWorld(),i.updateProjectionMatrix()}}async reset_geometry(){const e=DMC?.current?.object;e&&(e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.updateMatrixWorld())}async reset_material(){DMC?.current?.object&&C.modal_ok_cancel("Error","Not implemented yet@JBUWLPFTXR",{cancel:null})}async reset(){await __storage__.app.clear(),await __storage__.editor.clear(),await __storage__.project.clear(),this.reload()}async reset_all(){window.nodejs&&await window.nodejs.ipcRenderer.invoke("ResetAll"),window.external_io?.driver=="indexeddb"&&window.external_io.clear(),await __storage__.editor.clear(),await __storage__.project.clear(),await __storage__.system.clear(),await __storage__.editor_permanent.clear(),await __storage__.app.clear(),localStorage.clear(),this.reload()}async initializeXR(e,i,r={}){debug$a&&console.log("initializeXR");const o=this,{XRInitializer:l}=await __vitePreload(()=>import("./xr@DRMfj2L-.js"),[],import.meta.url);o.xr||(o.xr=await l(e,i,r))}async applyScalingForXR(e,i=void 0){const{XRController:r}=await __vitePreload(()=>import("./xr@DRMfj2L-.js"),[],import.meta.url);return r.applyScaling(e,i)}async initializeXRWithUI(e,i,r={}){debug$a&&console.log("initializeXRWithUI");const o=this;await o.initializeXR(e,i,r),o.xr.button.style.cssText="position: static; border: 0px; border-radius: 0px; background-color: #333333AA; color: #EEE; font: 12px sans-serif; text-align: center; opacity: 1; border-radius: 10px 0px 0px 10px; border-left: 1px solid #555; border-top: 1px solid #555; border-bottom: 1px solid #555; height: 19px; padding: 0px; margin: 0px; padding-left: 10px; padding-right: 10px;"}async completely_reset_settings(){window.nodejs&&await window.nodejs.ipcRenderer.invoke("ResetAll"),window.external_io?.driver=="indexeddb"&&window.external_io.clear(),localStorage.clear(),SiteStorage.deleteAllDatabases(),this.reload()}async toggle_fullscreen(){const e=this;let i=document.fullscreenEnabled;document.mozFullScreenEnabled!==void 0?i=document.mozFullScreenEnabled:document.webkitFullscreenEnabled!==void 0?i=document.webkitFullscreenEnabled:document.msFullscreenEnabled!==void 0&&(i=document.msFullscreenEnabled),i===void 0&&console.log("Does not support full screen.");function r(){return document.fullscreenElement!==void 0&&document.fullscreenElement!==null||document.mozFullScreenElement!==void 0&&document.mozFullScreenElement!==null||document.webkitFullscreenElement!==void 0&&document.webkitFullscreenElement!==null||document.webkitCurrentFullScreenElement!==void 0&&document.webkitCurrentFullScreenElement!==null||document.msFullscreenElement!==void 0&&document.msFullscreenElement!==null}if(i)if(r())await document.exitFullscreen?.(),await document.webkitCancelFullScreen?.(),await document.mozRequestFullScreen?.(),console.log("Fullscreen cancel");else{try{await e.canvas.webkitRequestFullScreen?.()}catch(o){debug$a&&console.warn(o)}try{await e.canvas.requestFullscreen?.()}catch(o){debug$a&&console.warn(o)}try{await e.canvas.mozRequestFullScreen?.()}catch(o){debug$a&&console.warn(o)}console.log("Fullscreen request")}}toggle_inspector(e){const i=this,o=document.getElementById("main_frame").querySelector(".project_meta"),l=i.stats;o&&l&&(e==null?(o.style.display=o.style.display=="none"?"block":"none",l.dom.style.display=l.dom.style.display=="none"?"block":"none"):(o.style.display=e?"block":"none",l.dom.style.display=e?"block":"none"))}toggle_world_time_component(e){window._UI_WorldTimelineComponent_();const i=document.getElementById("timeline_block");e==null?i.style.display=i.style.display=="none"?"block":"none":i.style.display=e?"block":"none"}display_meta_information(e,i,r){const o=document.getElementById("main_frame");let l=o.querySelector(".project_meta");l==null&&(l=document.createElement("table"),l instanceof HTMLTableElement&&(l.style.position="absolute",l.style.right="5px",l.style.top="40px",l.style.fontSize="11px",l.style.borderRadius="3px",l.style.border="1px solid #000000DD",l.style.padding="3px",l.style.background="#000000AA",l.classList.add("project_meta"),l.style.display="none",o.appendChild(l)));let a=document.getElementById(r||e),c=a;if(c||(a=document.createElement("tr")),a.innerHTML="",i===void 0)a.remove();else{const d=document.createElement("td"),u=document.createElement("td");d.style.textShadow="#000 1px 0 2px",u.style.textShadow="#000 1px 0 2px",u.style.borderLeft="1px solid #EEEEEE44",d.style.paddingLeft=u.style.paddingLeft="5px",d.style.paddingRight=u.style.paddingRight="5px",d.style.color=u.style.color="#ABF",d.style.alignItems=u.style.alignItems="center",d.style.textAlign="right",u.style.textAlign="left",a.id=r||e,d.innerHTML=e,u.innerHTML=i,a.innerHTML="",a.appendChild(d),a.appendChild(u),c||l.appendChild(a)}}async preset_profile(e){const i=DMC;let r={};const o=await GetSystemPreferences();if(o){const a=o;C.copy_prop(r,a),console.log(r.ui.renderer_flags.renderer,a.ui.renderer_flags.renderer)}const l=r.ui.renderer_flags;if(e=="minimal")await C.modal_ok_cancel_promise("Profile","Minimal profile will be applied and rebooted.<br>Are you sure?")&&(l.shadowMap_type=null,r.default_preset_scene="Room",l.environment_map.type="None",l.renderer="Forward",l.fps=30,r.default_preset_scene="Makeup Room",await SetSystemPreferences(r),this.reset());else if(e=="low")await C.modal_ok_cancel_promise("Profile","Low profile will be applied and rebooted.<br>Are you sure?")&&(l.shadowMap_type=THREE.PCFSoftShadowMap,r.default_preset_scene="Room",l.environment_map.type="Dynamic",l.renderer="Forward",l.fps=-1,r.default_preset_scene="Makeup Room",await SetSystemPreferences(r),this.reset());else if(e=="middle"){if(await C.modal_ok_cancel_promise("Profile","Middle profile will be applied and rebooted.<br>Are you sure?")){l.shadowMap_type=THREE.PCFSoftShadowMap,r.default_preset_scene="Room",l.environment_map.type="Dynamic",l.renderer="Deferred",l.fps=-1,r.default_preset_scene="Makeup Room",l.render_passes={};for(const c in i.render_passes)l.render_passes[c]={value:!1};["BaseRenderer","SMAA","MotionBlur","ColorFilters"].forEach(c=>{l.render_passes[c].value=!0}),await SetSystemPreferences(r),this.reset()}}else if(e=="high")await C.modal_ok_cancel_promise("Profile","High profile will be applied and rebooted.<br>Are you sure?")&&(l.shadowMap_type=THREE.PCFSoftShadowMap,r.default_preset_scene="None",l.environment_map.type="Static",l.renderer="Deferred",l.render_passes=void 0,l.fps=-1,r.default_preset_scene="None",await SetSystemPreferences(r),this.reset());else throw new Error(`Unknown profile name:${e}`)}}class RGBELoader extends DataTextureLoader{constructor(e){super(e),this.type=HalfFloatType}parse(e){const a=function(P,N){switch(P){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(N||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(N||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(N||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(N||""))}},f=`
`,m=function(P,N,z){N=N||1024;let Z=P.pos,V=-1,H=0,Y="",q=String.fromCharCode.apply(null,new Uint16Array(P.subarray(Z,Z+128)));for(;0>(V=q.indexOf(f))&&H<N&&Z<P.byteLength;)Y+=q,H+=q.length,Z+=128,q+=String.fromCharCode.apply(null,new Uint16Array(P.subarray(Z,Z+128)));return-1<V?(z!==!1&&(P.pos+=H+V+1),Y+q.slice(0,V)):!1},h=function(P){const N=/^#\?(\S+)/,z=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,K=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*FORMAT=(\S+)\s*$/,V=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,H={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,q;for((P.pos>=P.byteLength||!(Y=m(P)))&&a(1,"no header found"),(q=Y.match(N))||a(3,"bad initial token"),H.valid|=1,H.programtype=q[1],H.string+=Y+`
`;Y=m(P),Y!==!1;){if(H.string+=Y+`
`,Y.charAt(0)==="#"){H.comments+=Y+`
`;continue}if((q=Y.match(z))&&(H.gamma=parseFloat(q[1])),(q=Y.match(K))&&(H.exposure=parseFloat(q[1])),(q=Y.match(Z))&&(H.valid|=2,H.format=q[1]),(q=Y.match(V))&&(H.valid|=4,H.height=parseInt(q[1],10),H.width=parseInt(q[2],10)),H.valid&2&&H.valid&4)break}return H.valid&2||a(3,"missing format specifier"),H.valid&4||a(3,"missing image size specifier"),H},_=function(P,N,z){const K=N;if(K<8||K>32767||P[0]!==2||P[1]!==2||P[2]&128)return new Uint8Array(P);K!==(P[2]<<8|P[3])&&a(3,"wrong scanline width");const Z=new Uint8Array(4*N*z);Z.length||a(4,"unable to allocate buffer space");let V=0,H=0;const Y=4*K,q=new Uint8Array(4),J=new Uint8Array(Y);let W=z;for(;W>0&&H<P.byteLength;){H+4>P.byteLength&&a(1),q[0]=P[H++],q[1]=P[H++],q[2]=P[H++],q[3]=P[H++],(q[0]!=2||q[1]!=2||(q[2]<<8|q[3])!=K)&&a(3,"bad rgbe scanline format");let te=0,ie;for(;te<Y&&H<P.byteLength;){ie=P[H++];const Ce=ie>128;if(Ce&&(ie-=128),(ie===0||te+ie>Y)&&a(3,"bad scanline data"),Ce){const ve=P[H++];for(let we=0;we<ie;we++)J[te++]=ve}else J.set(P.subarray(H,H+ie),te),te+=ie,H+=ie}const oe=K;for(let Ce=0;Ce<oe;Ce++){let ve=0;Z[V]=J[Ce+ve],ve+=K,Z[V+1]=J[Ce+ve],ve+=K,Z[V+2]=J[Ce+ve],ve+=K,Z[V+3]=J[Ce+ve],V+=4}W--}return Z},b=function(P,N,z,K){const Z=P[N+3],V=Math.pow(2,Z-128)/255;z[K+0]=P[N+0]*V,z[K+1]=P[N+1]*V,z[K+2]=P[N+2]*V,z[K+3]=1},v=function(P,N,z,K){const Z=P[N+3],V=Math.pow(2,Z-128)/255;z[K+0]=DataUtils.toHalfFloat(Math.min(P[N+0]*V,65504)),z[K+1]=DataUtils.toHalfFloat(Math.min(P[N+1]*V,65504)),z[K+2]=DataUtils.toHalfFloat(Math.min(P[N+2]*V,65504)),z[K+3]=DataUtils.toHalfFloat(1)},w=new Uint8Array(e);w.pos=0;const y=h(w),M=y.width,S=y.height,D=_(w.subarray(w.pos),M,S);let k,O,L;switch(this.type){case FloatType:L=D.length/4;const P=new Float32Array(L*4);for(let z=0;z<L;z++)b(D,z*4,P,z*4);k=P,O=FloatType;break;case HalfFloatType:L=D.length/4;const N=new Uint16Array(L*4);for(let z=0;z<L;z++)v(D,z*4,N,z*4);k=N,O=HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:M,height:S,data:k,header:y.string,gamma:y.gamma,exposure:y.exposure,type:O}}setDataType(e){return this.type=e,this}load(e,i,r,o){function l(a,c){switch(a.type){case FloatType:case HalfFloatType:a.colorSpace=LinearSRGBColorSpace,a.minFilter=LinearFilter,a.magFilter=LinearFilter,a.generateMipmaps=!1,a.flipY=!0;break}i&&i(a,c)}return super.load(e,l,r,o)}}var debug$9=window.debug;const _vector$2_2=new Vector3,_vector$2_3=new Vector3,_vector$2_4=new Vector3,_vector$2_5=new Vector3,_quat$2_1=new Quaternion,_vector$2=new Vector3,_boneMatrix$1=new Matrix4,_mat4$2_1=new Matrix4,_matrixWorldInv$1=new Matrix4,_unit1=new Vector3(0,-1,0),_unit2=new Vector3(0,0,0),_quat$2_2=new Quaternion;function getBoneList(s){const e=[];s.isBone===!0&&e.push(s);for(let i=0;i<s.children.length;i++)e.push.apply(e,getBoneList(s.children[i]));return e}class SkeletonHelper extends LineSegments{constructor(e){const i=getBoneList(e),r=new BufferGeometry,o=[],l=[],a=new Color(.6,.5,1);for(let d=0;d<i.length;d++){const u=i[d];u._matrix_=new Matrix4,u._vector_=new Vector3,u.parent&&u.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),o.push(0,0,0),o.push(0,0,0),o.push(0,0,0),o.push(0,0,0),l.push(a.r,a.g,a.b),l.push(a.r,a.g,a.b),l.push(a.r,a.g,a.b),l.push(a.r,a.g,a.b),l.push(a.r,a.g,a.b),l.push(a.r,a.g,a.b))}r.setAttribute("position",new Float32BufferAttribute(o,3)),r.setAttribute("color",new Float32BufferAttribute(l,3));const c=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,c),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const i=window.DMC?.overlay_canvas2d,r=window.DMC?.overlay_canvas2d.getContext("2d");if(r==null||i==null)return;const o=this.bones;new Vector3;const l=i.width,a=i.height;r.save(),r.clearRect(0,0,l,a),r.strokeStyle="#9977FF",r.lineWidth=1;const c=4;this.root.geometry.userData.MMD.bones;let d=0;for(const u of o){u.__bone_index__=d++,u._ctx_point_==null&&(u._ctx_point_=new Vector3);const f=u._ctx_point_;f.set(0,0,0),f.applyMatrix4(u.matrixWorld),f.project(DMC.camera);const m=(f.x+1)*l*.5,h=(1-f.y)*a*.5;f.x=m,f.y=h}for(let u=0,f=o.length;u<f;++u){const m=o[u],h=m.raw,_=o[h.connectIndex],b=_?.raw;if(h&&b){const v=_?._ctx_point_,w=m._ctx_point_,y=b.flag,M=h.flag;if(M&8&&_&&v){const D=M&1,k=M&32,O=y&1;r.lineWidth=1,D?r.strokeStyle="#9999FF":r.strokeStyle="#9977FF",m.selected&&(r.strokeStyle="#FF0000"),r.beginPath(),r.arc(w.x,w.y,c,0,2*Math.PI),r.stroke(),r.beginPath(),O?r.strokeStyle="#9999FF":r.strokeStyle="#9977FF",k&&(r.strokeStyle="#00FF00"),m.selected&&(r.strokeStyle="#FF0000");let L=v.x-w.x,P=v.y-w.y,N=Math.sqrt(L*L+P*P)||1;L=L/N,P=P/N,r.moveTo(w.x-P*c,w.y+L*c),r.lineTo(v.x,v.y),r.moveTo(w.x+P*c,w.y-L*c),r.lineTo(v.x,v.y),r.stroke()}}}r.restore()}__updateMatrixWorld(e){const i=this.bones,r=this.geometry,o=r.getAttribute("position");_matrixWorldInv$1.copy(this.root.matrixWorld).invert();const l=DMC.current.camera||DMC.camera;l.updateMatrixWorld(),l.matrixWorld.decompose(_vector$2_2,_quat$2_1,_vector$2_3),_mat4$2_1.makeRotationFromQuaternion(_quat$2_1);for(let a=0,c=0;a<i.length;a++){const d=i[a];if(d.parent&&d.parent.isBone){_boneMatrix$1.multiplyMatrices(_matrixWorldInv$1,d.matrixWorld),_vector$2_2.setFromMatrixPosition(_boneMatrix$1),_boneMatrix$1.multiplyMatrices(_matrixWorldInv$1,d.parent.matrixWorld),d._matrix_.copy(_boneMatrix$1),_vector$2.setFromMatrixPosition(_boneMatrix$1),d._vector_.copy(_vector$2),_unit2.copy(_vector$2_2),_unit2.sub(_vector$2);const u=_unit2.length();_unit2.normalize(),_quat$2_2.setFromUnitVectors(_unit1,_unit2);const f=.025+.075*Math.min(1,u*.5);_vector$2_4.set(f,0,0),_vector$2_4.applyQuaternion(_quat$2_1),_vector$2_4.applyQuaternion(_quat$2_2),_vector$2_5.set(-f,0,0),_vector$2_5.applyQuaternion(_quat$2_1),_vector$2_5.applyQuaternion(_quat$2_2),_boneMatrix$1.makeTranslation(_vector$2_4.x,_vector$2_4.y,_vector$2_4.z),_boneMatrix$1.multiply(_matrixWorldInv$1),_boneMatrix$1.multiply(d.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix$1),_boneMatrix$1.makeTranslation(_vector$2_5.x,_vector$2_5.y,_vector$2_5.z),_boneMatrix$1.multiply(_matrixWorldInv$1),_boneMatrix$1.multiply(d.parent.matrixWorld),_vector$2_3.setFromMatrixPosition(_boneMatrix$1),o.setXYZ(c,_vector$2.x,_vector$2.y,_vector$2.z),o.setXYZ(c+1,_vector$2_2.x,_vector$2_2.y,_vector$2_2.z),o.setXYZ(c+2,_vector$2_2.x,_vector$2_2.y,_vector$2_2.z),o.setXYZ(c+3,_vector$2_3.x,_vector$2_3.y,_vector$2_3.z),o.setXYZ(c+4,_vector$2_3.x,_vector$2_3.y,_vector$2_3.z),o.setXYZ(c+5,_vector$2.x,_vector$2.y,_vector$2.z),c+=6}}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function morph_ext(s){s.morphTargetInfluences_cache=s.morphTargetInfluences.slice(),s.morphTargetInfluences_coef=s.morphTargetInfluences.slice(),s.morphTargetInfluences_backup=s.morphTargetInfluences.slice(),s.morphTargetInfluences_mask=s.morphTargetInfluences.slice(),s.morphTargetInfluences_result=s.morphTargetInfluences.slice(),s.morphTargetInfluences_cache.fill(0),s.morphTargetInfluences_coef.fill(1),s.morphTargetInfluences_backup.fill(0),s.morphTargetInfluences_mask.fill(0),s.morphTargetInfluences_result.fill(0);function e(i){for(let r=0;r<i.length;r++){const o=i[r];if(o.type===0){let l=0;for(let a=0;a<o.elementCount;a++){const c=o.elements[a];if(c==null||c.index==-1)continue;const d=c.index,u=i[d],f=c.ratio;u?.type==1&&(l+=Math.abs(f))}l>0&&(s.morphTargetInfluences_mask[r]=1)}else o.type===1&&(s.morphTargetInfluences_mask[r]=1)}}if(s.geometry?.morphs)e(s.geometry.morphs);else for(let i=0;i<s.morphTargetInfluences_mask.length;i++)s.morphTargetInfluences_mask[i]=1}async function apply_system_preferences_setting(s,e){const r=(await GetSystemPreferences({}))?.ui?.system_flags?.loading_behavior;if(r){const o=r[s.toUpperCase()];if(o){let l=function(a){o.force_disable_transparent&&(a.transparent=!1)};o.position&&e.position.set(o.position.x,o.position.y,o.position.z),o.scale&&e.scale.set(o.scale.x,o.scale.y,o.scale.z),o.rotation&&e.rotation.set(o.rotation.x,o.rotation.y,o.rotation.z),e.traverse(a=>{const c=a.material,d=a.material_overwrite;if(Array.isArray(c)){if(c)for(const u of c)l(u);if(d)for(const u of d)l(u)}else c&&l(c),d&&l(d)})}}}function obj(s){const e=TimeDurationChecker("OBJ: "+s);return new Promise((i,r)=>{(async()=>{const{OBJLoader:o}=await __vitePreload(()=>import("./OBJLoader@DdvHj1NM.js"),[],import.meta.url);new o().load(s,function(a){e.finish(),i(a)},null,r)})()})}function lwo(s){const e=TimeDurationChecker("LWO: "+s);return new Promise((i,r)=>{(async()=>{const{LWOLoader:o}=await __vitePreload(()=>import("./LWOLoader@B-IkBQlA.js"),[],import.meta.url);new o().load(s,function(a){e.finish(),i(a)},null,r)})()})}function stl(s){const e=TimeDurationChecker("STL: "+s);return new Promise((i,r)=>{(async()=>{const{STLLoader:o}=await __vitePreload(()=>import("./STLLoader@D0IhA1jF.js"),[],import.meta.url);new o().load(s,function(a){e.finish(),i(a)},null,r)})()})}function collada(s){const e=TimeDurationChecker("Collada: "+s);return new Promise((i,r)=>{(async()=>{const{ColladaLoader:o}=await __vitePreload(()=>import("./ColladaLoader@BkPnYAcc.js"),[],import.meta.url);new o().load(s,function(a,c,d){e.finish(),i(a)},null,r)})()})}function usdz(s){const e=TimeDurationChecker("USDZ: "+s);return new Promise((i,r)=>{(async()=>{const{USDZLoader:o}=await __vitePreload(()=>import("./USDZLoader@C78fv819.js"),__vite__mapDeps([0,1]),import.meta.url);new o().load(s,function(a){e.finish(),i(a)},null,r)})()})}function ply(s){const e=TimeDurationChecker("PLY: "+s);return new Promise((i,r)=>{(async()=>{const{PLYLoader:o}=await __vitePreload(()=>import("./PLYLoader@Bcs7uwLY.js"),[],import.meta.url);new o().load(s,function(a){e.finish(),i(a)},null,r)})()})}function mqo(s){const e=TimeDurationChecker("MQO: "+s);return new Promise((i,r)=>{(async()=>{await C.load_js("./libs/mqoparser.js"),await C.load_js("./libs/mqoconverter.js");const o=new LoadingManager;o.onProgress=function(l,a,c){console.log(l,a,c)},window.MqoParser.load(s,function(l){const a=window.MqoConverter.toTHREEJS_Geometry(l,{scale:.005}),c=window.MqoConverter.generateMaterials(l.materials,"asset"),d=[];for(const f of c)d.push(new MeshPhysicalMaterial(f));const u=new Mesh(a,d);e.finish(),i(u)})})()})}function vrm(s,e={}){const i=TimeDurationChecker("Load glTF");return Object.assign({scale:{x:1,y:1,z:1},position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},e),new Promise((o,l)=>{(async()=>{const{VRMLoaderPlugin:a}=await __vitePreload(()=>import("./three-vrm.module@-fSVt3d3.js"),[],import.meta.url),{GLTFLoader:c}=await __vitePreload(()=>import("./GLTFLoader@CYrxnVa8.js"),[],import.meta.url),{MeshoptDecoder:d}=await __vitePreload(()=>import("./meshopt_decoder.module@CkuQsJa_.js"),[],import.meta.url),u=s.substring(0,s.lastIndexOf("/")+1);s.substring(u.length,s.length);const f=new c().setPath(u);f.setKTX2Loader(await ktx2_loader()),f.setDRACOLoader(await draco_loader()),f.setMeshoptDecoder(d),f.register(h=>new a(h));const m=await _get_GLTFLoader_(s);m.loader.load(m.basename,async function(h){{let _=function(b){for(const v of b.scenes)v.traverse(w=>{});i.finish(),o(b)};if(window.external_io){const b=await window.cross_file_system.read(s);m.loader.parse(C.to_array_buffer(b),C.DPath(s).dirname,_,l)}else m.loader.load(m.basename,_,null,l)}},null,l)})()})}function tds(s){const e=TimeDurationChecker("3DS: "+s);return new Promise((i,r)=>{(async()=>{const{TDSLoader:o}=await __vitePreload(()=>import("./TDSLoader@hMk6mf8I.js"),[],import.meta.url),l=new o;l.setResourcePath(C.DPathJoin(C.DPath(s).dirname,"textures/")),l.load(s,function(a){e.finish(),i(a)},null,r)})()})}function fbx(s){const e=TimeDurationChecker("FBX: "+s);return new Promise((i,r)=>{(async()=>{const{FBXLoader:o}=await __vitePreload(()=>import("./FBXLoader_139@EwyvjmEk.js"),__vite__mapDeps([2,1]),import.meta.url);new o().load(s,function(a){e.finish(),i(a)},null,r)})()})}function pmx(s){const e=TimeDurationChecker("PMX: "+s);return new Promise((i,r)=>{(async()=>(await get_MMDLoader()).load(s,function(l){e.finish(),l.traverse(a=>{a&&(a.frustumCulled=!1)}),morph_ext(l),i(l)},null,r))()})}async function _get_GLTFLoader_(s){const{GLTFLoader:e}=await __vitePreload(()=>import("./GLTFLoader@CYrxnVa8.js"),[],import.meta.url),{MeshoptDecoder:i}=await __vitePreload(()=>import("./meshopt_decoder.module@CkuQsJa_.js"),[],import.meta.url),r=s.substring(0,s.lastIndexOf("/")+1),o=s.substring(r.length,s.length),l=new e().setPath(r);return l.setKTX2Loader(await ktx2_loader()),l.setDRACOLoader(await draco_loader()),l.setMeshoptDecoder(i),{loader:l,basename:o,dir_path:r}}function glTF(s,e={}){const i=TimeDurationChecker("Load glTF");return Object.assign({scale:{x:1,y:1,z:1},position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},e),new Promise((o,l)=>{(async()=>{const a=await _get_GLTFLoader_(s);function c(d){for(const u of d.scenes)u.traverse(f=>{});i.finish(),o(d)}if(window.external_io){const d=await window.cross_file_system.read(s);a.loader.parse(C.to_array_buffer(d),C.DPath(s).dirname,c,l)}else a.loader.load(a.basename,c,null,l)})()})}function BindChildren(s,e={}){function i(r){const o={type:"sub_object",kind:"sub_object"};o.draggable_on_tree=!1,o.droppable_on_tree=!1,o.draggable_on_3d=!1,o.droppable_on_3d=!1,o.removable=!1,o.managed=!1,Object.assign(o,e),BindObjectAsDDD(r,o);for(const l of r.children)i(l)}for(const r of s.children)i(r)}var ModelBuilder=function(){const s=this;s.makers={async lwo(e,i){const r="lwo";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await lwo(i);o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){const a=getDDDProperties(i),c=await lwo(a.source_file);o=BindObjectAsDDD(c,a)}await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)});const l=getDDDProperties(o);return o.name=l.source_file.split("/").pop(),o},async fbx(e,i){const r="fbx";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const l=await fbx(i);o=BindObjectAsDDD(l,{type:r,source_file:i,kind:"object"}),o.name=i.split("/").pop(),await setup_animation_helper_prop(o),o.getActionMode()=="Single"&&o.setCurrentAction(0),await setup_default_setting_for_action(o,LoopRepeat)}else if(typeof i=="object"){const l=getDDDProperties(i),a=await fbx(l.source_file);o=BindObjectAsDDD(a,l),await setup_animation_helper_prop(o)}return await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(l=>{l.frustumCulled!=null&&(l.frustumCulled=!1),l.castShadow!==void 0&&(l.castShadow=!0),l.receiveShadow!==void 0&&(l.receiveShadow=!0),l.morphTargetInfluences&&morph_ext(l)}),o},async stl(e,i){const r="stl";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await stl(i),c=new MeshPhongMaterial({ambient:16733491,color:16733491,specular:1118481,shininess:200,perPixel:!0}),d=new Mesh(a,c);d.castShadow=!0,d.receiveShadow=!0,o=BindObjectAsDDD(d,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){const a=getDDDProperties(i),c=await stl(a.source_file),d=new MeshPhongMaterial({ambient:16733491,color:16733491,specular:1118481,shininess:200,perPixel:!0}),u=new Mesh(c,d);u.castShadow=!0,u.receiveShadow=!0,o=BindObjectAsDDD(u,a)}await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)});const l=getDDDProperties(o);return o.name=l.source_file.split("/").pop(),o},"3ds":async function(e,i){const r="3ds";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await tds(i);o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){const a=getDDDProperties(i),c=await tds(a.source_file);o=BindObjectAsDDD(c,a)}await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)});const l=getDDDProperties(o);return o.name=l.source_file.split("/").pop(),o},async obj(e,i){const r="obj";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await obj(i);o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){const a=getDDDProperties(i),c=await obj(a.source_file);o=BindObjectAsDDD(c,a)}const l=getDDDProperties(o);return await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)}),o.name=l.source_file.split("/").pop(),o},async pmd(e,i){throw new Error("Removed implementation. Please use PMX instead.")},async pmx(e,i){let r=null;window.DMC&&(r=window.DMC.initialize_physics());const l=await(async(a,c)=>{const d="pmx";let u=null;if(typeof c=="string")c=c.replace(/\\/g,"/"),u=BindObjectAsDDD(await pmx(c),{type:d,source_file:c,kind:"object"});else if(typeof c=="object"){const b=getDDDProperties(c);if(b.source_file==null)return console.warn("Empty"),null;const v=await pmx(b.source_file);u=BindObjectAsDDD(v,b)}if(await apply_system_preferences_setting(d,u),BindChildren(u),u.skeleton){const b=u.getDDDProperties();let v=!1;for(const w of u.skeleton.bones)w.name=="上半身"&&(v=!0);v==!1?(b.transform_controller=!1,b.is_background=!0):(b.is_background=!1,u.renderOrder=1)}u.traverse(b=>{b.castShadow!==void 0&&(b.castShadow=!0),b.receiveShadow!==void 0&&(b.receiveShadow=!0),b.frustumCulled!==void 0&&(b.frustumCulled=!1)});const f=getDDDProperties(u);u.name=f.source_file.split("/").pop(),u.isMMD=!0,await setup_animation_helper_prop(u),f.recreate_helpers=function(b=!1){const v=u._physicsHelper?.parent,w=u._skelton_helper?.parent,y=u._ikHelper?.parent;if(b&&f._delete_helpers_(),debug$9&&console.log(u.name,"recreate_helpers"),b||u._ikHelper==null){const M=y;u._ikHelper?.parent&&u._ikHelper.removeFromParent();const S=DMC.mmd_animation_helper.objects.get(u)?.ikSolver?.createHelper?.();S&&(S.is_ik_helper=!0,S.name="IKHelper - "+(u.name?u.name:""),BindObjectAsDDD(S,{type:"physics_helper",restore:!1,draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,removable:!1,controllable_geometry:!1,transform_controller:!1}),u._ikHelper=S),M&&DMC.helper_scene.add(S)}if(b||v||u._physicsHelper==null){const M=v;u._physicsHelper?.parent&&u._physicsHelper.removeFromParent();const S=DMC.mmd_animation_helper.objects.get(u)?.physics?.createHelper?.();S&&(S.is_physics_helper=!0,S.name="PhysicsHelper"+u.name,BindObjectAsDDD(S,{type:"physics_helper",restore:!1,draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,removable:!1,controllable_geometry:!1,transform_controller:!1}),u._physicsHelper=S,M&&DMC.helper_scene.add(S))}if(b||u._skelton_helper==null){const M=w;u._skelton_helper?.parent&&u._skelton_helper.removeFromParent();const S=new SkeletonHelper(u),D=new InstancedMesh(new SphereGeometry(.05,10,10),new MeshBasicMaterial,u.skeleton.bones.length);D.max_count=D.count=u.skeleton.bones.length,D.material.transparent=!0,D.material.opacity=.75,D.material.color.r=.5,D.material.color.g=.4,D.material.color.b=1,BindObjectAsDDD(S,{type:"skelton_helper",restore:!1,draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,removable:!1,controllable_geometry:!1,transform_controller:!1}),BindObjectAsDDD(D,{type:"skelton_helper",restore:!1,draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,removable:!1,controllable_geometry:!1,transform_controller:!1}),u._skelton_helper=S,M&&DMC.helper_scene.add(S)}},f._delete_helpers_=()=>{u._skelton_helper?.parent&&u._skelton_helper.removeFromParent(),u._ikHelper?.parent&&u._ikHelper.removeFromParent(),u._physicsHelper?.parent&&u._physicsHelper.removeFromParent(),u._skelton_helper=null,u._ikHelper=null,u._physicsHelper=null,debug$9&&console.log(u.name,"_delete_helpers_")},f.destructors.push(()=>{f._delete_helpers_(),debug$9&&console.log(u.name,"destruct")}),f.hideSkeletonHelper=function(){u._skelton_helper?.parent&&u._skelton_helper.removeFromParent(),debug$9&&console.log(u.name,"hideSkeletonHelper")},f.showSkeletonHelper=function(){u._skelton_helper?.parent&&u._skelton_helper.removeFromParent(),u._skelton_helper&&DMC.helper_scene.add(u._skelton_helper),debug$9&&console.log(u.name,"showSkeletonHelper")},f.hideIKHelper=function(){u._ikHelper?.parent&&u._ikHelper.removeFromParent(),debug$9&&console.log(u.name,"hideIKHelper")},f.showIKHelper=function(){u._ikHelper?.parent&&u._ikHelper.removeFromParent(),u._ikHelper&&DMC.helper_scene.add(u._ikHelper),debug$9&&console.log(u.name,"showIKHelper")},f.hidePhysicsHelper=function(){u._physicsHelper?.parent&&u._physicsHelper.removeFromParent(),debug$9&&console.log(u.name,"hidePhysicsHelper")},f.showPhysicsHelper=function(){u._physicsHelper?.parent&&u._physicsHelper.removeFromParent(),u._physicsHelper&&DMC.helper_scene.add(u._physicsHelper),debug$9&&console.log(u.name,"showPhysicsHelper")};const m=new Vector3,h=new Quaternion,_=new Vector3;return u.user.updaters.helpers=function(){const b=u._skelton_helper,v=u._ikHelper,w=u._physicsHelper;(b||v||w)&&u.matrixWorld.decompose(m,h,_),b&&(b.position.copy(m),b.quaternion.copy(h),b.scale.copy(_)),v&&(v.position.copy(m),v.quaternion.copy(h),v.scale.copy(_)),w&&(w.position.copy(m),w.quaternion.copy(h),w.scale.copy(_))},u})(e,i);{const a=l.getDDDProperties(),c=l.material;if(a.is_background)for(let d=0;d<c.length;d++)c[d].castDynamicEnvironment=!0;else for(let d=0;d<c.length;d++)c[d].castDynamicEnvironment=!1}return await r,l},async glb(e,i){return s.makers.gltf(e,i)},async gltf(e,i){const r="gltf";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const l=await glTF(i);if(l.scenes.length>1){const a=new Object3D;for(const c of l.scenes)c.gltf=l,a.add(c);o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"})}else l.scene.gltf=l,o=BindObjectAsDDD(l.scene,{type:r,source_file:i,kind:"object"}),o.animations=l.animations;o.name=i.split("/").pop(),await setup_animation_helper_prop(o),o.getActionMode()=="Single"&&o.setCurrentAction(0),await setup_default_setting_for_action(o,LoopRepeat),getDDDProperties(o),o.__source_dependencies__=l.source_dependencies}else if(typeof i=="object"){const l=getDDDProperties(i),a=await glTF(l.source_file);if(a.scenes.length>1){const c=new Object3D;for(const d of a.scenes)d.gltf=a,c.add(d);o=BindObjectAsDDD(c,getDDDProperties(i))}else a.scene.gltf=a,o=BindObjectAsDDD(a.scene,getDDDProperties(i)),o.animations=a.animations;o.__source_dependencies__=a.source_dependencies,await setup_animation_helper_prop(o)}return await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(l=>{l&&(l.frustumCulled=!1),l.castShadow!==void 0&&(l.castShadow=!0),l.receiveShadow!==void 0&&(l.receiveShadow=!0),l.morphTargetInfluences&&morph_ext(l)}),o},async vrm(e,i){const r="vrm";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const l=await vrm(i);if(l.scenes.length>1){const a=new Object3D;for(const c of l.scenes)c.gltf=l,a.add(c);o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"})}else l.scene.gltf=l,o=BindObjectAsDDD(l.scene,{type:r,source_file:i,kind:"object"}),o.animations=l.animations;o.name=i.split("/").pop(),await setup_animation_helper_prop(o),o.getActionMode()=="Single"&&o.setCurrentAction(0),await setup_default_setting_for_action(o,LoopRepeat)}else if(typeof i=="object"){const l=getDDDProperties(i),a=await vrm(l.source_file);if(a.scenes.length>1){const c=new Object3D;for(const d of a.scenes)d.gltf=a,c.add(d);o=BindObjectAsDDD(c,getDDDProperties(i))}else a.scene.gltf=a,o=BindObjectAsDDD(a.scene,getDDDProperties(i)),o.animations=a.animations;await setup_animation_helper_prop(o)}return await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(l=>{l&&(l.frustumCulled=!1),l.castShadow!==void 0&&(l.castShadow=!0),l.receiveShadow!==void 0&&(l.receiveShadow=!0),l.morphTargetInfluences&&morph_ext(l)}),o},async dae(e,i){const r="dae";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await collada(i);o=BindObjectAsDDD(a.scene,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){const a=getDDDProperties(i),c=await collada(a.source_file);o=BindObjectAsDDD(c.scene,getDDDProperties(i))}await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)});const l=getDDDProperties(o);return o.name=l.source_file.split("/").pop(),o},async drc(e,i){const r="drc";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await drc(i);o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){const a=getDDDProperties(i),c=await drc(a.source_file);o=BindObjectAsDDD(c,getDDDProperties(i))}await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)});const l=getDDDProperties(o);return o.name=l.source_file.split("/").pop(),o},async usdz(e,i){const r="usdz";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await usdz(i);o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){const a=getDDDProperties(i),c=await usdz(a.source_file);o=BindObjectAsDDD(c.scene,getDDDProperties(i))}BindChildren(o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)});const l=getDDDProperties(o);return o.name=l.source_file.split("/").pop(),o},async ply(e,i){const r="ply";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await ply(i),c=new MeshPhysicalMaterial,d=new Mesh(a,c);o=BindObjectAsDDD(d,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){getDDDProperties(i);const a=await ply(i),c=new MeshPhysicalMaterial,d=new Mesh(a,c);o=BindObjectAsDDD(d,getDDDProperties(i))}await apply_system_preferences_setting(r,o),BindChildren(o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)});const l=getDDDProperties(o);return o.name=l.source_file.split("/").pop(),o},async mqo(e,i){const r="mqo";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");const a=await mqo(i);o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"})}else if(typeof i=="object"){const a=getDDDProperties(i),c=await mqo(a.source_file);o=BindObjectAsDDD(c,getDDDProperties(i))}await apply_system_preferences_setting(r,o),o.traverse(a=>{a.castShadow!==void 0&&(a.castShadow=!0),a.receiveShadow!==void 0&&(a.receiveShadow=!0)});const l=getDDDProperties(o);return o.name=l.source_file.split("/").pop(),o}}};function mtl(s){const e=TimeDurationChecker("MTL: "+s);return new Promise((i,r)=>{(async()=>{const{MTLLoader:o}=await __vitePreload(()=>import("./MTLLoader@Bhbdx6IQ.js"),[],import.meta.url);new o().load(s,function(a){e.finish(),a.preload(),i(a)},null,r)})()})}function obj_mtl(s,e){const i=TimeDurationChecker("OBJ: "+s);return new Promise((r,o)=>{(async()=>{const{OBJLoader:l}=await __vitePreload(()=>import("./OBJLoader@DdvHj1NM.js"),[],import.meta.url),a=new l;if(typeof e=="string"){const c=await mtl(e);a.setMaterials(c)}else a.setMaterials(e);a.load(s,function(c){i.finish(),r(c)},null,o)})()})}const Cache_VMD=new window.CacheManager({name:"VMD"});function vmd(s){const e=TimeDurationChecker("VMD: "+s);return new Promise(async(i,r)=>{const o=await Cache_VMD.get_with_transaction(s);if(o){i(C$2.clone(o));return}(await get_MMDLoader()).loadVMD(s,function(a){Cache_VMD.put(s,a),Cache_VMD.unlock(s),e.finish(),i(C$2.clone(a))},null,a=>{Cache_VMD.unlock(s),r(a)})})}const Cache_VPD=new window.CacheManager({name:"VPD"});function vpd(s){const e=TimeDurationChecker("VPD: "+s);return new Promise((i,r)=>{(async()=>{const o=await Cache_VPD.get_with_transaction(s);if(o){i(o);return}(await get_MMDLoader()).loadVPD(s,!1,function(a){Cache_VPD.put(s,a),Cache_VPD.unlock(s),e.finish(),i(a)},null,a=>{Cache_VPD.unlock(s),r(a)})})()})}const Cache_Sound=new window.CacheManager({name:"Sound"});function sound(s){return new Promise(async(e,i)=>{if(window.external_io){const r=s.replace(/\\/g,"/"),o=await Cache_Sound.get_with_transaction(r);if(o){e(o);return}const l=TimeDurationChecker("Load sound1: "+C$2.DPath(s).basename);window.external_io.get(r).then(a=>{const c=C$2.to_array_buffer(a);AudioContext.getContext().decodeAudioData(c,function(u){Cache_Sound.put(r,u),Cache_Sound.unlock(r),l.finish(),e(u)},u=>{Cache_Sound.unlock(r),console.error(u),i(u),l.finish()})}).catch(a=>{console.error(a),i(a),Cache_Sound.unlock(r)})}else{nodejs&&window.node_api;{const r=await Cache_Sound.get_with_transaction(s);if(r){e(r);return}const o=TimeDurationChecker("Load sound3: "+C$2.DPath(s).path);new AudioLoader().load(s,function(l){Cache_Sound.put(s,l),Cache_Sound.unlock(s),o.finish(),e(l)},null,l=>{console.error(l),Cache_Sound.unlock(s),i()})}}})}function j_material(s){return TimeDurationChecker("Material: "+s),new Promise((e,i)=>{(async()=>{try{const r=await window.cross_file_system.read(s),o=C$2.b_decode(r);e(o)}catch(r){i(r)}})()})}var EtcBuilder=function(){const s=this.makers={async mtl(e,i){let r=null,o=null;if(typeof i=="string")i=i.replace(/\\/g,"/"),r=await mtl(i),o=i;else if(typeof i=="object"){const l=getDDDProperties(i);l?.mtl?.source_file&&(r=await mtl(l.mtl.source_file),o=l.mtl.source_file)}if(e&&r){let l=getDDDProperties(e);if(l.type=="obj"){const a=e.parent;if(a){DMC?.transform_controls&&DMC.transform_controls.detach();const c=a.children.slice();for(let d=0;d<c.length;d++)a.remove(c[d]);for(let d=0;d<c.length;d++)if(c[d]==e){let u=await obj_mtl(l.source_file,r);u=BindObjectAsDDD(u,l),l=getDDDProperties(u),u.uuid=e.uuid,u.name=e.name;for(const f of u.children)BindObjectAsDDD(f,{type:"mesh",restore:!1,kind:"object"}),f.castShadow=!0,f.receiveShadow=!0;a.add(u)}else a.add(c[d])}else{let c=await obj_mtl(l.source_file,r);c=BindObjectAsDDD(c,l),l=getDDDProperties(c),LoadObjectProperties(c,e),LoadMaterialProperties(c,e),c.uuid=e.uuid,c.name=e.name;for(const d of c.children)BindObjectAsDDD(d,{type:"mesh",restore:!1,kind:"object"}),d.castShadow=!0,d.receiveShadow=!0}l.mtl={instance:r,source_file:o}}}return r},async vpd(e,i){return s.vmd(e,i)},async vmd(e,i){let r=null,o=null,l="vmd";if(typeof i=="string"){if(i=i.replace(/\\/g,"/"),l=i.split(".").pop().toLowerCase(),l=="vmd")r=await vmd(i);else if(l=="vpd")r=await vpd(i);else throw new Error("Unknown file: "+i);o=i}if(e){const a=getDDDProperties(e);if((C$2.is_model_ext(a.type)||e.isCamera)&&(a.type=="pmx"||a.type=="pmd"||e.isCamera)){const c=e.geometry?.userData?.MMD?.iks,d=e.skeleton?.bones;if(e.traverse(u=>{u.ikEnabled=!1}),c&&d)for(const u of c)d[u.target].ikEnabled=!0;o&&r?(e.isMMD=!0,await e.setActions({instance:{data:r,clip:null},source_file:o,type:l},{vmd_source_object:!0}),e.getActionMode()=="Single"&&e.setCurrentAction(0),await setup_default_setting_for_action(e,LoopOnce)):e.isCamera&&e.getActionSources().length>0&&(e.getActionSources()[0]?.type=="vmd"?(e.isMMD=!0,await setup_default_setting_for_action(e,LoopOnce)):e.isMMD=!1)}}return r},async fba(e,i){if(typeof i=="string")if(i=i.replace(/\\/g,"/"),e){const r=getDDDProperties(e);if(C$2.is_model_ext(r.type)||e.isCamera){const o=BindObjectAsDDD(await fbx(i),{type:"fba",source_file:i,kind:"object"});e.updateActions&&(await e.setActions(o),await setup_default_setting_for_action(e,LoopRepeat)),await Builder3D.remove_object(o)}}else return BindObjectAsDDD(await fbx(i),{type:"fba",source_file:i,kind:"object"});return null},async gla(e,i){if(typeof i=="string"){i=i.replace(/\\/g,"/");async function r(o){let l=null;const a=await glTF(o);if(a.scenes.length>1){const c=new Object3D;for(const d of a.scenes)d.gltf=a,c.add(d);l=BindObjectAsDDD(c,{type:"gla",source_file:o,kind:"object"})}else a.scene.gltf=a,l=BindObjectAsDDD(a.scene,{type:"gla",source_file:o,kind:"object"}),l.animations=a.animations;return l}if(e){const o=getDDDProperties(e);if(C$2.is_model_ext(o.type)||e.isCamera){const l=await r(i);e.updateActions&&(await e.setActions(l),await setup_default_setting_for_action(e,LoopRepeat)),Builder3D.remove_object(l)}}else return await r(i)}return null},async fft(e,i){if(e){const r=getDDDProperties(e);if(r.fft){let f=function(m){let h=DMC.getObjectBySubUUID(m.sub_uuid);return h==null&&m.name_match&&(h=DMC.scene.find(m.name_match,!0)),h};const o=r.fft,a=DMC.sound_listener.context.createAnalyser(),c=a.frequencyBinCount,d=new Uint8Array(c);a.fftSize=256,a.minDecibels=-70,a.maxDecibels=-10,a.smoothingTimeConstant=.75,o.value=0,o.st=o.st??0,o.wd=o.wd??.1,o.connectors=o.connectors??[];const u=new Color(0);e.__on_started_audio__=function(){e.source.connect(a)},e.user.updaters.fft=m=>{if(m==0)return;a.getByteFrequencyData(d);const h=Math.floor((o.st??0)*c),_=Math.floor((o.wd??.1)*c),b=_;let v=0;for(let w=h;w<h+_;++w)v+=d[w];b>0?(v/=b,o.value=v):o.value=0;for(const w of o.connectors){const y=w.type;w.name,w.sub_uuid;const M=w.material_name,S=w.key,D=w.coef,k=typeof w.color=="number"?u.set(w.color):w.color,O=w.bias??0,L=w.max;if(y=="object")if(w.instance){const P=w.instance[S];if(typeof P=="number"){let N=o.value*D+O;L&&(N=Math.min(N,L)),w.instance[S]=N}else if(P instanceof Color){let N=o.value*D+O;L&&(N=Math.min(N,L)),w.instance[S].set(k.r*N,k.g*N,k.b*N)}}else w.instance=f(w);else if(y=="morphing")if(w.instance){if(typeof w.instance[S]=="number"){let N=o.value*D+O;L&&(N=Math.min(N,L)),w.instance[S]!=null&&(w.instance[S]=N)}}else{const P=f(w);P.morphTargetInfluences_cache&&(w.instance=P.morphTargetInfluences_cache)}else if(y=="material")if(w.instance){const P=w.instance[S];if(typeof P=="number"){let N=o.value*D+O;L&&(N=Math.min(N,L)),w.instance[S]=N}else if(P instanceof Color){let N=o.value*D+O;L&&(N=Math.min(N,L)),w.instance[S].set(k.r*N,k.g*N,k.b*N)}}else{const P=f(w);if(P?.material)if(Array.isArray(P.material)){for(const N of P.material)if(N.name==M){w.instance=N;break}}else w.instance=P.material}}}}}return null},async material(e,i){if(e==null||i==null)return null;let r=null;if(typeof i=="string"){r=await j_material(i);const o=r.instance,l=r.export_params,a={};if(l)for(const d in l){const u=l[d];a[u.label]=u}const c=C$2.DPath(i).dirname;if(c==null){debugger;throw new Error("Required base path.")}if(r&&a?.AbsolutePath?.value==!1){const d=C$2.DPath(c);let u=!1;d.is_absolute_path==!1&&(u=!0),convert_to_abs_path(c,o,{left_should_be_absolute_path:u})}e&&(LoadObjectProperties(e,r.instance),LoadMaterialProperties(e,r.instance,{},{match_by_name:!0}))}return r}}};EtcBuilder.prototype.build=function(s){};const ETC=Object.freeze(Object.defineProperty({__proto__:null,EtcBuilder,j_material,mtl,obj_mtl,sound,vmd,vpd},Symbol.toStringTag,{value:"Module"}));class TessellateModifier{constructor(e=.1,i=6){this.maxEdgeLength=e,this.maxIterations=i}modify(e){e.index!==null&&(e=e.toNonIndexed());const i=this.maxIterations,r=this.maxEdgeLength*this.maxEdgeLength,o=new Vector3,l=new Vector3,a=new Vector3,c=new Vector3,d=[o,l,a,c],u=new Vector3,f=new Vector3,m=new Vector3,h=new Vector3,_=[u,f,m,h],b=new Color,v=new Color,w=new Color,y=new Color,M=[b,v,w,y],S=new Vector2,D=new Vector2,k=new Vector2,O=new Vector2,L=[S,D,k,O],P=new Vector2,N=new Vector2,z=new Vector2,K=new Vector2,Z=[P,N,z,K],V=e.attributes,H=V.normal!==void 0,Y=V.color!==void 0,q=V.uv!==void 0,J=V.uv1!==void 0;let W=V.position.array,te=H?V.normal.array:null,ie=Y?V.color.array:null,oe=q?V.uv.array:null,Ce=J?V.uv1.array:null,ve=W,we=te,Se=ie,Re=oe,Fe=Ce,$e=0,Ue=!0;function qe(be,De,Te){const ge=d[be],Ee=d[De],Ie=d[Te];if(ve.push(ge.x,ge.y,ge.z),ve.push(Ee.x,Ee.y,Ee.z),ve.push(Ie.x,Ie.y,Ie.z),H){const Be=_[be],Oe=_[De],ue=_[Te];we.push(Be.x,Be.y,Be.z),we.push(Oe.x,Oe.y,Oe.z),we.push(ue.x,ue.y,ue.z)}if(Y){const Be=M[be],Oe=M[De],ue=M[Te];Se.push(Be.r,Be.g,Be.b),Se.push(Oe.r,Oe.g,Oe.b),Se.push(ue.r,ue.g,ue.b)}if(q){const Be=L[be],Oe=L[De],ue=L[Te];Re.push(Be.x,Be.y),Re.push(Oe.x,Oe.y),Re.push(ue.x,ue.y)}if(J){const Be=Z[be],Oe=Z[De],ue=Z[Te];Fe.push(Be.x,Be.y),Fe.push(Oe.x,Oe.y),Fe.push(ue.x,ue.y)}}for(;Ue&&$e<i;){$e++,Ue=!1,W=ve,ve=[],H&&(te=we,we=[]),Y&&(ie=Se,Se=[]),q&&(oe=Re,Re=[]),J&&(Ce=Fe,Fe=[]);for(let be=0,De=0,Te=W.length;be<Te;be+=9,De+=6){o.fromArray(W,be+0),l.fromArray(W,be+3),a.fromArray(W,be+6),H&&(u.fromArray(te,be+0),f.fromArray(te,be+3),m.fromArray(te,be+6)),Y&&(b.fromArray(ie,be+0),v.fromArray(ie,be+3),w.fromArray(ie,be+6)),q&&(S.fromArray(oe,De+0),D.fromArray(oe,De+2),k.fromArray(oe,De+4)),J&&(P.fromArray(Ce,De+0),N.fromArray(Ce,De+2),z.fromArray(Ce,De+4));const ge=o.distanceToSquared(l),Ee=l.distanceToSquared(a),Ie=o.distanceToSquared(a);ge>r||Ee>r||Ie>r?(Ue=!0,ge>=Ee&&ge>=Ie?(c.lerpVectors(o,l,.5),H&&h.lerpVectors(u,f,.5),Y&&y.lerpColors(b,v,.5),q&&O.lerpVectors(S,D,.5),J&&K.lerpVectors(P,N,.5),qe(0,3,2),qe(3,1,2)):Ee>=ge&&Ee>=Ie?(c.lerpVectors(l,a,.5),H&&h.lerpVectors(f,m,.5),Y&&y.lerpColors(v,w,.5),q&&O.lerpVectors(D,k,.5),J&&K.lerpVectors(N,z,.5),qe(0,1,3),qe(3,2,0)):(c.lerpVectors(o,a,.5),H&&h.lerpVectors(u,m,.5),Y&&y.lerpColors(b,w,.5),q&&O.lerpVectors(S,k,.5),J&&K.lerpVectors(P,z,.5),qe(0,1,3),qe(3,1,2))):qe(0,1,2)}}const _e=new BufferGeometry;return _e.setAttribute("position",new Float32BufferAttribute(ve,3)),H&&_e.setAttribute("normal",new Float32BufferAttribute(we,3)),Y&&_e.setAttribute("color",new Float32BufferAttribute(Se,3)),q&&_e.setAttribute("uv",new Float32BufferAttribute(Re,2)),J&&_e.setAttribute("uv1",new Float32BufferAttribute(Fe,2)),_e}}/*!
 * encoding-japanese v2.0.0 - Convert or detect character encoding in JavaScript
 * Copyright (c) 2012 polygonplanet <polygon.planet.aqua@gmail.com>
 * https://github.com/polygonplanet/encoding.js
 * @license MIT
 */(function(s){window.Encoding=s()})(function(){return function s(e,i,r){function o(c,d){if(!i[c]){if(!e[c]){var u=typeof require=="function"&&require;if(!d&&u)return u(c,!0);if(l)return l(c,!0);throw(d=new Error("Cannot find module '"+c+"'")).code="MODULE_NOT_FOUND",d}u=i[c]={exports:{}},e[c][0].call(u.exports,function(f){return o(e[c][1][f]||f)},u,u.exports,s,e,i,r)}return i[c].exports}for(var l=typeof require=="function"&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(s,e,i){e.exports={version:"2.0.0"}},{}],2:[function(l,e,i){var r=l("./util"),o=l("./encoding-table"),l=(i.FALLBACK_CHARACTER=63,i.HAS_TYPED=typeof Uint8Array<"u"&&typeof Uint16Array<"u"),a=!1,c=!1;try{String.fromCharCode.apply(null,[97])==="a"&&(a=!0)}catch{}if(l)try{String.fromCharCode.apply(null,new Uint8Array([97]))==="a"&&(c=!0)}catch{}i.CAN_CHARCODE_APPLY=a,i.CAN_CHARCODE_APPLY_TYPED=c,i.APPLY_BUFFER_SIZE=65533,i.APPLY_BUFFER_SIZE_OK=null;var d=i.EncodingNames={UTF32:{order:0},UTF32BE:{alias:["UCS4"]},UTF32LE:null,UTF16:{order:1},UTF16BE:{alias:["UCS2"]},UTF16LE:null,BINARY:{order:2},ASCII:{order:3,alias:["ISO646","CP367"]},JIS:{order:4,alias:["ISO2022JP"]},UTF8:{order:5},EUCJP:{order:6},SJIS:{order:7,alias:["CP932","MSKANJI","WINDOWS31J"]},UNICODE:{order:8}},u={};i.EncodingAliases=u,i.EncodingOrders=function(){for(var f,m,h,_,b=u,v=r.objectKeys(d),w=[],y=0,M=v.length;y<M;y++)if(b[f=v[y]]=f,(m=d[f])!=null&&(m.order!=null&&(w[w.length]=f),m.alias))for(h=0,_=m.alias.length;h<_;h++)b[m.alias[h]]=f;return w.sort(function(S,D){return d[S].order-d[D].order}),w}(),i.init_JIS_TO_UTF8_TABLE=function(){if(o.JIS_TO_UTF8_TABLE===null){o.JIS_TO_UTF8_TABLE={};for(var f,m,h=r.objectKeys(o.UTF8_TO_JIS_TABLE),_=0,b=h.length;_<b;_++)f=h[_],95<(m=o.UTF8_TO_JIS_TABLE[f])&&(o.JIS_TO_UTF8_TABLE[m]=0|f);for(o.JISX0212_TO_UTF8_TABLE={},b=(h=r.objectKeys(o.UTF8_TO_JISX0212_TABLE)).length,_=0;_<b;_++)f=h[_],m=o.UTF8_TO_JISX0212_TABLE[f],o.JISX0212_TO_UTF8_TABLE[m]=0|f}}},{"./encoding-table":5,"./util":12}],3:[function(s,e,i){var r=s("./config"),o=s("./util"),l=s("./encoding-detect"),a=s("./encoding-table");function c(V){r.init_JIS_TO_UTF8_TABLE();for(var H,Y,q,J,W=[],te=0,ie=V&&V.length;te<ie;te++)161<=(H=V[te])&&H<=223?(q=188|(Y=H-64)>>6&3,J=128|63&Y,W[W.length]=239,W[W.length]=255&q,W[W.length]=255&J):128<=H?(q=H<<1,(Y=V[++te])<159?(q-=q<319?225:97,Y-=126<Y?32:31):(q-=q<319?224:96,Y-=126),(J=a.JIS_TO_UTF8_TABLE[((q&=255)<<8)+Y])===void 0?W[W.length]=r.FALLBACK_CHARACTER:(J<65535||(W[W.length]=J>>16&255),W[W.length]=J>>8&255,W[W.length]=255&J)):W[W.length]=255&V[te];return W}function d(V){r.init_JIS_TO_UTF8_TABLE();for(var H,Y,q,J,W,te=[],ie=0,oe=V&&V.length;ie<oe;ie++)(H=V[ie])===142?(Y=188|(q=V[++ie]-64)>>6&3,q=128|63&q,te[te.length]=239,te[te.length]=255&Y,te[te.length]=255&q):H===143?(Y=V[++ie]-128,q=V[++ie]-128,(W=a.JISX0212_TO_UTF8_TABLE[J=(Y<<8)+q])===void 0?te[te.length]=r.FALLBACK_CHARACTER:(W<65535||(te[te.length]=W>>16&255),te[te.length]=W>>8&255,te[te.length]=255&W)):128<=H?(J=(H-128<<8)+(V[++ie]-128),(W=a.JIS_TO_UTF8_TABLE[J])===void 0?te[te.length]=r.FALLBACK_CHARACTER:(W<65535||(te[te.length]=W>>16&255),te[te.length]=W>>8&255,te[te.length]=255&W)):te[te.length]=255&V[ie];return te}function u(V){r.init_JIS_TO_UTF8_TABLE();for(var H,Y,q,J,W=[],te=0,ie=0,oe=V&&V.length;ie<oe;ie++){for(;V[ie]===27;)if(V[ie+1]===36&&V[ie+2]===66||V[ie+1]===36&&V[ie+2]===64?te=1:V[ie+1]===40&&V[ie+2]===73?te=2:V[ie+1]===36&&V[ie+2]===40&&V[ie+3]===68?(te=3,ie++):te=0,V[ie+=3]===void 0)return W;te===1?(q=(V[ie]<<8)+V[++ie],(J=a.JIS_TO_UTF8_TABLE[q])===void 0?W[W.length]=r.FALLBACK_CHARACTER:(J<65535||(W[W.length]=J>>16&255),W[W.length]=J>>8&255,W[W.length]=255&J)):te===2?(H=188|(Y=V[ie]+64)>>6&3,Y=128|63&Y,W[W.length]=239,W[W.length]=255&H,W[W.length]=255&Y):te===3?(q=(V[ie]<<8)+V[++ie],(J=a.JISX0212_TO_UTF8_TABLE[q])===void 0?W[W.length]=r.FALLBACK_CHARACTER:(J<65535||(W[W.length]=J>>16&255),W[W.length]=J>>8&255,W[W.length]=255&J)):W[W.length]=255&V[ie]}return W}function f(V,H){for(var Y,q,J,W=[],te=0,ie=V&&V.length,oe=H&&H.fallback;te<ie;te++)128<=(J=V[te])?(J=J<=223?(q=[J,V[te+1]],(J<<8)+V[++te]):J<=239?(q=[J,V[te+1],V[te+2]],(J<<16)+(V[++te]<<8)+(255&V[++te])):(q=[J,V[te+1],V[te+2],V[te+3]],(J<<24)+(V[++te]<<16)+(V[++te]<<8)+(255&V[++te])),(J=a.UTF8_TO_JIS_TABLE[J])==null?oe?Z(W,q,oe):W[W.length]=r.FALLBACK_CHARACTER:J<255?W[W.length]=J+128:(65536<J&&(J-=65536),Y=255&J,1&(J=J>>8)?((J>>=1)<47?J+=113:J-=79,Y+=95<Y?32:31):((J>>=1)<=47?J+=112:J-=80,Y+=126),W[W.length]=255&J,W[W.length]=255&Y)):W[W.length]=255&V[te];return W}function m(V,H){for(var Y,q,J,W=[],te=0,ie=V&&V.length,oe=H&&H.fallback;te<ie;te++)128<=(q=V[te])?(q=q<=223?(Y=[q,V[te+1]],(q<<8)+V[++te]):q<=239?(Y=[q,V[te+1],V[te+2]],(q<<16)+(V[++te]<<8)+(255&V[++te])):(Y=[q,V[te+1],V[te+2],V[te+3]],(q<<24)+(V[++te]<<16)+(V[++te]<<8)+(255&V[++te])),(J=a.UTF8_TO_JIS_TABLE[q])==null?(J=a.UTF8_TO_JISX0212_TABLE[q])==null?oe?Z(W,Y,oe):W[W.length]=r.FALLBACK_CHARACTER:(W[W.length]=143,W[W.length]=(J>>8)-128&255,W[W.length]=(255&J)-128&255):(65536<J&&(J-=65536),J<255?(W[W.length]=142,W[W.length]=J-128&255):(W[W.length]=(J>>8)-128&255,W[W.length]=(255&J)-128&255))):W[W.length]=255&V[te];return W}function h(V,H){for(var Y,q,J,W=[],te=0,ie=V&&V.length,oe=0,Ce=H&&H.fallback,ve=[27,40,66,27,36,66,27,40,73,27,36,40,68];oe<ie;oe++)(q=V[oe])<128?(te!==0&&(W[W.length]=ve[te=0],W[W.length]=ve[1],W[W.length]=ve[2]),W[W.length]=255&q):(q=q<=223?(Y=[q,V[oe+1]],(q<<8)+V[++oe]):q<=239?(Y=[q,V[oe+1],V[oe+2]],(q<<16)+(V[++oe]<<8)+(255&V[++oe])):(Y=[q,V[oe+1],V[oe+2],V[oe+3]],(q<<24)+(V[++oe]<<16)+(V[++oe]<<8)+(255&V[++oe])),(J=a.UTF8_TO_JIS_TABLE[q])==null?(J=a.UTF8_TO_JISX0212_TABLE[q])==null?(te!==0&&(W[W.length]=ve[te=0],W[W.length]=ve[1],W[W.length]=ve[2]),Ce?Z(W,Y,Ce):W[W.length]=r.FALLBACK_CHARACTER):(te!==3&&(te=3,W[W.length]=ve[9],W[W.length]=ve[10],W[W.length]=ve[11],W[W.length]=ve[12]),W[W.length]=J>>8&255,W[W.length]=255&J):(65536<J&&(J-=65536),J<255?te!==2&&(te=2,W[W.length]=ve[6],W[W.length]=ve[7],W[W.length]=ve[8]):(te!==1&&(te=1,W[W.length]=ve[3],W[W.length]=ve[4],W[W.length]=ve[5]),W[W.length]=J>>8&255),W[W.length]=255&J));return te!==0&&(W[W.length]=ve[0],W[W.length]=ve[1],W[W.length]=ve[2]),W}function _(V){for(var H,Y,q=[],J=0,W=V&&V.length;J<W;J++)55296<=(H=V[J])&&H<=56319&&J+1<W&&56320<=(Y=V[J+1])&&Y<=57343&&(H=1024*(H-55296)+Y-56320+65536,J++),H<128?q[q.length]=H:H<2048?(q[q.length]=192|H>>6&31,q[q.length]=128|63&H):H<65536?(q[q.length]=224|H>>12&15,q[q.length]=128|H>>6&63,q[q.length]=128|63&H):H<2097152&&(q[q.length]=240|H>>18&15,q[q.length]=128|H>>12&63,q[q.length]=128|H>>6&63,q[q.length]=128|63&H);return q}function b(V,H){for(var Y,q,J,W=[],te=0,ie=V&&V.length,oe=H&&H.ignoreSurrogatePair;te<ie;)0<=(Y=(q=V[te++])>>4)&&Y<=7?J=q:Y==12||Y==13?J=(31&q)<<6|63&V[te++]:Y==14?J=(15&q)<<12|(63&V[te++])<<6|63&V[te++]:Y==15&&(J=(7&q)<<18|(63&V[te++])<<12|(63&V[te++])<<6|63&V[te++]),J<=65535||oe?W[W.length]=J:(W[W.length]=55296+((J-=65536)>>10),W[W.length]=J%1024+56320);return W}function v(V,H){var Y;if(H&&H.bom){var q,H=H.bom,J=(H=o.isString(H)?H:"BE").charAt(0).toUpperCase()==="B"?(q=[254,255],w(V)):(q=[255,254],y(V));(Y=[])[0]=q[0],Y[1]=q[1];for(var W=0,te=J.length;W<te;W++)Y[Y.length]=J[W]}else Y=w(V);return Y}function w(V){for(var H,Y=[],q=0,J=V&&V.length;q<J;)(H=V[q++])<=255?(Y[Y.length]=0,Y[Y.length]=H):H<=65535&&(Y[Y.length]=H>>8&255,Y[Y.length]=255&H);return Y}function y(V){for(var H,Y=[],q=0,J=V&&V.length;q<J;)(H=V[q++])<=255?(Y[Y.length]=H,Y[Y.length]=0):H<=65535&&(Y[Y.length]=255&H,Y[Y.length]=H>>8&255);return Y}function M(V){var H,Y,q=[],J=0,W=V&&V.length;for(2<=W&&(V[0]===254&&V[1]===255||V[0]===255&&V[1]===254)&&(J=2);J<W;)H=V[J++],Y=V[J++],q[q.length]=H===0?Y:(255&H)<<8|255&Y;return q}function S(V){var H,Y,q=[],J=0,W=V&&V.length;for(2<=W&&(V[0]===254&&V[1]===255||V[0]===255&&V[1]===254)&&(J=2);J<W;)H=V[J++],Y=V[J++],q[q.length]=Y===0?H:(255&Y)<<8|255&H;return q}function D(V){for(var H,Y,q=[],J=0,W=V&&V.length,te=!1,ie=!0;J<W;)H=V[J++],Y=V[J++],ie&&J===2?(ie=!1,H===254&&Y===255?te=!1:H===255&&Y===254?te=!0:(te=l.isUTF16LE(V),J=0)):q[q.length]=te?Y===0?H:(255&Y)<<8|255&H:H===0?Y:(255&H)<<8|255&Y;return q}function k(V){var H,Y,q=[],J=0,W=V&&V.length;for(2<=W&&(V[0]===254&&V[1]===255||V[0]===255&&V[1]===254)&&(J=2);J<W;)H=V[J++],Y=V[J++],q[q.length]=Y,q[q.length]=H;return q}function O(V,H){return v(b(V),H)}function L(V){return _(D(V))}function P(V){return w(b(V))}function N(V){return _(M(V))}function z(V){return y(b(V))}function K(V){return _(S(V))}function Z(V,H,Y){switch(Y){case"html-entity":case"html-entity-hex":var q=b(H,{ignoreSurrogatePair:!0})[0];if(q){V[V.length]=38,V[V.length]=35;for(var J=Y.slice(-3)==="hex"?16:10,W=(J==16&&(V[V.length]=120),q.toString(J)),te=0,ie=W.length;te<ie;te++)V[V.length]=W.charCodeAt(te);V[V.length]=59}}}i.JISToSJIS=function(V){for(var H,Y,q=[],J=0,W=0,te=V&&V.length;W<te;W++){for(;V[W]===27;)if(V[W+1]===36&&V[W+2]===66||V[W+1]===36&&V[W+2]===64?J=1:V[W+1]===40&&V[W+2]===73?J=2:V[W+1]===36&&V[W+2]===40&&V[W+3]===68?(J=3,W++):J=0,V[W+=3]===void 0)return q;J===1?(H=V[W],Y=V[++W],1&H?((H>>=1)<47?H+=113:H-=79,Y+=95<Y?32:31):((H>>=1)<=47?H+=112:H-=80,Y+=126),q[q.length]=255&H,q[q.length]=255&Y):q[q.length]=J===2?V[W]+128&255:J===3?r.FALLBACK_CHARACTER:255&V[W]}return q},i.JISToEUCJP=function(V){for(var H=[],Y=0,q=V&&V.length,J=0;J<q;J++){for(;V[J]===27;)if(V[J+1]===36&&V[J+2]===66||V[J+1]===36&&V[J+2]===64?Y=1:V[J+1]===40&&V[J+2]===73?Y=2:V[J+1]===36&&V[J+2]===40&&V[J+3]===68?(Y=3,J++):Y=0,V[J+=3]===void 0)return H;Y===1?(H[H.length]=V[J]+128&255,H[H.length]=V[++J]+128&255):Y===2?(H[H.length]=142,H[H.length]=V[J]+128&255):Y===3?(H[H.length]=143,H[H.length]=V[J]+128&255,H[H.length]=V[++J]+128&255):H[H.length]=255&V[J]}return H},i.SJISToJIS=function(V){for(var H,Y,q=[],J=0,W=V&&V.length,te=0,ie=[27,40,66,27,36,66,27,40,73];te<W;te++)161<=(H=V[te])&&H<=223?(J!==2&&(J=2,q[q.length]=ie[6],q[q.length]=ie[7],q[q.length]=ie[8]),q[q.length]=H-128&255):128<=H?(J!==1&&(J=1,q[q.length]=ie[3],q[q.length]=ie[4],q[q.length]=ie[5]),H<<=1,(Y=V[++te])<159?(H-=H<319?225:97,Y-=126<Y?32:31):(H-=H<319?224:96,Y-=126),q[q.length]=255&H,q[q.length]=255&Y):(J!==0&&(q[q.length]=ie[J=0],q[q.length]=ie[1],q[q.length]=ie[2]),q[q.length]=255&H);return J!==0&&(q[q.length]=ie[0],q[q.length]=ie[1],q[q.length]=ie[2]),q},i.SJISToEUCJP=function(V){for(var H,Y,q=[],J=V&&V.length,W=0;W<J;W++)161<=(H=V[W])&&H<=223?(q[q.length]=142,q[q.length]=H):129<=H?(H<<=1,(Y=V[++W])<159?(H-=H<319?97:225,Y+=126<Y?96:97):(H-=H<319?96:224,Y+=2),q[q.length]=255&H,q[q.length]=255&Y):q[q.length]=255&H;return q},i.EUCJPToJIS=function(V){for(var H,Y=[],q=0,J=V&&V.length,W=0,te=[27,40,66,27,36,66,27,40,73,27,36,40,68];W<J;W++)(H=V[W])===142?(q!==2&&(q=2,Y[Y.length]=te[6],Y[Y.length]=te[7],Y[Y.length]=te[8]),Y[Y.length]=V[++W]-128&255):H===143?(q!==3&&(q=3,Y[Y.length]=te[9],Y[Y.length]=te[10],Y[Y.length]=te[11],Y[Y.length]=te[12]),Y[Y.length]=V[++W]-128&255,Y[Y.length]=V[++W]-128&255):142<H?(q!==1&&(q=1,Y[Y.length]=te[3],Y[Y.length]=te[4],Y[Y.length]=te[5]),Y[Y.length]=H-128&255,Y[Y.length]=V[++W]-128&255):(q!==0&&(Y[Y.length]=te[q=0],Y[Y.length]=te[1],Y[Y.length]=te[2]),Y[Y.length]=255&H);return q!==0&&(Y[Y.length]=te[0],Y[Y.length]=te[1],Y[Y.length]=te[2]),Y},i.EUCJPToSJIS=function(V){for(var H,Y,q=[],J=V&&V.length,W=0;W<J;W++)(H=V[W])===143?(q[q.length]=r.FALLBACK_CHARACTER,W+=2):142<H?(Y=V[++W],1&H?(H=(H>>=1)+(H<111?49:113),Y-=223<Y?96:97):(H=(H>>=1)+(H<=111?48:112),Y-=2),q[q.length]=255&H,q[q.length]=255&Y):q[q.length]=H===142?255&V[++W]:255&H;return q},i.SJISToUTF8=c,i.EUCJPToUTF8=d,i.JISToUTF8=u,i.UTF8ToSJIS=f,i.UTF8ToEUCJP=m,i.UTF8ToJIS=h,i.UNICODEToUTF8=_,i.UTF8ToUNICODE=b,i.UNICODEToUTF16=v,i.UNICODEToUTF16BE=w,i.UNICODEToUTF16LE=y,i.UTF16BEToUNICODE=M,i.UTF16LEToUNICODE=S,i.UTF16ToUNICODE=D,i.UTF16ToUTF16BE=function(V){for(var H,Y,q=[],J=0,W=V&&V.length,te=!1,ie=!0;J<W;)H=V[J++],Y=V[J++],ie&&J===2?(ie=!1,H===254&&Y===255?te=!1:H===255&&Y===254?te=!0:(te=l.isUTF16LE(V),J=0)):te?(q[q.length]=Y,q[q.length]=H):(q[q.length]=H,q[q.length]=Y);return q},i.UTF16BEToUTF16=function(V,H){var Y,q,J,W=!1,te=(H&&H.bom&&(H=H.bom,(H=o.isString(H)?H:"BE").charAt(0).toUpperCase()==="B"?Y=[254,255]:(Y=[255,254],W=!0)),[]),ie=V&&V.length,oe=0;for(2<=ie&&(V[0]===254&&V[1]===255||V[0]===255&&V[1]===254)&&(oe=2),Y&&(te[0]=Y[0],te[1]=Y[1]);oe<ie;)q=V[oe++],J=V[oe++],W?(te[te.length]=J,te[te.length]=q):(te[te.length]=q,te[te.length]=J);return te},i.UTF16ToUTF16LE=function(V){for(var H,Y,q=[],J=0,W=V&&V.length,te=!1,ie=!0;J<W;)H=V[J++],Y=V[J++],ie&&J===2?(ie=!1,H===254&&Y===255?te=!1:H===255&&Y===254?te=!0:(te=l.isUTF16LE(V),J=0)):te?(q[q.length]=H,q[q.length]=Y):(q[q.length]=Y,q[q.length]=H);return q},i.UTF16LEToUTF16=function(V,H){var Y,q,J,W=!1,te=(H&&H.bom&&(H=H.bom,(H=o.isString(H)?H:"BE").charAt(0).toUpperCase()==="B"?Y=[254,255]:(Y=[255,254],W=!0)),[]),ie=V&&V.length,oe=0;for(2<=ie&&(V[0]===254&&V[1]===255||V[0]===255&&V[1]===254)&&(oe=2),Y&&(te[0]=Y[0],te[1]=Y[1]);oe<ie;)q=V[oe++],J=V[oe++],W?(te[te.length]=q,te[te.length]=J):(te[te.length]=J,te[te.length]=q);return te},i.UTF16BEToUTF16LE=k,i.UTF16LEToUTF16BE=k,i.UNICODEToJIS=function(V,H){return h(_(V),H)},i.JISToUNICODE=function(V){return b(u(V))},i.UNICODEToEUCJP=function(V,H){return m(_(V),H)},i.EUCJPToUNICODE=function(V){return b(d(V))},i.UNICODEToSJIS=function(V,H){return f(_(V),H)},i.SJISToUNICODE=function(V){return b(c(V))},i.UTF8ToUTF16=O,i.UTF16ToUTF8=L,i.UTF8ToUTF16BE=P,i.UTF16BEToUTF8=N,i.UTF8ToUTF16LE=z,i.UTF16LEToUTF8=K,i.JISToUTF16=function(V,H){return O(u(V),H)},i.UTF16ToJIS=function(V,H){return h(L(V),H)},i.JISToUTF16BE=function(V){return P(u(V))},i.UTF16BEToJIS=function(V,H){return h(N(V),H)},i.JISToUTF16LE=function(V){return z(u(V))},i.UTF16LEToJIS=function(V,H){return h(K(V),H)},i.EUCJPToUTF16=function(V,H){return O(d(V),H)},i.UTF16ToEUCJP=function(V,H){return m(L(V),H)},i.EUCJPToUTF16BE=function(V){return P(d(V))},i.UTF16BEToEUCJP=function(V,H){return m(N(V),H)},i.EUCJPToUTF16LE=function(V){return z(d(V))},i.UTF16LEToEUCJP=function(V,H){return m(K(V),H)},i.SJISToUTF16=function(V,H){return O(c(V),H)},i.UTF16ToSJIS=function(V,H){return f(L(V),H)},i.SJISToUTF16BE=function(V){return P(c(V))},i.UTF16BEToSJIS=function(V,H){return f(N(V),H)},i.SJISToUTF16LE=function(V){return z(c(V))},i.UTF16LEToSJIS=function(V,H){return f(K(V),H)}},{"./config":2,"./encoding-detect":4,"./encoding-table":5,"./util":12}],4:[function(s,e,i){i.isBINARY=function(r){for(var o,l=0,a=r&&r.length;l<a;l++){if(255<(o=r[l]))return!1;if(0<=o&&o<=7||o===255)return!0}return!1},i.isASCII=function(r){for(var o,l=0,a=r&&r.length;l<a;l++)if(255<(o=r[l])||128<=o&&o<=255||o===27)return!1;return!0},i.isJIS=function(r){for(var o,l,a=0,c=r&&r.length;a<c;a++){if(255<(o=r[a])||128<=o&&o<=255)return!1;if(o===27){if(c<=a+2)return!1;if(o=r[a+1],l=r[a+2],o===36){if(l===40||l===64||l===66)return!0}else if(o===38&&l===64||o===40&&(l===66||l===73||l===74))return!0}}return!1},i.isEUCJP=function(r){for(var o,l=0,a=r&&r.length;l<a;l++)if(!((o=r[l])<128)){if(255<o||o<142)return!1;if(o===142){if(a<=l+1||(o=r[++l])<161||223<o)return!1}else if(o===143){if(a<=l+2||(o=r[++l])<162||237<o||(o=r[++l])<161||254<o)return!1}else if(!(161<=o&&o<=254)||a<=l+1||(o=r[++l])<161||254<o)return!1}return!0},i.isSJIS=function(r){for(var o,l=0,a=r&&r.length;l<a&&128<r[l];)if(255<r[l++])return!1;for(;l<a;l++)if(!((o=r[l])<=128||161<=o&&o<=223)&&(o===160||239<o||a<=l+1||(o=r[++l])<64||o===127||252<o))return!1;return!0},i.isUTF8=function(r){for(var o,l=0,a=r&&r.length;l<a;l++){if(255<(o=r[l]))return!1;if(!(o===9||o===10||o===13||32<=o&&o<=126))if(194<=o&&o<=223){if(a<=l+1||r[l+1]<128||191<r[l+1])return!1;l++}else if(o===224){if(a<=l+2||r[l+1]<160||191<r[l+1]||r[l+2]<128||191<r[l+2])return!1;l+=2}else if(225<=o&&o<=236||o===238||o===239){if(a<=l+2||r[l+1]<128||191<r[l+1]||r[l+2]<128||191<r[l+2])return!1;l+=2}else if(o===237){if(a<=l+2||r[l+1]<128||159<r[l+1]||r[l+2]<128||191<r[l+2])return!1;l+=2}else if(o===240){if(a<=l+3||r[l+1]<144||191<r[l+1]||r[l+2]<128||191<r[l+2]||r[l+3]<128||191<r[l+3])return!1;l+=3}else if(241<=o&&o<=243){if(a<=l+3||r[l+1]<128||191<r[l+1]||r[l+2]<128||191<r[l+2]||r[l+3]<128||191<r[l+3])return!1;l+=3}else{if(o!==244||a<=l+3||r[l+1]<128||143<r[l+1]||r[l+2]<128||191<r[l+2]||r[l+3]<128||191<r[l+3])return!1;l+=3}}return!0},i.isUTF16=function(r){var o,l,a=0,c=r&&r.length,d=null;if(c<2){if(255<r[0])return!1}else{if(o=r[0],l=r[1],o===255&&l===254||o===254&&l===255)return!0;for(;a<c;a++){if(r[a]===0){d=a;break}if(255<r[a])return!1}if(d===null)return!1;if((o=r[d+1])!==void 0&&0<o&&o<128||(l=r[d-1])!==void 0&&0<l&&l<128)return!0}return!1},i.isUTF16BE=function(r){var o,l,a=0,c=r&&r.length,d=null;if(c<2){if(255<r[0])return!1}else{if(o=r[0],l=r[1],o===254&&l===255)return!0;for(;a<c;a++){if(r[a]===0){d=a;break}if(255<r[a])return!1}if(d===null)return!1;if(d%2==0)return!0}return!1},i.isUTF16LE=function(r){var o,l,a=0,c=r&&r.length,d=null;if(c<2){if(255<r[0])return!1}else{if(o=r[0],l=r[1],o===255&&l===254)return!0;for(;a<c;a++){if(r[a]===0){d=a;break}if(255<r[a])return!1}if(d===null)return!1;if(d%2!=0)return!0}return!1},i.isUTF32=function(r){var o,l,a,c,d=0,u=r&&r.length,f=null;if(u<4){for(;d<u;d++)if(255<r[d])return!1}else{if(a=r[0],c=r[1],o=r[2],l=r[3],a===0&&c===0&&o===254&&l===255||a===255&&c===254&&o===0&&l===0)return!0;for(;d<u;d++){if(r[d]===0&&r[d+1]===0&&r[d+2]===0){f=d;break}if(255<r[d])return!1}if(f===null)return!1;if((a=r[f+3])!==void 0&&0<a&&a<=127)return r[f+2]===0&&r[f+1]===0;if((c=r[f-1])!==void 0&&0<c&&c<=127)return r[f+1]===0&&r[f+2]===0}return!1},i.isUNICODE=function(r){for(var o,l=0,a=r&&r.length;l<a;l++)if((o=r[l])<0||1114111<o)return!1;return!0}},{}],5:[function(s,e,i){i.UTF8_TO_JIS_TABLE=s("./utf8-to-jis-table"),i.UTF8_TO_JISX0212_TABLE=s("./utf8-to-jisx0212-table"),i.JIS_TO_UTF8_TABLE=s("./jis-to-utf8-table"),i.JISX0212_TO_UTF8_TABLE=s("./jisx0212-to-utf8-table")},{"./jis-to-utf8-table":7,"./jisx0212-to-utf8-table":8,"./utf8-to-jis-table":10,"./utf8-to-jisx0212-table":11}],6:[function(d,e,i){var r=d("./config"),o=d("./util"),l=d("./encoding-detect"),a=d("./encoding-convert"),c=d("./kana-case-table"),d=d("../package.json").version,u=Object.prototype.hasOwnProperty,f={version:d,orders:r.EncodingOrders,detect:function(m,h){if(m==null||m.length===0)return!1;o.isObject(h)&&!o.isArray(h)&&(h=h.encoding),o.isString(m)&&(m=o.stringToBuffer(m)),h==null?h=f.orders:o.isString(h)&&(h=(h=h.toUpperCase())==="AUTO"?f.orders:~h.indexOf(",")?h.split(/\s*,\s*/):[h]);for(var _,b,v,w=h.length,y=0;y<w;y++)if(_=h[y],b=o.canonicalizeEncodingName(_)){if(!u.call(l,v="is"+b))throw new Error("Undefined encoding: "+_);if(l[v](m))return b}return!1},convert:function(m,w,y){o.isObject(w)?(y=(v=w).from,w=v.to,v.type&&(b=v.type)):v={},o.isString(m)?(b=b||"string",m=o.stringToBuffer(m)):m!=null&&m.length!==0||(m=[]),y=y!=null&&o.isString(y)&&y.toUpperCase()!=="AUTO"&&!~y.indexOf(",")?o.canonicalizeEncodingName(y):f.detect(m);var b,v,w=o.canonicalizeEncodingName(w),y=y+"To"+w,M=u.call(a,y)?a[y](m,v):m;switch((""+b).toLowerCase()){case"string":return o.codeToString_fast(M);case"arraybuffer":return o.codeToBuffer(M);default:return o.bufferToCode(M)}},urlEncode:function(m){o.isString(m)&&(m=o.stringToBuffer(m));for(var h,_=o.stringToCode("0123456789ABCDEF"),b=[],v=0,w=m&&m.length;v<w;v++){if(255<(h=m[v]))return encodeURIComponent(o.codeToString_fast(m));97<=h&&h<=122||65<=h&&h<=90||48<=h&&h<=57||h===33||39<=h&&h<=42||h===45||h===46||h===95||h===126?b[b.length]=h:(b[b.length]=37,h<16?(b[b.length]=48,b[b.length]=_[h]):(b[b.length]=_[h>>4&15],b[b.length]=_[15&h]))}return o.codeToString_fast(b)},urlDecode:function(m){for(var h,_=[],b=0,v=m&&m.length;b<v;)h=m.charCodeAt(b++),_[_.length]=h===37?parseInt(m.charAt(b++)+m.charAt(b++),16):h;return _},base64Encode:function(m){return o.isString(m)&&(m=o.stringToBuffer(m)),o.base64encode(m)},base64Decode:function(m){return o.base64decode(m)},codeToString:o.codeToString_fast,stringToCode:o.stringToCode,toHankakuCase:function(m){for(var h,_=!1,b=(o.isString(m)&&(_=!0,m=o.stringToBuffer(m)),[]),v=m&&m.length,w=0;w<v;)65281<=(h=m[w++])&&h<=65374&&(h-=65248),b[b.length]=h;return _?o.codeToString_fast(b):b},toZenkakuCase:function(m){for(var h,_=!1,b=(o.isString(m)&&(_=!0,m=o.stringToBuffer(m)),[]),v=m&&m.length,w=0;w<v;)33<=(h=m[w++])&&h<=126&&(h+=65248),b[b.length]=h;return _?o.codeToString_fast(b):b},toHiraganaCase:function(m){for(var h,_=!1,b=(o.isString(m)&&(_=!0,m=o.stringToBuffer(m)),[]),v=m&&m.length,w=0;w<v;)12449<=(h=m[w++])&&h<=12534?h-=96:h===12535?(b[b.length]=12431,h=12443):h===12538&&(b[b.length]=12434,h=12443),b[b.length]=h;return _?o.codeToString_fast(b):b},toKatakanaCase:function(m){for(var h,_=!1,b=(o.isString(m)&&(_=!0,m=o.stringToBuffer(m)),[]),v=m&&m.length,w=0;w<v;)12353<=(h=m[w++])&&h<=12438&&((h===12431||h===12434)&&w<v&&m[w]===12443?(h=h===12431?12535:12538,w++):h+=96),b[b.length]=h;return _?o.codeToString_fast(b):b},toHankanaCase:function(m){for(var h,_,b=!1,v=(o.isString(m)&&(b=!0,m=o.stringToBuffer(m)),[]),w=m&&m.length,y=0;y<w;)12289<=(h=m[y++])&&h<=12540&&(_=c.HANKANA_TABLE[h])!==void 0?v[v.length]=_:h===12532||h===12535||h===12538?(v[v.length]=c.HANKANA_SONANTS[h],v[v.length]=65438):12459<=h&&h<=12489?(v[v.length]=c.HANKANA_TABLE[h-1],v[v.length]=65438):12495<=h&&h<=12509?(v[v.length]=c.HANKANA_TABLE[h-(_=h%3)],v[v.length]=c.HANKANA_MARKS[_-1]):v[v.length]=h;return b?o.codeToString_fast(v):v},toZenkanaCase:function(m){for(var h,_,b,v=!1,w=(o.isString(m)&&(v=!0,m=o.stringToBuffer(m)),[]),y=m&&m.length,M=0,M=0;M<y;M++)65376<(h=m[M])&&h<65440&&(_=c.ZENKANA_TABLE[h-65377],M+1<y&&((b=m[M+1])===65438&&h===65395?(_=12532,M++):b===65438&&h===65436?(_=12535,M++):b===65438&&h===65382?(_=12538,M++):b===65438&&(65397<h&&h<65413||65417<h&&h<65423)?(_++,M++):b===65439&&65417<h&&h<65423&&(_+=2,M++)),h=_),w[w.length]=h;return v?o.codeToString_fast(w):w},toHankakuSpace:function(m){if(o.isString(m))return m.replace(/\u3000/g," ");for(var h,_=[],b=m&&m.length,v=0;v<b;)(h=m[v++])===12288&&(h=32),_[_.length]=h;return _},toZenkakuSpace:function(m){if(o.isString(m))return m.replace(/\u0020/g,"　");for(var h,_=[],b=m&&m.length,v=0;v<b;)(h=m[v++])===32&&(h=12288),_[_.length]=h;return _}};e.exports=f},{"../package.json":1,"./config":2,"./encoding-convert":3,"./encoding-detect":4,"./kana-case-table":9,"./util":12}],7:[function(s,e,i){e.exports=null},{}],8:[function(s,e,i){e.exports=null},{}],9:[function(s,e,i){i.HANKANA_TABLE={12289:65380,12290:65377,12300:65378,12301:65379,12443:65438,12444:65439,12449:65383,12450:65393,12451:65384,12452:65394,12453:65385,12454:65395,12455:65386,12456:65396,12457:65387,12458:65397,12459:65398,12461:65399,12463:65400,12465:65401,12467:65402,12469:65403,12471:65404,12473:65405,12475:65406,12477:65407,12479:65408,12481:65409,12483:65391,12484:65410,12486:65411,12488:65412,12490:65413,12491:65414,12492:65415,12493:65416,12494:65417,12495:65418,12498:65419,12501:65420,12504:65421,12507:65422,12510:65423,12511:65424,12512:65425,12513:65426,12514:65427,12515:65388,12516:65428,12517:65389,12518:65429,12519:65390,12520:65430,12521:65431,12522:65432,12523:65433,12524:65434,12525:65435,12527:65436,12530:65382,12531:65437,12539:65381,12540:65392},i.HANKANA_SONANTS={12532:65395,12535:65436,12538:65382},i.HANKANA_MARKS=[65438,65439],i.ZENKANA_TABLE=[12290,12300,12301,12289,12539,12530,12449,12451,12453,12455,12457,12515,12517,12519,12483,12540,12450,12452,12454,12456,12458,12459,12461,12463,12465,12467,12469,12471,12473,12475,12477,12479,12481,12484,12486,12488,12490,12491,12492,12493,12494,12495,12498,12501,12504,12507,12510,12511,12512,12513,12514,12516,12518,12520,12521,12522,12523,12524,12525,12527,12531,12443,12444]},{}],10:[function(s,e,i){e.exports={15711649:33,15711650:34,15711651:35,15711652:36,15711653:37,15711654:38,15711655:39,15711656:40,15711657:41,15711658:42,15711659:43,15711660:44,15711661:45,15711662:46,15711663:47,15711664:48,15711665:49,15711666:50,15711667:51,15711668:52,15711669:53,15711670:54,15711671:55,15711672:56,15711673:57,15711674:58,15711675:59,15711676:60,15711677:61,15711678:62,15711679:63,15711872:64,15711873:65,15711874:66,15711875:67,15711876:68,15711877:69,15711878:70,15711879:71,15711880:72,15711881:73,15711882:74,15711883:75,15711884:76,15711885:77,15711886:78,15711887:79,15711888:80,15711889:81,15711890:82,15711891:83,15711892:84,15711893:85,15711894:86,15711895:87,15711896:88,15711897:89,15711898:90,15711899:91,15711900:92,15711901:93,15711902:94,15711903:95,14848416:11553,14848417:11554,14848418:11555,14848419:11556,14848420:11557,14848421:11558,14848422:11559,14848423:11560,14848424:11561,14848425:11562,14848426:11563,14848427:11564,14848428:11565,14848429:11566,14848430:11567,14848431:11568,14848432:11569,14848433:11570,14848434:11571,14848435:11572,14845344:11573,14845345:11574,14845346:11575,14845347:11576,14845348:11577,14845349:11578,14845350:11579,14845351:11580,14845352:11581,14845353:11582,14912905:11584,14912660:11585,14912674:11586,14912909:11587,14912664:11588,14912679:11589,14912643:11590,14912694:11591,14912913:11592,14912919:11593,14912653:11594,14912678:11595,14912675:11596,14912683:11597,14912906:11598,14912699:11599,14913180:11600,14913181:11601,14913182:11602,14913166:11603,14913167:11604,14913412:11605,14913185:11606,14912955:11615,14909597:11616,14909599:11617,14845078:11618,14913421:11619,14845089:11620,14912164:11621,14912165:11622,14912166:11623,14912167:11624,14912168:11625,14911665:11626,14911666:11627,14911673:11628,14912958:11629,14912957:11630,14912956:11631,14846126:11635,14846097:11636,14846111:11640,14846655:11641,14909568:8481,14909569:8482,14909570:8483,15711372:8484,15711374:8485,14910395:8486,15711386:8487,15711387:8488,15711391:8489,15711361:8490,14910107:8491,14910108:8492,49844:8493,15711616:8494,49832:8495,15711422:8496,15712163:8497,15711423:8498,14910397:8499,14910398:8500,14910109:8501,14910110:8502,14909571:8503,14990237:8504,14909573:8505,14909574:8506,14909575:8507,14910396:8508,14844053:8509,14844048:8510,15711375:8511,15711420:8512,15711646:8513,14844054:8514,15711644:8515,14844070:8516,14844069:8517,14844056:8518,14844057:8519,14844060:8520,14844061:8521,15711368:8522,15711369:8523,14909588:8524,14909589:8525,15711419:8526,15711421:8527,15711643:8528,15711645:8529,14909576:8530,14909577:8531,14909578:8532,14909579:8533,14909580:8534,14909581:8535,14909582:8536,14909583:8537,14909584:8538,14909585:8539,15711371:8540,15711373:8541,49841:8542,50071:8543,50103:8544,15711389:8545,14846368:8546,15711388:8547,15711390:8548,14846374:8549,14846375:8550,14846110:8551,14846132:8552,14850434:8553,14850432:8554,49840:8555,14844082:8556,14844083:8557,14845059:8558,15712165:8559,15711364:8560,15712160:8561,15712161:8562,15711365:8563,15711363:8564,15711366:8565,15711370:8566,15711392:8567,49831:8568,14850182:8569,14850181:8570,14849931:8571,14849935:8572,14849934:8573,14849927:8574,14849926:8737,14849697:8738,14849696:8739,14849715:8740,14849714:8741,14849725:8742,14849724:8743,14844091:8744,14909586:8745,14845586:8746,14845584:8747,14845585:8748,14845587:8749,14909587:8750,14846088:8762,14846091:8763,14846598:8764,14846599:8765,14846594:8766,14846595:8767,14846122:8768,14846121:8769,14846119:8778,14846120:8779,49836:8780,14845842:8781,14845844:8782,14846080:8783,14846083:8784,14846112:8796,14846629:8797,14847122:8798,14846082:8799,14846087:8800,14846369:8801,14846354:8802,14846378:8803,14846379:8804,14846106:8805,14846141:8806,14846109:8807,14846133:8808,14846123:8809,14846124:8810,14845099:8818,14844080:8819,14850479:8820,14850477:8821,14850474:8822,14844064:8823,14844065:8824,49846:8825,14849967:8830,15711376:9008,15711377:9009,15711378:9010,15711379:9011,15711380:9012,15711381:9013,15711382:9014,15711383:9015,15711384:9016,15711385:9017,15711393:9025,15711394:9026,15711395:9027,15711396:9028,15711397:9029,15711398:9030,15711399:9031,15711400:9032,15711401:9033,15711402:9034,15711403:9035,15711404:9036,15711405:9037,15711406:9038,15711407:9039,15711408:9040,15711409:9041,15711410:9042,15711411:9043,15711412:9044,15711413:9045,15711414:9046,15711415:9047,15711416:9048,15711417:9049,15711418:9050,15711617:9057,15711618:9058,15711619:9059,15711620:9060,15711621:9061,15711622:9062,15711623:9063,15711624:9064,15711625:9065,15711626:9066,15711627:9067,15711628:9068,15711629:9069,15711630:9070,15711631:9071,15711632:9072,15711633:9073,15711634:9074,15711635:9075,15711636:9076,15711637:9077,15711638:9078,15711639:9079,15711640:9080,15711641:9081,15711642:9082,14909825:9249,14909826:9250,14909827:9251,14909828:9252,14909829:9253,14909830:9254,14909831:9255,14909832:9256,14909833:9257,14909834:9258,14909835:9259,14909836:9260,14909837:9261,14909838:9262,14909839:9263,14909840:9264,14909841:9265,14909842:9266,14909843:9267,14909844:9268,14909845:9269,14909846:9270,14909847:9271,14909848:9272,14909849:9273,14909850:9274,14909851:9275,14909852:9276,14909853:9277,14909854:9278,14909855:9279,14909856:9280,14909857:9281,14909858:9282,14909859:9283,14909860:9284,14909861:9285,14909862:9286,14909863:9287,14909864:9288,14909865:9289,14909866:9290,14909867:9291,14909868:9292,14909869:9293,14909870:9294,14909871:9295,14909872:9296,14909873:9297,14909874:9298,14909875:9299,14909876:9300,14909877:9301,14909878:9302,14909879:9303,14909880:9304,14909881:9305,14909882:9306,14909883:9307,14909884:9308,14909885:9309,14909886:9310,14909887:9311,14910080:9312,14910081:9313,14910082:9314,14910083:9315,14910084:9316,14910085:9317,14910086:9318,14910087:9319,14910088:9320,14910089:9321,14910090:9322,14910091:9323,14910092:9324,14910093:9325,14910094:9326,14910095:9327,14910096:9328,14910097:9329,14910098:9330,14910099:9331,14910113:9505,14910114:9506,14910115:9507,14910116:9508,14910117:9509,14910118:9510,14910119:9511,14910120:9512,14910121:9513,14910122:9514,14910123:9515,14910124:9516,14910125:9517,14910126:9518,14910127:9519,14910128:9520,14910129:9521,14910130:9522,14910131:9523,14910132:9524,14910133:9525,14910134:9526,14910135:9527,14910136:9528,14910137:9529,14910138:9530,14910139:9531,14910140:9532,14910141:9533,14910142:9534,14910143:9535,14910336:9536,14910337:9537,14910338:9538,14910339:9539,14910340:9540,14910341:9541,14910342:9542,14910343:9543,14910344:9544,14910345:9545,14910346:9546,14910347:9547,14910348:9548,14910349:9549,14910350:9550,14910351:9551,14910352:9552,14910353:9553,14910354:9554,14910355:9555,14910356:9556,14910357:9557,14910358:9558,14910359:9559,14910360:9560,14910361:9561,14910362:9562,14910363:9563,14910364:9564,14910365:9565,14910366:9566,14910367:9567,14910368:9568,14910369:9569,14910370:9570,14910371:9571,14910372:9572,14910373:9573,14910374:9574,14910375:9575,14910376:9576,14910377:9577,14910378:9578,14910379:9579,14910380:9580,14910381:9581,14910382:9582,14910383:9583,14910384:9584,14910385:9585,14910386:9586,14910387:9587,14910388:9588,14910389:9589,14910390:9590,52881:9761,52882:9762,52883:9763,52884:9764,52885:9765,52886:9766,52887:9767,52888:9768,52889:9769,52890:9770,52891:9771,52892:9772,52893:9773,52894:9774,52895:9775,52896:9776,52897:9777,52899:9778,52900:9779,52901:9780,52902:9781,52903:9782,52904:9783,52905:9784,52913:9793,52914:9794,52915:9795,52916:9796,52917:9797,52918:9798,52919:9799,52920:9800,52921:9801,52922:9802,52923:9803,52924:9804,52925:9805,52926:9806,52927:9807,53120:9808,53121:9809,53123:9810,53124:9811,53125:9812,53126:9813,53127:9814,53128:9815,53129:9816,53392:10017,53393:10018,53394:10019,53395:10020,53396:10021,53397:10022,53377:10023,53398:10024,53399:10025,53400:10026,53401:10027,53402:10028,53403:10029,53404:10030,53405:10031,53406:10032,53407:10033,53408:10034,53409:10035,53410:10036,53411:10037,53412:10038,53413:10039,53414:10040,53415:10041,53416:10042,53417:10043,53418:10044,53419:10045,53420:10046,53421:10047,53422:10048,53423:10049,53424:10065,53425:10066,53426:10067,53427:10068,53428:10069,53429:10070,53649:10071,53430:10072,53431:10073,53432:10074,53433:10075,53434:10076,53435:10077,53436:10078,53437:10079,53438:10080,53439:10081,53632:10082,53633:10083,53634:10084,53635:10085,53636:10086,53637:10087,53638:10088,53639:10089,53640:10090,53641:10091,53642:10092,53643:10093,53644:10094,53645:10095,53646:10096,53647:10097,14849152:10273,14849154:10274,14849164:10275,14849168:10276,14849176:10277,14849172:10278,14849180:10279,14849196:10280,14849188:10281,14849204:10282,14849212:10283,14849153:10284,14849155:10285,14849167:10286,14849171:10287,14849179:10288,14849175:10289,14849187:10290,14849203:10291,14849195:10292,14849211:10293,14849419:10294,14849184:10295,14849199:10296,14849192:10297,14849207:10298,14849215:10299,14849181:10300,14849200:10301,14849189:10302,14849208:10303,14849410:10304,14989980:12321,15045782:12322,15050883:12323,15308991:12324,15045504:12325,15107227:12326,15109288:12327,15050678:12328,15302818:12329,15241653:12330,15240348:12331,15182224:12332,15106730:12333,15110049:12334,15120549:12335,15112109:12336,15241638:12337,15239846:12338,15314869:12339,15114899:12340,15047847:12341,15111841:12342,15108529:12343,15052443:12344,15050640:12345,15243707:12346,15311796:12347,15185314:12348,15185598:12349,15314574:12350,15108246:12351,15184543:12352,15246007:12353,15052425:12354,15055541:12355,15109257:12356,15112855:12357,15114632:12358,15308679:12359,15310477:12360,15113615:12361,14990245:12362,14990474:12363,14990733:12364,14991005:12365,15040905:12366,15047602:12367,15049911:12368,15050644:12369,15050881:12370,15052937:12371,15106975:12372,15107215:12373,15107504:12374,15112339:12375,15115397:12376,15172282:12377,15177103:12378,15177136:12379,15181755:12380,15185581:12381,15185839:12382,15238019:12383,15241358:12384,15245731:12385,15248514:12386,15303061:12387,15303098:12388,15043771:12389,14989973:12390,14989989:12391,15048607:12392,15237810:12393,15303553:12394,15180719:12395,14989440:12396,15049649:12397,15121058:12398,15302840:12399,15182002:12400,15240360:12401,15239819:12402,15315119:12403,15041921:12404,15044016:12405,15045309:12406,15045537:12407,15047584:12408,15050683:12409,15056021:12410,15311794:12411,15120299:12412,15238052:12413,15242413:12414,15309218:12577,15309232:12578,15309472:12579,15310779:12580,15044747:12581,15044531:12582,15052423:12583,15172495:12584,15187645:12585,15253378:12586,15309736:12587,15044015:12588,15316380:12589,15182522:12590,14989457:12591,15180435:12592,15239100:12593,15120550:12594,15046808:12595,15045764:12596,15117469:12597,15242394:12598,15315131:12599,15050661:12600,15044265:12601,15119782:12602,15176604:12603,15308431:12604,15047042:12605,14989969:12606,15303051:12607,15309746:12608,15240591:12609,15312012:12610,15044513:12611,15046326:12612,15051952:12613,15056305:12614,15112352:12615,15113139:12616,15114372:12617,15118520:12618,15119283:12619,15119529:12620,15176091:12621,15178632:12622,15182222:12623,15311028:12624,15240113:12625,15245723:12626,15247776:12627,15305645:12628,15120050:12629,15177387:12630,15178634:12631,15312773:12632,15106726:12633,15248513:12634,15251082:12635,15308466:12636,15115918:12637,15044269:12638,15042182:12639,15047826:12640,15048880:12641,15050116:12642,15052468:12643,15055798:12644,15106216:12645,15109801:12646,15110068:12647,15119039:12648,15121556:12649,15172238:12650,15172756:12651,15173017:12652,15173525:12653,15174847:12654,15186049:12655,15239606:12656,15240081:12657,15242903:12658,15303072:12659,15305115:12660,15316123:12661,15049129:12662,15111868:12663,15118746:12664,15176869:12665,15042489:12666,15049902:12667,15050149:12668,15056512:12669,15056796:12670,15108796:12833,15112122:12834,15116458:12835,15117479:12836,15118004:12837,15175307:12838,15187841:12839,15246742:12840,15316140:12841,15316110:12842,15317892:12843,15053473:12844,15118998:12845,15240635:12846,15041668:12847,15053195:12848,15107766:12849,15239046:12850,15114678:12851,15174049:12852,14989721:12853,14991290:12854,15044024:12855,15106473:12856,15120553:12857,15182223:12858,15310771:12859,14989451:12860,15043734:12861,14990254:12862,14990741:12863,14990525:12864,14991009:12865,14990771:12866,15043232:12867,15044527:12868,15046793:12869,15049871:12870,15051649:12871,15052470:12872,15052705:12873,15181713:12874,15112839:12875,15113884:12876,15113910:12877,15117708:12878,15119027:12879,15172011:12880,15175554:12881,15181453:12882,15181502:12883,15182012:12884,15183495:12885,15239857:12886,15240091:12887,15240324:12888,15240631:12889,15241135:12890,15241107:12891,15244710:12892,15248050:12893,15046825:12894,15250088:12895,15253414:12896,15303054:12897,15309982:12898,15243914:12899,14991236:12900,15053736:12901,15108241:12902,15174041:12903,15176891:12904,15239077:12905,15239869:12906,15244222:12907,15250304:12908,15309701:12909,15312019:12910,15312789:12911,14990219:12912,14990490:12913,15247267:12914,15047582:12915,15049098:12916,15049610:12917,15055803:12918,15056811:12919,15106218:12920,15106708:12921,15106466:12922,15107984:12923,15108242:12924,15109008:12925,15111353:12926,15314305:13089,15112614:13090,15114928:13091,15119799:13092,15172016:13093,15177100:13094,15178374:13095,15185333:13096,15239845:13097,15245241:13098,15308427:13099,15309454:13100,15250077:13101,15042481:13102,15043262:13103,15049878:13104,15045299:13105,15052467:13106,15053974:13107,15107496:13108,15115906:13109,15120047:13110,15180429:13111,15242123:13112,15245719:13113,15247794:13114,15306407:13115,15313592:13116,15119788:13117,15312552:13118,15244185:13119,15048355:13120,15114175:13121,15244174:13122,15304846:13123,15043203:13124,15047303:13125,15044740:13126,15055763:13127,15109025:13128,15110841:13129,15114428:13130,15114424:13131,15118011:13132,15175090:13133,15180474:13134,15182251:13135,15247002:13136,15247250:13137,15250859:13138,15252611:13139,15303597:13140,15308451:13141,15309460:13142,15310249:13143,15052198:13144,15053491:13145,15115709:13146,15311245:13147,15311246:13148,15109787:13149,15183008:13150,15116459:13151,15116735:13152,15114934:13153,15315085:13154,15121823:13155,15042994:13156,15046301:13157,15106480:13158,15109036:13159,15119547:13160,15120519:13161,15121297:13162,15241627:13163,15246480:13164,15252868:13165,14989460:13166,15315129:13167,15044534:13168,15115419:13169,15116474:13170,15310468:13171,15114410:13172,15041948:13173,15182723:13174,15241906:13175,15304604:13176,15306380:13177,15047067:13178,15316136:13179,15114402:13180,15240325:13181,15241393:13182,15184549:13345,15042696:13346,15240069:13347,15176614:13348,14989758:13349,14990979:13350,15042208:13351,15052690:13352,15042698:13353,15043480:13354,15043495:13355,15054779:13356,15046298:13357,15048874:13358,15050662:13359,15052428:13360,15052440:13361,15052699:13362,15055282:13363,15055289:13364,15106723:13365,15107231:13366,15107491:13367,15107774:13368,15110043:13369,15111586:13370,15114129:13371,15114643:13372,15115194:13373,15117502:13374,15117715:13375,15118743:13376,15121570:13377,15122071:13378,15121797:13379,15176368:13380,15176856:13381,15178659:13382,15178891:13383,15182783:13384,15183521:13385,15184033:13386,15185833:13387,15187126:13388,15187888:13389,15237789:13390,15239590:13391,15240862:13392,15247027:13393,15248268:13394,15250091:13395,15303300:13396,15307153:13397,15308435:13398,15308433:13399,15308450:13400,15309221:13401,15310739:13402,15312040:13403,15239320:13404,14989496:13405,15044779:13406,15053496:13407,15054732:13408,15175337:13409,15178124:13410,15178940:13411,15053481:13412,15187883:13413,15250571:13414,15309697:13415,15310993:13416,15311252:13417,15311256:13418,14990465:13419,14990478:13420,15044017:13421,15046300:13422,15047080:13423,15048634:13424,15050119:13425,15051913:13426,15052676:13427,15053456:13428,15054988:13429,15055294:13430,15056780:13431,15110062:13432,15113402:13433,15112087:13434,15112098:13435,15113375:13436,15115147:13437,15115140:13438,15116703:13601,15055024:13602,15118213:13603,15118487:13604,15118781:13605,15177151:13606,15181192:13607,15052195:13608,15181952:13609,15185024:13610,15056573:13611,15246991:13612,15247512:13613,15250100:13614,15250871:13615,15252364:13616,15252637:13617,15311778:13618,15313038:13619,15314108:13620,14989952:13621,15040957:13622,15041664:13623,15050387:13624,15052444:13625,15108271:13626,15108736:13627,15111084:13628,15117498:13629,15174304:13630,15177361:13631,15181191:13632,15187625:13633,15245243:13634,15248060:13635,15248816:13636,15109804:13637,15241098:13638,15310496:13639,15044745:13640,15044739:13641,15046315:13642,15114644:13643,15116696:13644,15247792:13645,15179943:13646,15113653:13647,15317901:13648,15044020:13649,15052450:13650,15238298:13651,15243664:13652,15302790:13653,14989464:13654,14989701:13655,14990215:13656,14990481:13657,15044490:13658,15044792:13659,15052462:13660,15056019:13661,15106213:13662,15111569:13663,15113405:13664,15118722:13665,15118770:13666,15119267:13667,15172024:13668,15175811:13669,15182262:13670,15182510:13671,15182984:13672,15185050:13673,15184830:13674,15185318:13675,15112103:13676,15174043:13677,15044283:13678,15053189:13679,15054760:13680,15109010:13681,15109024:13682,15109273:13683,15120544:13684,15243674:13685,15247537:13686,15251357:13687,15305656:13688,15121537:13689,15181478:13690,15314330:13691,14989992:13692,14989995:13693,14989996:13694,14991003:13857,14991008:13858,15041425:13859,15041927:13860,15182774:13861,15041969:13862,15042486:13863,15043988:13864,15043745:13865,15044031:13866,15044523:13867,15046316:13868,15049347:13869,15053729:13870,15056055:13871,15056266:13872,15106223:13873,15106448:13874,15106477:13875,15109279:13876,15111577:13877,15116683:13878,15119233:13879,15174530:13880,15174573:13881,15179695:13882,15238072:13883,15238277:13884,15239304:13885,15242638:13886,15303607:13887,15306657:13888,15310783:13889,15312279:13890,15313306:13891,14990256:13892,15042461:13893,15052973:13894,15112833:13895,15115693:13896,15053184:13897,15113138:13898,15115701:13899,15175305:13900,15114640:13901,15184513:13902,15041413:13903,15043492:13904,15048071:13905,15054782:13906,15305894:13907,15111844:13908,15117475:13909,15117501:13910,15175860:13911,15181441:13912,15181501:13913,15183243:13914,15185802:13915,15239865:13916,15241100:13917,15245759:13918,15246751:13919,15248569:13920,15253393:13921,15304593:13922,15044767:13923,15305344:13924,14989725:13925,15040694:13926,15044517:13927,15043770:13928,15174551:13929,15175318:13930,15179689:13931,15240102:13932,15252143:13933,15312774:13934,15312776:13935,15312786:13936,15041975:13937,15107226:13938,15243678:13939,15046320:13940,15182266:13941,15040950:13942,15052691:13943,15303047:13944,15309445:13945,14989490:13946,15117211:13947,15304615:13948,15053201:13949,15053192:13950,15109784:14113,15182495:14114,15118995:14115,15310260:14116,15252897:14117,15182506:14118,15173258:14119,15309448:14120,15184514:14121,15114391:14122,15186352:14123,15114641:14124,15306156:14125,15043506:14126,15044763:14127,15242923:14128,15247507:14129,15187620:14130,15252365:14131,15303585:14132,15044006:14133,15245960:14134,15181185:14135,14991234:14136,15041214:14137,15042705:14138,15041924:14139,15046035:14140,15047853:14141,15175594:14142,15048331:14143,15050129:14144,15056290:14145,15056516:14146,15106485:14147,15107510:14148,15107495:14149,15107753:14150,15109810:14151,15110330:14152,15111596:14153,15112623:14154,15114626:14155,15120531:14156,15177126:14157,15182013:14158,15184827:14159,15185292:14160,15185561:14161,15186315:14162,15187371:14163,15240334:14164,15240586:14165,15244173:14166,15247496:14167,15247779:14168,15248806:14169,15252413:14170,15311002:14171,15316623:14172,15239864:14173,15253390:14174,15314856:14175,15043207:14176,15108255:14177,15110787:14178,15122304:14179,15309465:14180,15114625:14181,15041169:14182,15117472:14183,15118778:14184,15121812:14185,15182260:14186,15185296:14187,15245696:14188,15247523:14189,15113352:14190,14990262:14191,15040697:14192,15040678:14193,15040933:14194,15041980:14195,15042744:14196,15042979:14197,15046311:14198,15047823:14199,15048837:14200,15051660:14201,15055802:14202,15107762:14203,15108024:14204,15109043:14205,15109554:14206,15115420:14369,15116457:14370,15174077:14371,15174316:14372,15174830:14373,15179924:14374,15180207:14375,15185337:14376,15178892:14377,15237801:14378,15246987:14379,15248537:14380,15250338:14381,15252370:14382,15303075:14383,15306165:14384,15309242:14385,15311253:14386,15313043:14387,15317432:14388,15041923:14389,15044255:14390,15044275:14391,15055291:14392,15056038:14393,15120539:14394,15121040:14395,15175300:14396,15175614:14397,15185283:14398,15239351:14399,15247488:14400,15248314:14401,15309200:14402,14989710:14403,15040651:14404,15044516:14405,15045052:14406,15047610:14407,15050641:14408,15052196:14409,15054769:14410,15055531:14411,15056039:14412,15108280:14413,15111557:14414,15113903:14415,15120790:14416,15174544:14417,15184778:14418,15246004:14419,15237793:14420,15238049:14421,15241136:14422,15243662:14423,15248007:14424,15251368:14425,15304887:14426,15309703:14427,15311271:14428,15318163:14429,14989972:14430,14989970:14431,14990477:14432,15043976:14433,15045001:14434,15044798:14435,15050927:14436,15056524:14437,15056545:14438,15106719:14439,15114919:14440,15116942:14441,15176090:14442,15180417:14443,15248030:14444,15248036:14445,15248823:14446,15304336:14447,14989726:14448,15314825:14449,14989988:14450,14990780:14451,14991023:14452,15040665:14453,15040662:14454,15041929:14455,15041964:14456,15043231:14457,15043257:14458,15043518:14459,15044250:14460,15044515:14461,15044753:14462,15044750:14625,15046281:14626,15048081:14627,15048354:14628,15050173:14629,15052180:14630,15052189:14631,15052431:14632,15054757:14633,15054759:14634,15054775:14635,15055288:14636,15055491:14637,15055514:14638,15055543:14639,15056024:14640,15106450:14641,15107468:14642,15108759:14643,15109016:14644,15109799:14645,15111355:14646,15112322:14647,15112579:14648,15113140:14649,15113645:14650,15114401:14651,15114903:14652,15116171:14653,15118751:14654,15119530:14655,15119785:14656,15120559:14657,15121053:14658,15176882:14659,15178375:14660,15180204:14661,15182015:14662,15184800:14663,15185029:14664,15185048:14665,15185310:14666,15185585:14667,15237269:14668,15237251:14669,15237807:14670,15237809:14671,15238548:14672,15238799:14673,15239338:14674,15240594:14675,15245708:14676,15245729:14677,15248539:14678,15250082:14679,15250364:14680,15303562:14681,15304117:14682,15305137:14683,15179967:14684,15305660:14685,15308452:14686,15309197:14687,15310981:14688,15312537:14689,15313816:14690,15316155:14691,15042971:14692,15043243:14693,15044535:14694,15044744:14695,15049621:14696,15109047:14697,15122336:14698,15249834:14699,15252895:14700,15317689:14701,15041931:14702,15042747:14703,15045002:14704,15047613:14705,15182208:14706,15304119:14707,15316384:14708,15317906:14709,15175044:14710,15121545:14711,15238576:14712,15176849:14713,15056829:14714,15106970:14715,15313576:14716,15174555:14717,15253180:14718,15117732:14881,15310979:14882,14990218:14883,15047600:14884,15048100:14885,15049406:14886,15051162:14887,15106472:14888,15107975:14889,15112335:14890,15112326:14891,15114425:14892,15114929:14893,15120311:14894,15177621:14895,15185082:14896,15239598:14897,15314306:14898,14989979:14899,14990736:14900,15044489:14901,15045766:14902,15054255:14903,15054758:14904,15054766:14905,15114171:14906,15119001:14907,15176115:14908,15179906:14909,15247760:14910,15306390:14911,15246239:14912,15048080:14913,15055527:14914,15109291:14915,15041205:14916,15041196:14917,15042189:14918,15113344:14919,15045513:14920,15049118:14921,15050427:14922,15052464:14923,15056297:14924,15108493:14925,15109793:14926,15114429:14927,15117747:14928,15120520:14929,15172029:14930,15304583:14931,15174272:14932,15179925:14933,15179942:14934,15181229:14935,15111822:14936,15185072:14937,15241116:14938,15246209:14939,15252617:14940,15309467:14941,15042980:14942,15047848:14943,15113616:14944,15187370:14945,15250081:14946,15042228:14947,15048066:14948,15308970:14949,15048890:14950,15115914:14951,15237812:14952,15045298:14953,15053966:14954,15048636:14955,15180437:14956,15316922:14957,14990748:14958,15042954:14959,15045259:14960,15110334:14961,15112360:14962,15113364:14963,15114165:14964,15182468:14965,15183254:14966,15185058:14967,15305903:14968,15114652:14969,15314605:14970,15183033:14971,15043737:14972,15042186:14973,15042743:14974,15052703:15137,15109046:15138,15110830:15139,15111078:15140,15113389:15141,15118010:15142,15242921:15143,15309713:15144,15178384:15145,15314838:15146,15109516:15147,15305862:15148,15314603:15149,15178431:15150,15112594:15151,14989449:15152,15041176:15153,15044482:15154,15053233:15155,15106984:15156,15110802:15157,15111587:15158,15114655:15159,15173542:15160,15175562:15161,15176867:15162,15183511:15163,15186562:15164,15243925:15165,15249027:15166,15250331:15167,15304120:15168,15312016:15169,15111852:15170,15112875:15171,15117963:15172,14990229:15173,14990228:15174,14990522:15175,14990783:15176,15042746:15177,15044536:15178,15044530:15179,15046563:15180,15047579:15181,15049643:15182,15050635:15183,15050633:15184,15050687:15185,15052176:15186,15053197:15187,15054978:15188,15055019:15189,15056791:15190,15106205:15191,15109255:15192,15111343:15193,15052188:15194,15111855:15195,15111869:15196,15112104:15197,15113885:15198,15117730:15199,15117755:15200,15118479:15201,15175045:15202,15181193:15203,15181697:15204,15184824:15205,15185049:15206,15185067:15207,15237794:15208,15238274:15209,15239091:15210,15246998:15211,15247774:15212,15247785:15213,15247782:15214,15248012:15215,15248302:15216,15250311:15217,15250332:15218,15309708:15219,15311804:15220,15117743:15221,14989963:15222,14990524:15223,14990989:15224,15041936:15225,15052183:15226,15052730:15227,15107464:15228,15109249:15229,15112578:15230,15117473:15393,15121291:15394,15119035:15395,15173822:15396,15176381:15397,15177620:15398,15180673:15399,15180986:15400,15237260:15401,15237299:15402,15239082:15403,15241876:15404,15253150:15405,15118736:15406,15317439:15407,15056015:15408,15248792:15409,15316139:15410,15182778:15411,15252408:15412,15052429:15413,15309739:15414,14989443:15415,15044529:15416,15048631:15417,15049905:15418,15051657:15419,15052452:15420,15106697:15421,15120831:15422,15121542:15423,15177406:15424,15250346:15425,15052447:15426,15242368:15427,15183776:15428,15040946:15429,15114164:15430,15239837:15431,15053217:15432,15242634:15433,15186078:15434,15239310:15435,15042201:15436,15052932:15437,15109544:15438,15250854:15439,15111836:15440,15173038:15441,15180990:15442,15185047:15443,15237253:15444,15248541:15445,15252362:15446,15303086:15447,15244167:15448,15303338:15449,15040671:15450,15043514:15451,15052986:15452,15113619:15453,15172028:15454,15173813:15455,15304076:15456,15304584:15457,15305899:15458,15240101:15459,15052674:15460,15056049:15461,15107001:15462,14989499:15463,15044502:15464,15052424:15465,15108491:15466,15113393:15467,15117962:15468,15174569:15469,15175584:15470,15181998:15471,15238571:15472,15251107:15473,15304082:15474,15312534:15475,15041682:15476,15044503:15477,15045034:15478,15052735:15479,15109768:15480,15116473:15481,15185580:15482,15309952:15483,15047578:15484,15044494:15485,15045032:15486,15052439:15649,15052977:15650,15054750:15651,14991278:15652,15107201:15653,15109054:15654,15119538:15655,15181696:15656,15181707:15657,15185282:15658,15186317:15659,15187858:15660,15239085:15661,15239327:15662,15241872:15663,15245702:15664,15246770:15665,15249040:15666,15251892:15667,15252655:15668,15302833:15669,15304075:15670,15304108:15671,15309702:15672,15304348:15673,14990208:15674,14990735:15675,15041925:15676,15043969:15677,15056531:15678,15108238:15679,15114132:15680,15118721:15681,15120523:15682,15175075:15683,15186086:15684,15304589:15685,15305347:15686,15044500:15687,15049881:15688,15052479:15689,15120273:15690,15181213:15691,15186094:15692,15184539:15693,15049150:15694,15173279:15695,15042490:15696,15245715:15697,15253424:15698,14991242:15699,15053755:15700,15112357:15701,15179436:15702,15182755:15703,15239324:15704,15312831:15705,15042438:15706,15056554:15707,15112108:15708,15115695:15709,15117961:15710,15120307:15711,15121046:15712,15121828:15713,15178686:15714,15185044:15715,15054753:15716,15303093:15717,15304327:15718,15310982:15719,15042470:15720,15042717:15721,15108480:15722,15112849:15723,15113113:15724,15120538:15725,15055542:15726,15185810:15727,15187378:15728,15113144:15729,15242927:15730,15243191:15731,15248312:15732,15043241:15733,15044505:15734,15050163:15735,15055503:15736,15056528:15737,15106453:15738,15305636:15739,15309220:15740,15041207:15741,15041695:15742,15043485:15905,15043744:15906,15043975:15907,15044524:15908,15045544:15909,15046022:15910,15045809:15911,15046807:15912,15050152:15913,15050430:15914,15050940:15915,15052469:15916,15052934:15917,15052943:15918,15052945:15919,15052954:15920,15055492:15921,15055498:15922,15055776:15923,15056304:15924,15108543:15925,15108740:15926,15109019:15927,15109772:15928,15109559:15929,15112327:15930,15112332:15931,15112365:15932,15112630:15933,15113662:15934,15114914:15935,15116447:15936,15116469:15937,15119036:15938,15120008:15939,15120521:15940,15120792:15941,15172796:15942,15172774:15943,15173031:15944,15177607:15945,15178881:15946,15180189:15947,15180929:15948,15181221:15949,15181744:15950,15182752:15951,15182993:15952,15184551:15953,15185081:15954,15237782:15955,15241110:15956,15241867:15957,15242633:15958,15245725:15959,15246259:15960,15247519:15961,15247548:15962,15247764:15963,15247795:15964,15249825:15965,15250334:15966,15304356:15967,15305126:15968,15306174:15969,15306904:15970,15309468:15971,15310488:15972,14989450:15973,14989448:15974,14989470:15975,14989719:15976,15042199:15977,15042992:15978,15048590:15979,15048884:15980,15049612:15981,15051938:15982,15055032:15983,15106949:15984,15111102:15985,15113633:15986,15113622:15987,15119748:15988,15174326:15989,15177139:15990,15182243:15991,15241912:15992,15248818:15993,15304376:15994,15305888:15995,15046833:15996,15048628:15997,15311806:15998,15109037:16161,15115405:16162,15117974:16163,15173549:16164,15186324:16165,15237559:16166,15239602:16167,15247270:16168,15311775:16169,15244693:16170,15253169:16171,15052987:16172,14990520:16173,14991265:16174,14991029:16175,15045767:16176,15050912:16177,15052701:16178,15052713:16179,15056771:16180,15107470:16181,15109295:16182,15111856:16183,15112587:16184,15115182:16185,15115931:16186,15119800:16187,15120305:16188,15176883:16189,15177401:16190,15178911:16191,15181214:16192,15181734:16193,15185075:16194,15239075:16195,15239855:16196,15242922:16197,15247018:16198,15247546:16199,15252139:16200,15253147:16201,15302834:16202,15304605:16203,15309959:16204,14990010:16205,14990209:16206,15042691:16207,15049141:16208,15049644:16209,15052939:16210,15176858:16211,15052989:16212,15238542:16213,15247498:16214,15253381:16215,15309219:16216,15310253:16217,15183013:16218,15248271:16219,15310984:16220,15304098:16221,15047603:16222,15044264:16223,15302807:16224,15044793:16225,15048322:16226,15055013:16227,15109800:16228,15118516:16229,15172234:16230,15179169:16231,15184523:16232,15187872:16233,15245744:16234,15303042:16235,15304084:16236,15305872:16237,15305880:16238,15309455:16239,15176094:16240,15313796:16241,15053959:16242,15054249:16243,15111600:16244,15113890:16245,15251112:16246,15309723:16247,15109550:16248,15113609:16249,15115417:16250,15241093:16251,15310999:16252,15309696:16253,15246270:16254,15122052:16417,15110586:16418,15052728:16419,14989462:16420,15171756:16421,15177117:16422,15112367:16423,15042436:16424,15042742:16425,15043490:16426,15050643:16427,15056513:16428,15106215:16429,15108240:16430,15111359:16431,15111604:16432,15112351:16433,15112628:16434,15115186:16435,15114390:16436,15117731:16437,15120517:16438,15174066:16439,15176863:16440,15178651:16441,15184574:16442,15237526:16443,15049648:16444,15246269:16445,15246783:16446,15248032:16447,15248019:16448,15248267:16449,15302813:16450,15304338:16451,15310226:16452,15310233:16453,15111817:16454,15181966:16455,15238278:16456,15309499:16457,15055021:16458,15106972:16459,15108250:16460,15111845:16461,15112340:16462,15113872:16463,15179699:16464,15182221:16465,15184269:16466,15186110:16467,15238282:16468,15250092:16469,15250852:16470,15251361:16471,15251871:16472,15180457:16473,15042695:16474,15109017:16475,15109797:16476,15110530:16477,15108760:16478,15247533:16479,15182467:16480,15183744:16481,15248044:16482,15309738:16483,15185334:16484,15239308:16485,15244681:16486,14990233:16487,15041928:16488,15043971:16489,15044e3:16490,15052451:16491,15052930:16492,15052950:16493,15054749:16494,15108262:16495,15108487:16496,15110832:16497,15114387:16498,15114420:16499,15119241:16500,15119749:16501,15119511:16502,15114131:16503,15121820:16504,15173006:16505,15173053:16506,15112075:16507,15182271:16508,15183533:16509,15185818:16510,15186314:16673,15187624:16674,15238586:16675,15239323:16676,15239353:16677,15242918:16678,15247790:16679,15250318:16680,15251381:16681,15303096:16682,15303095:16683,15305389:16684,15305361:16685,15308419:16686,15314606:16687,15042957:16688,15046276:16689,15121592:16690,15172790:16691,15041960:16692,15181445:16693,15186325:16694,15238835:16695,15184782:16696,15047052:16697,15049105:16698,15053480:16699,15109802:16700,15113150:16701,15113149:16702,15115674:16703,15174553:16704,15177359:16705,15177358:16706,15180942:16707,15181206:16708,15181727:16709,15184535:16710,15185056:16711,15185284:16712,15243399:16713,15247540:16714,15308987:16715,15303073:16716,15318176:16717,15041447:16718,15042997:16719,15044492:16720,15044514:16721,15040649:16722,15046314:16723,15049646:16724,15050127:16725,15173821:16726,15052427:16727,15053220:16728,15043741:16729,15106979:16730,15106995:16731,15109532:16732,15109763:16733,15109311:16734,15109819:16735,15111053:16736,15112105:16737,15113145:16738,15054755:16739,15116173:16740,15116221:16741,15121557:16742,15173541:16743,14989961:16744,15177641:16745,15178680:16746,15182483:16747,15184799:16748,15185807:16749,15185564:16750,15237537:16751,15240585:16752,15240600:16753,15241644:16754,15241916:16755,15243195:16756,15246213:16757,15250864:16758,15302785:16759,15303085:16760,15306391:16761,15309980:16762,15313042:16763,15041423:16764,15049367:16765,15107726:16766,15239059:16929,15242421:16930,15250568:16931,15302816:16932,14991235:16933,15040948:16934,15042951:16935,15044019:16936,15106479:16937,15109513:16938,15113631:16939,15120556:16940,15251123:16941,15302815:16942,14991255:16943,15053214:16944,15250314:16945,15112079:16946,15185562:16947,15043986:16948,15245974:16949,15041974:16950,15110019:16951,15052184:16952,15052203:16953,15052938:16954,15110285:16955,15113617:16956,15303068:16957,14990230:16958,15049882:16959,15049898:16960,15118768:16961,15247761:16962,15045822:16963,15048853:16964,15050405:16965,15106992:16966,15108499:16967,15114113:16968,15239349:16969,15115669:16970,15309184:16971,15312772:16972,15313064:16973,14990739:16974,15048838:16975,15052734:16976,15237264:16977,15053489:16978,15055023:16979,15056517:16980,15106208:16981,15107467:16982,15108276:16983,15113151:16984,15119280:16985,15121310:16986,15238030:16987,15238591:16988,15240084:16989,15245963:16990,15250104:16991,15302784:16992,15302830:16993,15309450:16994,15317915:16995,15314843:16996,14990243:16997,15044528:16998,15049895:16999,15183020:17e3,15304333:17001,15311244:17002,15316921:17003,15121309:17004,15171751:17005,15043987:17006,15046020:17007,15052421:17008,15108504:17009,15108766:17010,15109011:17011,15119010:17012,15122351:17013,15175842:17014,15247511:17015,15306936:17016,15122305:17017,15248318:17018,15240376:17019,15042471:17020,15244216:17021,15044522:17022,15044521:17185,14990726:17186,15303060:17187,15253168:17188,15050154:17189,15238321:17190,15054781:17191,15182762:17192,15253183:17193,15115162:17194,15249591:17195,15174584:17196,15315336:17197,15116477:17198,15248048:17199,14989497:17200,15043992:17201,15046790:17202,15048102:17203,15108997:17204,15109794:17205,15112102:17206,15117710:17207,15120289:17208,15120795:17209,15172269:17210,15179693:17211,15182767:17212,15183530:17213,15185595:17214,15237309:17215,15238022:17216,15244171:17217,15248021:17218,15306139:17219,15047587:17220,15049607:17221,15056062:17222,15111853:17223,15112854:17224,15116928:17225,15118005:17226,15176887:17227,15248263:17228,15040676:17229,15179685:17230,15047856:17231,15056027:17232,15106469:17233,15112634:17234,15118752:17235,15177652:17236,15181978:17237,15187374:17238,15239092:17239,15244440:17240,15303045:17241,15312563:17242,15183753:17243,15177116:17244,15182777:17245,15183249:17246,15242116:17247,15302800:17248,15181737:17249,15182482:17250,15240374:17251,15051681:17252,15179136:17253,14989485:17254,14990258:17255,15052441:17256,15056800:17257,15108797:17258,15112380:17259,15114161:17260,15119272:17261,15243691:17262,15245751:17263,15247547:17264,15304078:17265,15305651:17266,15312784:17267,15116439:17268,15171750:17269,15174826:17270,15240103:17271,15241623:17272,15250095:17273,14989441:17274,15041926:17275,15042443:17276,15046283:17277,15052725:17278,15054998:17441,15055027:17442,15055489:17443,15056020:17444,15056053:17445,15056299:17446,15056564:17447,15108018:17448,15109265:17449,15112866:17450,15113373:17451,15121838:17452,15174034:17453,15176890:17454,15178938:17455,15237556:17456,15238329:17457,15238584:17458,15244726:17459,15248063:17460,15248284:17461,15251077:17462,15251379:17463,15305370:17464,15308215:17465,15310978:17466,15315877:17467,15043461:17468,15109527:17469,15178676:17470,15113365:17471,15118984:17472,15175565:17473,15250307:17474,15306414:17475,15309235:17476,15119525:17477,15049372:17478,15115406:17479,15116172:17480,15253437:17481,15306394:17482,15177627:17483,15302810:17484,15049114:17485,15114370:17486,15109812:17487,15116219:17488,14990723:17489,15121580:17490,15114136:17491,15253179:17492,15242406:17493,15185588:17494,15306132:17495,15115455:17496,15121840:17497,15048106:17498,15049655:17499,15051948:17500,15185068:17501,15173802:17502,15044746:17503,15304611:17504,15316660:17505,14989997:17506,14990734:17507,15040924:17508,15040949:17509,15042947:17510,15250078:17511,15045e3:17512,15048868:17513,15052442:17514,15055005:17515,15055509:17516,15055533:17517,15055799:17518,15056031:17519,15106700:17520,15108789:17521,15109306:17522,15110032:17523,15114927:17524,15118720:17525,15180423:17526,15181454:17527,15181963:17528,15185824:17529,15239559:17530,15247490:17531,15248294:17532,15251844:17533,15302803:17534,15303352:17697,15303853:17698,15304600:17699,15318158:17700,15119269:17701,15110552:17702,15111074:17703,15111605:17704,15121332:17705,15178372:17706,15183003:17707,15303081:17708,15306641:17709,15121082:17710,15045554:17711,15056569:17712,15110820:17713,15252877:17714,15253421:17715,15305092:17716,15041976:17717,15049131:17718,15049897:17719,15053205:17720,15055511:17721,15120315:17722,15186575:17723,15176860:17724,15250108:17725,15252386:17726,15311259:17727,15172281:17728,14990493:17729,15118015:17730,15122097:17731,15176880:17732,15309755:17733,15041934:17734,15044752:17735,15048885:17736,15049111:17737,15050412:17738,15053216:17739,15056530:17740,15111831:17741,15113628:17742,15120545:17743,15178171:17744,15241119:17745,15250349:17746,15302804:17747,15303613:17748,15306125:17749,15179941:17750,15179962:17751,15043242:17752,15055526:17753,15047839:17754,15050164:17755,15106194:17756,15040658:17757,15041946:17758,15042220:17759,15042445:17760,15042688:17761,15045776:17762,15049108:17763,15049112:17764,15050135:17765,15052437:17766,15053750:17767,15054475:17768,15106748:17769,15108757:17770,15110317:17771,15113649:17772,15114627:17773,15114940:17774,15115167:17775,15178647:17776,15120280:17777,15120815:17778,15120027:17779,15172015:17780,15173512:17781,15056275:17782,15177624:17783,15181239:17784,15183241:17785,15183252:17786,15183250:17787,15184790:17788,15185329:17789,15042736:17790,15241635:17953,15242665:17954,15243172:17955,15247502:17956,15248516:17957,15249798:17958,15251599:17959,15302787:17960,15302799:17961,15306905:17962,15309238:17963,15311021:17964,15313072:17965,15308696:17966,15041421:17967,15043477:17968,15044748:17969,15048834:17970,15052942:17971,15107751:17972,15110814:17973,15119518:17974,15179443:17975,15182757:17976,15238068:17977,15241348:17978,15303059:17979,15305349:17980,15053728:17981,15316103:17982,15043775:17983,15056535:17984,15056563:17985,15120028:17986,15174073:17987,15179171:17988,15181503:17989,15183780:17990,15118226:17991,15174572:17992,15248045:17993,15114371:17994,15116705:17995,15042488:17996,15182465:17997,15115444:17998,15053194:17999,15315894:18e3,15240107:18001,15052677:18002,15304073:18003,15171742:18004,15047096:18005,15053231:18006,15106951:18007,15111590:18008,15118988:18009,15249818:18010,15303041:18011,15310995:18012,15045009:18013,15113095:18014,15304845:18015,15050120:18016,15303331:18017,15042181:18018,14989709:18019,15042474:18020,15242905:18021,15248526:18022,15171992:18023,15109562:18024,15306123:18025,15115682:18026,15312564:18027,15186052:18028,15177143:18029,15043991:18030,15115680:18031,15252383:18032,15309731:18033,15118749:18034,14989964:18035,15052988:18036,15056016:18037,15253417:18038,15043714:18039,15250321:18040,15237769:18041,15243705:18042,15055807:18043,15112101:18044,14989747:18045,15041957:18046,15050370:18209,15052991:18210,15310766:18211,14990267:18212,15050378:18213,15056781:18214,15248013:18215,15122337:18216,15181488:18217,15181218:18218,15052711:18219,15241649:18220,15174827:18221,15173297:18222,15055284:18223,15056821:18224,15109563:18225,15110810:18226,15173507:18227,15184536:18228,14989699:18229,15055804:18230,14989707:18231,15048604:18232,15047330:18233,15106729:18234,15122307:18235,15185037:18236,15238077:18237,15238323:18238,15238847:18239,15253170:18240,15246999:18241,15243940:18242,15054772:18243,15108746:18244,15110829:18245,15246983:18246,15113655:18247,15119266:18248,15119550:18249,15175862:18250,15179956:18251,15051142:18252,15187381:18253,15239853:18254,15312556:18255,14991283:18256,15055747:18257,15109021:18258,15109778:18259,15111575:18260,15113647:18261,15178627:18262,15174028:18263,15238028:18264,15237818:18265,15252649:18266,15304077:18267,15040653:18268,15048633:18269,15051410:18270,15114885:18271,15115699:18272,15173028:18273,15174589:18274,15250103:18275,15049650:18276,15250336:18277,15309226:18278,15302809:18279,15244735:18280,15181732:18281,15179687:18282,15241385:18283,14990511:18284,15042981:18285,15043994:18286,15109005:18287,15114127:18288,15119242:18289,15178173:18290,15183508:18291,15184533:18292,15239350:18293,15242884:18294,15253419:18295,15113117:18296,15121568:18297,15173766:18298,15186075:18299,15240875:18300,15312769:18301,15317670:18302,15042493:18465,15183537:18466,15180210:18467,15183544:18468,15237767:18469,15183240:18470,15117224:18471,15055265:18472,15237772:18473,15177105:18474,15177120:18475,15041963:18476,15305122:18477,15121036:18478,15178170:18479,15304343:18480,15313834:18481,14990480:18482,15187376:18483,15108764:18484,15183247:18485,15308453:18486,15315881:18487,15047098:18488,15049113:18489,15244196:18490,15309500:18491,14990516:18492,15042724:18493,15043978:18494,15044493:18495,15044507:18496,15054982:18497,15110316:18498,15111825:18499,15113663:18500,15118526:18501,15118734:18502,15174024:18503,15174319:18504,15175597:18505,15177108:18506,15186305:18507,15239340:18508,15243177:18509,15250089:18510,15183748:18511,15304582:18512,15173033:18513,15310994:18514,15311791:18515,15109309:18516,15112617:18517,15177130:18518,15178660:18519,15180688:18520,15242627:18521,15244206:18522,15043754:18523,15043985:18524,15044774:18525,15050371:18526,15055495:18527,15056316:18528,15106738:18529,15108489:18530,15108537:18531,15108779:18532,15111824:18533,15118228:18534,15119244:18535,15177394:18536,15178414:18537,15180433:18538,15181720:18539,15185803:18540,15187383:18541,15237797:18542,15245995:18543,15248057:18544,15250107:18545,15303103:18546,15310238:18547,15311771:18548,15116427:18549,15184056:18550,15041177:18551,15052990:18552,15056558:18553,15113863:18554,15118232:18555,15175861:18556,15178889:18557,15187598:18558,15318203:18721,15114122:18722,15181975:18723,15043769:18724,15177355:18725,15313837:18726,15056294:18727,15238813:18728,15241137:18729,15237784:18730,15056060:18731,15056773:18732,15177122:18733,15183238:18734,15302844:18735,15114663:18736,15050667:18737,15051419:18738,15185040:18739,15178174:18740,15248556:18741,14991285:18742,15056298:18743,15116441:18744,15118519:18745,15121538:18746,15176610:18747,15181224:18748,15245736:18749,15247765:18750,15249849:18751,15055775:18752,15110031:18753,15177605:18754,15181714:18755,15240087:18756,15305896:18757,15305650:18758,15241884:18759,15244205:18760,15315117:18761,15045505:18762,15056300:18763,15111820:18764,15119772:18765,15171733:18766,15250087:18767,15250323:18768,15311035:18769,15111567:18770,15176630:18771,14989453:18772,14990232:18773,15048608:18774,15049899:18775,15051174:18776,15052684:18777,15042216:18778,15054979:18779,15055516:18780,15106198:18781,15108534:18782,15111607:18783,15111847:18784,15112622:18785,15119790:18786,15173814:18787,15183014:18788,15238544:18789,15238810:18790,15239833:18791,15248796:18792,15250080:18793,15250342:18794,15250868:18795,15308956:18796,15309188:18797,14991022:18798,15110827:18799,15117734:18800,15239326:18801,15241633:18802,15242666:18803,15303592:18804,15052929:18805,15115667:18806,15311528:18807,15241658:18808,15242647:18809,14990479:18810,15042991:18811,15056553:18812,15055237:18813,15113357:18814,15181455:18977,15238585:18978,15246471:18979,15246982:18980,15120309:18981,15056023:18982,15108501:18983,15119032:18984,14990223:18985,15174057:18986,15314578:18987,15042694:18988,15044795:18989,15047092:18990,15049395:18991,15107748:18992,15108526:18993,15172762:18994,15050158:18995,15184521:18996,15184798:18997,15185051:18998,15309744:18999,15111815:19e3,15237534:19001,14989465:19002,14990773:19003,15041973:19004,15049088:19005,15055267:19006,15055283:19007,15056010:19008,15114116:19009,14989478:19010,15242429:19011,15308425:19012,15309211:19013,15184307:19014,15310977:19015,15041467:19016,15049601:19017,15178134:19018,15180455:19019,15042725:19020,15179429:19021,15242385:19022,15183494:19023,15040911:19024,15049865:19025,15174023:19026,15183751:19027,15185832:19028,15253178:19029,15253396:19030,15303053:19031,14991039:19032,15043465:19033,15050921:19034,15056001:19035,15310509:19036,14991261:19037,15239319:19038,15305642:19039,15047811:19040,15109525:19041,15117737:19042,15176875:19043,15246236:19044,15252628:19045,15182210:19046,15043487:19047,15049363:19048,15107477:19049,15108234:19050,15112878:19051,15118221:19052,15184063:19053,15241129:19054,15040675:19055,14991288:19056,15043717:19057,15044998:19058,15048881:19059,15050121:19060,15052445:19061,15053744:19062,15053743:19063,15053993:19064,15055510:19065,15108785:19066,15109543:19067,15111358:19068,15111865:19069,15113355:19070,15119253:19233,15119265:19234,15172537:19235,15179954:19236,15186091:19237,15238046:19238,15239859:19239,15241356:19240,15242156:19241,15244418:19242,15246482:19243,15247530:19244,15249802:19245,15303334:19246,15305618:19247,15311805:19248,15315891:19249,15316396:19250,14989711:19251,14989985:19252,15041165:19253,15042966:19254,15048074:19255,15050408:19256,15055037:19257,15056792:19258,15056793:19259,15108287:19260,15112884:19261,15113371:19262,15114128:19263,15115154:19264,15042194:19265,15185057:19266,15237802:19267,15238824:19268,15248512:19269,15250060:19270,15250111:19271,15305150:19272,15308978:19273,15044768:19274,15311020:19275,15043735:19276,15041429:19277,15043996:19278,15049384:19279,15110834:19280,15113396:19281,15174055:19282,15179174:19283,15182214:19284,15304614:19285,15043459:19286,15119009:19287,15117958:19288,15048832:19289,15055244:19290,15050132:19291,15113388:19292,15187899:19293,15042465:19294,15178630:19295,15110569:19296,15180712:19297,15314324:19298,15317691:19299,15048587:19300,15050425:19301,15112359:19302,15113882:19303,15118222:19304,15045545:19305,15116185:19306,15055253:19307,15238812:19308,15113877:19309,15314602:19310,15114174:19311,15315346:19312,15114653:19313,14989990:19314,14991267:19315,15044488:19316,15108793:19317,15113387:19318,15119019:19319,15253380:19320,14991021:19321,15186349:19322,15317695:19323,14989447:19324,15107490:19325,15121024:19326,15121579:19489,15242387:19490,15045043:19491,15113386:19492,15314309:19493,15054771:19494,15183509:19495,15053484:19496,15052678:19497,15244444:19498,15120778:19499,15242129:19500,15181972:19501,15238280:19502,15050393:19503,15184525:19504,15118481:19505,15178912:19506,15043481:19507,15049890:19508,15172769:19509,15174047:19510,15179675:19511,15309991:19512,15316385:19513,15115403:19514,15051199:19515,15050904:19516,15042213:19517,15044749:19518,15045053:19519,15112334:19520,15178655:19521,15253431:19522,15305368:19523,15315892:19524,15050666:19525,15174045:19526,15121285:19527,15041933:19528,15115145:19529,15185599:19530,15185836:19531,15310242:19532,15317690:19533,15110584:19534,15116449:19535,15240322:19536,15050372:19537,15052191:19538,15118235:19539,15174811:19540,15178674:19541,15185586:19542,15237271:19543,15241881:19544,15041714:19545,15113384:19546,15317913:19547,15178670:19548,15113634:19549,15043519:19550,15312005:19551,15052964:19552,15108283:19553,15184318:19554,15250096:19555,15046031:19556,15106742:19557,15185035:19558,15308416:19559,15043713:19560,14989727:19561,15042230:19562,15049884:19563,15173818:19564,15237302:19565,15304590:19566,15056037:19567,15179682:19568,15044228:19569,15056313:19570,15185028:19571,15242924:19572,15247539:19573,15252109:19574,15310230:19575,15114163:19576,15242926:19577,15307155:19578,15107209:19579,15107208:19580,15119033:19581,15178130:19582,15248301:19745,15252664:19746,15045807:19747,14990737:19748,15041706:19749,15043463:19750,15044491:19751,15052453:19752,15055293:19753,15106720:19754,15107714:19755,15110038:19756,15113353:19757,15114138:19758,15120807:19759,15120012:19760,15174838:19761,15174839:19762,15176881:19763,15181200:19764,15246229:19765,15248024:19766,15303050:19767,15303313:19768,15303605:19769,15309700:19770,15244941:19771,15049877:19772,14989960:19773,14990745:19774,14989454:19775,15248009:19776,15252671:19777,15310992:19778,15041197:19779,15055292:19780,15050390:19781,15052473:19782,15055544:19783,15110042:19784,15110074:19785,15111041:19786,15113116:19787,15115658:19788,15116184:19789,15119499:19790,15121078:19791,15173268:19792,15176872:19793,15182511:19794,15187594:19795,15237248:19796,15241609:19797,15242121:19798,15246977:19799,15248545:19800,15251594:19801,15303077:19802,15309245:19803,15312010:19804,15107518:19805,15108753:19806,15117490:19807,15118979:19808,15119796:19809,15187852:19810,15187900:19811,15120256:19812,15187589:19813,15244986:19814,15246264:19815,15113637:19816,15240881:19817,15311036:19818,15309751:19819,15119515:19820,15185313:19821,15241405:19822,15304106:19823,14989745:19824,15044021:19825,15054224:19826,15117444:19827,15122347:19828,15243149:19829,15243437:19830,15247015:19831,15042729:19832,15044751:19833,15053221:19834,15113614:19835,15114920:19836,15175814:19837,15176323:19838,15177634:20001,15246223:20002,15246241:20003,15304588:20004,15309730:20005,15309240:20006,15056523:20007,15175303:20008,15182731:20009,15241614:20010,15109792:20011,15177125:20012,15043209:20013,15119745:20014,15121052:20015,15175817:20016,15177113:20017,15180203:20018,15184530:20019,15309446:20020,15182748:20021,15318669:20022,14991030:20023,15107502:20024,15112069:20025,15243676:20026,14989958:20027,14989998:20028,15041434:20029,14989473:20030,15042444:20031,15052718:20032,15111833:20033,15114881:20034,15120060:20035,15174815:20036,15178114:20037,15179437:20038,15181980:20039,15184807:20040,15239599:20041,15248274:20042,15303100:20043,15304591:20044,15309237:20045,15311e3:20046,15043227:20047,15185809:20048,15040683:20049,15044248:20050,15113879:20051,15120267:20052,15173520:20053,15175859:20054,15239080:20055,15252650:20056,15309475:20057,15315351:20058,15317663:20059,15176096:20060,15049089:20061,15120025:20062,15185071:20063,15311262:20064,14990244:20065,14990518:20066,14990987:20067,15042231:20068,15043249:20069,15054522:20070,15106204:20071,15175346:20072,15180988:20073,15240083:20074,15304884:20075,15309495:20076,15309750:20077,15309962:20078,15317655:20079,15318434:20080,15112870:20081,15117748:20082,15042711:20083,15043235:20084,15172488:20085,15246210:20086,15055753:20087,15106443:20088,15107728:20089,15121571:20090,15173001:20091,15184062:20092,15185844:20093,15237551:20094,15242158:20257,15302819:20258,15305900:20259,15044994:20260,15314351:20261,15117203:20262,15172233:20263,15250306:20264,15251375:20265,15310002:20266,15043252:20267,15051137:20268,15055754:20269,15056004:20270,15113367:20271,15115708:20272,15115924:20273,15119786:20274,15121551:20275,15174050:20276,15174588:20277,15183789:20278,15237249:20279,15237566:20280,15244683:20281,15303566:20282,15041965:20283,15317651:20284,15181444:20285,15237771:20286,15305906:20287,15248278:20288,15040685:20289,15045260:20290,15247793:20291,15117738:20292,15250308:20293,15238279:20294,15106961:20295,15113888:20296,15316914:20297,14989977:20298,14989976:20299,15315088:20300,15247787:20301,15243137:20302,15242664:20303,15115392:20304,15120830:20305,15180439:20306,15238549:20307,15056012:20513,14989456:20514,14989461:20515,14989482:20516,14989489:20517,14989494:20518,14989500:20519,14989503:20520,14989698:20521,14989718:20522,14989720:20523,14989954:20524,14989957:20525,15249835:20526,14989962:20527,15239314:20528,15056013:20529,14989966:20530,14989982:20531,14989983:20532,14989984:20533,14989986:20534,1499e4:20535,14990003:20536,14990006:20537,14990222:20538,14990221:20539,14990212:20540,14990214:20541,14990210:20542,14990231:20543,14990238:20544,14990253:20545,14990239:20546,14990263:20547,14990473:20548,14990746:20549,14990512:20550,14990747:20551,14990749:20552,14990743:20553,14990727:20554,14990774:20555,14990984:20556,14990991:20557,14991e3:20558,14990779:20559,14990761:20560,14990768:20561,14990993:20562,14990767:20563,14990982:20564,14990998:20565,15041688:20566,14991252:20567,14991263:20568,14991246:20569,14991256:20570,14991259:20571,14991249:20572,14991258:20573,14991248:20574,14991268:20575,14991269:20576,15040666:20577,15040680:20578,15040660:20579,15040682:20580,15040677:20581,15040645:20582,14990492:20583,14991286:20584,15040673:20585,15040681:20586,15040684:20587,14991294:20588,14991279:20589,15040657:20590,15040646:20591,15040899:20592,15040903:20593,15113347:20594,15040917:20595,15040912:20596,15040904:20597,15040922:20598,15040918:20599,15040940:20600,15040952:20601,15041152:20602,15041178:20603,15041157:20604,15041204:20605,15041202:20606,15041417:20769,15041418:20770,15041203:20771,15041410:20772,15041430:20773,15041438:20774,15041445:20775,15041453:20776,15041443:20777,15041454:20778,15041465:20779,15041461:20780,15041673:20781,15041665:20782,15041666:20783,15041686:20784,15041685:20785,15041684:20786,15041690:20787,15041697:20788,15041722:20789,15041719:20790,15041724:20791,15041723:20792,15041727:20793,15041920:20794,15041938:20795,15041932:20796,15041940:20797,15041954:20798,15182776:20799,15041961:20800,15041962:20801,15041966:20802,15042176:20803,15042178:20804,15047576:20805,15042188:20806,15042185:20807,15042191:20808,15042193:20809,15042195:20810,15042197:20811,15042198:20812,15042212:20813,15042214:20814,15042210:20815,15042217:20816,15042218:20817,15042219:20818,15042227:20819,15042225:20820,15042226:20821,15042224:20822,15042229:20823,15042237:20824,15042437:20825,15042441:20826,15042459:20827,15042464:20828,15243669:20829,15042473:20830,15042477:20831,15042480:20832,15042485:20833,15042494:20834,15042692:20835,15042699:20836,15042708:20837,15042702:20838,15042727:20839,15042730:20840,15042734:20841,15042739:20842,15042745:20843,15042959:20844,15042948:20845,15042955:20846,15042956:20847,15042974:20848,15042964:20849,15042986:20850,15042996:20851,15042985:20852,15042995:20853,15043007:20854,15043005:20855,15043213:20856,15043220:20857,15043218:20858,15042993:20859,15043208:20860,15043217:20861,15253160:20862,15253159:21025,15043244:21026,15043245:21027,15043260:21028,15043253:21029,15043457:21030,15043469:21031,15043479:21032,15043486:21033,15043491:21034,15043494:21035,15311789:21036,15043488:21037,15043507:21038,15043509:21039,15043512:21040,15043513:21041,15043718:21042,15043720:21043,15176888:21044,15043725:21045,15043728:21046,15043727:21047,15043733:21048,15043738:21049,15043747:21050,15043759:21051,15043761:21052,15043763:21053,15043768:21054,15043968:21055,15043974:21056,15043973:21057,14989463:21058,15043977:21059,15043981:21060,15042454:21061,15043998:21062,15044009:21063,15044014:21064,15049880:21065,15044027:21066,15044023:21067,15044226:21068,15044246:21069,15044256:21070,15044262:21071,15044261:21072,15044270:21073,15044272:21074,15044278:21075,15044483:21076,15184018:21077,15309721:21078,15044511:21079,15113148:21080,15173550:21081,15044526:21082,15044520:21083,15044525:21084,15044538:21085,15044737:21086,15044797:21087,15044992:21088,15044780:21089,15044781:21090,15044796:21091,15044782:21092,15044790:21093,15044777:21094,15044765:21095,15045006:21096,15045263:21097,15045045:21098,15045262:21099,15045023:21100,15045041:21101,15045047:21102,15045040:21103,15045266:21104,15045051:21105,15045248:21106,15045046:21107,15045252:21108,15045264:21109,15045254:21110,15045511:21111,15045282:21112,15045304:21113,15045285:21114,15045292:21115,15045508:21116,15045512:21117,15045288:21118,15045291:21281,15045506:21282,15045284:21283,15045310:21284,15045308:21285,15045528:21286,15045541:21287,15045542:21288,15045775:21289,15045780:21290,15045565:21291,15045550:21292,15045549:21293,15045562:21294,15045538:21295,15045817:21296,15046016:21297,15046051:21298,15046028:21299,15045806:21300,15046044:21301,15046021:21302,15046038:21303,15046039:21304,15045816:21305,15045811:21306,15046045:21307,15046297:21308,15046272:21309,15045295:21310,15046282:21311,15046303:21312,15046075:21313,15046078:21314,15046296:21315,15046302:21316,15046318:21317,15046076:21318,15046275:21319,15046313:21320,15046279:21321,15046312:21322,15046554:21323,15046533:21324,15046559:21325,15046532:21326,15046556:21327,15046564:21328,15046548:21329,15046804:21330,15046583:21331,15046806:21332,15046590:21333,15046589:21334,15046811:21335,15046585:21336,15047054:21337,15047056:21338,15173535:21339,15046836:21340,15046838:21341,15046834:21342,15046840:21343,15047083:21344,15047076:21345,15046831:21346,15047084:21347,15047082:21348,15047302:21349,15047296:21350,15047306:21351,15047328:21352,15047316:21353,15047311:21354,15047333:21355,15047342:21356,15047350:21357,15047348:21358,15047554:21359,15047356:21360,15047553:21361,15047555:21362,15047552:21363,15047560:21364,15047566:21365,15047569:21366,15047571:21367,15047575:21368,15047598:21369,15047609:21370,15047808:21371,15047615:21372,15047812:21373,15047817:21374,15047816:21537,15047819:21538,15047821:21539,15047827:21540,15047832:21541,15047830:21542,15046535:21543,15047836:21544,15047846:21545,15047863:21546,15047864:21547,15048078:21548,15047867:21549,15048064:21550,15048079:21551,15048105:21552,15048576:21553,15048328:21554,15048097:21555,15048127:21556,15048329:21557,15048339:21558,15048352:21559,15048371:21560,15048356:21561,15048362:21562,15048368:21563,15048579:21564,15048582:21565,15048596:21566,15048594:21567,15048595:21568,15048842:21569,15048598:21570,15048611:21571,15048843:21572,15048857:21573,15048861:21574,15049138:21575,15048865:21576,15049122:21577,15049099:21578,15049136:21579,15118208:21580,15049106:21581,15048893:21582,15049145:21583,15049349:21584,15049401:21585,15049375:21586,15049387:21587,15049402:21588,15049630:21589,15049403:21590,15049400:21591,15049390:21592,15049605:21593,15049619:21594,15049617:21595,15049623:21596,15049625:21597,15049624:21598,15049637:21599,15049628:21600,15049636:21601,15049631:21602,15049647:21603,15049658:21604,15049657:21605,15049659:21606,15049660:21607,15049661:21608,15049858:21609,15049866:21610,15049872:21611,15049883:21612,15114918:21613,15049893:21614,15049900:21615,15049901:21616,15049906:21617,15049912:21618,15049918:21619,15182738:21620,15050133:21621,15050128:21622,15050126:21623,15050138:21624,15050136:21625,15050146:21626,15050144:21627,15050151:21628,15050156:21629,15050153:21630,15050168:21793,15050369:21794,15050397:21795,14990750:21796,14991019:21797,15050403:21798,15050418:21799,15050630:21800,15050664:21801,15050652:21802,15050381:21803,15050649:21804,15050650:21805,15050917:21806,15050911:21807,15050897:21808,15050908:21809,15050889:21810,15050906:21811,15051136:21812,15051180:21813,15051145:21814,15050933:21815,15050934:21816,15051170:21817,15051178:21818,15051418:21819,15051452:21820,15051454:21821,15051659:21822,15051650:21823,15051453:21824,15051683:21825,15051671:21826,15051686:21827,15051689:21828,15051670:21829,15051706:21830,15051707:21831,15051916:21832,15051915:21833,15051926:21834,15051954:21835,15051664:21836,15051946:21837,15051958:21838,15051966:21839,15052163:21840,15052165:21841,15052160:21842,15052177:21843,15052181:21844,15052186:21845,15052187:21846,15052197:21847,15052201:21848,15052208:21849,15052211:21850,15052213:21851,15052216:21852,15111816:21853,15052218:21854,15052416:21855,15052419:21856,15052454:21857,15052472:21858,15052675:21859,15052679:21860,15052681:21861,15052692:21862,15052688:21863,15052708:21864,15052710:21865,15052706:21866,15052702:21867,15052709:21868,15052715:21869,15052720:21870,15052726:21871,15052723:21872,15052933:21873,15052935:21874,15052936:21875,15052941:21876,15052947:21877,15052960:21878,15052962:21879,15052968:21880,15052984:21881,15052985:21882,15053185:21883,15053190:21884,15053198:21885,15053203:21886,15053200:22049,15053199:22050,15052209:22051,15053228:22052,15053230:22053,14989730:22054,15053238:22055,15053241:22056,15053452:22057,15053457:22058,15053460:22059,15050395:22060,15053483:22061,15053499:22062,15053494:22063,15053500:22064,15053495:22065,15053701:22066,15053502:22067,15053703:22068,15053721:22069,15053737:22070,15053757:22071,15053754:22072,15053741:22073,15054476:22074,15053738:22075,15053963:22076,15053973:22077,15053975:22078,15054236:22079,15053983:22080,15053979:22081,15053969:22082,15053972:22083,15053986:22084,15053978:22085,15053977:22086,15053976:22087,15054220:22088,15054226:22089,15054222:22090,15054219:22091,15054252:22092,15054259:22093,15054262:22094,15054471:22095,15054468:22096,15054466:22097,15054498:22098,15054493:22099,15054508:22100,15054510:22101,15054525:22102,15054480:22103,15054519:22104,15054524:22105,15054729:22106,15054733:22107,15054739:22108,15054738:22109,15054742:22110,15054747:22111,15054763:22112,15054770:22113,15054773:22114,15054987:22115,15055002:22116,15055001:22117,15054993:22118,15055003:22119,15055030:22120,15055031:22121,15055236:22122,15055235:22123,15055232:22124,15055246:22125,15055255:22126,15055252:22127,15055263:22128,15055266:22129,15055268:22130,15055239:22131,15055285:22132,15055286:22133,15055290:22134,15317692:22135,15055295:22136,15055520:22137,15055745:22138,15055746:22139,15055752:22140,15055760:22141,15055759:22142,15055766:22305,15055779:22306,15055773:22307,15055770:22308,15055771:22309,15055778:22310,15055777:22311,15055784:22312,15055785:22313,15055788:22314,15055793:22315,15055795:22316,15055792:22317,15055796:22318,15055800:22319,15055806:22320,15056003:22321,15056009:22322,15056285:22323,15056284:22324,15056011:22325,15056017:22326,15056022:22327,15056041:22328,15056045:22329,15056056:22330,15056257:22331,15056264:22332,15056268:22333,15056270:22334,15056047:22335,15056273:22336,15056278:22337,15056279:22338,15056281:22339,15056289:22340,15056301:22341,15056307:22342,15056311:22343,15056515:22344,15056514:22345,15056319:22346,15056522:22347,15056520:22348,15056529:22349,15056519:22350,15056542:22351,15056537:22352,15056536:22353,15056544:22354,15056552:22355,15056557:22356,15056572:22357,15056790:22358,15056827:22359,15056804:22360,15056824:22361,15056817:22362,15056797:22363,15106739:22364,15056831:22365,15106209:22366,15106464:22367,15106201:22368,15106192:22369,15106217:22370,15106190:22371,15106225:22372,15106203:22373,15106197:22374,15106219:22375,15106214:22376,15106191:22377,15106234:22378,15106458:22379,15106433:22380,15106474:22381,15106487:22382,15106463:22383,15106442:22384,15106438:22385,15106445:22386,15106467:22387,15106435:22388,15106468:22389,15106434:22390,15106476:22391,15106475:22392,15106457:22393,15106689:22394,15106701:22395,15106983:22396,15106691:22397,15106714:22398,15106692:22561,15106715:22562,15106710:22563,15106711:22564,15106706:22565,15106727:22566,15106699:22567,15106977:22568,15106744:22569,15106976:22570,15106963:22571,15106740:22572,15056816:22573,15106749:22574,15106950:22575,15106741:22576,15106968:22577,15107469:22578,15107221:22579,15107206:22580,15106998:22581,15106999:22582,15107200:22583,15106996:22584,15107002:22585,15107203:22586,15107233:22587,15107003:22588,15106993:22589,15107213:22590,15107214:22591,15107463:22592,15107262:22593,15107240:22594,15107239:22595,15107466:22596,15107263:22597,15107260:22598,15107244:22599,15107252:22600,15107261:22601,15107458:22602,15107460:22603,15107507:22604,15107511:22605,15107480:22606,15107481:22607,15107482:22608,15107499:22609,15107508:22610,15107503:22611,15107493:22612,15107505:22613,15107487:22614,15107485:22615,15107475:22616,15107509:22617,15107737:22618,15107734:22619,15107719:22620,15107756:22621,15107732:22622,15107738:22623,15107722:22624,15107729:22625,15107755:22626,15107758:22627,15107980:22628,15107978:22629,15107977:22630,15108023:22631,15107976:22632,15107971:22633,15107974:22634,15107770:22635,15107979:22636,15187385:22637,15107981:22638,15108006:22639,15108003:22640,15108022:22641,15108026:22642,15108020:22643,15108031:22644,15108029:22645,15108028:22646,15108030:22647,15108224:22648,15108232:22649,15108233:22650,15108237:22651,15108236:22652,15108244:22653,15108251:22654,15108254:22817,15108257:22818,15108266:22819,15108270:22820,15108272:22821,15108274:22822,15108275:22823,15108481:22824,15108494:22825,15108510:22826,15108515:22827,15108507:22828,15108512:22829,15108520:22830,15108540:22831,15108738:22832,15108745:22833,15108542:22834,15108754:22835,15108755:22836,15108758:22837,15109012:22838,15108739:22839,15108756:22840,15109015:22841,15109009:22842,15108795:22843,15109007:22844,15109055:22845,15108998:22846,15111060:22847,15109e3:22848,15109020:22849,15109004:22850,15109002:22851,15108994:22852,15108999:22853,15108763:22854,15109001:22855,15109260:22856,15109038:22857,15109041:22858,15109287:22859,15109250:22860,15109256:22861,15109039:22862,15109045:22863,15109520:22864,15109310:22865,15109517:22866,15110300:22867,15109519:22868,15109782:22869,15109774:22870,15109760:22871,15109803:22872,15109558:22873,15109795:22874,15109775:22875,15109769:22876,15109791:22877,15109813:22878,15109547:22879,15109545:22880,15109822:22881,15110057:22882,15110016:22883,15110022:22884,15110051:22885,15110025:22886,15110034:22887,15110070:22888,15110020:22889,15110294:22890,15110324:22891,15110278:22892,15110291:22893,15110310:22894,15110326:22895,15111325:22896,15110295:22897,15110312:22898,15110287:22899,15110567:22900,15110575:22901,15110582:22902,15110542:22903,15111338:22904,15110805:22905,15110803:22906,15110821:22907,15110825:22908,15110792:22909,15110844:22910,15111066:23073,15111058:23074,15111045:23075,15111047:23076,15110843:23077,15111064:23078,15111042:23079,15111089:23080,15111079:23081,15239305:23082,15111072:23083,15111073:23084,15108780:23085,15111075:23086,15111087:23087,15111340:23088,15111094:23089,15111092:23090,15111090:23091,15111098:23092,15111296:23093,15111101:23094,15111320:23095,15111324:23096,15111301:23097,15111332:23098,15111331:23099,15111339:23100,15111348:23101,15111349:23102,15111351:23103,15111350:23104,15111352:23105,15177099:23106,15111560:23107,15111574:23108,15111573:23109,15111565:23110,15111576:23111,15111582:23112,15111581:23113,15111602:23114,15111608:23115,15111810:23116,15111811:23117,15249034:23118,15111835:23119,15111839:23120,15111851:23121,15111863:23122,15112067:23123,15112070:23124,15112065:23125,15112068:23126,15112076:23127,15112082:23128,15112091:23129,15112089:23130,15112096:23131,15112097:23132,15112113:23133,15113650:23134,15112330:23135,15112323:23136,15112123:23137,15113651:23138,15112373:23139,15112374:23140,15112372:23141,15112348:23142,15112591:23143,15112580:23144,15112585:23145,15112577:23146,15112606:23147,15112605:23148,15112612:23149,15112615:23150,15112616:23151,15112607:23152,15112610:23153,15112624:23154,15112835:23155,15112840:23156,15112846:23157,15112841:23158,15112836:23159,15112856:23160,15112861:23161,15113089:23162,15112889:23163,15113097:23164,15112894:23165,15112892:23166,15113092:23329,15112888:23330,15113110:23331,15113114:23332,15113120:23333,15112383:23334,15113126:23335,15113129:23336,15113136:23337,15113141:23338,15113143:23339,15113359:23340,15113366:23341,15113374:23342,15113382:23343,15113383:23344,15310008:23345,15113390:23346,15113407:23347,15113398:23348,15113601:23349,15113400:23350,15113399:23351,15113606:23352,15113630:23353,15113632:23354,15113625:23355,15113635:23356,15113636:23357,15113865:23358,15113648:23359,15113897:23360,15113660:23361,15113642:23362,15113868:23363,15113867:23364,15113894:23365,15113889:23366,15113861:23367,15113911:23368,15114159:23369,15113908:23370,15114156:23371,15113907:23372,15114153:23373,15113912:23374,15114148:23375,15114142:23376,15114141:23377,15114146:23378,15114158:23379,15113913:23380,15114126:23381,15114118:23382,15114151:23383,15116956:23384,15114398:23385,15114630:23386,15114409:23387,15114624:23388,15114637:23389,15114418:23390,15114638:23391,15114931:23392,15114411:23393,15114649:23394,15114659:23395,15114679:23396,15114687:23397,15114911:23398,15114895:23399,15114925:23400,15114900:23401,15114909:23402,15114907:23403,15114883:23404,15116974:23405,15114937:23406,15114676:23407,15114933:23408,15114912:23409,15114938:23410,15115407:23411,15114893:23412,15114686:23413,15115393:23414,15115146:23415,15115400:23416,15115160:23417,15115426:23418,15115430:23419,15115169:23420,15115404:23421,15115149:23422,15115156:23585,15115175:23586,15115157:23587,15115446:23588,15115410:23589,15115396:23590,15115159:23591,15115171:23592,15115429:23593,15115193:23594,15115168:23595,15115183:23596,15115432:23597,15115434:23598,15115418:23599,15115427:23600,15115425:23601,15115142:23602,15115705:23603,15115703:23604,15115676:23605,15115704:23606,15115691:23607,15115668:23608,15115710:23609,15115694:23610,15115449:23611,15115700:23612,15115453:23613,15115673:23614,15115440:23615,15115681:23616,15115678:23617,15115677:23618,15115905:23619,15115690:23620,15115954:23621,15115950:23622,15116176:23623,15115967:23624,15116161:23625,15116179:23626,15115966:23627,15116174:23628,15052712:23629,15116170:23630,15116189:23631,15115963:23632,15116163:23633,15115943:23634,15116462:23635,15115921:23636,15115936:23637,15115932:23638,15115925:23639,15115956:23640,15116190:23641,15116200:23642,15116418:23643,15116443:23644,15116223:23645,15117450:23646,15116217:23647,15116210:23648,15116199:23649,15116421:23650,15115953:23651,15116446:23652,15116205:23653,15116436:23654,15116203:23655,15116426:23656,15116434:23657,15117185:23658,15116451:23659,15116435:23660,15116676:23661,15116428:23662,15116722:23663,15116470:23664,15116728:23665,15116679:23666,15116706:23667,15116697:23668,15116710:23669,15116680:23670,15116472:23671,15116450:23672,15116944:23673,15116941:23674,15116960:23675,15116932:23676,15116962:23677,15116963:23678,15116951:23841,15243415:23842,15116987:23843,15117187:23844,15117186:23845,15116984:23846,15116979:23847,15116972:23848,15117214:23849,15117201:23850,15117215:23851,15116970:23852,15117210:23853,15117226:23854,15117243:23855,15117445:23856,15243414:23857,15117242:23858,15117458:23859,15117462:23860,15314097:23861,15117471:23862,15117496:23863,15117495:23864,15178652:23865,15117497:23866,15311790:23867,15117703:23868,15117699:23869,15117705:23870,15117712:23871,15117721:23872,15117716:23873,15117723:23874,15117727:23875,15117729:23876,15117752:23877,15117753:23878,15117759:23879,15117952:23880,15117956:23881,15117955:23882,15117965:23883,15117976:23884,15117973:23885,15117982:23886,15117988:23887,15117994:23888,15117995:23889,15117999:23890,15118002:23891,15118001:23892,15118003:23893,15118007:23894,15118012:23895,15118214:23896,15118219:23897,15118227:23898,15118239:23899,15118252:23900,15118251:23901,15118259:23902,15118255:23903,15317694:23904,15118472:23905,15118483:23906,15118484:23907,15118491:23908,15118500:23909,15118499:23910,15118750:23911,15118741:23912,15118754:23913,15118762:23914,15118978:23915,15118989:23916,15119002:23917,15118977:23918,15119003:23919,15118782:23920,15118760:23921,15118771:23922,15118994:23923,15118992:23924,15119236:23925,15119281:23926,15119251:23927,15119037:23928,15119255:23929,15119237:23930,15119261:23931,15119022:23932,15119025:23933,15119038:23934,15119034:24097,15119259:24098,15119279:24099,15119257:24100,15119274:24101,15119519:24102,15245709:24103,15119542:24104,15119531:24105,15119549:24106,15119544:24107,15119513:24108,15119541:24109,15119539:24110,15119506:24111,15119500:24112,15119779:24113,15120019:24114,15119780:24115,15119770:24116,15119801:24117,15119769:24118,15120014:24119,15120021:24120,15122340:24121,15120005:24122,15120313:24123,15120533:24124,15120522:24125,15120053:24126,15120263:24127,15120294:24128,15120056:24129,15120262:24130,15120300:24131,15120286:24132,15120268:24133,15120296:24134,15120274:24135,15120261:24136,15120314:24137,15120281:24138,15120292:24139,15120277:24140,15120298:24141,15120302:24142,15120557:24143,15120814:24144,15120558:24145,15120537:24146,15120818:24147,15120799:24148,15120574:24149,15120547:24150,15120811:24151,15120555:24152,15120822:24153,15120781:24154,15120543:24155,15120771:24156,15120570:24157,15120782:24158,15120548:24159,15121343:24160,15120541:24161,15120568:24162,15121026:24163,15121066:24164,15121048:24165,15121289:24166,15121079:24167,15121299:24168,15121085:24169,15121071:24170,15121284:24171,15121074:24172,15121300:24173,15121301:24174,15121039:24175,15121061:24176,15121282:24177,15121055:24178,15121793:24179,15121553:24180,15171980:24181,15121324:24182,15121336:24183,15121342:24184,15121599:24185,15121330:24186,15121585:24187,15121327:24188,15121586:24189,15121292:24190,15121598:24353,15121555:24354,15121335:24355,15122054:24356,15121850:24357,15121848:24358,15122049:24359,15122048:24360,15121839:24361,15121819:24362,15122355:24363,15121837:24364,15122050:24365,15121852:24366,15121816:24367,15122062:24368,15122065:24369,15122306:24370,15121830:24371,15122099:24372,15122083:24373,15122081:24374,15122084:24375,15122105:24376,15122310:24377,15122090:24378,15122335:24379,15122325:24380,15122348:24381,15122324:24382,15122328:24383,15122353:24384,15122350:24385,15122331:24386,15171721:24387,15171723:24388,15122362:24389,15171729:24390,15171713:24391,15171727:24392,15122366:24393,15171739:24394,15171738:24395,15121844:24396,15171741:24397,15171736:24398,15171743:24399,15171760:24400,15171774:24401,15171762:24402,15171985:24403,15172003:24404,15172249:24405,15172242:24406,15172271:24407,15172529:24408,15172268:24409,15172280:24410,15172275:24411,15172270:24412,15172511:24413,15172491:24414,15172509:24415,15172505:24416,15172745:24417,15172541:24418,15172764:24419,15172761:24420,15173029:24421,15173013:24422,15173256:24423,15173030:24424,15173026:24425,15173004:24426,15173014:24427,15173036:24428,15173263:24429,15173563:24430,15173252:24431,15173269:24432,15173288:24433,15173292:24434,15173527:24435,15173305:24436,15173310:24437,15173522:24438,15173513:24439,15173524:24440,15173518:24441,15173536:24442,15173548:24443,15173543:24444,15173557:24445,15173564:24446,15173561:24609,15173567:24610,15173773:24611,15173776:24612,15173787:24613,15173800:24614,15173805:24615,15173804:24616,15173808:24617,15173810:24618,15173819:24619,15173820:24620,15173823:24621,15174016:24622,15174022:24623,15174027:24624,15174040:24625,15174068:24626,15174078:24627,15174274:24628,15174273:24629,15174279:24630,15174290:24631,15174294:24632,15174306:24633,15174311:24634,15174329:24635,15174322:24636,15174531:24637,15174534:24638,15174532:24639,15174542:24640,15174546:24641,15174562:24642,15174560:24643,15174561:24644,15174585:24645,15174583:24646,15040655:24647,15174807:24648,15174794:24649,15174812:24650,15174806:24651,15174813:24652,15174836:24653,15174831:24654,15174825:24655,15174821:24656,15174846:24657,15175054:24658,15175055:24659,15317912:24660,15175063:24661,15175082:24662,15175080:24663,15175088:24664,15175096:24665,15175093:24666,15175099:24667,15175098:24668,15175560:24669,15175347:24670,15175566:24671,15175355:24672,15175552:24673,15175589:24674,15175598:24675,15175582:24676,15176354:24677,15175813:24678,15176111:24679,15175845:24680,15175608:24681,15175858:24682,15175866:24683,15176085:24684,15175871:24685,15176095:24686,15176089:24687,15176065:24688,15176092:24689,15176105:24690,15176112:24691,15176099:24692,15176106:24693,15176118:24694,15176126:24695,15176331:24696,15176350:24697,15176359:24698,15176586:24699,15176591:24700,15176596:24701,15175601:24702,15176608:24865,15176611:24866,15176615:24867,15176617:24868,15176622:24869,15176626:24870,15176624:24871,15176625:24872,15176632:24873,15176631:24874,15176836:24875,15176835:24876,15176837:24877,15176844:24878,15176846:24879,15176845:24880,15176853:24881,15176851:24882,15176862:24883,15176870:24884,15176876:24885,15176892:24886,15177092:24887,15177101:24888,15177098:24889,15177097:24890,15177115:24891,15177094:24892,15177114:24893,15177129:24894,15177124:24895,15177127:24896,15177131:24897,15177133:24898,15177144:24899,15177142:24900,15177350:24901,15177351:24902,15177140:24903,15177354:24904,15177353:24905,15177346:24906,15177364:24907,15177370:24908,15177373:24909,15177381:24910,15177379:24911,15177602:24912,15177395:24913,15177603:24914,15177397:24915,15177405:24916,15177400:24917,15177404:24918,15177393:24919,15177613:24920,15177610:24921,15177618:24922,15177625:24923,15177635:24924,15177630:24925,15177662:24926,15177663:24927,15177660:24928,15177857:24929,15177648:24930,15177658:24931,15177650:24932,15177651:24933,15177867:24934,15177869:24935,15177865:24936,15177887:24937,15177895:24938,15177888:24939,15177889:24940,15177890:24941,15177892:24942,15177908:24943,15177904:24944,15177915:24945,15178119:24946,15178120:24947,15178118:24948,15178140:24949,15178136:24950,15178145:24951,15178146:24952,15178152:24953,15178153:24954,15178154:24955,15178151:24956,15178156:24957,15178160:24958,15178162:25121,15178166:25122,15178168:25123,15178172:25124,15178368:25125,15178371:25126,15178376:25127,15178379:25128,15178382:25129,15178390:25130,15178387:25131,15178393:25132,15178394:25133,15178416:25134,15178420:25135,15178424:25136,15178425:25137,15178426:25138,15178626:25139,15178637:25140,15178646:25141,15178642:25142,15178654:25143,15178657:25144,15178661:25145,15178663:25146,15178666:25147,15243439:25148,15178683:25149,15178888:25150,15178887:25151,15178884:25152,15178921:25153,15178916:25154,15178910:25155,15178917:25156,15178918:25157,15178907:25158,15178935:25159,15178936:25160,15179143:25161,15179162:25162,15179176:25163,15179179:25164,15179163:25165,15179173:25166,15179199:25167,15179198:25168,15179193:25169,15179406:25170,15179403:25171,15179409:25172,15179424:25173,15179422:25174,15179440:25175,15179446:25176,15179449:25177,15179455:25178,15179452:25179,15179453:25180,15179451:25181,15179655:25182,15179661:25183,15179671:25184,15179674:25185,15179676:25186,15179683:25187,15179694:25188,15179708:25189,15179916:25190,15179922:25191,15180966:25192,15179936:25193,15180970:25194,15180165:25195,15180430:25196,15180212:25197,15180422:25198,15180220:25199,15180442:25200,15180428:25201,15180451:25202,15180469:25203,15180458:25204,15180463:25205,15180689:25206,15180678:25207,15180683:25208,15180692:25209,15180478:25210,15180476:25211,15180677:25212,15180682:25213,15180716:25214,15180711:25377,15180698:25378,15180733:25379,15180724:25380,15180935:25381,15180946:25382,15180945:25383,15180953:25384,15180972:25385,15180971:25386,15181184:25387,15181216:25388,15181207:25389,15181215:25390,15181210:25391,15181205:25392,15181203:25393,15181242:25394,15181247:25395,15181450:25396,15181469:25397,15181479:25398,15318411:25399,15181482:25400,15181486:25401,15181491:25402,15181497:25403,15181498:25404,15181705:25405,15181717:25406,15181735:25407,15181740:25408,15181729:25409,15181731:25410,15181960:25411,15181965:25412,15181976:25413,15181977:25414,15181984:25415,15181983:25416,15181440:25417,15182001:25418,15182011:25419,15182014:25420,15182007:25421,15182211:25422,15182231:25423,15182217:25424,15182241:25425,15182242:25426,15182249:25427,15318685:25428,15182256:25429,15182265:25430,15182269:25431,15182472:25432,15182487:25433,15182485:25434,15182488:25435,15182486:25436,15182505:25437,15182728:25438,15182512:25439,15182518:25440,15182725:25441,15182724:25442,15182527:25443,15303299:25444,15182727:25445,15182730:25446,15182733:25447,15182735:25448,15182741:25449,15182739:25450,15182745:25451,15182746:25452,15182749:25453,15182753:25454,15182754:25455,15182758:25456,15182765:25457,15182768:25458,15182978:25459,15182991:25460,15182986:25461,15182982:25462,15183027:25463,15183e3:25464,15183001:25465,15183006:25466,15183029:25467,15183016:25468,15183030:25469,15183248:25470,15183290:25633,15182980:25634,15183245:25635,15182987:25636,15183244:25637,15183237:25638,15183285:25639,15183269:25640,15183284:25641,15183271:25642,15183280:25643,15183281:25644,15183276:25645,15183278:25646,15183517:25647,15183512:25648,15183519:25649,15183501:25650,15183516:25651,15183514:25652,15183499:25653,15183506:25654,15183503:25655,15183261:25656,15183513:25657,15183755:25658,15183745:25659,15183756:25660,15183759:25661,15183540:25662,15183750:25663,15183773:25664,15183785:25665,15184017:25666,15184020:25667,15183782:25668,15183781:25669,15184288:25670,15184e3:25671,15184007:25672,15184019:25673,15183795:25674,15183799:25675,15184023:25676,15184013:25677,15183798:25678,15184035:25679,15184039:25680,15184042:25681,15184031:25682,15184055:25683,15184043:25684,15184061:25685,15184268:25686,15184259:25687,15184276:25688,15184271:25689,15184256:25690,15184272:25691,15184280:25692,15184287:25693,15184292:25694,15184278:25695,15184293:25696,15184300:25697,15184309:25698,15184515:25699,15184528:25700,15184548:25701,15184557:25702,15184546:25703,15184555:25704,15184545:25705,15184552:25706,15184563:25707,15184562:25708,15184561:25709,15184558:25710,15184569:25711,15184573:25712,15184768:25713,15184773:25714,15184770:25715,15184792:25716,15184786:25717,15184796:25718,15184802:25719,15314107:25720,15184815:25721,15184818:25722,15184820:25723,15184822:25724,15184826:25725,15185030:25726,15185026:25889,15185052:25890,15185045:25891,15185034:25892,15185285:25893,15185291:25894,15185070:25895,15185074:25896,15185087:25897,15185077:25898,15185286:25899,15185331:25900,15185302:25901,15185294:25902,15185330:25903,15185320:25904,15185326:25905,15185295:25906,15185315:25907,15185555:25908,15185545:25909,15185307:25910,15185551:25911,15185341:25912,15185563:25913,15185594:25914,15185582:25915,15185571:25916,15185589:25917,15185799:25918,15185597:25919,15185579:25920,15186109:25921,15185570:25922,15185583:25923,15185820:25924,15185592:25925,15185567:25926,15185584:25927,15185816:25928,15185821:25929,15185828:25930,15185822:25931,15185851:25932,15185842:25933,15185825:25934,15186053:25935,15186058:25936,15186083:25937,15186081:25938,15186066:25939,15186097:25940,15186079:25941,15186057:25942,15186059:25943,15186082:25944,15186310:25945,15186342:25946,15186107:25947,15186101:25948,15186105:25949,15186307:25950,15186103:25951,15186098:25952,15186106:25953,15186343:25954,15186333:25955,15186326:25956,15186334:25957,15186329:25958,15186330:25959,15186361:25960,15186346:25961,15186345:25962,15186364:25963,15186363:25964,15186563:25965,15185813:25966,15186365:25967,15253166:25968,15186367:25969,15186568:25970,15186569:25971,15186572:25972,15186578:25973,15186576:25974,15186579:25975,15186580:25976,15186582:25977,15186574:25978,15186587:25979,15186588:25980,15187128:25981,15187130:25982,15187333:26145,15187340:26146,15187341:26147,15187342:26148,15187344:26149,15187345:26150,15187349:26151,15187348:26152,15187352:26153,15187359:26154,15187360:26155,15187368:26156,15187369:26157,15187367:26158,15187384:26159,15187586:26160,15187590:26161,15187587:26162,15187592:26163,15187591:26164,15187596:26165,15187604:26166,15187614:26167,15187613:26168,15187610:26169,15187619:26170,15187631:26171,15187634:26172,15187641:26173,15187630:26174,15187638:26175,15187640:26176,15248817:26177,15187845:26178,15187846:26179,15187850:26180,15187861:26181,15187860:26182,15187873:26183,15187878:26184,15187881:26185,15187891:26186,15187897:26187,15311772:26188,15237254:26189,15237252:26190,15237259:26191,15237266:26192,15237272:26193,15237273:26194,15237276:26195,15237281:26196,15237288:26197,15237311:26198,15237307:26199,15237514:26200,15237510:26201,15237522:26202,15237528:26203,15237530:26204,15237535:26205,15237538:26206,15237544:26207,15237555:26208,15237554:26209,15237552:26210,15237558:26211,15237561:26212,15237565:26213,15237567:26214,15237764:26215,15237766:26216,15237765:26217,15237787:26218,15237779:26219,15237786:26220,15237805:26221,15042192:26222,15237804:26223,15238043:26224,15238053:26225,15238041:26226,15238045:26227,15238020:26228,15238042:26229,15238038:26230,15238281:26231,15238063:26232,15238065:26233,15238299:26234,15238313:26235,15238307:26236,15238319:26237,15238539:26238,15309451:26401,15238534:26402,15238334:26403,15238547:26404,15238545:26405,15238076:26406,15238577:26407,15238574:26408,15238565:26409,15238566:26410,15238580:26411,15238787:26412,15238792:26413,15238794:26414,15238784:26415,15238786:26416,15238816:26417,15238805:26418,15238820:26419,15238819:26420,15238559:26421,15238803:26422,15238825:26423,15238832:26424,15238837:26425,15238846:26426,15238840:26427,15238845:26428,15239040:26429,15239042:26430,15238842:26431,15239049:26432,15239053:26433,15239057:26434,15239065:26435,15239064:26436,15239048:26437,15239066:26438,15239071:26439,15239072:26440,15239079:26441,15239098:26442,15239099:26443,15239102:26444,15239297:26445,15239298:26446,15239301:26447,15239303:26448,15239306:26449,15239309:26450,15239312:26451,15239318:26452,15239337:26453,15239339:26454,15239352:26455,15239347:26456,15239552:26457,15239577:26458,15239576:26459,15239581:26460,15239578:26461,15239583:26462,15239588:26463,15239586:26464,15239592:26465,15239594:26466,15239595:26467,15239342:26468,15239601:26469,15239607:26470,15239608:26471,15239614:26472,15239821:26473,15239826:26474,15239851:26475,15239839:26476,15239867:26477,15239852:26478,15240097:26479,15240099:26480,15240095:26481,15240082:26482,15240116:26483,15240115:26484,15240122:26485,15240851:26486,15240323:26487,15240123:26488,15240121:26489,15240094:26490,15240326:26491,15240092:26492,15240329:26493,15240089:26494,15240373:26657,15240372:26658,15240342:26659,15240370:26660,15240369:26661,15240576:26662,15240377:26663,15240592:26664,15240581:26665,15240367:26666,15240363:26667,15240343:26668,15240344:26669,15240837:26670,15240858:26671,15240874:26672,15240863:26673,15240866:26674,15240854:26675,15240355:26676,15240846:26677,15240839:26678,15240842:26679,15240636:26680,15240885:26681,15240627:26682,15240629:26683,15240864:26684,15240841:26685,15240872:26686,15241140:26687,15241363:26688,15241131:26689,15241102:26690,15241149:26691,15241347:26692,15241112:26693,15241355:26694,15241089:26695,15241143:26696,15241351:26697,15241120:26698,15241138:26699,15241357:26700,15241378:26701,15241376:26702,15240893:26703,15241400:26704,15242374:26705,15241147:26706,15241645:26707,15241386:26708,15241404:26709,15242650:26710,15241860:26711,15241655:26712,15241643:26713,15241901:26714,15241646:26715,15241858:26716,15241641:26717,15241606:26718,15241388:26719,15241647:26720,15241657:26721,15241397:26722,15242122:26723,15241634:26724,15241913:26725,15241919:26726,15241887:26727,15242137:26728,15242125:26729,15241915:26730,15242138:26731,15242128:26732,15242113:26733,15242118:26734,15242134:26735,15241889:26736,15242401:26737,15242175:26738,15242164:26739,15242391:26740,15242392:26741,15242412:26742,15242399:26743,15242389:26744,15242388:26745,15242172:26746,15242624:26747,15242659:26748,15242648:26749,15242632:26750,15242625:26913,15243394:26914,15242635:26915,15242645:26916,15242880:26917,15242916:26918,15242888:26919,15242897:26920,15242890:26921,15242920:26922,15242669:26923,15242900:26924,15242907:26925,15243178:26926,15242887:26927,15242908:26928,15242679:26929,15242686:26930,15242896:26931,15243145:26932,15242938:26933,15243151:26934,15242937:26935,15243152:26936,15243157:26937,15243165:26938,15243173:26939,15243164:26940,15243193:26941,15243402:26942,15243411:26943,15243403:26944,15243198:26945,15243194:26946,15243398:26947,15243426:26948,15243418:26949,15243440:26950,15243455:26951,15243661:26952,14989717:26953,15243668:26954,15243679:26955,15243687:26956,15243697:26957,15243923:26958,15243939:26959,15243945:26960,15243946:26961,15243915:26962,15243916:26963,15243958:26964,15243951:26965,15244164:26966,15244166:26967,15243952:26968,15244169:26969,15245475:26970,15243947:26971,15244180:26972,15244190:26973,15244201:26974,15244204:26975,15244191:26976,15244187:26977,15244207:26978,15244434:26979,15244422:26980,15244424:26981,15244416:26982,15244419:26983,15244219:26984,15244433:26985,15244425:26986,15244429:26987,15244217:26988,15244426:26989,15244468:26990,15244479:26991,15244471:26992,15244475:26993,15244453:26994,15244457:26995,15244442:26996,15244704:26997,15244703:26998,15244728:26999,15244684:27e3,15244686:27001,15244724:27002,15244695:27003,15244712:27004,15244718:27005,15244697:27006,15244691:27169,15244707:27170,15244714:27171,15245445:27172,15244962:27173,15244959:27174,15244930:27175,15244975:27176,15245195:27177,15244989:27178,15245184:27179,15245200:27180,15309718:27181,15244971:27182,15245188:27183,15244979:27184,15245191:27185,15245190:27186,15244987:27187,15245231:27188,15245234:27189,15245216:27190,15245455:27191,15245453:27192,15245246:27193,15245238:27194,15245239:27195,15245454:27196,15245202:27197,15245457:27198,15245462:27199,15245461:27200,15245474:27201,15245473:27202,15245489:27203,15245494:27204,15245497:27205,15245479:27206,15245499:27207,15245700:27208,15245698:27209,15245714:27210,15245721:27211,15245726:27212,15245730:27213,15245739:27214,15245953:27215,15245758:27216,15245982:27217,15245749:27218,15245757:27219,15246005:27220,15245746:27221,15245954:27222,15245975:27223,15245970:27224,15245998:27225,15245977:27226,15245986:27227,15245965:27228,15245988:27229,15246e3:27230,15246015:27231,15246001:27232,15246211:27233,15246212:27234,15246228:27235,15246232:27236,15246233:27237,15246237:27238,15246265:27239,15246466:27240,15246268:27241,15246260:27242,15246248:27243,15246258:27244,15246468:27245,15246476:27246,15246474:27247,15246483:27248,15246723:27249,15246494:27250,15246501:27251,15246506:27252,15246507:27253,15246721:27254,15246724:27255,15246523:27256,15246518:27257,15246520:27258,15246732:27259,15246493:27260,15246752:27261,15246750:27262,15246758:27425,15246756:27426,15246765:27427,15246762:27428,15246767:27429,15246772:27430,15246775:27431,15246782:27432,15246979:27433,15246984:27434,15246986:27435,15246995:27436,15247e3:27437,15247009:27438,15247017:27439,15247014:27440,15247020:27441,15247023:27442,15247026:27443,15247034:27444,15247037:27445,15247039:27446,15247232:27447,15247258:27448,15247260:27449,15247261:27450,15247271:27451,15247284:27452,15247288:27453,15247491:27454,15247510:27455,15247504:27456,15247500:27457,15247515:27458,15247517:27459,15247525:27460,15247542:27461,15247745:27462,15247771:27463,15247762:27464,15247750:27465,15247752:27466,15247804:27467,15247789:27468,15247788:27469,15247778:27470,15248005:27471,15248002:27472,15248004:27473,15248040:27474,15248033:27475,15248017:27476,15248037:27477,15248038:27478,15248026:27479,15248035:27480,15248260:27481,15248269:27482,15248258:27483,15248282:27484,15248299:27485,15248307:27486,15248295:27487,15248292:27488,15248305:27489,15248532:27490,15248288:27491,15248290:27492,15248311:27493,15248286:27494,15248283:27495,15248524:27496,15248519:27497,15248538:27498,15248289:27499,15248534:27500,15248528:27501,15248535:27502,15248544:27503,15248563:27504,15310507:27505,15248550:27506,15248555:27507,15248574:27508,15248552:27509,15248769:27510,15248780:27511,15248783:27512,15248782:27513,15248777:27514,15248790:27515,15248795:27516,15248794:27517,15248811:27518,15248799:27681,15248812:27682,15248815:27683,15248820:27684,15248829:27685,15249024:27686,15249036:27687,15249038:27688,15249042:27689,15249043:27690,15249046:27691,15249049:27692,15249050:27693,15249594:27694,15249793:27695,15249599:27696,15249800:27697,15249804:27698,15249806:27699,15249808:27700,15249813:27701,15249826:27702,15249836:27703,15249848:27704,15249850:27705,15250050:27706,15250057:27707,15250053:27708,15250058:27709,15250061:27710,15250062:27711,15250068:27712,15249852:27713,15250072:27714,15108253:27715,15250093:27716,15250090:27717,15250109:27718,15250098:27719,15250099:27720,15250094:27721,15250102:27722,15250312:27723,15250305:27724,15250340:27725,15250339:27726,15250330:27727,15250365:27728,15250362:27729,15250363:27730,15250564:27731,15250565:27732,15250570:27733,15250567:27734,15250575:27735,15250573:27736,15250576:27737,15318414:27738,15250579:27739,15250317:27740,15250580:27741,15250582:27742,15250855:27743,15250861:27744,15250865:27745,15250867:27746,15251073:27747,15251097:27748,15251330:27749,15251134:27750,15251130:27751,15251343:27752,15251354:27753,15251350:27754,15251340:27755,15251355:27756,15251339:27757,15251370:27758,15251371:27759,15251359:27760,15251363:27761,15251388:27762,15251592:27763,15251593:27764,15251391:27765,15251613:27766,15251614:27767,15251600:27768,15251615:27769,15251842:27770,15251637:27771,15251632:27772,15251636:27773,15251850:27774,15251847:27937,15251849:27938,15251852:27939,15251856:27940,15251848:27941,15251865:27942,15251876:27943,15251872:27944,15251626:27945,15251875:27946,15251861:27947,15251894:27948,15251890:27949,15251900:27950,15252097:27951,15252103:27952,15252101:27953,15252100:27954,15252107:27955,15252106:27956,15252115:27957,15252113:27958,15252116:27959,15252121:27960,15252138:27961,15252129:27962,15252140:27963,15252144:27964,15252358:27965,15252145:27966,15252158:27967,15252357:27968,15252360:27969,15252363:27970,15252379:27971,15252387:27972,15252412:27973,15252411:27974,15252395:27975,15252414:27976,15252618:27977,15252613:27978,15252629:27979,15252626:27980,15252633:27981,15252627:27982,15252636:27983,15252639:27984,15252635:27985,15252620:27986,15252646:27987,15252659:27988,15252667:27989,15252665:27990,15252869:27991,15252866:27992,15252670:27993,15252876:27994,15252873:27995,15252870:27996,15252878:27997,15252887:27998,15252892:27999,15252898:28e3,15252899:28001,15252900:28002,15253148:28003,15253151:28004,15253155:28005,15253165:28006,15253167:28007,15253175:28008,15253402:28009,15253413:28010,15253410:28011,15253418:28012,15253423:28013,15303303:28014,15253428:28015,15302789:28016,15253433:28017,15253434:28018,15302801:28019,15302805:28020,15302817:28021,15302797:28022,15302814:28023,15302806:28024,15302795:28025,15302823:28026,15302838:28027,15302837:28028,15302841:28029,15253432:28030,15303055:28193,15303056:28194,15303057:28195,15303058:28196,15302798:28197,15303049:28198,15302846:28199,15303062:28200,15303064:28201,15303070:28202,15303080:28203,15303087:28204,15303094:28205,15309480:28206,15303090:28207,15303298:28208,15303101:28209,15303297:28210,15303296:28211,15303306:28212,15303305:28213,15303311:28214,15303336:28215,15303343:28216,15303345:28217,15303349:28218,15303586:28219,15303588:28220,15108488:28221,15303579:28222,15303810:28223,15303826:28224,15303833:28225,15303858:28226,15303856:28227,15304074:28228,15304086:28229,15304088:28230,15304099:28231,15304101:28232,15304105:28233,15304115:28234,15304114:28235,15304331:28236,15304329:28237,15304322:28238,15304354:28239,15304363:28240,15304367:28241,15304362:28242,15304373:28243,15304372:28244,15304378:28245,15304576:28246,15304577:28247,15304585:28248,15304587:28249,15304592:28250,15304598:28251,15304607:28252,15304609:28253,15304603:28254,15304636:28255,15304629:28256,15304630:28257,15304862:28258,15304639:28259,15304852:28260,15304876:28261,15304853:28262,15304849:28263,15305118:28264,15305111:28265,15305093:28266,15305097:28267,15305124:28268,15305096:28269,15305365:28270,15304895:28271,15305099:28272,15305104:28273,15305372:28274,15305366:28275,15305363:28276,15305371:28277,15305114:28278,15305615:28279,15305401:28280,15305399:28281,15305641:28282,15305871:28283,15305658:28284,15306116:28285,15305902:28286,15305881:28449,15305890:28450,15305882:28451,15305891:28452,15305914:28453,15305909:28454,15305915:28455,15306140:28456,15306144:28457,15306172:28458,15306158:28459,15306134:28460,15306416:28461,15306412:28462,15306413:28463,15306388:28464,15306425:28465,15306646:28466,15306647:28467,15306664:28468,15306661:28469,15306648:28470,15306627:28471,15306653:28472,15306640:28473,15306632:28474,15306660:28475,15306906:28476,15306900:28477,15306899:28478,15306883:28479,15306887:28480,15306896:28481,15306934:28482,15306923:28483,15306933:28484,15306913:28485,15306938:28486,15307137:28487,15307154:28488,15307140:28489,15307163:28490,15307168:28491,15307170:28492,15307166:28493,15307178:28494,15304873:28495,15307184:28496,15307189:28497,15307191:28498,15307197:28499,15307162:28500,15307196:28501,15307198:28502,15307393:28503,15307199:28504,15308418:28505,15308423:28506,15308426:28507,15308436:28508,15308438:28509,15308440:28510,15308441:28511,15308448:28512,15308456:28513,15308455:28514,15308461:28515,15308476:28516,15308475:28517,15308473:28518,15308478:28519,15308682:28520,15122358:28521,15308675:28522,15308685:28523,15308684:28524,15308693:28525,15308692:28526,15308694:28527,15308700:28528,15308705:28529,15308709:28530,15308706:28531,15308961:28532,15308968:28533,15308974:28534,15308975:28535,15309186:28536,15309196:28537,15309199:28538,15309195:28539,15309239:28540,15309212:28541,15309214:28542,15309213:28705,15309215:28706,15309222:28707,15309234:28708,15309228:28709,15309453:28710,15309464:28711,15309461:28712,15309463:28713,15309482:28714,15309479:28715,15309489:28716,15309490:28717,15309488:28718,15309492:28719,15309494:28720,15309496:28721,15309497:28722,15309710:28723,15309707:28724,15309705:28725,15309709:28726,15246733:28727,15309724:28728,15309965:28729,15309717:28730,15309753:28731,15309956:28732,15309958:28733,15309960:28734,15309971:28735,15309966:28736,15309969:28737,15309967:28738,15309974:28739,15309977:28740,15309988:28741,15309994:28742,1531e4:28743,15310009:28744,15310013:28745,15310014:28746,15310212:28747,15310214:28748,15310216:28749,15310210:28750,15310217:28751,15310236:28752,15310240:28753,15310244:28754,15310246:28755,15310248:28756,15043474:28757,15310251:28758,15310257:28759,15310265:28760,15310469:28761,15310268:28762,15310465:28763,15310266:28764,15310470:28765,15310475:28766,15310479:28767,15310480:28768,15310492:28769,15310504:28770,15310502:28771,15310499:28772,15310515:28773,15310516:28774,15310723:28775,15310726:28776,15310728:28777,15310731:28778,15310748:28779,15310765:28780,15318415:28781,15310770:28782,15182751:28783,15310774:28784,15310773:28785,15310991:28786,15310988:28787,15311032:28788,15311012:28789,15311009:28790,15311031:28791,15311037:28792,15311238:28793,15311247:28794,15311243:28795,15311275:28796,15311279:28797,15311280:28798,15311281:28961,15311284:28962,15311283:28963,15311530:28964,15311535:28965,15311537:28966,15311542:28967,15311748:28968,15311747:28969,15311750:28970,15311785:28971,15311787:28972,15312003:28973,15312009:28974,15312018:28975,15312020:28976,15312024:28977,15312033:28978,15312029:28979,15312030:28980,15312036:28981,15312032:28982,15312044:28983,15312046:28984,15312061:28985,15312062:28986,15312258:28987,15312265:28988,15312261:28989,15312272:28990,15312267:28991,15312273:28992,15312274:28993,15312268:28994,15312277:28995,15312535:28996,15312536:28997,15312549:28998,15312557:28999,15312558:29e3,15312572:29001,15312799:29002,15312795:29003,15312797:29004,15312792:29005,15312785:29006,15312813:29007,15312814:29008,15312817:29009,15312818:29010,15312827:29011,15312824:29012,15313025:29013,15313039:29014,15313029:29015,15312802:29016,15313049:29017,15313067:29018,15313079:29019,15313285:29020,15313282:29021,15313280:29022,15313283:29023,15313086:29024,15313301:29025,15313293:29026,15313307:29027,15313303:29028,15313311:29029,15313314:29030,15313317:29031,15313316:29032,15313321:29033,15313323:29034,15313322:29035,15313581:29036,15313584:29037,15313596:29038,15313792:29039,15313807:29040,15313809:29041,15313811:29042,15313812:29043,15313822:29044,15313823:29045,15313826:29046,15313827:29047,15313830:29048,15313839:29049,15313835:29050,15313838:29051,15313844:29052,15313841:29053,15313847:29054,15313851:29217,15314054:29218,15314072:29219,15314074:29220,15314079:29221,15314082:29222,15314083:29223,15314085:29224,15314087:29225,15314088:29226,15314089:29227,15314090:29228,15314094:29229,15314095:29230,15314098:29231,15314308:29232,15314307:29233,15314319:29234,15314317:29235,15314318:29236,15314321:29237,15314328:29238,15314356:29239,15314579:29240,15314563:29241,15314577:29242,15314582:29243,15314583:29244,15314591:29245,15314592:29246,15314600:29247,15314612:29248,15314816:29249,15314826:29250,15314617:29251,15314822:29252,15314831:29253,15314833:29254,15314834:29255,15314851:29256,15314850:29257,15314852:29258,15314836:29259,15314849:29260,15315130:29261,15314866:29262,15314865:29263,15314864:29264,15315093:29265,15315092:29266,15315081:29267,15315091:29268,15315084:29269,15315078:29270,15315080:29271,15315090:29272,15315082:29273,15315076:29274,15315118:29275,15315099:29276,15315109:29277,15315108:29278,15315105:29279,15315120:29280,15315335:29281,15315122:29282,15315334:29283,15315134:29284,15315354:29285,15315360:29286,15315367:29287,15315382:29288,15315384:29289,15315879:29290,15315884:29291,15315888:29292,15316105:29293,15316104:29294,15315883:29295,15316099:29296,15316102:29297,15316138:29298,15316134:29299,15316655:29300,15316131:29301,15316127:29302,15316356:29303,15316117:29304,15316114:29305,15316353:29306,15316159:29307,15316158:29308,15316358:29309,15316360:29310,15316381:29473,15316382:29474,15316388:29475,15316369:29476,15316368:29477,15316377:29478,15316402:29479,15316617:29480,15316615:29481,15316651:29482,15316399:29483,15316410:29484,15316634:29485,15316644:29486,15316649:29487,15316658:29488,15316868:29489,15316865:29490,15316667:29491,15316664:29492,15316666:29493,15316870:29494,15316879:29495,15316866:29496,15316889:29497,15316883:29498,15316920:29499,15316902:29500,15316909:29501,15316911:29502,15316925:29503,15317146:29504,15317147:29505,15317150:29506,15317429:29507,15317433:29508,15317437:29509,15317633:29510,15317640:29511,15317643:29512,15317644:29513,15317650:29514,15317653:29515,15317649:29516,15317661:29517,15317669:29518,15317673:29519,15317688:29520,15317674:29521,15317677:29522,15310241:29523,15317900:29524,15317902:29525,15317903:29526,15317904:29527,15317908:29528,15317916:29529,15317918:29530,15317917:29531,15317920:29532,15317925:29533,15317928:29534,15317935:29535,15317940:29536,15317942:29537,15317943:29538,15317945:29539,15317947:29540,15317948:29541,15317949:29542,15318151:29543,15318152:29544,15178423:29545,15318165:29546,15318177:29547,15318188:29548,15318206:29549,15318410:29550,15318418:29551,15318420:29552,15318435:29553,15318431:29554,15318432:29555,15318433:29556,15318438:29557,15318439:29558,15318444:29559,15318442:29560,15318455:29561,15318450:29562,15318454:29563,15318677:29564,15318684:29565,15318688:29566,15048879:29729,15116167:29730,15303065:29731,15176100:29732,15042460:29733,15173273:29734,15186570:31009,15246492:31010,15306120:31011,15305352:31012,15242140:31013,14991241:31014,15172283:31015,15112369:31016,15115144:31017,15305657:31018,15113147:31019,15056261:31020,14989480:31021,14990241:31022,14990268:31023,14990464:31024,14990467:31025,14990521:31026,14990742:31027,14990994:31028,14990986:31029,14991002:31030,14990996:31031,14991245:31032,15040896:31033,15040674:31034,14991295:31035,15040670:31036,15040902:31037,15040944:31038,15040898:31039,15041172:31040,15041460:31041,15041432:31042,15041930:31043,15041956:31044,15042205:31045,15042238:31046,15042476:31047,15042709:31048,15043228:31049,15043238:31050,15043456:31051,15043483:31052,15043712:31053,15043719:31054,15043748:31055,15044018:31056,15044243:31057,15044274:31058,15044509:31059,15706254:31060,15045276:31061,15045258:31062,15045289:31063,15045567:31064,15046278:31065,15048089:31066,15048101:31067,15048364:31068,15048584:31069,15048583:31070,15706255:31071,15706256:31072,15049374:31073,15049394:31074,15049867:31075,15050131:31076,15050139:31077,15050141:31078,15050147:31079,15050404:31080,15050426:31081,15052182:31082,15052672:31083,15176879:31084,15052696:31085,15052716:31086,15052958:31087,15053478:31088,15053498:31089,15053749:31090,15053991:31091,15054227:31092,15706257:31093,15054210:31094,15054253:31095,15054520:31096,15054521:31097,15054736:31098,15056033:31099,15056052:31100,15056295:31101,15056567:31102,15056798:31265,15106461:31266,15106693:31267,15106698:31268,15106974:31269,15106965:31270,15107232:31271,15106994:31272,15107217:31273,15107255:31274,15107248:31275,15107736:31276,15108243:31277,15108774:31278,15110069:31279,15110560:31280,15110813:31281,15111054:31282,15111566:31283,15112320:31284,15112341:31285,15112379:31286,15112329:31287,15112366:31288,15112350:31289,15112356:31290,15112613:31291,15112599:31292,15112601:31293,15706258:31294,15112627:31295,15112857:31296,15112864:31297,15112882:31298,15112895:31299,15113146:31300,15113358:31301,15705257:31302,15113638:31303,15113915:31304,15114642:31305,15114112:31306,15114369:31307,15114628:31308,15115151:31309,15706259:31310,15115688:31311,15706260:31312,15115928:31313,15116194:31314,15116464:31315,15116715:31316,15116678:31317,15116723:31318,15116734:31319,15117218:31320,15117220:31321,15118230:31322,15118527:31323,15118748:31324,15118982:31325,15118767:31326,15119258:31327,15119492:31328,15120007:31329,15119791:31330,15120022:31331,15120044:31332,15120271:31333,15120312:31334,15120306:31335,15120316:31336,15120569:31337,15120796:31338,15120551:31339,15120572:31340,15121087:31341,15122056:31342,15122101:31343,15122357:31344,15171717:31345,15171719:31346,15171752:31347,15172229:31348,15172267:31349,15172751:31350,15172740:31351,15173020:31352,15172998:31353,15172999:31354,15706261:31355,15173505:31356,15173566:31357,15174321:31358,15174334:31521,15174820:31522,15706262:31523,15175095:31524,15175357:31525,15175561:31526,15175574:31527,15175587:31528,15175570:31529,15175815:31530,15175605:31531,15175846:31532,15175850:31533,15175849:31534,15175854:31535,15176098:31536,15176329:31537,15176351:31538,15176833:31539,15177135:31540,15178370:31541,15178396:31542,15178398:31543,15178395:31544,15178406:31545,15706263:31546,15179142:31547,15043247:31548,15179937:31549,15180174:31550,15180196:31551,15180218:31552,15180976:31553,15706264:31554,15706265:31555,15706266:31556,15181460:31557,15706267:31558,15181467:31559,15182737:31560,15182759:31561,15706268:31562,15182763:31563,15183518:31564,15706269:31565,15185288:31566,15185308:31567,15185591:31568,15185568:31569,15185814:31570,15186322:31571,15187335:31572,15187617:31573,15706270:31574,15240321:31575,15240610:31576,15240639:31577,15241095:31578,15241142:31579,15241608:31580,15241908:31581,15242643:31582,15242649:31583,15242667:31584,15706271:31585,15242928:31586,15706272:31587,15706273:31588,15245447:31589,15246261:31590,15247506:31591,15247543:31592,15247801:31593,15248039:31594,15248062:31595,15248287:31596,15706274:31597,15248310:31598,15248787:31599,15248831:31600,15250352:31601,15250356:31602,15250578:31603,15250870:31604,15706275:31605,15252367:31606,15706276:31607,15706277:31608,15303079:31609,15303582:31610,15706278:31611,15303829:31612,15303847:31613,15304602:31614,15304599:31777,15304606:31778,15304621:31779,15304622:31780,15304612:31781,15304613:31782,15304838:31783,15304848:31784,15304842:31785,15304890:31786,15305088:31787,15304892:31788,15305102:31789,15305113:31790,15305105:31791,15304889:31792,15305127:31793,15305383:31794,15305143:31795,15305144:31796,15305639:31797,15305623:31798,15305625:31799,15305616:31800,15706279:31801,15305621:31802,15305632:31803,15305619:31804,15305893:31805,15305889:31806,15305659:31807,15706280:31808,15305886:31809,15305663:31810,15305885:31811,15305858:31812,15306160:31813,15306135:31814,15306404:31815,15306630:31816,15306654:31817,15306680:31818,15306929:31819,15307141:31820,15307144:31821,15308434:31822,15706012:31823,15706281:31824,15309469:31825,15309487:31826,15310003:31827,15310011:31828,15310211:31829,15310221:31830,15310223:31831,15310225:31832,15310229:31833,15311255:31834,15311269:31835,15706282:31836,15706283:31837,15312039:31838,15706284:31839,15312542:31840,15313294:31841,15313817:31842,15313820:31843,15314357:31844,15314354:31845,15314575:31846,15314609:31847,15314619:31848,15315072:31849,15316400:31850,15316395:31851,15706285:31852,15317145:31853,15317905:31854,14845360:31857,14845361:31858,14845362:31859,14845363:31860,14845364:31861,14845365:31862,14845366:31863,14845367:31864,14845368:31865,14845369:31866,15712164:31868,15711367:31869,15711362:31870,14846117:8514,15712162:8780,14846098:74077}},{}],11:[function(s,e,i){e.exports={52120:8751,52103:8752,49848:8753,52121:8754,52125:8755,49839:8756,52123:8757,52122:8758,126:8759,52868:8760,52869:8761,49825:8770,49830:8771,49855:8772,49850:8811,49834:8812,49833:8813,49838:8814,14845090:8815,49828:8816,14845078:8817,52870:9825,52872:9826,52873:9827,52874:9828,52906:9829,52876:9831,52878:9833,52907:9834,52879:9836,52908:9841,52909:9842,52910:9843,52911:9844,53130:9845,52880:9846,53132:9847,53122:9848,53133:9849,53131:9850,52912:9851,53134:9852,53378:10050,53379:10051,53380:10052,53381:10053,53382:10054,53383:10055,53384:10056,53385:10057,53386:10058,53387:10059,53388:10060,53390:10061,53391:10062,53650:10098,53651:10099,53652:10100,53653:10101,53654:10102,53655:10103,53656:10104,53657:10105,53658:10106,53659:10107,53660:10108,53662:10109,53663:10110,50054:10529,50320:10530,50342:10532,50354:10534,50561:10536,50367:10537,50570:10539,50072:10540,50578:10541,50598:10543,50078:10544,50086:10561,50321:10562,50096:10563,50343:10564,50353:10565,50355:10566,50360:10567,50562:10568,50560:10569,50569:10570,50571:10571,50104:10572,50579:10573,50079:10574,50599:10575,50110:10576,50049:10785,50048:10786,50052:10787,50050:10788,50306:10789,51085:10790,50304:10791,50308:10792,50053:10793,50051:10794,50310:10795,50312:10796,50316:10797,50055:10798,50314:10799,50318:10800,50057:10801,50056:10802,50059:10803,50058:10804,50330:10805,50326:10806,50322:10807,50328:10808,50332:10810,50334:10811,50338:10812,50336:10813,50340:10814,50061:10815,50060:10816,50063:10817,50062:10818,51087:10819,50352:10820,50346:10821,50350:10822,50344:10823,50356:10824,50358:10825,50361:10826,50365:10827,50363:10828,50563:10829,50567:10830,50565:10831,50065:10832,50067:10833,50066:10834,50070:10835,50068:10836,51089:10837,50576:10838,50572:10839,50069:10840,50580:10841,50584:10842,50582:10843,50586:10844,50588:10845,50592:10846,50590:10847,50596:10848,50594:10849,50074:10850,50073:10851,50076:10852,50075:10853,50604:10854,51091:10855,50608:10856,50602:10857,50610:10858,50606:10859,50600:10860,51095:10861,51099:10862,51097:10863,51093:10864,50612:10865,50077:10866,50616:10867,50614:10868,50617:10869,50621:10870,50619:10871,50081:11041,50080:11042,50084:11043,50082:11044,50307:11045,51086:11046,50305:11047,50309:11048,50085:11049,50083:11050,50311:11051,50313:11052,50317:11053,50087:11054,50315:11055,50319:11056,50089:11057,50088:11058,50091:11059,50090:11060,50331:11061,50327:11062,50323:11063,50329:11064,51125:11065,50333:11066,50335:11067,50337:11069,50341:11070,50093:11071,50092:11072,50095:11073,50094:11074,51088:11075,50347:11077,50351:11078,50345:11079,50357:11080,50359:11081,50362:11082,50366:11083,50364:11084,50564:11085,50568:11086,50566:11087,50097:11088,50099:11089,50098:11090,50102:11091,50100:11092,51090:11093,50577:11094,50573:11095,50101:11096,50581:11097,50585:11098,50583:11099,50587:11100,50589:11101,50593:11102,50591:11103,50597:11104,50595:11105,50106:11106,50105:11107,50108:11108,50107:11109,50605:11110,51092:11111,50609:11112,50603:11113,50611:11114,50607:11115,50601:11116,51096:11117,51100:11118,51098:11119,51094:11120,50613:11121,50109:11122,50111:11123,50615:11124,50618:11125,50622:11126,50620:11127,14989442:12321,14989444:12322,14989445:12323,14989452:12324,14989458:12325,14989471:12326,14989475:12327,14989476:12328,14989480:12329,14989483:12330,14989486:12331,14989487:12332,14989488:12333,14989493:12334,14989696:12335,14989697:12336,14989700:12337,14989703:12338,14989713:12339,14989722:12340,14989724:12341,14989731:12342,14989736:12343,14989737:12344,14989748:12345,14989749:12346,14989753:12347,14989759:12348,14989965:12349,14989974:12350,14989975:12351,14989981:12352,14989999:12353,14990009:12354,14990211:12355,14990224:12356,14990234:12357,14990235:12358,14990240:12359,14990241:12360,14990242:12361,14990248:12362,14990255:12363,14990257:12364,14990259:12365,14990261:12366,14990269:12367,14990270:12368,14990271:12369,14990464:12370,14990466:12371,14990467:12372,14990472:12373,14990475:12374,14990476:12375,14990482:12376,14990485:12377,14990486:12378,14990487:12379,14990489:12380,14990510:12381,14990513:12382,14990752:12383,14990515:12384,14990517:12385,14990519:12386,14990521:12387,14990523:12388,14990526:12389,14990720:12390,14990722:12391,14990728:12392,14990729:12393,14990731:12394,14990732:12395,14990738:12396,14990740:12397,14990742:12398,14990744:12399,14990751:12400,14990755:12401,14990762:12402,14990764:12403,14990766:12404,14990769:12405,14990775:12406,14990776:12407,14990777:12408,14990778:12409,14990781:12410,14990782:12411,14990977:12412,14990978:12413,14990980:12414,14990981:12577,14990985:12578,14990986:12579,14990988:12580,14990990:12581,14990992:12582,14990994:12583,14990995:12584,14990996:12585,14990999:12586,14991001:12587,14991002:12588,14991006:12589,14991007:12590,14991026:12591,14991031:12592,14991033:12593,14991035:12594,14991036:12595,14991037:12596,14991038:12597,14991232:12598,14991233:12599,14991237:12600,14991238:12601,14991240:12602,14991241:12603,14991243:12604,14991244:12605,14991245:12606,14991247:12607,14991250:12608,14991260:12609,14991264:12610,14991266:12611,14991280:12612,14991282:12613,14991292:12614,14991293:12615,14991295:12616,15040640:12617,15040641:12618,15040644:12619,15040647:12620,15040650:12621,15040652:12622,15040654:12623,15040656:12624,15040659:12625,15040663:12626,15040664:12627,15040667:12628,15040668:12629,15040669:12630,15040670:12631,15040674:12632,15040679:12633,15040686:12634,15040688:12635,15040690:12636,15040691:12637,15040693:12638,15040896:12639,15040897:12640,15040898:12641,15040901:12642,15040902:12643,15040906:12644,15040908:12645,15040910:12646,15040913:12647,15040914:12648,15040915:12649,15040919:12650,15040921:12651,15040927:12652,15040928:12653,15040930:12654,15040931:12655,15040934:12656,15040935:12657,15040938:12658,15040941:12659,15040944:12660,15040945:12661,15040699:12662,15041153:12663,15041155:12664,15041156:12665,15041158:12666,15041162:12667,15041166:12668,15041167:12669,15041168:12670,15041170:12833,15041171:12834,15041172:12835,15041174:12836,15041179:12837,15041180:12838,15041182:12839,15041183:12840,15041184:12841,15041185:12842,15041186:12843,15041194:12844,15041199:12845,15041200:12846,15041209:12847,15041210:12848,15041213:12849,15041408:12850,15041411:12851,15041412:12852,15041415:12853,15041420:12854,15041422:12855,15041424:12856,15041427:12857,15041428:12858,15041432:12859,15041436:12860,15041437:12861,15041439:12862,15041442:12863,15041444:12864,15041446:12865,15041448:12866,15041449:12867,15041455:12868,15041457:12869,15041462:12870,15041466:12871,15041470:12872,15041667:12873,15041670:12874,15041671:12875,15041672:12876,15041675:12877,15041676:12878,15041677:12879,15041678:12880,15041458:12881,15041680:12882,15041687:12883,15041689:12884,15041691:12885,15041692:12886,15041693:12887,15041694:12888,15041699:12889,15041703:12890,15041704:12891,15041708:12892,15041709:12893,15041711:12894,15041713:12895,15041715:12896,15041716:12897,15041717:12898,15041720:12899,15041721:12900,15041922:12901,15041930:12902,15041935:12903,15041939:12904,15041941:12905,15041943:12906,15041944:12907,15041951:12908,15041956:12909,15041958:12910,15041982:12911,15042179:12912,15042180:12913,15042187:12914,15042190:12915,15042200:12916,15042205:12917,15042209:12918,15042211:12919,15042221:12920,15042232:12921,15042234:12922,15042236:12923,15042238:12924,15042239:12925,15042434:12926,15042440:13089,15042447:13090,15042449:13091,15042450:13092,15042451:13093,15042453:13094,15042456:13095,15042462:13096,15042466:13097,15042469:13098,15042478:13099,15042482:13100,15042483:13101,15042484:13102,15042487:13103,15042689:13104,15042690:13105,15042693:13106,15042706:13107,15042707:13108,15042709:13109,15042710:13110,15042712:13111,15042722:13112,15042728:13113,15042737:13114,15042738:13115,15042741:13116,15042748:13117,15042949:13118,15042953:13119,15042965:13120,15042967:13121,15042968:13122,15042970:13123,15042972:13124,15042975:13125,15042976:13126,15042977:13127,15042982:13128,15042990:13129,15042999:13130,15043e3:13131,15043001:13132,15043200:13133,15043202:13134,15043205:13135,15043210:13136,15043212:13137,15043219:13138,15043221:13139,15043222:13140,15043223:13141,15043224:13142,15043226:13143,15043228:13144,15043236:13145,15043237:13146,15043238:13147,15043239:13148,15043247:13149,15043248:13150,15043254:13151,15043255:13152,15043256:13153,15043258:13154,15043259:13155,15043261:13156,15043456:13157,15043460:13158,15043462:13159,15043464:13160,15043468:13161,15043471:13162,15043473:13163,15043476:13164,15043478:13165,15043483:13166,15043484:13167,15043489:13168,15043493:13169,15043496:13170,15043497:13171,15043498:13172,15043500:13173,15043504:13174,15043505:13175,15043508:13176,15043510:13177,15043511:13178,15043712:13179,15043715:13180,15043722:13181,15043723:13182,15043724:13345,15043729:13346,15043731:13347,15043736:13348,15043739:13349,15043740:13350,15043742:13351,15043743:13352,15043749:13353,15043751:13354,15043752:13355,15043753:13356,15043755:13357,15043756:13358,15043757:13359,15043760:13360,15043762:13361,15043765:13362,15043772:13363,15043773:13364,15043774:13365,15043970:13366,15043980:13367,15043979:13368,15043993:13369,15043995:13370,15044001:13371,15044003:13372,15044005:13373,15044012:13374,15044013:13375,15044018:13376,15044025:13377,15044030:13378,15044227:13379,15044231:13380,15044232:13381,15044238:13382,15044243:13383,15044244:13384,15044249:13385,15044253:13386,15044257:13387,15044260:13388,15044266:13389,15044267:13390,15044271:13391,15044274:13392,15044276:13393,15044277:13394,15044279:13395,15044280:13396,15044282:13397,15044285:13398,15044480:13399,15044485:13400,15044495:13401,15044498:13402,15044499:13403,15044501:13404,15044506:13405,15044509:13406,15044510:13407,15044512:13408,15044518:13409,15044519:13410,15044533:13411,15044738:13412,15044755:13413,15044762:13414,15044769:13415,15044775:13416,15044776:13417,15044778:13418,15044783:13419,15044785:13420,15044788:13421,15044789:13422,15044995:13423,15044996:13424,15044999:13425,15045005:13426,15045007:13427,15045022:13428,15045026:13429,15045028:13430,15045030:13431,15045031:13432,15045033:13433,15045035:13434,15045037:13435,15045038:13436,15045044:13437,15045055:13438,15045249:13601,15045251:13602,15045253:13603,15045256:13604,15045257:13605,15045261:13606,15045265:13607,15045269:13608,15045270:13609,15045276:13610,15045279:13611,15045281:13612,15045286:13613,15045287:13614,15045289:13615,15045290:13616,15045293:13617,15045294:13618,15045297:13619,15045303:13620,15045305:13621,15045306:13622,15045307:13623,15045311:13624,15045510:13625,15045514:13626,15045517:13627,15045518:13628,15045536:13629,15045546:13630,15045548:13631,15045551:13632,15045558:13633,15045564:13634,15045566:13635,15045567:13636,15045760:13637,15045761:13638,15045765:13639,15045768:13640,15045769:13641,15045772:13642,15045773:13643,15045774:13644,15045781:13645,15045802:13646,15045803:13647,15045810:13648,15045813:13649,15045814:13650,15045819:13651,15045820:13652,15045821:13653,15046017:13654,15046023:13655,15046025:13656,15046026:13657,15046029:13658,15046032:13659,15046033:13660,15046040:13661,15046042:13662,15046043:13663,15046046:13664,15046048:13665,15046049:13666,15046052:13667,15046054:13668,15046079:13669,15046273:13670,15046274:13671,15046278:13672,15046280:13673,15046286:13674,15046287:13675,15046289:13676,15046290:13677,15046291:13678,15046292:13679,15046295:13680,15046307:13681,15046308:13682,15046317:13683,15046322:13684,15046335:13685,15046529:13686,15046531:13687,15046534:13688,15046537:13689,15046539:13690,15046540:13691,15046542:13692,15046545:13693,15046546:13694,15046547:13857,15046551:13858,15046552:13859,15046555:13860,15046558:13861,15046562:13862,15046569:13863,15046582:13864,15046591:13865,15046789:13866,15046792:13867,15046794:13868,15046797:13869,15046798:13870,15046799:13871,15046800:13872,15046801:13873,15046802:13874,15046809:13875,15046828:13876,15046832:13877,15046835:13878,15046837:13879,15046839:13880,15046841:13881,15046843:13882,15046844:13883,15046845:13884,15046847:13885,15047040:13886,15047041:13887,15047043:13888,15047044:13889,15047046:13890,15047049:13891,15047051:13892,15047053:13893,15047055:13894,15047060:13895,15047070:13896,15047072:13897,15047073:13898,15047074:13899,15047075:13900,15047078:13901,15047081:13902,15047085:13903,15047087:13904,15047089:13905,15047090:13906,15047093:13907,15047300:13908,15047301:13909,15047304:13910,15047307:13911,15047308:13912,15047317:13913,15047321:13914,15047322:13915,15047325:13916,15047326:13917,15047327:13918,15047334:13919,15047335:13920,15047336:13921,15047337:13922,15047339:13923,15047340:13924,15047341:13925,15047345:13926,15047347:13927,15047351:13928,15047358:13929,15047557:13930,15047561:13931,15047562:13932,15047563:13933,15047567:13934,15047568:13935,15047564:13936,15047565:13937,15047577:13938,15047580:13939,15047581:13940,15047583:13941,15047585:13942,15047588:13943,15047589:13944,15047590:13945,15047591:13946,15047592:13947,15047601:13948,15047595:13949,15047597:13950,15047606:14113,15047607:14114,15047809:14115,15047810:14116,15047815:14117,15047818:14118,15047820:14119,15047825:14120,15047829:14121,15047834:14122,15047835:14123,15047837:14124,15047840:14125,15047842:14126,15047843:14127,15047844:14128,15047845:14129,15047849:14130,15047850:14131,15047852:14132,15047854:14133,15047855:14134,15047859:14135,15047860:14136,15047869:14137,15047870:14138,15047871:14139,15048069:14140,15048070:14141,15048076:14142,15048077:14143,15048082:14144,15048098:14145,15048101:14146,15048103:14147,15048104:14148,15048107:14149,15048109:14150,15048110:14151,15048111:14152,15048112:14153,15048113:14154,15048115:14155,15048116:14156,15048117:14157,15048119:14158,15048121:14159,15048122:14160,15048123:14161,15048124:14162,15048126:14163,15048321:14164,15048323:14165,15048332:14166,15048340:14167,15048343:14168,15048345:14169,15048346:14170,15048348:14171,15048349:14172,15048350:14173,15048351:14174,15048353:14175,15048341:14176,15048359:14177,15048360:14178,15048361:14179,15048364:14180,15048376:14181,15048381:14182,15048583:14183,15048584:14184,15048588:14185,15048591:14186,15048597:14187,15048605:14188,15048606:14189,15048612:14190,15048614:14191,15048615:14192,15048617:14193,15048621:14194,15048624:14195,15048629:14196,15048630:14197,15048632:14198,15048637:14199,15048638:14200,15048639:14201,15048835:14202,15048836:14203,15048840:14204,15048841:14205,15048609:14206,15048844:14369,15048845:14370,15048859:14371,15048862:14372,15048863:14373,15048864:14374,15048870:14375,15048871:14376,15048877:14377,15048882:14378,15048889:14379,15048895:14380,15049097:14381,15049100:14382,15049101:14383,15049103:14384,15049104:14385,15049109:14386,15049119:14387,15049121:14388,15049124:14389,15049127:14390,15049128:14391,15049144:14392,15049148:14393,15049151:14394,15049344:14395,15049345:14396,15049351:14397,15049352:14398,15049353:14399,15049354:14400,15049356:14401,15049357:14402,15049359:14403,15049360:14404,15049364:14405,15049366:14406,15049373:14407,15049376:14408,15049377:14409,15049378:14410,15049382:14411,15049385:14412,15049393:14413,15049394:14414,15049604:14415,15049404:14416,15049602:14417,15049608:14418,15049613:14419,15049614:14420,15049616:14421,15049618:14422,15049620:14423,15049622:14424,15049626:14425,15049629:14426,15049633:14427,15049634:14428,15049641:14429,15049651:14430,15049861:14431,15049862:14432,15049867:14433,15049868:14434,15049874:14435,15049875:14436,15049876:14437,15243649:14438,15049885:14439,15049889:14440,15049891:14441,15049892:14442,15049896:14443,15049903:14444,15049904:14445,15049907:14446,15049909:14447,15049910:14448,15049919:14449,15050115:14450,15050118:14451,15050130:14452,15050131:14453,15050137:14454,15050139:14455,15050141:14456,15050142:14457,15050143:14458,15050145:14459,15050147:14460,15050155:14461,15050157:14462,15050159:14625,15050162:14626,15050165:14627,15050166:14628,15050169:14629,15050171:14630,15050172:14631,15050379:14632,15050380:14633,15050382:14634,15050386:14635,15050389:14636,15050391:14637,15050399:14638,15050404:14639,15050407:14640,15050413:14641,15050414:14642,15050415:14643,15050416:14644,15050419:14645,15050423:14646,15050426:14647,15050428:14648,15050625:14649,15050627:14650,15050628:14651,15050632:14652,15050634:14653,15050637:14654,15050642:14655,15050653:14656,15050654:14657,15050655:14658,15050659:14659,15050660:14660,15050663:14661,15050670:14662,15050671:14663,15050673:14664,15050674:14665,15050676:14666,15050679:14667,15050880:14668,15050884:14669,15050892:14670,15050893:14671,15050894:14672,15050898:14673,15050899:14674,15050910:14675,15050915:14676,15050916:14677,15050919:14678,15050920:14679,15050922:14680,15050925:14681,15050928:14682,15051140:14683,15051141:14684,15051143:14685,15051144:14686,15051148:14687,15051152:14688,15051157:14689,15051166:14690,15051171:14691,15051173:14692,15051175:14693,15051181:14694,15051191:14695,15051194:14696,15051195:14697,15051198:14698,15051403:14699,15051408:14700,15051411:14701,15051414:14702,15051417:14703,15051420:14704,15051422:14705,15051423:14706,15051424:14707,15051426:14708,15051431:14709,15051436:14710,15051441:14711,15051442:14712,15051443:14713,15051445:14714,15051448:14715,15051450:14716,15051451:14717,15051455:14718,15051652:14881,15051654:14882,15051656:14883,15051663:14884,15051674:14885,15051676:14886,15051680:14887,15051685:14888,15051690:14889,15051694:14890,15051701:14891,15051702:14892,15051709:14893,15051904:14894,15051905:14895,15051912:14896,15051927:14897,15051956:14898,15051929:14899,15051931:14900,15051933:14901,15051937:14902,15051941:14903,15051949:14904,15051960:14905,15052161:14906,15052171:14907,15052172:14908,15052178:14909,15052182:14910,15052190:14911,15052200:14912,15052206:14913,15052207:14914,15052220:14915,15052221:14916,15052222:14917,15052223:14918,15052417:14919,15052420:14920,15052422:14921,15052426:14922,15052430:14923,15052432:14924,15052433:14925,15052435:14926,15052436:14927,15052438:14928,15052456:14929,15052457:14930,15052460:14931,15052461:14932,15052463:14933,15052465:14934,15052466:14935,15052471:14936,15052474:14937,15052476:14938,15052672:14939,15052673:14940,15052685:14941,15052687:14942,15052694:14943,15052695:14944,15052696:14945,15052697:14946,15052698:14947,15052704:14948,15052719:14949,15052721:14950,15052724:14951,15052733:14952,15052940:14953,15052951:14954,15052958:14955,15052959:14956,15052963:14957,15052966:14958,15052969:14959,15052971:14960,15052972:14961,15052974:14962,15052976:14963,15052978:14964,15052981:14965,15052982:14966,15053209:14967,15053210:14968,15053212:14969,15053218:14970,15053219:14971,15053223:14972,15053224:14973,15053225:14974,15053229:15137,15053232:15138,15053236:15139,15053237:15140,15053242:15141,15053243:15142,15053244:15143,15053245:15144,15053447:15145,15053448:15146,15053450:15147,15053455:15148,15053458:15149,15053469:15150,15053471:15151,15053472:15152,15053474:15153,15053475:15154,15053478:15155,15053482:15156,15053490:15157,15053492:15158,15053493:15159,15053498:15160,15053705:15161,15053707:15162,15053714:15163,15053725:15164,15053719:15165,15053742:15166,15053745:15167,15053746:15168,15053748:15169,15053953:15170,15053958:15171,15053965:15172,15053970:15173,15053995:15174,15053987:15175,15053988:15176,15053990:15177,15053991:15178,15054001:15179,15054004:15180,15054009:15181,15054013:15182,15054015:15183,15054210:15184,15054211:15185,15054214:15186,15054216:15187,15054229:15188,15054225:15189,15054233:15190,15054218:15191,15054239:15192,15054240:15193,15054241:15194,15054242:15195,15054244:15196,15054250:15197,15054253:15198,15054256:15199,15054265:15200,15054266:15201,15054270:15202,15054271:15203,15054465:15204,15054467:15205,15054472:15206,15054474:15207,15054482:15208,15054483:15209,15054484:15210,15054485:15211,15054489:15212,15054491:15213,15054495:15214,15054496:15215,15054503:15216,15054507:15217,15054512:15218,15054516:15219,15054520:15220,15054521:15221,15054723:15222,15054727:15223,15054731:15224,15054736:15225,15054734:15226,15054744:15227,15054745:15228,15054752:15229,15054756:15230,15054761:15393,15054776:15394,15054777:15395,15054976:15396,15054983:15397,15054989:15398,15054994:15399,15054996:15400,15054997:15401,15055e3:15402,15055007:15403,15055008:15404,15055022:15405,15055016:15406,15055026:15407,15055029:15408,15055038:15409,15055243:15410,15055248:15411,15055241:15412,15055249:15413,15055254:15414,15055256:15415,15055259:15416,15055260:15417,15055262:15418,15055272:15419,15055274:15420,15055275:15421,15055276:15422,15055277:15423,15055278:15424,15055280:15425,15055488:15426,15055499:15427,15055502:15428,15055522:15429,15055524:15430,15055525:15431,15055528:15432,15055530:15433,15055532:15434,15055537:15435,15055539:15436,15055549:15437,15055550:15438,15055551:15439,15055750:15440,15055756:15441,15055755:15442,15055758:15443,15055761:15444,15055762:15445,15055764:15446,15055765:15447,15055772:15448,15055774:15449,15055781:15450,15055787:15451,15056002:15452,15056006:15453,15056007:15454,15056008:15455,15056014:15456,15056025:15457,15056028:15458,15056029:15459,15056033:15460,15056034:15461,15056035:15462,15056036:15463,15056040:15464,15056043:15465,15056044:15466,15056046:15467,15056048:15468,15056052:15469,15056054:15470,15056059:15471,15056061:15472,15056063:15473,15056256:15474,15056260:15475,15056261:15476,15056263:15477,15056269:15478,15056272:15479,15056276:15480,15056280:15481,15056283:15482,15056288:15483,15056291:15484,15056292:15485,15056295:15486,15056303:15649,15056306:15650,15056308:15651,15056309:15652,15056312:15653,15056314:15654,15056317:15655,15056318:15656,15056521:15657,15056525:15658,15056527:15659,15056534:15660,15056540:15661,15056541:15662,15056546:15663,15056551:15664,15056555:15665,15056548:15666,15056556:15667,15056559:15668,15056560:15669,15056561:15670,15056568:15671,15056772:15672,15056775:15673,15056776:15674,15056777:15675,15056779:15676,15056784:15677,15056785:15678,15056786:15679,15056787:15680,15056788:15681,15056798:15682,15056801:15683,15056802:15684,15056808:15685,15056809:15686,15056810:15687,15056812:15688,15056813:15689,15056814:15690,15056815:15691,15056818:15692,15056819:15693,15056822:15694,15056826:15695,15056828:15696,15106183:15697,15106186:15698,15106189:15699,15106195:15700,15106196:15701,15106199:15702,15106200:15703,15106202:15704,15106207:15705,15106212:15706,15106221:15707,15106227:15708,15106229:15709,15106432:15710,15106439:15711,15106440:15712,15106441:15713,15106444:15714,15106449:15715,15106452:15716,15106454:15717,15106455:15718,15106461:15719,15106465:15720,15106471:15721,15106481:15722,15106494:15723,15106495:15724,15106690:15725,15106694:15726,15106696:15727,15106698:15728,15106702:15729,15106705:15730,15106707:15731,15106709:15732,15106712:15733,15106717:15734,15106718:15735,15106722:15736,15106724:15737,15106725:15738,15106728:15739,15106736:15740,15106737:15741,15106743:15742,15106747:15905,15106750:15906,15106946:15907,15106948:15908,15106952:15909,15106953:15910,15106954:15911,15106955:15912,15106958:15913,15106959:15914,15106964:15915,15106965:15916,15106969:15917,15106971:15918,15106973:15919,15106974:15920,15106978:15921,15106981:15922,15106994:15923,15106997:15924,15107e3:15925,15107004:15926,15107005:15927,15107202:15928,15107207:15929,15107210:15930,15107212:15931,15107216:15932,15107217:15933,15107218:15934,15107219:15935,15107220:15936,15107222:15937,15107223:15938,15107225:15939,15107228:15940,15107230:15941,15107234:15942,15107242:15943,15107243:15944,15107248:15945,15107249:15946,15107253:15947,15107254:15948,15107255:15949,15107257:15950,15107457:15951,15107461:15952,15107462:15953,15107465:15954,15107486:15955,15107488:15956,15107500:15957,15107506:15958,15107512:15959,15107515:15960,15107516:15961,15107519:15962,15107712:15963,15107713:15964,15107715:15965,15107716:15966,15107723:15967,15107725:15968,15107730:15969,15107731:15970,15107735:15971,15107736:15972,15107740:15973,15107741:15974,15107743:15975,15107744:15976,15107749:15977,15107752:15978,15107754:15979,15107757:15980,15107768:15981,15107769:15982,15107772:15983,15107968:15984,15107969:15985,15107970:15986,15107982:15987,15107983:15988,15107989:15989,15107996:15990,15107997:15991,15107998:15992,15107999:15993,15108001:15994,15108002:15995,15108007:15996,15108009:15997,15108005:15998,15108012:16161,15108013:16162,15108015:16163,15108225:16164,15108227:16165,15108228:16166,15108231:16167,15108243:16168,15108245:16169,15108252:16170,15108256:16171,15108258:16172,15108259:16173,15108263:16174,15108265:16175,15108267:16176,15108281:16177,15108285:16178,15108482:16179,15108483:16180,15108484:16181,15108486:16182,15108492:16183,15108496:16184,15108497:16185,15108498:16186,15108500:16187,15108502:16188,15108506:16189,15108508:16190,15108516:16191,15108525:16192,15108527:16193,15108531:16194,15108538:16195,15108541:16196,15108749:16197,15108750:16198,15108751:16199,15108752:16200,15108774:16201,15108776:16202,15108787:16203,15108790:16204,15108791:16205,15108794:16206,15108798:16207,15108799:16208,15108996:16209,15109006:16210,15109013:16211,15109014:16212,15109018:16213,15109034:16214,15109042:16215,15109044:16216,15109052:16217,15109053:16218,15109251:16219,15109252:16220,15109258:16221,15109259:16222,15109261:16223,15109264:16224,15109267:16225,15109270:16226,15109272:16227,15109289:16228,15109290:16229,15109293:16230,15109301:16231,15109302:16232,15109305:16233,15109308:16234,15109505:16235,15109506:16236,15109507:16237,15109508:16238,15109510:16239,15109514:16240,15109515:16241,15109518:16242,15109522:16243,15109523:16244,15109524:16245,15109528:16246,15109531:16247,15109541:16248,15109542:16249,15109548:16250,15109549:16251,15109553:16252,15109556:16253,15109557:16254,15109560:16417,15109564:16418,15109565:16419,15109567:16420,15109762:16421,15109764:16422,15109767:16423,15109770:16424,15109776:16425,15109780:16426,15109781:16427,15109785:16428,15109786:16429,15109790:16430,15109796:16431,15109798:16432,15109805:16433,15109806:16434,15109807:16435,15109821:16436,15110017:16437,15110021:16438,15110024:16439,15110030:16440,15110033:16441,15110035:16442,15110036:16443,15110037:16444,15110044:16445,15110048:16446,15110053:16447,15110058:16448,15110060:16449,15110066:16450,15110067:16451,15110069:16452,15110072:16453,15110073:16454,15110281:16455,15110282:16456,15110288:16457,15110290:16458,15110292:16459,15110296:16460,15110302:16461,15110304:16462,15110306:16463,15110308:16464,15110309:16465,15110313:16466,15110314:16467,15110319:16468,15110320:16469,15110325:16470,15110333:16471,15110335:16472,15110539:16473,15110543:16474,15110545:16475,15110546:16476,15110547:16477,15110548:16478,15110554:16479,15110555:16480,15110556:16481,15110557:16482,15110559:16483,15110560:16484,15110561:16485,15110563:16486,15110573:16487,15110579:16488,15110580:16489,15110587:16490,15110589:16491,15110789:16492,15110791:16493,15110799:16494,15110800:16495,15110801:16496,15110808:16497,15110809:16498,15110811:16499,15110813:16500,15110815:16501,15110817:16502,15110819:16503,15110822:16504,15110824:16505,15110828:16506,15110835:16507,15110845:16508,15110846:16509,15110847:16510,15111044:16673,15111049:16674,15111050:16675,15111051:16676,15111052:16677,15111054:16678,15111056:16679,15111057:16680,15111061:16681,15111063:16682,15111076:16683,15111077:16684,15111081:16685,15111082:16686,15111085:16687,15111088:16688,15111093:16689,15111095:16690,15111099:16691,15111103:16692,15111297:16693,15111300:16694,15111304:16695,15111305:16696,15111306:16697,15111311:16698,15111315:16699,15111316:16700,15111318:16701,15111321:16702,15111323:16703,15111326:16704,15111327:16705,15111330:16706,15111334:16707,15111337:16708,15111342:16709,15111345:16710,15111354:16711,15111356:16712,15111357:16713,15111555:16714,15111559:16715,15111561:16716,15111568:16717,15111570:16718,15111572:16719,15111583:16720,15111584:16721,15111591:16722,15111595:16723,15111610:16724,15111613:16725,15111809:16726,15111813:16727,15111818:16728,15111826:16729,15111829:16730,15111832:16731,15111837:16732,15111840:16733,15111843:16734,15111846:16735,15111854:16736,15111858:16737,15111859:16738,15111860:16739,15111871:16740,15112066:16741,15112072:16742,15112073:16743,15112078:16744,15112080:16745,15112084:16746,15112086:16747,15112088:16748,15112095:16749,15112112:16750,15112114:16751,15112116:16752,15112117:16753,15112121:16754,15112126:16755,15112127:16756,15112320:16757,15112324:16758,15112328:16759,15112329:16760,15112333:16761,15112337:16762,15112338:16763,15112341:16764,15112342:16765,15112349:16766,15112350:16929,15112353:16930,15112354:16931,15112355:16932,15112356:16933,15112358:16934,15112361:16935,15112362:16936,15112363:16937,15112364:16938,15112366:16939,15112368:16940,15112369:16941,15112371:16942,15112377:16943,15112375:16944,15112576:16945,15112581:16946,15112582:16947,15112586:16948,15112588:16949,15112593:16950,15112590:16951,15112599:16952,15112600:16953,15112601:16954,15112603:16955,15112604:16956,15112608:16957,15112609:16958,15113147:16959,15112618:16960,15112619:16961,15112620:16962,15112638:16963,15112627:16964,15112629:16965,15112639:16966,15112631:16967,15112632:16968,15112633:16969,15112635:16970,15112832:16971,15112636:16972,15112843:16973,15112844:16974,15112845:16975,15112848:16976,15112850:16977,15112857:16978,15112858:16979,15112859:16980,15112860:16981,15112863:16982,15112864:16983,15112868:16984,15112877:16985,15112881:16986,15112882:16987,15112885:16988,15112891:16989,15112895:16990,15113088:16991,15113090:16992,15113091:16993,15113096:16994,15113100:16995,15113102:16996,15113103:16997,15113108:16998,15113115:16999,15113119:17e3,15113128:17001,15113131:17002,15113132:17003,15113134:17004,15113146:17005,15113349:17006,15113351:17007,15113358:17008,15113363:17009,15113369:17010,15113372:17011,15113376:17012,15113378:17013,15113395:17014,15113406:17015,15113605:17016,15113607:17017,15113608:17018,15113612:17019,15113620:17020,15113621:17021,15113629:17022,15113638:17185,15113644:17186,15113646:17187,15113652:17188,15113654:17189,15113659:17190,15113857:17191,15113860:17192,15113870:17193,15113871:17194,15113873:17195,15113875:17196,15113878:17197,15113880:17198,15113881:17199,15113883:17200,15113904:17201,15113905:17202,15113906:17203,15113909:17204,15113915:17205,15113916:17206,15113917:17207,15114169:17208,15114112:17209,15114114:17210,15114115:17211,15114117:17212,15114120:17213,15114121:17214,15114130:17215,15114135:17216,15114137:17217,15114140:17218,15114145:17219,15114150:17220,15114160:17221,15114162:17222,15114166:17223,15114167:17224,15114642:17225,15114388:17226,15114393:17227,15114397:17228,15114399:17229,15114408:17230,15114407:17231,15114412:17232,15114413:17233,15114415:17234,15114416:17235,15114417:17236,15114419:17237,15114427:17238,15114431:17239,15114628:17240,15114629:17241,15114634:17242,15114636:17243,15114645:17244,15114647:17245,15114648:17246,15114651:17247,15114667:17248,15114670:17249,15114671:17250,15114672:17251,15114673:17252,15114674:17253,15114677:17254,15114681:17255,15114682:17256,15114683:17257,15114684:17258,15114882:17259,15114884:17260,15114886:17261,15114888:17262,15114902:17263,15114904:17264,15114906:17265,15114908:17266,15114913:17267,15114915:17268,15114917:17269,15114921:17270,15114922:17271,15114926:17272,15114930:17273,15114939:17274,15115141:17275,15115144:17276,15115148:17277,15115151:17278,15115152:17441,15115153:17442,15115155:17443,15115158:17444,15115161:17445,15115164:17446,15115165:17447,15115173:17448,15115176:17449,15115178:17450,15115179:17451,15115180:17452,15115181:17453,15115184:17454,15115185:17455,15115189:17456,15115190:17457,15115195:17458,15115196:17459,15115197:17460,15115398:17461,15115401:17462,15115402:17463,15115408:17464,15115409:17465,15115411:17466,15115414:17467,15115415:17468,15115441:17469,15115443:17470,15115445:17471,15115448:17472,15115451:17473,15115650:17474,15115653:17475,15115657:17476,15115662:17477,15115671:17478,15115675:17479,15115683:17480,15115684:17481,15115685:17482,15115686:17483,15115688:17484,15115689:17485,15115692:17486,15115696:17487,15115697:17488,15115698:17489,15115706:17490,15115707:17491,15115711:17492,15115904:17493,15115917:17494,15115922:17495,15115926:17496,15115928:17497,15115937:17498,15115941:17499,15115942:17500,15115944:17501,15115947:17502,15115949:17503,15115951:17504,15115959:17505,15115960:17506,15115962:17507,15115964:17508,15116165:17509,15116168:17510,15116177:17511,15116182:17512,15116183:17513,15116194:17514,15116197:17515,15116206:17516,15116207:17517,15116209:17518,15116211:17519,15116213:17520,15116222:17521,15116416:17522,15116417:17523,15116419:17524,15116431:17525,15116433:17526,15116437:17527,15116442:17528,15116445:17529,15116448:17530,15116452:17531,15116456:17532,15116464:17533,15116466:17534,15116468:17697,15116471:17698,15116475:17699,15116478:17700,15116479:17701,15116677:17702,15116678:17703,15116681:17704,15116682:17705,15116686:17706,15116688:17707,15116689:17708,15116690:17709,15116693:17710,15116694:17711,15116699:17712,15116708:17713,15116711:17714,15116714:17715,15116721:17716,15116723:17717,15116734:17718,15116929:17719,15116931:17720,15116934:17721,15116935:17722,15116937:17723,15116939:17724,15116945:17725,15116955:17726,15116957:17727,15116958:17728,15116959:17729,15116965:17730,15116971:17731,15116975:17732,15116976:17733,15116977:17734,15116980:17735,15116989:17736,15116990:17737,15116991:17738,15117190:17739,15117193:17740,15117192:17741,15117196:17742,15117200:17743,15117204:17744,15117205:17745,15117206:17746,15117212:17747,15117213:17748,15117220:17749,15117223:17750,15117228:17751,15117232:17752,15117233:17753,15117234:17754,15117244:17755,15117245:17756,15117442:17757,15117443:17758,15117446:17759,15117447:17760,15117449:17761,15117455:17762,15117456:17763,15117457:17764,15117463:17765,15117467:17766,15117470:17767,15117476:17768,15117480:17769,15117483:17770,15117484:17771,15117487:17772,15117493:17773,15117494:17774,15117499:17775,15117503:17776,15117702:17777,15117706:17778,15117709:17779,15117714:17780,15117718:17781,15117720:17782,15117725:17783,15117728:17784,15117735:17785,15117739:17786,15117742:17787,15117744:17788,15117749:17789,15117757:17790,15117758:17953,15117954:17954,15117957:17955,15117975:17956,15117979:17957,15117983:17958,15117984:17959,15117986:17960,15117987:17961,15117992:17962,15117993:17963,15117996:17964,15117997:17965,15117998:17966,15118e3:17967,15118008:17968,15118009:17969,15118013:17970,15118014:17971,15118211:17972,15118212:17973,15118217:17974,15118220:17975,15118230:17976,15118234:17977,15118241:17978,15118243:17979,15118246:17980,15118247:17981,15118254:17982,15118257:17983,15118263:17984,15118265:17985,15118271:17986,15118466:17987,15118468:17988,15118469:17989,15118473:17990,15118477:17991,15118478:17992,15118480:17993,15118482:17994,15118489:17995,15118495:17996,15118502:17997,15118503:17998,15118504:17999,15118508:18e3,15118510:18001,15118515:18002,15118517:18003,15118518:18004,15118522:18005,15118523:18006,15118527:18007,15118730:18008,15118731:18009,15118733:18010,15118735:18011,15118738:18012,15118740:18013,15118745:18014,15118747:18015,15118748:18016,15118763:18017,15118765:18018,15118767:18019,15118772:18020,15118774:18021,15118776:18022,15118777:18023,15118779:18024,15118981:18025,15118982:18026,15118983:18027,15118985:18028,15118996:18029,15118997:18030,15118999:18031,15119e3:18032,15119004:18033,15119007:18034,15119024:18035,15119026:18036,15119028:18037,15119234:18038,15119238:18039,15119245:18040,15119247:18041,15119248:18042,15119249:18043,15119250:18044,15119252:18045,15119254:18046,15119258:18209,15119260:18210,15119264:18211,15119271:18212,15119273:18213,15119275:18214,15119276:18215,15119278:18216,15119282:18217,15119284:18218,15119492:18219,15119495:18220,15119498:18221,15119502:18222,15119503:18223,15119505:18224,15119507:18225,15119514:18226,15119526:18227,15119527:18228,15119528:18229,15118759:18230,15119534:18231,15119535:18232,15119537:18233,15119545:18234,15119548:18235,15119551:18236,15119767:18237,15119774:18238,15119775:18239,15119777:18240,15119781:18241,15119783:18242,15119791:18243,15119792:18244,15119804:18245,15120002:18246,15120007:18247,15120017:18248,15120018:18249,15120020:18250,15120022:18251,15120023:18252,15120024:18253,15120042:18254,15120044:18255,15120052:18256,15120055:18257,15120057:18258,15120061:18259,15120063:18260,15120260:18261,15120264:18262,15120266:18263,15120270:18264,15120271:18265,15120278:18266,15120283:18267,15120285:18268,15120287:18269,15120288:18270,15120290:18271,15120293:18272,15120297:18273,15120303:18274,15120304:18275,15120308:18276,15120310:18277,15120316:18278,15120512:18279,15120516:18280,15120542:18281,15120546:18282,15120551:18283,15120562:18284,15120566:18285,15120569:18286,15120571:18287,15120572:18288,15120772:18289,15120773:18290,15120776:18291,15120777:18292,15120779:18293,15120783:18294,15120785:18295,15120786:18296,15120787:18297,15120788:18298,15120791:18299,15120796:18300,15120797:18301,15120798:18302,15120802:18465,15120803:18466,15120808:18467,15120819:18468,15120827:18469,15120829:18470,15121037:18471,15121043:18472,15121049:18473,15121056:18474,15121063:18475,15121069:18476,15121070:18477,15121073:18478,15121075:18479,15121083:18480,15121087:18481,15121280:18482,15121281:18483,15121283:18484,15121287:18485,15121288:18486,15121290:18487,15121293:18488,15121294:18489,15121295:18490,15121323:18491,15121325:18492,15121326:18493,15121337:18494,15121339:18495,15121341:18496,15121540:18497,15121544:18498,15121546:18499,15121548:18500,15121549:18501,15121558:18502,15121560:18503,15121562:18504,15121563:18505,15121574:18506,15121577:18507,15121578:18508,15121583:18509,15121584:18510,15121587:18511,15121590:18512,15121595:18513,15121596:18514,15121581:18515,15121807:18516,15121809:18517,15121810:18518,15121811:18519,15121815:18520,15121817:18521,15121818:18522,15121821:18523,15121822:18524,15121825:18525,15121826:18526,15121832:18527,15121836:18528,15121853:18529,15121854:18530,15122051:18531,15122055:18532,15122056:18533,15122059:18534,15122060:18535,15122061:18536,15122064:18537,15122066:18538,15122067:18539,15122068:18540,15122070:18541,15122074:18542,15122079:18543,15122080:18544,15122085:18545,15122086:18546,15122087:18547,15122088:18548,15122094:18549,15122095:18550,15122096:18551,15122101:18552,15122102:18553,15122108:18554,15122309:18555,15122311:18556,15122312:18557,15122314:18558,15122330:18721,15122334:18722,15122344:18723,15122345:18724,15122352:18725,15122357:18726,15122361:18727,15122364:18728,15122365:18729,15171712:18730,15171717:18731,15171718:18732,15171719:18733,15171725:18734,15171735:18735,15171744:18736,15171747:18737,15171759:18738,15171764:18739,15171767:18740,15171769:18741,15171772:18742,15171971:18743,15171972:18744,15171976:18745,15171977:18746,15171978:18747,15171979:18748,15171988:18749,15171989:18750,15171997:18751,15171998:18752,15171982:18753,15172004:18754,15172005:18755,15172012:18756,15172014:18757,15172021:18758,15172022:18759,15172030:18760,15172225:18761,15172229:18762,15172230:18763,15172244:18764,15172245:18765,15172246:18766,15172247:18767,15172248:18768,15172251:18769,15172260:18770,15172267:18771,15172272:18772,15172273:18773,15172276:18774,15172279:18775,15172490:18776,15172497:18777,15172499:18778,15172500:18779,15172501:18780,15172502:18781,15172504:18782,15172508:18783,15172516:18784,15172538:18785,15172739:18786,15172740:18787,15172741:18788,15172742:18789,15172743:18790,15172747:18791,15172748:18792,15172751:18793,15172766:18794,15172768:18795,15172779:18796,15172781:18797,15172783:18798,15172784:18799,15172785:18800,15172792:18801,15172993:18802,15172997:18803,15172998:18804,15172999:18805,15173002:18806,15173003:18807,15173008:18808,15173010:18809,15173015:18810,15173018:18811,15173020:18812,15173022:18813,15173024:18814,15173032:18977,15173049:18978,15173248:18979,15173253:18980,15173255:18981,15173260:18982,15173266:18983,15173274:18984,15173275:18985,15173280:18986,15173282:18987,15173295:18988,15173296:18989,15173298:18990,15173299:18991,15173306:18992,15173311:18993,15173504:18994,15173505:18995,15173508:18996,15173515:18997,15173516:18998,15173523:18999,15173526:19e3,15173529:19001,15173530:19002,15173532:19003,15173560:19004,15173566:19005,15173760:19006,15173767:19007,15173768:19008,15173769:19009,15173779:19010,15173783:19011,15173786:19012,15173789:19013,15173791:19014,15173796:19015,15173803:19016,15173807:19017,15173812:19018,15173816:19019,15173817:19020,15174017:19021,15174018:19022,15174019:19023,15174021:19024,15174030:19025,15174031:19026,15174032:19027,15174035:19028,15174037:19029,15174038:19030,15174042:19031,15174044:19032,15174046:19033,15174048:19034,15174051:19035,15174056:19036,15174059:19037,15174062:19038,15174063:19039,15174065:19040,15174071:19041,15174072:19042,15174075:19043,15174076:19044,15174079:19045,15174276:19046,15174281:19047,15174285:19048,15174286:19049,15174291:19050,15174299:19051,15174312:19052,15174317:19053,15174318:19054,15174321:19055,15174324:19056,15174334:19057,15174529:19058,15174535:19059,15174537:19060,15174540:19061,15174549:19062,15174550:19063,15174552:19064,15174559:19065,15174565:19066,15174579:19067,15174580:19068,15174586:19069,15174587:19070,15174590:19233,15174786:19234,15174788:19235,15174789:19236,15174791:19237,15174795:19238,15174797:19239,15174802:19240,15174803:19241,15174808:19242,15174809:19243,15174814:19244,15174818:19245,15174820:19246,15174823:19247,15174824:19248,15174828:19249,15174833:19250,15174834:19251,15174837:19252,15174842:19253,15174843:19254,15174845:19255,15175043:19256,15175053:19257,15175056:19258,15175058:19259,15175062:19260,15175064:19261,15175069:19262,15175070:19263,15175071:19264,15175072:19265,15175078:19266,15175079:19267,15175081:19268,15175083:19269,15175084:19270,15175086:19271,15175087:19272,15175089:19273,15175095:19274,15175097:19275,15175100:19276,15175296:19277,15175297:19278,15175299:19279,15175301:19280,15175302:19281,15175310:19282,15175312:19283,15175315:19284,15175317:19285,15175319:19286,15175320:19287,15175324:19288,15175326:19289,15175327:19290,15175328:19291,15175330:19292,15175333:19293,15175334:19294,15175338:19295,15175339:19296,15175341:19297,15175349:19298,15175351:19299,15175353:19300,15175356:19301,15175357:19302,15175359:19303,15175557:19304,15175558:19305,15175561:19306,15175563:19307,15175564:19308,15175567:19309,15175570:19310,15175571:19311,15175574:19312,15175577:19313,15175581:19314,15175585:19315,15175587:19316,15175590:19317,15175591:19318,15175593:19319,15175604:19320,15175605:19321,15175607:19322,15175609:19323,15175610:19324,15175611:19325,15175613:19326,15175615:19489,15175808:19490,15175809:19491,15175812:19492,15175815:19493,15175818:19494,15175825:19495,15175834:19496,15175835:19497,15175844:19498,15175846:19499,15175848:19500,15175849:19501,15175850:19502,15175851:19503,15175852:19504,15175853:19505,15175854:19506,15175855:19507,15175856:19508,15175857:19509,15175865:19510,15176064:19511,15176067:19512,15176068:19513,15176070:19514,15176071:19515,15176075:19516,15176077:19517,15176081:19518,15176082:19519,15176087:19520,15176093:19521,15176098:19522,15176102:19523,15176103:19524,15176104:19525,15176107:19526,15176109:19527,15176110:19528,15176113:19529,15176114:19530,15176320:19531,15176321:19532,15176325:19533,15176326:19534,15176327:19535,15176329:19536,15176335:19537,15176336:19538,15176337:19539,15176338:19540,15176344:19541,15176345:19542,15176346:19543,15176348:19544,15176351:19545,15176352:19546,15176353:19547,15176355:19548,15176358:19549,15176360:19550,15176361:19551,15176362:19552,15176363:19553,15176366:19554,15176367:19555,15176369:19556,15176370:19557,15176373:19558,15176377:19559,15176379:19560,15176383:19561,15176584:19562,15176585:19563,15176588:19564,15176592:19565,15176595:19566,15176600:19567,15176602:19568,15176603:19569,15176606:19570,15176607:19571,15176612:19572,15176616:19573,15176618:19574,15176619:19575,15176623:19576,15176628:19577,15176634:19578,15176635:19579,15176636:19580,15176639:19581,15176838:19582,15176850:19745,15176854:19746,15176855:19747,15176864:19748,15176865:19749,15176868:19750,15176871:19751,15176873:19752,15176874:19753,15176879:19754,15176886:19755,15176889:19756,15176893:19757,15176894:19758,15176895:19759,15177088:19760,15177091:19761,15177095:19762,15177096:19763,15177102:19764,15177104:19765,15177106:19766,15177111:19767,15177118:19768,15177119:19769,15177121:19770,15177135:19771,15177137:19772,15177145:19773,15177146:19774,15177147:19775,15177148:19776,15177149:19777,15177150:19778,15177345:19779,15177349:19780,15177360:19781,15177362:19782,15177363:19783,15177365:19784,15177369:19785,15177372:19786,15177378:19787,15177380:19788,15177396:19789,15177402:19790,15177407:19791,15177600:19792,15177601:19793,15177604:19794,15177606:19795,15177612:19796,15177614:19797,15177615:19798,15177623:19799,15177628:19800,15177631:19801,15177632:19802,15177633:19803,15177636:19804,15177639:19805,15177644:19806,15177646:19807,15177647:19808,15177649:19809,15177657:19810,15177856:19811,15177858:19812,15177859:19813,15177860:19814,15177863:19815,15177864:19816,15177866:19817,15177868:19818,15177871:19819,15177874:19820,15177875:19821,15177877:19822,15177878:19823,15177881:19824,15177883:19825,15177884:19826,15177885:19827,15177886:19828,15177891:19829,15177893:19830,15177894:19831,15177897:19832,15177901:19833,15177906:19834,15177907:19835,15177909:19836,15177912:19837,15177913:19838,15177914:20001,15177916:20002,15178122:20003,15178112:20004,15178113:20005,15178115:20006,15178116:20007,15178117:20008,15178121:20009,15178123:20010,15178133:20011,15178137:20012,15178143:20013,15178148:20014,15178149:20015,15178157:20016,15178158:20017,15178159:20018,15178161:20019,15178164:20020,15178369:20021,15178373:20022,15178380:20023,15178381:20024,15178389:20025,15178395:20026,15178396:20027,15178397:20028,15178399:20029,15178400:20030,15178402:20031,15178403:20032,15178404:20033,15178405:20034,15178406:20035,15178407:20036,15178408:20037,15178410:20038,15178413:20039,15178429:20040,15178625:20041,15178629:20042,15178633:20043,15178635:20044,15178636:20045,15178638:20046,15178644:20047,15178649:20048,15178656:20049,15178662:20050,15178664:20051,15178668:20052,15178672:20053,15178673:20054,15178678:20055,15178681:20056,15178684:20057,15178880:20058,15178886:20059,15178890:20060,15178894:20061,15178898:20062,15178900:20063,15178901:20064,15178903:20065,15178905:20066,15178906:20067,15178908:20068,15178914:20069,15178920:20070,15178925:20071,15178926:20072,15178927:20073,15178932:20074,15178933:20075,15178934:20076,15178937:20077,15178941:20078,15178942:20079,15179138:20080,15179141:20081,15179142:20082,15179146:20083,15179149:20084,15179150:20085,15179151:20086,15179154:20087,15179158:20088,15179159:20089,15179164:20090,15179166:20091,15179167:20092,15179168:20093,15179170:20094,15179172:20257,15179175:20258,15179178:20259,15179180:20260,15179184:20261,15179186:20262,15179187:20263,15179188:20264,15179194:20265,15179197:20266,15179392:20267,15179396:20268,15179404:20269,15179405:20270,15179412:20271,15179413:20272,15179414:20273,15179418:20274,15179423:20275,15179426:20276,15179431:20277,15179434:20278,15179438:20279,15179439:20280,15179441:20281,15179445:20282,15179454:20283,15179651:20284,15179657:20285,15179665:20286,15179666:20287,15179669:20288,15179673:20289,15179678:20290,15179679:20291,15179680:20292,15179684:20293,15179686:20294,15179690:20295,15179692:20296,15179696:20297,15179697:20298,15179700:20299,15179704:20300,15179707:20301,15179909:20302,15179910:20303,15179913:20304,15179917:20305,15179918:20306,15179921:20307,15179933:20308,15179937:20309,15179938:20310,15179939:20311,15179949:20312,15179950:20313,15179952:20314,15179957:20315,15179959:20316,15180163:20317,15180164:20318,15180167:20319,15180168:20320,15180172:20321,15180174:20322,15180178:20323,15180188:20324,15180190:20325,15180192:20326,15180193:20327,15180195:20328,15180196:20329,15180200:20330,15180202:20331,15180206:20332,15180218:20333,15180222:20334,15180426:20335,15180431:20336,15180436:20337,15180440:20338,15180449:20339,15180445:20340,15180446:20341,15180447:20342,15180452:20343,15180456:20344,15180460:20345,15180461:20346,15180464:20347,15180465:20348,15180466:20349,15180467:20350,15180475:20513,15180477:20514,15180479:20515,15180679:20516,15180680:20517,15180681:20518,15180684:20519,15180686:20520,15180690:20521,15180691:20522,15180693:20523,15180694:20524,15180708:20525,15180699:20526,15180703:20527,15180704:20528,15180705:20529,15180710:20530,15180714:20531,15180722:20532,15180723:20533,15180928:20534,15180726:20535,15180727:20536,15180730:20537,15180731:20538,15180735:20539,15180934:20540,15180940:20541,15180944:20542,15180954:20543,15180956:20544,15180958:20545,15180959:20546,15180960:20547,15180965:20548,15180967:20549,15180969:20550,15180973:20551,15180977:20552,15180980:20553,15180981:20554,15180987:20555,15180989:20556,15180991:20557,15181188:20558,15181189:20559,15181190:20560,15181194:20561,15181195:20562,15181199:20563,15181201:20564,15181204:20565,15181208:20566,15181211:20567,15181212:20568,15181223:20569,15181225:20570,15181227:20571,15181234:20572,15181241:20573,15181243:20574,15181244:20575,15181246:20576,15181451:20577,15181452:20578,15181457:20579,15181459:20580,15181460:20581,15181461:20582,15181462:20583,15181464:20584,15181467:20585,15181468:20586,15181473:20587,15181480:20588,15181481:20589,15181483:20590,15181487:20591,15181489:20592,15181492:20593,15181496:20594,15181499:20595,15181698:20596,15181700:20597,15181703:20598,15181704:20599,15181706:20600,15181711:20601,15181716:20602,15181718:20603,15181722:20604,15181725:20605,15181726:20606,15181728:20769,15181730:20770,15181733:20771,15181738:20772,15181739:20773,15181741:20774,15181745:20775,15181752:20776,15181756:20777,15181954:20778,15181955:20779,15181959:20780,15181961:20781,15181962:20782,15181964:20783,15181969:20784,15181973:20785,15181979:20786,15181982:20787,15181985:20788,15181991:20789,15181995:20790,15181997:20791,15181999:20792,15182e3:20793,15182004:20794,15182005:20795,15182008:20796,15182009:20797,15182010:20798,15182212:20799,15182213:20800,15182215:20801,15182216:20802,15182220:20803,15182229:20804,15182230:20805,15182233:20806,15182236:20807,15182237:20808,15182239:20809,15182240:20810,15182245:20811,15182247:20812,15182250:20813,15182253:20814,15182261:20815,15182264:20816,15182270:20817,15182464:20818,15182466:20819,15182469:20820,15182470:20821,15182474:20822,15182475:20823,15182480:20824,15182481:20825,15182484:20826,15182494:20827,15182496:20828,15182499:20829,15182508:20830,15182515:20831,15182517:20832,15182521:20833,15182523:20834,15182524:20835,15182726:20836,15182729:20837,15182732:20838,15182734:20839,15182737:20840,15182747:20841,15182760:20842,15182761:20843,15182763:20844,15182764:20845,15182769:20846,15182772:20847,15182779:20848,15182781:20849,15182782:20850,15182983:20851,15182996:20852,15183007:20853,15183011:20854,15183015:20855,15183017:20856,15183018:20857,15183019:20858,15183021:20859,15183022:20860,15183023:20861,15183024:20862,15183025:21025,15183028:21026,15183037:21027,15183039:21028,15183232:21029,15183233:21030,15183239:21031,15183246:21032,15183253:21033,15183264:21034,15183268:21035,15183270:21036,15183273:21037,15183274:21038,15183277:21039,15183279:21040,15183282:21041,15183283:21042,15183287:21043,15183492:21044,15183497:21045,15183502:21046,15183504:21047,15183505:21048,15183510:21049,15183515:21050,15183518:21051,15183520:21052,15183525:21053,15183532:21054,15183535:21055,15183536:21056,15183538:21057,15183541:21058,15183542:21059,15183546:21060,15183547:21061,15183548:21062,15183549:21063,15183746:21064,15183749:21065,15183752:21066,15183754:21067,15183764:21068,15183766:21069,15183767:21070,15183769:21071,15183770:21072,15183771:21073,15183784:21074,15183786:21075,15183794:21076,15183796:21077,15183797:21078,15183800:21079,15183801:21080,15183802:21081,15183804:21082,15183806:21083,15184001:21084,15184002:21085,15184003:21086,15184004:21087,15184006:21088,15184009:21089,15184011:21090,15184012:21091,15184014:21092,15184015:21093,15184025:21094,15184027:21095,15184032:21096,15184037:21097,15184038:21098,15184040:21099,15184044:21100,15184049:21101,15184051:21102,15184052:21103,15184054:21104,15184057:21105,15184058:21106,15184262:21107,15184266:21108,15184277:21109,15184273:21110,15184274:21111,15184275:21112,15184281:21113,15184282:21114,15184283:21115,15184284:21116,15184285:21117,15184286:21118,15184289:21281,15184291:21282,15184295:21283,15184297:21284,15184301:21285,15184302:21286,15184304:21287,15184306:21288,15184313:21289,15184316:21290,15184317:21291,15184518:21292,15184519:21293,15184527:21294,15184532:21295,15184542:21296,15184544:21297,15184550:21298,15184560:21299,15184566:21300,15184567:21301,15184570:21302,15184571:21303,15184572:21304,15184575:21305,15184772:21306,15184775:21307,15184776:21308,15184777:21309,15184781:21310,15184783:21311,15184787:21312,15184788:21313,15184789:21314,15184791:21315,15184793:21316,15184794:21317,15184797:21318,15184806:21319,15184809:21320,15184811:21321,15184821:21322,15185027:21323,15185031:21324,15185032:21325,15185033:21326,15185039:21327,15185041:21328,15185042:21329,15185043:21330,15185046:21331,15185053:21332,15185054:21333,15185059:21334,15185062:21335,15185066:21336,15185069:21337,15185073:21338,15185084:21339,15185085:21340,15185086:21341,15185280:21342,15185281:21343,15185287:21344,15185288:21345,15185293:21346,15185297:21347,15185299:21348,15185303:21349,15185305:21350,15185306:21351,15185308:21352,15185309:21353,15185317:21354,15185319:21355,15185322:21356,15185328:21357,15185336:21358,15185338:21359,15185339:21360,15185343:21361,15185537:21362,15185538:21363,15185539:21364,15185541:21365,15185542:21366,15185544:21367,15185547:21368,15185548:21369,15185549:21370,15185553:21371,15185558:21372,15185559:21373,15185565:21374,15185566:21537,15185574:21538,15185575:21539,15185578:21540,15185587:21541,15185590:21542,15185591:21543,15185593:21544,15185794:21545,15185795:21546,15185796:21547,15185797:21548,15185798:21549,15185804:21550,15185805:21551,15185806:21552,15185815:21553,15185817:21554,15186048:21555,15185826:21556,15185829:21557,15185830:21558,15185834:21559,15185835:21560,15185837:21561,15185841:21562,15185845:21563,15185846:21564,15185849:21565,15185850:21566,15186056:21567,15186064:21568,15186065:21569,15186069:21570,15186071:21571,15186076:21572,15186077:21573,15186080:21574,15186087:21575,15186088:21576,15186092:21577,15186093:21578,15186095:21579,15186099:21580,15186102:21581,15186111:21582,15186308:21583,15186309:21584,15186311:21585,15186318:21586,15186320:21587,15186322:21588,15186328:21589,15186335:21590,15186337:21591,15186338:21592,15186341:21593,15186347:21594,15186350:21595,15186351:21596,15186355:21597,15186360:21598,15186366:21599,15186561:21600,15186566:21601,15186567:21602,15186570:21603,15186573:21604,15186577:21605,15186581:21606,15186584:21607,15186586:21608,15186589:21609,15186590:21610,15187132:21611,15187131:21612,15187133:21613,15187134:21614,15187135:21615,15187331:21616,15187332:21617,15187335:21618,15187343:21619,15187346:21620,15187347:21621,15187355:21622,15187356:21623,15187357:21624,15187361:21625,15187363:21626,15187364:21627,15187365:21628,15187366:21629,15187373:21630,15187377:21793,15187389:21794,15187390:21795,15187391:21796,15187584:21797,15187595:21798,15187597:21799,15187599:21800,15187600:21801,15187601:21802,15187606:21803,15187607:21804,15187612:21805,15187617:21806,15187618:21807,15187622:21808,15187626:21809,15187629:21810,15187636:21811,15187644:21812,15187647:21813,15187840:21814,15187843:21815,15187848:21816,15187854:21817,15187855:21818,15187867:21819,15187871:21820,15187875:21821,15187877:21822,15187880:21823,15187884:21824,15187886:21825,15187887:21826,15187890:21827,15187898:21828,15187901:21829,15187902:21830,15187903:21831,15237255:21832,15237256:21833,15237258:21834,15237261:21835,15237262:21836,15237263:21837,15237265:21838,15237267:21839,15237268:21840,15237270:21841,15237277:21842,15237278:21843,15237279:21844,15237280:21845,15237284:21846,15237286:21847,15237292:21848,15237294:21849,15237296:21850,15237300:21851,15237301:21852,15237303:21853,15237305:21854,15237306:21855,15237308:21856,15237310:21857,15237504:21858,15237508:21859,15237536:21860,15237540:21861,15237542:21862,15237549:21863,15237553:21864,15237557:21865,15237761:21866,15237768:21867,15237774:21868,15237788:21869,15237790:21870,15237798:21871,15237799:21872,15237803:21873,15237816:21874,15237817:21875,15238024:21876,15238029:21877,15238031:21878,15238034:21879,15238036:21880,15238037:21881,15238039:21882,15238040:21883,15238048:21884,15238061:21885,15238062:21886,15238064:22049,15238066:22050,15238067:22051,15238070:22052,15238073:22053,15238074:22054,15238078:22055,15238275:22056,15238283:22057,15238294:22058,15238295:22059,15238296:22060,15238300:22061,15238302:22062,15238304:22063,15238308:22064,15238311:22065,15238316:22066,15238320:22067,15238325:22068,15238330:22069,15238332:22070,15238533:22071,15238535:22072,15238538:22073,15238540:22074,15238546:22075,15238551:22076,15238560:22077,15238561:22078,15238567:22079,15238568:22080,15238569:22081,15238573:22082,15238575:22083,15238583:22084,15238785:22085,15238800:22086,15238788:22087,15238789:22088,15238790:22089,15238795:22090,15238798:22091,15238806:22092,15238808:22093,15238811:22094,15238814:22095,15238818:22096,15238830:22097,15238834:22098,15238836:22099,15238843:22100,15239051:22101,15239043:22102,15239045:22103,15239050:22104,15239054:22105,15239055:22106,15239061:22107,15239063:22108,15239067:22109,15239069:22110,15239070:22111,15239073:22112,15239076:22113,15239083:22114,15239084:22115,15239088:22116,15239089:22117,15239090:22118,15239093:22119,15239094:22120,15239096:22121,15239097:22122,15239101:22123,15239103:22124,15239296:22125,15239299:22126,15239311:22127,15239315:22128,15239316:22129,15239321:22130,15239322:22131,15239325:22132,15239329:22133,15239330:22134,15239336:22135,15239346:22136,15239348:22137,15239354:22138,15239555:22139,15239556:22140,15239557:22141,15239558:22142,15239563:22305,15239566:22306,15239567:22307,15239569:22308,15239574:22309,15239580:22310,15239584:22311,15239587:22312,15239591:22313,15239597:22314,15239604:22315,15239611:22316,15239613:22317,15239615:22318,15239808:22319,15239809:22320,15239811:22321,15239812:22322,15239815:22323,15239817:22324,15239818:22325,15239822:22326,15239825:22327,15239828:22328,15239830:22329,15239832:22330,15239834:22331,15239835:22332,15239840:22333,15239841:22334,15239843:22335,15239844:22336,15239847:22337,15239848:22338,15239849:22339,15239850:22340,15239854:22341,15239856:22342,15239858:22343,15239860:22344,15239863:22345,15239866:22346,15239868:22347,15239870:22348,15239871:22349,15240070:22350,15240080:22351,15240085:22352,15240090:22353,15240096:22354,15240098:22355,15240100:22356,15240104:22357,15240106:22358,15240109:22359,15240111:22360,15240118:22361,15240119:22362,15240125:22363,15240126:22364,15240320:22365,15240321:22366,15240327:22367,15240328:22368,15240330:22369,15240331:22370,15240596:22371,15240347:22372,15240349:22373,15240350:22374,15240351:22375,15240353:22376,15240354:22377,15240364:22378,15240365:22379,15240366:22380,15240368:22381,15240371:22382,15240375:22383,15240378:22384,15240380:22385,15240381:22386,15240578:22387,15240579:22388,15240580:22389,15240583:22390,15240589:22391,15240590:22392,15240593:22393,15240597:22394,15240598:22395,15240599:22396,15240624:22397,15240632:22398,15240637:22561,15240639:22562,15240832:22563,15240834:22564,15240836:22565,15240838:22566,15240845:22567,15240850:22568,15240852:22569,15240853:22570,15240856:22571,15240857:22572,15240859:22573,15240860:22574,15240861:22575,15240870:22576,15240871:22577,15240873:22578,15240876:22579,15240894:22580,15240895:22581,15241088:22582,15241095:22583,15241097:22584,15241103:22585,15241104:22586,15241105:22587,15241108:22588,15241117:22589,15240595:22590,15241128:22591,15241130:22592,15241142:22593,15241144:22594,15241145:22595,15241148:22596,15241345:22597,15241350:22598,15241354:22599,15241359:22600,15241361:22601,15241365:22602,15241369:22603,15240877:22604,15241391:22605,15241401:22606,15241605:22607,15241607:22608,15241608:22609,15241610:22610,15241613:22611,15241615:22612,15241617:22613,15241618:22614,15241622:22615,15241624:22616,15241625:22617,15241626:22618,15241628:22619,15241632:22620,15241636:22621,15241637:22622,15241639:22623,15241642:22624,15241648:22625,15241651:22626,15241652:22627,15241654:22628,15241656:22629,15241660:22630,15241661:22631,15241857:22632,15241861:22633,15241874:22634,15241875:22635,15241877:22636,15241886:22637,15241894:22638,15241896:22639,15241897:22640,15241898:22641,15241903:22642,15241905:22643,15241908:22644,15241914:22645,15241917:22646,15241918:22647,15242112:22648,15242114:22649,15242119:22650,15242120:22651,15242124:22652,15242127:22653,15242131:22654,15242140:22817,15242151:22818,15242154:22819,15242159:22820,15242160:22821,15242161:22822,15242162:22823,15242167:22824,15242418:22825,15242170:22826,15242171:22827,15242173:22828,15242370:22829,15242371:22830,15242375:22831,15242380:22832,15242382:22833,15242384:22834,15242396:22835,15242398:22836,15242402:22837,15242403:22838,15242404:22839,15242405:22840,15242407:22841,15242410:22842,15242411:22843,15242415:22844,15242419:22845,15242420:22846,15242422:22847,15242431:22848,15242630:22849,15242639:22850,15242640:22851,15242641:22852,15242642:22853,15242643:22854,15242646:22855,15242649:22856,15242652:22857,15242653:22858,15242654:22859,15242655:22860,15242656:22861,15242657:22862,15242658:22863,15242660:22864,15242667:22865,15242671:22866,15242681:22867,15242682:22868,15242683:22869,15242685:22870,15242687:22871,15242881:22872,15242885:22873,15242886:22874,15242889:22875,15242891:22876,15242892:22877,15242895:22878,15242899:22879,15242904:22880,15242909:22881,15242911:22882,15242912:22883,15242914:22884,15242917:22885,15242919:22886,15242932:22887,15242934:22888,15242935:22889,15242936:22890,15242940:22891,15242941:22892,15242942:22893,15242943:22894,15243138:22895,15243143:22896,15243146:22897,15243147:22898,15243150:22899,15242925:22900,15243160:22901,15243162:22902,15243167:22903,15243168:22904,15243174:22905,15243176:22906,15243181:22907,15243187:22908,15243190:22909,15243196:22910,15243199:23073,15243392:23074,15243396:23075,15243397:23076,15243405:23077,15243406:23078,15243408:23079,15243409:23080,15243410:23081,15243416:23082,15243417:23083,15243419:23084,15243422:23085,15243425:23086,15243431:23087,15243433:23088,15243446:23089,15243448:23090,15243450:23091,15243452:23092,15243453:23093,15243648:23094,15243650:23095,15243654:23096,15243666:23097,15243667:23098,15243670:23099,15243671:23100,15243672:23101,15243673:23102,15243677:23103,15243680:23104,15243681:23105,15243682:23106,15243683:23107,15243684:23108,15243689:23109,15243692:23110,15243695:23111,15243701:23112,15243702:23113,15243703:23114,15243706:23115,15243917:23116,15243921:23117,15243926:23118,15243928:23119,15243930:23120,15243932:23121,15243937:23122,15243942:23123,15243943:23124,15243944:23125,15243949:23126,15243953:23127,15243955:23128,15243956:23129,15243957:23130,15243959:23131,15243960:23132,15243961:23133,15243967:23134,15244160:23135,15244161:23136,15244163:23137,15244165:23138,15244177:23139,15244178:23140,15244181:23141,15244183:23142,15244186:23143,15244188:23144,15244192:23145,15244195:23146,15244197:23147,15244199:23148,15243912:23149,15244218:23150,15244220:23151,15244221:23152,15244420:23153,15244421:23154,15244423:23155,15244427:23156,15244430:23157,15244431:23158,15244432:23159,15244435:23160,15244436:23161,15244441:23162,15244446:23163,15244447:23164,15244449:23165,15244451:23166,15244456:23329,15244462:23330,15244463:23331,15244465:23332,15244466:23333,15244473:23334,15244474:23335,15244476:23336,15244477:23337,15244478:23338,15244672:23339,15244675:23340,15244677:23341,15244685:23342,15244696:23343,15244701:23344,15244705:23345,15244708:23346,15244709:23347,15244719:23348,15244721:23349,15244722:23350,15244731:23351,15244931:23352,15244932:23353,15244933:23354,15244934:23355,15244935:23356,15244936:23357,15244937:23358,15244939:23359,15244940:23360,15244944:23361,15244947:23362,15244949:23363,15244951:23364,15244952:23365,15244953:23366,15244958:23367,15244960:23368,15244963:23369,15244967:23370,15244972:23371,15244973:23372,15244974:23373,15244977:23374,15244981:23375,15244990:23376,15244991:23377,15245185:23378,15245192:23379,15245193:23380,15245194:23381,15245198:23382,15245205:23383,15245206:23384,15245209:23385,15245210:23386,15245212:23387,15245215:23388,15245218:23389,15245219:23390,15245220:23391,15245226:23392,15245227:23393,15245229:23394,15245233:23395,15245235:23396,15245240:23397,15245242:23398,15245247:23399,15245441:23400,15245443:23401,15245446:23402,15245449:23403,15245450:23404,15245451:23405,15245456:23406,15245465:23407,15245458:23408,15245459:23409,15245460:23410,15245464:23411,15245466:23412,15245467:23413,15245468:23414,15245470:23415,15245471:23416,15245480:23417,15245485:23418,15245486:23419,15245488:23420,15245490:23421,15245493:23422,15245498:23585,15245500:23586,15245697:23587,15245699:23588,15245701:23589,15245704:23590,15245705:23591,15245706:23592,15245707:23593,15245710:23594,15245713:23595,15245717:23596,15245718:23597,15245720:23598,15245722:23599,15245724:23600,15245727:23601,15245728:23602,15245732:23603,15245737:23604,15245745:23605,15245753:23606,15245755:23607,15245952:23608,15245976:23609,15245978:23610,15245979:23611,15245980:23612,15245983:23613,15245984:23614,15245992:23615,15245994:23616,15246010:23617,15246013:23618,15246014:23619,15246208:23620,15246218:23621,15246219:23622,15246220:23623,15246221:23624,15246222:23625,15246225:23626,15246226:23627,15246227:23628,15246235:23629,15246238:23630,15246247:23631,15246255:23632,15246256:23633,15246257:23634,15246261:23635,15246263:23636,15246465:23637,15246470:23638,15246477:23639,15246478:23640,15246479:23641,15246485:23642,15246486:23643,15246488:23644,15246489:23645,15246490:23646,15246492:23647,15246496:23648,15246502:23649,15246503:23650,15246504:23651,15246512:23652,15246513:23653,15246514:23654,15246517:23655,15246521:23656,15246522:23657,15246526:23658,15246720:23659,15246722:23660,15246725:23661,15246726:23662,15246729:23663,15246735:23664,15246738:23665,15246743:23666,15246746:23667,15246747:23668,15246748:23669,15246753:23670,15246754:23671,15246755:23672,15246763:23673,15246766:23674,15246768:23675,15246771:23676,15246773:23677,15246778:23678,15246779:23841,15246780:23842,15246781:23843,15246985:23844,15246989:23845,15246992:23846,15246996:23847,15246997:23848,15247003:23849,15247004:23850,15247007:23851,15247008:23852,15247013:23853,15247024:23854,15247028:23855,15247029:23856,15247030:23857,15247031:23858,15247036:23859,15247252:23860,15247253:23861,15247254:23862,15247255:23863,15247256:23864,15247269:23865,15247273:23866,15247275:23867,15247277:23868,15247281:23869,15247283:23870,15247286:23871,15247289:23872,15247293:23873,15247295:23874,15247492:23875,15247493:23876,15247495:23877,15247503:23878,15247505:23879,15247506:23880,15247508:23881,15247509:23882,15247518:23883,15247520:23884,15247522:23885,15247524:23886,15247526:23887,15247531:23888,15247532:23889,15247535:23890,15247541:23891,15247543:23892,15247549:23893,15247550:23894,15247744:23895,15247747:23896,15247749:23897,15247751:23898,15247753:23899,15247757:23900,15247758:23901,15247763:23902,15247766:23903,15247767:23904,15247768:23905,15247772:23906,15247773:23907,15247777:23908,15247781:23909,15247783:23910,15247797:23911,15247798:23912,15247799:23913,15247801:23914,15247802:23915,15247803:23916,15247806:23917,15247807:23918,15248e3:23919,15248003:23920,15248006:23921,15248011:23922,15248015:23923,15248016:23924,15248018:23925,15248022:23926,15248023:23927,15248025:23928,15248031:23929,15248039:23930,15248041:23931,15248046:23932,15248047:23933,15248051:23934,15248054:24097,15248055:24098,15248059:24099,15248062:24100,15248259:24101,15248262:24102,15248264:24103,15248265:24104,15248266:24105,15248273:24106,15248275:24107,15248276:24108,15248277:24109,15248279:24110,15248285:24111,15248287:24112,15248300:24113,15248304:24114,15248308:24115,15248309:24116,15248310:24117,15248316:24118,15248319:24119,15248517:24120,15248518:24121,15248523:24122,15248529:24123,15248540:24124,15248542:24125,15248543:24126,15248522:24127,15248557:24128,15248560:24129,15248567:24130,15248572:24131,15248770:24132,15248771:24133,15248772:24134,15248773:24135,15248774:24136,15248776:24137,15248786:24138,15248787:24139,15248788:24140,15248793:24141,15248781:24142,15248798:24143,15248803:24144,15248813:24145,15248822:24146,15248824:24147,15248825:24148,15248828:24149,15248830:24150,15249025:24151,15249028:24152,15249029:24153,15249035:24154,15249037:24155,15249039:24156,15249044:24157,15249045:24158,15249052:24159,15249054:24160,15249055:24161,15249592:24162,15249593:24163,15249597:24164,15249598:24165,15249797:24166,15249799:24167,15249801:24168,15249803:24169,15249807:24170,15249809:24171,15249811:24172,15249812:24173,15249815:24174,15249816:24175,15249819:24176,15249821:24177,15249817:24178,15249827:24179,15249828:24180,15249830:24181,15249832:24182,15249833:24183,15249837:24184,15249843:24185,15249845:24186,15249846:24187,15249851:24188,15249854:24189,15250054:24190,15250055:24353,15250059:24354,15250064:24355,15250066:24356,15250067:24357,15250073:24358,15250075:24359,15250076:24360,15250084:24361,15250105:24362,15250106:24363,15250309:24364,15250310:24365,15250313:24366,15250315:24367,15250319:24368,15250326:24369,15250325:24370,15250329:24371,15250333:24372,15250337:24373,15250344:24374,15250348:24375,15250351:24376,15250352:24377,15250354:24378,15250357:24379,15250359:24380,15250360:24381,15250366:24382,15250367:24383,15250561:24384,15250563:24385,15250569:24386,15250578:24387,15250583:24388,15250587:24389,15250853:24390,15250857:24391,15250860:24392,15250862:24393,15250879:24394,15251074:24395,15251076:24396,15251080:24397,15251085:24398,15251088:24399,15251089:24400,15251093:24401,15251102:24402,15251103:24403,15251104:24404,15251110:24405,15251115:24406,15251116:24407,15251119:24408,15251122:24409,15251125:24410,15251127:24411,15251129:24412,15251131:24413,15251328:24414,15251333:24415,15251334:24416,15251335:24417,15251336:24418,15251338:24419,15251342:24420,15251345:24421,15251348:24422,15251349:24423,15251351:24424,15251353:24425,15251364:24426,15251365:24427,15251367:24428,15251372:24429,15251376:24430,15251132:24431,15251377:24432,15251378:24433,15251380:24434,15251389:24435,15251585:24436,15251588:24437,15251589:24438,15251590:24439,15251595:24440,15251601:24441,15251604:24442,15251606:24443,15251616:24444,15251617:24445,15251618:24446,15251619:24609,15251622:24610,15251623:24611,15251633:24612,15251635:24613,15251638:24614,15251639:24615,15251640:24616,15251641:24617,15251645:24618,15251840:24619,15251841:24620,15251851:24621,15251853:24622,15251854:24623,15251855:24624,15251860:24625,15251867:24626,15251868:24627,15251869:24628,15251870:24629,15251873:24630,15251874:24631,15251881:24632,15251884:24633,15251885:24634,15251887:24635,15251888:24636,15251889:24637,15251897:24638,15251898:24639,15251899:24640,15252098:24641,15252099:24642,15252105:24643,15252112:24644,15252114:24645,15252117:24646,15252122:24647,15252123:24648,15252125:24649,15252126:24650,15252130:24651,15252135:24652,15252137:24653,15252141:24654,15252142:24655,15252147:24656,15252149:24657,15252154:24658,15252155:24659,15252352:24660,15252353:24661,15252355:24662,15252356:24663,15252359:24664,15252367:24665,15252369:24666,15252372:24667,15252380:24668,15252392:24669,15252398:24670,15252400:24671,15252401:24672,15252407:24673,15252409:24674,15252410:24675,15252397:24676,15252608:24677,15252610:24678,15252615:24679,15252616:24680,15252623:24681,15252624:24682,15252630:24683,15252631:24684,15252632:24685,15252638:24686,15252640:24687,15252641:24688,15252643:24689,15252645:24690,15252647:24691,15252648:24692,15252652:24693,15252653:24694,15252654:24695,15252660:24696,15252661:24697,15252662:24698,15252663:24699,15252666:24700,15252864:24701,15252865:24702,15252867:24865,15252871:24866,15252879:24867,15252881:24868,15252882:24869,15252883:24870,15252884:24871,15252885:24872,15252888:24873,15252893:24874,15252894:24875,15252901:24876,15253149:24877,15253152:24878,15253153:24879,15253156:24880,15253157:24881,15253158:24882,15253173:24883,15253174:24884,15253176:24885,15253182:24886,15253376:24887,15253377:24888,15253382:24889,15253386:24890,15253387:24891,15253389:24892,15253392:24893,15253394:24894,15253395:24895,15253397:24896,15253408:24897,15253411:24898,15253412:24899,15253416:24900,15253422:24901,15253425:24902,15253429:24903,15253430:24904,15253435:24905,15253438:24906,15302786:24907,15302788:24908,15302792:24909,15302796:24910,15302808:24911,15302811:24912,15302824:24913,15302825:24914,15302831:24915,15302826:24916,15302828:24917,15302829:24918,15302835:24919,15302836:24920,15302839:24921,15302847:24922,15303043:24923,15303044:24924,15303052:24925,15303067:24926,15303069:24927,15303074:24928,15303078:24929,15303079:24930,15303084:24931,15303088:24932,15303092:24933,15303097:24934,15303301:24935,15303304:24936,15303307:24937,15303308:24938,15303310:24939,15303312:24940,15303317:24941,15303319:24942,15303320:24943,15303321:24944,15303323:24945,15303328:24946,15303329:24947,15303330:24948,15303333:24949,15303344:24950,15303346:24951,15303347:24952,15303348:24953,15303350:24954,15303357:24955,15303564:24956,15303358:24957,15303555:24958,15303556:25121,15303557:25122,15303559:25123,15303560:25124,15303573:25125,15303575:25126,15303576:25127,15303577:25128,15303580:25129,15303581:25130,15303583:25131,15303589:25132,15303570:25133,15303606:25134,15303595:25135,15303599:25136,15303600:25137,15303604:25138,15303614:25139,15303615:25140,15303808:25141,15303812:25142,15303813:25143,15303814:25144,15303816:25145,15303821:25146,15303824:25147,15303828:25148,15303830:25149,15303831:25150,15303832:25151,15303834:25152,15303836:25153,15303838:25154,15303840:25155,15303845:25156,15303842:25157,15303843:25158,15303847:25159,15303849:25160,15303854:25161,15303855:25162,15303857:25163,15303860:25164,15303862:25165,15303863:25166,15303865:25167,15303866:25168,15303868:25169,15303869:25170,15304067:25171,15304071:25172,15304072:25173,15304079:25174,15304083:25175,15304087:25176,15304089:25177,15304090:25178,15304091:25179,15304097:25180,15304100:25181,15304103:25182,15304109:25183,15304116:25184,15304121:25185,15304122:25186,15304123:25187,15304321:25188,15304323:25189,15304325:25190,15304326:25191,15304330:25192,15304334:25193,15304337:25194,15304339:25195,15304340:25196,15304341:25197,15304344:25198,15304350:25199,15304353:25200,15304358:25201,15304360:25202,15304364:25203,15304365:25204,15304366:25205,15304368:25206,15304369:25207,15304370:25208,15304371:25209,15304374:25210,15304379:25211,15304380:25212,15304381:25213,15304383:25214,15304578:25377,15304579:25378,15304581:25379,15304595:25380,15304596:25381,15304599:25382,15304601:25383,15304602:25384,15304606:25385,15304612:25386,15304613:25387,15304617:25388,15304618:25389,15304620:25390,15304621:25391,15304622:25392,15304623:25393,15304624:25394,15304625:25395,15304631:25396,15304633:25397,15304635:25398,15304637:25399,15304832:25400,15304833:25401,15304836:25402,15304837:25403,15304838:25404,15304839:25405,15304841:25406,15304842:25407,15304844:25408,15304848:25409,15304850:25410,15304851:25411,15304854:25412,15304856:25413,15304860:25414,15304861:25415,15304867:25416,15304868:25417,15304869:25418,15304870:25419,15304872:25420,15304878:25421,15304879:25422,15304880:25423,15304883:25424,15304885:25425,15304886:25426,15304888:25427,15304889:25428,15304890:25429,15304892:25430,15304894:25431,15305088:25432,15305090:25433,15305091:25434,15305094:25435,15305095:25436,15305098:25437,15305101:25438,15305102:25439,15305103:25440,15305105:25441,15305112:25442,15305113:25443,15305116:25444,15305117:25445,15305120:25446,15305121:25447,15305125:25448,15305127:25449,15305128:25450,15305129:25451,15305134:25452,15305135:25453,15305136:25454,15305141:25455,15305142:25456,15305143:25457,15305144:25458,15305145:25459,15305147:25460,15305148:25461,15305149:25462,15305151:25463,15305352:25464,15305353:25465,15305354:25466,15305357:25467,15305358:25468,15305362:25469,15305367:25470,15305369:25633,15305375:25634,15305376:25635,15305380:25636,15305381:25637,15305383:25638,15305384:25639,15305387:25640,15305391:25641,15305394:25642,15305398:25643,15305400:25644,15305402:25645,15305403:25646,15305404:25647,15305405:25648,15305407:25649,15305600:25650,15305601:25651,15305602:25652,15305603:25653,15305605:25654,15305606:25655,15305607:25656,15305608:25657,15305611:25658,15305612:25659,15305613:25660,15305614:25661,15305616:25662,15305619:25663,15305621:25664,15305623:25665,15305624:25666,15305625:25667,15305628:25668,15305629:25669,15305631:25670,15305632:25671,15305633:25672,15305635:25673,15305637:25674,15305639:25675,15305640:25676,15305644:25677,15305646:25678,15305648:25679,15305657:25680,15305659:25681,15305663:25682,15305856:25683,15305858:25684,15305864:25685,15305869:25686,15305873:25687,15305876:25688,15305877:25689,15305884:25690,15305885:25691,15305886:25692,15305887:25693,15305889:25694,15305892:25695,15305893:25696,15305895:25697,15305897:25698,15305898:25699,15305907:25700,15305908:25701,15305910:25702,15305911:25703,15306119:25704,15306120:25705,15306121:25706,15306128:25707,15306129:25708,15306130:25709,15306133:25710,15306135:25711,15306136:25712,15306138:25713,15306142:25714,15306148:25715,15306149:25716,15306151:25717,15306153:25718,15306154:25719,15306157:25720,15306159:25721,15306160:25722,15306161:25723,15306163:25724,15306164:25725,15306166:25726,15306170:25889,15306173:25890,15306175:25891,15306368:25892,15306369:25893,15306370:25894,15306376:25895,15306378:25896,15306379:25897,15306381:25898,15306383:25899,15306386:25900,15306389:25901,15306392:25902,15306395:25903,15306398:25904,15306401:25905,15306403:25906,15306404:25907,15306406:25908,15306408:25909,15306411:25910,15306420:25911,15306421:25912,15306422:25913,15306426:25914,15306409:25915,15306625:25916,15306628:25917,15306629:25918,15306630:25919,15306631:25920,15306633:25921,15306634:25922,15306635:25923,15306636:25924,15306637:25925,15306643:25926,15306649:25927,15306652:25928,15306654:25929,15306655:25930,15306658:25931,15306662:25932,15306663:25933,15306681:25934,15306679:25935,15306680:25936,15306682:25937,15306683:25938,15306685:25939,15306881:25940,15306882:25941,15306884:25942,15306888:25943,15306889:25944,15306893:25945,15306894:25946,15306895:25947,15306901:25948,15306902:25949,15306903:25950,15306911:25951,15306926:25952,15306927:25953,15306929:25954,15306930:25955,15306931:25956,15306932:25957,15306939:25958,15306943:25959,15306941:25960,15307139:25961,15307141:25962,15307144:25963,15307146:25964,15307148:25965,15307157:25966,15307161:25967,15307164:25968,15307167:25969,15307169:25970,15307171:25971,15307176:25972,15307179:25973,15307181:25974,15307182:25975,15307183:25976,15307185:25977,15307186:25978,15307396:25979,15307395:25980,15308216:25981,15308217:25982,15308222:26145,15308420:26146,15308424:26147,15308428:26148,15308429:26149,15308430:26150,15308445:26151,15308446:26152,15308447:26153,15308449:26154,15308454:26155,15308457:26156,15308459:26157,15308460:26158,15308468:26159,15308470:26160,15308474:26161,15308477:26162,15308479:26163,15308678:26164,15308680:26165,15308681:26166,15308683:26167,15308688:26168,15308689:26169,15308690:26170,15308691:26171,15308697:26172,15308698:26173,15308701:26174,15308702:26175,15308703:26176,15308704:26177,15308708:26178,15308710:26179,15308957:26180,15308958:26181,15308962:26182,15308964:26183,15308965:26184,15308966:26185,15308972:26186,15308977:26187,15308979:26188,15308983:26189,15308984:26190,15308985:26191,15308986:26192,15308988:26193,15308989:26194,15309185:26195,15309202:26196,15309204:26197,15309206:26198,15309207:26199,15309208:26200,15309217:26201,15309230:26202,15309236:26203,15309243:26204,15309244:26205,15309246:26206,15309247:26207,15309441:26208,15309442:26209,15309443:26210,15309444:26211,15309449:26212,15309457:26213,15309462:26214,15309466:26215,15309469:26216,15309471:26217,15309476:26218,15309477:26219,15309478:26220,15309481:26221,15309486:26222,15309487:26223,15309491:26224,15309498:26225,15309706:26226,15309714:26227,15054514:26228,15309720:26229,15309722:26230,15309725:26231,15309726:26232,15309727:26233,15309737:26234,15309743:26235,15309745:26236,15309754:26237,15309954:26238,15309955:26401,15309957:26402,15309961:26403,15309978:26404,15309979:26405,15309981:26406,15309985:26407,15309986:26408,15309987:26409,15309992:26410,15310001:26411,15310003:26412,15310209:26413,15310211:26414,15310218:26415,15310222:26416,15310223:26417,15310229:26418,15310231:26419,15310232:26420,15310234:26421,15310235:26422,15310243:26423,15310247:26424,15310250:26425,15310254:26426,15310259:26427,15310262:26428,15310263:26429,15310264:26430,15310267:26431,15310269:26432,15310271:26433,15310464:26434,15310473:26435,15310485:26436,15310486:26437,15310487:26438,15310489:26439,15310490:26440,15310494:26441,15310495:26442,15310498:26443,15310508:26444,15310510:26445,15310513:26446,15310514:26447,15310517:26448,15310518:26449,15310520:26450,15310521:26451,15310522:26452,15310524:26453,15310526:26454,15310527:26455,15310721:26456,15310724:26457,15310725:26458,15310727:26459,15310729:26460,15310730:26461,15310732:26462,15310733:26463,15310734:26464,15310736:26465,15310737:26466,15310740:26467,15310743:26468,15310744:26469,15310745:26470,15310749:26471,15310750:26472,15310752:26473,15310747:26474,15310753:26475,15310756:26476,15310767:26477,15310769:26478,15310772:26479,15310775:26480,15310776:26481,15310778:26482,15310983:26483,15310986:26484,15311001:26485,15310989:26486,15310990:26487,15310996:26488,15310998:26489,15311004:26490,15311006:26491,15311008:26492,15311011:26493,15311014:26494,15311019:26657,15311022:26658,15311023:26659,15311024:26660,15311026:26661,15311027:26662,15311029:26663,15311013:26664,15311038:26665,15311236:26666,15311239:26667,15311242:26668,15311249:26669,15311250:26670,15311251:26671,15311254:26672,15311255:26673,15311257:26674,15311258:26675,15311266:26676,15311267:26677,15311269:26678,15311270:26679,15311274:26680,15311276:26681,15311531:26682,15311533:26683,15311534:26684,15311536:26685,15311540:26686,15311543:26687,15311544:26688,15311546:26689,15311547:26690,15311551:26691,15311746:26692,15311749:26693,15311752:26694,15311756:26695,15311777:26696,15311779:26697,15311781:26698,15311782:26699,15311783:26700,15311786:26701,15311795:26702,15311798:26703,15312002:26704,15312007:26705,15312008:26706,15312017:26707,15312021:26708,15312022:26709,15312023:26710,15312026:26711,15312027:26712,15312028:26713,15312031:26714,15312034:26715,15312038:26716,15312039:26717,15312043:26718,15312049:26719,15312050:26720,15312051:26721,15312052:26722,15312053:26723,15312057:26724,15312058:26725,15312059:26726,15312060:26727,15312256:26728,15312257:26729,15312262:26730,15312263:26731,15312264:26732,15312269:26733,15312270:26734,15312276:26735,15312280:26736,15312281:26737,15312283:26738,15312284:26739,15312286:26740,15312287:26741,15312288:26742,15312539:26743,15312541:26744,15312543:26745,15312550:26746,15312560:26747,15312561:26748,15312562:26749,15312565:26750,15312569:26913,15312570:26914,15312573:26915,15312575:26916,15312771:26917,15312777:26918,15312787:26919,15312788:26920,15312793:26921,15312794:26922,15312796:26923,15312798:26924,15312807:26925,15312810:26926,15312811:26927,15312812:26928,15312816:26929,15312820:26930,15312821:26931,15312825:26932,15312829:26933,15312830:26934,15313026:26935,15313027:26936,15313028:26937,15313035:26938,15313036:26939,15313040:26940,15313041:26941,15313046:26942,15313054:26943,15313056:26944,15313058:26945,15313059:26946,15313060:26947,15313063:26948,15313069:26949,15313070:26950,15313075:26951,15313077:26952,15313078:26953,15313080:26954,15313287:26955,15313281:26956,15313284:26957,15313290:26958,15313291:26959,15313292:26960,15313294:26961,15313297:26962,15313300:26963,15313302:26964,15313309:26965,15313578:26966,15313580:26967,15313582:26968,15313583:26969,15313586:26970,15313588:26971,15313589:26972,15313590:26973,15313593:26974,15313595:26975,15313598:26976,15313599:26977,15313793:26978,15313795:26979,15313798:26980,15313800:26981,15313806:26982,15313808:26983,15313810:26984,15313813:26985,15313814:26986,15313815:26987,15313819:26988,15313820:26989,15313824:26990,15313828:26991,15313829:26992,15313831:26993,15313833:26994,15313836:26995,15313842:26996,15313843:26997,15313845:26998,15313849:26999,15313850:27e3,15313853:27001,15313855:27002,15314048:27003,15314049:27004,15314050:27005,15314051:27006,15314052:27169,15314053:27170,15314056:27171,15314057:27172,15314059:27173,15314060:27174,15314061:27175,15314062:27176,15314064:27177,15314066:27178,15314070:27179,15314073:27180,15314075:27181,15314076:27182,15314080:27183,15314086:27184,15314091:27185,15314093:27186,15314099:27187,15314100:27188,15314101:27189,15314103:27190,15314105:27191,15314106:27192,15314109:27193,15314312:27194,15314315:27195,15314316:27196,15314325:27197,15314326:27198,15314327:27199,15314331:27200,15314334:27201,15314337:27202,15314339:27203,15314341:27204,15314342:27205,15314344:27206,15314346:27207,15314347:27208,15314348:27209,15314349:27210,15314350:27211,15314355:27212,15314357:27213,15314359:27214,15314360:27215,15314361:27216,15314367:27217,15314560:27218,15314564:27219,15314565:27220,15314566:27221,15314567:27222,15314569:27223,15314570:27224,15314571:27225,15314573:27226,15314575:27227,15314576:27228,15314580:27229,15314586:27230,15314589:27231,15314590:27232,15314598:27233,15314599:27234,15314601:27235,15314604:27236,15314608:27237,15314609:27238,15314610:27239,15314615:27240,15314616:27241,15314619:27242,15314620:27243,15314622:27244,15314623:27245,15314817:27246,15314823:27247,15314824:27248,15314830:27249,15314832:27250,15314839:27251,15314840:27252,15314845:27253,15314847:27254,15314853:27255,15314855:27256,15314858:27257,15314859:27258,15314863:27259,15314867:27260,15314871:27261,15314872:27262,15314873:27425,15314874:27426,15314877:27427,15314879:27428,15315072:27429,15315074:27430,15315083:27431,15315087:27432,15315089:27433,15315094:27434,15315096:27435,15315097:27436,15315098:27437,15315100:27438,15315102:27439,15315106:27440,15315107:27441,15315110:27442,15315111:27443,15315112:27444,15315113:27445,15315114:27446,15315121:27447,15315125:27448,15315126:27449,15315127:27450,15315133:27451,15315329:27452,15315331:27453,15315332:27454,15315333:27455,15315337:27456,15315338:27457,15315342:27458,15315343:27459,15315344:27460,15315347:27461,15315348:27462,15315350:27463,15315352:27464,15315355:27465,15315357:27466,15315358:27467,15315359:27468,15315363:27469,15315369:27470,15315370:27471,15315356:27472,15315371:27473,15315368:27474,15315374:27475,15315376:27476,15315378:27477,15315381:27478,15315383:27479,15315387:27480,15315878:27481,15315890:27482,15315895:27483,15315897:27484,15316107:27485,15316098:27486,15316113:27487,15316119:27488,15316120:27489,15316124:27490,15316125:27491,15316126:27492,15316143:27493,15316144:27494,15316146:27495,15316147:27496,15316148:27497,15316154:27498,15316156:27499,15316357:27500,15316157:27501,15316354:27502,15316355:27503,15316359:27504,15316362:27505,15316371:27506,15316372:27507,15316383:27508,15316387:27509,15316386:27510,15316389:27511,15316393:27512,15316394:27513,15316395:27514,15316400:27515,15316406:27516,15316407:27517,15316411:27518,15316412:27681,15316414:27682,15316611:27683,15316612:27684,15316614:27685,15316618:27686,15316621:27687,15316622:27688,15316626:27689,15316627:27690,15316629:27691,15316630:27692,15316631:27693,15316632:27694,15316641:27695,15316650:27696,15316652:27697,15316654:27698,15316657:27699,15316661:27700,15316665:27701,15316668:27702,15316671:27703,15316867:27704,15316871:27705,15316873:27706,15316874:27707,15316884:27708,15316885:27709,15316886:27710,15316887:27711,15316890:27712,15316894:27713,15316895:27714,15316896:27715,15316901:27716,15316903:27717,15316905:27718,15316907:27719,15316910:27720,15316912:27721,15316915:27722,15316916:27723,15316926:27724,15317130:27725,15317122:27726,15317127:27727,15317134:27728,15317136:27729,15317137:27730,15317138:27731,15317141:27732,15317142:27733,15317145:27734,15317148:27735,15317149:27736,15317434:27737,15317435:27738,15317436:27739,15317632:27740,15317634:27741,15317635:27742,15317636:27743,15317637:27744,15317639:27745,15317646:27746,15317647:27747,15317654:27748,15317656:27749,15317659:27750,15317662:27751,15317668:27752,15317672:27753,15317676:27754,15317678:27755,15317679:27756,15317680:27757,15317683:27758,15317684:27759,15317685:27760,15317894:27761,15317896:27762,15317899:27763,15317909:27764,15317919:27765,15317924:27766,15317927:27767,15317932:27768,15317933:27769,15317934:27770,15317936:27771,15317937:27772,15317938:27773,15317941:27774,15317944:27937,15317951:27938,15318146:27939,15318147:27940,15318153:27941,15318159:27942,15318160:27943,15318161:27944,15318162:27945,15318164:27946,15318166:27947,15318167:27948,15318169:27949,15318170:27950,15318171:27951,15318175:27952,15318178:27953,15318182:27954,15318186:27955,15318187:27956,15318191:27957,15318193:27958,15318194:27959,15318196:27960,15318199:27961,15318201:27962,15318202:27963,15318204:27964,15318205:27965,15318207:27966,15318401:27967,15318403:27968,15318404:27969,15318405:27970,15318406:27971,15318407:27972,15318419:27973,15318421:27974,15318422:27975,15318423:27976,15318424:27977,15318426:27978,15318429:27979,15318430:27980,15318440:27981,15318441:27982,15318445:27983,15318446:27984,15318447:27985,15318448:27986,15318449:27987,15318451:27988,15318453:27989,15318458:27990,15318461:27991,15318671:27992,15318672:27993,15318673:27994,15318674:27995,15318676:27996,15318678:27997,15318679:27998,15318686:27999,15318689:28e3,15318690:28001,15318691:28002,15318693:28003,14909596:8513}},{}],12:[function(s,e,i){var r=s("./config"),o=String.fromCharCode,l=Array.prototype.slice,a=Object.prototype.toString,c=Object.prototype.hasOwnProperty,d=Array.isArray,u=Object.keys;function f(S){return d?d(S):a.call(S)==="[object Array]"}function m(S){if(u)return u(S);var D,k=[];for(D in S)c.call(S,D)&&(k[k.length]=D);return k}function h(S,D){if(r.HAS_TYPED)switch(S){case 8:return new Uint8Array(D);case 16:return new Uint16Array(D)}return new Array(D)}function _(S){if(r.CAN_CHARCODE_APPLY&&r.CAN_CHARCODE_APPLY_TYPED){var D=S&&S.length;if(D<r.APPLY_BUFFER_SIZE&&r.APPLY_BUFFER_SIZE_OK)return o.apply(null,S);if(r.APPLY_BUFFER_SIZE_OK===null)try{var k=o.apply(null,S);return D>r.APPLY_BUFFER_SIZE&&(r.APPLY_BUFFER_SIZE_OK=!0),k}catch{r.APPLY_BUFFER_SIZE_OK=!1}}return b(S)}function b(S){for(var D,k="",O=S&&S.length,L=0;L<O;){if(D=S.subarray?S.subarray(L,L+r.APPLY_BUFFER_SIZE):S.slice(L,L+r.APPLY_BUFFER_SIZE),L+=r.APPLY_BUFFER_SIZE,!r.APPLY_BUFFER_SIZE_OK){if(r.APPLY_BUFFER_SIZE_OK===null)try{k+=o.apply(null,D),D.length>r.APPLY_BUFFER_SIZE&&(r.APPLY_BUFFER_SIZE_OK=!0);continue}catch{r.APPLY_BUFFER_SIZE_OK=!1}return v(S)}k+=o.apply(null,D)}return k}function v(S){for(var D="",k=S&&S.length,O=0;O<k;O++)D+=o(S[O]);return D}i.isObject=function(S){var D=typeof S;return D=="function"||D=="object"&&!!S},i.isArray=f,i.isString=function(S){return typeof S=="string"||a.call(S)==="[object String]"},i.objectKeys=m,i.createBuffer=h,i.stringToBuffer=function(S){for(var D=S.length,k=h(16,D),O=0;O<D;O++)k[O]=S.charCodeAt(O);return k},i.codeToString_fast=_,i.codeToString_chunked=b,i.codeToString_slow=v,i.stringToCode=function(S){for(var D=[],k=S&&S.length,O=0;O<k;O++)D[O]=S.charCodeAt(O);return D},i.codeToBuffer=function(S){if(r.HAS_TYPED)return new Uint16Array(S);if(f(S))return S;for(var D=S&&S.length,k=[],O=0;O<D;O++)k[O]=S[O];return k},i.bufferToCode=function(S){return f(S)?S:l.call(S)},i.canonicalizeEncodingName=function(S){for(var D,k,O,L="",P=(""+S).toUpperCase().replace(/[^A-Z0-9]+/g,""),N=m(r.EncodingAliases),z=N.length,K=0,Z=0;Z<z;Z++){if((D=N[Z])===P){L=D;break}for(k=D.length,O=K;O<k;O++)D.slice(0,O)!==P.slice(0,O)&&D.slice(-O)!==P.slice(-O)||(L=D,K=O)}return c.call(r.EncodingAliases,L)?r.EncodingAliases[L]:L};var w=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],y=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],M=61;i.base64encode=function(S){for(var D,k,O,L=S&&S.length,P=0,N=[];P<L;){if(D=S[P++],P==L){N[N.length]=w[D>>2],N[N.length]=w[(3&D)<<4],N[N.length]=M,N[N.length]=M;break}if(k=S[P++],P==L){N[N.length]=w[D>>2],N[N.length]=w[(3&D)<<4|(240&k)>>4],N[N.length]=w[(15&k)<<2],N[N.length]=M;break}O=S[P++],N[N.length]=w[D>>2],N[N.length]=w[(3&D)<<4|(240&k)>>4],N[N.length]=w[(15&k)<<2|(192&O)>>6],N[N.length]=w[63&O]}return _(N)},i.base64decode=function(S){for(var D,k,O,L,P=S&&S.length,N=0,z=[];N<P;){for(;D=y[255&S.charCodeAt(N++)],N<P&&D==-1;);if(D==-1)break;for(;k=y[255&S.charCodeAt(N++)],N<P&&k==-1;);if(k==-1)break;z[z.length]=D<<2|(48&k)>>4;do if((O=255&S.charCodeAt(N++))==61)return z;while(O=y[O],N<P&&O==-1);if(O==-1)break;z[z.length]=(15&k)<<4|(60&O)>>2;do if((L=255&S.charCodeAt(N++))==61)return z;while(L=y[L],N<P&&L==-1);if(L==-1)break;z[z.length]=(3&O)<<6|L}return z}},{"./config":2}]},{},[6])(6)});function CharsetEncoder(){}CharsetEncoder.prototype.s2u=function(s){for(var e=this.s2uTable,i="",r=0;r<s.length;){var o=s[r++];if(!(o>=0&&o<=126||o>=161&&o<=223)&&r<s.length&&(o=o<<8|s[r++]),e[o]===void 0)return Encoding.codeToString(Encoding.convert(s,"UTF8"));i+=String.fromCharCode(e[o])}return i};CharsetEncoder.prototype.s2uTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:65340,33120:65374,33121:8741,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:65293,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:65504,33170:65505,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:65506,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34624:9312,34625:9313,34626:9314,34627:9315,34628:9316,34629:9317,34630:9318,34631:9319,34632:9320,34633:9321,34634:9322,34635:9323,34636:9324,34637:9325,34638:9326,34639:9327,34640:9328,34641:9329,34642:9330,34643:9331,34644:8544,34645:8545,34646:8546,34647:8547,34648:8548,34649:8549,34650:8550,34651:8551,34652:8552,34653:8553,34655:13129,34656:13076,34657:13090,34658:13133,34659:13080,34660:13095,34661:13059,34662:13110,34663:13137,34664:13143,34665:13069,34666:13094,34667:13091,34668:13099,34669:13130,34670:13115,34671:13212,34672:13213,34673:13214,34674:13198,34675:13199,34676:13252,34677:13217,34686:13179,34688:12317,34689:12319,34690:8470,34691:13261,34692:8481,34693:12964,34694:12965,34695:12966,34696:12967,34697:12968,34698:12849,34699:12850,34700:12857,34701:13182,34702:13181,34703:13180,34704:8786,34705:8801,34706:8747,34707:8750,34708:8721,34709:8730,34710:8869,34711:8736,34712:8735,34713:8895,34714:8757,34715:8745,34716:8746,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081,60736:32394,60737:35100,60738:37704,60739:37512,60740:34012,60741:20425,60742:28859,60743:26161,60744:26824,60745:37625,60746:26363,60747:24389,60748:20008,60749:20193,60750:20220,60751:20224,60752:20227,60753:20281,60754:20310,60755:20370,60756:20362,60757:20378,60758:20372,60759:20429,60760:20544,60761:20514,60762:20479,60763:20510,60764:20550,60765:20592,60766:20546,60767:20628,60768:20724,60769:20696,60770:20810,60771:20836,60772:20893,60773:20926,60774:20972,60775:21013,60776:21148,60777:21158,60778:21184,60779:21211,60780:21248,60781:21255,60782:21284,60783:21362,60784:21395,60785:21426,60786:21469,60787:64014,60788:21660,60789:21642,60790:21673,60791:21759,60792:21894,60793:22361,60794:22373,60795:22444,60796:22472,60797:22471,60798:64015,60800:64016,60801:22686,60802:22706,60803:22795,60804:22867,60805:22875,60806:22877,60807:22883,60808:22948,60809:22970,60810:23382,60811:23488,60812:29999,60813:23512,60814:23532,60815:23582,60816:23718,60817:23738,60818:23797,60819:23847,60820:23891,60821:64017,60822:23874,60823:23917,60824:23992,60825:23993,60826:24016,60827:24353,60828:24372,60829:24423,60830:24503,60831:24542,60832:24669,60833:24709,60834:24714,60835:24798,60836:24789,60837:24864,60838:24818,60839:24849,60840:24887,60841:24880,60842:24984,60843:25107,60844:25254,60845:25589,60846:25696,60847:25757,60848:25806,60849:25934,60850:26112,60851:26133,60852:26171,60853:26121,60854:26158,60855:26142,60856:26148,60857:26213,60858:26199,60859:26201,60860:64018,60861:26227,60862:26265,60863:26272,60864:26290,60865:26303,60866:26362,60867:26382,60868:63785,60869:26470,60870:26555,60871:26706,60872:26560,60873:26625,60874:26692,60875:26831,60876:64019,60877:26984,60878:64020,60879:27032,60880:27106,60881:27184,60882:27243,60883:27206,60884:27251,60885:27262,60886:27362,60887:27364,60888:27606,60889:27711,60890:27740,60891:27782,60892:27759,60893:27866,60894:27908,60895:28039,60896:28015,60897:28054,60898:28076,60899:28111,60900:28152,60901:28146,60902:28156,60903:28217,60904:28252,60905:28199,60906:28220,60907:28351,60908:28552,60909:28597,60910:28661,60911:28677,60912:28679,60913:28712,60914:28805,60915:28843,60916:28943,60917:28932,60918:29020,60919:28998,60920:28999,60921:64021,60922:29121,60923:29182,60924:29361,60992:29374,60993:29476,60994:64022,60995:29559,60996:29629,60997:29641,60998:29654,60999:29667,61e3:29650,61001:29703,61002:29685,61003:29734,61004:29738,61005:29737,61006:29742,61007:29794,61008:29833,61009:29855,61010:29953,61011:30063,61012:30338,61013:30364,61014:30366,61015:30363,61016:30374,61017:64023,61018:30534,61019:21167,61020:30753,61021:30798,61022:30820,61023:30842,61024:31024,61025:64024,61026:64025,61027:64026,61028:31124,61029:64027,61030:31131,61031:31441,61032:31463,61033:64028,61034:31467,61035:31646,61036:64029,61037:32072,61038:32092,61039:32183,61040:32160,61041:32214,61042:32338,61043:32583,61044:32673,61045:64030,61046:33537,61047:33634,61048:33663,61049:33735,61050:33782,61051:33864,61052:33972,61053:34131,61054:34137,61056:34155,61057:64031,61058:34224,61059:64032,61060:64033,61061:34823,61062:35061,61063:35346,61064:35383,61065:35449,61066:35495,61067:35518,61068:35551,61069:64034,61070:35574,61071:35667,61072:35711,61073:36080,61074:36084,61075:36114,61076:36214,61077:64035,61078:36559,61079:64036,61080:64037,61081:36967,61082:37086,61083:64038,61084:37141,61085:37159,61086:37338,61087:37335,61088:37342,61089:37357,61090:37358,61091:37348,61092:37349,61093:37382,61094:37392,61095:37386,61096:37434,61097:37440,61098:37436,61099:37454,61100:37465,61101:37457,61102:37433,61103:37479,61104:37543,61105:37495,61106:37496,61107:37607,61108:37591,61109:37593,61110:37584,61111:64039,61112:37589,61113:37600,61114:37587,61115:37669,61116:37665,61117:37627,61118:64040,61119:37662,61120:37631,61121:37661,61122:37634,61123:37744,61124:37719,61125:37796,61126:37830,61127:37854,61128:37880,61129:37937,61130:37957,61131:37960,61132:38290,61133:63964,61134:64041,61135:38557,61136:38575,61137:38707,61138:38715,61139:38723,61140:38733,61141:38735,61142:38737,61143:38741,61144:38999,61145:39013,61146:64042,61147:64043,61148:39207,61149:64044,61150:39326,61151:39502,61152:39641,61153:39644,61154:39797,61155:39794,61156:39823,61157:39857,61158:39867,61159:39936,61160:40304,61161:40299,61162:64045,61163:40473,61164:40657,61167:8560,61168:8561,61169:8562,61170:8563,61171:8564,61172:8565,61173:8566,61174:8567,61175:8568,61176:8569,61177:65506,61178:65508,61179:65287,61180:65282,61504:57344,61505:57345,61506:57346,61507:57347,61508:57348,61509:57349,61510:57350,61511:57351,61512:57352,61513:57353,61514:57354,61515:57355,61516:57356,61517:57357,61518:57358,61519:57359,61520:57360,61521:57361,61522:57362,61523:57363,61524:57364,61525:57365,61526:57366,61527:57367,61528:57368,61529:57369,61530:57370,61531:57371,61532:57372,61533:57373,61534:57374,61535:57375,61536:57376,61537:57377,61538:57378,61539:57379,61540:57380,61541:57381,61542:57382,61543:57383,61544:57384,61545:57385,61546:57386,61547:57387,61548:57388,61549:57389,61550:57390,61551:57391,61552:57392,61553:57393,61554:57394,61555:57395,61556:57396,61557:57397,61558:57398,61559:57399,61560:57400,61561:57401,61562:57402,61563:57403,61564:57404,61565:57405,61566:57406,61568:57407,61569:57408,61570:57409,61571:57410,61572:57411,61573:57412,61574:57413,61575:57414,61576:57415,61577:57416,61578:57417,61579:57418,61580:57419,61581:57420,61582:57421,61583:57422,61584:57423,61585:57424,61586:57425,61587:57426,61588:57427,61589:57428,61590:57429,61591:57430,61592:57431,61593:57432,61594:57433,61595:57434,61596:57435,61597:57436,61598:57437,61599:57438,61600:57439,61601:57440,61602:57441,61603:57442,61604:57443,61605:57444,61606:57445,61607:57446,61608:57447,61609:57448,61610:57449,61611:57450,61612:57451,61613:57452,61614:57453,61615:57454,61616:57455,61617:57456,61618:57457,61619:57458,61620:57459,61621:57460,61622:57461,61623:57462,61624:57463,61625:57464,61626:57465,61627:57466,61628:57467,61629:57468,61630:57469,61631:57470,61632:57471,61633:57472,61634:57473,61635:57474,61636:57475,61637:57476,61638:57477,61639:57478,61640:57479,61641:57480,61642:57481,61643:57482,61644:57483,61645:57484,61646:57485,61647:57486,61648:57487,61649:57488,61650:57489,61651:57490,61652:57491,61653:57492,61654:57493,61655:57494,61656:57495,61657:57496,61658:57497,61659:57498,61660:57499,61661:57500,61662:57501,61663:57502,61664:57503,61665:57504,61666:57505,61667:57506,61668:57507,61669:57508,61670:57509,61671:57510,61672:57511,61673:57512,61674:57513,61675:57514,61676:57515,61677:57516,61678:57517,61679:57518,61680:57519,61681:57520,61682:57521,61683:57522,61684:57523,61685:57524,61686:57525,61687:57526,61688:57527,61689:57528,61690:57529,61691:57530,61692:57531,61760:57532,61761:57533,61762:57534,61763:57535,61764:57536,61765:57537,61766:57538,61767:57539,61768:57540,61769:57541,61770:57542,61771:57543,61772:57544,61773:57545,61774:57546,61775:57547,61776:57548,61777:57549,61778:57550,61779:57551,61780:57552,61781:57553,61782:57554,61783:57555,61784:57556,61785:57557,61786:57558,61787:57559,61788:57560,61789:57561,61790:57562,61791:57563,61792:57564,61793:57565,61794:57566,61795:57567,61796:57568,61797:57569,61798:57570,61799:57571,61800:57572,61801:57573,61802:57574,61803:57575,61804:57576,61805:57577,61806:57578,61807:57579,61808:57580,61809:57581,61810:57582,61811:57583,61812:57584,61813:57585,61814:57586,61815:57587,61816:57588,61817:57589,61818:57590,61819:57591,61820:57592,61821:57593,61822:57594,61824:57595,61825:57596,61826:57597,61827:57598,61828:57599,61829:57600,61830:57601,61831:57602,61832:57603,61833:57604,61834:57605,61835:57606,61836:57607,61837:57608,61838:57609,61839:57610,61840:57611,61841:57612,61842:57613,61843:57614,61844:57615,61845:57616,61846:57617,61847:57618,61848:57619,61849:57620,61850:57621,61851:57622,61852:57623,61853:57624,61854:57625,61855:57626,61856:57627,61857:57628,61858:57629,61859:57630,61860:57631,61861:57632,61862:57633,61863:57634,61864:57635,61865:57636,61866:57637,61867:57638,61868:57639,61869:57640,61870:57641,61871:57642,61872:57643,61873:57644,61874:57645,61875:57646,61876:57647,61877:57648,61878:57649,61879:57650,61880:57651,61881:57652,61882:57653,61883:57654,61884:57655,61885:57656,61886:57657,61887:57658,61888:57659,61889:57660,61890:57661,61891:57662,61892:57663,61893:57664,61894:57665,61895:57666,61896:57667,61897:57668,61898:57669,61899:57670,61900:57671,61901:57672,61902:57673,61903:57674,61904:57675,61905:57676,61906:57677,61907:57678,61908:57679,61909:57680,61910:57681,61911:57682,61912:57683,61913:57684,61914:57685,61915:57686,61916:57687,61917:57688,61918:57689,61919:57690,61920:57691,61921:57692,61922:57693,61923:57694,61924:57695,61925:57696,61926:57697,61927:57698,61928:57699,61929:57700,61930:57701,61931:57702,61932:57703,61933:57704,61934:57705,61935:57706,61936:57707,61937:57708,61938:57709,61939:57710,61940:57711,61941:57712,61942:57713,61943:57714,61944:57715,61945:57716,61946:57717,61947:57718,61948:57719,62016:57720,62017:57721,62018:57722,62019:57723,62020:57724,62021:57725,62022:57726,62023:57727,62024:57728,62025:57729,62026:57730,62027:57731,62028:57732,62029:57733,62030:57734,62031:57735,62032:57736,62033:57737,62034:57738,62035:57739,62036:57740,62037:57741,62038:57742,62039:57743,62040:57744,62041:57745,62042:57746,62043:57747,62044:57748,62045:57749,62046:57750,62047:57751,62048:57752,62049:57753,62050:57754,62051:57755,62052:57756,62053:57757,62054:57758,62055:57759,62056:57760,62057:57761,62058:57762,62059:57763,62060:57764,62061:57765,62062:57766,62063:57767,62064:57768,62065:57769,62066:57770,62067:57771,62068:57772,62069:57773,62070:57774,62071:57775,62072:57776,62073:57777,62074:57778,62075:57779,62076:57780,62077:57781,62078:57782,62080:57783,62081:57784,62082:57785,62083:57786,62084:57787,62085:57788,62086:57789,62087:57790,62088:57791,62089:57792,62090:57793,62091:57794,62092:57795,62093:57796,62094:57797,62095:57798,62096:57799,62097:57800,62098:57801,62099:57802,62100:57803,62101:57804,62102:57805,62103:57806,62104:57807,62105:57808,62106:57809,62107:57810,62108:57811,62109:57812,62110:57813,62111:57814,62112:57815,62113:57816,62114:57817,62115:57818,62116:57819,62117:57820,62118:57821,62119:57822,62120:57823,62121:57824,62122:57825,62123:57826,62124:57827,62125:57828,62126:57829,62127:57830,62128:57831,62129:57832,62130:57833,62131:57834,62132:57835,62133:57836,62134:57837,62135:57838,62136:57839,62137:57840,62138:57841,62139:57842,62140:57843,62141:57844,62142:57845,62143:57846,62144:57847,62145:57848,62146:57849,62147:57850,62148:57851,62149:57852,62150:57853,62151:57854,62152:57855,62153:57856,62154:57857,62155:57858,62156:57859,62157:57860,62158:57861,62159:57862,62160:57863,62161:57864,62162:57865,62163:57866,62164:57867,62165:57868,62166:57869,62167:57870,62168:57871,62169:57872,62170:57873,62171:57874,62172:57875,62173:57876,62174:57877,62175:57878,62176:57879,62177:57880,62178:57881,62179:57882,62180:57883,62181:57884,62182:57885,62183:57886,62184:57887,62185:57888,62186:57889,62187:57890,62188:57891,62189:57892,62190:57893,62191:57894,62192:57895,62193:57896,62194:57897,62195:57898,62196:57899,62197:57900,62198:57901,62199:57902,62200:57903,62201:57904,62202:57905,62203:57906,62204:57907,62272:57908,62273:57909,62274:57910,62275:57911,62276:57912,62277:57913,62278:57914,62279:57915,62280:57916,62281:57917,62282:57918,62283:57919,62284:57920,62285:57921,62286:57922,62287:57923,62288:57924,62289:57925,62290:57926,62291:57927,62292:57928,62293:57929,62294:57930,62295:57931,62296:57932,62297:57933,62298:57934,62299:57935,62300:57936,62301:57937,62302:57938,62303:57939,62304:57940,62305:57941,62306:57942,62307:57943,62308:57944,62309:57945,62310:57946,62311:57947,62312:57948,62313:57949,62314:57950,62315:57951,62316:57952,62317:57953,62318:57954,62319:57955,62320:57956,62321:57957,62322:57958,62323:57959,62324:57960,62325:57961,62326:57962,62327:57963,62328:57964,62329:57965,62330:57966,62331:57967,62332:57968,62333:57969,62334:57970,62336:57971,62337:57972,62338:57973,62339:57974,62340:57975,62341:57976,62342:57977,62343:57978,62344:57979,62345:57980,62346:57981,62347:57982,62348:57983,62349:57984,62350:57985,62351:57986,62352:57987,62353:57988,62354:57989,62355:57990,62356:57991,62357:57992,62358:57993,62359:57994,62360:57995,62361:57996,62362:57997,62363:57998,62364:57999,62365:58e3,62366:58001,62367:58002,62368:58003,62369:58004,62370:58005,62371:58006,62372:58007,62373:58008,62374:58009,62375:58010,62376:58011,62377:58012,62378:58013,62379:58014,62380:58015,62381:58016,62382:58017,62383:58018,62384:58019,62385:58020,62386:58021,62387:58022,62388:58023,62389:58024,62390:58025,62391:58026,62392:58027,62393:58028,62394:58029,62395:58030,62396:58031,62397:58032,62398:58033,62399:58034,62400:58035,62401:58036,62402:58037,62403:58038,62404:58039,62405:58040,62406:58041,62407:58042,62408:58043,62409:58044,62410:58045,62411:58046,62412:58047,62413:58048,62414:58049,62415:58050,62416:58051,62417:58052,62418:58053,62419:58054,62420:58055,62421:58056,62422:58057,62423:58058,62424:58059,62425:58060,62426:58061,62427:58062,62428:58063,62429:58064,62430:58065,62431:58066,62432:58067,62433:58068,62434:58069,62435:58070,62436:58071,62437:58072,62438:58073,62439:58074,62440:58075,62441:58076,62442:58077,62443:58078,62444:58079,62445:58080,62446:58081,62447:58082,62448:58083,62449:58084,62450:58085,62451:58086,62452:58087,62453:58088,62454:58089,62455:58090,62456:58091,62457:58092,62458:58093,62459:58094,62460:58095,62528:58096,62529:58097,62530:58098,62531:58099,62532:58100,62533:58101,62534:58102,62535:58103,62536:58104,62537:58105,62538:58106,62539:58107,62540:58108,62541:58109,62542:58110,62543:58111,62544:58112,62545:58113,62546:58114,62547:58115,62548:58116,62549:58117,62550:58118,62551:58119,62552:58120,62553:58121,62554:58122,62555:58123,62556:58124,62557:58125,62558:58126,62559:58127,62560:58128,62561:58129,62562:58130,62563:58131,62564:58132,62565:58133,62566:58134,62567:58135,62568:58136,62569:58137,62570:58138,62571:58139,62572:58140,62573:58141,62574:58142,62575:58143,62576:58144,62577:58145,62578:58146,62579:58147,62580:58148,62581:58149,62582:58150,62583:58151,62584:58152,62585:58153,62586:58154,62587:58155,62588:58156,62589:58157,62590:58158,62592:58159,62593:58160,62594:58161,62595:58162,62596:58163,62597:58164,62598:58165,62599:58166,62600:58167,62601:58168,62602:58169,62603:58170,62604:58171,62605:58172,62606:58173,62607:58174,62608:58175,62609:58176,62610:58177,62611:58178,62612:58179,62613:58180,62614:58181,62615:58182,62616:58183,62617:58184,62618:58185,62619:58186,62620:58187,62621:58188,62622:58189,62623:58190,62624:58191,62625:58192,62626:58193,62627:58194,62628:58195,62629:58196,62630:58197,62631:58198,62632:58199,62633:58200,62634:58201,62635:58202,62636:58203,62637:58204,62638:58205,62639:58206,62640:58207,62641:58208,62642:58209,62643:58210,62644:58211,62645:58212,62646:58213,62647:58214,62648:58215,62649:58216,62650:58217,62651:58218,62652:58219,62653:58220,62654:58221,62655:58222,62656:58223,62657:58224,62658:58225,62659:58226,62660:58227,62661:58228,62662:58229,62663:58230,62664:58231,62665:58232,62666:58233,62667:58234,62668:58235,62669:58236,62670:58237,62671:58238,62672:58239,62673:58240,62674:58241,62675:58242,62676:58243,62677:58244,62678:58245,62679:58246,62680:58247,62681:58248,62682:58249,62683:58250,62684:58251,62685:58252,62686:58253,62687:58254,62688:58255,62689:58256,62690:58257,62691:58258,62692:58259,62693:58260,62694:58261,62695:58262,62696:58263,62697:58264,62698:58265,62699:58266,62700:58267,62701:58268,62702:58269,62703:58270,62704:58271,62705:58272,62706:58273,62707:58274,62708:58275,62709:58276,62710:58277,62711:58278,62712:58279,62713:58280,62714:58281,62715:58282,62716:58283,62784:58284,62785:58285,62786:58286,62787:58287,62788:58288,62789:58289,62790:58290,62791:58291,62792:58292,62793:58293,62794:58294,62795:58295,62796:58296,62797:58297,62798:58298,62799:58299,62800:58300,62801:58301,62802:58302,62803:58303,62804:58304,62805:58305,62806:58306,62807:58307,62808:58308,62809:58309,62810:58310,62811:58311,62812:58312,62813:58313,62814:58314,62815:58315,62816:58316,62817:58317,62818:58318,62819:58319,62820:58320,62821:58321,62822:58322,62823:58323,62824:58324,62825:58325,62826:58326,62827:58327,62828:58328,62829:58329,62830:58330,62831:58331,62832:58332,62833:58333,62834:58334,62835:58335,62836:58336,62837:58337,62838:58338,62839:58339,62840:58340,62841:58341,62842:58342,62843:58343,62844:58344,62845:58345,62846:58346,62848:58347,62849:58348,62850:58349,62851:58350,62852:58351,62853:58352,62854:58353,62855:58354,62856:58355,62857:58356,62858:58357,62859:58358,62860:58359,62861:58360,62862:58361,62863:58362,62864:58363,62865:58364,62866:58365,62867:58366,62868:58367,62869:58368,62870:58369,62871:58370,62872:58371,62873:58372,62874:58373,62875:58374,62876:58375,62877:58376,62878:58377,62879:58378,62880:58379,62881:58380,62882:58381,62883:58382,62884:58383,62885:58384,62886:58385,62887:58386,62888:58387,62889:58388,62890:58389,62891:58390,62892:58391,62893:58392,62894:58393,62895:58394,62896:58395,62897:58396,62898:58397,62899:58398,62900:58399,62901:58400,62902:58401,62903:58402,62904:58403,62905:58404,62906:58405,62907:58406,62908:58407,62909:58408,62910:58409,62911:58410,62912:58411,62913:58412,62914:58413,62915:58414,62916:58415,62917:58416,62918:58417,62919:58418,62920:58419,62921:58420,62922:58421,62923:58422,62924:58423,62925:58424,62926:58425,62927:58426,62928:58427,62929:58428,62930:58429,62931:58430,62932:58431,62933:58432,62934:58433,62935:58434,62936:58435,62937:58436,62938:58437,62939:58438,62940:58439,62941:58440,62942:58441,62943:58442,62944:58443,62945:58444,62946:58445,62947:58446,62948:58447,62949:58448,62950:58449,62951:58450,62952:58451,62953:58452,62954:58453,62955:58454,62956:58455,62957:58456,62958:58457,62959:58458,62960:58459,62961:58460,62962:58461,62963:58462,62964:58463,62965:58464,62966:58465,62967:58466,62968:58467,62969:58468,62970:58469,62971:58470,62972:58471,63040:58472,63041:58473,63042:58474,63043:58475,63044:58476,63045:58477,63046:58478,63047:58479,63048:58480,63049:58481,63050:58482,63051:58483,63052:58484,63053:58485,63054:58486,63055:58487,63056:58488,63057:58489,63058:58490,63059:58491,63060:58492,63061:58493,63062:58494,63063:58495,63064:58496,63065:58497,63066:58498,63067:58499,63068:58500,63069:58501,63070:58502,63071:58503,63072:58504,63073:58505,63074:58506,63075:58507,63076:58508,63077:58509,63078:58510,63079:58511,63080:58512,63081:58513,63082:58514,63083:58515,63084:58516,63085:58517,63086:58518,63087:58519,63088:58520,63089:58521,63090:58522,63091:58523,63092:58524,63093:58525,63094:58526,63095:58527,63096:58528,63097:58529,63098:58530,63099:58531,63100:58532,63101:58533,63102:58534,63104:58535,63105:58536,63106:58537,63107:58538,63108:58539,63109:58540,63110:58541,63111:58542,63112:58543,63113:58544,63114:58545,63115:58546,63116:58547,63117:58548,63118:58549,63119:58550,63120:58551,63121:58552,63122:58553,63123:58554,63124:58555,63125:58556,63126:58557,63127:58558,63128:58559,63129:58560,63130:58561,63131:58562,63132:58563,63133:58564,63134:58565,63135:58566,63136:58567,63137:58568,63138:58569,63139:58570,63140:58571,63141:58572,63142:58573,63143:58574,63144:58575,63145:58576,63146:58577,63147:58578,63148:58579,63149:58580,63150:58581,63151:58582,63152:58583,63153:58584,63154:58585,63155:58586,63156:58587,63157:58588,63158:58589,63159:58590,63160:58591,63161:58592,63162:58593,63163:58594,63164:58595,63165:58596,63166:58597,63167:58598,63168:58599,63169:58600,63170:58601,63171:58602,63172:58603,63173:58604,63174:58605,63175:58606,63176:58607,63177:58608,63178:58609,63179:58610,63180:58611,63181:58612,63182:58613,63183:58614,63184:58615,63185:58616,63186:58617,63187:58618,63188:58619,63189:58620,63190:58621,63191:58622,63192:58623,63193:58624,63194:58625,63195:58626,63196:58627,63197:58628,63198:58629,63199:58630,63200:58631,63201:58632,63202:58633,63203:58634,63204:58635,63205:58636,63206:58637,63207:58638,63208:58639,63209:58640,63210:58641,63211:58642,63212:58643,63213:58644,63214:58645,63215:58646,63216:58647,63217:58648,63218:58649,63219:58650,63220:58651,63221:58652,63222:58653,63223:58654,63224:58655,63225:58656,63226:58657,63227:58658,63228:58659,63296:58660,63297:58661,63298:58662,63299:58663,63300:58664,63301:58665,63302:58666,63303:58667,63304:58668,63305:58669,63306:58670,63307:58671,63308:58672,63309:58673,63310:58674,63311:58675,63312:58676,63313:58677,63314:58678,63315:58679,63316:58680,63317:58681,63318:58682,63319:58683,63320:58684,63321:58685,63322:58686,63323:58687,63324:58688,63325:58689,63326:58690,63327:58691,63328:58692,63329:58693,63330:58694,63331:58695,63332:58696,63333:58697,63334:58698,63335:58699,63336:58700,63337:58701,63338:58702,63339:58703,63340:58704,63341:58705,63342:58706,63343:58707,63344:58708,63345:58709,63346:58710,63347:58711,63348:58712,63349:58713,63350:58714,63351:58715,63352:58716,63353:58717,63354:58718,63355:58719,63356:58720,63357:58721,63358:58722,63360:58723,63361:58724,63362:58725,63363:58726,63364:58727,63365:58728,63366:58729,63367:58730,63368:58731,63369:58732,63370:58733,63371:58734,63372:58735,63373:58736,63374:58737,63375:58738,63376:58739,63377:58740,63378:58741,63379:58742,63380:58743,63381:58744,63382:58745,63383:58746,63384:58747,63385:58748,63386:58749,63387:58750,63388:58751,63389:58752,63390:58753,63391:58754,63392:58755,63393:58756,63394:58757,63395:58758,63396:58759,63397:58760,63398:58761,63399:58762,63400:58763,63401:58764,63402:58765,63403:58766,63404:58767,63405:58768,63406:58769,63407:58770,63408:58771,63409:58772,63410:58773,63411:58774,63412:58775,63413:58776,63414:58777,63415:58778,63416:58779,63417:58780,63418:58781,63419:58782,63420:58783,63421:58784,63422:58785,63423:58786,63424:58787,63425:58788,63426:58789,63427:58790,63428:58791,63429:58792,63430:58793,63431:58794,63432:58795,63433:58796,63434:58797,63435:58798,63436:58799,63437:58800,63438:58801,63439:58802,63440:58803,63441:58804,63442:58805,63443:58806,63444:58807,63445:58808,63446:58809,63447:58810,63448:58811,63449:58812,63450:58813,63451:58814,63452:58815,63453:58816,63454:58817,63455:58818,63456:58819,63457:58820,63458:58821,63459:58822,63460:58823,63461:58824,63462:58825,63463:58826,63464:58827,63465:58828,63466:58829,63467:58830,63468:58831,63469:58832,63470:58833,63471:58834,63472:58835,63473:58836,63474:58837,63475:58838,63476:58839,63477:58840,63478:58841,63479:58842,63480:58843,63481:58844,63482:58845,63483:58846,63484:58847,63552:58848,63553:58849,63554:58850,63555:58851,63556:58852,63557:58853,63558:58854,63559:58855,63560:58856,63561:58857,63562:58858,63563:58859,63564:58860,63565:58861,63566:58862,63567:58863,63568:58864,63569:58865,63570:58866,63571:58867,63572:58868,63573:58869,63574:58870,63575:58871,63576:58872,63577:58873,63578:58874,63579:58875,63580:58876,63581:58877,63582:58878,63583:58879,63584:58880,63585:58881,63586:58882,63587:58883,63588:58884,63589:58885,63590:58886,63591:58887,63592:58888,63593:58889,63594:58890,63595:58891,63596:58892,63597:58893,63598:58894,63599:58895,63600:58896,63601:58897,63602:58898,63603:58899,63604:58900,63605:58901,63606:58902,63607:58903,63608:58904,63609:58905,63610:58906,63611:58907,63612:58908,63613:58909,63614:58910,63616:58911,63617:58912,63618:58913,63619:58914,63620:58915,63621:58916,63622:58917,63623:58918,63624:58919,63625:58920,63626:58921,63627:58922,63628:58923,63629:58924,63630:58925,63631:58926,63632:58927,63633:58928,63634:58929,63635:58930,63636:58931,63637:58932,63638:58933,63639:58934,63640:58935,63641:58936,63642:58937,63643:58938,63644:58939,63645:58940,63646:58941,63647:58942,63648:58943,63649:58944,63650:58945,63651:58946,63652:58947,63653:58948,63654:58949,63655:58950,63656:58951,63657:58952,63658:58953,63659:58954,63660:58955,63661:58956,63662:58957,63663:58958,63664:58959,63665:58960,63666:58961,63667:58962,63668:58963,63669:58964,63670:58965,63671:58966,63672:58967,63673:58968,63674:58969,63675:58970,63676:58971,63677:58972,63678:58973,63679:58974,63680:58975,63681:58976,63682:58977,63683:58978,63684:58979,63685:58980,63686:58981,63687:58982,63688:58983,63689:58984,63690:58985,63691:58986,63692:58987,63693:58988,63694:58989,63695:58990,63696:58991,63697:58992,63698:58993,63699:58994,63700:58995,63701:58996,63702:58997,63703:58998,63704:58999,63705:59e3,63706:59001,63707:59002,63708:59003,63709:59004,63710:59005,63711:59006,63712:59007,63713:59008,63714:59009,63715:59010,63716:59011,63717:59012,63718:59013,63719:59014,63720:59015,63721:59016,63722:59017,63723:59018,63724:59019,63725:59020,63726:59021,63727:59022,63728:59023,63729:59024,63730:59025,63731:59026,63732:59027,63733:59028,63734:59029,63735:59030,63736:59031,63737:59032,63738:59033,63739:59034,63740:59035,64064:8560,64065:8561,64066:8562,64067:8563,64068:8564,64069:8565,64070:8566,64071:8567,64072:8568,64073:8569,64074:8544,64075:8545,64076:8546,64077:8547,64078:8548,64079:8549,64080:8550,64081:8551,64082:8552,64083:8553,64084:65506,64085:65508,64086:65287,64087:65282,64088:12849,64089:8470,64090:8481,64091:8757,64092:32394,64093:35100,64094:37704,64095:37512,64096:34012,64097:20425,64098:28859,64099:26161,64100:26824,64101:37625,64102:26363,64103:24389,64104:20008,64105:20193,64106:20220,64107:20224,64108:20227,64109:20281,64110:20310,64111:20370,64112:20362,64113:20378,64114:20372,64115:20429,64116:20544,64117:20514,64118:20479,64119:20510,64120:20550,64121:20592,64122:20546,64123:20628,64124:20724,64125:20696,64126:20810,64128:20836,64129:20893,64130:20926,64131:20972,64132:21013,64133:21148,64134:21158,64135:21184,64136:21211,64137:21248,64138:21255,64139:21284,64140:21362,64141:21395,64142:21426,64143:21469,64144:64014,64145:21660,64146:21642,64147:21673,64148:21759,64149:21894,64150:22361,64151:22373,64152:22444,64153:22472,64154:22471,64155:64015,64156:64016,64157:22686,64158:22706,64159:22795,64160:22867,64161:22875,64162:22877,64163:22883,64164:22948,64165:22970,64166:23382,64167:23488,64168:29999,64169:23512,64170:23532,64171:23582,64172:23718,64173:23738,64174:23797,64175:23847,64176:23891,64177:64017,64178:23874,64179:23917,64180:23992,64181:23993,64182:24016,64183:24353,64184:24372,64185:24423,64186:24503,64187:24542,64188:24669,64189:24709,64190:24714,64191:24798,64192:24789,64193:24864,64194:24818,64195:24849,64196:24887,64197:24880,64198:24984,64199:25107,64200:25254,64201:25589,64202:25696,64203:25757,64204:25806,64205:25934,64206:26112,64207:26133,64208:26171,64209:26121,64210:26158,64211:26142,64212:26148,64213:26213,64214:26199,64215:26201,64216:64018,64217:26227,64218:26265,64219:26272,64220:26290,64221:26303,64222:26362,64223:26382,64224:63785,64225:26470,64226:26555,64227:26706,64228:26560,64229:26625,64230:26692,64231:26831,64232:64019,64233:26984,64234:64020,64235:27032,64236:27106,64237:27184,64238:27243,64239:27206,64240:27251,64241:27262,64242:27362,64243:27364,64244:27606,64245:27711,64246:27740,64247:27782,64248:27759,64249:27866,64250:27908,64251:28039,64252:28015,64320:28054,64321:28076,64322:28111,64323:28152,64324:28146,64325:28156,64326:28217,64327:28252,64328:28199,64329:28220,64330:28351,64331:28552,64332:28597,64333:28661,64334:28677,64335:28679,64336:28712,64337:28805,64338:28843,64339:28943,64340:28932,64341:29020,64342:28998,64343:28999,64344:64021,64345:29121,64346:29182,64347:29361,64348:29374,64349:29476,64350:64022,64351:29559,64352:29629,64353:29641,64354:29654,64355:29667,64356:29650,64357:29703,64358:29685,64359:29734,64360:29738,64361:29737,64362:29742,64363:29794,64364:29833,64365:29855,64366:29953,64367:30063,64368:30338,64369:30364,64370:30366,64371:30363,64372:30374,64373:64023,64374:30534,64375:21167,64376:30753,64377:30798,64378:30820,64379:30842,64380:31024,64381:64024,64382:64025,64384:64026,64385:31124,64386:64027,64387:31131,64388:31441,64389:31463,64390:64028,64391:31467,64392:31646,64393:64029,64394:32072,64395:32092,64396:32183,64397:32160,64398:32214,64399:32338,64400:32583,64401:32673,64402:64030,64403:33537,64404:33634,64405:33663,64406:33735,64407:33782,64408:33864,64409:33972,64410:34131,64411:34137,64412:34155,64413:64031,64414:34224,64415:64032,64416:64033,64417:34823,64418:35061,64419:35346,64420:35383,64421:35449,64422:35495,64423:35518,64424:35551,64425:64034,64426:35574,64427:35667,64428:35711,64429:36080,64430:36084,64431:36114,64432:36214,64433:64035,64434:36559,64435:64036,64436:64037,64437:36967,64438:37086,64439:64038,64440:37141,64441:37159,64442:37338,64443:37335,64444:37342,64445:37357,64446:37358,64447:37348,64448:37349,64449:37382,64450:37392,64451:37386,64452:37434,64453:37440,64454:37436,64455:37454,64456:37465,64457:37457,64458:37433,64459:37479,64460:37543,64461:37495,64462:37496,64463:37607,64464:37591,64465:37593,64466:37584,64467:64039,64468:37589,64469:37600,64470:37587,64471:37669,64472:37665,64473:37627,64474:64040,64475:37662,64476:37631,64477:37661,64478:37634,64479:37744,64480:37719,64481:37796,64482:37830,64483:37854,64484:37880,64485:37937,64486:37957,64487:37960,64488:38290,64489:63964,64490:64041,64491:38557,64492:38575,64493:38707,64494:38715,64495:38723,64496:38733,64497:38735,64498:38737,64499:38741,64500:38999,64501:39013,64502:64042,64503:64043,64504:39207,64505:64044,64506:39326,64507:39502,64508:39641,64576:39644,64577:39797,64578:39794,64579:39823,64580:39857,64581:39867,64582:39936,64583:40304,64584:40299,64585:64045,64586:40473,64587:40657};function DataViewEx(s,e){this.dv=new DataView(s),this.offset=0,this.littleEndian=e!==void 0?e:!0,this.encoder=new CharsetEncoder}DataViewEx.prototype={constructor:DataViewEx,getInt8:function(){var s=this.dv.getInt8(this.offset);return this.offset+=1,s},getInt8Array:function(s){for(var e=[],i=0;i<s;i++)e.push(this.getInt8());return e},getUint8:function(){var s=this.dv.getUint8(this.offset);return this.offset+=1,s},getUint8Array:function(s){for(var e=[],i=0;i<s;i++)e.push(this.getUint8());return e},getInt16:function(){var s=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,s},getInt16Array:function(s){for(var e=[],i=0;i<s;i++)e.push(this.getInt16());return e},getUint16:function(){var s=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,s},getUint16Array:function(s){for(var e=[],i=0;i<s;i++)e.push(this.getUint16());return e},getInt32:function(){var s=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,s},getInt32Array:function(s){for(var e=[],i=0;i<s;i++)e.push(this.getInt32());return e},getUint32:function(){var s=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,s},getUint32Array:function(s){for(var e=[],i=0;i<s;i++)e.push(this.getUint32());return e},getFloat32:function(){var s=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,s},getFloat32Array:function(s){for(var e=[],i=0;i<s;i++)e.push(this.getFloat32());return e},getFloat64:function(){var s=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,s},getFloat64Array:function(s){for(var e=[],i=0;i<s;i++)e.push(this.getFloat64());return e},getIndex:function(s,e){switch(s){case 1:return e===!0?this.getUint8():this.getInt8();case 2:return e===!0?this.getUint16():this.getInt16();case 4:return this.getInt32();default:throw"unknown number type "+s+" exception."}},getIndexArray:function(s,e,i){for(var r=[],o=0;o<e;o++)r.push(this.getIndex(s,i));return r},getChars:function(s){for(var e="";s>0;){var i=this.getUint8();if(s--,i===0)break;e+=String.fromCharCode(i)}for(;s>0;)this.getUint8(),s--;return e},getSjisStringsAsUnicode:function(s){for(var e=[];s>0;){var i=this.getUint8();if(s--,i===0)break;e.push(i)}for(;s>0;)this.getUint8(),s--;return this.encoder.s2u(new Uint8Array(e))},getUnicodeStrings:function(s){for(var e="";s>0;){var i=this.getUint16();if(s-=2,i===0)break;e+=String.fromCharCode(i)}for(;s>0;)this.getUint8(),s--;return e},getTextBuffer:function(){var s=this.getUint32();return this.getUnicodeStrings(s)}};function DataCreationHelper(){}DataCreationHelper.prototype={constructor:DataCreationHelper,leftToRightVector3:function(s){s[2]=-s[2]},leftToRightQuaternion:function(s){s[0]=-s[0],s[1]=-s[1]},leftToRightEuler:function(s){s[0]=-s[0],s[1]=-s[1]},leftToRightIndexOrder:function(s){var e=s[2];s[2]=s[0],s[0]=e},leftToRightVector3Range:function(s,e){var i=-e[2];e[2]=-s[2],s[2]=i},leftToRightEulerRange:function(s,e){var i=-e[0],r=-e[1];e[0]=-s[0],e[1]=-s[1],s[0]=i,s[1]=r}};function Parser(){}Parser.prototype.parsePmd=function(s,e){var i={},r=new DataViewEx(s);i.metadata={},i.metadata.format="pmd",i.metadata.coordinateSystem="left";var o=function(){var k=i.metadata;if(k.magic=r.getChars(3),k.magic!=="Pmd")throw"PMD file magic is not Pmd, but "+k.magic;k.version=r.getFloat32(),k.modelName=r.getSjisStringsAsUnicode(20),k.comment=r.getSjisStringsAsUnicode(256)};let l=function(){const k=i.metadata;k.vertexCount=r.getUint32();const O=i.vertices=new Array(k.vertexCount);for(let L=0,P=k.vertexCount;L<P;++L){let N={};N.position=r.getFloat32Array(3),N.normal=r.getFloat32Array(3),N.uv=r.getFloat32Array(2),N.skinIndices=r.getUint16Array(2),N.skinWeights=[r.getUint8()/100],N.skinWeights.push(1-N.skinWeights[0]),N.edgeFlag=r.getUint8(),O[L]=N}};var a=function(){const k=i.metadata;k.faceCount=r.getUint32()/3;let O=i.faces=new Array(k.faceCount);for(let L=0,P=k.faceCount;L<P;++L)O[L]={indices:r.getUint16Array(3)}},c=function(){var k=function(){var P={};return P.diffuse=r.getFloat32Array(4),P.shininess=r.getFloat32(),P.specular=r.getFloat32Array(3),P.ambient=r.getFloat32Array(3),P.toonIndex=r.getInt8(),P.edgeFlag=r.getUint8(),P.faceCount=r.getUint32()/3,P.fileName=r.getSjisStringsAsUnicode(20),P},O=i.metadata;O.materialCount=r.getUint32(),i.materials=[];for(var L=0;L<O.materialCount;L++)i.materials.push(k())},d=function(){var k=function(){var P={};return P.name=r.getSjisStringsAsUnicode(20),P.parentIndex=r.getInt16(),P.tailIndex=r.getInt16(),P.type=r.getUint8(),P.ikIndex=r.getInt16(),P.position=r.getFloat32Array(3),P},O=i.metadata;O.boneCount=r.getUint16(),i.bones=[];for(var L=0;L<O.boneCount;L++)i.bones.push(k())},u=function(){var k=function(){var P={};P.target=r.getUint16(),P.effector=r.getUint16(),P.linkCount=r.getUint8(),P.iteration=r.getUint16(),P.maxAngle=r.getFloat32(),P.links=[];for(var N=0;N<P.linkCount;N++){var z={};z.index=r.getUint16(),P.links.push(z)}return P},O=i.metadata;O.ikCount=r.getUint16(),i.iks=[];for(var L=0;L<O.ikCount;L++)i.iks.push(k())},f=function(){const k=i.metadata;k.morphCount=r.getUint16();const O=i.morphs=new Array(k.morphCount);for(let L=0,P=k.morphCount;L<P;++L){const N={};N.name=r.getSjisStringsAsUnicode(20),N.elementCount=r.getUint32(),N.type=r.getUint8();let z=N.elements=new Array(N.elementCount);for(let K=0,Z=N.elementCount;K<Z;++K)z[K]={index:r.getUint32(),position:r.getFloat32Array(3)};O[L]=N}},m=function(){var k=function(){var P={};return P.index=r.getUint16(),P},O=i.metadata;O.morphFrameCount=r.getUint8(),i.morphFrames=[];for(var L=0;L<O.morphFrameCount;L++)i.morphFrames.push(k())},h=function(){var k=function(){var P={};return P.name=r.getSjisStringsAsUnicode(50),P},O=i.metadata;O.boneFrameNameCount=r.getUint8(),i.boneFrameNames=[];for(var L=0;L<O.boneFrameNameCount;L++)i.boneFrameNames.push(k())},_=function(){var k=function(){var P={};return P.boneIndex=r.getInt16(),P.frameIndex=r.getUint8(),P},O=i.metadata;O.boneFrameCount=r.getUint32(),i.boneFrames=[];for(var L=0;L<O.boneFrameCount;L++)i.boneFrames.push(k())},b=function(){var k=i.metadata;k.englishCompatibility=r.getUint8(),k.englishCompatibility>0&&(k.englishModelName=r.getSjisStringsAsUnicode(20),k.englishComment=r.getSjisStringsAsUnicode(256))},v=function(){var k=function(){var P={};return P.name=r.getSjisStringsAsUnicode(20),P},O=i.metadata;if(O.englishCompatibility!==0){i.englishBoneNames=[];for(var L=0;L<O.boneCount;L++)i.englishBoneNames.push(k())}},w=function(){var k=function(){var P={};return P.name=r.getSjisStringsAsUnicode(20),P},O=i.metadata;if(O.englishCompatibility!==0){i.englishMorphNames=[];for(var L=0;L<O.morphCount-1;L++)i.englishMorphNames.push(k())}},y=function(){var k=function(){var P={};return P.name=r.getSjisStringsAsUnicode(50),P},O=i.metadata;if(O.englishCompatibility!==0){i.englishBoneFrameNames=[];for(var L=0;L<O.boneFrameNameCount;L++)i.englishBoneFrameNames.push(k())}},M=function(){var k=function(){var L={};return L.fileName=r.getSjisStringsAsUnicode(100),L};i.toonTextures=[];for(var O=0;O<10;O++)i.toonTextures.push(k())},S=function(){var k=function(){var P={};return P.name=r.getSjisStringsAsUnicode(20),P.boneIndex=r.getInt16(),P.groupIndex=r.getUint8(),P.groupTarget=r.getUint16(),P.shapeType=r.getUint8(),P.width=r.getFloat32(),P.height=r.getFloat32(),P.depth=r.getFloat32(),P.position=r.getFloat32Array(3),P.rotation=r.getFloat32Array(3),P.weight=r.getFloat32(),P.positionDamping=r.getFloat32(),P.rotationDamping=r.getFloat32(),P.restitution=r.getFloat32(),P.friction=r.getFloat32(),P.type=r.getUint8(),P},O=i.metadata;O.rigidBodyCount=r.getUint32(),i.rigidBodies=[];for(var L=0;L<O.rigidBodyCount;L++)i.rigidBodies.push(k())},D=function(){var k=function(){var P={};return P.name=r.getSjisStringsAsUnicode(20),P.rigidBodyIndex1=r.getUint32(),P.rigidBodyIndex2=r.getUint32(),P.position=r.getFloat32Array(3),P.rotation=r.getFloat32Array(3),P.translationLimitation1=r.getFloat32Array(3),P.translationLimitation2=r.getFloat32Array(3),P.rotationLimitation1=r.getFloat32Array(3),P.rotationLimitation2=r.getFloat32Array(3),P.springPosition=r.getFloat32Array(3),P.springRotation=r.getFloat32Array(3),P},O=i.metadata;O.constraintCount=r.getUint32(),i.constraints=[];for(var L=0;L<O.constraintCount;L++)i.constraints.push(k())};return o(),l(),a(),c(),d(),u(),f(),m(),h(),_(),b(),v(),w(),y(),M(),S(),D(),e===!0&&this.leftToRightModel(i),i};Parser.prototype.parsePmx=function(s,e){var i={},r=new DataViewEx(s);i.metadata={},i.metadata.format="pmx",i.metadata.coordinateSystem="left";var o=function(){var b=i.metadata;if(b.magic=r.getChars(4),b.magic!=="PMX ")throw"PMX file magic is not PMX , but "+b.magic;if(b.version=r.getFloat32(),b.version<2||b.version>2.1)throw"PMX version "+b.version+" is not supported.";b.headerSize=r.getUint8(),b.encoding=r.getUint8(),b.additionalUvNum=r.getUint8(),b.vertexIndexSize=r.getUint8(),b.textureIndexSize=r.getUint8(),b.materialIndexSize=r.getUint8(),b.boneIndexSize=r.getUint8(),b.morphIndexSize=r.getUint8(),b.rigidBodyIndexSize=r.getUint8(),b.modelName=r.getTextBuffer(),b.englishModelName=r.getTextBuffer(),b.comment=r.getTextBuffer(),b.englishComment=r.getTextBuffer()};const l=function(){const b=function(){const y={};y.position=r.getFloat32Array(3),y.normal=r.getFloat32Array(3),y.uv=r.getFloat32Array(2),y.auvs=[];for(var M=0;M<i.metadata.additionalUvNum;M++)y.auvs.push(r.getFloat32Array(4));y.type=r.getUint8();const S=v.boneIndexSize;if(y.type===0)y.skinIndices=r.getIndexArray(S,1),y.skinWeights=[1];else if(y.type===1)y.skinIndices=r.getIndexArray(S,2),y.skinWeights=r.getFloat32Array(1),y.skinWeights.push(1-y.skinWeights[0]);else if(y.type===2)y.skinIndices=r.getIndexArray(S,4),y.skinWeights=r.getFloat32Array(4);else if(y.type===3)y.skinIndices=r.getIndexArray(S,2),y.skinWeights=r.getFloat32Array(1),y.skinWeights.push(1-y.skinWeights[0]),y.skinC=r.getFloat32Array(3),y.skinR0=r.getFloat32Array(3),y.skinR1=r.getFloat32Array(3),y.type=1;else throw"unsupport bone type "+y.type+" exception.";return y.edgeRatio=r.getFloat32(),y},v=i.metadata;v.vertexCount=r.getUint32();let w=i.vertices=new Array(v.vertexCount);for(let y=0,M=v.vertexCount;y<M;y++)w[y]=b()};var a=function(){var b=i.metadata;b.faceCount=r.getUint32()/3;let v=b.vertexIndexSize,w=i.faces=new Array(v);for(let y=0,M=b.faceCount;y<M;y++)w[y]={indices:r.getIndexArray(v,3,!0)}},c=function(){var b=function(){return r.getTextBuffer()},v=i.metadata;v.textureCount=r.getUint32(),i.textures=[];for(var w=0;w<v.textureCount;w++)i.textures.push(b())},d=function(){var b=function(){var y={};if(y.name=r.getTextBuffer(),y.englishName=r.getTextBuffer(),y.diffuse=r.getFloat32Array(4),y.specular=r.getFloat32Array(3),y.shininess=r.getFloat32(),y.ambient=r.getFloat32Array(3),y.flag=r.getUint8(),y.edgeColor=r.getFloat32Array(4),y.edgeSize=r.getFloat32(),y.textureIndex=r.getIndex(i.metadata.textureIndexSize),y.envTextureIndex=r.getIndex(i.metadata.textureIndexSize),y.envFlag=r.getUint8(),y.toonFlag=r.getUint8(),y.toonFlag===0)y.toonIndex=r.getIndex(i.metadata.textureIndexSize);else if(y.toonFlag===1)y.toonIndex=r.getInt8();else throw"unknown toon flag "+y.toonFlag+" exception.";return y.comment=r.getTextBuffer(),y.faceCount=r.getUint32()/3,y},v=i.metadata;v.materialCount=r.getUint32(),i.materials=[];for(var w=0;w<v.materialCount;w++)i.materials.push(b())},u=function(){var b=function(){var y={};if(y.name=r.getTextBuffer(),y.englishName=r.getTextBuffer(),y.position=r.getFloat32Array(3),y.parentIndex=r.getIndex(i.metadata.boneIndexSize),y.transformationClass=r.getUint32(),y.flag=r.getUint16(),y.flag&1?y.connectIndex=r.getIndex(i.metadata.boneIndexSize):y.offsetPosition=r.getFloat32Array(3),y.flag&256||y.flag&512){var M={};M.isLocal=!!(y.flag&128),M.affectRotation=!!(y.flag&256),M.affectPosition=!!(y.flag&512),M.parentIndex=r.getIndex(i.metadata.boneIndexSize),M.ratio=r.getFloat32(),y.grant=M}if(y.flag&1024&&(y.fixAxis=r.getFloat32Array(3)),y.flag&2048&&(y.localXVector=r.getFloat32Array(3),y.localZVector=r.getFloat32Array(3)),y.flag&8192&&(y.key=r.getUint32()),y.flag&32){var S={};S.effector=r.getIndex(i.metadata.boneIndexSize),S.target=null,S.iteration=r.getUint32(),S.maxAngle=r.getFloat32(),S.linkCount=r.getUint32(),S.links=[];for(var D=0;D<S.linkCount;D++){var k={};k.index=r.getIndex(i.metadata.boneIndexSize),k.angleLimitation=r.getUint8(),k.angleLimitation===1&&(k.lowerLimitationAngle=r.getFloat32Array(3),k.upperLimitationAngle=r.getFloat32Array(3)),S.links.push(k)}y.ik=S}return y},v=i.metadata;v.boneCount=r.getUint32(),i.bones=[];for(var w=0;w<v.boneCount;w++)i.bones.push(b())},f=function(){var b=function(){var y={};y.name=r.getTextBuffer(),y.englishName=r.getTextBuffer(),y.panel=r.getUint8(),y.type=r.getUint8(),y.elementCount=r.getUint32(),y.elements=[];for(var M=0;M<y.elementCount;M++)if(y.type===0){var S={};S.index=r.getIndex(i.metadata.morphIndexSize),S.ratio=r.getFloat32(),y.elements.push(S)}else if(y.type===1){var S={};S.index=r.getIndex(i.metadata.vertexIndexSize,!0),S.position=r.getFloat32Array(3),y.elements.push(S)}else if(y.type===2){var S={};S.index=r.getIndex(i.metadata.boneIndexSize),S.position=r.getFloat32Array(3),S.rotation=r.getFloat32Array(4),y.elements.push(S)}else if(y.type===3){var S={};S.index=r.getIndex(i.metadata.vertexIndexSize,!0),S.uv=r.getFloat32Array(4),y.elements.push(S)}else if(y.type!==4){if(y.type!==5){if(y.type!==6){if(y.type!==7){if(y.type===8){var S={};S.index=r.getIndex(i.metadata.materialIndexSize),S.type=r.getUint8(),S.diffuse=r.getFloat32Array(4),S.specular=r.getFloat32Array(3),S.shininess=r.getFloat32(),S.ambient=r.getFloat32Array(3),S.edgeColor=r.getFloat32Array(4),S.edgeSize=r.getFloat32(),S.textureColor=r.getFloat32Array(4),S.sphereTextureColor=r.getFloat32Array(4),S.toonColor=r.getFloat32Array(4),y.elements.push(S)}}}}}return y},v=i.metadata;v.morphCount=r.getUint32(),i.morphs=[];for(var w=0;w<v.morphCount;w++)i.morphs.push(b())},m=function(){var b=function(){var y={};y.name=r.getTextBuffer(),y.englishName=r.getTextBuffer(),y.type=r.getUint8(),y.elementCount=r.getUint32(),y.elements=[];for(var M=0;M<y.elementCount;M++){var S={};S.target=r.getUint8(),S.index=S.target===0?r.getIndex(i.metadata.boneIndexSize):r.getIndex(i.metadata.morphIndexSize),y.elements.push(S)}return y},v=i.metadata;v.frameCount=r.getUint32(),i.frames=[];for(var w=0;w<v.frameCount;w++)i.frames.push(b())},h=function(){var b=function(){var y={};return y.name=r.getTextBuffer(),y.englishName=r.getTextBuffer(),y.boneIndex=r.getIndex(i.metadata.boneIndexSize),y.groupIndex=r.getUint8(),y.groupTarget=r.getUint16(),y.shapeType=r.getUint8(),y.width=r.getFloat32(),y.height=r.getFloat32(),y.depth=r.getFloat32(),y.position=r.getFloat32Array(3),y.rotation=r.getFloat32Array(3),y.weight=r.getFloat32(),y.positionDamping=r.getFloat32(),y.rotationDamping=r.getFloat32(),y.restitution=r.getFloat32(),y.friction=r.getFloat32(),y.type=r.getUint8(),y},v=i.metadata;v.rigidBodyCount=r.getUint32(),i.rigidBodies=[];for(var w=0;w<v.rigidBodyCount;w++)i.rigidBodies.push(b())},_=function(){var b=function(){var y={};return y.name=r.getTextBuffer(),y.englishName=r.getTextBuffer(),y.type=r.getUint8(),y.rigidBodyIndex1=r.getIndex(i.metadata.rigidBodyIndexSize),y.rigidBodyIndex2=r.getIndex(i.metadata.rigidBodyIndexSize),y.position=r.getFloat32Array(3),y.rotation=r.getFloat32Array(3),y.translationLimitation1=r.getFloat32Array(3),y.translationLimitation2=r.getFloat32Array(3),y.rotationLimitation1=r.getFloat32Array(3),y.rotationLimitation2=r.getFloat32Array(3),y.springPosition=r.getFloat32Array(3),y.springRotation=r.getFloat32Array(3),y},v=i.metadata;v.constraintCount=r.getUint32(),i.constraints=[];for(var w=0;w<v.constraintCount;w++)i.constraints.push(b())};return o(),l(),a(),c(),d(),u(),f(),m(),h(),_(),e===!0&&this.leftToRightModel(i),i};Parser.prototype.parseVmd=function(s,e){var i={},r=new DataViewEx(s);i.metadata={},i.metadata.coordinateSystem="left";var o=function(){var h=i.metadata;if(h.magic=r.getChars(30),h.magic!=="Vocaloid Motion Data 0002")throw"VMD file magic is not Vocaloid Motion Data 0002, but "+h.magic;h.name=r.getSjisStringsAsUnicode(20)},l=function(){var h=function(){var v={};return v.boneName=r.getSjisStringsAsUnicode(15),v.frameNum=r.getUint32(),v.position=r.getFloat32Array(3),v.rotation=r.getFloat32Array(4),v.interpolation=r.getUint8Array(64),v},_=i.metadata;_.motionCount=r.getUint32(),i.motions=[];for(var b=0;b<_.motionCount;b++)i.motions.push(h())},a=function(){var h=function(){var v={};return v.morphName=r.getSjisStringsAsUnicode(15),v.frameNum=r.getUint32(),v.weight=r.getFloat32(),v},_=i.metadata;_.morphCount=r.getUint32(),i.morphs=[];for(var b=0;b<_.morphCount;b++)i.morphs.push(h())},c=function(){var h=function(){var v={};return v.frameNum=r.getUint32(),v.distance=r.getFloat32(),v.position=r.getFloat32Array(3),v.rotation=r.getFloat32Array(3),v.interpolation=r.getUint8Array(24),v.fov=r.getUint32(),v.perspective=r.getUint8(),v},_=i.metadata;_.cameraCount=r.getUint32(),i.cameras=[];for(var b=0;b<_.cameraCount;b++)i.cameras.push(h())};const d=function(){const h=function(){const b={};return b.frameNum=r.getUint32(),b.rgb=r.getFloat32Array(3),b.location=r.getFloat32Array(3),b},_=i.metadata;_.lightCount=r.getUint32(),i.lights=[];for(let b=0;b<_.lightCount;b++)i.lights.push(h())},u=function(){const h=function(){const b={};return b.frameNum=r.getUint32(),b.mode=r.getUint8(),b.distance=r.getFloat32(),b},_=i.metadata;_.selfShadowCount=r.getUint32(),i.selfShadows=[];for(let b=0;b<_.selfShadowCount;b++)i.selfShadows.push(h())},f=function(){const h={};return h.ikBoneName=r.getSjisStringsAsUnicode(20),h.ikEnabled=r.getUint8(),h},m=function(){const h=function(){const b={};b.frameNum=r.getUint32(),b.visible=r.getUint8(),b.ikCount=r.getUint32(),b.ikData=[];for(let v=0;v<b.ikCount;v++)b.ikData.push(f());return b},_=i.metadata;_.ik_and_visibilityCount=r.getUint32(),i.ik_and_visibilities=[];for(let b=0;b<_.ik_and_visibilityCount;b++)i.ik_and_visibilities.push(h())};o(),l(),a(),c();try{d();try{u();try{m()}catch{console.log("VMD: No IK.")}}catch{console.log("VMD: No shadow/IK.")}}catch{console.log("VMD: No light/shadow/IK.")}return e===!0&&this.leftToRightVmd(i),i};Parser.prototype.parseVpd=function(s,e){var i={};i.metadata={},i.metadata.coordinateSystem="left",i.bones=[],s instanceof ArrayBuffer&&(s=new CharsetEncoder().s2u(new Uint8Array(s)));var r=/\/\/\w*(\r|\n|\r\n)/g,o=/\r|\n|\r\n/,l=s.replace(r,"").split(o);function a(){throw new Error("the file seems not vpd file.")}function c(){l[0]!=="Vocaloid Pose Data file"&&a()}function d(){l.length<4&&a(),i.metadata.parentFile=l[2],i.metadata.boneCount=parseInt(l[3])}function u(){for(var f=/^\s*(Bone[0-9]+)\s*\{\s*(.*)$/,m=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,h=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,_=/^\s*}/,b=i.bones,v=null,w=null,y=null,M=4;M<l.length;M++){var S=l[M],D;D=S.match(f),D!==null&&(v!==null&&a(),v=D[2]),D=S.match(m),D!==null&&(w!==null&&a(),w=[parseFloat(D[1]),parseFloat(D[2]),parseFloat(D[3])]),D=S.match(h),D!==null&&(y!==null&&a(),y=[parseFloat(D[1]),parseFloat(D[2]),parseFloat(D[3]),parseFloat(D[4])]),D=S.match(_),D!==null&&((v===null||w===null||y===null)&&a(),b.push({name:v,translation:w,quaternion:y}),v=null,w=null,y=null)}(v!==null||w!==null||y!==null)&&a()}c(),d(),u(),e===!0&&this.leftToRightVpd(i),i.metadata.name="pose",i.metadata.morphCount=0,i.metadata.cameraCount=0,i.metadata.lightCount=0,i.metadata.selfShadowCount=0,i.motions=[],i.morphs=[],i.cameras=[],i.lights=[],i.selfShadows=[];for(const f of i.bones)i.motions.push({boneName:f.name,position:f.translation,rotation:f.quaternion,frameNum:0,interpolation:[20,20,0,0,20,20,20,20,107,107,107,107,107,107,107,107,20,20,20,20,20,20,20,107,107,107,107,107,107,107,107,0,20,20,20,20,20,20,107,107,107,107,107,107,107,107,0,0,20,20,20,20,20,107,107,107,107,107,107,107,107,0,0,0]}),i.motions.push({boneName:f.name,position:f.translation,rotation:f.quaternion,frameNum:100,interpolation:[20,20,0,0,20,20,20,20,107,107,107,107,107,107,107,107,20,20,20,20,20,20,20,107,107,107,107,107,107,107,107,0,20,20,20,20,20,20,107,107,107,107,107,107,107,107,0,0,20,20,20,20,20,107,107,107,107,107,107,107,107,0,0,0]});return i.metadata.motionCount=i.motions.length,i.metadata.ik_and_visibilityCount=0,i.ik_and_visibilities=[],i};Parser.prototype.mergeVmds=function(s){var e={};e.metadata={},e.metadata.name=s[0].metadata.name,e.metadata.coordinateSystem=s[0].metadata.coordinateSystem,e.metadata.motionCount=0,e.metadata.morphCount=0,e.metadata.cameraCount=0,e.metadata.lightCount=0,e.metadata.selfShadowCount=0,e.metadata.ik_and_visibilityCount=0,e.motions=[],e.morphs=[],e.cameras=[],e.lights=[],e.selfShadows=[],e.ik_and_visibilities=[];for(var i=0;i<s.length;i++){var r=s[i];e.metadata.motionCount+=r.metadata.motionCount,e.metadata.morphCount+=r.metadata.morphCount,e.metadata.cameraCount+=r.metadata.cameraCount,e.metadata.lightCount+=r.metadata.lightCount,e.metadata.selfShadowCount+=r.metadata.selfShadowCount,e.metadata.ik_and_visibilityCount+=r.metadata.ik_and_visibilityCount;for(var o=0;o<r.metadata.motionCount;o++)e.motions.push(r.motions[o]);for(var o=0;o<r.metadata.morphCount;o++)e.morphs.push(r.morphs[o]);for(var o=0;o<r.metadata.cameraCount;o++)e.cameras.push(r.cameras[o]);for(var o=0;o<r.metadata.lightCount;o++)e.lights.push(r.lights[o]);for(var o=0;o<r.metadata.selfShadowCount;o++)e.selfShadows.push(r.selfShadows[o]);for(var o=0;o<r.metadata.ik_and_visibilityCount;o++)e.ik_and_visibilities.push(r.ik_and_visibilities[o])}return e};Parser.prototype.leftToRightModel=function(s){if(s.metadata.coordinateSystem!=="right"){s.metadata.coordinateSystem="right";for(var e=new DataCreationHelper,i=0;i<s.metadata.vertexCount;i++)e.leftToRightVector3(s.vertices[i].position),e.leftToRightVector3(s.vertices[i].normal);for(var i=0;i<s.metadata.faceCount;i++)e.leftToRightIndexOrder(s.faces[i].indices);for(var i=0;i<s.metadata.boneCount;i++)e.leftToRightVector3(s.bones[i].position);for(var i=0;i<s.metadata.morphCount;i++){var r=s.morphs[i];if(!(s.metadata.format==="pmx"&&r.type!==1))for(var o=0;o<r.elements.length;o++)e.leftToRightVector3(r.elements[o].position)}for(var i=0;i<s.metadata.rigidBodyCount;i++)e.leftToRightVector3(s.rigidBodies[i].position),e.leftToRightEuler(s.rigidBodies[i].rotation);for(var i=0;i<s.metadata.constraintCount;i++)e.leftToRightVector3(s.constraints[i].position),e.leftToRightEuler(s.constraints[i].rotation),e.leftToRightVector3Range(s.constraints[i].translationLimitation1,s.constraints[i].translationLimitation2),e.leftToRightEulerRange(s.constraints[i].rotationLimitation1,s.constraints[i].rotationLimitation2)}};Parser.prototype.leftToRightVmd=function(s){if(s.metadata.coordinateSystem!=="right"){s.metadata.coordinateSystem="right";for(var e=new DataCreationHelper,i=0;i<s.metadata.motionCount;i++)e.leftToRightVector3(s.motions[i].position),e.leftToRightQuaternion(s.motions[i].rotation);for(var i=0;i<s.metadata.cameraCount;i++)e.leftToRightVector3(s.cameras[i].position),e.leftToRightEuler(s.cameras[i].rotation)}};Parser.prototype.leftToRightVpd=function(s){if(s.metadata.coordinateSystem!=="right"){s.metadata.coordinateSystem="right";for(var e=new DataCreationHelper,i=0;i<s.bones.length;i++)e.leftToRightVector3(s.bones[i].translation),e.leftToRightQuaternion(s.bones[i].quaternion)}};var MMDParser={CharsetEncoder,Parser},debug$8=window.debug;class MMDLoader extends Loader{constructor(e){super(e),this.loader=new FileLoader(this.manager),this.parser=null,this.meshBuilder=new MeshBuilder(this.manager),this.animationBuilder=new AnimationBuilder}setAnimationPath(e){return this.animationPath=e,this}load(e,i,r,o){const l=this.meshBuilder.setCrossOrigin(this.crossOrigin);let a;this.resourcePath!==""?a=this.resourcePath:this.path!==""?a=this.path:a=LoaderUtils.extractUrlBase(e);const c=this._extractExtension(e).toLowerCase();if(c!=="pmd"&&c!=="pmx"){o&&o(new Error("THREE.MMDLoader: Unknown model file extension ."+c+"."));return}this[c==="pmd"?"loadPMD":"loadPMX"](e,async function(d){let u=await l.build(d,a,r,o);i(u)},r,o)}loadAnimation(e,i,r,o,l){const a=this.animationBuilder;this.loadVMD(e,function(c){r(i.isCamera?a.buildCameraAnimation(c):a.build(c,i))},o,l)}loadWithAnimation(e,i,r,o,l){const a=this;this.load(e,function(c){a.loadAnimation(i,c,function(d){r({mesh:c,animation:d})},o,l)},o,l)}loadPMD(e,i,r,o){const l=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,function(a){i(l.parsePmd(a,!0))},r,o)}async loadPMX(e,i,r,o){const l=this._getParser();if(window.external_io)if(await window.external_io.exists(e)){const c=await window.external_io.get(e);i(l.parsePmx(C.to_array_buffer(c),!0))}else o(`Does not exist(I/O): "${e}"`);else nodejs&&window.node_api?(async()=>{let a=e,c=nodejs.path.isAbsolute(a)?a:nodejs.path.join(nodejs.config.app_path,"public",a);try{let d=performance.now(),u=nodejs.to_array_buffer(await nodejs.fs.promises.readFile(c));debug$8&&console.log("Array:",C.DPath(c).basename,Math.floor(performance.now()-d)),d=performance.now();let f=l.parsePmx(u,!0);debug$8&&console.log("Parse:",C.DPath(c).basename,Math.floor(performance.now()-d)),d=performance.now(),i(f)}catch(d){console.error(d),o(`${d}: ${c}`)}})():this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,function(a){i(l.parsePmx(a,!0))},r,o)}async loadVMD(e,i,r,o){const l=Array.isArray(e)?e:[e],a=[],c=l.length,d=this._getParser();if(window.external_io)(async()=>{const u=await window.external_io.get(e);a.push(d.parseVmd(C.to_array_buffer(u),!0)),setTimeout(()=>{a.length===c&&i(d.mergeVmds(a))},0)})();else if(nodejs&&window.node_api)for(let u of l){let f=u,m=nodejs.path.isAbsolute(f)?f:nodejs.path.join(nodejs.config.app_path,"public",f);setTimeout(async()=>{try{let h=nodejs.to_array_buffer(await nodejs.fs.promises.readFile(m));a.push(d.parseVmd(h,!0)),a.length===c&&i(d.mergeVmds(a))}catch(h){console.error(h),o(`${h}: ${m}`)}},0)}else{this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);for(let u=0,f=l.length;u<f;u++)this.loader.load(l[u],function(m){a.push(d.parseVmd(m,!0)),a.length===c&&i(d.mergeVmds(a))},r,o)}}loadVPD(e,i,r,o,l){const a=this._getParser();this.loader.setMimeType(i?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("arrayBuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,function(c){let d=null;try{d=a.parseVpd(c,!0)}catch(u){l(u)}d&&r(d)},o,l)}_extractExtension(e){const i=e.lastIndexOf(".");return i<0?"":e.slice(i+1)}_getParser(){if(this.parser===null){if(typeof MMDParser>"u")throw new Error("THREE.MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser");this.parser=new MMDParser.Parser}return this.parser}}const DEFAULT_TOON_TEXTURES=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],NON_ALPHA_CHANNEL_FORMATS=[RGB_S3TC_DXT1_Format$1,RGB_PVRTC_4BPPV1_Format,RGB_PVRTC_2BPPV1_Format,RGB_ETC1_Format$1,RGB_ETC2_Format];class MeshBuilder{constructor(e){this.crossOrigin="anonymous",this.geometryBuilder=new GeometryBuilder,this.materialBuilder=new MaterialBuilder(e)}setCrossOrigin(e){return this.crossOrigin=e,this}async build(e,i,r,o){let l=performance.now();const a=this.geometryBuilder.build(e);debug$8&&console.log("Geometry:",Math.floor(performance.now()-l)),l=performance.now();const c=await this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(i).build(e,a,r,o);debug$8&&console.log("Material:",Math.floor(performance.now()-l)),l=performance.now();const d=new SkinnedMesh(a,c);debug$8&&console.log("Mesh:",Math.floor(performance.now()-l)),l=performance.now();const u=new Skeleton(initBones(d));return d.bind(u),debug$8&&console.log("Skeleton:",Math.floor(performance.now()-l)),l=performance.now(),d}}function initBones(s){const e=s.geometry,i=[];if(e&&e.bones!==void 0){for(let r=0,o=e.bones.length;r<o;r++){const l=e.bones[r],a=new Bone;i.push(a),a.name=l.name,a.position.fromArray(l.pos),a.quaternion.fromArray(l.rotq),a.raw=l.raw,l.scl!==void 0&&a.scale.fromArray(l.scl)}for(let r=0,o=e.bones.length;r<o;r++){const l=e.bones[r];l.parent!==-1&&l.parent!==null&&i[l.parent]!==void 0?i[l.parent].add(i[r]):s.add(i[r])}}return s.updateMatrixWorld(!0),i}class GeometryBuilder{build(e){let i=TimeDurationChecker("geometryBuilder.build-init");const r=new Float32Array(e.metadata.vertexCount*3),o=new Float32Array(e.metadata.vertexCount*3),l=new Float32Array(e.metadata.vertexCount*2);let a=0,c=0,d=0,u=0,f=0;const m=[],h=[],_=[],b=new Int32Array(e.metadata.vertexCount*4),v=new Float32Array(e.metadata.vertexCount*4),w=[],y=[],M=[],S=[],D=[],k=[];let O=0;const L={},P=e.metadata.vertexCount,N=e.vertices;for(let ie=0;ie<P;ie++){const oe=N[ie],Ce=oe.position,ve=oe.normal,we=oe.uv,Se=oe.skinIndices,Re=oe.skinWeights;r[a++]=Ce[0],r[a++]=Ce[1],r[a++]=Ce[2],o[c++]=ve[0],o[c++]=ve[1],o[c++]=ve[2],l[d++]=we[0],l[d++]=we[1];const Fe=Se[0],$e=Se[1],Ue=Se[2],qe=Se[3],_e=Re[0],be=Re[1],De=Re[2],Te=Re[3];b[u++]=Fe!==void 0?Fe:0,b[u++]=$e!==void 0?$e:0,b[u++]=Ue!==void 0?Ue:0,b[u++]=qe!==void 0?qe:0,v[f++]=_e!==void 0?_e:0,v[f++]=be!==void 0?be:0,v[f++]=De!==void 0?De:0,v[f++]=Te!==void 0?Te:0}for(let ie=0;ie<e.metadata.faceCount;ie++){const oe=e.faces[ie];for(let Ce=0,ve=oe.indices.length;Ce<ve;Ce++)m.push(oe.indices[Ce])}for(let ie=0;ie<e.metadata.materialCount;ie++){const oe=e.materials[ie];h.push({offset:O*3,count:oe.faceCount*3}),O+=oe.faceCount}for(let ie=0;ie<e.metadata.rigidBodyCount;ie++){const oe=e.rigidBodies[ie];let Ce=L[oe.boneIndex];Ce=Ce===void 0?oe.type:Math.max(oe.type,Ce),L[oe.boneIndex]=Ce}for(let ie=0;ie<e.metadata.boneCount;ie++){const oe=e.bones[ie],Ce={index:ie,transformationClass:oe.transformationClass,parent:oe.parentIndex,name:oe.name,pos:oe.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:L[ie]!==void 0?L[ie]:-1,raw:oe};Ce.parent!==-1&&(Ce.pos[0]-=e.bones[Ce.parent].position[0],Ce.pos[1]-=e.bones[Ce.parent].position[1],Ce.pos[2]-=e.bones[Ce.parent].position[2]),_.push(Ce)}if(e.metadata.format==="pmd")for(let ie=0;ie<e.metadata.ikCount;ie++){const oe=e.iks[ie],Ce={target:oe.target,effector:oe.effector,iteration:oe.iteration,maxAngle:oe.maxAngle*4,links:[]};for(let ve=0,we=oe.links.length;ve<we;ve++){const Se={};Se.index=oe.links[ve].index,Se.enabled=!0,e.bones[Se.index].name.indexOf("ひざ")>=0&&(Se.limitation=new Vector3(1,0,0)),Ce.links.push(Se)}M.push(Ce)}else for(let ie=0;ie<e.metadata.boneCount;ie++){const oe=e.bones[ie].ik;if(oe===void 0)continue;const Ce={target:ie,effector:oe.effector,iteration:oe.iteration,maxAngle:oe.maxAngle,links:[]};for(let ve=0,we=oe.links.length;ve<we;ve++){const Se={};if(Se.index=oe.links[ve].index,Se.enabled=!0,oe.links[ve].angleLimitation===1){const Re=oe.links[ve].lowerLimitationAngle,Fe=oe.links[ve].upperLimitationAngle,$e=-Fe[0],Ue=-Fe[1];Fe[0]=-Re[0],Fe[1]=-Re[1],Re[0]=$e,Re[1]=Ue,Se.rotationMin=new Vector3().fromArray(Re),Se.rotationMax=new Vector3().fromArray(Fe)}Ce.links.push(Se)}M.push(Ce),_[ie].ik=Ce}if(e.metadata.format==="pmx"){let Ce=function(ve){ve.param&&(S.push(ve.param),_[ve.param.index].grant=ve.param),ve.visited=!0;for(let we=0,Se=ve.children.length;we<Se;we++){const Re=ve.children[we];Re.visited||Ce(Re)}};const ie={};for(let ve=0;ve<e.metadata.boneCount;ve++){const we=e.bones[ve],Se=we.grant;if(Se===void 0)continue;const Re={index:ve,parentIndex:Se.parentIndex,ratio:Se.ratio,isLocal:Se.isLocal,affectRotation:Se.affectRotation,affectPosition:Se.affectPosition,transformationClass:we.transformationClass};ie[ve]={parent:null,children:[],param:Re,visited:!1}}const oe={parent:null,children:[],param:null,visited:!1};for(const ve in ie){const we=ie[ve],Se=ie[we.parentIndex]||oe;we.parent=Se,Se.children.push(we)}Ce(oe)}function z(ie,oe,Ce){const ve=oe.elementCount,we=oe.elements,Se=ie.array;if(Se.length>0)for(let Re=0;Re<ve;++Re){const Fe=we[Re],$e=Fe.position,Ue=Fe.index*3;Se[Ue+0]+=$e[0]*Ce,Se[Ue+1]+=$e[1]*Ce,Se[Ue+2]+=$e[2]*Ce}}function K(ie,oe){const Ce=oe.elements,ve=ie.array;if(ve.length>0)for(let we=0,Se=oe.elementCount;we<Se;++we){const Re=Ce[we],Fe=Re.position,$e=Re.index*3;ve[$e+0]+=Fe[0],ve[$e+1]+=Fe[1],ve[$e+2]+=Fe[2]}}function Z(ie,oe,Ce){if(ie?.array)for(let ve=0,we=oe.elementCount;ve<we;++ve){const Se=oe.elements[ve],Re=e.morphs[0].elements[Se.index].index;ie.array[Re*3+0]+=Se.position[0]*Ce,ie.array[Re*3+1]+=Se.position[1]*Ce,ie.array[Re*3+2]+=Se.position[2]*Ce}}i.finish();let V=0,H=new Float32Array(e.metadata.morphCount);for(let ie=0,oe=e.metadata.morphCount;ie<oe;ie++){const Ce=e.morphs[ie];let ve=!1;if(Ce.type===1)ve=!0;else if(Ce.type===0)for(let we=0,Se=Ce.elementCount;we<Se;we++){let Re=Ce.elements[we];if(Re.index==-1)continue;if(e.morphs[Re.index]?.type===1){ve=!0;break}}ve&&V++}if(V>0){let ie=TimeDurationChecker("geometryBuilder.buffer"),oe=new ArrayBuffer(e.metadata.vertexCount*3*4*V),Ce=new Float32Array(oe);Ce.set(r,0);const ve=e.metadata.vertexCount*3*4,we=e.metadata.vertexCount*3;for(let Re=1;Re<V;Re++)Ce.copyWithin(we*Re,0,we);let Se=0;for(let Re=0,Fe=e.metadata.morphCount;Re<Fe;Re++){const $e=e.morphs[Re];let Ue=!1;if($e.type===1)Ue=!0;else if($e.type===0)for(let qe=0,_e=$e.elementCount;qe<_e;qe++){let be=$e.elements[qe];if(be.index==-1)continue;if(e.morphs[be.index]?.type===1){Ue=!0;break}}if(Ue){const qe=new Float32BufferAttribute({is_custom:!0,new_array:new Float32Array(oe,Se*ve,we)},3);Se++,qe.name=$e.name,y.push(qe),H[Re]=1}else{const qe=new Float32BufferAttribute([],3);qe.name=$e.name,y.push(qe),H[Re]=0}}ie.finish()}let Y=TimeDurationChecker("geometryBuilder.build");for(let ie=0,oe=e.metadata.morphCount;ie<oe;ie++){const Ce=e.morphs[ie],ve={name:Ce.name},we=y[ie];if(e.metadata.format==="pmd")ie!==0&&Z(we,Ce,1);else if(Ce.type===0)for(let Se=0,Re=Ce.elementCount;Se<Re;Se++){let Fe=Ce.elements[Se];if(Fe.index==-1)continue;const $e=e.morphs[Fe.index],Ue=Fe.ratio;$e?.type===1&&z(we,$e,Ue)}else Ce.type===1?K(we,Ce):Ce.type===2||Ce.type===3||Ce.type===4||Ce.type===5||Ce.type===6||Ce.type===7||Ce.type;w.push(ve)}Y.finish();for(let ie=0;ie<e.metadata.rigidBodyCount;ie++){const oe=e.rigidBodies[ie],Ce={};for(const ve in oe)Ce[ve]=oe[ve];if(e.metadata.format==="pmx"&&Ce.boneIndex!==-1){const ve=e.bones[Ce.boneIndex];Ce.src_rigid_body_position=[Ce.position[0],Ce.position[1],Ce.position[2]],Ce.src_bone_position=[ve.position[0],ve.position[1],ve.position[2]],Ce.position[0]-=ve.position[0],Ce.position[1]-=ve.position[1],Ce.position[2]-=ve.position[2]}D.push(Ce)}for(let ie=0;ie<e.metadata.constraintCount;ie++){const oe=e.constraints[ie],Ce={};for(const Se in oe)Ce[Se]=oe[Se];const ve=D[Ce.rigidBodyIndex1],we=D[Ce.rigidBodyIndex2];ve&&we&&ve.type!==0&&we.type===2&&ve.boneIndex!==-1&&we.boneIndex!==-1&&e.bones[we.boneIndex].parentIndex===ve.boneIndex&&(we.type=1),k.push(Ce)}let q=TimeDurationChecker("geometryBuilder.build-attr1");const J=new BufferGeometry;J.setAttribute("position",new Float32BufferAttribute(r,3)),J.setAttribute("normal",new Float32BufferAttribute(o,3)),J.setAttribute("uv",new Float32BufferAttribute(l,2)),J.setAttribute("skinIndex",new Uint16BufferAttribute(b,4)),J.setAttribute("skinWeight",new Float32BufferAttribute(v,4)),J.setIndex(m);for(let ie=0,oe=h.length;ie<oe;ie++)J.addGroup(h[ie].offset,h[ie].count,ie);J.bones=_,J.morphs=e.morphs,J.morphTargets=w,J.morphTargetsRelative=!1,J.userData.MMD={bones:_,iks:M,grants:S,rigidBodies:D,constraints:k,format:e.metadata.format},q.finish();let W=TimeDurationChecker("geometryBuilder.computeBoundingSphere");J.computeBoundingSphere();const te=[];for(const ie of y)ie.array.length>0&&te.push(ie);return J.morphAttributes.position=te,J.influenceMasks=H,J.isMMDMorph=!0,W.finish(),J}}class MaterialBuilder{constructor(e){this.manager=e,this.textureLoader=new TextureLoader(this.manager),this.tgaLoader=null,this.crossOrigin="anonymous",this.resourcePath=void 0}setCrossOrigin(e){return this.crossOrigin=e,this}setResourcePath(e){return this.resourcePath=e,this}async build(e,i){let r=[];const o={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(let l=0;l<e.metadata.materialCount;l++){let a=null;const c=e.materials[l],d={userData:{MMD:{}}};c.name!==void 0&&(d.name=c.name),d.color=d.diffuse=new Color().fromArray(c.diffuse),d.opacity=c.diffuse[3],d.specular=new Color().fromArray(c.specular),d.shininess=c.shininess,d.transparent=!1,d.roughness=Math.sqrt(2/(c.shininess+2)),d.fog=!0;const u=e.textures[c.textureIndex];let f=!1;if(typeof u=="string"){const h=C.DPath(u).ext;h&&h.length>0&&(h=="png"||h=="tga")&&(f=!0),d.opacity<1&&(f=!0)}if(f?(d.blending=NormalBlending,d.transparent=!0,d.alphaTest=.01,d.alphaToCoverage=!1):(d.blending=NoBlending,d.transparent=!1,d.alphaTest=0,d.alphaToCoverage=!1),d.blendSrc=SrcAlphaFactor,d.blendDst=OneMinusSrcAlphaFactor,d.blendSrcAlpha=SrcAlphaFactor,d.blendDstAlpha=DstAlphaFactor,(c.flag&1)===1?(d.side=DoubleSide,d.shadowSide=DoubleSide):(d.side=FrontSide,d.shadowSide=FrontSide),e.metadata.format==="pmd"){if(c.fileName){const _=c.fileName.split("*");d.map=this._loadTexture(_[0],o),_.length>1}c.toonIndex===-1||e.toonTextures[c.toonIndex].fileName,d.userData.outlineParameters={thickness:c.edgeFlag===1?.003:0,color:[0,0,0],alpha:1,visible:c.edgeFlag===1}}else{c.textureIndex!==-1&&(d.map=this._loadTexture(e.textures[c.textureIndex],o),d.userData.MMD.mapFileName=e.textures[c.textureIndex]),c.envTextureIndex!==-1&&(c.envFlag===1||c.envFlag==2),c.toonIndex===-1||c.toonFlag!==0?""+("0"+(c.toonIndex+1)).slice(-2):e.textures[c.toonIndex];let h=c.edgeColor.slice(0,3);h[0]=Math.pow(h[0],2.2333),h[1]=Math.pow(h[1],2.2333),h[2]=Math.pow(h[2],2.2333),d.userData.outlineParameters={thickness:c.edgeSize/200,color:h,alpha:c.edgeColor[3],visible:(c.flag&16)!==0&&c.edgeSize>0}}a=new MeshPhysicalMaterial,a.sheenColor=new Color(16777215),a.sheen=.1,a.sheenRoughness=.5;let m=this;r.push({index:l,material:a,params:d,_scope_:m,delayed_funcs:[function(){}]});for(let h in d)h=="map"||h=="gradientMap"||h=="envMap"||h=="matcap"||a[h]!==void 0&&(a[h]=d[h])}for(;;){let l=!0;for(const a in o)if(o[a].locked){l=!1;break}if(l)break;await C.sleep(50)}return r=r.map(async l=>{let a=l.params,c=l.material;a.map&&(c.map=await a.map,delete a.map),a.gradientMap&&(c.gradientMap=await c.gradientMap,delete a.gradientMap),a.envMap&&(c.envMap=await c.envMap,delete a.envMap),a.matcap&&(c.matcap=await c.matcap,delete a.matcap);for(let d of l.delayed_funcs)d();return a.map!==void 0&&(a.transparent||l._scope_._checkImageTransparency(c,c.map,i,l.index)),c}),r=await Promise.all(r),r}_isDefaultToonTexture(e){return e.length!==10?!1:/toon(10|0[0-9])\.bmp/.test(e)}async _loadTexture(e,i,r,o,l){r=r||{};const a=this;let c;if(r.isDefaultToonTexture===!0){let _;try{_=parseInt(e.match(/toon([0-9]{2})\.bmp$/)[1])}catch{console.warn("THREE.MMDLoader: "+e+" seems like a not right default texture path. Using toon00.bmp instead."),_=0}c=DEFAULT_TOON_TEXTURES[_]}else c=this.resourcePath+e;if(c=c.replace(/\\/g,"/"),i[c]!==void 0){let _=i[c];for(;_.locked;)await C.sleep(50);if(_.texture)return _.texture}let d=i[c]={locked:!0,texture:null},u=this.manager.getHandler(c),f=c,m=!1;if(u===null){let _=window.C,b=_.DPath(c);if(window.enable_dds_texture){const v=_.DPathJoin(b.dirname,b.name+".ktx2"),w=_.DPathJoin(b.dirname,b.name+".dds"),y=window.cross_file_system.exists(v),M=window.cross_file_system.exists(w);await Promise.all([y,M]),await y?(f=v,m=!0):await M&&(f=w,m=!0)}else{const v=_.DPathJoin(b.dirname,b.name+".ktx2");await window.cross_file_system.exists(v)?(f=v,debug$8&&console.log("%cHit KTX2:"+f,"background: #444; color:#0F0"),m=!0):debug$8&&console.log("%cNo hit KTX2: "+f,"background: #444; color:#F00")}u=await window.BuilderUtil.get_texture_loader(f)}const h=u.load(f,function(_){window.texture_counter!=null&&console.log("TX:",++window.texture_counter,C.DPath(f).basename,`${_.image?.width}x${_.image?.height}`),r.isToonTexture===!0?(_.image=a._getRotatedImage(_.image),_.magFilter=NearestFilter,_.minFilter=NearestFilter,_.colorSpace=NoColorSpace):_.colorSpace=SRGBColorSpace,_.needsUpdate=!0,m?_.generateMipmaps=!1:_.generateMipmaps=!0,_.flipY=!1,_.wrapS=RepeatWrapping,_.wrapT=RepeatWrapping;for(let b=0;b<h.readyCallbacks.length;b++)h.readyCallbacks[b](h);d.locked=!1,d.texture=h},o,_=>{d.locked=!1,l&&l(_)});return m&&h?.generateMipmaps!==void 0&&(h.generateMipmaps=!1),window.is_data_url(c)==!1&&(h._source_file_=c),h._modified_source_file_=f,h.colorSpace=SRGBColorSpace,h.readyCallbacks=[],h}_getRotatedImage(e){const i=document.createElement("canvas"),r=i.getContext("2d"),o=e.width,l=e.height;return i.width=o,i.height=l,r.clearRect(0,0,o,l),r.translate(o/2,l/2),r.rotate(.5*Math.PI),r.translate(-o/2,-l/2),e.is_dummy?r.putImageData(e.image_data,0,0):r.drawImage(e,0,0),r.getImageData(0,0,o,l)}_checkImageTransparency(e,i,r,o){i.readyCallbacks.push(function(l){function a(m){if(m.is_dummy)return m.image_data;{const h=document.createElement("canvas");h.width=m.width,h.height=m.height;const _=h.getContext("2d");return _.drawImage(m,0,0),_.getImageData(0,0,h.width,h.height)}}function c(m,h,_){const b=m.width,v=m.height,w=m.data,y=253;if(w.length/(b*v)!==4)return!1;for(let M=0;M<_.length;M+=3){const S={x:0,y:0};for(let D=0;D<3;D++){const k=_[M*3+D],O={x:h[k*2+0],y:h[k*2+1]};if(d(m,O)<y)return!0;S.x+=O.x,S.y+=O.y}if(S.x/=3,S.y/=3,d(m,S)<y)return!0}return!1}function d(m,h){const _=m.width,b=m.height;let v=Math.round(h.x*_)%_,w=Math.round(h.y*b)%b;v<0&&(v+=_),w<0&&(w+=b);const y=w*_+v;return m.data[y*4+3]}if(l.isCompressedTexture===!0){NON_ALPHA_CHANNEL_FORMATS.includes(l.format)?i.transparent=!1:i.transparent=!0,i.generateMipmaps=!1;return}const u=l.image.data!==void 0?l.image:a(l.image),f=r.groups[o];c(u,r.attributes.uv.array,r.index.array.slice(f.start,f.start+f.count))&&(i.transparent=!0,e.blending=NormalBlending)})}}class AnimationBuilder{build(e,i,r){const o=this.buildSkeletalAnimation(e,i,r).tracks,l=this.buildMorphAnimation(e,i,r).tracks;for(let a=0,c=l.length;a<c;a++)o.push(l[a]);return new AnimationClip("",-1,o)}buildSkeletalAnimation(e,i,r){function o(m,h,_){m.push(h[_+0]/127),m.push(h[_+8]/127),m.push(h[_+4]/127),m.push(h[_+12]/127)}const l=[],a=r?.mapper||{bone:{},morph:{}},c={};let d=i.skeleton?.bones;const u={},f=i._dp_?.type;if(!(f=="pmx"||f=="pmd"))d=[],i.traverse(m=>{d.push(m)});else if(e.metadata.name=="カメラ・照明")throw new Error("Camera motion cannot attach to model.");for(let m=0,h=d.length;m<h;m++)u[d[m].name]=!0;for(let m=0;m<e.motions.length;m++){const h=e.motions[m],_=a.bone[h.boneName]||h.boneName;u[_]!==void 0&&(c[_]=c[_]||[],c[_].push(h))}for(const m in c){const h=c[m];h.sort(function(D,k){return D.frameNum-k.frameNum});const _=[],b=[],v=[],w=[],y=[],M=i.skeleton.getBoneByName(m).position.toArray();for(let D=0,k=h.length;D<k;D++){const O=h[D].frameNum/30,L=h[D].position,P=h[D].rotation,N=h[D].interpolation;_.push(O);for(let z=0;z<3;z++)b.push(M[z]+L[z]);for(let z=0;z<4;z++)v.push(P[z]);for(let z=0;z<3;z++)o(w,N,z);o(y,N,3)}const S=".bones["+m+"]";l.push(this._createTrack(S+".position",VectorKeyframeTrack,_,b,w)),l.push(this._createTrack(S+".quaternion",QuaternionKeyframeTrack,_,v,y))}if(e.ik_and_visibilities.length>0){const m=[],h=[],_={};e.ik_and_visibilities.sort(function(v,w){return v.frameNum-w.frameNum});for(let v=0;v<e.ik_and_visibilities.length;v++){const w=e.ik_and_visibilities[v],y=w.frameNum/30;h.push(w.visible==1);const M=w.ikData;for(const S of M)_[S.ikBoneName]==null&&(_[S.ikBoneName]=[]),_[S.ikBoneName].push(S.ikEnabled==1);m.push(y)}const b=new BooleanKeyframeTrack(".visible",m,h);l.push(b);for(const v in _){const w=_[v],y=new BooleanKeyframeTrack(".bones["+v+"].ikEnabled",m,w);l.push(y)}}return new AnimationClip("",-1,l)}buildMorphAnimation(e,i,r){const o=[],l={},a=i.morphTargetDictionary,c=r?.mapper||{bone:{},morph:{}};if(a==null){console.warn("Does not have a morphTargetDictionary in "+i.name);return}for(let d=0;d<e.metadata.morphCount;d++){const u=e.morphs[d],f=c.morph[u.morphName]||u.morphName;a[f]!==void 0&&(l[f]=l[f]||[],l[f].push(u))}for(const d in l){const u=l[d];u.sort(function(h,_){return h.frameNum-_.frameNum});const f=[],m=[];for(let h=0,_=u.length;h<_;h++)f.push(u[h].frameNum/30),m.push(u[h].weight);o.push(new NumberKeyframeTrack(".morphTargetInfluences["+a[d]+"]",f,m))}return new AnimationClip("",-1,o)}buildCameraAnimation(e){function i(k,O){k.push(O.x),k.push(O.y),k.push(O.z)}function r(k,O){k.push(O.x),k.push(O.y),k.push(O.z),k.push(O.w)}function o(k,O,L){k.push(O[L*4+0]/127),k.push(O[L*4+1]/127),k.push(O[L*4+2]/127),k.push(O[L*4+3]/127)}const l=e.cameras===void 0?[]:e.cameras.slice();l.sort(function(k,O){return k.frameNum-O.frameNum});const a=[],c=[],d=[],u=[],f=[],m=[],h=[],_=[],b=[],v=[],w=new Quaternion,y=new Euler,M=new Vector3;new Vector3;const S=new Vector3;for(let k=0,O=l.length;k<O;k++){const L=l[k],P=L.frameNum/30,N=L.position,z=L.rotation,K=L.distance,Z=L.fov,V=L.interpolation;a.push(P),m.push(K),S.set(N[0],N[1],N[2]),M.set(-z[0],-z[1],-z[2]),w.setFromEuler(y),i(c,S),r(d,w),i(u,M),f.push(Z);for(let H=0;H<3;H++)o(h,V,H);o(_,V,3),o(_,V,3),o(_,V,3),o(v,V,4),o(b,V,5)}for(let k=0,O=a.length-1;k<O;k++){const L=a[k+0],P=a[k+1],N=a[k+2];P-L<.04&&N!==void 0&&N-P>.04&&(a[k+0]=P)}const D=[];return D.push(this._createTrack(".position",VectorKeyframeTrack,a,c,h)),D.push(this._createTrack("._camera_motion_vmd_rotate",VectorKeyframeTrack,a,u,_)),D.push(this._createTrack(".fov",NumberKeyframeTrack,a,f,b)),D.push(this._createTrack("._camera_motion_vmd_distance",NumberKeyframeTrack,a,m,v)),new AnimationClip("",-1,D)}_createTrack(e,i,r,o,l){if(r.length>2){r=r.slice(),o=o.slice(),l=l.slice();const c=o.length/r.length,d=l.length/r.length;let u=1;for(let f=2,m=r.length;f<m;f++){for(let h=0;h<c;h++)if(o[u*c+h]!==o[(u-1)*c+h]||o[u*c+h]!==o[f*c+h]){u++;break}if(f>u){r[u]=r[f];for(let h=0;h<c;h++)o[u*c+h]=o[f*c+h];for(let h=0;h<d;h++)l[u*d+h]=l[f*d+h]}}r.length=u+1,o.length=(u+1)*c,l.length=(u+1)*d}const a=new i(e,r,o);return a.createInterpolant=function(d){return new CubicBezierInterpolation(this.times,this.values,this.getValueSize(),d,new Float32Array(l))},a}}class CubicBezierInterpolation extends Interpolant{constructor(e,i,r,o,l){super(e,i,r,o),this.interpolationParams=l}interpolate_(e,i,r,o){const l=this.resultBuffer,a=this.sampleValues,c=this.valueSize,d=this.interpolationParams,u=e*c,f=u-c,m=o-i<1e-5?0:(r-i)/(o-i);if(c===4){const h=d[e*4+0],_=d[e*4+1],b=d[e*4+2],v=d[e*4+3],w=this._calculate(h,_,b,v,m);Quaternion.slerpFlat(l,0,a,f,a,u,w)}else if(c===3)for(let h=0;h!==c;++h){const _=d[e*12+h*4+0],b=d[e*12+h*4+1],v=d[e*12+h*4+2],w=d[e*12+h*4+3],y=this._calculate(_,b,v,w,m);l[h]=a[f+h]*(1-y)+a[u+h]*y}else{const h=d[e*4+0],_=d[e*4+1],b=d[e*4+2],v=d[e*4+3],w=this._calculate(h,_,b,v,m);l[0]=a[f]*(1-w)+a[u]*w}return l}_calculate(e,i,r,o,l){let a=.5,c=a,d=1-c;const u=15,f=1e-5,m=Math;let h,_,b;for(let v=0;v<u;v++){h=3*d*d*c,_=3*d*c*c,b=c*c*c;const w=h*e+_*i+b-l;if(m.abs(w)<f)break;a/=2,c+=w<0?a:-a,d=1-c}return h*r+_*o+b}}class WorkerPool{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const r=this.workersResolve[e];if(r&&r(i),this.queue.length){const{resolve:o,msg:l,transfer:a}=this.queue.shift();this.workersResolve[e]=o,this.workers[e].postMessage(l,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(r=>{const o=this._getIdleWorker();o!==-1?(this._initWorker(o),this.workerStatus|=1<<o,this.workersResolve[o]=r,this.workers[o].postMessage(e,i)):this.queue.push({resolve:r,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const t=0,n=2,p=1,x=2,E=0,F=1,X=10,nt=0,ct=9,gt=15,yt=16,dt=22,Ot=37,Ft=43,$t=76,se=83,pe=97,xe=100,de=103,Ae=109,Sn=165,In=166;class Si{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Ii{constructor(e,i,r,o){this._dataView=new DataView(e.buffer,e.byteOffset+i,r),this._littleEndian=o,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const r=this._offset;let o=0;for(;this._dataView.getUint8(this._offset)!==i&&o<e;)o++,this._offset++;return o<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,o)}}const Ti=[171,75,84,88,32,50,48,187,13,10,26,10];function Ei(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function Pi(s){const e=new Uint8Array(s.buffer,s.byteOffset,Ti.length);if(e[0]!==Ti[0]||e[1]!==Ti[1]||e[2]!==Ti[2]||e[3]!==Ti[3]||e[4]!==Ti[4]||e[5]!==Ti[5]||e[6]!==Ti[6]||e[7]!==Ti[7]||e[8]!==Ti[8]||e[9]!==Ti[9]||e[10]!==Ti[10]||e[11]!==Ti[11])throw new Error("Missing KTX 2.0 identifier.");const i=new Si,r=17*Uint32Array.BYTES_PER_ELEMENT,o=new Ii(s,Ti.length,r,!0);i.vkFormat=o._nextUint32(),i.typeSize=o._nextUint32(),i.pixelWidth=o._nextUint32(),i.pixelHeight=o._nextUint32(),i.pixelDepth=o._nextUint32(),i.layerCount=o._nextUint32(),i.faceCount=o._nextUint32();const l=o._nextUint32();i.supercompressionScheme=o._nextUint32();const a=o._nextUint32(),c=o._nextUint32(),d=o._nextUint32(),u=o._nextUint32(),f=o._nextUint64(),m=o._nextUint64(),h=new Ii(s,Ti.length+r,3*l*8,!0);for(let J=0;J<l;J++)i.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+h._nextUint64(),h._nextUint64()),uncompressedByteLength:h._nextUint64()});const _=new Ii(s,a,c,!0),b={vendorId:_._skip(4)._nextUint16(),descriptorType:_._nextUint16(),versionNumber:_._nextUint16(),descriptorBlockSize:_._nextUint16(),colorModel:_._nextUint8(),colorPrimaries:_._nextUint8(),transferFunction:_._nextUint8(),flags:_._nextUint8(),texelBlockDimension:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],bytesPlane:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],samples:[]},v=(b.descriptorBlockSize/4-6)/4;for(let J=0;J<v;J++){const W={bitOffset:_._nextUint16(),bitLength:_._nextUint8(),channelType:_._nextUint8(),samplePosition:[_._nextUint8(),_._nextUint8(),_._nextUint8(),_._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&W.channelType?(W.sampleLower=_._nextInt32(),W.sampleUpper=_._nextInt32()):(W.sampleLower=_._nextUint32(),W.sampleUpper=_._nextUint32()),b.samples[J]=W}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(b);const w=new Ii(s,d,u,!0);for(;w._offset<u;){const J=w._nextUint32(),W=w._scan(J),te=Ei(W),ie=w._scan(J-W.byteLength);i.keyValue[te]=te.match(/^ktx/i)?Ei(ie):ie,w._offset%4&&w._skip(4-w._offset%4)}if(m<=0)return i;const y=new Ii(s,f,m,!0),M=y._nextUint16(),S=y._nextUint16(),D=y._nextUint32(),k=y._nextUint32(),O=y._nextUint32(),L=y._nextUint32(),P=[];for(let J=0;J<l;J++)P.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const N=f+y._offset,z=N+D,K=z+k,Z=K+O,V=new Uint8Array(s.buffer,s.byteOffset+N,D),H=new Uint8Array(s.buffer,s.byteOffset+z,k),Y=new Uint8Array(s.buffer,s.byteOffset+K,O),q=new Uint8Array(s.buffer,s.byteOffset+Z,L);return i.globalData={endpointCount:M,selectorCount:S,imageDescs:P,endpointsData:V,selectorsData:H,tablesData:Y,extendedData:q},i}let A,I,B;const g={env:{emscripten_notify_memory_growth:function(s){B=new Uint8Array(I.exports.memory.buffer)}}};class Q{init(){return A||(A=typeof fetch<"u"?fetch("data:application/wasm;base64,"+C$1).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,g)).then(this._init):WebAssembly.instantiate(Buffer.from(C$1,"base64"),g).then(this._init),A)}_init(e){I=e.instance,g.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!I)throw new Error("ZSTDDecoder: Await .init() before decoding.");const r=e.byteLength,o=I.exports.malloc(r);B.set(e,o),i=i||Number(I.exports.ZSTD_findDecompressedSize(o,r));const l=I.exports.malloc(i),a=I.exports.ZSTD_decompress(l,i,o,r),c=B.slice(l,l+a);return I.exports.free(o),I.exports.free(l),c}}const C$1="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",_taskCache=new WeakMap;let _activeLoaders=0,_zstd;class KTX2Loader extends Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new FileLoader(this.manager,{file_system:"system"});e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),r=new FileLoader(this.manager,{file_system:"system"});r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const o=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,o]).then(([l,a])=>{const c=KTX2Loader.BasisWorker.toString(),d=["/* constants */","let _EngineFormat = "+JSON.stringify(KTX2Loader.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(KTX2Loader.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(KTX2Loader.BasisFormat),"/* basis_transcoder.js */",l,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([d])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const u=new Worker(this.workerSourceURL),f=this.transcoderBinary.slice(0);return u.postMessage({type:"init",config:this.workerConfig,transcoderBinary:f},[f]),u})}),_activeLoaders>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),_activeLoaders++}return this.transcoderPending}load(e,i,r,o){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const l=new FileLoader(this.manager);l.setResponseType("arraybuffer"),l.setWithCredentials(this.withCredentials);const a=new CompressedTexture;let c=!0;return window.is_data_url(e)==!1&&(window.external_io||window.is_electron)&&(c=!1),c==!1?(async()=>{try{const d=await window.cross_file_system.read(e);if(_taskCache.has(d))return _taskCache.get(d).promise.then(i).catch(o);this._createTexture(d).then(function(u){a.copy(u),a.needsUpdate=!0,i&&i(a)}).catch(o)}catch(d){console.error(d),o&&o(d)}})():l.load(e,d=>{if(_taskCache.has(d))return _taskCache.get(d).promise.then(i).catch(o);this._createTexture(d).then(function(u){a.copy(u),a.needsUpdate=!0,i&&i(a)}).catch(o)},r,o),a}_createTextureFrom(e,i){const{faces:r,width:o,height:l,format:a,type:c,error:d,dfdFlags:u}=e;if(c==="error")return Promise.reject(d);let f;if(i.faceCount===6)f=new CompressedCubeTexture(r,a,UnsignedByteType);else{const m=r[0].mipmaps;f=i.layerCount>1?new CompressedArrayTexture(m,o,l,i.layerCount,a,UnsignedByteType):new CompressedTexture(m,o,l,a,UnsignedByteType)}return f.minFilter=r[0].mipmaps.length===1?LinearFilter:LinearMipmapLinearFilter,f.magFilter=LinearFilter,f.generateMipmaps=!1,f.needsUpdate=!0,f.colorSpace=parseColorSpace(i),f.premultiplyAlpha=!!(u&p),f}async _createTexture(e,i={}){const r=Pi(new Uint8Array(e));if(r.vkFormat!==nt)return createRawTexture(r);const o=i,l=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:o},[e])).then(a=>this._createTextureFrom(a.data,r));return _taskCache.set(e,{promise:l}),l}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),_activeLoaders--,this}}KTX2Loader.BasisFormat={ETC1S:0,UASTC_4x4:1};KTX2Loader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};KTX2Loader.EngineFormat={RGBAFormat,RGBA_ASTC_4x4_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format$1,RGB_ETC1_Format:RGB_ETC1_Format$1,RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format};KTX2Loader.BasisWorker=function(){let s,e,i;const r=_EngineFormat,o=_TranscoderFormat,l=_BasisFormat;self.addEventListener("message",function(b){const v=b.data;switch(v.type){case"init":s=v.config,a(v.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:w,buffers:y,width:M,height:S,hasAlpha:D,format:k,dfdFlags:O}=c(v.buffer);self.postMessage({type:"transcode",id:v.id,faces:w,width:M,height:S,hasAlpha:D,format:k,dfdFlags:O},y)}catch(w){console.error(w),self.postMessage({type:"error",id:v.id,error:w.message})}});break}});function a(b){e=new Promise(v=>{i={wasmBinary:b,onRuntimeInitialized:v},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function c(b){const v=new i.KTX2File(new Uint8Array(b));function w(){v.close(),v.delete()}if(!v.isValid())throw w(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const y=v.isUASTC()?l.UASTC_4x4:l.ETC1S,M=v.getWidth(),S=v.getHeight(),D=v.getLayers()||1,k=v.getLevels(),O=v.getFaces(),L=v.getHasAlpha(),P=v.getDFDFlags(),{transcoderFormat:N,engineFormat:z}=m(y,M,S,L);if(!M||!S||!k)throw w(),new Error("THREE.KTX2Loader:	Invalid texture");if(!v.startTranscoding())throw w(),new Error("THREE.KTX2Loader: .startTranscoding failed");const K=[],Z=[];for(let V=0;V<O;V++){const H=[];for(let Y=0;Y<k;Y++){const q=[];let J,W;for(let ie=0;ie<D;ie++){const oe=v.getImageLevelInfo(Y,ie,V);V===0&&Y===0&&ie===0&&(oe.origWidth%4!==0||oe.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),k>1?(J=oe.origWidth,W=oe.origHeight):(J=oe.width,W=oe.height);const Ce=new Uint8Array(v.getImageTranscodedSizeInBytes(Y,ie,0,N));if(!v.transcodeImage(Ce,Y,ie,V,N,0,-1,-1))throw w(),new Error("THREE.KTX2Loader: .transcodeImage failed.");q.push(Ce)}const te=_(q);H.push({data:te,width:J,height:W}),Z.push(te.buffer)}K.push({mipmaps:H,width:M,height:S,format:z})}return w(),{faces:K,buffers:Z,width:M,height:S,hasAlpha:L,format:z,dfdFlags:P}}const d=[{if:"astcSupported",basisFormat:[l.UASTC_4x4],transcoderFormat:[o.ASTC_4x4,o.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.BC7_M5,o.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.BC1,o.BC3],engineFormat:[r.RGBA_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.ETC1,o.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[l.ETC1S,l.UASTC_4x4],transcoderFormat:[o.PVRTC1_4_RGB,o.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],u=d.sort(function(b,v){return b.priorityETC1S-v.priorityETC1S}),f=d.sort(function(b,v){return b.priorityUASTC-v.priorityUASTC});function m(b,v,w,y){let M,S;const D=b===l.ETC1S?u:f;for(let k=0;k<D.length;k++){const O=D[k];if(s[O.if]&&O.basisFormat.includes(b)&&!(y&&O.transcoderFormat.length<2)&&!(O.needsPowerOfTwo&&!(h(v)&&h(w))))return M=O.transcoderFormat[y?1:0],S=O.engineFormat[y?1:0],{transcoderFormat:M,engineFormat:S}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),M=o.RGBA32,S=r.RGBAFormat,{transcoderFormat:M,engineFormat:S}}function h(b){return b<=2?!0:(b&b-1)===0&&b!==0}function _(b){if(b.length===1)return b[0];let v=0;for(let M=0;M<b.length;M++){const S=b[M];v+=S.byteLength}const w=new Uint8Array(v);let y=0;for(let M=0;M<b.length;M++){const S=b[M];w.set(S,y),y+=S.byteLength}return w}};const UNCOMPRESSED_FORMATS=new Set([RGBAFormat,RGFormat,RedFormat]),FORMAT_MAP={[Ae]:RGBAFormat,[pe]:RGBAFormat,[Ot]:RGBAFormat,[Ft]:RGBAFormat,[de]:RGFormat,[se]:RGFormat,[yt]:RGFormat,[dt]:RGFormat,[xe]:RedFormat,[$t]:RedFormat,[gt]:RedFormat,[ct]:RedFormat,[In]:RGBA_ASTC_6x6_Format,[Sn]:RGBA_ASTC_6x6_Format},TYPE_MAP={[Ae]:FloatType,[pe]:HalfFloatType,[Ot]:UnsignedByteType,[Ft]:UnsignedByteType,[de]:FloatType,[se]:HalfFloatType,[yt]:UnsignedByteType,[dt]:UnsignedByteType,[xe]:FloatType,[$t]:HalfFloatType,[gt]:UnsignedByteType,[ct]:UnsignedByteType,[In]:UnsignedByteType,[Sn]:UnsignedByteType};async function createRawTexture(s){const{vkFormat:e}=s;if(FORMAT_MAP[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;s.supercompressionScheme===n&&(_zstd||(_zstd=new Promise(async l=>{const a=new Q;await a.init(),l(a)})),i=await _zstd);const r=[];for(let l=0;l<s.levels.length;l++){const a=Math.max(1,s.pixelWidth>>l),c=Math.max(1,s.pixelHeight>>l),d=s.pixelDepth?Math.max(1,s.pixelDepth>>l):0,u=s.levels[l];let f;if(s.supercompressionScheme===t)f=u.levelData;else if(s.supercompressionScheme===n)f=i.decode(u.levelData,u.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let m;TYPE_MAP[e]===FloatType?m=new Float32Array(f.buffer,f.byteOffset,f.byteLength/Float32Array.BYTES_PER_ELEMENT):TYPE_MAP[e]===HalfFloatType?m=new Uint16Array(f.buffer,f.byteOffset,f.byteLength/Uint16Array.BYTES_PER_ELEMENT):m=f,r.push({data:m,width:a,height:c,depth:d})}let o;if(UNCOMPRESSED_FORMATS.has(FORMAT_MAP[e]))o=s.pixelDepth===0?new DataTexture(r[0].data,s.pixelWidth,s.pixelHeight):new Data3DTexture(r[0].data,s.pixelWidth,s.pixelHeight,s.pixelDepth);else{if(s.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");o=new CompressedTexture(r,s.pixelWidth,s.pixelHeight)}return o.mipmaps=r,o.type=TYPE_MAP[e],o.format=FORMAT_MAP[e],o.colorSpace=parseColorSpace(s),o.needsUpdate=!0,Promise.resolve(o)}function parseColorSpace(s){const e=s.dataFormatDescriptor[0];return e.colorPrimaries===F?e.transferFunction===x?SRGBColorSpace:LinearSRGBColorSpace:e.colorPrimaries===X?e.transferFunction===x?DisplayP3ColorSpace:LinearDisplayP3ColorSpace:(e.colorPrimaries===E||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),NoColorSpace)}let NAME_INDEX_MAP={};function GenerateName(s,e){let i=NAME_INDEX_MAP;window.DMC?.scene&&(i=NAME_INDEX_MAP={},window.DMC.scene.traverse(l=>{if(l.name?.length>0){const a=l.name;i[a]==null&&(i[a]=0),i[a]++}}));let r=1;if(i[e]==null)return s.name=e;for(;;){let l=e+r;if(i[l]==null)return i[l]=1,s.name=l;r++}}const texture_loader=new TextureLoader;var G_MMDLoader=null,G_MMDLoader_lock=!1;async function get_MMDLoader(){for(;G_MMDLoader_lock;)await C$2.sleep(20);return G_MMDLoader_lock=!0,G_MMDLoader==null&&(G_MMDLoader=new MMDLoader),G_MMDLoader_lock=!1,G_MMDLoader}var G_ktx2Loader=null,G_ktx2Loader_lock=!1;async function ktx2_loader(){for(;G_ktx2Loader_lock;)await C$2.sleep(50);if(G_ktx2Loader_lock=!0,G_ktx2Loader==null){const s=new KTX2Loader;s.setTranscoderPath("ddd/jsm/libs/basis/").detectSupport(DMC.base_renderer),G_ktx2Loader=s}return G_ktx2Loader_lock=!1,G_ktx2Loader}var G_dracoLoader=null,G_dracoLoader_lock=!1;async function draco_loader(){for(;G_dracoLoader_lock;)await C$2.sleep(50);if(G_dracoLoader_lock=!0,G_dracoLoader==null){const{DRACOLoader:s}=await __vitePreload(()=>import("./DRACOLoader@CxWNGOWb.js"),[],import.meta.url),e=new s;e.setDecoderPath("ddd/jsm/libs/draco/"),e.setDecoderConfig({type:"js"}),G_dracoLoader=e}return G_dracoLoader_lock=!1,G_dracoLoader}function drc(s,e={}){const i=TimeDurationChecker("DRACO: "+s);return Object.assign({scale:{x:1,y:1,z:1},position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},e),new Promise((o,l)=>{(async()=>(await draco_loader()).load(s,function(c){if(i.finish(),c instanceof BufferGeometry){const d=new MeshPhysicalMaterial({color:6316128});c.computeVertexNormals();const u=new Mesh(c,d);u.castShadow=!0,u.receiveShadow=!0,o(u)}else l("Unknown type")},null,l))()})}function load_texture_from_system_resource(s,e,i){const r=typeof e=="function"?e:i;return new Promise(async(o,l)=>{try{window.external_io&&await window.PrepareFromSystemResource(s);try{const a=await load_texture(s,e,i);a.source_file=s,o(a)}catch(a){r?(r(a),o(null)):l(a)}}catch(a){console.error(a),r?(r(a),o(null)):l(a)}})}var G_loader_tbl={},G_loader_tbl_lock=!1;async function get_texture_loader(s){for(;G_loader_tbl_lock;)await C$2.sleep(50);G_loader_tbl_lock=!0;const e=s.split(".").pop().toLowerCase();let i=texture_loader;if(G_loader_tbl[e])i=G_loader_tbl[e];else{if(window.is_data_url(s))i=texture_loader;else if(e=="dds"){const{DDSLoader:o}=await __vitePreload(()=>import("./DDSLoader@C9wWxVpS.js"),[],import.meta.url);i=new o}else if(e=="tga")i=texture_loader;else if(e=="hdr")i=new RGBELoader;else if(e=="hdri"){const{RGBMLoader:o}=await __vitePreload(()=>import("./RGBMLoader@Bbtewkqq.js"),[],import.meta.url);i=new o}else if(e=="exr"){const{EXRLoader:o}=await __vitePreload(()=>import("./EXRLoader@7UhQUwQ2.js"),__vite__mapDeps([3,1]),import.meta.url);i=new o}else if(e=="ktx"||e=="ktx2")i=await ktx2_loader();else if(e=="pvr"||e=="pvrtc"){const{PVRLoader:o}=await __vitePreload(()=>import("./PVRLoader@CwxczKK9.js"),[],import.meta.url);i=new o}else if(e=="svg"){const{SVGLoader:o}=await __vitePreload(()=>import("./SVGLoader@D0iCujXh.js"),[],import.meta.url);i=new o}else i=texture_loader;G_loader_tbl[e]=i}return G_loader_tbl_lock=!1,i}var G_texture_weak_tbl={},G_texture_lock_tbl={},G_texture_cache_flag=!0;function gc_texture(){for(const s in G_texture_weak_tbl)if(!G_texture_lock_tbl[s]){const e=G_texture_weak_tbl[s];e?.weak&&e.weak.deref()==null&&(delete G_texture_weak_tbl[s],console.log("GC:",e.src))}}async function load_texture(s,e,i){const r={cache:!0,loader_hint:null,replacer:!0};let o=null;typeof e=="function"?o=e:typeof e=="object"&&typeof i=="function"?(Object.assign(r,e),o=i):typeof e=="object"&&Object.assign(r,e);let l=!1;if(window.is_data_url(s)?(l=!0,r.cache=!1):s=s.replace(/\\/g,"/"),r.cache){for(;G_texture_lock_tbl[s];)await C$2.sleep(50);if(gc_texture(),G_texture_weak_tbl[s]){const a=performance.now(),c=G_texture_weak_tbl[s];if(c.weak){const d=c.weak.deref();if(window.debug_texture_cache&&d&&console.log("Cache HIT:",s),d){const u=d;return o&&o(null,u),u}c.weak=null}else if(a-c.date>1e3*5){if(c.strong){const d=c.strong;return c.weak=new WeakRef(c.strong),c.strong=null,window.debug_texture_cache&&console.log("Cache HIT:",s),o&&o(null,d),d}}else if(c.strong){window.debug_texture_cache&&console.log("Cache HIT:",s);const d=c.strong;if(d)return o&&o(null,d),d}}G_texture_lock_tbl[s]=!0}return new Promise(async(a,c)=>{const d=s.split(".").pop().toLowerCase();if(C$2.file_type(d)=="video"){try{window.debug&&console.log(s);const f=await load_video_texture(s);G_texture_cache_flag&&(G_texture_weak_tbl[s]={src:s,date:performance.now(),strong:f,weak:null},delete G_texture_lock_tbl[s]),o&&o(null,f),a(f)}catch(f){delete G_texture_lock_tbl[s],o&&o(f,null),c(f)}DMC.dispatchEvent("update@dynamic_env_map")}else{let f=null,m=s,h=r.replacer!=!0;if((d=="dds"||d=="pvr"||d=="etc"||d=="etc1"||d=="ktx"||d=="ktx2"||d=="exr"||d=="hdr"||d=="hdri")&&(h=!0),l==!1&&h==!1){const _=s.slice(0,s.lastIndexOf("."))+".ktx2",b=await window.cross_file_system.exists(_);window.debug&&console.log("Check:",b,_),m=b?_:s,window.debug&&window.debug_texture&&b&&console.log("Replaced to KTX2:",m),f=await get_texture_loader(m)}else{const _=r?.loader_hint;_!=null?f=await get_texture_loader("dummy."+_):f=await get_texture_loader(m)}f.load(m,function(_){G_texture_weak_tbl[s]={src:s,date:performance.now(),strong:_,weak:null},delete G_texture_lock_tbl[s],window.texture_counter!=null&&console.log("TX:",++window.texture_counter,C$2.DPath(s).basename,`${_.image?.width}x${_.image?.height}`),(d=="dds"||d=="pvr"||d=="etc"||d=="etc1"||d=="ktx"||d=="ktx2"||d=="exr"||d=="hdr"||d=="hdri")&&(_.generateMipmaps=!1),(d=="exr"||d=="hdr"||d=="hdri")&&(_.mapping=EquirectangularReflectionMapping),_.wrapS=RepeatWrapping,_.wrapT=RepeatWrapping,_.anisotropy=window.anisotropy,l||(_.source_file=s),o&&o(null,_),a(_),DMC.dispatchEvent("update@dynamic_env_map")},null,_=>{console.error(_),delete G_texture_weak_tbl[s],delete G_texture_lock_tbl[s],window.texture_counter!=null&&console.log("TX:",++window.texture_counter,C$2.DPath(s).basename),(d=="dds"||d=="pvr"||d=="etc"||d=="etc1"||d=="ktx"||d=="ktx2")&&(console.error("Only DXT1/DXT3/DXT5/ETC1/PVR/KTX2 are available. : ",d,s),console.error(_)),o?(o(_),a()):c(_)})}})}function load_video_texture(s,e={}){const i={autoplay:!1,loop:!0,volume:0,muted:!0};return e&&Object.assign(i,e),new Promise(async(r,o)=>{const l=document.createElement("video");l.setAttribute("controls",""),l.setAttribute("webkit-playsinline",""),l.setAttribute("playsinline",""),l.loop=i.loop,l.volume=i.volume,l.autoplay=i.autoplay,l.muted=i.muted,l.addEventListener("loadeddata",function(){console.log("Loaded video texture:",s);const f=new VideoTexture(this);f.colorSpace=SRGBColorSpace,f.wrapS=ClampToEdgeWrapping,f.wrapT=ClampToEdgeWrapping,f.magFilter=LinearFilter,f.minFilter=LinearFilter,f.flipY=!0,f.generateMipmaps=!1,i.autoplay&&this.play(),r(f)},!1),l.addEventListener("ended",function(){},!1);const a=await window.cross_file_system.read(s),c=new Blob([a],{type:"video/mp4"});let d=URL.createObjectURL(c);function u(){d&&(URL.revokeObjectURL(d),d=null)}l.addEventListener("unload",()=>{u()}),l.addEventListener("error",function(f){u(),console.error(f),o(f)},!1),l.src=d,l.source_file=s,l.load(),l.dispose=function(){l.pause(),l.removeAttribute("src"),l.load(),u()}})}function relative_replacer_for_other_props(s,e,i={}){if(typeof e=="object"){const r=Object.keys(e);for(let o=0;o<r.length;o++){const l=r[o],a=e[l];if(a){if(l=="source_file"||l=="_source_file_"||l=="j_object_source_file"){const c=relative_replacer_for_other_props(s,a,i);c&&(e[l]=c)}else if(typeof a=="object")if(Array.isArray(a))for(let c=0;c<a.length;c++)a[c]&&relative_replacer_for_other_props(s,a[c],i);else relative_replacer_for_other_props(s,a,i)}}}else if(typeof e=="string"){const r=C$2.DPath(e);let o=null;if(window.external_io==null&&window.nodejs&&r.path.indexOf(nodejs.root_path)==0)return r.path;if(i.both_should_be_absolute){const l="/"+s,a="/"+r.path;o=C$2.path.relative(C$2.DPath(l).dirname,a)}else r.is_absolute_path?o=C$2.path.relative(C$2.DPath(s).dirname,r.path):o=r.path;return o}}function convert_to_relative_path(s,e,i={}){e&&relative_replacer_for_other_props(s,e,i)}function abs_replacer_for_other_props(s,e,i={}){if(typeof e=="object"){const r=Object.keys(e);for(let o=0;o<r.length;o++){const l=r[o],a=e[l];if(a){if(l=="source_file"||l=="_source_file_"||l=="j_object_source_file"){const c=abs_replacer_for_other_props(s,a,i);c&&(e[l]=c)}else if(typeof a=="object")if(Array.isArray(a))for(let c=0;c<a.length;c++)a[c]&&abs_replacer_for_other_props(s,a[c],i);else abs_replacer_for_other_props(s,a,i)}}}else if(typeof e=="string"){const r=C$2.DPath(e);let o=null;if(r.is_absolute_path)o=r.path;else if(i.left_should_be_absolute_path){const l="/"+s,a=r.path;o=C$2.path.join(C$2.DPath(l).dirname,a),o=o.slice(1,o.length)}else if(s.indexOf("://")>=0){const l=new URL(s);o=l.origin+C$2.path.join(C$2.DPath(l.pathname).dirname,r.path)}else o=C$2.path.join(C$2.DPath(s).dirname,r.path);return o.indexOf("/w/")>=0&&console.warn(o),o}}function convert_to_abs_path(s,e,i={}){e&&abs_replacer_for_other_props(s,e,i)}async function get_default_setting_for_action(){return((await GetSystemPreferences({})).ui?.system_flags?.loading_behavior??{})?.action??{}}async function setup_default_setting_for_action(s,e=LoopRepeat){const i=s.getActionTable(),r=await get_default_setting_for_action();for(const o in i)i[o].loop=r.loop??e}async function setup_animation_helper_prop(s,e){e&&Object.assign({},e);const r=["blendMode","clampWhenFinished","loop","paused","repetitions","time","timeScale","timeOffset","weight","zeroSlopeAtEnd","zeroSlopeAtStart","crossFadeIn","crossFadeOut","crossFadeInDuration","crossFadeOutDuration"];function o(){s.traverse(u=>{u.isMesh&&(u.__prevent__motion_blur__=!0)})}function l(u,f){if(u&&f)for(const m of r)f[m]!==void 0&&(u[m]=f[m])}function a(u){return u.crossFadeIn=u.crossFadeIn??!1,u.crossFadeOut=u.crossFadeOut??!1,u.crossFadeInDuration=u.crossFadeInDuration??.15,u.crossFadeOutDuration=u.crossFadeOutDuration??.15,u}{const u=s._dp_;if(u.action={scale:1,index:-1,mode:"Single",sources:[],action_table:{},toJSON(){const f=u.action,m=f.action_table,h={index:f.index,mode:f.mode,sources:f.sources,action_table:{}},_=h.action_table;for(const b in m){_[b]={};for(const v of r){const w=m[b][v],y=typeof w;(y=="string"||y=="number"||y=="boolean"||w==null)&&(_[b][v]=w)}}return h}},u.__action_tmp__={__mixer__:new AnimationMixer(s),__action_list__:[],__current_action__:null},u.__action_tmp__.__mixer__.addEventListener("finished",o),u.actions?.length>0){{u.action.index=u.action_index??0;for(let f=0;f<u.actions.length;f++){const m=u.actions[f];(m.type=="vmd"||m.type=="vpd")&&u.action.sources.push(m)}}delete u.actions,delete u.action_index,delete u.action_cross_fade,delete u.action_cross_fade_duration}}const c=()=>s._dp_.__action_tmp__,d=()=>s._dp_.action;if(s.setActionMode=function(u){const f=c(),m=d();if(u=="Single"){m.mode=u,f.__current_action__=null,f.__mixer__&&f.__mixer__.stopAllAction(),f.__mixer__=new AnimationMixer(s),f.__mixer__.addEventListener("finished",o);for(let h=0;h<f.__action_list__.length;h++){const b=f.__action_list__[h]._clip,v=m.action_table[b.name],w=a(f.__mixer__.clipAction(b));w.weight=1,m.action_table[b.name]=f.__action_list__[h]=w,l(w,v)}s.setCurrentAction(m.index)}else if(u=="Multiple"){m.mode=u,f.__current_action__=null,f.__mixer__&&f.__mixer__.stopAllAction(),f.__mixer__=new AnimationMixer(s),f.__mixer__.addEventListener("finished",o);for(let h=0;h<f.__action_list__.length;h++){const b=f.__action_list__[h]._clip,v=m.action_table[b.name],w=a(f.__mixer__.clipAction(b));m.action_table[b.name]=f.__action_list__[h]=w,w.play(),l(w,v)}f.__is_mixing__=!0}else u==null&&s.setActionMode(m.mode)},s.resetTimeAllAction=function(){const u=c(),f=u.__action_list__;if(u.__is_mixing__&&u.__mixer__){s.pose?.();for(const m of f)m.isRunning()&&(m.stop(),m.play());u.__mixer__.setTime(-1e-5),u.__mixer__.update(1e-5)}},s.getActionMode=function(){return d().mode},s.updateActions=function(u){const f=c(),m=f.__mixer__;m&&f.__is_mixing__&&m.update(u)},s.getAnimationMixer=function(){return c().__mixer__},s.getCurrentAction=function(){const u=c(),f=d(),m=u.__action_list__,h=f.index;return{name:m[h]?._clip?.name,index:h,action:u.__current_action__}},s.initializeAction=function(){s.setActionMode(null)},s.setActions=async function(u,f){const m=c();f&&Object.assign({keep_previous_prop:!0,vmd_source_object:!1},f);const _=d();m.__mixer__?.stopAllAction?.(),m.__mixer__=new AnimationMixer(s),s.isMMD?s==u||(_.sources=[]):_.sources=[],await this.addActions(u,f)},s.addActions=async function(u,f){const m={keep_previous_prop:!0,vmd_source_object:!1};f&&Object.assign(m,f);const h=c(),_=d(),b=h.__mixer__;if(s.isMMD){const w=(await BuilderUtil.get_MMDLoader()).animationBuilder;if(typeof u=="string"){const y=u.split(".").pop().toLowerCase();if(!(y=="vmd"||y=="vpd"))throw new TypeError(u+" is not vmd or vpd file.");const M=await Builder3D.build_by_file_path(u),S={type:y,instance:{data:M,clip:null},source_file:u};_.sources.push(S),this._motion_mapper_proc_();const D=w.build(M,s,{mapper:m.mapper});D.name=C$2.DPath(u).name,S.instance.clip=D}else if(u==null)_.sources=[];else if(typeof u=="object")if(m.vmd_source_object){if(_.sources.push(u),this._motion_mapper_proc_(),u.instance.clip==null){s.isCamera?u.instance.clip=w.buildCameraAnimation(u.instance.data):u.instance.clip=w.build(u.instance.data,s,{mapper:m.mapper});let y=u.source_file.split("/").pop();y=y.slice(0,y.lastIndexOf(".")),u.instance.clip.name=y}}else if(u==s){this._motion_mapper_proc_();for(const y of _.sources)if((y.source_file||y.instance&&!Array.isArray(y.instance))&&y.instance.clip==null){s.isCamera?y.instance.clip=w.buildCameraAnimation(y.instance.data):y.instance.clip=w.build(y.instance.data,s,{mapper:m.mapper});let M=y.source_file.split("/").pop();M=M.slice(0,M.lastIndexOf(".")),y.instance.clip.name=M}}else throw new TypeError("Could not apply another object actions.");else throw new TypeError("First arg must be string(URL) or array[animation clip,] or animation clip.")}else if(typeof u=="string"){const w=await Builder3D.build_by_file_path(u);w?.animations?.length>0&&(_.sources.push({instance:w.animations,source_file:u}),this._motion_mapper_proc_())}else if(u==null)_.sources=[];else if(typeof u=="object")if(u instanceof Object3D&&u.animations){if(s==u)u.animations.length>0&&_.sources.push({instance:u.animations,source_file:null});else if(u.animations){const w=u._dp_;_.sources.push({instance:u.animations,source_file:w?.source_file})}}else _.sources.push({instance:Array.isArray(u)?u:[u],source_file:null});else throw new TypeError("First arg must be string(URL) or array[animation clip,] or animation clip.");if(h.__action_list__)for(const w of h.__action_list__)w.stop();h.__action_list__=[],h.__current_action__=null;const v=_.action_table;_.action_table={},_.sources.length&&s.isMMD;for(const w of _.sources){let y=function(M){const S=M.name,D=a(b.clipAction(M));if(h.__action_list__.push(D),_.action_table[S])throw new Error("Double unique name. Action name must be unique.");if(m.keep_previous_prop){const k=v[S];l(D,k)}return _.action_table[S]=D,D};if(s.isMMD)if(Array.isArray(w.instance))for(const M of w.instance)y(M.clip).play();else y(w.instance.clip).play();else if(Array.isArray(w.instance))for(const M of w.instance)y(M);else y(w.instance)}s.getActionMode()=="Single"&&s.setCurrentAction(s.getCurrentAction().index),h.__action_list__.length==0&&(h.__mixer__?.stopAllAction?.(),h.__mixer__=null)},s.getActionList=function(){return c().__action_list__},s.setAnimationTime=function(u){throw new Error("Not implemented.")},s.getActionTable=function(){return d().action_table},s.getActionSources=function(){return d().sources},s.getAction=function(u){const f=c(),m=d();return typeof u=="string"?m.action_table[u]:typeof u=="number"?f.__action_list__[u]:null},s.getCurrentActionSource=function(){const u=d();return u.sources[u.index]},s.setCurrentAction=function(u,f){const m={crossFade:void 0,crossFadeDuration:void 0};f&&Object.assign(m,f);const h=c(),_=d();if(_.mode!="Single")throw new Error("Current action mode is not 'Single'.");const b=h.__current_action__,v=h.__action_list__;let w=null,y=-1;if(v?.length>0&&u!=null)if(typeof u=="string"){for(let M=0,S=v.length;M<S;++M){const D=v[M];if(D._clip.name===u){w=D,y=M;break}}w||console.warn("Does not exist:",u)}else if(typeof u=="number")w=v[u],y=u,!w&&y!=-1&&console.warn("Does not exist animation index:",u);else throw console.error(u),new TypeError("Type must be String/Number.");_.index=y,h.__current_action__=w,m.crossFade===void 0&&(b&&b.crossFadeOut&&(m.crossFade=!0,m.crossFadeDuration=b.crossFadeOutDuration??.15),w&&w.crossFadeIn&&(m.crossFade=!0,m.crossFadeDuration=w.crossFadeInDuration??.15));for(const M of h.__action_list__)b!=M&&M.stop();return m.crossFade&&w&&b?b.crossFadeTo(w,m.crossFadeDuration):b&&b.stop(),w&&(w.time=w.timeOffset,w.play()),w?h.__is_mixing__=!0:h.__is_mixing__=!1,s.getCurrentAction()},s._motion_mapper_proc_=function(){if(s.isMMD){const u=s.getActionSources();for(const f of u){const m=f.instance.data,h=f.mapper,_=h?.morph,b=h?.bone;if(_){const w=[];for(const y in _){const M=_[y],S=M?.key,D=M?.type;if(S!=null&&D!="add")for(const k of m.morphs)k.morphName==y&&(k.morphName=S)}for(const y of w)m.morphs.push(y);m.morphs.sort((y,M)=>y.frameNumber<M.frameNumber?-1:y.frameNumber>M.frameNumber?1:0)}if(b){const w=[];for(const y in b){const M=b[y],S=M?.key,D=M?.type;if(S!=null&&D!="add")for(const k of m.motions)k.boneName==y&&(k.boneName=S)}for(const y of w)m.motions.push(y);m.motions.sort((y,M)=>y.frameNumber<M.frameNumber?-1:y.frameNumber>M.frameNumber?1:0)}const v=m.cameras;if(v){const w=s._dp_?.action?.scale??1,y=s._dp_?.action?.distance_scale??1;for(const M of v)M.distance*=w*y,M.position[0]*=w,M.position[1]*=w,M.position[2]*=w}}}},s.reloadActions=async function(){const u=s.getActionSources();if(s.isMMD){for(const f of u){const m=f.source_file;if(m){const h=m.split(".").pop().toLowerCase();if(!(h=="vmd"||h=="vpd"))throw new TypeError(m+" is not vmd or vpd file.");const _=await Builder3D.build_by_file_path(m);console.log("Reloaded:",m),f.instance==null&&(f.instance={}),f.instance.clip=null,f.instance.data=_,this._motion_mapper_proc_()}}s.setActions(s,{keep_previous_prop:!0})}},s.getDDDProperties().on_ready=async function(){const u=s.getDDDProperties();if(window.debug_action&&console.log("on_ready"),s.getActionSources().length>0){if(s.isMMD){const m=s.getActionSources();for(const h of m)h.instance?.data==null&&(h.instance={clip:null,data:null},h.type=="vmd"?h.instance.data=await vmd(h.source_file):h.type=="vpd"&&(h.instance.data=await vpd(h.source_file)))}await s.setActions(s,{keep_previous_prop:!0});const f=s.getCurrentAction().index;s.setActionMode(null),s.getActionMode()=="Single"&&s.setCurrentAction(f)}else s.animations?.length>0&&(await s.setActions(s,{keep_previous_prop:!0}),s.getActionMode()=="Single"&&s.setCurrentAction(0));delete u.on_ready},s.isCamera){s.setActionMode(null);const u=c();u.__action_list__.length==0&&(u.__mixer__?.stopAllAction?.(),u.__mixer__=null)}}async function tessellate(s){const e=s.getDDDProperties?.(),i=s.isSkinnedMesh,r=s.morphTargetInfluences?.length>0;if(e?.tessellation?.enabled&&!i&&!r){const o=new TessellateModifier(e.tessellation.maxEdgeLength,e.tessellation.maxIterations);if(s._original_geometry_==null&&(s._original_geometry_=s.geometry),s._original_geometry_!=null&&s.geometry!=s._original_geometry_){const l=s.geometry;s.geometry=null,l.dispose()}s.geometry=o.modify(s._original_geometry_)}else{if(s._original_geometry_!=null&&s.geometry!=s._original_geometry_){const o=s.geometry;s.geometry=null,o.dispose()}s.geometry=s._original_geometry_??s.geometry}}function add_helper_control_prop(s,e){Object.defineProperty(s,"helper_visible",{get:function(){return e.visible},set:function(i){return e.visible=i}})}function PBRMaterial(s){let e=new MeshPhysicalMaterial;e.side=FrontSide,e.shadowSide=FrontSide,e.alphaTest=.01,e.alphaToCoverage=!0,e.transparent=!0,e.blending=NormalBlending,e.sheen=.05,e.sheenRoughness=.5,e.ior=1.5,e.reflectivity=.5,e.roughness=.85;for(let i in s)e[i]=s[i];return e}function CreateMesh(s,e){const i=new InstancedMesh(s,e,1024);return i.count=1,i.castShadow=!0,i.receiveShadow=!0,i}function CreateSpectrumObject(s="A"){const i=DMC.sound_listener.context.createAnalyser();let r=0,o;{i.fftSize=256,i.minDecibels=-70,i.maxDecibels=-10,i.smoothingTimeConstant=.75,r=i.frequencyBinCount;const c=new BufferGeometry,d=new Float32Array(r*4*3),u=new Float32Array(r*4*3),f=new Float32Array(r*4*3),m=new Float32Array(r*4*2);let h=0;for(let D=0;D<r;D++)d[D*4*3+0]=h,d[D*4*3+1]=0,d[D*4*3+2]=0,d[D*4*3+3]=h,d[D*4*3+4]=10,d[D*4*3+5]=0,d[D*4*3+6]=h+1,d[D*4*3+7]=10,d[D*4*3+8]=0,d[D*4*3+9]=h+1,d[D*4*3+10]=0,d[D*4*3+11]=0,m[D*4*2+0]=0,m[D*4*2+1]=0,m[D*4*2+2]=0,m[D*4*2+3]=1,m[D*4*2+4]=1,m[D*4*2+5]=1,m[D*4*2+6]=1,m[D*4*2+7]=0,f[D*4*3+0]=0,f[D*4*3+1]=0,f[D*4*3+2]=1,f[D*4*3+3]=0,f[D*4*3+4]=0,f[D*4*3+5]=1,f[D*4*3+6]=0,f[D*4*3+7]=0,f[D*4*3+8]=1,f[D*4*3+9]=0,f[D*4*3+10]=0,f[D*4*3+11]=1,h++;const _=[],b=new BufferAttribute(d,3);b.setUsage(DynamicDrawUsage),c.setAttribute("position",b);const v=new BufferAttribute(u,3);c.setAttribute("color",v),v.setUsage(DynamicDrawUsage);const w=new BufferAttribute(f,3);c.setAttribute("normal",w);const y=new BufferAttribute(m,2);c.setAttribute("uv",y);let M=0;for(let D=0;D<r;D++)_.push(M+2,M+1,M,M,M+3,M+2),M+=4;c.setIndex(_);const S=new MeshPhysicalMaterial;S.color.setHex(4473924),S.emissive.setHex(16711680),S.emissiveIntensity=3,S.vertexColors=!0,S.transparent=!0,S.opacity=.75,S.flatShading=!0,S.depthWrite=!1,S.blending=NormalBlending,S.side=DoubleSide,S.castDynamicEnvironment=!1,S.receiveDynamicEnvironment=!1,o=new Mesh(c,S),o.castShadow=!1,o.receiveShadow=!1,o.frustumCulled=!1,o.renderOrder=1,o.geometry.computeTangents()}const l=new Uint8Array(r);let a=!1;return s=="A"?o.user.updaters.fft=()=>{i.getByteFrequencyData(l);const c=o.geometry.attributes.position.array,d=o.geometry.attributes.color.array;o.geometry.attributes.normal.array,o.geometry.attributes.uv.array;const u=0,f=r/2+r/2*u;let m=0;for(let h=0,_=r*4*3;h<_;h+=12){const b=l[m];c[h+0]=m+u*m-f,c[h+1]=0,c[h+2]=0,c[h+3]=m+u*m-f,c[h+4]=b,c[h+5]=0,c[h+6]=m+1+u*m-f,c[h+7]=b,c[h+8]=0,c[h+9]=m+1+u*m-f,c[h+10]=0,c[h+11]=0;const v=.5*b/64;d[h+0]=v,d[h+1]=v,d[h+2]=v,d[h+3]=v,d[h+4]=v,d[h+5]=v,d[h+6]=v,d[h+7]=v,d[h+8]=v,d[h+9]=v,d[h+10]=v,d[h+11]=v,m++}a==!1&&(a=!0,o.geometry.computeVertexNormals(),o.geometry.computeTangents()),o.geometry.attributes.position.needsUpdate=!0,o.geometry.attributes.color.needsUpdate=!0}:s=="B"&&(o.user.updaters.fft=()=>{i.getByteFrequencyData(l);const c=o.geometry.attributes.position.array,d=o.geometry.attributes.color.array;o.geometry.attributes.normal.array;const u=30;let f=0;const m=Math.PI/r*1.5;for(let h=0,_=r*4*3;h<_;h+=12){const b=m*f+Math.PI-Math.PI/4;c[h+0]=Math.cos(b)*u-Math.sin(b)*u,c[h+1]=0,c[h+2]=Math.sin(b)*u+Math.cos(b)*u,c[h+3]=Math.cos(b)*u-Math.sin(b)*u,c[h+4]=1/Math.exp(l[f]/255)*l[f]*.5,c[h+5]=Math.sin(b)*u+Math.cos(b)*u,c[h+6]=Math.cos(b+m)*u-Math.sin(b+m)*u,c[h+7]=1/Math.exp(l[f]/255)*l[f]*.5,c[h+8]=Math.sin(b+m)*u+Math.cos(b+m)*u,c[h+9]=Math.cos(b+m)*u-Math.sin(b+m)*u,c[h+10]=0,c[h+11]=Math.sin(b+m)*u+Math.cos(b+m)*u;const v=.5*l[f]/64;d[h+0]=v,d[h+1]=v,d[h+2]=v,d[h+3]=v,d[h+4]=v,d[h+5]=v,d[h+6]=v,d[h+7]=v,d[h+8]=v,d[h+9]=v,d[h+10]=v,d[h+11]=v,f++}a==!1&&(a=!0),o.geometry.attributes.position.needsUpdate=!0,o.geometry.attributes.color.needsUpdate=!0}),o.setAudio=function(c){if(c)if(c.source)c.source.connect(i);else{debugger;console.warn("There is no audio source.")}},o}const DEFAULT_FONT_FAMILY='"Helvetica Neue",Arial,"Hiragino Kaku Gothic ProN","Hiragino Sans",Meiryo,sans-serif',DEFAULT_FONT_SIZE=24,DEFAULT_FONT_WEIGHT="",DEFAULT_TEXT_TEX_WIDTH=256,DEFAULT_TEXT_TEX_HEIGHT=256;function create_texture_text(s,e){const i={text_color:null,background_color:null,background_type:null,width:DEFAULT_TEXT_TEX_WIDTH,height:DEFAULT_TEXT_TEX_HEIGHT,font_size:DEFAULT_FONT_SIZE,font_family:DEFAULT_FONT_FAMILY,font_weight:DEFAULT_FONT_WEIGHT,delimiter:" ",word_split:!1,popup:"rect",fit_popup:!1,v_align:"top",h_align:"left",edge_color:"#000000",edge_width:0,h_padding:10,v_padding:10,warp:!0,v_direction:"down"};e&&Object.assign(i,e);function r(h,_,b,v=!1,w=" "){const y=_.split(`
`),M=[];for(const S of y)if(v){const D=S.split(w);let k=D[0];for(let O=1;O<D.length;O++){const L=D[O];h.measureText(k+w+L).width<b?k+=w+L:(M.push({text:k,width:h.measureText(k).width}),k=L)}M.push({text:k,width:h.measureText(k).width})}else{let D="";for(const k of S)h.measureText(D+k).width<b||(M.push({text:D,width:h.measureText(D).width}),D=""),D+=k;M.push({text:D,width:h.measureText(D).width})}return M}const o=document.createElement("canvas");o.width=i.width,o.height=i.height,o.style.width=o.width+"px",o.style.height=o.height+"px";const l=o.getContext("2d"),a=i.font_size,c=i.font??DEFAULT_FONT_FAMILY,d=i.font_weight??"";l.font=`${d} ${a}px ${c}`;const u=r(l,s,o.width-i.h_padding*2,i.word_split,i.delimiter),f=i.fit_popup?u.length*a+i.v_padding*2:o.height;if(i.popup=="rect"){l.fillStyle="#00000000",l.fillRect(0,0,o.width,o.height),l.fillStyle=i.background_color?i.background_color:"#00000000";const h=i.edge_width;h>0&&(l.lineWidth=h,l.fillRect(h,h,o.width-h*2,f-h*2),l.beginPath(),l.strokeStyle=i.edge_color,l.rect(h,h,o.width-h*2,f-h*2),l.stroke())}else if(i.popup=="ellipse"){l.fillStyle="#00000000",l.fillRect(0,0,o.width,o.height),l.fillStyle=i.background_color?i.background_color:"#00000000";const h=i.edge_width;if(h>0){l.lineWidth=h;const _=(o.width-h*2)/2,b=(f-h*2)/2;l.beginPath(),l.ellipse(h+_,h+b,_,b,0,0,2*Math.PI),l.fill(),l.beginPath(),l.strokeStyle=i.edge_color,l.ellipse(h+_,h+b,_,b,0,0,2*Math.PI),l.stroke()}}else l.fillStyle=i.background_color?i.background_color:"#00000000",l.fillRect(0,0,o.width,o.height);i.text_color&&(l.fillStyle=i.text_color);for(let h=0;h<u.length;h++){const _=u[h];let b=0,v=0;i.h_align=="center"?(b=(o.width-_.width)/2,b=Math.max(b,0),b-=i.h_padding):i.h_align=="right"&&(b=o.width-_.width,b-=i.h_padding*2),i.v_align=="center"||i.v_align=="bottom",l.fillText(_.text,i.h_padding+b,i.v_padding+v+a*(h+1))}return new CanvasTexture(o)}async function create_text_object(s){return new Promise(async(e,i)=>{const r={width:DEFAULT_TEXT_TEX_WIDTH,height:DEFAULT_TEXT_TEX_HEIGHT,sprite:!1,vertex_font:!1,font:DEFAULT_FONT_FAMILY,font_size:DEFAULT_FONT_SIZE,font_weight:DEFAULT_FONT_WEIGHT};if(s&&Object.assign(r,s),r.vertex_font){const o="test/Noto Sans JP_Regular.json",{FontLoader:l}=await __vitePreload(()=>import("./FontLoader@CPDo5AhB.js"),[],import.meta.url),{TextGeometry:a}=await __vitePreload(()=>import("./TextGeometry@C2AAkLzk.js"),[],import.meta.url);new l().load(o,d=>{console.log("loaded font!!");const u=new a("",{font:d,size:.5,height:.2,curveSegments:12,bevelEnabled:!0,bevelThickness:.03,bevelSize:.02,bevelOffset:0,bevelSegments:5});u.center();const f=new MeshStandardMaterial,m=CreateMesh(u,f);m.castShadow=!0,m.position.z=-10;const h=.1;m.scale.set(h,h,h),e(m)},null,d=>{console.error(d),i(d)})}else{let o=null;if(r.sprite){o=new Sprite(new SpriteMaterial({map:null}));const l=25;o.scale.set(r.width/r.height*l,l,1),o.name="SpriteText"}else o=CreateMesh(new PlaneGeometry(5,5),new MeshBasicMaterial),o.name=C$2.generate_unique_name("PlaneText",DMC.scene),o.scale.set(r.width/r.height*5,5,1),o.geometry.computeVertexNormals(),o.geometry.computeTangents(),o.name="PlaneText";o.material.color.setHex(16777215),o.material.blending=NormalBlending,o.material.transparent=!0,o.material.alphaTest=.1,o.renderOrder=1,o.material.side=DoubleSide,o.castDynamicEnvironment=!1,o.castShadow=!1,o.receiveShadow=!1,o.position.set(0,10,-20),GenerateName(o),e(o)}})}async function SetupTextAttribute(s){const e={text:"",text_color:"#ffffff",background_type:null,background_color:"#00000000",font:DEFAULT_FONT_FAMILY,font_size:DEFAULT_FONT_SIZE,font_weight:DEFAULT_FONT_WEIGHT,width:DEFAULT_TEXT_TEX_WIDTH,height:DEFAULT_TEXT_TEX_HEIGHT,delimiter:" ",edge_color:"#000000",edge_width:3,word_split:!1,sprite:!1,vertex_font:!1},i=s.getDDDProperties(),r=()=>{s.material.map&&s.material.map.dispose(),s.material.map=create_texture_text(i.text.text,i.text)};if(s.setText=function(o){i.text.text=o??"",r()},s.getText=function(){return i.text.text},s.setFont=function(o){i.text.font=o??e.font,r()},s.getFont=function(){return i.text.font},s.setFontSize=function(o){i.text.font_size=o??DEFAULT_FONT_SIZE,r()},s.getFontSize=function(){return i.text.font_size},s.setDelimiter=function(o){i.text.delimiter=o??" ",r()},s.getDelimiter=function(){return i.text.delimiter},s.setWordSplit=function(o){i.text.world_time=o??!1,r()},s.getWordSplit=function(){return i.text.world_time},i.text&&Object.assign(e,i.text),i.text=C$2.clone(e),i.source_file&&i.source_name&&!window.__FontFaceSet__.has(i.source_name)){const o=await window.cross_file_system.read(i.source_file),l=new FontFace(i.source_name,o);document.fonts.add(l),window.__FontFaceSet__.add(i.source_name)}r()}const _BuilderUtil=Object.freeze(Object.defineProperty({__proto__:null,CreateMesh,CreateSpectrumObject,GenerateName,PBRMaterial,SetupTextAttribute,abs_replacer_for_other_props,add_helper_control_prop,convert_to_abs_path,convert_to_relative_path,create_text_object,create_texture_text,draco_loader,drc,get_MMDLoader,get_default_setting_for_action,get_texture_loader,ktx2_loader,load_texture,load_texture_from_system_resource,load_video_texture,relative_replacer_for_other_props,setup_animation_helper_prop,setup_default_setting_for_action,tessellate,texture_loader},Symbol.toStringTag,{value:"Module"}));class LightProbeGenerator{static fromCubeTexture(e){let i=0;const r=new Vector3,o=new Vector3,l=new Color,a=[0,0,0,0,0,0,0,0,0],c=new SphericalHarmonics3,d=c.coefficients;for(let f=0;f<6;f++){const m=e.image[f],h=m.width,_=m.height,b=document.createElement("canvas");b.width=h,b.height=_;const v=b.getContext("2d");v.drawImage(m,0,0,h,_);const w=v.getImageData(0,0,h,_),y=w.data,M=w.width,S=2/M;for(let D=0,k=y.length;D<k;D+=4){l.setRGB(y[D]/255,y[D+1]/255,y[D+2]/255),convertColorToLinear(l,e.colorSpace);const O=D/4,L=-1+(O%M+.5)*S,P=1-(Math.floor(O/M)+.5)*S;switch(f){case 0:r.set(-1,P,-L);break;case 1:r.set(1,P,L);break;case 2:r.set(-L,1,-P);break;case 3:r.set(-L,-1,P);break;case 4:r.set(-L,P,1);break;case 5:r.set(L,P,-1);break}const N=r.lengthSq(),z=4/(Math.sqrt(N)*N);i+=z,o.copy(r).normalize(),SphericalHarmonics3.getBasisAt(o,a);for(let K=0;K<9;K++)d[K].x+=a[K]*l.r*z,d[K].y+=a[K]*l.g*z,d[K].z+=a[K]*l.b*z}}const u=4*Math.PI/i;for(let f=0;f<9;f++)d[f].x*=u,d[f].y*=u,d[f].z*=u;return new LightProbe(c)}static fromCubeRenderTarget(e,i){let r=0;const o=new Vector3,l=new Vector3,a=new Color,c=[0,0,0,0,0,0,0,0,0],d=new SphericalHarmonics3,u=d.coefficients,f=i.texture.type;for(let h=0;h<6;h++){const _=i.width;let b;f===HalfFloatType?b=new Uint16Array(_*_*4):b=new Uint8Array(_*_*4),e.readRenderTargetPixels(i,0,0,_,_,b,h);const v=2/_;for(let w=0,y=b.length;w<y;w+=4){let M,S,D;f===HalfFloatType?(M=DataUtils.fromHalfFloat(b[w]),S=DataUtils.fromHalfFloat(b[w+1]),D=DataUtils.fromHalfFloat(b[w+2])):(M=b[w]/255,S=b[w+1]/255,D=b[w+2]/255),a.setRGB(M,S,D),convertColorToLinear(a,i.texture.colorSpace);const k=w/4,O=-1+(k%_+.5)*v,L=1-(Math.floor(k/_)+.5)*v;switch(h){case 0:o.set(1,L,-O);break;case 1:o.set(-1,L,O);break;case 2:o.set(O,1,-L);break;case 3:o.set(O,-1,L);break;case 4:o.set(O,L,1);break;case 5:o.set(-O,L,-1);break}const P=o.lengthSq(),N=4/(Math.sqrt(P)*P);r+=N,l.copy(o).normalize(),SphericalHarmonics3.getBasisAt(l,c);for(let z=0;z<9;z++)u[z].x+=c[z]*a.r*N,u[z].y+=c[z]*a.g*N,u[z].z+=c[z]*a.b*N}}const m=4*Math.PI/r;for(let h=0;h<9;h++)u[h].x*=m,u[h].y*=m,u[h].z*=m;return new LightProbe(d)}}function convertColorToLinear(s,e){switch(e){case SRGBColorSpace:s.convertSRGBToLinear();break;case LinearSRGBColorSpace:case NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.");break}return s}var LightBuilder=function(){this.makers={async ambient_light(s,e){const i="ambient_light";let r=null;if(typeof e=="string")return console.error("Invalid arg:",i,e),null;const o=new AmbientLight(16772829);return o.intensity=.25,r=o,typeof e=="object"?r=BindObjectAsDDD(r,getDDDProperties(e)):r=BindObjectAsDDD(r,{is_background:!0,type:i,kind:"light",drawable:!1,controllable_geometry:!1,cast_shadow:!1,receive_shadow:!1,draggable_on_tree:!1,droppable_on_tree:!1}),GenerateName(r,"AmbientLight"),r},async directional_light(s,e){const i="directional_light";let r=null;if(typeof e=="string")return console.error("Invalid arg:",i,e),null;const o=new DirectionalLight(16777215);o.castShadow=!0;const l=o.shadow,a=2048;l.mapSize.width=a,l.mapSize.height=a,l.bias=-5e-5,l.normalBias=.1;const c=100;if(l.camera.near=1,l.camera.far=c,l.camera.left=-(c/2),l.camera.right=c/2,l.camera.top=c/2,l.camera.bottom=-(c/2),l.radius=2,l.blurSamples=8,o.intensity=1,o.position.set(1,1,1),o.position.normalize(),o.position.multiplyScalar(c/2),r=o,typeof e=="object"?r=BindObjectAsDDD(r,getDDDProperties(e)):r=BindObjectAsDDD(r,{is_background:!0,type:i,kind:"light",draggable_on_tree:!1,droppable_on_tree:!1,drawable:!1,receive_shadow:!1}),!window.app_mode){const d=new DirectionalLightHelper(o,1,o.color);d.name=d.constructor.name,d.visible=!1,o.target.name="Target",o.target.matrixAutoUpdate=!0,DMC.helper_scene.add(o),DMC.helper_scene.add(o.target),DMC.helper_scene.add(d),getDDDProperties(r).destructors.push(function(){DMC.helper_scene.remove(o),DMC.helper_scene.remove(d),DMC.helper_scene.remove(o.target),Builder3D.remove_object(d)}),add_helper_control_prop(r,d)}return GenerateName(r,"DirectionalLight"),r},async point_light(s,e){const i="point_light";let r=null;if(typeof e=="string")return console.error("Invalid arg:",i,e),null;const o=new PointLight(12624016,2,100);if(o.position.set(2,5,3),o.decay=1,o.power=150,o.distance=0,!window.app_mode){const d=new Mesh(new SphereGeometry(.5,10,10),new MeshPhysicalMaterial),u=BindObjectAsDDD(d);u.castShadow=!1,u.receiveShadow=!1;const f=u.material;f.blending=NormalBlending,f.transparent=!0,f.alphaTest=1e-5,f.color.set(0,0,0),o.renderOrder=5,o.add(u);const m=new Vector3;o.user.updaters.apply_to_emitter=function(){u.material.emissive.copy(o.color),m.set(o.color.r,o.color.g,o.color.b);const h=m.length();u.material.emissiveIntensity=o.intensity,u.material.opacity=Math.min(o.intensity*h/100,1)},GenerateName(u,"Emitter")}const l=1024;o.shadow.mapSize.width=l,o.shadow.mapSize.height=l,o.shadow.bias=-5e-5,o.shadow.normalBias=.1;const a=150;o.shadow.camera.near=1,o.shadow.camera.far=500,o.shadow.camera.left=-a,o.shadow.camera.right=a,o.shadow.camera.top=a,o.shadow.camera.bottom=-a,o.shadow.radius=2,o.shadow.blurSamples=8,r=o,typeof e=="object"?r=BindObjectAsDDD(r,getDDDProperties(e)):r=BindObjectAsDDD(r,{is_background:!0,type:i,kind:"light",drawable:!1,receive_shadow:!1}),o.castShadow=!0;const c=getDDDProperties(r);if(!window.app_mode){const d=new PointLightHelper(o);d.name=d.constructor.name,DMC.helper_scene.add(d),c.destructors.push(function(){DMC.helper_scene.remove(d),Builder3D.remove_object(d)}),add_helper_control_prop(r,d)}return GenerateName(r,"PointLight"),r},async spot_light(s,e){const i="spot_light";let r=null;if(typeof e=="string")return console.error("Invalid arg:",i,e),null;const o=new SpotLight(12624016);o.position.set(5,40,5),o.distance=0,o.decay=1,o.power=150,o.angle=.7,o.penumbra=.8;const l=1024;o.shadow.mapSize.width=l,o.shadow.mapSize.height=l,o.shadow.bias=-5e-5,o.shadow.normalBias=.1;const a=50;if(o.shadow.camera.near=1,o.shadow.camera.far=500,o.shadow.camera.left=-a,o.shadow.camera.right=a,o.shadow.camera.top=a,o.shadow.camera.bottom=-a,o.shadow.radius=2,o.shadow.blurSamples=8,o.target.position.y=-10,o.target.name="Spot Light Direction",o.spotlight_target_position=o.target.position,o.add(o.target),r=o,typeof e=="object"?r=BindObjectAsDDD(r,getDDDProperties(e)):r=BindObjectAsDDD(r,{is_background:!0,type:i,kind:"light",drawable:!1,receive_shadow:!1}),o.castShadow=!0,!window.app_mode){const c=new SpotLightHelper(o);c.name=c.constructor.name,DMC.helper_scene.add(c),getDDDProperties(r).destructors.push(function(){DMC.helper_scene.remove(c),Builder3D.remove_object(c)}),BuilderUtil.add_helper_control_prop(r,c)}return GenerateName(r,"SpotLight"),r},async hemisphere_light(s,e){const i="hemisphere_light";let r=null;if(typeof e=="string")return console.error("Invalid arg:",i,e),null;const o=new HemisphereLight(225361919,12305081,.5);if(o.position.set(0,20,0),o.intensity=.25,r=o,typeof e=="object"?r=BindObjectAsDDD(r,getDDDProperties(e)):r=BindObjectAsDDD(r,{is_background:!0,type:i,kind:"light",drawable:!1,cast_shadow:!1,receive_shadow:!1,draggable_on_tree:!1,droppable_on_tree:!1}),!window.app_mode){const l=new HemisphereLightHelper(o,1);l.name=l.constructor.name,DMC.helper_scene.add(l),getDDDProperties(r).destructors.push(function(){DMC.helper_scene.remove(l),Builder3D.remove_object(l)}),add_helper_control_prop(r,l)}return GenerateName(r,"HemiSphereLight"),r},async rect_area_light(s,e){const i="rect_area_light";let r=null;if(typeof e=="string")return console.error("Invalid arg:",i,e),null;const o=new RectAreaLight(16777215,5,10,10);r=o,r.rotateX(Math.PI/180*270),r.position.set(0,30,0),typeof e=="object"?r=BindObjectAsDDD(r,getDDDProperties(e)):r=BindObjectAsDDD(r,{is_background:!0,type:i,kind:"light",drawable:!1,receive_shadow:!1});const l=getDDDProperties(r),{RectAreaLightHelper:a}=await __vitePreload(()=>import("./RectAreaLightHelper@CSAnfQbR.js"),[],import.meta.url),c=new a(o);return DMC.helper_scene.add(c),l.destructors.push(function(){DMC.helper_scene.remove(c)}),add_helper_control_prop(r,c),GenerateName(r,"RectAreaLight"),r},async light_probe(s,e){const i="light_probe";let r=null;if(typeof e=="string")return console.error("Invalid arg:",i,e),null;const o=new LightProbe;o.intensity=.25,o.position.set(0,15,0),o.name="LightProbe",r=o,typeof e=="object"?r=BindObjectAsDDD(r,getDDDProperties(e)):r=BindObjectAsDDD(r,{is_background:!0,type:i,kind:"light",drawable:!1,controllable_geometry:!0,cast_shadow:!1,receive_shadow:!1,draggable_on_tree:!1,droppable_on_tree:!1});const l=new WebGLCubeRenderTarget(32),a=new CubeCamera(.1,1e4,l),c=getDDDProperties(r);function d(f){DMC.scene.traverse(h=>{const _=h.material;if(_)if(Array.isArray(_))for(let b=0,v=_.length;b<v;b++)f(_[b]);else f(_)})}const u=new Map;return r.updateProbe=function(){const f=DMC;if(f==null)return;const m=f.base_renderer,h=f.scene;if(m&&h){a.position.copy(r.position);const _=r.intensity;d(v=>{u.has(v)||u.set(v,{});const w=u.get(v);w.visible=v.visible,v.visible!==v.castDynamicEnvironment&&v.visible&&(v.visible=v.castDynamicEnvironment)}),a.update(m,h);const b=LightProbeGenerator.fromCubeRenderTarget(m,l);console.log("Update Light Probe"),d(v=>{const w=u.get(v);v.visible!==w.visible&&(v.visible=w.visible)}),r.copy(b),b.dispose(),r.position.copy(a.position),r.intensity=_}},c.destructors.push(()=>{l.dispose()}),GenerateName(r,"LightProbe"),r}}};const _changeEvent$1={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_ray=new Ray,_plane=new Plane,TILT_LIMIT=Math.cos(70*MathUtils.DEG2RAD);class OrbitControls extends EventDispatcher{constructor(e,i){super();const r=this;this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Vector3,this.cursor=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(ce){ce.addEventListener("keydown",ae),this._domElementKeyEvents=ce},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",ae),this._domElementKeyEvents=null},this.saveState=function(){o.target0.copy(o.target),o.position0.copy(o.object.position),o.zoom0=o.object.zoom},this.reset=function(){o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),o.dispatchEvent(_changeEvent$1),o.update(),a=l.NONE},this.update=function(){const ce=new Vector3,ye=new Quaternion().setFromUnitVectors(e.up,new Vector3(0,1,0)),Pe=ye.clone().invert(),Ve=new Vector3,Qe=new Quaternion,at=new Vector3,ht=2*Math.PI;return function(Ze=null){const ot=o.object.position;ce.copy(ot).sub(o.target),ce.applyQuaternion(ye),d.setFromVector3(ce),o.autoRotate&&a===l.NONE&&V(K(Ze)),o.enableDamping?(d.theta+=u.theta*o.dampingFactor,d.phi+=u.phi*o.dampingFactor):(d.theta+=u.theta,d.phi+=u.phi);let mt=o.minAzimuthAngle,pt=o.maxAzimuthAngle;isFinite(mt)&&isFinite(pt)&&(mt<-Math.PI?mt+=ht:mt>Math.PI&&(mt-=ht),pt<-Math.PI?pt+=ht:pt>Math.PI&&(pt-=ht),mt<=pt?d.theta=Math.max(mt,Math.min(pt,d.theta)):d.theta=d.theta>(mt+pt)/2?Math.max(mt,d.theta):Math.min(pt,d.theta)),d.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,d.phi)),d.makeSafe(),o.enableDamping===!0?o.target.addScaledVector(m,o.dampingFactor):o.target.add(m),o.target.sub(o.cursor),o.target.clampLength(o.minTargetRadius,o.maxTargetRadius),o.target.add(o.cursor);let bt=!1;if(o.zoomToCursor&&L||o.object.isOrthographicCamera)d.radius=oe(d.radius);else{const _t=d.radius;d.radius=oe(d.radius*f),bt=_t!=d.radius}if(ce.setFromSpherical(d),ce.applyQuaternion(Pe),ot.copy(o.target).add(ce),o.object.lookAt(o.target),o.enableDamping===!0?(u.theta*=1-o.dampingFactor,u.phi*=1-o.dampingFactor,m.multiplyScalar(1-o.dampingFactor)):(u.set(0,0,0),m.set(0,0,0)),o.zoomToCursor&&L){let _t=null;if(o.object.isPerspectiveCamera){const Mt=ce.length();_t=oe(Mt*f);const Tt=Mt-_t;o.object.position.addScaledVector(k,Tt),o.object.updateMatrixWorld(),bt=!!Tt}else if(o.object.isOrthographicCamera){const Mt=new Vector3(O.x,O.y,0);Mt.unproject(o.object);const Tt=o.object.zoom;o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/f)),o.object.updateProjectionMatrix(),bt=Tt!==o.object.zoom;const Bt=new Vector3(O.x,O.y,0);Bt.unproject(o.object),o.object.position.sub(Bt).add(Mt),o.object.updateMatrixWorld(),_t=ce.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),o.zoomToCursor=!1;_t!==null&&(this.screenSpacePanning?o.target.set(0,0,-1).transformDirection(o.object.matrix).multiplyScalar(_t).add(o.object.position):(_ray.origin.copy(o.object.position),_ray.direction.set(0,0,-1).transformDirection(o.object.matrix),Math.abs(o.object.up.dot(_ray.direction))<TILT_LIMIT?e.lookAt(o.target):(_plane.setFromNormalAndCoplanarPoint(o.object.up,o.target),_ray.intersectPlane(_plane,o.target))))}else if(o.object.isOrthographicCamera){const _t=o.object.zoom;o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/f)),_t!==o.object.zoom&&(o.object.updateProjectionMatrix(),bt=!0)}return f=1,L=!1,bt||Ve.distanceToSquared(o.object.position)>c||8*(1-Qe.dot(o.object.quaternion))>c||at.distanceToSquared(o.target)>c?(o.dispatchEvent(_changeEvent$1),Ve.copy(o.object.position),Qe.copy(o.object.quaternion),at.copy(o.target),!0):!1}}(),this.dispose=function(){o.domElement.removeEventListener("contextmenu",ne),o.domElement.removeEventListener("pointerdown",ue),o.domElement.removeEventListener("pointercancel",ke),o.domElement.removeEventListener("wheel",Ye),o.domElement.removeEventListener("pointermove",re),o.domElement.removeEventListener("pointerup",ke),o.domElement.getRootNode().removeEventListener("keydown",tt,{capture:!0}),o._domElementKeyEvents!==null&&(o._domElementKeyEvents.removeEventListener("keydown",ae),o._domElementKeyEvents=null)};const o=this,l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=l.NONE;const c=1e-6,d=new Spherical,u=new Spherical;let f=1;const m=new Vector3,h=new Vector2,_=new Vector2,b=new Vector2,v=new Vector2,w=new Vector2,y=new Vector2,M=new Vector2,S=new Vector2,D=new Vector2,k=new Vector3,O=new Vector2;let L=!1;const P=[],N={};let z=!1;function K(ce){return ce!==null?2*Math.PI/60*o.autoRotateSpeed*ce:2*Math.PI/60/60*o.autoRotateSpeed}function Z(ce){const ye=Math.abs(ce*.01);return Math.pow(.95,o.zoomSpeed*ye)}function V(ce){u.theta-=ce}function H(ce){u.phi-=ce}const Y=function(){const ce=new Vector3;return function(Pe,Ve){ce.setFromMatrixColumn(Ve,0),ce.multiplyScalar(-Pe),m.add(ce)}}(),q=function(){const ce=new Vector3;return function(Pe,Ve){o.screenSpacePanning===!0?ce.setFromMatrixColumn(Ve,1):(ce.setFromMatrixColumn(Ve,0),ce.crossVectors(o.object.up,ce)),ce.multiplyScalar(Pe),m.add(ce)}}(),J=function(){const ce=new Vector3;return function(Pe,Ve){const Qe=o.domElement;if(o.object.isPerspectiveCamera){const at=o.object.position;ce.copy(at).sub(o.target);let ht=ce.length();ht*=Math.tan(o.object.fov/2*Math.PI/180),Y(2*Pe*ht/Qe.clientHeight,o.object.matrix),q(2*Ve*ht/Qe.clientHeight,o.object.matrix)}else o.object.isOrthographicCamera?(Y(Pe*(o.object.right-o.object.left)/o.object.zoom/Qe.clientWidth,o.object.matrix),q(Ve*(o.object.top-o.object.bottom)/o.object.zoom/Qe.clientHeight,o.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),o.enablePan=!1)}}();function W(ce){o.object.isPerspectiveCamera||o.object.isOrthographicCamera?f/=ce:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function te(ce){o.object.isPerspectiveCamera||o.object.isOrthographicCamera?f*=ce:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function ie(ce,ye){if(!o.zoomToCursor)return;L=!0;const Pe=o.domElement.getBoundingClientRect(),Ve=ce-Pe.left,Qe=ye-Pe.top,at=Pe.width,ht=Pe.height;O.x=Ve/at*2-1,O.y=-(Qe/ht)*2+1,k.set(O.x,O.y,1).unproject(o.object).sub(o.object.position).normalize()}function oe(ce){return Math.max(o.minDistance,Math.min(o.maxDistance,ce))}function Ce(ce){h.set(ce.clientX,ce.clientY)}function ve(ce){ie(ce.clientX,ce.clientX),M.set(ce.clientX,ce.clientY)}function we(ce){v.set(ce.clientX,ce.clientY)}function Se(ce){_.set(ce.clientX,ce.clientY),b.subVectors(_,h).multiplyScalar(o.rotateSpeed);const ye=o.domElement;V(2*Math.PI*b.x/ye.clientHeight),H(2*Math.PI*b.y/ye.clientHeight),h.copy(_),o.update()}function Re(ce){S.set(ce.clientX,ce.clientY),D.subVectors(S,M),D.y>0?W(Z(D.y)):D.y<0&&te(Z(D.y)),M.copy(S),o.update()}function Fe(ce){w.set(ce.clientX,ce.clientY),y.subVectors(w,v).multiplyScalar(o.panSpeed),J(y.x,y.y),v.copy(w),o.update()}function $e(ce){if(ie(ce.clientX,ce.clientY),ce.deltaY<0)if(ce.shiftKey){const ye=new THREE.Vector3;ye.copy(o.target),ye.sub(o.object.position),ye.normalize(),ye.multiplyScalar(10),o.target.add(ye),o.object.position.add(ye)}else te(Z(ce.deltaY));else if(ce.deltaY>0)if(ce.shiftKey){const ye=new THREE.Vector3;ye.copy(o.target),ye.sub(o.object.position),ye.normalize(),ye.multiplyScalar(-10),o.target.add(ye),o.object.position.add(ye)}else W(Z(ce.deltaY));o.update()}function Ue(ce){let ye=!1;switch(ce.code){case o.keys.UP:ce.ctrlKey||ce.metaKey||ce.shiftKey?H(2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):J(0,o.keyPanSpeed),ye=!0;break;case o.keys.BOTTOM:ce.ctrlKey||ce.metaKey||ce.shiftKey?H(-2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):J(0,-o.keyPanSpeed),ye=!0;break;case o.keys.LEFT:ce.ctrlKey||ce.metaKey||ce.shiftKey?V(2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):J(o.keyPanSpeed,0),ye=!0;break;case o.keys.RIGHT:ce.ctrlKey||ce.metaKey||ce.shiftKey?V(-2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):J(-o.keyPanSpeed,0),ye=!0;break}ye&&(ce.preventDefault(),o.update())}function qe(ce){if(P.length===1)h.set(ce.pageX,ce.pageY);else{const ye=je(ce),Pe=.5*(ce.pageX+ye.x),Ve=.5*(ce.pageY+ye.y);h.set(Pe,Ve)}}function _e(ce){if(P.length===1)v.set(ce.pageX,ce.pageY);else{const ye=je(ce),Pe=.5*(ce.pageX+ye.x),Ve=.5*(ce.pageY+ye.y);v.set(Pe,Ve)}}function be(ce){const ye=je(ce),Pe=ce.pageX-ye.x,Ve=ce.pageY-ye.y,Qe=Math.sqrt(Pe*Pe+Ve*Ve);M.set(0,Qe)}function De(ce){o.enableZoom&&be(ce),o.enablePan&&_e(ce)}function Te(ce){o.enableZoom&&be(ce),o.enableRotate&&qe(ce)}function ge(ce){if(P.length==1)_.set(ce.pageX,ce.pageY);else{const Pe=je(ce),Ve=.5*(ce.pageX+Pe.x),Qe=.5*(ce.pageY+Pe.y);_.set(Ve,Qe)}b.subVectors(_,h).multiplyScalar(o.rotateSpeed);const ye=o.domElement;V(2*Math.PI*b.x/ye.clientHeight),H(2*Math.PI*b.y/ye.clientHeight),h.copy(_)}function Ee(ce){if(P.length===1)w.set(ce.pageX,ce.pageY);else{const ye=je(ce),Pe=.5*(ce.pageX+ye.x),Ve=.5*(ce.pageY+ye.y);w.set(Pe,Ve)}y.subVectors(w,v).multiplyScalar(o.panSpeed),J(y.x,y.y),v.copy(w)}function Ie(ce){const ye=je(ce),Pe=ce.pageX-ye.x,Ve=ce.pageY-ye.y,Qe=Math.sqrt(Pe*Pe+Ve*Ve);S.set(0,Qe),D.set(0,Math.pow(S.y/M.y,o.zoomSpeed)),W(D.y),M.copy(S);const at=(ce.pageX+ye.x)*.5,ht=(ce.pageY+ye.y)*.5;ie(at,ht)}function Be(ce){o.enableZoom&&Ie(ce),o.enablePan&&Ee(ce)}function Oe(ce){o.enableZoom&&Ie(ce),o.enableRotate&&ge(ce)}function ue(ce){o.enabled!==!1&&(P.length===0&&(o.domElement.setPointerCapture(ce.pointerId),o.domElement.addEventListener("pointermove",re),o.domElement.addEventListener("pointerup",ke)),!Me(ce)&&(le(ce),ce.pointerType==="touch"?j(ce):We(ce)))}function re(ce){o.enabled!==!1&&(ce.pointerType==="touch"?ee(ce):Xe(ce),r.onUpdated&&r.onUpdated())}function ke(ce){switch(he(ce),P.length){case 0:o.domElement.releasePointerCapture(ce.pointerId),o.domElement.removeEventListener("pointermove",re),o.domElement.removeEventListener("pointerup",ke),o.dispatchEvent(_endEvent),a=l.NONE;break;case 1:const ye=P[0],Pe=N[ye];j({pointerId:ye,pageX:Pe.x,pageY:Pe.y});break}o.event_listener&&o.event_listener("mouseup",ce),r.onUpdateFinished&&r.onUpdateFinished()}function We(ce){let ye;switch(ce.button){case 0:ye=o.mouseButtons.LEFT;break;case 1:ye=o.mouseButtons.MIDDLE;break;case 2:ye=o.mouseButtons.RIGHT;break;default:ye=-1}switch(ye){case MOUSE.DOLLY:if(o.enableZoom===!1)return;ve(ce),a=l.DOLLY;break;case MOUSE.ROTATE:if(ce.ctrlKey||ce.metaKey||ce.shiftKey){if(o.enablePan===!1)return;we(ce),a=l.PAN}else{if(o.enableRotate===!1)return;Ce(ce),a=l.ROTATE}break;case MOUSE.PAN:if(ce.ctrlKey||ce.metaKey||ce.shiftKey){if(o.enableRotate===!1)return;Ce(ce),a=l.ROTATE}else{if(o.enablePan===!1)return;we(ce),a=l.PAN}break;default:a=l.NONE}a!==l.NONE&&o.dispatchEvent(_startEvent),o.event_listener&&o.event_listener("mousedown",ce)}function Xe(ce){switch(a){case l.ROTATE:if(o.enableRotate===!1)return;Se(ce);break;case l.DOLLY:if(o.enableZoom===!1)return;Re(ce);break;case l.PAN:if(o.enablePan===!1)return;Fe(ce);break}o.event_listener&&o.event_listener("mousemove",ce)}function Ye(ce){o.enabled===!1||o.enableZoom===!1||a!==l.NONE||(ce.preventDefault(),o.dispatchEvent(_startEvent),$e(it(ce)),o.dispatchEvent(_endEvent),o.event_listener&&o.event_listener("mousewheel",ce))}function it(ce){const ye=ce.deltaMode,Pe={clientX:ce.clientX,clientY:ce.clientY,deltaY:ce.deltaY};switch(ye){case 1:Pe.deltaY*=16;break;case 2:Pe.deltaY*=100;break}return ce.ctrlKey&&!z&&(Pe.deltaY*=10),Pe}function tt(ce){ce.key==="Control"&&(z=!0,o.domElement.getRootNode().addEventListener("keyup",Ke,{passive:!0,capture:!0}))}function Ke(ce){ce.key==="Control"&&(z=!1,o.domElement.getRootNode().removeEventListener("keyup",Ke,{passive:!0,capture:!0}))}function ae(ce){o.enabled===!1||o.enablePan===!1||Ue(ce)}function j(ce){switch(Ne(ce),P.length){case 1:switch(o.touches.ONE){case TOUCH.ROTATE:if(o.enableRotate===!1)return;qe(ce),a=l.TOUCH_ROTATE;break;case TOUCH.PAN:if(o.enablePan===!1)return;_e(ce),a=l.TOUCH_PAN;break;default:a=l.NONE}break;case 2:switch(o.touches.TWO){case TOUCH.DOLLY_PAN:if(o.enableZoom===!1&&o.enablePan===!1)return;De(ce),a=l.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(o.enableZoom===!1&&o.enableRotate===!1)return;Te(ce),a=l.TOUCH_DOLLY_ROTATE;break;default:a=l.NONE}break;default:a=l.NONE}a!==l.NONE&&o.dispatchEvent(_startEvent)}function ee(ce){switch(Ne(ce),a){case l.TOUCH_ROTATE:if(o.enableRotate===!1)return;ge(ce),o.update();break;case l.TOUCH_PAN:if(o.enablePan===!1)return;Ee(ce),o.update();break;case l.TOUCH_DOLLY_PAN:if(o.enableZoom===!1&&o.enablePan===!1)return;Be(ce),o.update();break;case l.TOUCH_DOLLY_ROTATE:if(o.enableZoom===!1&&o.enableRotate===!1)return;Oe(ce),o.update();break;default:a=l.NONE}}function ne(ce){o.enabled!==!1&&ce.preventDefault()}function le(ce){P.push(ce.pointerId)}function he(ce){delete N[ce.pointerId];for(let ye=0;ye<P.length;ye++)if(P[ye]==ce.pointerId){P.splice(ye,1);return}}function Me(ce){for(let ye=0;ye<P.length;ye++)if(P[ye]==ce.pointerId)return!0;return!1}function Ne(ce){let ye=N[ce.pointerId];ye===void 0&&(ye=new Vector2,N[ce.pointerId]=ye),ye.set(ce.pageX,ce.pageY)}function je(ce){const ye=ce.pointerId===P[0]?P[1]:P[0];return N[ye]}o.domElement.addEventListener("contextmenu",ne),o.domElement.addEventListener("pointerdown",ue),o.domElement.addEventListener("pointercancel",ke),o.domElement.addEventListener("wheel",Ye,{passive:!1}),o.domElement.getRootNode().addEventListener("keydown",tt,{passive:!0,capture:!0}),this.update()}}const DEFAULT_Fields_of_View=45,DEFAULT_XR_NearClip=.01,DEFAULT_XR_FarClip=1e3,DEFAULT_NearClip=1,DEFAULT_FarClip=1e5,DEFAULT_OrthoNearClip=-1e5,DEFAULT_OrthoFarClip=1e5;async function animation_function(s,e){const i=getDDDProperties(s);if(e&&e.helper){const r=new CameraHelper(s);DMC.helper_scene.add(r),i.destructors.push(function(){DMC.helper_scene.remove(r)})}await setup_animation_helper_prop(s),i.destructors.push(function(){try{DMC.mmd_animation_helper.remove(s)}catch{}})}var CameraBuilder=function(){const s=this.makers={async perspective_camera(e,i,r){const o=DMC,l=o?.scene?.isXRMode,a={helper:!0,filed_of_view:DEFAULT_Fields_of_View,near_clip:l?DEFAULT_XR_NearClip:DEFAULT_NearClip,far_clip:l?DEFAULT_XR_FarClip:DEFAULT_FarClip};r&&Object.assign(a,r);const c="perspective_camera";if(typeof i=="string")return console.error("Invalid arg:",c,i),null;const d=o?o.canvas.clientWidth:1,u=o?o.canvas.clientHeight:1;let f=new PerspectiveCamera(a.filed_of_view,d/u,a.near_clip,a.far_clip);return f.name="PerspectiveCamera",f.matrixAutoUpdate=!0,typeof i=="object"?f=BindObjectAsDDD(f,getDDDProperties(i)):f=BindObjectAsDDD(f,{is_background:!0,is_camera:!0,type:c,kind:"camera",drawable:!1}),await animation_function(f,a),f},async orbit_camera(e,i){const r="orbit_camera";if(typeof i=="string")return console.error("Invalid arg:",r,i),null;const o=DMC.canvas;let l=new Object3D;l.name="CameraContainer";let a=await s.perspective_camera(e,i,{helper:!1});const c=DMC,d=c?.scene?.isXRMode;a.position.z=d?1.5:15,a.position.y=d?1.3:13,a.near=.01,a.far=1e3;const u=new OrbitControls(a,o);u.enablePan=!0,u.enableDamping=!1,u.dampingFactor=.3,u.target.y=d?1.3:13,a.name="OrbitPerspectiveCamera",a.target=u.target;const f=getDDDProperties(a);f.type="sub_object",u.update(),typeof i=="object"?l=BindObjectAsDDD(l,getDDDProperties(i)):l=BindObjectAsDDD(l);const m=getDDDProperties(l);return m.type=r,m.draggable_on_tree=!1,m.droppable_on_tree=!1,m.isCameraContainer=!0,m.destructors.push(function(){u.dispose()}),c.camera=a,c.controls=u,l.add(a),l},async ortho_camera(e,i,r){const o={helper:!0,near_clip:DEFAULT_OrthoNearClip,far_clip:DEFAULT_OrthoFarClip};r&&Object.assign(o,r);const l="ortho_camera";let a=null;if(typeof i=="string")return console.error("Invalid arg:",l,i),null;const c=DMC.canvas.clientWidth,d=DMC.canvas.clientHeight;return a=new OrthographicCamera(c/-2,c/2,d/2,d/-2,o.near_clip,o.far_clip),a.name="OrthographicCamera",a.matrixAutoUpdate=!0,typeof i=="object"?a=BindObjectAsDDD(a,getDDDProperties(i)):a=BindObjectAsDDD(a,{is_background:!0,is_camera:!0,type:l,kind:"camera",drawable:!1}),await animation_function(a,o),a},async orbit_ortho_camera(e,i){const r="orbit_ortho_camera";if(typeof i=="string")return console.error("Invalid arg:",r,i),null;const o=DMC.canvas,l=await s.ortho_camera(e,i,{helper:!1});let a=null;if(l.traverse(u=>{u.isCamera&&u instanceof Camera&&(a=u)}),a==null)throw new Error("Camera not found");a.position.z=15,a.position.y=13;const c=new OrbitControls(a,o);c.enablePan=!0,c.enableDamping=!1,c.dampingFactor=.3,c.target.y=13,a.name="OrbitOrthoCamera",a.target=c.target,c.update(),c.onUpdateFinished=function(){DMC.xr?.isEntered&&(a.position.x,a.position.y,a.position.z,DMC.controls.target.x,DMC.controls.target.y,DMC.controls.target.z)};const d=getDDDProperties(object);return d.type=r,d.draggable_on_tree=!1,d.droppable_on_tree=!1,d.destructors.push(function(){c.dispose()}),DMC.camera=a,DMC.controls=c,l}}};function NoCastEnv(s){s.traverse(e=>{if(e.material){let i=function(r){if(Array.isArray(r))for(const o of r)o.castDynamicEnvironment=!1;else r.castDynamicEnvironment=!1};e.material,i(e.material),e.material_overwrite&&i(e.material_overwrite),e.material_original&&i(e.material_original)}})}var ObjectBuilder=function(){const s=this.makers={async scene(e,i){const r="scene";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(new Scene,getDDDProperties(i)):o=BindObjectAsDDD(new Scene,{type:r,is_background:!0,draggable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,controllable_geometry:!1,transform_controller:!1,removable:!1,kind:"scene"}),o.background=new Color(0),o.fog=new FogExp2(328965,0),o.backup_background=o.background,o)},async helper_scene(e,i){const r="helper_scene";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?(o=BindObjectAsDDD(new Scene,getDDDProperties(i)),o.name="HelperScene"):(o=BindObjectAsDDD(new Scene,{type:r,is_background:!0,draggable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,controllable_geometry:!1,transform_controller:!1,removable:!1,kind:"scene"}),o.name="HelperScene"),o)},async group(e,i){const r="group";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(new Group,getDDDProperties(i)):o=BindObjectAsDDD(new Group,{type:r,kind:"object"}),GenerateName(o,"Group"),o)},async object3d(e,i){const r="object3d";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(new Object3D,getDDDProperties(i)):o=BindObjectAsDDD(new Object3D,{type:r,kind:"object"}),GenerateName(o,"Node"),o)},async instanced_mesh(e,i){const r="instanced_mesh";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(new Object3D,getDDDProperties(i)):o=BindObjectAsDDD(new Object3D,{type:r,kind:"object"}),GenerateName(o,"InstancedMesh"),o)},async box(e,i){const r="box";let o=null;const l={color:new Color(5583633),side:DoubleSide};return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateMesh(new BoxGeometry(2,2,2),PBRMaterial(l)),getDDDProperties(i)):o=BindObjectAsDDD(CreateMesh(new BoxGeometry(2,2,2),PBRMaterial(l)),{type:r,kind:"object"}),GenerateName(o,"Box"),NoCastEnv(o),o)},async sprite(e,i){const r="sprite";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(new Sprite(new SpriteMaterial({map:null})),getDDDProperties(i)):o=BindObjectAsDDD(new Sprite(new SpriteMaterial({map:null})),{type:r,kind:"object"}),GenerateName(o,"Sprite"),NoCastEnv(o),o)},async circle(e,i){const r="circle";let o=null;const l={color:new Color(3364113)};return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateMesh(new CircleGeometry(3,100),PBRMaterial(l)),getDDDProperties(i)):o=BindObjectAsDDD(CreateMesh(new CircleGeometry(3,100),PBRMaterial(l)),{type:r,kind:"object"}),GenerateName(o,"Circle"),NoCastEnv(o),o)},async cylinder(e,i){const r="cylinder";let o=null;const l={color:new Color(3346773)};return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateMesh(new CylinderGeometry(3,3,4,100),PBRMaterial(l)),getDDDProperties(i)):o=BindObjectAsDDD(CreateMesh(new CylinderGeometry(3,3,4,100),PBRMaterial(l)),{type:r,kind:"object"}),GenerateName(o,"Cylinder"),NoCastEnv(o),o)},async sphere(e,i){const r="sphere";let o=null,l={color:new Color(5574997)};return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateMesh(new SphereGeometry(3,50,50),PBRMaterial(l)),getDDDProperties(i)):o=BindObjectAsDDD(CreateMesh(new SphereGeometry(3,50,50),PBRMaterial(l)),{type:r,kind:"object"}),GenerateName(o,"Sphere"),NoCastEnv(o),o)},async cone(e,i){const r="cone";let o=null,l={color:new Color(16776960)};return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateMesh(new ConeGeometry(1,1,50),PBRMaterial(l)),getDDDProperties(i)):o=BindObjectAsDDD(CreateMesh(new ConeGeometry(1,1,50),PBRMaterial(l)),{type:r,kind:"object"}),o.scale.set(5,5,5),GenerateName(o,"Cone"),NoCastEnv(o),o)},async plane(e,i){const r="plane";let o=null;const l={color:new Color(5574997)};return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateMesh(new PlaneGeometry(5,5),PBRMaterial(l)),getDDDProperties(i)):o=BindObjectAsDDD(CreateMesh(new PlaneGeometry(5,5),PBRMaterial(l)),{type:r,kind:"object"}),GenerateName(o,"Plane"),NoCastEnv(o),o)},async plane_mirror(e,i){const r="plane_mirror";let o=null;const{Reflector:l}=await __vitePreload(()=>import("./Reflector@Y262dkt1.js"),[],import.meta.url);if(typeof i=="string")return console.error("Invalid arg:",r,i),null;if(typeof i=="object"){const a=new l(new PlaneGeometry(5,5),{clipBias:.003,textureWidth:32,textureHeight:32,color:7829367});o=BindObjectAsDDD(a,getDDDProperties(i))}else{const a=new l(new PlaneGeometry(5,5),{clipBias:.003,textureWidth:32,textureHeight:32,color:7829367});o=BindObjectAsDDD(a,{type:r,kind:"object"})}return o.renderOrder=-5,GenerateName(o,"PlaneMirror"),NoCastEnv(o),o},async heart(e,i){const r="heart";let o=null;const l={color:new Color(16716117)},a=-5,c=-10,d=new Shape;d.moveTo(a+5,c+5),d.bezierCurveTo(a+5,c+5,a+4,c,a,c),d.bezierCurveTo(a-6,c,a-6,c+7,a-6,c+7),d.bezierCurveTo(a-6,c+11,a-3,c+15.4,a+5,c+19),d.bezierCurveTo(a+12,c+15.4,a+16,c+11,a+16,c+7),d.bezierCurveTo(a+16,c+7,a+16,c,a+10,c),d.bezierCurveTo(a+7,c,a+5,c+5,a+5,c+5);const u=new ShapeGeometry(d),f=new Matrix4().makeRotationZ(Math.PI),m=new Matrix4().makeScale(1/10,1/10,1/10);return u.applyMatrix4(f),u.applyMatrix4(m),typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateMesh(u,PBRMaterial(l)),getDDDProperties(i)):o=BindObjectAsDDD(CreateMesh(u,PBRMaterial(l)),{type:r,kind:"object"}),GenerateName(o,"Heart"),NoCastEnv(o),o)},async mesh(e,i){const r="mesh";let o=null;if(typeof i=="string")return console.error("Invalid arg:",r,i),null;if(typeof i=="object"){const l=new BufferGeometry;l.setIndex([]),l.setAttribute("position",new Float32BufferAttribute([],3)),l.setAttribute("normal",new Float32BufferAttribute([],3)),l.setAttribute("uv",new Float32BufferAttribute([],2)),o=BindObjectAsDDD(CreateMesh(l,new MeshPhysicalMaterial),getDDDProperties(i))}else{const l=new BufferGeometry;l.setIndex([]),l.setAttribute("position",new Float32BufferAttribute([],3)),l.setAttribute("normal",new Float32BufferAttribute([],3)),l.setAttribute("uv",new Float32BufferAttribute([],2)),o=BindObjectAsDDD(CreateMesh(l,new MeshPhysicalMaterial),{type:r,kind:"object",restore_geometry:!0})}return GenerateName(o,"Mesh"),NoCastEnv(o),o},async mesh_multi_material(e,i){const r="mesh";let o=null;if(typeof i=="string")return console.error("Invalid arg:",r,i),null;if(typeof i=="object"){const l=new BufferGeometry;l.setIndex([]),l.setAttribute("position",new Float32BufferAttribute([],3)),l.setAttribute("normal",new Float32BufferAttribute([],3)),l.setAttribute("uv",new Float32BufferAttribute([],2)),o=BindObjectAsDDD(CreateMesh(l,[new MeshPhysicalMaterial]),getDDDProperties(i))}else{const l=new BufferGeometry;l.setIndex([]),l.setAttribute("position",new Float32BufferAttribute([],3)),l.setAttribute("normal",new Float32BufferAttribute([],3)),l.setAttribute("uv",new Float32BufferAttribute([],2)),o=BindObjectAsDDD(CreateMesh(l,[new MeshPhysicalMaterial]),{type:r,kind:"object",restore_geometry:!0})}return GenerateName(o,"Mesh"),NoCastEnv(o),o},async js(e,i){const r="js";let o=null;if(typeof i=="string"){i=i.replace(/\\/g,"/");let a=new Object3D,d=await(await fetch(i)).text();o=BindObjectAsDDD(a,{type:r,source_file:i,kind:"object"}),a.script=d}else if(typeof i=="object"){let a=getDDDProperties(i),c=new Object3D;o=BindObjectAsDDD(c,a)}let l=getDDDProperties(o);return o.castShadow=!0,o.receiveShadow=!0,o.name=l.source_file.split("/").pop(),o},async water_floor(e,i){const r="water_floor";let o=null;if(typeof i=="string")return console.error("Invalid arg:",r,i),null;const l=new PlaneGeometry(1e4,1e4,100,100),{Water:a}=await __vitePreload(()=>import("./Water@CYCtuCT1.js"),[],import.meta.url),c=new a(l,{textureWidth:1024,textureHeight:1024,waterNormals:null,sunDirection:new Vector3,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:!0});c.rotation.x=-Math.PI/2,c.position.y=2,c.renderOrder=-5,c.receiveShadow=!0;const d=load_texture_from_system_resource("ddd/textures/waternormals.jpg",(f,m)=>{c.material.uniforms.normalSampler.value=m});window.__init_promises__?.push?.(d),typeof i=="object"?o=BindObjectAsDDD(c,getDDDProperties(i)):o=BindObjectAsDDD(c,{is_background:!0,type:r,kind:"object",draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,transform_controller:!1});let u=performance.now();return o.wave_speed=1,o.user.updaters.water=function(f){o.material.uniforms.time.value+=(performance.now()-u)*5e-4*o.wave_speed,u=performance.now()},GenerateName(o,"Water Floor"),o},async water_floor2(e,i){const r="water_floor2";let o=null;if(typeof i=="string")return console.error("Invalid arg:",r,i),null;const{Water:l}=await __vitePreload(()=>import("./Water2@BrDsMR-4.js"),__vite__mapDeps([4,5]),import.meta.url);await window.PrepareFromSystemResource("ddd/textures/water/Water_1_M_Normal.jpg"),await window.PrepareFromSystemResource("ddd/textures/water/Water_2_M_Normal.jpg");const a=new PlaneGeometry(500,500,100,100),c={color:"#ffffff",scale:4,flowX:1,flowY:1},d=new l(a,{color:c.color,scale:c.scale,flowDirection:new Vector2(c.flowX,c.flowY),textureWidth:1024,textureHeight:1024});return d.position.y=1,d.rotation.x=Math.PI*-.5,d.renderOrder=-5,typeof i=="object"?o=BindObjectAsDDD(d,getDDDProperties(i)):o=BindObjectAsDDD(d,{is_background:!0,type:r,kind:"object",draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,transform_controller:!1}),GenerateName(o,"Water Floor"),o},async wood_floor(e,i){const r="wood_floor";let o=null;if(typeof i=="string")return console.error("Invalid arg:",r,i),null;const l=new MeshPhysicalMaterial({name:"Wood",color:8947848,roughness:.9,reflectivity:.25,clearcoat:0,clearcoatRoughness:0,metalness:0});l.normalScale.x=.2,l.normalScale.y=.2;const a=new PlaneGeometry(200,200,100,100);a.computeTangents();const c=CreateMesh(a,l);c.receiveShadow=!0,c.setRotationFromEuler(new Euler(-Math.PI/2,0,0,"XYZ")),typeof i=="object"?o=BindObjectAsDDD(c,getDDDProperties(i)):o=BindObjectAsDDD(c,{is_background:!0,type:r,kind:"object",draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,transform_controller:!1}),InitializeMaterials(c);const d=load_texture_from_system_resource("ddd/textures/hardwood2_diffuse.ktx2",{loader_hint:"ktx2"},(m,h)=>{h.repeat.set(4,12),h.colorSpace=SRGBColorSpace,c.material.map=h,c.material.needsUpdate=!0,c.material_overwrite.map=h,c.material_overwrite.needsUpdate=!0}),u=load_texture_from_system_resource("ddd/textures/hardwood2_roughness.ktx2",{loader_hint:"ktx2"},(m,h)=>{h.repeat.set(4,12),h.colorSpace=NoColorSpace,c.material.roughnessMap=h,c.material.needsUpdate=!0,c.material_overwrite.roughnessMap=h,c.material_overwrite.needsUpdate=!0}),f=load_texture_from_system_resource("ddd/textures/hardwood2_bump.ktx2",{loader_hint:"ktx2"},(m,h)=>{h.colorSpace=NoColorSpace,h.repeat.set(4,12),c.material.bumpMap=h,c.material.bumpScale=.1,c.material.needsUpdate=!0,c.material_overwrite.bumpMap=h,c.material_overwrite.bumpScale=.1,c.material_overwrite.needsUpdate=!0});return window.__init_promises__&&(window.__init_promises__.push(d),window.__init_promises__.push(u),window.__init_promises__.push(f)),GenerateName(o,"WoodFloor"),o},async plane_floor(e,i){const r="plane_floor";let o=null;if(typeof i=="string")return console.error("Invalid arg:",r,i),null;let l=new MeshPhysicalMaterial({color:8421504,roughness:.93,reflectivity:.5,specularIntensity:.3,envMapIntensity:1,metalness:.1,side:FrontSide,shadowSide:FrontSide,alphaTest:0,blending:NoBlending});const a=new PlaneGeometry(200,200,100,100);a.computeTangents();const c=CreateMesh(a,l);return c.receiveShadow=!0,c.setRotationFromEuler(new Euler(-Math.PI/2,0,0,"XYZ")),typeof i=="object"?o=BindObjectAsDDD(c,getDDDProperties(i)):o=BindObjectAsDDD(c,{is_background:!0,type:r,kind:"object",draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,transform_controller:!1}),InitializeMaterials(c),GenerateName(o,"PlaneFloor"),o},async grid_floor(e,i){const r="grid_floor";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(o=new GridHelper(1e3,100),typeof i=="object"?o=BindObjectAsDDD(o,getDDDProperties(i)):o=BindObjectAsDDD(o,{is_background:!0,type:r,kind:"object",draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,controllable_geometry:!1,transform_controller:!1}),o.material.color.setHex(2105376),GenerateName(o,"GridFloor"),o)},async polar_floor(e,i){const r="polar_floor";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(o=new PolarGridHelper(100,10),typeof i=="object"?o=BindObjectAsDDD(o,getDDDProperties(i)):o=BindObjectAsDDD(o,{is_background:!0,type:r,kind:"object",draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,controllable_geometry:!1,transform_controller:!1}),o.material.color.setHex(3158064),GenerateName(o,"PolarFloor"),o)},async metaballs(e,i){const r="metaballs";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(o=new PolarGridHelper(100,10),new MeshBasicMaterial,o.enableUvs=!1,o.enableColors=!1,typeof i=="object"?o=BindObjectAsDDD(o,getDDDProperties(i)):o=BindObjectAsDDD(o,{type:r,kind:"object",draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,controllable_geometry:!1,transform_controller:!1}),GenerateName(o,"MetaBall"),o)},async sky(e,i){const r="sky";let o=null;if(typeof i=="string")return console.error("Invalid arg:",r,i),null;const{Sky:l}=await __vitePreload(()=>import("./Sky@B8oVSal4.js"),[],import.meta.url);o=new l,o.name="SkySphere",typeof i=="object"?o=BindObjectAsDDD(o,getDDDProperties(i)):o=BindObjectAsDDD(o,{is_background:!0,type:r,kind:"object",draggable_on_tree:!1,droppable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,controllable_geometry:!1,transform_controller:!1}),o.scale.setScalar(45e4);const a=getDDDProperties(o);o.sun=new Vector3,a.__sky_effectController==null&&(a.__sky_effectController={intensity:1,time:10,azimuth:0,elevation:.6,turbidity:20,rayleigh:.15,mieCoefficient:.005,mieDirectionalG:.7});const c=new Vector3(0,1,0),d=new Color(1,1,1),u=new Color(1,.8,.8);return a.__sky_effectController_update=()=>{const f=a.__sky_effectController,m=o.material.uniforms,h=f.intensity??1;m.turbidity.value=f.turbidity,m.rayleigh.value=f.rayleigh,m.mieCoefficient.value=f.mieCoefficient,m.mieDirectionalG.value=f.mieDirectionalG;{let _=f.time,b=0;_>=6&&_<=18||(b=0),b=(_-6)/12;const v=new Vector3(1,0,0),w=new Quaternion,y=new Vector3(0,-(1-f.elevation),1);y.normalize(),w.setFromAxisAngle(y,b*Math.PI),v.applyQuaternion(w),y.set(0,1,0),w.setFromAxisAngle(y,f.azimuth/180*Math.PI),v.applyQuaternion(w),o.sun.copy(v),m.sunPosition.value.copy(o.sun)}if(DMC.scene){let _=null;if(DMC.scene.traverse(b=>{b instanceof DirectionalLight&&!b.isCSMLight&&(_=b)}),_){const b=_.position.length();_.position.copy(o.sun),_.position.normalize();let v=c.dot(_.position);v=Math.max(v>0?Math.pow(v,.6):0,0),_.color.lerpColors(d,u,1-v),_.intensity=2*v*h,_.position.multiplyScalar(b),console.log(b)}}DMC.environment_map_manager.apply_environment_map()},DMC.draw_thread_after_runner.push(()=>{a.__sky_effectController_update()}),GenerateName(o,"Sky"),o},async plane_text(e,i){const r="plane_text";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?(o=BindObjectAsDDD(await create_text_object({sprite:!1}),getDDDProperties(i)),await SetupTextAttribute(o)):(o=BindObjectAsDDD(await create_text_object({sprite:!1}),{type:r,kind:"object"}),await SetupTextAttribute(o)),GenerateName(o,"PlaneText"),NoCastEnv(o),o)},async sprite_text(e,i){const r="sprite_text";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?(o=BindObjectAsDDD(await create_text_object({sprite:!0}),getDDDProperties(i)),await SetupTextAttribute(o)):(o=BindObjectAsDDD(await create_text_object({sprite:!0}),{type:r,kind:"object"}),await SetupTextAttribute(o)),GenerateName(o,"SpriteText"),NoCastEnv(o),o)},async billboard_text(e,i){const r="billboard_text";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?(o=BindObjectAsDDD(await create_text_object({sprite:!1}),getDDDProperties(i)),await SetupTextAttribute(o)):(o=BindObjectAsDDD(await create_text_object({sprite:!1}),{type:r,kind:"object"}),await SetupTextAttribute(o)),GenerateName(o,"BillboardText"),NoCastEnv(o),o)},async vector_text(e,i){const r="vector_text";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?(o=BindObjectAsDDD(await create_text_object({vector_text:!0}),getDDDProperties(i)),await SetupTextAttribute(o)):(o=BindObjectAsDDD(await create_text_object({vector_text:!0}),{type:r,kind:"object"}),await SetupTextAttribute(o)),GenerateName(o,"VectorText"),NoCastEnv(o),o)},async spectrum_a(e,i){const r="spectrum_a";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateSpectrumObject("A"),getDDDProperties(i)):o=BindObjectAsDDD(CreateSpectrumObject("A"),{type:r,kind:"object"}),GenerateName(o,"SpectrumA"),NoCastEnv(o),o)},async spectrum_b(e,i){const r="spectrum_b";let o=null;return typeof i=="string"?(console.error("Invalid arg:",r,i),null):(typeof i=="object"?o=BindObjectAsDDD(CreateSpectrumObject("B"),getDDDProperties(i)):o=BindObjectAsDDD(CreateSpectrumObject("B"),{type:r,kind:"object"}),GenerateName(o,"SpectrumB"),NoCastEnv(o),o)},async mp3(e,i){return s.audio(e,i)},async opus(e,i){return s.audio(e,i)},async wav(e,i){return s.audio(e,i)},async m4a(e,i){return s.audio(e,i)},async ogg(e,i){return s.audio(e,i)},async aac(e,i){return s.audio(e,i)},async audio(e,i){const r="audio";let o=null,l=null;return typeof i=="string"?(o=new Audio$1(DMC.sound_listener),o=BindObjectAsDDD(o,{type:r,kind:"object"}),l=getDDDProperties(o),l.source_file=i,o.setBuffer(await sound(i))):typeof i=="object"&&(o=getDDDProperties(i).audio.use_3d_sound?new PositionalAudio(DMC.sound_listener):new Audio$1(DMC.sound_listener),o=BindObjectAsDDD(o,getDDDProperties(i)),l=getDDDProperties(o),o.setBuffer(await sound(l.source_file))),o.name=C.DPath(l.source_file).name,DApplyAudioProperty(o),l.audio.make_helper=async function(){if(l.audio.use_3d_sound){const{PositionalAudioHelper:a}=await __vitePreload(()=>import("./PositionalAudioHelper@Dwlng3zX.js"),[],import.meta.url),c=new a(o);c.name=c.constructor.name,c.visible=!0;for(let d=0;d<c.material.length;d++)c.material[d].castDynamicEnvironment=!1;o.add(c),add_helper_control_prop(o,c)}},l.audio.make_helper(),l.audio.enable_3d_sound=async a=>{const c=o,d=c.getDDDProperties().audio;d.use_3d_sound=a;const u=await Builder3D.build_from_json(c);return Builder3D.replace_object(c,u),u.getDDDProperties().audio.apply(),DMC.dispatchEvent("change@scene",{}),u},l.destructors.push(()=>{try{o.stop()}catch{}l.audio.instance=null}),l.audio.apply=()=>DApplyAudioProperty(o),l.audio.apply_and_play=a=>{if(l.audio.mute)return;if(DApplyAudioProperty(o,a??DMC.animation_world_time,0))try{o.play()}catch(d){console.error(d)}},l.audio.apply_and_warmup=a=>{if(l.audio.mute)return;const c=DApplyAudioProperty(o,a??DMC.animation_world_time,0);if(c)try{o.play((o.offset>0?0:-o.offset)+c.delay),o.pause()}catch(d){console.error(d)}},l.audio.update=(a,c)=>{const d=l.audio;if(!d.mute&&d.use_keyframes&&d.keyframes.length>0&&c>0){const u=DApplyAudioProperty(o,a,c);if(u)try{o.play((o.offset>0?0:-o.offset)+u.delay)}catch(f){console.error(f)}}},l.audio.replace=a=>{o=a},l.audio.reset=()=>{const a=DGenerateSoundKeyFrame();Object.assign(l.audio.base,a)},DMC?.sound_listener&&o.source==null&&o.prepare(DMC.sound_listener),o},async hdri_backdrop(e,i){const r="hdri_backdrop";let o=null,l={color:new Color(8947848)};if(typeof i=="string")return console.error("Invalid arg:",r,i),null;typeof i=="object"?o=BindObjectAsDDD(CreateMesh(new SphereGeometry(100,50,50),PBRMaterial(l)),getDDDProperties(i)):o=BindObjectAsDDD(CreateMesh(new SphereGeometry(100,50,50),PBRMaterial(l)),{type:r,kind:"object"}),GenerateName(o,"HDRIBackdrop"),o.material.side=BackSide,o.material.shadowSide=BackSide,o.material.depthTest=!0,o.material.depthWrite=!0,o.material.sheen=0,o.material.roughness=1,o.material.transparent=!1,o.renderOrder=-1,o.receiveShadow=!0,o.castShadow=!1;const a=getDDDProperties(o);a.hdri_backdrop_height=12.5,a.hdri_backdrop_distance_threshold=100;const c=o.geometry.attributes.position.array.slice(0);return a.hdri_backdrop_recreate_buffer=()=>{const d=a.hdri_backdrop_distance_threshold,u=a.hdri_backdrop_height,f=o.geometry.attributes.position.array;for(let m=0,h=f.length;m<h;m+=3){const _=c[m+0],b=c[m+1],v=c[m+2],w=Math.sqrt(_*_+v*v),y=100-d,M=Math.pow(Math.max((w-d)/y,0),2)*u;b<0?f[m+1]=M:f[m+1]=c[m+1]+u}o.geometry.attributes.position.needsUpdate=!0},a.hdri_backdrop_recreate_buffer(),o},async particle_a(e,i){const{ParticleEngine:r}=await __vitePreload(()=>import("./ParticleEngine@DmMsVNVO.js"),[],import.meta.url),{Examples:o}=await __vitePreload(()=>import("./ParticleEngineExamples@BJYno18w.js"),__vite__mapDeps([6,7]),import.meta.url),l="particle_a";let a=null;const c=new r;if(typeof i=="string")return console.error("Invalid arg:",l,i),null;if(typeof i=="object"){const u=o.snow;typeof u.particleTexture=="string"&&(u.particleTexture=await Builder3D.load_texture(u.particleTexture)),c.setValues(u);const f=c.getObject();a=BindObjectAsDDD(f,getDDDProperties(i))}else{const u=o.snow;typeof u.particleTexture=="string"&&(u.particleTexture=await Builder3D.load_texture(u.particleTexture)),c.setValues(u),c.initialize();const f=c.getObject();a=BindObjectAsDDD(f,{type:l,kind:"object"})}GenerateName(a,"ParticleA");const d=getDDDProperties(a);if(d.particle_a){const u=d.particle_a.params,f=m=>{if(typeof m=="object")for(const h in m){const _=m[h];typeof _=="number"||typeof _=="string"||typeof _=="object"&&(_.r?m[h]=new Color(_.r,_.g,_.b):_.x?m[h]=new Vector3(_.x,_.y,_.z):f(_))}};f(u)}else d.particle_a={},d.particle_a.key="snow";return a},async exit_vr(e,i){const r=await s.sprite_text(e,i),o=getDDDProperties(r);o.type="exit_vr";const l=new Raycaster,a=new Vector2;let c=!1,d=0,u=0,f=null,m=0;const h=o.text;h.text_color="#FFFFFF",h.edge_color="#FFFFFF",h.width=128,h.height=128,h.popup="ellipse",h.h_padding=0,h.v_padding=15,h.h_align="center",h.v_align="top",r.material.depthWrite=!1,r.setText("E"),r.setFontSize(73),r.scale.set(5,5,5),new Vector3,new Vector3;const _=new Vector3,b=new Vector3,v=new Vector3,w=new Sphere;new Box3(new Vector3(-.1,-.1,0),new Vector3(.1,.1,5)),new Box2;const y=new BoxGeometry(1,1,1),M=new MeshBasicMaterial({color:65280}),S=new Mesh(y,M);let D=performance.now();return r.visible=!0,r.user.updaters.counter=()=>{const k=performance.now()-u;if(m>0){m-=k,u=performance.now();return}{a.set(0,0);const O=DMC.current.camera||DMC.camera;if(O.updateMatrixWorld(!0),r.getWorldPosition(v),O.getWorldPosition(_),O.getWorldDirection(b),_.copy(O.position),b.set(0,0,-1),b.applyQuaternion(O.quaternion),w.center.copy(v),w.radius=r.scale.x,S.scale.copy(r.scale),S.position.copy(v),S.updateMatrixWorld(!0),l.far=100,l.set(_,b),l.intersectObject(S).length>0){if(c&&(d+=k,performance.now()-D>1e3)){D=performance.now();const P=Math.max(Math.floor(5.999-d/1e3),0);r.setText(P.toString()),P==0?(f?.(),f=null,m=1e3,r.visible=!0):P>3?r.material.color.setHex(16776960):P>1?r.material.color.setHex(16729088):P>0&&r.material.color.setHex(16711680)}c=!0}else r.material.color.setHex(65280),r.setText("E"),d=0,c=!1}u=performance.now()},r}}};const MOUSE_HOVER_BG_COLOR="#353555",COMPONENT_FONT_SIZE="11px",INPUT_BACKGROUND_COLOR="#111111AA",INPUT_FOCUS_BACKGROUND_COLOR="#000",NUMBER_TEXT_COLOR="#AAF",SlideUp=(s,e=100)=>{s.style.height=s.offsetHeight+"px",s.style.transitionProperty="height, margin, padding",s.style.transitionDuration=e+"ms",s.style.transitionTimingFunction="ease",s.style.overflow="hidden",s.style.height=0,s.style.paddingTop=0,s.style.paddingBottom=0,s.style.marginTop=0,s.style.marginBottom=0,setTimeout(()=>{s.style.display="none",s.style.removeProperty("height"),s.style.removeProperty("padding-top"),s.style.removeProperty("padding-bottom"),s.style.removeProperty("margin-top"),s.style.removeProperty("margin-bottom"),s.style.removeProperty("overflow"),s.style.removeProperty("transition-duration"),s.style.removeProperty("transition-property"),s.style.removeProperty("transition-timing-function"),s.classList.remove("is-open")},e)},SlideDown=(s,e=100)=>{s.classList.add("is-open"),s.style.removeProperty("display");let i=window.getComputedStyle(s).display;i==="none"&&(i="block"),s.style.display=i;const r=s.offsetHeight;s.style.overflow="hidden",s.style.height=0,s.style.paddingTop=0,s.style.paddingBottom=0,s.style.marginTop=0,s.style.marginBottom=0,s.style.transitionProperty="height, margin, padding",s.style.transitionDuration=e+"ms",s.style.transitionTimingFunction="ease",s.style.height=r+"px",s.style.removeProperty("padding-top"),s.style.removeProperty("padding-bottom"),s.style.removeProperty("margin-top"),s.style.removeProperty("margin-bottom"),setTimeout(()=>{s.style.removeProperty("height"),s.style.removeProperty("overflow"),s.style.removeProperty("transition-duration"),s.style.removeProperty("transition-property"),s.style.removeProperty("transition-timing-function")},e)};function fire_event(s,e="change"){if("createEvent"in document){const i=document.createEvent("HTMLEvents");i.initEvent(e,!1,!0),s.dispatchEvent(i)}else s.fireEvent("on"+e)}function item_css(s){s.style.paddingBottom="1px",s.style.marginTop="1px"}function description_css(s,e){const i=document.createElement("span");i.innerText=e,i.style.cssText="position: fixed; display: none; z-index: 5;background:#222;padding-left:10px;padding-right:10px;border-radius:5px",i.style.fontSize=COMPONENT_FONT_SIZE,s.appendChild(i);const r=s,o=i;o.time=performance.now();const l=o.dataset.coordinate_type;r.onmouseenter=()=>{o.style.display="none",!(performance.now()-o.time<500)&&(o.time=performance.now(),o.timer=setTimeout(()=>{if(o){o.style.position="fixed",o.style.display="block",o.style.zIndex="52";let a=r.getBoundingClientRect(),c=null;for(let f=0;f<r.children.length;f++)if(r.children[f].tagName!="SPAN"){c=r.children[f];break}c&&(a=c.getBoundingClientRect());let d=0;a.x+a.width/2+o.getBoundingClientRect().width>window.innerWidth&&(d=window.innerWidth-(a.x+a.width/2+o.getBoundingClientRect().width));const u=10;l==null?(o.style.left=Math.floor(d+a.x+a.width/2)+"px",o.style.top=Math.floor(a.y+a.height+u)+"px"):l=="right"?(o.style.left=Math.floor(d+a.x+a.width)+"px",o.style.top=Math.floor(a.y+u)+"px"):l=="left"&&(o.style.left=Math.floor(d+a.x+a.width/2)+"px",o.style.top=Math.floor(a.y+a.height+u)+"px")}},550))},r.onmouseleave=()=>{o.style.display="none",o.timer&&(clearTimeout(o.timer),o.timer=null),o.time=performance.now()}}function enter_key_delayed_blur(s){setTimeout(()=>{s.blur()},0)}function make_key_value2(s,e,i,r,o){const l={value_css:{},key_css:{},type:"text",onblur:h=>{}};r&&Object.assign(l,r);const a=document.createElement("div");a.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444;",item_css(a),a.onmouseenter=function(h){a.style.backgroundColor=MOUSE_HOVER_BG_COLOR},a.onmouseleave=function(h){a.style.backgroundColor="#00000000"};const c=document.createElement("div");c.style.cssText="height: 17px; float: left; text-align: left; padding-left: 5px; padding-right: 5px; display: flex; align-items: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",c.style.fontSize=COMPONENT_FONT_SIZE;const d=document.createElement("span");d.innerHTML=e,c.appendChild(d);let u=document.createElement("input");u.type=l.type||"text",u.value=i,u.onchange=h=>{o&&o(u.value)},u.oninput=h=>{l.oninput?.(h)},u.style.cssText="color: #AAF; float: left; height: 17px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-align: center; display: flex; align-items: center; justify-content: center; outline: 1px solid #FFFFFF11; box-shadow: -1px 0px 0px 0px #FFFFFF33; padding-left: 3px;",u.style.fontSize=COMPONENT_FONT_SIZE,u.style.backgroundColor=INPUT_BACKGROUND_COLOR,u.onkeydown=h=>{h.key=="Enter"&&h.isComposing==!1&&enter_key_delayed_blur(u)},u.onfocus=h=>{u.style.backgroundColor=INPUT_FOCUS_BACKGROUND_COLOR,u.style.color="#FFF"},u.onblur=h=>{u.style.backgroundColor=INPUT_BACKGROUND_COLOR,u.style.color="#AAF",l.onblur(h)},u.style.color=o?"#AAF":"#AAA";const f=i+"";f=="true"?u.style.color="green":f=="false"?u.style.color="red":isNaN(Number(i))||(u.style.color="cyan"),o==null&&(u.setAttribute("Disabled",""),u.style.backgroundColor="#2D2D2DAA"),u.style.fontSize=COMPONENT_FONT_SIZE;for(const h in l.value_css)u.style[h]=l.value_css[h];for(const h in l.key_css)c.style[h]=l.key_css[h];a.appendChild(c);const m=document.createElement("div");if(m.style.cssText="margin-left: auto; display: flex; align-items: center; justify-content: center;",m.appendChild(u),a.appendChild(m),s.appendChild(a),description_css(m,i),l.close_button&&o){const h=document.createElement("button"),_=document.createElement("i");_.classList.add("bi"),_.classList.add("bi-x-circle"),h.appendChild(_),h.style.background="none",a.appendChild(h),h.onclick=()=>{o(u.value,{event:"closed",params:l})}}return{title:c,element:a,modifier:u,getValue(){return u.value},update(h){if(o)u.value=h;else{u.value=h;const _=h+"";_=="true"?u.style.color="green":_=="false"?u.style.color="red":isNaN(Number(h))||(u.style.color="cyan")}}}}function make_search_box(s,e,i,r){const o={value_css:{},key_css:{}};i&&Object.assign(o,i);const l=document.createElement("div");l.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; opacity: 0.75;",item_css(l),l.onmouseenter=function(f){l.style.backgroundColor=MOUSE_HOVER_BG_COLOR,l.style.opacity="1"},l.onmouseleave=function(f){l.style.backgroundColor="#00000000",l.style.opacity="0.75"};const a=document.createElement("div");a.innerHTML="Search",a.style.cssText="height: 17px; float: left; text-align: left; padding-left: 5px; display: inline-block; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",a.style.fontSize=COMPONENT_FONT_SIZE;let c=document.createElement("input");c.type="search",c.setAttribute("autocomplete","off"),c.style.cssText="background-color: #2D2D2D; color: #AAF; float: left; height: 15px; text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",c.style.fontSize=COMPONENT_FONT_SIZE,c.onkeydown=f=>{f.key=="Enter"&&f.isComposing==!1&&enter_key_delayed_blur(c)},c.size=1,c.style.width="180px",c.style.marginLeft="auto",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.height="17px";for(const f in o.value_css)c.style[f]=o.value_css[f];for(const f in o.key_css)a.style[f]=o.key_css[f];const d=document.createElement("datalist"),u=crypto.randomUUID().replace(/-/g,"");d.id=u,c.setAttribute("list",u);for(let f=0;f<e.length;f++){const m=e[f],h=document.createElement("option");h.value=m.value,d.appendChild(h)}return c.onchange=f=>{for(let m=0;m<e.length;m++){const h=e[m];if(f.target.value==h.value){console.log(h),r(h);break}}},c.appendChild(d),l.appendChild(a),l.appendChild(c),s.appendChild(l),{element:l,modifier:c,update(f){if(r)c.value=f;else{c.innerHTML=f;const m=f+"";m=="true"?c.style.color="green":m=="false"?c.style.color="red":isNaN(Number(f))||(c.style.color="cyan")}}}}function make_pulldown(s,e,i,r,o,l){const a=document.createElement("div");a.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; opacity: 0.75;",item_css(a);const c={is_html:!1,value_css:{},key_css:{},close_button:!1};Object.assign(c,o),a.onmouseenter=function(f){a.style.backgroundColor=MOUSE_HOVER_BG_COLOR,a.style.opacity="1"},a.onmouseleave=function(f){a.style.backgroundColor="#00000000",a.style.opacity="0.75"};const d=document.createElement("div");d.innerHTML=e,d.style.cssText="height: 16px; float: left; padding-top: 3px; padding-left: 5px; text-align: left; display: block; border-bottom: 1px dotted #444; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",d.style.fontSize=COMPONENT_FONT_SIZE;const u=document.createElement("select");if(typeof i[0]=="string")for(const f in i){const m=i[f],h=document.createElement("option");c.is_html?h.innerHTML=m:h.innerText=m,h.value=m,r==m&&h.setAttribute("selected","selected"),u.appendChild(h)}else for(const f in i){const m=i[f],h=document.createElement("option");c.is_html?h.innerHTML=m.key:h.innerText=m.key,h.value=m.value===void 0?m.key:m.value,h.value==r&&h.setAttribute("selected","selected"),u.appendChild(h)}u.value=r,u.style.cssText="max-width: 140px; min-width: 10px; width: 140px; background-color: #2B2B2B; color: white; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; cursor: pointer; margin-left: auto; height: 18px; text-align: center; border: 1px solid #AAAAAA44;",u.style.fontSize=COMPONENT_FONT_SIZE,u.onchange=function(f){l&&l(f.target.value,Object.assign({event:"value"},i[f.target.selectedIndex]))},a.onclick=function(f){u.focus()};for(const f in c.key_css)d.style[f]=c.key_css[f];for(const f in c.value_css)u.style[f]=c.value_css[f];if(a.appendChild(d),a.appendChild(u),c.close_button&&l){const f=document.createElement("button"),m=document.createElement("i");m.classList.add("bi"),m.classList.add("bi-x-circle"),f.appendChild(m),f.style.background="none",a.appendChild(f),f.onclick=()=>{l(i[u.value],{event:"closed",params:c})}}return s.appendChild(a),{title:d,element:a,modifier:u,update(f){f!==void 0&&(u.value=f),fire_event(u,"change")},setValue(f){u.value=f,fire_event(u,"change")}}}function make_key_value_with_slider(s,e,i,r={},o){const l={min:0,max:1,step:.01,key_css:{},value_css:{},slider_css:{},default_value:null,slider_percentage:null,operator:(h,_)=>h+l.step*_,title:!0,value:!0};r&&Object.assign(l,r),i==null&&(i=l.default_value);const a=document.createElement("div");a.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; opacity: 0.75;",item_css(a);let c=!1;a.onmouseenter=function(h){a.style.backgroundColor=MOUSE_HOVER_BG_COLOR,a.style.opacity="1",c=!0},a.onmouseleave=function(h){a.style.backgroundColor="#00000000",a.style.opacity="0.75",c=!1};const d=document.createElement("div"),u=document.createElement("input"),f=document.createElement("input");e instanceof HTMLElement?d.appendChild(e):d.innerHTML=e,d.style.cssText="margin-right: auto; height: 15px; float: left; text-align: left; padding-left: 5px; display: flex; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; align-items: center;",d.style.fontSize=COMPONENT_FONT_SIZE,u.type="range",u.min=l.min,u.max=l.max,u.step=l.step,u.value=i,u.classList.add("slider"),u.style.cssText="float: left; width: 100px; min-width: 50px; max-width: 150px; margin-left: auto; display: flex; align-items: center; justify-content: center;",u.oninput=h=>{h?.stopPropagation?.(),f.value=u.value,o(Number(u.value),"oninput"),m()},u.oncontextmenu=h=>{h.preventDefault(),h.stopPropagation()};function m(){const h=l.max-l.min;let _=(parseFloat(u.value)-l.min)/h;l.slider_percentage&&(_=l.slider_percentage(u.value));const b=_*100;u.style.cursor="ew-resize",u.style.backgroundImage="-webkit-gradient(linear, left top, right top, color-stop("+b+"%, #3388FF), color-stop("+b+"%, #00000000))",u.style.backgroundImage="-moz-linear-gradient(left center, #3388FF 0%, #3388FF "+b+"%, #00000000 "+b+"%, #00000000 100%)"}if(u.onpointermove=h=>{h.stopPropagation(),m()},m(),f.type="number",f.value=i,f.onchange=h=>{h.stopPropagation(),u.value=f.value,o(Number(f.value),"onchange"),m()},f.onkeydown=h=>{h.key=="Enter"&&enter_key_delayed_blur(f)},f.onpointerdown=h=>{h.stopPropagation()},f.onpointerup=h=>{h.stopPropagation()},f.ondblclick=h=>{h.stopPropagation()},a.onkeydown=function(h){if(document.activeElement!=f&&c){const _=Number(u.value);h.code=="ArrowLeft"?(f.value=u.value=l.step-_,o(Number(u.value),"oninput"),m(),h.stopPropagation(),h.preventDefault()):h.code=="ArrowRight"&&(f.value=u.value=l.step+_,o(Number(u.value),"oninput"),m(),h.stopPropagation(),h.preventDefault())}},f.style.fontSize=COMPONENT_FONT_SIZE,f.style.maxWidth="40px",f.style.minWidth="1px",f.style.display="block",f.style.border="0px",f.style.outline="0px",f.style.backgroundColor=INPUT_BACKGROUND_COLOR,f.style.color=NUMBER_TEXT_COLOR,f.style.float="left",f.style.height="16px",f.style.textAlign="center",f.onfocus=()=>{f.select(),f.style.backgroundColor=INPUT_FOCUS_BACKGROUND_COLOR,f.style.color=NUMBER_TEXT_COLOR},f.onblur=()=>{f.style.backgroundColor=INPUT_BACKGROUND_COLOR,f.style.color=NUMBER_TEXT_COLOR,document.getSelection().removeAllRanges()},l.title&&a.appendChild(d),l.initializers?.length>0){let h=!0;for(const _ of l.initializers){const b=document.createElement("button");b.innerText=_.title,b.style.width="25px",b.style.borderRadius="2px",b.style.marginRight="1px",h&&(b.style.marginLeft="auto",h=!1),b.onclick=function(v){f.value=_.value,fire_event(f)},a.appendChild(b)}}a.appendChild(u),l.value&&a.appendChild(f),s.appendChild(a);for(const h in l.key_css)d.style[h]=l.key_css[h];for(const h in l.value_css)f.style[h]=l.value_css[h];for(const h in l.slider_css)u.style[h]=l.slider_css[h];return{element:a,modifier:f,slider:u,setMax(h){u.max=l.max=h},setMin(h){u.min=l.min=h},remove(){a.remove()},update_animation:m,update(h){h!==void 0&&(u.value=f.value=h),fire_event(f,"change")}}}function make_separator(s,e={}){const i={sub:!1,height:5,title:null,close:!1};Object.assign(i,e);const r=document.createElement("button");r.style.cssText="width: calc(100% - 1px); display: flex; align-items: center; justify-content: center; height: 17px; margin-top: 1px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",i.sub||(r.style.borderBottom="1px dotted #444"),i.title?(r.innerHTML=i.title,r.style.fontSize=COMPONENT_FONT_SIZE,r.style.textAlign="center",i.sub?(r.style.backgroundColor="#000000",r.style.color="#aaa",r.style.border="none"):(r.style.marginTop="3px",r.style.borderRadius="4px 4px 0px 0px",r.style.backgroundColor="#444",r.style.border="1px solid #555",r.style.borderBottom="1px solid #353535")):r.style.height=i.height+"px";{const o=document.createElement("div");o.style.width="calc(100% - 1px)",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",i.close&&(o.style.height="4px",o.style.backgroundColor="#404040",o.style.borderBottom="1px solid #444",o.style.borderRadius="0px 0px 10px 10px",o.style.boxShadow="5px 5px 5px #22222255"),s.appendChild(o)}return s.appendChild(r),r}function make_toggle_window(s,e,i){const r={title:"",toggle:!0,toggle_type:"window"};e&&Object.assign(r,e);const o=document.createElement("div"),l=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("button");s.appendChild(o),o.appendChild(a),o.appendChild(d),o.appendChild(l),o.appendChild(c),l.style.cssText="box-shadow: 0px 0px 10px #111; margin-left: 5px;",o.style.cssText="width: calc(100%); box-shadow: 0px 0px 3px #222; position: relative;",a.innerHTML=r.title,a.classList.add("title"),a.style.cssText="width: calc(100% - 18px); display: flex; align-items: center; justify-content: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; padding-left: 18px; height: 22px; background-color: #000; border-top: 1px solid #124; border-bottom: 1px solid #222; text-shadow: 1px 1px 2px #222;borderTop: 1px solid #222",a.style.fontSize=COMPONENT_FONT_SIZE,d.style.cssText="display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; position: absolute; left: 3px; top: 2px; background-color: none; background: none;";const u=document.createElement("i");u.classList.add("bi"),u.style.fontSize="10px",d.appendChild(u),c.style.cssText="width: calc(100%); height: 2px; background-color: #151515;";function f(h){u.classList.remove("bi-chevron-down"),u.classList.remove("bi-chevron-right"),h?(u.classList.add("bi-chevron-down"),c.style.display="block",o.style.marginBottom="10px",SlideDown(l)):(u.classList.add("bi-chevron-right"),c.style.display="none",o.style.marginBottom="0px",SlideUp(l)),i&&i(h)}f(r.toggle);function m(h){r.toggle=!r.toggle,f(r.toggle)}return a.onclick=m,d.onclick=m,{element:o,holder:l,modifier:null,update(h){h!==void 0&&(r.toggle=h),f(r.toggle)}}}function make_toggle_holder(s,e,i,r,o){const l={},a={toggle_type:"checkbox"};if(r&&Object.assign(a,r),a.toggle_type=="file")return make_toggle_holder_file(s,e,i,a);if(a.toggle_type=="selector")return make_toggle_holder_selector(s,e,i,a,o);const c=document.createElement("div"),d=document.createElement("div"),u="#00000088";c.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; border-left: 1px solid #47A;",item_css(c),c.style.opacity="0.75",c.style.backgroundColor=u,d.style.cssText="margin-left: 20px; width: calc(100% - 20px - 2px); border-left: 1px solid #4477AA66; background-color: #00000022; box-shadow: 0 0 3px #1A1A1A;",c.onmouseenter=function(b){c.style.backgroundColor=MOUSE_HOVER_BG_COLOR,c.style.opacity="1"},c.onmouseleave=function(b){c.style.backgroundColor=u,c.style.opacity="0.75"};let f=null,m=c.onclick=function(b,v){if(o){let w=f.innerHTML!="true";v&&(w=f.innerHTML=="true"),f.innerHTML=w+"",f.style.color=w?"#EEE":"#AAA",h.style.color=w?"#EEE":"#AAA",f.style.backgroundColor=w?"#666":"#555",w?d.style.display="block":d.style.display="none",o(w)}};const h=document.createElement("div");h.innerHTML=e,h.style.cssText="margin-right: auto; height: 15px; padding-left: 5px; display: flex; align-items: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",h.style.fontSize=COMPONENT_FONT_SIZE;let _=function(b){f.value=b};if(c.appendChild(h),a.toggle_type=="boolean")f=document.createElement("button"),f.innerHTML=i+"",f.style.cssText="float: left; text-align: center; display: block; border-bottom: 1px solid #444; min-width: 40px; width: 40px; margin-left: auto; display: flex; align-items: center; justify-content: center; box-shadow: 0px 0px 3px #444;",f.style.color=f.innerHTML=="true"?"#EEE":"#AAA",h.style.color=f.innerHTML=="true"?"#EEE":"#AAA",f.style.backgroundColor=f.innerHTML=="true"?"#666":"#555",f.onclick=m,f.style.fontSize=COMPONENT_FONT_SIZE,c.appendChild(f);else if(a.toggle_type=="checkbox"){const b=document.createElement("label"),v=document.createElement("i");f=document.createElement("input"),b.classList.add("form-switch"),b.appendChild(f),b.appendChild(v),_=w=>{f.checked=w},c.onclick=b.onclick=null,f.checked=i,m=f.onchange=function(w,y){if(o){const M=f.checked;f.style.color=M?"#EEE":"#AAA",h.style.color=M?"#EEE":"#AAA",f.style.backgroundColor=M?"#666":"#555",M?SlideDown(d):SlideUp(d),o(M)}l.listener?.(f.checked)},f.type="checkbox",h.style.color=f.checked?"#EEE":"#AAA",c.appendChild(b)}else a.toggle_type=="file"||a.toggle_type=="selector";return s.appendChild(c),s.appendChild(d),Object.assign(l,{element:c,holder:d,modifier:f,update(b){b!==void 0?(_(b),m()):m(null,!0)},disable(){f.disabled=!0},enable(){f.disabled=!1}}),l}function make_toggle_holder_file(s,e,i,r,o){r&&Object.assign({toggle_type:"file"},r);const a=document.createElement("div"),c=document.createElement("div"),d="#00000088";a.style.opacity="0.75",a.style.backgroundColor=d,a.onmouseenter=function(f){a.style.backgroundColor=MOUSE_HOVER_BG_COLOR,a.style.opacity="1"},a.onmouseleave=function(f){a.style.backgroundColor=d,a.style.opacity="0.75"},a.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; border-left: 1px solid #47A;",item_css(a),c.style.cssText="margin-left: 20px; width: calc(100% - 20px - 2px); border-left: 1px solid #4477AA66; background-color: #00000022; box-shadow: 0 0 3px #1A1A1A;",s.appendChild(a),s.appendChild(c);const u=document.createElement("input");return{element:a,holder:c,modifier:u,update(f){}}}function make_toggle(s,e,i,r,o){const l={toggle_type:"checkbox",close_button:!1};r&&Object.assign(l,r);const a=document.createElement("div");a.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; opacity: 0.75;",item_css(a),a.onmouseenter=function(h){a.style.backgroundColor=MOUSE_HOVER_BG_COLOR,a.style.opacity="1"},a.onmouseleave=function(h){a.style.backgroundColor="#00000000",a.style.opacity="0.75"};let c=null,d=function(h){o&&(c.innerHTML=(c.innerHTML!="true")+"",c.style.color=c.innerHTML=="true"?"#EEE":"#AAA",u.style.color=c.innerHTML=="true"?"#EEE":"#AAA",c.style.backgroundColor=c.innerHTML=="true"?"#666":"#555",o(c.innerHTML=="true"))};const u=document.createElement("div");u.innerHTML=e,u.style.cssText="width: 195px; height: 15px; padding-left: 5px; display: flex; align-items: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",u.style.fontSize=COMPONENT_FONT_SIZE,a.appendChild(u);let f=function(h){c.innerHTML=h+""};function m(h){c.style.color=h?"#EEE":"#AAA",u.style.color=h?"#EEE":"#AAA",c.style.backgroundColor=h?"#666":"#555"}if(o){if(l.toggle_type=="boolean")c=document.createElement("button"),f(i),c.style.color=c.innerHTML=="true"?"#EEE":"#AAA",u.style.color=c.innerHTML=="true"?"#EEE":"#AAA",c.style.backgroundColor=c.innerHTML=="true"?"#666":"#555",c.onclick=d,c.style.fontSize=COMPONENT_FONT_SIZE,c.style.float="left",c.style.textAlign="center",c.style.display="block",c.style.borderBottom="1px solid #444",c.style.display="flex",a.appendChild(c);else if(l.toggle_type=="checkbox"){const h=document.createElement("label"),_=document.createElement("i");c=document.createElement("input"),h.classList.add("form-switch"),h.appendChild(c),h.appendChild(_),f=function(b){c.checked=b,o&&o(c.checked),m(c.checked)},a.onclick=h.onclick=null,c.checked=i,d=c.onchange=function(b,v){o&&o(c.checked),m(c.checked)},c.type="checkbox",u.style.color=c.checked?"#EEE":"#AAA",a.appendChild(h)}}else c=document.createElement("div"),c.innerHTML=i+"",c.style.cssText="float: left; text-align: center; display: block; border-bottom: 1px solid #444;",c.style.backgroundColor=c.innerHTML=="true"?"#666":"#555",c.style.color=c.innerHTML=="true"?"#EEE":"#AAA",c.style.fontSize=COMPONENT_FONT_SIZE,u.style.color=c.innerHTML=="true"?"#EEE":"#AAA";if(c.style.minWidth="40px",c.style.width="40px",c.style.marginLeft="auto",c.style.alignItems="center",c.style.justifyContent="center",c.style.boxShadow="0px 0px 3px #444",m(c.checked),l.close_button&&o){const h=document.createElement("button"),_=document.createElement("i");_.classList.add("bi"),_.classList.add("bi-x-circle"),h.appendChild(_),h.style.background="none",a.appendChild(h),h.onclick=()=>{o(c.value,{event:"closed",params:l})}}return s.appendChild(a),{element:a,modifier:c,modifier2:{set value(h){c.checked=h,m(c.checked)},get value(){return c.type=="checkbox"?c.checked:c.innerHTML=="true"}},update(h){h!==void 0?f(h):o&&(m(c.checked),c.type=="checkbox"?o(c.checked):o(c.innerHTML=="true"))}}}function make_button(s,e,i,r,o){const l={key_css:{},value_css:{}};r&&Object.assign(l,r);const a=document.createElement("div");a.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; opacity: 0.75;",item_css(a),a.onmouseenter=function(u){a.style.backgroundColor=MOUSE_HOVER_BG_COLOR,a.style.opacity="1"},a.onmouseleave=function(u){a.style.backgroundColor="#00000000",a.style.opacity="0.75"};const c=document.createElement("div");c.innerHTML=e,c.style.cssText="width: 195px; height: 15px; float: left; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; padding-left: 5px; display: flex; align-items: center;",c.style.fontSize=COMPONENT_FONT_SIZE;let d=null;o?(d=document.createElement("button"),d.innerHTML=i,d.onclick=u=>{o()},d.style.cssText="width: 40px; float: left; text-align: center; display: block; border-bottom: 1px solid #444; cursor: pointer;",d.style.fontSize=COMPONENT_FONT_SIZE):(d=document.createElement("div"),d.innerHTML=i,d.style.cssText="width: 40px; float: left; text-align: center; display: block; border-bottom: 1px solid #444;",d.style.fontSize=COMPONENT_FONT_SIZE),d.style.marginLeft="auto",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="center";for(const u in l.value_css)d.style[u]=l.value_css[u];for(const u in l.key_css)d.style[u]=l.key_css[u];return a.appendChild(c),a.appendChild(d),s.appendChild(a),{title:c,element:a,modifier:d,disable:()=>{d.disabled=!0},enable:()=>{d.disabled=!1},update(u){u!==void 0?(d.innerHTML=u,d.onclick()):o()}}}var G_script_window_set=new Map;async function open_script_editor$1(s,e={},i){const r={url:"./ddd/ui/script_editor_monaco.html",title:"",nodeIntegration:!1,contextIsolation:!0,text:null,mode:"javascript",force_internal_window:!1};e&&Object.assign(r,e);{let o=null;return G_script_window_set.has(s)?(o=G_script_window_set.get(s),window.focus_window(r.title),o):(o=await make_hybrid_window({window_key:s,title:r.title,url:r.url,contextIsolation:r.contextIsolation,nodeIntegration:r.nodeIntegration,restore_frame_setting:!0,force_internal_window:r.force_internal_window,params:{extra_context_menu:r.extra_context_menu,mode:r.mode,text:r.text,data_path:null},async onload(){console.log("Opened: Script Editor"),window.focus_window(r.title)},async onmessage(l){if(l){const a=l.type,c=l.text,d=l.mode;console.log(l),a=="save"?i("save",c):a=="run"?i("run",c):a=="close"?o.close():a=="mode"?i("mode",d):a=="focus"?window.focus_window(l.title):a=="contextmenu"||a=="escape"||l.extra_context_menu&&i(a,c)}return null},async onclose(){console.log("@@onclose"),G_script_window_set.delete(s)}}),G_script_window_set.set(s,o),o)}}function make_script(s,e,i,r,o){const l={run:!0,editor:!0,textarea:!0,mode:"javascript"};r&&Object.assign(l,r);const a=document.createElement("div"),c=document.createElement("div");c.style.cssText="margin-top: 4px; width: calc(100% - 10px); display: flex; align-items: center; padding: 2px; opacity: 0.75;",item_css(c),c.onmouseenter=function(_){c.style.backgroundColor=MOUSE_HOVER_BG_COLOR,c.style.opacity="1"},c.onmouseleave=function(_){c.style.backgroundColor="#00000000",c.style.opacity="0.75"};const d=document.createElement("div");d.innerHTML=e,d.style.cssText="height: 15px; float: left; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; padding-left: 5px; display: block;",d.style.fontSize=COMPONENT_FONT_SIZE;let u=null;const f=document.createElement("textarea");make_drag_and_drop(f,{},async _=>{const v=_.item.split(".").pop().toLowerCase();if(v=="txt"||v=="json"||v=="js"||v=="mjs"){const w=new FileReader;w.onload=async function(y){const M=y.target.result,S=new TextDecoder().decode(M);f.value=S,o&&o("input",f,l.mode)},w.onerror=async function(y){console.error(y)},w.readAsArrayBuffer(_.file.file)}});let m=null;const h="width: 75px; float: left; border-radius: 8px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; height: 17px; border: 1px solid #666;";o?(u=document.createElement("button"),u.innerHTML="Editor",u.style.cssText=h,u.onclick=_=>{o("editor",f,l.mode)},l.run?(m=document.createElement("button"),m.innerHTML="Run",m.onclick=_=>{o("run",f,l.mode)},m.style.cssText="width: 75px; float: left; margin-left: auto; margin-right: 4px; border-radius: 8px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; height: 17px; border: 1px solid #666;",m.style.fontSize=COMPONENT_FONT_SIZE):u.style.marginLeft="auto"):(u=document.createElement("div"),u.innerHTML=i,u.style.cssText=h,u.style.marginLeft="auto"),d.onclick=u.onclick,u.style.fontSize=COMPONENT_FONT_SIZE,f.style.cssText="width: calc(100% - 10px); height: 50px; background-color: #1F1F1F; border: 1px dotted #444; margin-top: 3px;background:#181818;word-break: break-all;padding:3px",f.style.color="#ddd",f.style.fontSize=COMPONENT_FONT_SIZE,f.value=i,f.oninput=_=>{o&&o("input",f,l.mode)},c.appendChild(d),m&&c.appendChild(m),l.editor&&c.appendChild(u),a.appendChild(c),l.textarea&&a.appendChild(f),a.style.clear="both",a.style.width="100%";for(const _ in l.value_css)f.style[_]=l.value_css[_];for(const _ in l.key_css)d.style[_]=l.key_css[_];return s.appendChild(a),{title:d,element:a,modifier:f,update(_){_!==void 0?(u.value=_,u.onclick()):o()}}}function make_float_box(s,e,i,r={},o){const l={operator:(f,m)=>f+l.step*m,step:.01,precision:4,min:null,max:null,close_button:!1,value_css:{},key_css:{}};Object.assign(l,r);const a=document.createElement("div");a.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; opacity: 0.75;",item_css(a),a.onmouseenter=function(f){a.style.backgroundColor=MOUSE_HOVER_BG_COLOR,a.style.opacity="1"},a.onmouseleave=function(f){a.style.backgroundColor="#00000000",a.style.opacity="0.75"};const c=document.createElement("label"),d=document.createElement("input");c.style.cssText="width: 160px; text-align: left; padding-left: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; float: left;",d.style.cssText="min-width: 75px; max-width: 175px; text-align: center; float: left; border: 1px solid #666; border-radius: 10px; text-indent: 5px; cursor: ew-resize; margin-left: auto; display: flex; align-items: center; justify-content: center;",d.style.backgroundColor=INPUT_BACKGROUND_COLOR,d.style.color=NUMBER_TEXT_COLOR,c.style.fontSize=COMPONENT_FONT_SIZE,d.type="number",d.onfocus=()=>{d.select(),d.style.backgroundColor=INPUT_FOCUS_BACKGROUND_COLOR,d.style.color=NUMBER_TEXT_COLOR},d.onblur=()=>{d.style.backgroundColor=INPUT_BACKGROUND_COLOR,d.style.color=NUMBER_TEXT_COLOR,document.getSelection().removeAllRanges()};function u(f,m=!0){let h=Number(f);return h=isNaN(h)?0:h,l.precision!=null&&(h=Math.round(h*Math.pow(10,l.precision))/Math.pow(10,l.precision)),l.min!=null&&(h=l.min>h?l.min:h),l.max!=null&&(h=l.max<h?l.max:h),m&&(d.value=h),h}d.onkeyup=function(f){f.code=="Enter"&&(o(u(d.value)),f.preventDefault())},d.onchange=function(f){o(u(f.target.value))},d.oninput=function(f){f instanceof InputEvent?o(u(f.target.value,!1)):o(u(f.target.value))},d.onkeydown=f=>{f.key=="Enter"&&f.isComposing==!1&&enter_key_delayed_blur(d)};{const f=l.min,m=l.max;l.min=null,l.max=null,u(i),l.min=f,l.max=m}if(d.onmousedown=f=>{active_dragging_input_box={input:d,operator:l.operator,step:l.step,precision:l.precision,event:{x:f.screenX,y:f.screenY}}},d.ondragstart=()=>!1,d.ondrop=()=>!1,c.innerHTML=e,a.appendChild(c),l.initializers?.length>0){let f=!0;for(const m of l.initializers){const h=document.createElement("button");h.innerText=m.title,h.style.width="25px",h.style.borderRadius="2px",h.style.marginRight="1px",f&&(h.style.marginLeft="auto",f=!1),h.onclick=function(_){d.value=m.value,fire_event(d)},a.appendChild(h)}}if(a.appendChild(d),l.close_button&&o){d.style.width="140px";const f=document.createElement("button"),m=document.createElement("i");m.classList.add("bi"),m.classList.add("bi-x-circle"),f.appendChild(m),f.style.background="none",a.appendChild(f),f.onclick=()=>{o(d.value,{event:"closed",params:l})}}s.appendChild(a);for(const f in l.value_css)d.style[f]=l.value_css[f];for(const f in l.key_css)c.style[f]=l.key_css[f];return{title:c,type:"make_float_box",element:a,modifier:d,set(f){d.value=f},update(f){f&&(d.value=f),fire_event(d)}}}function make_property_manager(s,e,i){const r={title:"",list:[]};e&&Object.assign(r,e);const l=make_toggle_window(s,{title:r.title},()=>{}).holder;for(const a of r.list)make_key_value2(l,a.key,a.value,{type:a.type},c=>{a.value=c,i(a,c)})}function make_color_picker(s,e,i,r){const o=document.createElement("div");o.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 20px; white-space: nowrap; border-bottom: 1px dotted #444; opacity: 0.75;",item_css(o),o.onmouseenter=function(c){o.style.backgroundColor=MOUSE_HOVER_BG_COLOR,o.style.opacity="1"},o.onmouseleave=function(c){o.style.backgroundColor="#00000000",o.style.opacity="0.75"};const l=document.createElement("label"),a=document.createElement("input");return l.style.cssText="height: 15px; float: left; padding-top: 3px; padding-left: 5px; text-align: left; display: block; border-bottom: 1px dotted rgb(68, 68, 68); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",l.style.fontSize=COMPONENT_FONT_SIZE,a.type="color",a.style.cssText="border: 0px; min-width: auto; max-width: 200px; width: 50px; height: 15px; margin-left: auto; display: flex; align-items: center; white-space: nowrap;",a.onfocus=()=>{a.select()},a.onchange=function(c){const d=parseInt(c.target.value.replace("#","0x"),16);r(isNaN(d)?0:d)},a.oninput=function(c){const d=parseInt(c.target.value.replace("#","0x"),16);r(isNaN(d)?0:d)},a.value=i,a.ondragstart=()=>!1,a.ondrop=()=>!1,a.onkeydown=c=>{c.key=="Enter"&&c.isComposing==!1&&enter_key_delayed_blur(a)},l.innerHTML=e,o.appendChild(l),o.appendChild(a),a.oncontextmenu=c=>{c.preventDefault(),c.stopPropagation()},o.onmouseup=async function(c){if(c.button==2){c.preventDefault(),c.stopPropagation();let d=null;document.body.focus();const u=await navigator.clipboard.readText();(u.startsWith("0x")||u.split(",").length==3)&&(d={key:"Paste",callback:function(){if(u.startsWith("0x")){a.value=u.replace("0x","#");const f=parseInt(u,16);r(isNaN(f)?0:f)}else{const[f,m,h]=u.split(","),_=Math.floor(Number(f)*255),b=Math.floor(Number(m)*255),v=Math.floor(Number(h)*255);a.value="#"+_.toString(16)+b.toString(16)+v.toString(16);const w=_<<16|b<<8|v;r(isNaN(w)?0:w)}}}),C$2.popup_menu(c,[{key:"Copy color as hex",callback:function(){navigator.clipboard.writeText("0x"+a.value.replace("#","").toUpperCase())}},{key:"Copy color as rgb",callback:function(){const f=a.value.replace("#",""),m=parseInt(f.slice(0,2),16)/255,h=parseInt(f.slice(2,4),16)/255,_=parseInt(f.slice(4,6),16)/255;navigator.clipboard.writeText(`${m.toFixed(3)},${h.toFixed(3)},${_.toFixed(3)}`)}},d].filter(f=>f!=null),null,(f,m,h)=>{h.callback()}),c.stopPropagation(),c.preventDefault()}},s.appendChild(o),{title:l,element:o,modifier:a,update(c){c&&(a.value=c),fire_event(a)}}}let active_dragging_input_box=null;const local_event_listeners={};document.addEventListener("mouseup",s=>{active_dragging_input_box=null;for(const e in local_event_listeners)local_event_listeners[e](s)});document.addEventListener("mousemove",s=>{if(active_dragging_input_box){const e=active_dragging_input_box.step,i=active_dragging_input_box.operator,r=active_dragging_input_box.precision,o=active_dragging_input_box.input,l=active_dragging_input_box.event.x-s.screenX;active_dragging_input_box.event.x=s.screenX,i?o.value=i(parseFloat(o.value),-l,e,Number(o.dataset.index)).toFixed(r):o.value=parseFloat(o.value-l*e).toFixed(r),o.oninput({target:{value:o.value}})}});function make_vec3_box(s,e,i,r,o={},l,a,c){function d(){let y=u.step;if(u.camera_step){const M=DMC.current.camera||DMC.camera,S=new THREE.Vector3,D=new THREE.Vector3,k=new THREE.Vector3,O=new THREE.Vector3(0,1,0);k.copy(M.position),k.sub(M.target),k.normalize(),k.cross(O),k.normalize(),S.copy(M.target),S.project(M),D.copy(M.target),D.add(k),D.project(M),D.sub(S);const L=DMC.base_renderer.domElement.width;DMC.base_renderer.domElement.height,y=1/Math.abs(L*D.x)*u.step}return y}const u={operator:(y,M,S)=>y+d()*M,step:.1,precision:2,default_values:[0,0,0],close_button:!1,min_x:null,min_y:null,min_z:null,max_x:null,max_y:null,max_z:null},f=(y,M,S)=>(M!=null&&(y=M>y?M:y),S!=null&&(y=S<y?S:y),y);let m=i;Array.isArray(i)&&(m={x:i[0],y:i[1],z:i[2]}),Object.assign(u,o);const h=document.createElement("div");h.style.cssText="width: calc(100% - 2px); display: flex; align-items: center; height: 17px; border-bottom: 1px dotted #444; opacity: 0.75;",item_css(h),h.onmouseenter=function(y){h.style.backgroundColor=MOUSE_HOVER_BG_COLOR,h.style.opacity="1"},h.onmouseleave=function(y){h.style.backgroundColor="#00000000",h.style.opacity="0.75"};const _=document.createElement("div");_.style.width="100%",_.style.padding="1px";const b=document.createElement("label");b.style.cssText="width: 57px; display: inline-block; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; padding-left: 5px; height: 15px;",b.style.fontSize=COMPONENT_FONT_SIZE,b.innerHTML=e;const v=document.createElement("div");if(v.style.cssText="margin-left: auto; min-width: 0; display: flex; align-items: center; justify-content: center;",h.appendChild(b),u.initializers?.length>0){let y=!0;for(const M of u.initializers){const S=document.createElement("button");S.innerText=M.title,S.style.width="25px",S.style.borderRadius="2px",S.style.marginRight="1px",y&&(S.style.marginLeft="auto",y=!1),S.onclick=function(D){const k=v;k.children[1].value=M.values[0],k.children[2].value=M.values[1],k.children[3]&&(k.children[3].value=M.values[2]),fire_event(k.children[1]),fire_event(k.children[2]),k.children[3]&&fire_event(k.children[3])},h.appendChild(S)}}function w(y){y.type="number",y.style.textAlign="center",y.style.width="50px",y.style.minWidth="0",y.style.marginLeft="auto",y.style.border="1px solid #444",y.style.backgroundColor=INPUT_BACKGROUND_COLOR,y.style.color=NUMBER_TEXT_COLOR,y.style.cursor="ew-resize",y.style.fontSize=COMPONENT_FONT_SIZE,y.style.height="15px",y.onkeydown=M=>{M.key=="Enter"&&M.isComposing==!1&&enter_key_delayed_blur(y)},y.onfocus=()=>{y.select(),y.style.backgroundColor=INPUT_FOCUS_BACKGROUND_COLOR,y.style.color=NUMBER_TEXT_COLOR},y.onblur=()=>{y.style.backgroundColor=INPUT_BACKGROUND_COLOR,y.style.color=NUMBER_TEXT_COLOR,document.getSelection().removeAllRanges()}}h.onmouseup=async function(y){if(y.button==2){const M={x:parseFloat(v.children[1].value),y:parseFloat(v.children[2].value),z:v.children[3]?parseFloat(v.children[3].value):null};if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){C$2.modal_ok("Error","Clipboard permission denied.");return}let D=null;try{const O=await navigator.clipboard.readText(),L=JSON.parse(O);L.x!=null&&(D=L)}catch{}const k=[{key:T("g.copy_vector"),value:"Copy Vector"},{key:T("g.copy_as_tuple"),value:"Copy as Tuple"}];D&&k.push({key:T("g.paste"),value:"Paste Vector"}),y.target instanceof HTMLInputElement||window.C.popup_menu(y,k,{},async O=>{try{if(O=="Copy Vector"){await navigator.clipboard.writeText(JSON.stringify(M));return}else if(O=="Paste Vector")v.children[1].value=D.x,v.children[2].value=D.y,v.children[3]&&(v.children[3].value=D.z);else if(O=="Copy as Tuple"){M.z!=null?await navigator.clipboard.writeText(`(${M.x},${M.y},${M.z})`):await navigator.clipboard.writeText(`(${M.x},${M.y})`);return}}catch(L){C$2.modal_ok("Error",L)}})}};{const y=document.createElement("button");y.style.width="24px",y.innerHTML="R",y.style.fontSize=COMPONENT_FONT_SIZE,y.style.borderRadius="3px 0px 0px 3px",y.onclick=()=>{const M=v;M.children[1].value=u.default_values[0],M.children[2].value=u.default_values[1],M.children[3]&&(M.children[3].value=u.default_values[2]),fire_event(M.children[1]),fire_event(M.children[2]),M.children[3]&&fire_event(M.children[3])},v.appendChild(y)}{const y=m.x/r,M=l,S=document.createElement("input");S.dataset.index="0",w(S),S.style.borderLeft="1px solid #FF0000AA",S.onchange=function(D){const k=Number(D.target.value);M(f(isNaN(k)?0:k,u.min_x,u.max_x))},S.oninput=function(D){const k=Number(D.target.value);M(f(isNaN(k)?0:k,u.min_x,u.max_x))},S.value=((y+"").length>5,Number(y.toFixed(5))).toString(),S.onmousedown=D=>{active_dragging_input_box={input:S,operator:u.operator,step:d(),precision:u.precision,event:{x:D.screenX,y:D.screenY}}},S.ondragstart=()=>!1,S.ondrop=()=>!1,v.appendChild(S)}{const y=m.y/r,M=a,S=document.createElement("input");S.dataset.index="1",w(S),S.style.borderRadius="0px",S.style.borderLeft="1px solid #00FF00AA",S.onchange=function(D){const k=Number(D.target.value);M(f(isNaN(k)?0:k,u.min_y,u.max_y))},S.oninput=function(D){const k=Number(D.target.value);M(f(isNaN(k)?0:k,u.min_y,u.max_y))},S.value=((y+"").length>5,Number(y.toFixed(5))).toString(),S.onmousedown=D=>{active_dragging_input_box={input:S,operator:u.operator,step:d(),precision:u.precision,event:{x:D.screenX,y:D.screenY}}},S.ondragstart=D=>(console.log(D),!1),S.ondragover=D=>(console.log(D),!1),S.ondragend=D=>(console.log(D),!1),S.ondrag=D=>(console.log(D),!1),S.ondrop=D=>(console.log(D),!1),v.appendChild(S)}if(m.z!=null){const y=m.z/r,M=c,S=document.createElement("input");S.dataset.index="2",w(S),S.style.borderRadius="0px 3px 3px 0px",S.style.borderLeft="1px solid #0000FFAA",S.onchange=function(D){const k=Number(D.target.value);M(f(isNaN(k)?0:k,u.min_z,u.max_z))},S.oninput=function(D){const k=Number(D.target.value);M(f(isNaN(k)?0:k,u.min_z,u.max_z))},S.value=((y+"").length>5,Number(y.toFixed(5))).toString(),S.onmousedown=D=>{active_dragging_input_box={input:S,operator:u.operator,step:d(),precision:u.precision,event:{x:D.screenX,y:D.screenY}}},S.ondragstart=()=>!1,S.ondrop=()=>!1,v.appendChild(S)}if(h.appendChild(v),u.close_button&&l){const y=document.createElement("button"),M=document.createElement("i");M.classList.add("bi"),M.classList.add("bi-x-circle"),y.appendChild(M),y.style.background="none",h.appendChild(y),y.onclick=()=>{l(v.children[1].value,{event:"closed",params:u})}}return s.appendChild(h),{title:b,type:"make_vec3_box",element:h,set:function(y){v.children[1].value=y.x/r,v.children[2].value=y.y/r,v.children[3]!=null&&y.z!=null&&(v.children[3].value=y.z/r)},modifier:null}}var FrameManager=null;async function make_window(s,e,i){const r={url:null,html:null,urlLoaded:null,left:50,top:50,width:200,height:110,minWidth:200,minHeight:110,minimizeButton:!0,closeButton:!0,maximizeButton:!0};i&&Object.assign(r,i);const o=document.getElementById("__editor_overlay_window__");if(!FrameManager){const d=(await __vitePreload(()=>import("./jsframe.min@D6SUlaS-.js"),[],import.meta.url)).default;FrameManager=new d({parentElement:o})}const l=window.innerWidth;r.width==null&&(r.width=Math.floor(l*.6666),r.height=Math.floor(r.width*.75));let a=null;const c=FrameManager.create({name:s,title:e,left:r.left,top:r.top,width:r.width,height:r.height,minWidth:r.minWidth,minHeight:r.minHeight,html:r.html,url:r.url,urlLoaded:d=>{d.close=function(){d.closeFrame()},d.iframe.contentWindow.jsframe=c,d.iframe.contentWindow.parent_params=r,r?.urlLoaded&&r.urlLoaded(c)},resizable:!0,movable:!0,appearanceName:"material",appearanceParam:{border:{shadow:"2px 2px 10px  rgba(0, 0, 0, 0.5)",width:0,radius:6},titleBar:{color:"white",background:"#1C1C1CFF",leftMargin:40,height:25,fontSize:14,buttonWidth:36,buttonHeight:12,buttonColor:"white",buttons:[{fa:"bi bi-x",name:"closeButton",visible:r.closeButton},{fa:"bi bi-square",name:"maximizeButton",visible:r.maximizeButton},{fa:"bi bi-dash-lg",name:"minimizeButton",visible:r.minimizeButton},{fa:"bi bi-dash-square-dotted",name:"deminimizeButton",visible:!1}],buttonsOnLeft:[{fa:"bi bi-window-sidebar",name:"menu",visible:!0,childMenuWidth:300}]}},style:{backgroundColor:"rgba(0,0,0,0.8)",overflow:"hidden",width:"100%"}});return c.iframe.classList.add("open_window_iframe"),a=c.iframe.parentElement.parentElement,a.style.animationName="open_window",a.style.animationDuration="0.2s",setTimeout(()=>{a.style.animationName="",a.style.animationDuration=""},200),c.resizableHandle="top-left",c.setControl({maximizeButton:"maximizeButton",demaximizeButton:"restoreButton",maximizeWithoutTitleBar:!0,restoreKey:"Escape",minimizeButton:"minimizeButton",deminimizeButton:"deminimizeButton",hideButton:"closeButton",animation:!0,animationDuration:100}),c.show(),{FrameManager,instance:c}}const SubWindows={};async function make_browser_window(s){const e={window_key:null,url:null,nodeIntegration:!0,contextIsolation:!1,html:null,title:"",urlLoaded:null,x:200,y:200,width:1024,height:1024,params:{}};s&&Object.assign(e,s);const i=e.window_key;SubWindows[i]&&SubWindows[i].closed&&(window.removeEventListener("message",SubWindows[i].callback_message,!1),delete SubWindows[i]);const r=`width=300,height=300,contextIsolation=${e.contextIsolation?"yes":"no"},nodeIntegration=${e.nodeIntegration?"yes":"no"}`;console.log(r);const o=window.open(e.url,e.title,r);if(o==null)return null;o.moveTo(e.x,e.y),o.resizeTo(e.width,e.height),o.focus(),o.document.title=e.title,SubWindows[i]=o;const l=setInterval(function(){o.closed&&(clearInterval(l),s?.onclose?.(),SubWindows[i]?.callback_message&&window.removeEventListener("message",SubWindows[i].callback_message,!1),delete SubWindows[i])},500),a=s.onload,c=s.onmessage;return s.onclose,o.callback_message=async function(d){console.log(d);try{if(d.source&&o==d.source){const u=d.data;if(u.channel!="editor")return;if(u.event_key){if(u.event_key=="construct")a&&await a(),console.log("Mes:construct"),o.postMessage({channel:"editor",event_key:"construct",params:e.params});else if(c){const f=await c(u.params);console.log("Mes:message"),o.postMessage({channel:"editor",event_key:"message",request_index:u.request_index,params:f})}}}}catch(u){console.log("Mes:error"),o.postMessage({channel:"editor",event_key:"error",params:e.params}),C$2.close_modal_processing(),C$2.modal_ok_cancel("Error",u),console.error(u)}},window.addEventListener("message",o.callback_message,!1),o}let HybridWindowTable={},HybridWindowSettingCache;async function make_hybrid_window(s){HybridWindowSettingCache=HybridWindowSettingCache??JSON.parse(await __storage__.editor.get("HybridWindowSettingCache","{}"));const e={title:"",contextIsolation:!1,nodeIntegration:!0,force_external_window:!1,persistent:!1,force_internal_window:!1,window_key:null,x:50,y:50,width:640,height:480,onload:null,onmessage:null,onclose:null,params:null};if(s&&Object.assign(e,s),e.window_key==null)return console.error("Window key is null."),null;if(e.reopen){if(HybridWindowTable[e.window_key]){if(window.nodejs)return window.focus_window(e.title),await C$2.sleep(100),console.log("Cache:",e.window_key),HybridWindowTable[e.window_key];HybridWindowTable[e.window_key].component?.close?.(),delete HybridWindowTable[e.window_key],await C$2.sleep(100),console.log("Cache:",e.window_key)}}else if(HybridWindowTable[e.window_key])return window.focus_window(e.title),console.log("Cache:",e.window_key),HybridWindowTable[e.window_key];const i={};let r=null,o=HybridWindowSettingCache[e.window_key],l=e;if(o&&e.restore_frame_setting){const d=o;d.x!=null&&d.x<50&&(d.x=50),d.y!=null&&d.y<50&&(d.y=50),d.width!=null&&d.width<640&&(d.width=640),d.height!=null&&d.height<480&&(d.height=480),e.x=o.x,e.y=o.y,e.width=o.width,e.height=o.height}l=e,l.x!=null&&l.x<50&&(l.x=50),l.y!=null&&l.y<50&&(l.y=50),l.width!=null&&l.width<640&&(l.width=640),l.height!=null&&l.height<480&&(l.height=480);let a=null;const c=new Promise((d,u)=>{a=d});if((!e.force_internal_window||e.force_external_window)&&window.nodejs)if(e.persistent&&window.external_io==null){if(window.nodejs?.ipcRenderer){await window.nodejs.ipcRenderer.invoke("sub_window",{window_id:e.window_key,entry_point:e.url}),i.send=async function(u){return await window.nodejs.ipcRenderer.invoke("message_to_sub_window",{window_id:e.window_key,params:u})};const d=async(u,f)=>{const m=f;if(m?.params?.type=="close"&&(i.close(),delete HybridWindowTable[e.window_key]),m.event_key){if(m.event_key=="construct")m.params=e.params,await window.nodejs.ipcRenderer.invoke("message_to_sub_window",{window_id:e.window_key,params:{channel:"editor",event_key:"message",params:{event:"enabled_native_ipc"}}}),setTimeout(()=>{window.nodejs.ipcRenderer.invoke("message_to_sub_window",{window_id:e.window_key,params:m})},50);else if(m.event_key=="close")delete HybridWindowTable[e.window_key],window.nodejs.ipcRenderer.removeListener("message",d);else if(e.onmessage){const h=await e.onmessage(m.params);m.params=h,await window.nodejs.ipcRenderer.invoke("message_to_sub_window",{window_id:e.window_key,params:m})}}};return window.nodejs.ipcRenderer.on("message",d),setTimeout(()=>{e.onload?.()},1),HybridWindowTable[e.window_key]=i,i.close=function(){window.nodejs.ipcRenderer.invoke("close_sub_window",{window_id:e.window_key}),delete HybridWindowTable[e.window_key]},i}}else{let u=function(){e.restore_frame_setting&&!r.closed&&(o=HybridWindowSettingCache[e.window_key]={x:r.screenX,y:r.screenY,width:r.outerWidth,height:r.outerHeight},__storage__.editor.set("HybridWindowSettingCache",JSON.stringify(HybridWindowSettingCache)))};r=await make_browser_window({window_key:e.window_key,url:e.url,title:e.title,x:e.x,y:e.y,width:e.width,height:e.height,nodeIntegration:e.nodeIntegration,contextIsolation:e.contextIsolation,onload:()=>{e.onload(...arguments),a()},onmessage:(f,m)=>{console.log(),f?.params?.type=="close"&&i.close(),e.onmessage?.(f,m)},onclose:function(){clearInterval(d),u(),delete HybridWindowTable[e.window_key],e.onclose?.()},params:e.params});let d=null;d=setInterval(()=>{u()},2500),i.sub_window=r,i.component=r,HybridWindowTable[e.window_key]=i}if(r==null){const d=e.onload,u=e.onmessage,f=e.onclose;let m=null;const h={url:e.url,left:l.x,top:l.y,width:l.width,height:l.height,urlLoaded:async function(w){w.setPosition(e.x,e.y),w.setSize(e.width,e.height);function y(){const M=w.getSize(),S=w.getPosition();e.restore_frame_setting&&(o=HybridWindowSettingCache[e.window_key]={x:S.x,y:S.y,width:M.width,height:M.height},__storage__.editor.set("HybridWindowSettingCache",JSON.stringify(HybridWindowSettingCache)))}m=setInterval(()=>{y()},2500),w.setOnCloseFrameListener(()=>{clearInterval(m),f?.(),delete HybridWindowTable[e.window_key],y()}),a()}},_=await make_window(e.window_key,e.title,h),b=_.instance.iframe.contentWindow,v=e;window.addEventListener("message",async w=>{if(w.source&&b==w.source){const y=w.data;if(y?.params?.type=="close"&&i.close(),y.channel!="editor")return;if(y.event_key){if(y.event_key=="construct")d&&await d(),b.postMessage({channel:"editor",event_key:"construct",params:v.params});else if(y.event_key=="close")_.instance.closeFrame();else if(u){const M=await u(y.params);b.postMessage({channel:"editor",event_key:"message",request_index:y.request_index,params:M})}}}},!1),i.component=_,i.sub_window=b,HybridWindowTable[e.window_key]=i}return i.send=async function(d){await c,i.sub_window.postMessage({channel:"editor",event_key:"message",params:d})},i.close=function(){i.component.close?.(),i.component.instance?.close?.()},i}function traverse_file_tree(s,e,i,r,o){e=e||"",o.counter++,s.isFile?s.file(function(l){i(e+l.name,l),o.counter--,o.counter==0&&o.finish()}):s.isDirectory&&(r(e+s.name),s.createReader().readEntries(function(a){for(let c=0;c<a.length;c++)traverse_file_tree(a[c],e+s.name+"/",i,r,o);o.counter--,console.log(o),o.counter==0&&o.finish()}))}function get_dropped_items(s){const e=s.dataTransfer.items,i=[],r=[];return new Promise((o,l)=>{let a=0;const c=e.length;if(e==null||c==0){o({items:e,dirs:i,files:r});return}for(let d=0;d<e.length;d++){const u=e[d].webkitGetAsEntry();u&&traverse_file_tree(u,null,(f,m)=>{console.log("File",m),r.push({file:m,file_path:f})},f=>{i.push(f),console.log("Dir",f)},{counter:0,finish:()=>{a++,console.log(a==c,a,c),a==c&&(console.log("finish"),o({items:e,dirs:i,files:r}))}})}})}function make_drag_and_drop(s,e,i){const r={exts:null,buffer:!1,file:!0,directory:!1,recursive:!0,stopPropagation:!0,preventDefault:!0,finish:()=>{}};e&&Object.assign(r,e);async function o(d){r.stopPropagation&&d.stopPropagation(),r.preventDefault&&d.preventDefault(),this.classList.remove("dragover"),C$2.modal_processing("Processing","");const u='<progress id="__progress_bar_component__" max="1" value="0" style="width:100%;margin:0px;padding:0px;height:4px"></progress>';function f(M,S){C$2.modal_processing_update_description(M.replace('value="0"',`value="${S}"`))}let m=0,h=0;function _(){const M=this.item,S=this.file,D=this.direct;return new Promise(async(k,O)=>{if(D)try{const L=await fetch(M).then(P=>P.arrayBuffer());k(L)}catch(L){O(L)}else{const L=new FileReader;L.onload=async function(P){const N=P.target.result;k(N)},L.onerror=async function(P){O(P)},L.readAsArrayBuffer(S)}})}const b=d.dataTransfer.getData("json"),v=d.dataTransfer.types.includes("Files"),w=d.dataTransfer.types.includes("json");let y=[];if(w&&b?.length>0){const M=JSON.parse(b),S=[];if(console.log(M),M.items.length>0)for(const D of M.items)console.log(D),await i({type:"json",item:D});y=y.concat(S),C$2.close_modal_processing(),r.finish?.()}else if(v){if(navigator.userAgent.toLowerCase().indexOf("electron")!==-1&&r.recursive==!1&&r.directory==!0){if(d.dataTransfer.files.length==0){C$2.close_modal_processing(),r.finish?.();return}if(window.nodejs.fs.statSync(d.dataTransfer.files[0].path).isDirectory()){await i({type:"directory",file:d.dataTransfer.files[0],direct:!0,item:d.dataTransfer.files[0].path}),C$2.close_modal_processing(),r.finish?.();return}}if(d.dataTransfer.items){let k=function(L,P,N,z,K){if(P=P||"",K.counter++,L.isFile)L.file(function(Z){N(P+Z.name,Z),K.counter--,K.counter==0&&K.finish()});else if(L.isDirectory)if(z(P+L.name,L),!r.recursive)K.counter--,K.counter==0&&K.finish();else{let V=function(){K.counter++,Z.readEntries(function(H){if(H?.length>0){for(let Y=0;Y<H.length;Y++)k(H[Y],P+L.name+"/",N,z,K);V()}K.counter--,console.log(K),K.counter==0&&K.finish()})};const Z=L.createReader();V()}},O=function(L,P,N){return new Promise((z,K)=>{m=0,h=L.length;for(let Z=0;Z<L.length;Z++){const V=L[Z].webkitGetAsEntry();V?k(V,null,async(H,Y)=>{N.push({file:Y,file_path:H})},async(H,Y)=>{P.push({dir:H,item:Y})},{counter:0,finish:()=>{m++,m==h&&z()}}):(m++,m==h&&z())}})};if(d.dataTransfer.items.length==0){C$2.close_modal_processing(),r.finish?.();return}const M=d.dataTransfer.items,S=[],D=[];if(await O(M,S,D),h=D.length,m=0,r.file)for(let L=0;L<D.length;L++){const P=D[L];let N=P.file.path||P.file_path;const z={type:"file",file:P.file,direct:window.nodejs&&!window.external_io,item:N,arrayBuffer:_};r.buffer?(z.buffer=await z.arrayBuffer(),await i(z)):await i(z),f(`${u}<br>${m+1}/${h} <br> ${C$2.DPath(N||P.file_path).basename}`,(m+1)/h),m++}if(r.directory)for(let L=0;L<S.length;L++){const P=S[L],N=P.item;await i({type:"directory",file:P.item.fullpath,direct:window.nodejs&&!window.external_io,item:N}),f(`${u}<br>${m+1}/${h} <br> ${C$2.DPath(N).basename}`,(m+1)/h),m++}}else{h=d.dataTransfer.files.length,console.log(h);for(let M=0;M<h;M++){const S=d.dataTransfer.files[M].path,D={type:"file",file:d.dataTransfer.files[M],item:S,direct:!0,arrayBuffer:_};r.buffer&&(D.buffer=await D.arrayBuffer()),await i(D),f(`${u}<br>${m+1}/${h} <br> ${C$2.DPath(S).basename}`,(m+1)/h),m++}}C$2.close_modal_processing(),r.finish()}else C$2.close_modal_processing(),r.finish()}async function l(d){if(d.dataTransfer?.items){for(let u=0;u<d.dataTransfer.items;u++){const f=d.dataTransfer.items[u].type.split("/").pop();if(exts.includes(f))return!0}return!1}}async function a(d){r.exts&&r.exts.length>0?await l(d)&&this.classList.add("dragover"):this.classList.add("dragover"),d.stopPropagation(),d.preventDefault()}function c(d){this.classList.remove("dragover"),d.stopPropagation(),d.preventDefault()}s.ondrop=o,s.ondragover=a,s.ondragleave=c,s.ondragexit=c}const UC$1={make_property_manager,make_drag_and_drop,make_browser_window,make_hybrid_window,get_dropped_items,open_script_editor:open_script_editor$1,traverse_file_tree,make_toggle_window,make_search_box,make_key_value2,make_pulldown,make_key_value_with_slider,make_separator,make_toggle_holder,make_toggle,make_button,make_script,make_float_box,make_color_picker,make_vec3_box,make_window};class IndexedDBDriver{constructor(){this.file_mapper=new Map,this.debug=window.debug}b;async initialize(e={}){const r="indebxeddbio@"+new URL(location.href).pathname,o={name:"__ddd__",prefix:"__default__"};e&&Object.assign(o,e);const l=`${o.prefix}__fs1__`,a=`${o.prefix}__fs2__`,c=SiteStorage.initialize(r+"@"+o.name,[{name:l,type:"object"},{name:a,type:"object"}],20240129,{migration:"recreate"});this.fs_info=c[l],this.fs_data=c[a];const d=await this.fs_info.all();for(const u of d)this.file_mapper.set(u.key,u.value);await this._build_file_("/")}async clear(){await this.fs_info.clear(),await this.fs_data.clear(),this.file_mapper.clear()}async _build_file_(e,i=null){e=this._resolve_path_(e);const r=e,o={is_directory:i==null,file_path:e,date:Date.now(),buffer:null,__tmp_children__:[]},l=JSON.parse(JSON.stringify(o)),a=JSON.parse(JSON.stringify(o));a.buffer=i?new WeakRef(i):null,await this.fs_info.set(r,l),i&&await this.fs_data.set(r,i),this.file_mapper.set(r,a),this.debug&&console.info("MK:",e)}async size(e,i){return e=this._resolve_path_(e),this.debug&&console.log("size",e),(await this.fs_data.get(e))?.length}async all(e){const i={file:!0,directory:!0,data:!0};e&&Object.assign(i,e);const r=[];for(const[o,l]of this.file_mapper)l.is_directory&&i.directory?r.push(l):l.is_directory!=!0&&i.file&&(i.data&&(l.buffer=await this.fs_data.get(o)),r.push(l));return r}async list(e,i=!1){if(e=this._resolve_path_(e),this.debug&&console.log(`list: "${e}"`),!await this.exists(e))return[];await this._rebuild_tree_();const r=this.file_mapper.get(e);function o(l,a=[]){for(const c of l.__tmp_children__)a.push(c),o(c,a)}if(i){if(r.is_directory){let l=[];return o(r,l),l}}else if(r.is_directory){let l=[];for(const a of r.__tmp_children__)l.push(a);return l}return r.is_directory?[]:[r]}async copy(e,i){throw new Error("Not implemented yet.")}async move(e,i){throw new Error("Not implemented yet.")}async remove(e,i=!1){if(e=this._resolve_path_(e),!await this.exists(e))throw new Error("Does not exist. "+e);if(i)await this.rmdir(e,!0);else{if(this._is_dir_(e))throw new Error(`${e} is a directory.`);await this.fs_info.delete(e),await this.fs_data.delete(e),this.file_mapper.delete(e)}}async rmdir(e,i=!1){if(e=this._resolve_path_(e),!await this.exists(e))throw new Error("Does not exist. "+e);if(!this._is_dir_(e))throw new Error(`${e} is a file.`);const r=[];for(const[o,l]of this.file_mapper)o.indexOf(e)===0&&r.push(o);for(const o of r)await this.fs_info.delete(o),await this.fs_data.delete(o),this.file_mapper.delete(o)}async mkdir(e,i=!0){if(e=this._resolve_path_(e),await this.exists(e)){if(i)return;throw new Error("Already exists."+e)}await this._build_file_(e)}async read(e,i){const r={cache:!0};if(i&&Object.assign(r,i),e=this._resolve_path_(e),r.cache){const d=this.file_mapper.get(e)?.buffer?.deref();if(d)return d}if(e==null)throw new TypeError("File path was null object.");if(!await this.exists(e))throw console.warn("Does not exist. "+e),new Error("Does not exist. "+e);if(this._is_dir_(e))throw console.warn(`${e} is a directory.`),new Error(`${e} is a directory.`);const o=await this.fs_info.get(e),l=await this.fs_data.get(e),a=C$2.to_uint8array(l);return o.buffer=new WeakRef(a),this.file_mapper.set(e,o),a}async write(e,i){e=this._resolve_path_(e);const r=C$2.to_uint8array(i);await this._build_file_(e,r)}_is_dir_(e){return e=this._resolve_path_(e),e==="/"?!0:this.file_mapper.get(e)?.is_directory}async _is_file_(e){e=this._resolve_path_(e);const i=this.file_mapper.get(e);return i?i.is_directory===!1:!1}async exists(e){return e=this._resolve_path_(e),e=="/"?!0:(e[e.length-1]==="/"&&(e=e.slice(0,e.length-1)),this.file_mapper.has(e))}_resolve_path_(e){for(;e.indexOf("//")>=0;)e=e.replace(/\/\//g,"/");let i="http://a.a";e[0]!=="/"&&(i+="/");let r=null;try{r=decodeURI(new URL(encodeURI(i+e)).pathname)}catch(o){throw console.error(i,e),console.error(o),o}return r.length>1&&r[r.length-1]==="/"&&(r=r.slice(0,r.length-1)),r[0]=="/"&&(r=r.slice(1,r.length)),r}async _rebuild_tree_(){const e=this,i=this.file_mapper,r=[];i.forEach((o,l,a)=>{if(o.__tmp_children__=[],!(l==="/"||l.length===0)){const c=this._resolve_path_(l+"/../");i.has(c)==!1&&r.push(c)}});for(const o of r)await this._build_file_(o);for(const[o,l]of i)if(!(o==="/"||o.length===0)){const a=this._resolve_path_(o+"/../");i.has(a)||await e._build_file_(a),i.get(a).__tmp_children__.push(l)}}}async function create_indexeddb_io(s={}){let e={};return Object.assign(e,s),new Promise(async(i,r)=>{const o=new IndexedDBDriver;await o.initialize(e),i({driver:"indexeddb",async resolve(a){return a},async all(a={}){return await o.all(a)},async list(a,c={}){const d={recursive:!1,callback:null};Object.assign(d,c);const u=await o.list(a,d.recursive),f=[];for(const m of u){const h=await o._resolve_path_(a),_=C$2.DPath(m.file_path),b=m.file_path.slice(h.length,m.file_path.length),v=m.file_path;let w={id:m.file_path,protocol:"indexeddb",prefix:"",basename:_.basename,relative_path:b,absolute_path:v,ext:_.ext,is_file:!m.is_directory,is_directory:m.is_directory,date:m.date,date_promise:null};f.push(w)}return f},async put(a,c){return await o.write(a,c)},async copy(a,c){return await o.copy(a,c)},async move(a,c){return await o.move(a,c)},async exists(a){return await o.exists(a)},async mkdir(a,c=!1){return await o.mkdir(a,c)},async get(a,c){return await o.read(a,c)},async size(a,c){return await o.size(a,c)},async remove(a,c=!1){return await o.remove(a,c)},async clear(){return await o.clear()}})})}const debug$7=window.debug;function resolve_url$1(s){return s}async function create_http_io(s={}){s&&Object.assign({},s);const i=new IndexedDBDriver;await i.initialize({name:"__ddd-http.io__",prefix:"__default__"});const r="__ddd-http.io-fs-key__@"+new URL(location.href).pathname,l=SiteStorage.initialize(r,["fsinfo"],20240129,{migration:"recreate"}).fsinfo,a=new Map;return{driver:"http",async resolve(c){return console.log(c),c},async list(c,d){return[]},async exists(c){if(c.indexOf("data:image")==0)return!0;c=c;try{const d=await fetch(c,{method:"HEAD",mode:"cors"});if(d.ok||d.status==302||d.status==304)return!0;console.warn('This is not an error. You can ignore "net::ERR_ABORTED 404 (Not Found)"')}catch(d){console.error(d)}return!1},async copy(c,d){throw new Error("http.io: does not support copy.")},async move(c,d){throw new Error("http.io: does not support move.")},async put(c,d){throw new Error("http.io: does not support put.")},async get(c){if(window.is_data_url(c))return c;if(c=c,a.has(c)){const f=a.get(c);for(;f.data===void 0;)await new Promise(m=>setTimeout(m,100));return debug$7&&console.log("HTTP-I/O-Transaction hit:",c),f.data}const d={data:void 0};a.set(c,d);const u=!0;try{let f,m,h;if(u&&(h=await fetch(c,{method:"HEAD",mode:"cors"}),!(h.ok||h.status==302||h.status==304)))throw new Error(`HTTP-I/O status[${h.status}] "${c}"`);const _=async()=>{const b=await fetch(c,{method:"get",mode:"cors"}).then(async v=>{if(f=v.status,h.ok||h.status==302||h.status==304){const w=v.headers.get("x-file-size")||v.headers.get("content-length"),y=await v.arrayBuffer();return w?y.slice(0,Number(w)):y}return console.error(v),null});if(b==null)throw new Error(`HTTP-I/O status[${f}] "${c}"`);return b};if(u){const b=h.headers.get("ETag");if(b){const v=await C$2.any_hash(c),w=JSON.parse(await l.get(v,"{}"));return w.etag!=b?(m=await _(),await i.write(v,m),w.etag=b,await l.set(v,JSON.stringify(w)),d.data=m,m):(debug$7&&console.log("HTTP-I/O-Cache hit:",c),m=await i.read(v),d.data=m,m)}}return m=await _(),m}finally{a.delete(c)}return null},async mkdir(c){throw new Error("http.io: does not support mkdir.")},async remove(c){throw new Error("http.io: does not support remove.")}}}function UUID(){return crypto.randomUUID().replace(/-/g,"")}const debug$6=window.debug;class WebSocketFSDriver{event_listener=e=>{};async initialize(e){if(typeof e.url!="string")throw new Error("url is required");if(e.url=="")throw new Error("url is required");return new Promise((i,r)=>{this.ws=new WebSocket(e.url),this.response_table=new Map,this.watcher_table=new Map,this.is_connected=!1,this.first_initialize=!0,this.ws.onopen=async()=>{console.log("WS:Open");const o=await this.send("initialize");console.log("WS:Opened:",o),this.is_connected=!0,this.first_initialize=!1,i(),this.event_listener("open")},this.ws.onmessage=o=>{try{const l=typeof o.data=="string"?o.data:o.data.text(),a=JSON.parse(l);if(a.action==="initialize"&&a.request_id==null)return;const c=this.response_table.get(a.request_id);if(c)c(a.result);else if(console.log("callback not found",a.request_id,a.action,a),a.action=="watch"){const d=this.watcher_table.get(a.file_path);a.file_event=="close"?this.watcher_table.delete(a.file_path):(console.log(d,a.file_path,a.file_event),d&&d(a.file_path,a.file_event))}else console.error("callback not found",a.request_id,a.action,a);this.response_table.delete(a.request_id)}catch(l){console.error(l)}},this.ws.onclose=()=>{console.log("WS:Closed"),this.is_connected=!1,this.first_initialize&&r("WS:Closed"),this.event_listener("close")},this.ws.onerror=o=>{this.is_connected=!1,console.log("WS:Error"+o),this.first_initialize&&r("WS:Error"),this.event_listener(o)}})}send(e,i=void 0,r=void 0,o=void 0){const l=UUID();return new Promise((a,c)=>{this.response_table.set(l,a),this.ws.send(JSON.stringify({action:e,request_id:l,params:[i,r,o].filter(d=>d!==void 0)}))})}async close(){this.ws.close()}}async function create_websocketfs_io(s={}){const e={event_listener:i=>{}};return s&&Object.assign(e,s),new Promise(async(i,r)=>{try{const o=new WebSocketFSDriver;o.event_listener=e.event_listener,await o.initialize(e),i({driver:"websocketfs",async resolve(a){return a},async all(a={}){return await o.send("all",a)},async list(a,c={}){if(typeof a!="string")debugger;const d=performance.now(),u={recursive:!1,callback:null};Object.assign(u,c);const f=await o.send("list",a,u),m=[];for(const h of f){const _=a,b=C.DPath(h.file_path),v=h.file_path.slice(_.length,h.file_path.length),w=h.file_path,y={id:h.file_path,protocol:"websocketfs",prefix:"",basename:b.basename,relative_path:v,absolute_path:w,ext:b.ext,is_file:!h.is_directory,is_directory:h.is_directory,date:h.date,date_promise:null};m.push(y)}return debug$6&&console.log("list",a,performance.now()-d),m},async put(a,c){const d=performance.now(),u=new Uint8Array(c);let f="";for(let _=0,b=u.byteLength;_<b;++_)f+=String.fromCharCode(u[_]);const m=window.btoa(f),h=await o.send("write",a,m);return debug$6&&console.log("put",a,performance.now()-d),h},async copy(a,c){const d=performance.now(),u=await o.send("copy",a,c);return debug$6&&console.log("copy",a,c,performance.now()-d),u},async move(a,c){const d=performance.now(),u=await o.send("move",a,c);return debug$6&&console.log("move",a,c,performance.now()-d),u},async exists(a){const c=performance.now(),d=await o.send("exists",a);return debug$6&&console.log("exists",a,performance.now()-c),d},async mkdir(a,c=!1){const d=performance.now(),u=await o.send("mkdir",a,c);return debug$6&&console.log("mkdir",a,performance.now()-d),u},async get(a,c){const d=performance.now(),u=await o.send("read",a,c);if(u==null)throw new Error("File not found:"+a);const f=atob(u),m=new Uint8Array(f.length);for(let h=0,_=f.length;h<_;++h)m[h]=f.charCodeAt(h);return debug$6&&console.log("get",a,Math.round((performance.now()-d)*1e3)/1e3,"ms"),m},async size(a,c){const d=performance.now(),u=await o.send("size",a,c);return debug$6&&console.log("size",a,performance.now()-d),u},async remove(a,c=!1){const d=performance.now(),u=await o.send("remove",a,c);return debug$6&&console.log("remove",a,performance.now()-d),u},async clear(){const a=performance.now(),c=await o.send("clear");return debug$6&&console.log("clear",performance.now()-a),c},async close(){const a=performance.now(),c=await o.close();return debug$6&&console.log("close",performance.now()-a),c},async open_in_app(a,c){const d=performance.now(),u=await o.send("open_in_app",a,c);return debug$6&&console.log("open_in_app",a,performance.now()-d),u},async open_folder(a,c){const d=performance.now(),u=await o.send("open_folder",a,c);return debug$6&&console.log("open_folder",a,performance.now()-d),u},async watch(a,c){o.watcher_table.set(a,c);const d=await o.send("watch",a);return console.log(d),{close:async()=>(o.watcher_table.delete(a),await o.send("unwatch",a))}}})}catch(o){r(o)}})}class WebSocketDriver{event_listener=e=>{};async initialize(e){if(typeof e.url!="string")throw new Error("url is required");if(e.url=="")throw new Error("url is required");return new Promise((i,r)=>{{const o=location.protocol=="https:"?"wss":"ws",l=location.host,a=location.pathname,c=`${o}://${l}${a.lastIndexOf("/")===a.length-1?a:a.slice(0,a.lastIndexOf("/"))}/ws`;console.log(c),this.ws=new WebSocket(c,["permessage-deflate"]),this.ws.binaryType="arraybuffer",this.ws.perMessageDeflate={threshold:1024,clientNoContextTakeover:!0,serverNoContextTakeover:!0,clientMaxWindowBits:15,serverMaxWindowBits:15}}this.ws_req_index=0,this.response_table=new Map,this.watcher_table=new Map,this.is_connected=!1,this.first_initialize=!0,this.ws.onopen=async()=>{console.log("WS:Open"),this.is_connected=!0,this.first_initialize=!1,i(),this.event_listener("open")},this.ws.onmessage=o=>{try{if(o.data instanceof ArrayBuffer){const l=o.data,a=new DataView(l),c=[a.getUint8(0),a.getUint8(1),a.getUint8(2)];if(!(c[0]===100&&c[1]===100&&c[2]===100))return console.log("Prefix does not match 'ddd'"),this.ws.close();const u=a.getUint32(3),f=a.getUint8(7),m=a.getInt32(8);let h=12;const _=this.response_table.get(u);if(_)if(f==1)if(m==0){let b=0;for(const w of _.data_chunks)b+=w.length;_.result=new Uint8Array(b);let v=0;for(const w of _.data_chunks)_.result.set(w,v),v+=w.length;_.resolve(_.result),this.response_table.delete(u)}else{const b=new Uint8Array(l,h,m);_.data_chunks.push(b)}else if(f==3){const b=new TextDecoder().decode(new Uint8Array(l,h,m)),v=JSON.parse(b);_.resolve(v),this.response_table.delete(u)}else return console.error("Invalid action:",f),this.ws.close();else console.error("callback not found",u,f),this.response_table.delete(u)}}catch(l){console.error(l)}},this.ws.onclose=()=>{console.log("WS:Closed"),this.is_connected=!1,this.first_initialize&&r("WS:Closed"),this.event_listener("close")},this.ws.onerror=o=>{this.is_connected=!1,console.log("WS:Error"+o),this.first_initialize&&r("WS:Error"),this.event_listener(o)}})}send(e,i=void 0,r=void 0,o=void 0){const l=this.ws_req_index++;return new Promise((a,c)=>{if(this.response_table.set(l,{resolve:a,result:void 0,data_chunks:[]}),e=="read"||e=="stat"){const d=new TextEncoder().encode(i),u=new ArrayBuffer(12+d.length),f=new DataView(u);f.setUint8(0,100),f.setUint8(1,100),f.setUint8(2,100),f.setUint32(3,l);let m=0;switch(e){case"read":m=1;break;case"stat":m=3;break}f.setUint8(7,m),f.setUint32(8,d.length),new Uint8Array(u,12).set(d),this.ws.send(u)}})}async close(){this.ws.close()}}function resolve_url(s){return s}async function create_websocket_io(s={}){const e={};s&&Object.assign(e,s);const i=new WebSocketDriver;await i.initialize({url:e.url});const r=new IndexedDBDriver;await r.initialize({name:"__ddd-websocket.io__",prefix:"__default__"});const o="__ddd-websocket.io-fs-key__@"+new URL(location.href).pathname,a=SiteStorage.initialize(o,["fsinfo"],20240129,{migration:"recreate"}).fsinfo,c=new Map;return{driver:"websocket",async resolve(d){return console.log(d),d},async list(d,u){return[]},async exists(d){if(d.indexOf("data:image")==0)return!0;d=d;try{const u=await i.send("stat",d);if(u)return u.exists}catch(u){console.error(u)}return!1},async copy(d,u){throw new Error("websocket.io: does not support copy.")},async move(d,u){throw new Error("websocket.io: does not support move.")},async put(d,u){throw new Error("websocket.io: does not support put.")},async get(d){if(window.is_data_url(d))return d;if(d=d,c.has(d)){const m=c.get(d);for(;m.data===void 0;)await new Promise(h=>setTimeout(h,100));return console.log("Transaction hit:",d),m.data}const u={data:void 0};c.set(d,u);const f=!0;try{let m;if(f){const h=await i.send("stat",d);if(!h.exists)return null;const _=h.etag,b=await C$2.any_hash(d),v=JSON.parse(await a.get(b,"{}"));v.etag!=_?(m=await i.send("read",d),await r.write(b,m),v.etag=_,await a.set(b,JSON.stringify(v))):m=await r.read(b)}return u.data=m,m}finally{c.delete(d)}return null},async mkdir(d){throw new Error("websocket.io: does not support mkdir.")},async remove(d){throw new Error("websocket.io: does not support remove.")}}}async function create_io(s,e){if(window.debug&&console.log("Driver:create_io:",s,e.purpose),s=="http")return create_http_io(e);if(s=="indexeddb")return create_indexeddb_io(e);if(s=="websocketfs")return create_websocketfs_io(e);if(s=="websocket")return create_websocket_io(e);if(s=="aws_s3"){const{create_s3_io:i}=await __vitePreload(()=>import("./aws_s3.io@CXDumuqD.js"),[],import.meta.url);return i(e)}else if(s=="local"){const{create_disk_io:i}=await __vitePreload(()=>import("./local.io@D8K0uS0N.js"),[],import.meta.url);return i(e)}else if(s=="webdav"){const{create_webdav_io:i}=await __vitePreload(()=>import("./webdav.io@pZn3n59n.js"),[],import.meta.url);return i(e)}else if(s=="memory"){const{create_memfs_io:i}=await __vitePreload(()=>import("./memfs.io@Ca_VUbMH.js"),[],import.meta.url);return i(e)}else if(s=="custom")return null}var LZString=function(){function s(a,c){if(!o[a]){o[a]={};for(var d=0;d<a.length;d++)o[a][a.charAt(d)]=d}return o[a][c]}var e=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={},l={compressToBase64:function(a){if(a==null)return"";var c=l._compress(a,6,function(d){return i.charAt(d)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(a){return a==null?"":a==""?null:l._decompress(a.length,32,function(c){return s(i,a.charAt(c))})},compressToUTF16:function(a){return a==null?"":l._compress(a,15,function(c){return e(c+32)})+" "},decompressFromUTF16:function(a){return a==null?"":a==""?null:l._decompress(a.length,16384,function(c){return a.charCodeAt(c)-32})},compressToUint8Array:function(a){for(var c=l.compress(a),d=new Uint8Array(2*c.length),u=0,f=c.length;f>u;u++){var m=c.charCodeAt(u);d[2*u]=m>>>8,d[2*u+1]=m%256}return d},decompressFromUint8Array:function(a){if(a==null)return l.decompress(a);for(var c=new Array(a.length/2),d=0,u=c.length;u>d;d++)c[d]=256*a[2*d]+a[2*d+1];var f=[];return c.forEach(function(m){f.push(e(m))}),l.decompress(f.join(""))},compressToEncodedURIComponent:function(a){return a==null?"":l._compress(a,6,function(c){return r.charAt(c)})},decompressFromEncodedURIComponent:function(a){return a==null?"":a==""?null:(a=a.replace(/ /g,"+"),l._decompress(a.length,32,function(c){return s(r,a.charAt(c))}))},compress:function(a){return l._compress(a,16,function(c){return e(c)})},_compress:function(a,c,d){if(a==null)return"";var u,f,m,h={},_={},b="",v="",w="",y=2,M=3,S=2,D=[],k=0,O=0;for(m=0;m<a.length;m+=1)if(b=a.charAt(m),Object.prototype.hasOwnProperty.call(h,b)||(h[b]=M++,_[b]=!0),v=w+b,Object.prototype.hasOwnProperty.call(h,v))w=v;else{if(Object.prototype.hasOwnProperty.call(_,w)){if(w.charCodeAt(0)<256){for(u=0;S>u;u++)k<<=1,O==c-1?(O=0,D.push(d(k)),k=0):O++;for(f=w.charCodeAt(0),u=0;8>u;u++)k=k<<1|1&f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f>>=1}else{for(f=1,u=0;S>u;u++)k=k<<1|f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f=0;for(f=w.charCodeAt(0),u=0;16>u;u++)k=k<<1|1&f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f>>=1}y--,y==0&&(y=Math.pow(2,S),S++),delete _[w]}else for(f=h[w],u=0;S>u;u++)k=k<<1|1&f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f>>=1;y--,y==0&&(y=Math.pow(2,S),S++),h[v]=M++,w=String(b)}if(w!==""){if(Object.prototype.hasOwnProperty.call(_,w)){if(w.charCodeAt(0)<256){for(u=0;S>u;u++)k<<=1,O==c-1?(O=0,D.push(d(k)),k=0):O++;for(f=w.charCodeAt(0),u=0;8>u;u++)k=k<<1|1&f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f>>=1}else{for(f=1,u=0;S>u;u++)k=k<<1|f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f=0;for(f=w.charCodeAt(0),u=0;16>u;u++)k=k<<1|1&f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f>>=1}y--,y==0&&(y=Math.pow(2,S),S++),delete _[w]}else for(f=h[w],u=0;S>u;u++)k=k<<1|1&f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f>>=1;y--,y==0&&(y=Math.pow(2,S),S++)}for(f=2,u=0;S>u;u++)k=k<<1|1&f,O==c-1?(O=0,D.push(d(k)),k=0):O++,f>>=1;for(;;){if(k<<=1,O==c-1){D.push(d(k));break}O++}return D.join("")},decompress:function(a){return a==null?"":a==""?null:l._decompress(a.length,32768,function(c){return a.charCodeAt(c)})},_decompress:function(a,c,d){var u,f,m,h,_,b,v,w=[],y=4,M=4,S=3,D="",k=[],O={val:d(0),position:c,index:1};for(u=0;3>u;u+=1)w[u]=u;for(m=0,_=Math.pow(2,2),b=1;b!=_;)h=O.val&O.position,O.position>>=1,O.position==0&&(O.position=c,O.val=d(O.index++)),m|=(h>0?1:0)*b,b<<=1;switch(m){case 0:for(m=0,_=Math.pow(2,8),b=1;b!=_;)h=O.val&O.position,O.position>>=1,O.position==0&&(O.position=c,O.val=d(O.index++)),m|=(h>0?1:0)*b,b<<=1;v=e(m);break;case 1:for(m=0,_=Math.pow(2,16),b=1;b!=_;)h=O.val&O.position,O.position>>=1,O.position==0&&(O.position=c,O.val=d(O.index++)),m|=(h>0?1:0)*b,b<<=1;v=e(m);break;case 2:return""}for(w[3]=v,f=v,k.push(v);;){if(O.index>a)return"";for(m=0,_=Math.pow(2,S),b=1;b!=_;)h=O.val&O.position,O.position>>=1,O.position==0&&(O.position=c,O.val=d(O.index++)),m|=(h>0?1:0)*b,b<<=1;switch(v=m){case 0:for(m=0,_=Math.pow(2,8),b=1;b!=_;)h=O.val&O.position,O.position>>=1,O.position==0&&(O.position=c,O.val=d(O.index++)),m|=(h>0?1:0)*b,b<<=1;w[M++]=e(m),v=M-1,y--;break;case 1:for(m=0,_=Math.pow(2,16),b=1;b!=_;)h=O.val&O.position,O.position>>=1,O.position==0&&(O.position=c,O.val=d(O.index++)),m|=(h>0?1:0)*b,b<<=1;w[M++]=e(m),v=M-1,y--;break;case 2:return k.join("")}if(y==0&&(y=Math.pow(2,S),S++),w[v])D=w[v];else{if(v!==M)return null;D=f+f.charAt(0)}k.push(D),w[M++]=f+D.charAt(0),y--,f=D,y==0&&(y=Math.pow(2,S),S++)}}};return l}();typeof define=="function"&&define.amd?define(function(){return LZString}):typeof module<"u"&&module!=null&&(module.exports=LZString);async function reset_io_config(){await __storage__.system.delete("external_storage");const s=document.getElementById("external_storage");s instanceof HTMLSelectElement&&(s.value="native"),window.select_external_storage("native")}async function get_current_io_config(){await __storage__.system.get("external_storage",JSON.stringify({current_driver:"native",drivers:{}}));const s={async createWindowSession(){const e=await s.getCurrentDriver();e.window_sessions==null&&(e.window_sessions={});const i=crypto.randomUUID().replace(/-/g,""),r={id:i};return e.window_sessions[i]=r,e.store(),r},async getWindowSessions(){const e=await s.getCurrentDriver();return e.window_sessions==null&&(e.window_sessions={}),{put(i){e.window_sessions[i.id]=i,e.store()},store:e.store,sessions:e.window_sessions}},async getWindowSession(e){const i=await s.getCurrentDriver(),r=i.window_sessions[e];return r&&(r.store=function(){i.store()}),r},async removeWindowSession(e){if(e==null)return;const i=await s.getWindowSessions();for(const r in i.sessions)typeof e=="string"?e==r&&(console.warn("Deleted:",r),delete i.sessions[r]):e.id==r&&(console.warn("Deleted:",r),delete i.sessions[r]);i.store()},async setCurrentDriverName(e){try{const i=JSON.parse(await __storage__.system.get("external_storage"));i.current_driver=e,await __storage__.system.set("external_storage",JSON.stringify(i))}catch(i){console.error(i)}},async getCurrentDriver(){try{const e=await s.getRaw();e.drivers[e.current_driver]==null&&(e.drivers[e.current_driver]={});const i=e.drivers[e.current_driver];return i.store=async function(){await s.setRawFromJObject(e)},i}catch(e){await __storage__.system.delete("external_storage"),console.error(e)}return null},async getRaw(){try{const e=JSON.parse(await __storage__.system.get("external_storage"));e.store=async()=>{for(const i in e.drivers){const r=e.drivers[i];delete r.confidential;const o=LZString.compress(JSON.stringify(r));e.drivers[i]={confidential:o}}await __storage__.system.set("external_storage",JSON.stringify(e))};for(let i in e.drivers){const r=e.drivers[i]?.confidential;e.drivers[i]=r?JSON.parse(LZString.decompress(r)):{},delete e.drivers[i].confidential}return e}catch(e){await __storage__.system.delete("external_storage"),console.error(e)}return null},async setRawFromJObject(e){for(let i in e.drivers){const r=LZString.compress(JSON.stringify(e.drivers[i]));e.drivers[i]={confidential:r}}await __storage__.system.set("external_storage",JSON.stringify(e))}};return s}async function activate_external_storage(s){const e=DMC;if(!window.app_mode){C.modal_processing("Verifying...","");{const i=document.getElementById(s+"_panel").querySelectorAll("input"),r=document.getElementById(s+"_panel").querySelectorAll("select"),o=[];for(let a=0;a<i.length;a++)o.push(i[a]);for(let a=0;a<r.length;a++)o.push(r[a]);const l={purpose:"activate_external_storage"};for(let a=0;a<o.length;a++){const c=o[a];c.dataset.type!=null&&(c.type=="checkbox"?l[c.id.slice(s.length+1)]=c.checked:l[c.id.slice(s.length+1)]=c.value)}try{if(window.external_io=await ExternalIO.create_io(s,l),await C.sleep(1e3),C.close_modal_processing(),window.external_io||s=="native")C.modal_ok_cancel("Activated","Application will be relaunched.",{cancel:null},async a=>{window.nodejs&&await window.nodejs.ipcRenderer.invoke("close_asset_browser"),e.reset()});else{await ExternalIO.reset_io_config(),C.modal_ok("Error","Failed to activate.");return}console.log(window.external_io)}catch(a){if(console.error(a),C.close_modal_processing(),a=="Canceled")return;await ExternalIO.reset_io_config(),C.modal_ok("Error",a.toString());return}}{const i=document.getElementById(s+"_panel").querySelectorAll("input"),r=document.getElementById(s+"_panel").querySelectorAll("select"),o=[];for(let d=0;d<i.length;d++)o.push(i[d]);for(let d=0;d<r.length;d++)o.push(r[d]);const l={};for(let d=0;d<o.length;d++){const u=o[d];u.type=="checkbox"?l[u.id.slice(s.length+1)]=u.checked:l[u.id.slice(s.length+1)]=u.value}const a=await ExternalIO.get_current_io_config();await a.setCurrentDriverName(s);const c=await a.getCurrentDriver();Object.assign(c,l),await c.store()}}}function reset_external_storage(){const s=DMC;C.modal_ok_cancel(window.T("g.confirmation"),"The external storage settings will be cleared.<br>Application will be relaunched also when you confirmed.",{},e=>{e&&__storage__.system.delete("external_storage").finally(()=>{s.reload()})})}const ExternalIO$1={create_io,reset_io_config,get_current_io_config,activate_external_storage,reset_external_storage};var define_process_env_default$1={};const ICON_BASE_URL$1="./ddd/system_assets/icons/";function navi_menu_toggle(s){navi_unfocus(),document.querySelectorAll(".top_menu_dropdown").forEach(i=>{i.classList.add("top_menu_dropdown_auto")})}function navi_unfocus(){document.querySelectorAll(".top_menu_dropdown").forEach(e=>{e.classList.remove("top_menu_dropdown_auto")})}window.onclick=function(s){s.target.matches(".top_menu_dropbtn")||navi_unfocus()};window.addEventListener("blur",()=>{navi_unfocus()});document.addEventListener("keydown",function(s){s.code=="Escape"&&navi_unfocus()});function _a(){return new Promise(s=>{const e=document.createElement("div");e.style.cssText="display:flex;justify-content: center;align-items: center; z-index: 1000;width:100%;height:100%;position: fixed;left:0px;top:0px;background-color: #333;";const i=document.createElement("input");i.type="password",i.style.cssText="border:1px solid #444;border-radius:3px;padding:0px;padding-left:10px;height:25px",i.placeholder="Password",e.appendChild(i);const r=document.createElement("button");r.style.cssText="border-radius:3px;padding-left:10px;padding-right:10px;margin-left:10px;height:25px",r.innerText="Unlock",r.onclick=function(){const o=i.value;e.remove(),s(o)},e.appendChild(r),document.body.appendChild(e),setTimeout(()=>{i.focus()},1e3),i.onkeyup=function(o){if(o.key==="Enter"){const l=i.value;e.remove(),s(l)}}})}async function open_about_window(){C$2.modal_processing("Fetching....");const s=fetch("./ddd/system_assets/release_note.txt"),e=fetch(window.nodejs?"./ddd/system_assets/license.electron.txt":"./ddd/system_assets/license.txt"),i=await s.then(h=>h.text()),r=await e.then(h=>h.text()),o=i.slice(0,i.indexOf(" ")),l=document.createElement("div");l.style.cssText="margin-top:0px;margin-bottom:20px",l.innerText=`Version: ${o}`;const a=document.createElement("div");a.style.cssText="text-align:center",l.appendChild(a);const c=document.createElement("h3");c.style.cssText="margin-bottom:5px",c.innerText="Release note",l.appendChild(c);const d=document.createElement("pre");l.appendChild(d),d.style.cssText="border-radius:5px;background:#111;font-size:13px;padding:5px;display:inline-block;text-align:left;width:80%;height:300px;color:white;margin-bottom:20px;overflow:scroll",d.innerText=i;const u=document.createElement("h3");u.style.cssText="margin-bottom:5px",u.innerText="Licenses",l.appendChild(u);const f=document.createElement("pre");l.appendChild(f),f.style.cssText="border-radius:5px;background:#111;font-family: monospace;font-size:13px;padding:5px;display:inline-block;text-align:left;width:80%;height:300px;color:white;margin-bottom:20px;overflow:scroll",f.innerText=r;const m=document.createElement("button");m.style.cssText="clear:both;margin-top:0px;margin-left:10%;padding:5px 10px;border-radius:5px;background:#333;color:white;border:1px solid #444",m.innerText="Copy to clipboard",m.onclick=function(){const h=r;navigator.clipboard.writeText(h).then(function(){m.innerText="Copied",setTimeout(()=>{m.innerText="Copy to clipboard"},1e3)})},l.appendChild(m),l.appendChild(document.createElement("br")),C$2.close_modal_processing(),C$2.modal_ok_cancel(window.T("g.about"),l,{cancel:null})}let event_notify_mutex=0,event_notify_queue=[];setInterval(()=>{event_notify_queue?.length>0&&event_notify_mutex==0&&(event_notify_mutex=1,event_notify(event_notify_queue.shift()))},500);function event_notify(s){if(event_notify_queue.length>0){event_notify_mutex=0;return}const e=document.getElementById("event_notify");e.style.opacity="1",e.innerHTML=s,e.style.zIndex="999",e.style.display="block",setTimeout(()=>{if(event_notify_queue.length>0){event_notify_mutex=0;return}__event_notify__(s)},2500)}function __event_notify__(s,e=1,i=0){if(event_notify_queue.length>0){event_notify_mutex=0;return}setTimeout(()=>{const r=document.getElementById("event_notify");if(event_notify_queue.length>0){event_notify_mutex=0;return}e>.01?__event_notify__(s,e-i,i+.01):(i=0,event_notify_mutex=0,r.style.display="none"),r.style.opacity=e.toString(),r.innerHTML=s},10)}function remove_selected_objects_with_ui(){const s=DMC,e=s.get_selected_objects();if(e.objects.length==0)return;let i=!1;if(e.objects.length>0){const o=e.objects[0].getDDDProperties?.();o&&!o.removable&&(i=!0)}if(i)C$2.modal_ok_cancel("Locked","<div>Contains locked objects.</div>",{cancel:null},r=>{});else{const r=e.objects[0];setTimeout(()=>{C$2.modal_ok_cancel("Remove Object",`<div>Are you sure?</div><div>${r.name}</div>`,{},o=>{if(o){for(const l of e.objects)Builder3D.remove_object(l);s.current.object=null,s.dispatchEvent("change@scene",{update_panel:!1})}})},150)}}async function open_script_editor_for_object(s,e){const i=DMC,r=i.current.object;if(r){const o=r.uuid;if(o){console.log(o);const l=(r.name?.length>0?r.name:null)||r.type+" : "+r.uuid,a={template01:"<span style='float:left'>Template: Basic</span> <span style='float:right;color:#888'></span>"},c=["Scene"];if(r.script.length==0&&!c.includes(r.type)){const u=r.isCamera?`o.setCameraOffset(0,0,0);
//o.enableFunction("random_camera");
//o.functions.random_camera.target = o.find("Char", "Body");`:"",f=r.isCamera?"":`// o.reset();
// o.functions.blink.set({ enable: true });
// o.functions.waver.set({ enable: true, coef: 1.0, head: true });
// o.functions.foot.set({ enable: true, attach: "padding_x", coef: 1.0 });
// o.functions.breath.set({ enable: true, coef: 0.75, offset: -0.4, speed: 1.0 });
// o.functions.eyes_direction.set({ enable: true, type: o.RANDOM, random_angle_coef: 5, tracking_speed: 0.01, dx: 0, dy: 0, dz: 0 });`;r.script=`const o = U.bind(object);
${f}
${u}

o.onflagchange = () => {}
o.onstart = ()=>{}
o.onpause = ()=>{}
o.onstop = ()=>{}
o.onresume = ()=>{}
o.onupdate = (delta) => {

}
`}r.script_mode=r.script_mode??"javascript";async function d(u){const f=await UC$1.open_script_editor(o+"-script",{title:l+"-script",text:u.script,mode:u.script_mode,extra_context_menu:a},async function(m,h){const _=i.getObjectByUUID(o);if(_){let b=!1;const v=_.script.length?_.script.length:0,w=h.length?h.length:0;v!=w&&(b=!0),m=="save"?(_.script=h,await Builder3D.save_project()):m=="mode"?(_.script_mode=h,h=="typescript"&&await __vitePreload(()=>import("./typescript.min@BGAkRfVV.js"),[],import.meta.url),f.close(),setTimeout(()=>{d()},500)):m=="run"?(_.script=h,window.script_runner(_)):m=="template01"&&h.editor.setValue("test"),e&&e(m,h),b&&i.dispatchEvent("change@tree",{update_tree:!0,update_panel:!1})}})}d(r)}}}async function edit_project(){const s=await GetProjectPath();if(s){const e=await window.cross_file_system.read(s),i=await C$2.s_decode_async(e),r=JSON.stringify(i,null,"	");UC$1.open_script_editor(s+"-edit",{title:C$2.DPath(s).name+"-edit",text:r,mode:"json"},async function(o,l){if(o=="save"){const a=await C$2.s_encode_async(JSON.parse(l));await window.cross_file_system.write(s,a)}})}}async function open_project(){const s=DMC;if(window.nodejs){const e=await GetProjectPath();let i=e?C$2.DPath(e).path:null;i=i||await __storage__.editor.get("previous_dialog_path");const r=await window.cross_file_system.open_dialog({defaultPath:i||define_process_env_default$1.HOME||define_process_env_default$1.USERPROFILE,filters:[{name:"DDD",extensions:["ddd","mmd"]}]});if(r){let o=r[0];o&&(o=o.replace(/\\/g,"/"),await SetProjectPath(o),await __storage__.editor.set("previous_dialog_path",C$2.DPath(o).dirname),s.reload())}}else C$2.modal_ok_cancel("Error","File dialog is available only application version.")}let asset_browser_init_flag=!1,window_session=null;(async()=>window_session=JSON.parse(await __storage__.editor.get("window_session","{}")))();async function asset_browser(s){const e=DMC,i=window.debug_asset_browser;await __storage__.editor_permanent.set("asset_browser_opened","true");const r=await ExternalIO$1.get_current_io_config();if(window.nodejs&&window.external_io==null){const c=await window.nodejs.ipcRenderer.invoke("has_asset_browser_window");if(asset_browser_init_flag&&c){const d=await r.getWindowSessions();for(const u in d.sessions){if(u==null||u=="undefined"){delete d.sessions[u];continue}window.nodejs.ipcRenderer.invoke("focus_sub_window",{window_id:u})}return}}asset_browser_init_flag=!0;const o={new_window:!1};s&&Object.assign(o,s),i&&console.log("AssetBrowser");{const c=await r.getWindowSessions();(Object.keys(c.sessions).length==0||o.new_window)&&(i&&console.log("Create window session"),await r.createWindowSession())}let l=performance.now();async function a(c){i&&console.log("Open Window:",c.id);let d=performance.now();const u=await UC$1.make_hybrid_window({window_key:c.id,title:c.title??"Asset Browser",url:window.nodejs&&window.external_io==null?"ddd/ui/asset_browser.html":"ddd/ui/asset_browser.html?"+c.id,persistent:!0,frame:{x:c.x??50,y:c.y??50,width:c.width??400,height:c.height??300},restore_frame_setting:!0,params:c,async onload(){i&&console.log("Opened: Asset Browser:",Math.floor(performance.now()-l),"ms, ",Math.floor(performance.now()-d),"ms")},async onmessage(f){const m=f?.event;if(["read","write","exist","external_io","tmp_dir","store_session"].includes(m)||i&&console.log(f),m=="get_session")return await r.getWindowSession(c.id);if(f?.type!="close"){if(m=="test_sub_to_main")return"response for test_sub_to_main";if(m=="store_session"){(await r.getWindowSessions()).put(f.window_session),i&&console.log("==================================================="),i&&console.log("Store session:");for(const b in f.window_session.tabs){const v=f.window_session.tabs[b];console.log("   ",v.name,":",v.search_path," DB:",v.db_location)}}else if(m=="read")try{if(await window.cross_file_system.exists(f.file_path)){const _=await window.cross_file_system.read(f.file_path);f.data=_}else f.error="Does not exists: "+f.file_path;return f}catch(_){return console.error(_),f.error=_,f}else if(m=="write"){try{f.file_path==null&&console.error("params.file_path is ",f.file_path),await window.cross_file_system.write(f.file_path,f.data)}catch(_){console.error(_),f.error=_}return f.data=null,f}else{if(m=="exist")return await window.cross_file_system.exists(f.file_path);if(m=="tmp_dir")return await window.cross_file_system.tmp_dir();if(m=="delete_window_session")r.removeWindowSession(f.window_session);else if(m=="load")try{await UIL.load_files([f.file_path],{confirm:!1})}catch(_){return _}else if(m=="copy")try{const _=await window.cross_file_system.read(f.file_path);return await window.cross_file_system.write(f.dest_path,_)}catch(_){return _}else{if(m=="external_io")return window.external_io==null?null:window.external_io.driver;if(m=="screenshot"){if(f.focus){const _=document.querySelector(".tree_component_item.active");if(_){if(!(_ instanceof HTMLElement))throw"not HTMLElement";await __storage__.editor.set("last_active_tree_component_item",_.dataset.uuid),e.transform_controls.focus_object&&e.transform_controls.focus_object(_.dataset.uuid,{select_tree_component:!1})}}try{const _=await C$2.screenshot(f.file_path,{type:"save",thumbnail:!0,w:512});f.thumb_path=_.path,f.data=_.buffer}catch(_){f.error=_.toString()}return f}else if(m=="pin"){const _=f.file_path;window.pin_drag_and_drop({item:_})}else if(m=="delete_with_thumbnail"){await window.cross_file_system.remove(f.file_path,{existence_check:!0});const _=C$2.make_thumbnail_path(f.file_path);await window.cross_file_system.remove(_,{existence_check:!0}),await window.cross_file_system.remove(f.file_path+".attribute",{existence_check:!0})}else if(m=="delete")await window.cross_file_system.remove(f.file_path,{existence_check:!0});else if(m=="open_in_folder")window.external_io?window.file_browser.open(f.file_path):window.nodejs&&window.external_io==null?window.nodejs.open_in_finder(f.file_path):alert("There is no file system.");else if(m=="stop_sound"){for(const _ of window.test_sounds)try{_.stop()}catch{}window.test_sounds=[]}else if(m=="play_sound"){for(const v of window.test_sounds)try{v.stop()}catch{}window.test_sounds=[];const _=new THREE.Audio(e.sound_listener);_.setBuffer(await Builder3D.ETC.sound(f.file_path)),window.test_sounds.push(_);const b=e.ui.system_flags;_.setVolume(Math.pow(b.system_volume,2)),_.play()}else if(m=="make_thumbnail_from_input"){const _=C$2.make_thumbnail_path(f.file_path);let b=await C$2.make_thumbnail_from_input(f.source_path,{square:!0,w:512});const v=C$2.DPath(_).ext;return b=await C$2.to_compressed_buffer(b,{quality:95,ext:v}),await window.cross_file_system.write(_,b),await window.cross_file_system.enable_hidden_attr(_),f.thumb_path=_,f.data=b,f}else if(m=="open_in_native_app")window.nodejs&&window.external_io==null&&window.nodejs.open_in_native(f.file_path);else if(m!="store_file_list"){if(m=="change_to_absolute_path"){C$2.modal_processing("Converting...."),await C$2.sleep(250);try{const _=f.file_path;await Builder3D.replace_path_as_absolute(_),C$2.close_modal_processing()}catch(_){C$2.close_modal_processing(),C$2.modal_ok_cancel("Error",_.stack?_.stack:_)}}else if(m=="change_to_relative_path"){C$2.modal_processing("Converting...."),await C$2.sleep(250);try{const _=f.file_path;await Builder3D.replace_path_as_relative(_),C$2.close_modal_processing()}catch(_){C$2.close_modal_processing(),C$2.modal_ok_cancel("Error",_.stack?_.stack:_)}}else if(m=="open_dialog"){const _=await window.cross_file_system.open_dialog({defaultPath:f.previous,properties:["openFile"],filters:f.filters});if(_?.length>0)return _[0]}else if(m=="relative_path"){if(window.nodejs&&window.external_io==null)return window.nodejs.path.relative(f.from,f.to)}else if(m=="tab_db_store")if(window.nodejs&&window.external_io==null)console.log(f.db_location),C$2.s_encode_and_store(f.db_location,f.db_obj);else{const _=await C$2.s_encode_async(f.db_obj);f.db_location?await window.cross_file_system.write(f.db_location,_):console.log("Tab db location is undefined")}else if(m=="rebuild_index"){const _=f.tab;let b=_.search_path;if(window.external_io){console.log("External IO:",b),C$2.modal_processing("Fetching...."),await C$2.sleep(100);let v=performance.now(),w=await window.file_browser.fetch_all({search_path:b,deep:!0,recursive:!0,callback:(S,D)=>{C$2.modal_processing_update_description(`Checked directory : ${S}<br>${D}`)}});w=w.filter(S=>C$2.available_app_exts.includes(C$2.DPath(S.absolute_path).ext)),console.log(performance.now()-v,w);const y=[];for(let S=0;S<w.length;S++){const k=w[S].absolute_path,O=C$2.file_type(k);(O=="project"||O=="j_object")&&y.push(new Promise(async L=>{const P=await window.cross_file_system.read(k);let N=null;try{N=await C$2.s_decode_async(P)}catch(z){console.warn(z);try{N=C$2.b_decode(P)}catch(K){console.error(k,K)}}w[S].j_root_object=N,L()}))}v=performance.now(),await Promise.all(y),console.log(performance.now()-v);const M={file_list:w,search_path:b};return(async()=>{const S=await C$2.s_encode_async(M);try{_.db_location?(console.log(" ==> Stored to db:",_.db_location),await window.cross_file_system.write(_.db_location,S)):console.log("Tab db location is undefined")}catch(D){console.error(D)}})(),C$2.close_modal_processing(),{direct:!1,db_obj:M}}else if(window.nodejs){console.log("Nodejs:Search:",b);let v=[],w=!1;if(b==null){const y=await __storage__.editor_permanent.get("asset_browser_previous_search_path");if(v=await window.cross_file_system.open_dialog({defaultPath:y,properties:["openFile","openDirectory"]}),v?.length>0){await __storage__.editor_permanent.set("asset_browser_previous_search_path",v[0].path),b=v[0].path;const M=await window.cross_file_system.tmp_dir();_.db_location=C$2.DPathJoin(M,"ddd.ab."+C$2.md5.hex(_.search_path)+".db")}}else v=[b],w=!0;if(v?.length==1){const y=C$2.DPath(v[0]).path;if(w)return{direct:w,ret_array:v,db_obj:{file_list:[],search_path:y}};async function M(D){return new Promise(async(k,O)=>{const L={};try{C$2.modal_processing_update_description("Find files...."),L.files=await C$2.nodejs_finder(D,C$2.available_app_exts)}catch(P){L.error=P,console.error(P)}if(L.error)console.log("--------------NG-------------"),O(L.error);else{C$2.modal_processing_update_description("Making DB...");const P=L.files,N=[],z=[];for(let K=0;K<P.length;K++){const V=P[K].absolute_path;let H=null;try{H=window.nodejs.fs.statSync(V)}catch(W){console.error(W);continue}const Y=C$2.file_type(V),q=Math.floor(H.mtime.getTime()/1e3),J={absolute_path:C$2.DPath(V).path,date:q,size:H.size};(Y=="project"||Y=="j_object")&&z.push(new Promise(async W=>{const te=await window.nodejs.fs.promises.readFile(V);let ie=null;try{ie=await C$2.s_decode_async(te)}catch(oe){console.warn(oe,V);try{ie=C$2.b_decode(te)}catch(Ce){console.error(V,Ce)}}J.j_root_object=ie,W()})),N.push(J)}await Promise.all(z),k(N)}})}console.log("SearchPath:",y);let S=null;try{let D=performance.now();const k=await M(y);console.log("FIND:",performance.now()-D,"ms"),S={file_list:k,search_path:y};for(let O=0;O<k.length;O++){const L=k[O];L.file_type=C$2.file_type(L.absolute_path),L.ext=C$2.DPath(L.absolute_path).ext}if(D=performance.now(),window.nodejs&&window.external_io==null)console.log(_.db_location),C$2.s_encode_and_store(_.db_location,S);else{const O=await C$2.s_encode_async(S);_.db_location?await window.cross_file_system.write(_.db_location,O):console.log("Tab db location is undefined")}console.log("DB Store:",performance.now()-D,"ms")}catch{console.log("Skip")}return{direct:w,db_obj:S}}else return C$2.close_modal_processing(),null}}}}}}return null},async onclose(){i&&console.log("@@onclose"),await __storage__.editor_permanent.set("asset_browser_opened","false")}});window.asset_browser_windows.push(u)}{const c=await r.getWindowSessions();window.asset_browser_windows=[];const d=[];for(const u in c.sessions){if(u==null||u=="undefined"){delete c.sessions[u];continue}const f=c.sessions[u];d.push(a(f))}await Promise.all(d)}}async function export_project_references(s){console.log("Archiving...."),C$2.modal_processing("Archiving....",""),window.lock_rendering();const e={zip:!1,package_type:"Application",precompiled:!0};s&&Object.assign(e,s);{C$2.modal_processing_update_description("Making thumbnail...");const M=await GetProjectPath(),S={};if(S.buffer=(await C$2.screenshot("dummy.avif",{type:"buffer",thumbnail:!0,w:512})).buffer,M!=null){const D=C$2.DPath(M),k=C$2.DPathJoin(D.dirname,"."+D.name+".avif");try{S.buffer=await window.cross_file_system.read(k)}catch(O){console.error(O)}}e.thumbnail_buffer=S.buffer}let i=await GetProjectPath();i==null&&(i="Untitled.ddd"),console.log("Exporting....");const r=C$2.clone(await Builder3D.save_project(i,{store_file:!1,force_absolute_path:!0}));console.log("Exported"),r.system_flags.full_screen_play_button=e.full_screen_play_button,r.system_flags.world_time_component=e.world_time_component,console.log("Dynamic import some libs"),await __vitePreload(()=>import("./jszip.min@TY6z0PXt.js"),[],import.meta.url),await __vitePreload(()=>import("./typescript.min@BGAkRfVV.js"),[],import.meta.url);function o(M,S=!0,D=!1,k=!0){let O="";const L=(D?"ABCDEFGHIJKLMNOPQRSTUVWXYZ":"")+(S?"abcdefghijklmnopqrstuvwxyz":"")+(k?"0123456789":""),P=L.length;let N=0;for(;N<M;)O+=L.charAt(Math.floor(Math.random()*P)),N+=1;return O}const l=e.randomize_path;let a=null;const c={table:{},get(M){const S=C$2.DPath(M).basename;if(l)return`${o(24)}/${S}`;const D=C$2.file_type(M);return this.table[D]==null&&(this.table[D]={count:0}),this.table[D].count+=1,`${D}_${this.table[D].count}/${S}`}};async function d(){await C$2.sleep(10)}let u="";for(const M of[64,97,115,115,101,116,115,64,95])u+=String.fromCharCode(M);const f=u+C$2.md5.hex(e.pd),m=o(24),h=e.use_lock?f:e.randomize_path?m:"assets";let _="";for(let M=0;M<3;M++)_+="d";_+="_";const b=`${C$2.DPath(i).name}_${e.package_type=="Application"?"app":"scene"}_${VersionInfo()}`,v=await __storage__.editor.get("previous_exported_project_path"),w=window.external_io?.driver;for(const M of[97,115,115,101,116,115])_+=String.fromCharCode(M);_+="_";let y=[];if(console.log("Project path"),w=="native"||w=="local"||w==null?y=e.zip?["index.ddd"]:await window.cross_file_system.save_dialog({defaultPath:v,filters:[{name:"ddd",extensions:["ddd"]}]}):y=["index.ddd"],y&&y[0]){console.log("Project path:",y[0]);try{let M=function(be,De){if(be.material){const ge=Array.isArray(be.material)?be.material:[be.material];for(const Ee of ge)for(const Ie in Ee){const Be=Ee[Ie],Oe=Be?.source_file||Be?._source_file_;if(Oe&&(console.log(Oe,De),Oe.endsWith(De)))return!0}}let Te=!1;if(be.children)for(const ge of be.children)Te=Te||M(ge,De);return Te},S=0;const D=be=>{let De=S/1024/1024;De=Math.floor(De*100)/100,C$2.modal_processing_update_description(`Archiving(${De}MB)... ${be}`)},k=function(be){return be?.byteLength?S+=be.byteLength:be?.length&&(S+=be.length),be};for(const be of[112,114,105,118,97,116,101])_+=String.fromCharCode(be);_+="_",_+=f;const O=C$2.DPath(y[0]).path,L=C$2.DPath(y[0]).dirname,P=e.package_type.toLowerCase()=="application"?C$2.DPathJoin(L,h):L,N=C$2.DPath(O),z=N.basename,K=N.name;e.zip||await window.cross_file_system.mkdir(P),__storage__.editor.set("previous_exported_project_path",O),a=new JSZip;let Z=new JSZip;const V=await fetch("ddd/system_assets/release_template.zip").then(be=>be.arrayBuffer());Z=await Z.loadAsync(V,{createFolders:!0,checkCRC32:!0,optimizedBinaryString:!0});const H=["venice_sunset_1k.hdr","royal_esplanade_1k.hdr","spot1Lux.hdr"],Y=["ddd/textures/hardwood2_diffuse.ktx2","ddd/textures/hardwood2_roughness.ktx2","ddd/textures/hardwood2_bump.ktx2"],q=["Bourbon 64.CUBE","Chemical 168.CUBE","Clayton 33.CUBE","Cubicle 99.CUBE","Presetpro-Cinematic.3dl","Remy 24.CUBE"];if(e.zip){if(e.package_type.toLowerCase()=="application")if(e.precompiled){const be=[],De=r.renderer_flags;if(De){if(De.environment_map?.type=="Static"){const Be=De.environment_map?.file??"";for(const Oe of H)Oe==Be&&be.push("ddd/textures/equirectangular/"+Oe)}for(let Be=0;Be<Y.length;Be++){const Oe=Y[Be];M(r.instance,Oe)&&be.push(Oe)}const ge=De.render_passes?.LUT?.sub?.File,Ee=De.render_passes?.LUT?.value,Ie=De.renderer=="Deferred";if(ge&&Ee&&Ie)for(const Be of q)Be==ge&&be.push("ddd/luts/"+Be)}{const ge=["typescript.min","aws","xatlas","loading.gif","system_resources.json","system_assets/"];for(const Ee in Z.files){const Ie=Ee;ge.filter(Be=>Ie.indexOf(Be)>=0).length>0&&Z.remove(Ee)}}const Te=[];{let ge=function(Ee){if(Ee.script_mode=="typescript"&&(Ee.script=window.ts.transpileModule(Ee.script,{target:window.ts.ModuleKind.ES2020,compilerOptions:{module:window.ts.ModuleKind.ES2020}}).outputText,Ee.script_mode="javascript"),Ee.children)for(const Ie of Ee.children)ge(Ie)};Te.push("ddd/libs/typescript/typescript.min.js"),ge(r.instance)}for(const ge of be){const Ee=await fetch(ge).then(Ie=>Ie.arrayBuffer());console.log("Pack:",ge),Z.file(ge,k(Ee))}a=Z}else for(const be in Z.files){const De=Z.files[be],Te=e.precompiled?await De.async("arrayBuffer"):De.dir?null:await fetch(be).then(ge=>ge.arrayBuffer());Te&&a.file(be,k(Te))}}else if(e.package_type.toLowerCase()=="application")for(const be in Z.files){const De=Z.files[be],Te=e.precompiled?await De.async("arrayBuffer"):De.dir?null:await fetch(be).then(Ee=>Ee.arrayBuffer()),ge=C$2.DPath(C$2.DPathJoin(L,be));De.dir?await window.cross_file_system.exists(ge.dirname)||await window.cross_file_system.mkdir(ge.dirname):(console.log(ge.path,Te),await window.cross_file_system.write(ge.path,Te))}const J={binary:!0,createFolders:!0,optimizedBinaryString:!0};async function W(be,De,Te,ge="relative"){if(!(De==null||Te==null))for(const Ee in be){const Ie=be[Ee];if(Ie?.source_file||Ie?._source_file_){async function Be(Oe,ue=!1){if(Ie?.source_file?.indexOf?.(".mp4")>0&&(ge="absolute"),Oe&&window.is_data_url(Oe)==!1){let re=Oe,ke=Oe.slice(0,Oe.lastIndexOf("."))+".ktx2";await window.cross_file_system.exists(ke)&&(re=ke);const We=ge=="relative"?re.slice(De.length,re.length):C$2.DPath(re).basename,Xe=C$2.DPathJoin(Te,We);let Ye=Xe.slice(P.length);return e.zip?a.file(Xe,k(await window.cross_file_system.read(re)),J):await window.cross_file_system.copy(re,Xe),D(Xe),await d(),Ye[0]=="/"&&(Ye=Ye.slice(1)),ue&&console.log(Xe,P,Ye),Ye}return null}Y.includes(Ie.source_file)||(Ie.source_file=await Be(Ie.source_file,!0),await Be(Ie._source_file_),await Be(Ie._modified_source_file_)),delete Ie._source_file_,delete Ie._modified_source_file_}}}async function te(be,De,Te){const ge=be._dp_;if(ge){if(ge.action?.sources?.length>0){const Ee=ge.action.sources;for(const Ie of Ee)if(Ie.source_file){const Be=c.get(Ie.source_file),Oe=C$2.DPathJoin(P,Be);e.zip?a.file(Oe,k(await window.cross_file_system.read(Ie.source_file)),J):await window.cross_file_system.copy(Ie.source_file,Oe),D(Oe),await d(),Ie.source_file=Be}}if(ge.type=="pmx"||ge.type=="pmd"||ge.type=="gltf"||ge.type=="glb"||ge.type=="vrm"||ge.type=="fbx"||ge.type=="dae"){const Ee=C$2.DPath(ge.source_file).dirname,Ie=c.get(ge.source_file),Be=C$2.DPathJoin(P,Ie);if(e.zip?a.file(Be,k(await window.cross_file_system.read(ge.source_file)),J):await window.cross_file_system.copy(ge.source_file,Be),be.__source_dependencies__){for(const ue of be.__source_dependencies__)if(ue?.length>0){let re=C$2.DPathJoin(Ee,ue),ke=C$2.DPathJoin(P,C$2.DPath(Ie).dirname,ue);if(re=decodeURI(re),ke=decodeURI(ke),C$2.file_type(re)=="image"){const We=re.slice(0,re.lastIndexOf("."))+".ktx2";await window.cross_file_system.exists(We)&&(re=We,ke=ke.slice(0,ke.lastIndexOf("."))+".ktx2")}e.zip?a.file(ke,k(await window.cross_file_system.read(re)),J):await window.cross_file_system.copy(re,ke)}}D(Be),await d();const Oe=C$2.DPath(Be).dirname;if(be.material){const ue=Array.isArray(be.material)?be.material:[be.material];for(let re=0;re<ue.length;re++){const ke=ue[re];await W(ke,Ee,Oe)}}ge.source_file=Ie}else if(ge.type=="audio"){if(ge.source_file){const Ee=C$2.DPath(ge.source_file);if(C$2.file_type(ge.source_file)=="sound"){D("Compressing: "+ge.source_file);const Oe=await window.cross_file_system.read(ge.source_file);let ue=ge.source_file;if(e.audio_compress=="ogg"){const re=await C$2.encode_to_ogg(Oe);ue=C$2.DPathJoin(await window.cross_file_system.tmp_dir(),Ee.name+".ogg"),await window.cross_file_system.write(ue,re)}else if(e.audio_compress=="mp3"){Ee.ext!="mp3";const re=Ee.ext=="mp3"?Oe:await C$2.encode_to_mp3(Oe);ue=C$2.DPathJoin(await window.cross_file_system.tmp_dir(),Ee.name+".mp3"),await window.cross_file_system.write(ue,re)}ge.source_file=ue}const Ie=c.get(ge.source_file),Be=C$2.DPathJoin(P,Ie);e.zip?a.file(Be,k(await window.cross_file_system.read(ge.source_file)),J):await window.cross_file_system.copy(ge.source_file,Be),D(Be),await d(),ge.source_file=Ie}}else{if(ge.source_file){const Ee=c.get(ge.source_file),Ie=C$2.DPathJoin(P,Ee);e.zip?a.file(Ie,k(await window.cross_file_system.read(ge.source_file)),J):await window.cross_file_system.copy(ge.source_file,Ie),D(Ie),await d(),ge.source_file=Ee}if(be.material)for(const Ee of Array.isArray(be.material)?be.material:[be.material])if(Te&&De)await W(Ee,De,Te);else{const Ie="dummy.object",Be=c.get(Ie),Oe=C$2.DPathJoin(P,Be);await W(Ee,C$2.DPath(Ie).dirname,C$2.DPath(Oe).dirname,null)}}if(be.children)for(const Ee of be.children)await te(Ee,De,Te)}}try{await te(r.instance)}catch(be){throw console.error(be),be}{console.log("Finished all resources.");const be=r.renderer_flags;if(be.environment_map){const De=be.environment_map.file,Te=C$2.DPathJoin(De,"0.jpg");if(console.log("First env file:",Te),await window.cross_file_system.exists(Te)){be.environment_map.file="envmap";for(let ge=0;ge<6;ge++){const Ee=C$2.DPathJoin(De,ge+".jpg"),Ie=C$2.DPathJoin(P,"envmap",ge+".jpg"),Be=C$2.DPathJoin("envmap",ge+".jpg");e.zip?a.file(Ie,k(await window.cross_file_system.read(Ee)),J):(console.log(Ee,Ie,Be,C$2.DPath(Ie).dirname),await window.cross_file_system.mkdir(C$2.DPath(Ie).dirname),await window.cross_file_system.copy(Ee,Ie))}}}}{console.log("LUT");const be=r.renderer_flags.render_passes;if(be.LUT.value&&be.LUT.sub.File){const De=be.LUT.sub.File,Te=C$2.DPathJoin("ddd/luts",De),ge=C$2.DPathJoin("ddd/luts",De),Ee=C$2.DPathJoin(L,Te);if(console.log("LUT file:",ge),await window.cross_file_system.exists(ge))if(e.zip)a.file(Te,k(await window.cross_file_system.read(ge)),J);else{console.log(Ee),await window.cross_file_system.mkdir(C$2.DPath(Ee).dirname),console.log(ge);const Ie=await window.cross_file_system.read(ge);await window.cross_file_system.write(Ee,Ie)}else console.error("LUT file not found: "+ge)}}{console.log("Manifest");const be="manifest.webmanifest",De=C$2.DPathJoin(L,be);e.manifest.xr=r.instance.isXRMode;const Te=JSON.stringify(e.manifest,null,2),ge=new TextEncoder().encode(Te);e.zip?a.file(be,k(ge.buffer),J):(console.log(De),await window.cross_file_system.write(De,ge))}{console.log("manifest.png");const be="manifest.png",De=C$2.DPathJoin(L,be);e.zip?a.file(be,k(e.thumbnail_buffer),J):(console.log(De),await window.cross_file_system.write(De,e.thumbnail_buffer))}let ie="ddd/ddd.js";const oe=C$2.DPathJoin(L,ie),Ce=C$2.DPathJoin(L,"index.html"),ve=e.file_system,we="PLAYER",Se=C$2.DPathJoin(h,z);let Re="",Fe="";if(console.log("params.precompiled"),e.precompiled){for(const be in Z.files)if(be.match(/\/ddd@.+\.js/)){ie=be;break}Re=new TextDecoder().decode(await Z.files[ie].async("arrayBuffer")),Fe=new TextDecoder().decode(await Z.files["index.html"].async("arrayBuffer"))}else Re=await fetch(oe).then(be=>be.text()),Fe=await fetch(Ce).then(be=>be.text());let $e=`await SetProjectPath("${Se}")`;if(e.use_lock){console.log("Encryption....");const be=e.ptype,De=e.pd;if(e.package_type.toLowerCase()=="application")if(be=="TinyPassword"){$e="";const Te=[1,"ZB","abQ","nxl5"].reverse().join(""),ge=`async function ${Te}(){await SetProjectPath("${u}"+C.md5.hex(await UI._a())+"/index.ddd")}`;let[Ee,Ie]=Re.split("async function "+Te);Ie=Ie.slice(Ie.indexOf("}")+1,Ie.length),Re=Ee+ge+Ie}else be=="Authentication"&&alert("Not implemented yet.")}console.log("Replace..."),Re=Re.replace(/console.log\("REPLACE_POINT_OF_ENTRY_POINT"\)/,`window.force_io_driver="${ve}";${$e}`),Re=Re.replace(/console.log\("REPLACE_POINT_OF_ENTRY_MODE"\)/,`window.DEPLOYMENT_TYPE="${we}";window.app_mode=true`),e.zip?a.file(ie,new TextEncoder().encode(Re),J):(await window.cross_file_system.mkdir(C$2.DPath(oe).dirname),await window.cross_file_system.write(oe,Re),await window.cross_file_system.write(Ce,Fe)),console.log("Store project....");const Ue=await C$2.s_encode_async(r);if(e.zip?a.file(C$2.DPathJoin(P,z),Ue,J):await window.cross_file_system.write(C$2.DPathJoin(P,z),k(Ue)),D(z),await d(),console.log("Finished project file."),e.sw&&e.zip){const be=[],De=["sw.js","index.html","ddd/ddd.js"];a.forEach((Ie,Be)=>{Ie[Ie.length-1]!="/"&&De.includes(Ie)==!1&&be.push(Ie.split("/").map(Oe=>encodeURIComponent(Oe)).join("/"))});const Te=await fetch("./sw.js").then(Ie=>Ie.text());let ge="";const Ee=Te.split("@SEPARATOR@")[1];ge+=`const cacheName = "ddd_app";
`,ge+=`const cacheVersion = "${Date.now()}";
`,ge+=`const cacheFiles = ${JSON.stringify(be)};
`,ge+=Ee,a.file("sw.js",ge,J)}let qe=null,_e={title:null,description:null};e.zip?(C$2.modal_processing_update_description("Compressing...."),await d(),await a.generateAsync({type:"arrayBuffer",compression:"DEFLATE",compressionOptions:{level:6}}).then(async be=>{if(C$2.modal_processing_update_description("Uploading...."),e.upload){const De=(e.upload_name??b)+".zip",Te=new FormData;Te.append("file_name",De),Te.append("file",new Blob([be]),De);{const ge=new XMLHttpRequest;await new Promise((Ee,Ie)=>{ge.upload.addEventListener("progress",Be=>{if(Be.lengthComputable){const Oe=Math.floor(Be.loaded/Be.total*100);console.log("upload progress:",Oe),C$2.modal_processing_update_description(`Uploading....${Be.loaded}/${Be.total}(${Oe}%)`),Oe>=100&&C$2.modal_processing_update_description("Extracting....")}}),ge.addEventListener("load",function(Be){console.log("Upload Complete");const Oe=ge.responseText;console.log("OK",Oe);const ue=JSON.parse(Oe);ue.data=="OK"?(console.log(ue),_e={title:"Successfully uploaded",description:`URL : ${e.upload_path}<br>Project : ${De}`},console.log("Finished")):Ie("Failed to upload.")}),ge.addEventListener("error",function(Be){console.log("Upload Error",Be),Ie(Be)}),ge.addEventListener("loadend",()=>{Ee(ge.readyState===4&&ge.status===200)}),ge.open("POST",e.upload_path,!0),ge.send(Te)})}}else await C$2.download(be,b+".zip")})):console.log("Finished"),C$2.close_modal_processing(),qe&&C$2.modal_ok_cancel("Error","Failed to export project: "+qe,{cancel:null}),_e?.title&&C$2.modal_ok_cancel(_e.title,_e.description,{cancel:null})}catch(M){console.error(M),C$2.close_modal_processing(),C$2.modal_ok_cancel("Error","Failed to export project: "+M.toString(),{cancel:null})}finally{window.unlock_rendering()}}else C$2.close_modal_processing(),window.unlock_rendering()}async function gltf_compressor(){window_session.gltf_compressor=!0,await __storage__.editor.set("window_session",JSON.stringify(window_session)),UC$1.make_hybrid_window({window_key:"____gltf_compressor____",title:"GLTF Compressor",url:"ddd/ui/gltf_compressor.html",frame:{x:50,y:50,width:400,height:200},restore_frame_setting:!1,force_internal_window:!0,params:{},async onload(){console.log("Opened: gltf_compressor")},async onmessage(i){return null},async onclose(){delete window_session.gltf_compressor,await __storage__.editor.set("window_session",JSON.stringify(window_session)),console.log("@@onclose")}})}async function ktx2_compressor(){window_session.ktx2_compressor=!0,await __storage__.editor.set("window_session",JSON.stringify(window_session)),UC$1.make_hybrid_window({window_key:"____ktx2_compressor____",title:"KTX2 Compressor",url:"ddd/ui/ktx2_compressor.html",frame:{x:50,y:50,width:400,height:200},restore_frame_setting:!1,force_internal_window:!0,params:{},async onload(){console.log("Opened: ktx2_compressor")},async onmessage(i){return null},async onclose(){delete window_session.ktx2_compressor,await __storage__.editor.set("window_session",JSON.stringify(window_session)),console.log("@@onclose")}})}async function ktx2_compressor_for_web(){window_session.ktx2_compressor=!0,await __storage__.editor.set("window_session",JSON.stringify(window_session)),UC$1.make_hybrid_window({window_key:"____ktx2_compressor____",title:"KTX2 Compressor for Web",url:"ddd/ui/ktx2_compressor_for_web.html",frame:{x:50,y:50,width:400,height:200},restore_frame_setting:!1,force_internal_window:!0,params:{},async onload(){console.log("Opened: ktx2_compressor")},async onmessage(i){return null},async onclose(){delete window_session.ktx2_compressor,await __storage__.editor.set("window_session",JSON.stringify(window_session)),console.log("@@onclose")}})}async function image_filter_ext(s){const e="image_"+s;window_session[e]=!0,await __storage__.editor.set("window_session",JSON.stringify(window_session));const i=`____${e}____`;UC$1.make_hybrid_window({window_key:i,title:e,url:`ddd/ui/${e}.html`,frame:{x:50,y:50,width:630,height:240},restore_frame_setting:!1,force_internal_window:!0,params:{},async onload(){console.log("Opened: "+e)},async onmessage(r){return null},async onclose(){delete window_session[e],await __storage__.editor.set("window_session",JSON.stringify(window_session)),console.log("@@onclose: "+e)}})}async function open_image_processor(){const s="ddd/ui/image_processor.html";UC$1.make_window(s,"Image Processor",{url:s,x:20,y:50,width:500,height:520,urlLoaded:async function(e){const i=e.iframe.contentWindow;for(i.self_frame=e,i.post=async r=>{console.log(r);try{r.event=="video_maker"||r.event=="apng_maker"}catch(o){console.error(o)}};i.on_initialized==null;)await C$2.sleep(100);i.on_initialized(),e.setOnCloseFrameListener(()=>{})}})}async function open_capture_panel(){const s=DMC,e="ddd/ui/capture.html",i={};UC$1.make_window(e,T("menu.module_sub.video_capture"),{url:e,width:300,height:350,minimizeButton:!1,maximizeButton:!1,urlLoaded:async function(r){const o=r.iframe.contentWindow;o.self_frame=r,o.getCanvasWidth=()=>s.base_renderer.domElement.width,o.getCanvasHeight=()=>s.base_renderer.domElement.height;let l=null,a=!1,c=s.mmd_animation_helper.enabled.physics;for(o.post=async d=>{console.log(d);const u=document.getElementById("__capture_button__");u.innerHTML='<img src="ddd/system_assets/icons/loading.gif" style="width:20px;height:20px">';try{if(d.event=="video_maker")if(d.webcodecs){let f=()=>{};if(l&&d.stop){f(),a=!0,l=null,s.mmd_animation_helper&&s.mmd_animation_helper.enable("physics",c);return}a=!1,s.mmd_animation_helper&&s.mmd_animation_helper.enable("physics",s.ui.system_flags.physics==!0),document.getElementById("stop_button").click(),l=new C$2.ScreenCapture2;const m={fps:d.fps,width:d.portrait?d.height:d.width,height:d.portrait?d.width:d.height,fadeIn:d.fadeIn,fadeOut:d.fadeOut,quality:d.quality};await l.prepare(m);const h=d.profile.mimeType.replace(/[!"#$%&'()\*\+\-\.,\/:;<=>?@\[\\\]^_`{|}~]/g,"_"),_=await GetProjectPath(),v=`${_?C$2.DPath(_).name:document.title}.${m.width}x${m.height}_Q${d.quality}_F${m.fps}_${h}.webm`,w=d.end-d.start,y=d.fadeIn,M=d.fadeOut;let S=null,D=null,k=null;f=()=>{l&&l.stop(!0),S&&clearInterval(S),l=null,k&&(k.value=1),document.getElementById("stop_button").click(),u.innerHTML='<i class="bi bi-camera-fill" style="color:#CAC"></i>',s.static_clock=null,s.base_renderer.setAnimationLoop(s.registered_request_display_function),s.renderer_observer(!0),window.dispatchEvent(new Event("resize")),C$2.close_modal_processing()};{C$2.modal_processing("Recording..."),C$2.modal_processing_update_progress(0,1,"Warmup..."),document.getElementById("play_button").click(),await C$2.sleep(d.start*1e3),C$2.modal_processing_update_progress(0,100,"Recording audio...");const O=performance.now();if(S=setInterval(()=>{const K=(performance.now()-O)/1e3;C$2.modal_processing_update_progress(Math.floor(K*10)/10,w,"Recording audio...")},100),a)return;console.log("begin_audio_phase"),await l.begin_audio_phase(),k=l.gain_node.gain;{if(k.value=1,y>0){let K=function(V,H){const Y=V/H;if(Y>1){k.value=1;return}k.value=Y,setTimeout(()=>{if(a)return;const q=performance.now()/1e3;K(V+q-Z,H),Z=q},100)};k.value=0;let Z=performance.now()/1e3;K(0,y)}if(M>0){let K=function(V,H){const Y=V/H;if(Y>1){k.value=0;return}k.value=1-Y,setTimeout(()=>{if(a)return;const q=performance.now()/1e3;K(V+q-Z,H),Z=q},100)},Z=performance.now()/1e3;setTimeout(()=>{a||(Z=performance.now()/1e3,K(0,M))},Math.floor(1e3*(w-M)))}}if(a)return;l.record_audio();let L=performance.now();for(;performance.now()-L<w*1e3;)if(await C$2.sleep(Math.min(w*1e3-(performance.now()-L),1e3)),a)return;if(a||(l.stop_audio(),console.log("end_audio_phase"),clearInterval(S),a)||(await l.end_audio_phase(),document.getElementById("stop_button").click(),await C$2.sleep(250),document.getElementById("play_button").click(),await C$2.sleep(d.start*1e3),a))return;s.base_renderer.setAnimationLoop(null),s.renderer_observer(!1);const P={getDelta:()=>1/d.fps};s.static_clock=P;let N=0;console.log("begin_audio_phase"),s.setBlackout?.(0);const z=setInterval(()=>{C$2.modal_processing_update_progress(N,Math.floor(w/(1/d.fps)),"Recording video...")},100);if(a||(await l.begin_video_phase(async()=>{const K=N*(1/d.fps);if(s.update_display(),y>K)s.setBlackout?.(K/y);else if(M>w-K){const Z=Math.max((w-K)/M,0);s.setBlackout?.(Z)}else s.setBlackout?.(1);return N++,!(N*(1/d.fps)>w||a)}),console.log("end_video_phase"),a)||(await l.end_video_phase(),console.log("finalize"),a)||(clearInterval(z),C$2.modal_processing_update_progress(0,1,"Compressing...."),a)||(await l.finalize(),document.getElementById("stop_button").click(),console.log("download"),a))return;await l.download(v),console.log("done"),s.setBlackout?.(1),s.static_clock=null,s.base_renderer.setAnimationLoop(s.registered_request_display_function),s.renderer_observer(!0),window.dispatchEvent(new Event("resize")),k.value=1,u.innerHTML='<i class="bi bi-camera-fill" style="color:#CAC"></i>',C$2.close_modal_processing(),l=null}s.mmd_animation_helper&&s.mmd_animation_helper.enable("physics",c)}else{if(l&&d.stop){l.stop(!0),u.innerHTML='<i class="bi bi-camera-fill" style="color:#CAC"></i>',document.getElementById("stop_button").click(),l=null,a=!0;return}l=new C$2.ScreenCapture,l.media_params=d.profile,l.fps=d.fps,l.width=d.width,l.height=d.height,d.portrait&&(l.width=d.height,l.height=d.width),l.video=d.video,l.audio=d.audio,l.fadeIn=d.fadeIn,l.fadeOut=d.fadeOut,l.init();const f=d.profile.mimeType.replace(/[!"#$%&'()\*\+\-\.,\/:;<=>?@\[\\\]^_`{|}~]/g,"_"),m=await GetProjectPath(),h=m?C$2.DPath(m).name:document.title;l.filename=`${h}.${l.width}x${l.height}_${l.video?"v":""}${l.audio?"a":""}_Q${d.quality}_F${l.fps}_${f}`;const _=d.end-d.start;if(l.onfinish=()=>{C$2.close_modal_processing()},l.onstart=()=>{},l.onstop=b=>{b||(u.innerHTML='<i class="bi bi-camera-fill" style="color:#CAC"></i>',C$2.modal_processing("Compressing..."))},a=!1,d.start_button){if(document.getElementById("stop_button").click(),await C$2.sleep(1e3),a)return;document.getElementById("play_button").click()}if(await C$2.sleep(d.start*1e3),a)return;l.start(_)}else if(d.event=="screenshot"){let f=await GetProjectPath();f==null&&(f="Untitled.ddd");const m=`${C$2.DPath(f).name}_${d.package_type=="Application"?"app":"scene"}_${VersionInfo()}`;console.log(m),await C$2.screenshot(m+".png",d),u.innerHTML='<i class="bi bi-camera-fill" style="color:#CAC"></i>'}else d.event=="gif_maker"?(i.take_screenshot_as_gif?i.take_screenshot_as_gif.processing_flag=!1:(i.take_screenshot_as_gif={processing_flag:!0},d.onFrame=f=>i.take_screenshot_as_gif.processing_flag),await C$2.take_screenshot_as_gif(d),i.take_screenshot_as_gif=null,u.innerHTML='<i class="bi bi-camera-fill" style="color:#CAC"></i>'):d.event=="apng_maker"&&(await C$2.take_screenshot_as_apng(d),u.innerHTML='<i class="bi bi-camera-fill" style="color:#CAC"></i>')}catch(f){console.error(f),u.innerHTML='<i class="bi bi-camera-fill" style="color:#CAC"></i>'}};o.on_initialized==null;)await C$2.sleep(100);o.on_initialized(),r.setOnCloseFrameListener(()=>{})}})}async function help_page(s){window.is_electron?UC$1.make_window("Help","Help",{width:document.body.clientWidth-100,height:document.body.clientHeight-100,url:s,urlLoaded:function(e){}}):window.open(s)}async function report_page(){UC$1.make_window("Help","Help",{width:350,height:350,url:"ddd/report.html",urlLoaded:function(s){}})}async function screen_capture(){try{const s=await navigator.mediaDevices.getDisplayMedia({video:!0}),e=new C$2.ScreenCapture;e.fps=30,e.width=640,e.height=480,e.fadeIn=0,e.fadeOut=0,e.v_stream=s,e.init(),e.start(),setTimeout(()=>{e.stop(),s.getTracks().forEach(i=>i.stop())},3e3),console.log("@")}catch(s){console.error(s),C$2.modal_ok_cancel("Error",s,{cancel:null})}}async function native_screen_capture(){window.nodejs.native_screen_capture()}function load_from_history(s){const e=DMC,i=s.innerText;SetProjectPath(i).then(()=>{e.reload()})}async function get_file_history(){const e="file_history_"+(window.external_io?window.external_io.driver:"native"),i=await __storage__.editor_permanent.get(e);return i?JSON.parse(i):{}}async function get_project_history(){const e="project_history_"+(window.external_io?window.external_io.driver:"native"),i=await __storage__.editor_permanent.get(e);return i?JSON.parse(i):{}}async function set_file_history(s){const i="file_history_"+(window.external_io?window.external_io.driver:"native"),r=JSON.stringify(s).normalize("NFC");await __storage__.editor_permanent.set(i,r)}async function set_project_history(s){const i="project_history_"+(window.external_io?window.external_io.driver:"native"),r=JSON.stringify(s).normalize("NFC");await __storage__.editor_permanent.set(i,r)}async function get_pin_item(){const e="pin_items_"+(window.external_io?window.external_io.driver:"native"),i=await __storage__.editor_permanent.get(e);return i?JSON.parse(i):{}}async function set_pin_item(s){const i="pin_items_"+(window.external_io?window.external_io.driver:"native"),r=JSON.stringify(s).normalize("NFC");await __storage__.editor_permanent.set(i,r)}async function store_file_history(s){const e=s.replace(/\\/g,"/"),i=await get_file_history();i[e]={file:e,date:Date.now()};const r=Object.values(i).sort((o,l)=>o.date<l.date?1:o.date>l.date?-1:0);for(const o of r.slice(100,r.length))delete i[o.file];await set_file_history(i),await make_file_history_menu(),window.debug&&console.log("store_file_history")}async function store_project_history(s){const e=await get_project_history();e[s]={file:s,date:Date.now()},await __storage__.editor.set("previous_dialog_path",C$2.DPath(s).dirname),await set_project_history(e),await make_project_history_menu()}async function check_file_exists_from_history(){C$2.modal_processing("Updating","");const s=await get_file_history();for(const e in s)await window.cross_file_system.exists(e)||delete s[e];await set_file_history(s),C$2.close_modal_processing(),console.log("check_file_exists_from_history")}async function delete_all_project_history(){await set_file_history({}),await set_project_history({}),await set_pin_item({}),await make_file_history_menu(),console.log("delete_all_project_history")}async function delete_file_history(s){const e=s.replace(/\\/g,"/"),i=await get_file_history();delete i[e],await set_file_history(i)}async function make_file_history_menu(){const s=DMC,e=ICON_BASE_URL$1,i=document.getElementById("__editor_activity_window_content__");if(i==null)return;let r=null,o=null;try{r=await get_file_history(),o=await get_project_history()}catch(_){console.error(_),await set_file_history({}),await set_project_history({})}const l=document.getElementById("file_history")||document.createElement("div");document.getElementById("file_history")||i.appendChild(l),l.id="file_history",l.innerHTML="";let a={};a.project=[];function c(_,b){return b=="motion"||b=="sound"||b=="pose"?b="audio/motion":b=="model"?_.thumbnail=!0:b=="image"||b=="script"||(b=="j_object"||b=="project"?_.thumbnail=!0:b="etc"),b}for(const _ in r){const b=r[_];if(b?.file){let v=_.split(".").pop().toLowerCase();v=Builder3D.file_type(v),v=c(b,v),a[v]==null&&(a[v]=[]),a[v].push(b)}}for(const _ in o){const b=o[_];if(b?.file){let v=_.split(".").pop().toLowerCase();v=Builder3D.file_type(v),v=c(b,v),a[v]==null&&(a[v]=[]),a[v].push(b)}}const d=document.getElementById("__editor_activity_window_search_data_list__"),u=document.getElementById("__editor_activity_window_search_box__");if(u==null)return;const f=[];d.innerHTML="",u.value=await __storage__.editor.get("activity_window_search_box_sentence")??"";async function m(){const _=await get_pin_item();let b="";b+=`<i class='bi bi-thumbtack' style="margin-left:auto"></i><span style='margin-left:5px'>Pin</span>`,b+="<i class='bi bi-file-import' id='import_pin' style='margin-right:10px;margin-left:auto;float:right'></i>",b+="<i class='bi bi-file-export' id='export_pin' style='margin-right:10px;float:right'></i>";const v=UC$1.make_toggle_window(l,{title:b},()=>{});setTimeout(()=>{const O=document.getElementById("import_pin"),L=document.getElementById("export_pin");O.onclick=async function(P){P.stopPropagation(),P.preventDefault();const N={defaultPath:await __storage__.project.get("previous_project_file"),filters:[{name:"Pin items",extensions:["json"]}]};C$2.modal_processing("Processing...");const z=await window.cross_file_system.open_dialog(N);if(z?.[0]){const K=z[0],Z=await window.cross_file_system.read(K),V=C$2.b_decode(Z);V.file_type=="pin"&&(await set_pin_item(V.items),await make_file_history_menu())}C$2.close_modal_processing()},L.onclick=async function(P){P.stopPropagation(),P.preventDefault();const N={filters:[{name:"Pin items",extensions:["json"]}]};C$2.modal_processing("Processing...");const z=await window.cross_file_system.save_dialog(N);if(z?.[0]){const K=z[0],Z=await get_pin_item(),V=JSON.stringify({file_type:"pin",items:Z},null,"	").normalize("NFC");await window.cross_file_system.write(K,V)}C$2.close_modal_processing()}},100);const w=v.holder,y=document.createElement("div");y.style.width="100%";const M=document.createElement("div");M.style.width="100%",M.style.height="50px",M.style.fontSize="11px",M.style.display="flex",M.style.alignItems="center",M.style.justifyContent="center",M.style.overflow="hidden",M.style.whiteSpace="nowrap",M.innerText=T("g.drag_and_drop_here");let S=null;async function D(O,L){const P=await __storage__.editor.get("activity_window_search_box_sentence",u.value.trim());let N=[];P.length>0&&(N=P.split(" "));for(const z in O){let K=function(W){const te=W.getBoundingClientRect(),ie=window.pageXOffset||document.documentElement.scrollLeft,oe=window.pageYOffset||document.documentElement.scrollTop;return{top:te.top+oe,left:te.left+ie,width:te.width,height:te.height}};const Z=O[z];let V=!1;if(N.length>0){for(const W of N)if(Z.file.indexOf(W)==-1){V=!0;break}}if(V)continue;const H=document.createElement("div");H.style.minWidth="32px",H.style.maxWidth="75px",H.style.minHeight="32px",H.style.maxHeight="75px",H.style.width="75px",H.style.height="75px",H.style.display="inline-block",H.style.position="relative",H.style.boxShadow="0 0 5px #444",H.draggable=!0;const Y=document.createElement("img");H.appendChild(Y);try{if(window.external_io){const W=await window.cross_file_system.read(C$2.make_thumbnail_path(Z.file)),te=new Blob([W],{type:"application/octet-binary"}),ie=window.URL.createObjectURL(te);Y.onload=function(){window.URL.revokeObjectURL(ie)},Y.onerror=function(){window.URL.revokeObjectURL(ie),Y.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},Y.src=ie}else Y.src=C$2.make_thumbnail_path(Z.file)+(L.refresh?`?${performance.now()}`:""),Y.onerror=function(){Y.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}}catch{}Y.style.width="73px",Y.style.height="73px",Y.style.borderRadius="5px",Y.style.padding="1px",Y.style.objectFit="contain";const q=document.createElement("div");q.style.position="fixed",q.style.zIndex="3",q.style.display="none",q.style.background="#111",q.style.borderRadius="15px",q.style.padding="2px",q.style.border="1px solid #333",q.style.fontSize="18px",q.style.boxShadow="0 0 5px #444",q.style.paddingLeft=q.style.paddingRight="10px",q.innerText=Z.file.replace(/\\/g,"/").split("/").pop(),H.appendChild(q);const J=document.createElement("i");J.classList.add("bi"),J.classList.add("bi-x-circle"),J.style.position="absolute",J.style.right="0px",J.style.top="0px",J.style.opacity="0.5",J.style.textShadow="0 0 3px #222",J.onclick=async function(W){W.preventDefault(),W.stopPropagation();const te=await get_pin_item();delete te[Z.file],await set_pin_item(te),await make_file_history_menu()},J.ondblclick=function(W){W.preventDefault(),W.stopPropagation()},J.onmouseover=function(W){J.style.opacity="1.0"},J.onmouseleave=function(W){J.style.opacity="0.5"},H.appendChild(J);{const W=C$2.DPath(Z.file).ext;let te=document.createElement("i");te.classList.add("bi"),te.style.position="absolute",te.classList.add("no_select"),te.style.fontSize="20px",te.style.right="5px",te.style.bottom="7px",te.style.textShadow="0 0 3px #222";const ie=document.createElement("img");ie.style.width="50px",ie.style.height="50px",ie.style.left="5px",ie.style.bottom="5px",ie.style.position="absolute",ie.classList.add("no_select");const oe=document.createElement("img");oe.style.width="20px",oe.style.height="20px",oe.style.right="5px",oe.style.bottom="7px",oe.style.position="absolute",oe.classList.add("no_select");const Ce=C$2.file_type(Z.file);let ve="#333";Ce=="model"?(te.classList.add("bi-box"),te.style.color="#FA0",ve="#C70",W=="pmx"?(oe.src=e+"pmx.backup.png",oe.style.width="30px",oe.style.height="30px",oe.style.right="5px",oe.style.bottom="3px",te=oe):W=="glb"||W=="gltf"||W=="vrm"?(oe.src=e+"gltf.png",te=oe):W=="fbx"?(oe.src=e+"fbx.png",te=oe):W=="obj"?(oe.src=e+"obj.png",te=oe):W=="mtl"?(oe.src=e+"mtl.png",te=oe):W=="stl"?(oe.src=e+"stl.png",te=oe):W=="lwo"?(oe.src=e+"lwo.png",te=oe):W=="dae"?(oe.src=e+"dae.png",te=oe):W=="3ds"&&(oe.src=e+"3ds.png",te=oe)):Ce=="motion"?(te.classList.add("bi-universal-access-circle"),te.style.color="#4D7",ve="#4A4"):Ce=="pose"?(te.classList.add("bi-universal-access"),te.style.color="#BFA",ve="#8C8"):Ce=="sound"?(te.classList.add("bi-music-note-beamed"),te.style.color="#2AF",ve="#2AF",te.onclick=function(){let we=document.getElementById("media_previewer");we==null&&(we=document.createElement("div"),we.id="media_previewer",we.style.background="#333",we.style.borderRadius="10px",we.style.padding="10px",we.style.position="fixed",we.style.left="100px",we.style.top="100px",we.style.zIndex="4",document.body.appendChild(we));const Se=te.getBoundingClientRect();console.log(Se.top,Se.right,Se.bottom,Se.left),we.style.top=Se.top+"px",we.style.left=Se.left+"px";const Re=document.createElement("figure"),Fe=document.createElement("figcaption"),$e=document.createElement("audio");Fe.innerText=q.innerText,$e.src=Z.file,$e.setAttribute("controls",""),$e.setAttribute("autoplay",""),$e.style.padding="5px",Re.style.position="relative";const Ue=document.createElement("i");Ue.classList.add("bi"),Ue.classList.add("bi-x-circle"),Ue.style.position="absolute",Ue.style.right="0px",Ue.style.top="0px",Ue.style.textShadow="0 0 3px #222",Ue.onclick=function(qe){qe.preventDefault(),qe.stopPropagation(),we.remove()},Re.appendChild(Ue),Re.appendChild(Fe),Re.appendChild($e),we.appendChild(Re)}):Ce=="image"?te.classList.add("bi-image"):Ce=="script"?(te.classList.add("bi-file-alt"),te.style.color="#FFA",ve="#AAA",W=="js"?(oe.src=e+"js.svg",te=oe):W=="json"&&(oe.src=e+"json.png",te=oe)):Ce=="etc"?te.classList.add("bi-slash-circle-fill"):Ce=="j_object"?W=="object"?(oe.src=e+"object.png",te=oe,ve="#C3C"):W=="material"?(te.classList.add("bi-slash-circle-fill"),te.style.color="#25F",ve="#25A"):W=="motion"?(te.classList.add("bi-universal-access"),te.style.color="#0B0",ve="#0B0"):(te.classList.add("bi-archive"),te.style.color="#F5F",ve="#A2C"):Ce=="project"&&(te.classList.add("bi-archive-fill"),te.style.color="#F55",ve="#F55"),H.style.border="2px solid "+ve,H.style.borderRadius="5px",H.appendChild(te)}H.style.opacity="0.5",H.onmouseover=function(W){const te=K(H);q.style.fontSize="12px",q.style.top=te.top+10+"px",q.style.left=te.left-te.width*1.75+"px",q.style.display="block",H.style.opacity="1.0"},H.onmouseleave=function(W){q.style.display="none",H.style.opacity="0.5"},await __storage__.editor_permanent.get("last_pin_file_path")==Z.file&&(S=H),H.ondblclick=async function(W){await __storage__.editor_permanent.set("last_pin_file_path",Z.file),UIL.load_files([Z.file],{confirm:!1})},H.ondragstart=function(W){W.dataTransfer.setData("json",JSON.stringify({items:[Z.file],target_file_paths:[{absolute_path:Z.file}]})),W.stopPropagation()},H.onmousedown=function(W){H.style.opacity="0.5"},H.onmouseup=function(W){if(H.style.opacity="1.0",W.button==2){async function te(oe){if(oe.code=="KeyD"){await window.cross_file_system.remove(Z.dataset.absolute_path,{existence_check:!0});for(let Ce=0;Ce<f.length;Ce++)if(Z==f[Ce].element){f[Ce].element.remove(),f.splice(Ce,1);break}oe.preventDefault(),oe.stopPropagation()}}const ie=["Open in App","Open in Folder","---","Screenshot","---","Unpin"];C$2.popup_menu(W,ie,{event_listener:te},async oe=>{if(oe=="Open in App")window.cross_file_system.open_in_app(Z.file),window.file_browser.open(C$2.DPath(Z.file).dirname);else if(oe=="Open in Folder")window.cross_file_system.open_folder(Z.file),window.file_browser.open(C$2.DPath(Z.file).dirname);else if(oe=="Screenshot")await C$2.screenshot(Z.file,{type:"save",thumbnail:!0,w:512}),k({refresh:!0});else if(oe=="Unpin"){const Ce=await get_pin_item();delete Ce[Z.file],await set_pin_item(Ce),await make_file_history_menu()}});return}},H.appendChild(Y),y.appendChild(H)}}async function k(O={refresh:!1}){w.innerHTML="",y.innerHTML="";const L={};for(const N of Object.values(_)){const z=C$2.file_type2(N.file);L[z]||(L[z]=[]),L[z].push(N)}const P=Object.keys(L).sort((N,z)=>N=="project"?-1:N<z?1:N>z?-1:0).reduce((N,z)=>(N[z]=L[z],N),{});for(const N in P){const z=P[N];z.sort((K,Z)=>K.date<Z.date?1:K.date>Z.date?-1:0),await D(z,O),y.appendChild(document.createElement("hr"))}y.appendChild(M),w.appendChild(y)}window.pin_drag_and_drop=async O=>{const L=C$2.DPath(O.item).path;_[L]={file:L},v.element.remove(),await set_pin_item(_),await make_file_history_menu()},UC$1.make_drag_and_drop(y,{file:!0,directory:!1,recursive:!1},window.pin_drag_and_drop),await k(),S&&setTimeout(()=>{S.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},100),u.oninput=k}m();async function h(){const b=(await __storage__.editor.get("activity_window_search_box_sentence",u.value.trim())).split(" ");for(let v=0;v<f.length;v++){const w=f[v];let y=!0;for(const M of b)if(w.full_data.toLowerCase().indexOf(M.toLowerCase())==-1){y=!1;break}y?w.element.style.display="flex":w.element.style.display="none"}}a=[];for(const _ in a){const b=a[_],w=UC$1.make_toggle_window(l,{title:`${_.charAt(0).toUpperCase()+_.slice(1)}`},()=>{}).holder;let y=Object.values(b).sort((M,S)=>M.date<S.date?1:M.date>S.date?-1:0);y=y.slice(0,10);for(const M of y){{const K=document.createElement("option");K.value=M.file,d.appendChild(K)}const S=document.createElement("div");S.dataset.absolute_path=M.file,S.draggable=!0,S.style.display="flex",S.style.alignItems="center",S.style.position="relative",S.style.width="100%",S.style.height="18px",S.ondragstart=function(K){K.dataTransfer.setData("json",JSON.stringify({items:[M.file],target_file_paths:[{absolute_path:M.file}]})),K.stopPropagation()};const D=document.createElement("button");D.style.borderRadius="0px",D.style.backgroundColor="#222",D.style.display="inline-block",D.style.overflow="hidden",D.style.whiteSpace="nowrap",D.style.fontSize="10px",D.style.height=S.style.height,D.style.fontFamily="monospace",D.style.direction="rtl",D.style.textAlign="right",D.style.marginLeft="auto",M.thumbnail?D.style.width="calc(100% - 10px)":D.style.width="100%";const k=M.file.split("/"),O=k.pop(),L=O.slice(0,O.lastIndexOf(".")),P=O.split(".").pop(),N=k.join("/");D.innerHTML=`‪<span style="color:#666;">${N}/</span><span style="color:#C66;font-size:10px">${L}</span><span style="color:#BB3">.${P}</span>‬`;const z=D.ondblclick=function(K){console.log(K),UIL.load_files([M.file]),K.preventDefault(),K.stopPropagation()};if(D.oncontextmenu=function(K){const Z=["Open in Folder",{key:"<span style='float:left'>Remove</span><span style='float:right;color:gray'>D</span>",value:"Remove"},"Delete with actual file"];M.thumbnail&&Z.push("Make Thumbnail"),C$2.popup_menu(K,Z,{event_listener:async V=>{if(V.button==null&&V.code=="KeyD"){{const H=await get_project_history();delete H[M.file],await set_project_history(H)}{const H=await get_file_history();delete H[M.file],await set_file_history(H)}await make_project_history_menu(),await make_file_history_menu(),window.file_browser&&await window.file_browser.update()}}},async V=>{if(V=="Delete with actual file"){if(await C$2.modal_ok_cancel_promise(window.T("g.confirmation"),"Are you sure to delete?",{})){{const Y=await get_project_history();delete Y[M.file],await set_project_history(Y)}{const Y=await get_file_history();delete Y[M.file],await set_file_history(Y)}await window.cross_file_system.remove(M,{existence_check:!0});const H=C$2.make_thumbnail_path(M.file);await window.cross_file_system.remove(H,{existence_check:!0}),await make_project_history_menu(),await make_file_history_menu(),window.file_browser&&await window.file_browser.update()}}else if(V=="Make Thumbnail")await C$2.screenshot(M.file,{type:"save",thumbnail:!0,w:512}),await make_file_history_menu();else if(V=="Delete"){{const H=await get_project_history();delete H[M.file],await set_project_history(H)}{const H=await get_file_history();delete H[M.file],await set_file_history(H)}await make_project_history_menu(),await make_file_history_menu(),window.file_browser&&await window.file_browser.update()}else V=="Open in Folder"&&window.nodejs&&window.nodejs.open_in_finder(M.file)}),K.preventDefault(),K.stopPropagation()},S.appendChild(D),M.thumbnail){const K=C$2.make_thumbnail_path(M.file),Z=async()=>{const V=document.createElement("div"),H="12px";V.style.fontSize="10px",V.style.width=H,V.style.height=H,V.style.outline="1px solid #111";try{const Y=await window.cross_file_system.read(K),q=new Blob([Y],{type:"application/octet-binary"}),J=window.URL.createObjectURL(q);let W=0;const te=document.createElement("div");S.classList.add("activity_history_thumbnail"),te.style.width=H,te.style.height=H;const ie=document.createElement("img"),oe=document.createElement("img");ie.style.width=H,ie.style.height=H,te.append(ie),ie.onload=function(){W--,W==0&&window.URL.revokeObjectURL(J)},ie.onerror=function(ve){te.parentNode.replaceChild(V,te),te.remove(),W--,W==0&&window.URL.revokeObjectURL(J),ie.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},oe.onload=function(){W--,W==0&&window.URL.revokeObjectURL(J)},oe.onerror=function(){W--,W==0&&window.URL.revokeObjectURL(J),ie.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},W++,W++,oe.src=J,ie.src=J;const Ce=document.createElement("span");Ce.append(oe),te.appendChild(Ce),te.ondblclick=z,S.appendChild(te)}catch{V.onclick=async function(){const J=M.file.split("/").pop(),W=s.current.object?.name;let te=!0;W!=J&&(te=await C$2.modal_ok_cancel_promise("Warn","Does not match current object name and thumbnail.",{ok:"Force"})),te&&(await C$2.screenshot(M.file,{type:"save",thumbnail:!0,w:512}),Z(),V.remove())};const q=document.createElement("i");q.classList.add("bi"),q.classList.add("bi-camera"),q.classList.add("flex-center"),q.style.color="#999",V.appendChild(q),V.ondblclick=z,S.appendChild(V)}};Z()}f.push({element:S,short_data:M.file,full_data:M.file}),w.appendChild(S)}await h()}}function VersionInfo(){let s=[],e="w",i=window.SDK_VERSION;return window.nodejs&&(e="e"),s.push(`${e}`+i+"r"+THREE.REVISION),s=s.filter(r=>r&&r.length>0),s.join("")}let timer_title_marquee=null;async function update_window_title(s){if(window.app_mode)return;let e=[],i=window.SDK_VERSION,r="DDD";if(window.nodejs&&(r=window.nodejs.config.package.name),e.push(r),e.push('"'+s.split("/").pop().split(".")[0]+'"'),e.push("@"+i+"+r"+THREE.REVISION),e=e.filter(o=>o&&o.length>0),window.is_electron){const o=e.join(" ");document.title=o}else{const o=e.join(" ")+" | ";timer_title_marquee&&clearInterval(timer_title_marquee);let l=0;timer_title_marquee=setInterval(()=>{const a=l%o.length;document.title=o.slice(a)+o.slice(0,a),l+=2},1500)}}async function make_project_history_menu(){const s=document.getElementById("history_menu");if(s==null)return;const e=await get_project_history();await GetProjectPath();const i=[],r=[],o=[];for(const c in e){const d=e[c];if(d?.file){o.push(c);const u=d.file.indexOf("http:")===0||d.file.indexOf("https:")===0?new URL(d.file).pathname:d.file;r.push(window.cross_file_system.exists(u))}else i.push(c)}await Promise.all(r);let l=0;for(const c of r)await c||i.push(o[l]),l++;for(const c of i)delete e[c];await set_project_history(e);const a=Object.values(e).sort((c,d)=>c.date<d.date?1:c.date>d.date?-1:0);s.innerHTML="";for(const c of a){const d=C$2.make_thumbnail_path(c.file),u=document.createElement("a");u.classList.add("history_link"),u.href="#",u.onclick=()=>{load_from_history(u)},u.innerText=c.file,u.oncontextmenu=f=>{f.preventDefault(),f.stopPropagation(),C$2.popup_menu(f,["Remove","Delete with actual file","Open in Folder"],{},async m=>{m=="Remove"?(delete e[c.file],await set_project_history(e),await make_project_history_menu()):m=="Delete with actual file"?(delete e[c.file],await set_project_history(e),await window.cross_file_system.remove(c.file,{existence_check:!0}),await window.cross_file_system.remove(d,{existence_check:!0}),await make_project_history_menu()):m=="Open in Folder"&&window.nodejs&&window.nodejs.open_in_finder(c.file)})},s.appendChild(u)}}function calculate_coordinates_of_tips(){const s=document.getElementsByClassName("tooltip");for(const e of s){let i=e.querySelector(".tooltiptext"),r=e.querySelector(".tooltiptext_right");if(i=i||r,i==null)continue;i.time=performance.now();const o=i.dataset.coordinate_type;e.onmouseenter=()=>{i.style.display="none",!(performance.now()-i.time<500)&&(i.time=performance.now(),i.timer=setTimeout(()=>{if(i.style.position="fixed",i.style.display="block",i){let l=e.getBoundingClientRect(),a=null;for(let u=0;u<e.children.length;u++)if(e.children[u].tagName!="SPAN"){a=e.children[u];break}a&&(l=a.getBoundingClientRect());let c=0;l.x+l.width/2+i.getBoundingClientRect().width>window.innerWidth&&(c=window.innerWidth-(l.x+l.width/2+i.getBoundingClientRect().width));let d=10;o==null?(i.style.left=Math.floor(c+l.x+l.width/2)+"px",i.style.top=Math.floor(l.y+l.height+d)+"px"):o=="right"?(i.style.left=Math.floor(c+l.x+l.width)+"px",i.style.top=Math.floor(l.y+d)+"px"):o=="left"&&(i.style.left=Math.floor(c+l.x+l.width/2)+"px",i.style.top=Math.floor(l.y+l.height+d)+"px")}},550))},e.onmouseleave=()=>{i.style.display="none",i.timer&&(clearTimeout(i.timer),i.timer=null),i.time=performance.now()}}}async function generate_preset(s,e){const i={ui:!0,auto_append:!0};e&&Object.assign(i,e),i.ui&&C$2.modal_processing("Loading","Preset: "+s);let r=null;try{r=await Builder3D.generate_preset(s,i)}catch(o){console.error(o)}return i.ui&&C$2.close_modal_processing(),r}async function select_camera_by_selector(s){const e=DMC,i=e.getObjectBySubUUID(s.target.value);i&&e.onChangeCamera(i),e.ui.generic_flags.selected_camera_sub_uuid=s.target.value}async function open_system_preferences_window(){UC$1.make_window("SystemPreferencesWindow",window.T("system_preferences.title"),{width:400,height:550,url:"ddd/ui/system_preferences.html",urlLoaded:function(s){s.iframe.contentWindow.completely_reset_settings=function(){DMC.completely_reset_settings()},s.iframe.contentWindow.reset=function(){DMC.reset()}}})}async function open_module_manager(){UC$1.make_window("ModuleManagerWindow","Module Manager",{url:"ddd/ui/plugin_manager.html",urlLoaded:function(s){s.iframe.contentWindow._on_initialized(s)}})}async function open_project_exporter_as_standalone(){if(await GetProjectPath()==null){C$2.modal_ok_cancel("Error","The project must be saved before.",{cancel:null});return}const s="ddd/ui/export_project.html";UC$1.make_window(s,T("menu.module_sub.project_archiver"),{url:s,width:300,height:440,minimizeButton:!1,maximizeButton:!1,closeButton:!0,urlLoaded:async function(e){const i=e.iframe.contentWindow;for(i.self_frame=e,i.force_zip=!1,console.log(window.external_io),window.external_io&&(i.force_zip=!0),i.archive=r=>{export_project_references(r)},i.thumbnail=async r=>{let o=await GetProjectPath();o==null&&(o="Untitled.ddd");const l=`${C$2.DPath(o).name}_${r.package_type=="Application"?"app":"scene"}_${VersionInfo()}`;console.log(l),C$2.screenshot(l+".avif",{type:"download",thumbnail:!0,w:512})};i.on_initialized==null;)await C$2.sleep(100);i.on_initialized(),e.setOnCloseFrameListener(()=>{})}})}async function export_as(s){const{export_as:e}=await __vitePreload(()=>import("./ui.exporters@DyOYhrfI.js"),[],import.meta.url);try{await e(s)}catch(i){throw C$2.modal_ok_cancel("Error",i.toString(),{cancel:null}),i}}const UI$1=Object.freeze(Object.defineProperty({__proto__:null,_a,asset_browser,calculate_coordinates_of_tips,check_file_exists_from_history,delete_all_project_history,delete_file_history,edit_project,event_notify,export_as,export_project_references,generate_preset,gltf_compressor,help_page,image_filter_ext,ktx2_compressor,ktx2_compressor_for_web,load_from_history,make_file_history_menu,make_project_history_menu,native_screen_capture,navi_menu_toggle,navi_unfocus,open_about_window,open_capture_panel,open_image_processor,open_module_manager,open_project,open_project_exporter_as_standalone,open_script_editor_for_object,open_system_preferences_window,remove_selected_objects_with_ui,report_page,screen_capture,select_camera_by_selector,store_file_history,store_project_history,update_window_title},Symbol.toStringTag,{value:"Module"}));var debug$5=window.debug;const DEBUG_JSON=!1,BuilderUtil$1=_BuilderUtil;class Builder{constructor(){this.builders=[],this.builder_light=new LightBuilder,this.builder_camera=new CameraBuilder,this.builder_object=new ObjectBuilder,this.builder_model=new ModelBuilder,this.builder_etc=new EtcBuilder,this.builders={},Object.assign(this.builders,this.builder_light.makers),Object.assign(this.builders,this.builder_camera.makers),Object.assign(this.builders,this.builder_object.makers),Object.assign(this.builders,this.builder_model.makers),this.load_texture_from_system_resource=BuilderUtil$1.load_texture_from_system_resource,this.load_texture=BuilderUtil$1.load_texture,this.load_video_texture=BuilderUtil$1.load_video_texture,this.is_image_ext=C$2.is_image_ext,this.is_sound_ext=C$2.is_sound_ext,this.is_model_ext=C$2.is_model_ext,this.is_motion_ext=C$2.is_motion_ext,this.is_j_object_ext=C$2.is_j_object_ext,this.is_pose_ext=C$2.is_pose_ext,this.file_type=C$2.file_type,this.ETC=ETC}async build_project_from_text(e){throw new Error("Not implemented yet")}async build_from_json(e,i=null,r=null,o=[],l=null,a={}){if(i instanceof DDDAttr)debugger;const c=DMC,d=getDDDProperties(e);let u=!0;d?.needs_load_file!==void 0&&(u=d.needs_load_file,delete d.needs_load_file);const f=d?.type,m=this.builders[f];l&&await l("start",{left:null,right:e}),await C$2.sleep(0);let h=!1;if(m&&u){try{r=await m(i,e)}catch(w){console.error("build_from_json:",w),c.stacked_error.push(w.toString()),l&&(h=await l("error",{error:w,j_object:e}))}if(r instanceof DDDAttr)debugger}else if(f=="sub_object"){if(r instanceof DDDAttr)debugger;if(r?r=BindObjectAsDDD(r,getDDDProperties(e)):console.warn(e.type,e.name),r instanceof DDDAttr)debugger}else if(d&&f===void 0){if(r instanceof DDDAttr)debugger;if(r?r=BindObjectAsDDD(r,getDDDProperties(e)):console.warn(e.type,e.name),r instanceof DDDAttr)debugger}else e&&r?console.info("Just attach parameter",e):e&&r==null&&console.warn("Ignored",e);if(r&&e){let w=!1;e.name=="__debug__"&&(w=!0);let y=!1;if(r.type==e.type){const M=d?.source_file;(f=="pmx"||f=="pmd"||f=="gltf"||f=="glb"||f=="fbx"||f=="vrm"||M&&e.name.length>0&&r.name==e.name||M==null&&d?.managed==!0||e.name.length==0)&&(y=!0)}if(y&&(LoadObjectProperties(r,e),LoadMaterialProperties(r,e,{isMeshToonMaterial:!0},{match_by_name:!0,breakpoint:w})),CopyObjectDecoProperties(r,e),r instanceof DDDAttr)debugger}if(i&&r&&f!="sub_object"&&i.add(r),r instanceof DDDAttr)debugger;if(r){for(const w in this.builder_etc.makers){const y=this.builder_etc.makers[w];o.push(y(r,r))}if(r instanceof DDDAttr)debugger}let _=!0;const b={},v={};if(f=="gltf"||f=="glb"||f=="fbx"||f=="vrm"){let w=function(y,M){if(y.children)for(let S=0;S<y.children.length;S++){const D=y.children[S];D.name.length>0&&(M[D.name]=D),w(D,M)}};w(r,b),w(e,v),_=!0}if(h==!1){if(f=="gltf"||f=="glb"||f=="fbx"||f=="vrm"){if(_){for(const w in v)if(b[w]){const y=b[w],M=v[w];LoadObjectProperties(y,M),LoadMaterialProperties(y,M),y.material!=null&&debug$5&&console.log(y.name,y.material?.visible,M.name,M.material?.visible)}}}else if(e.children)for(let w=0;w<e.children.length;w++){const y=e.children[w],M=r?.children?.[w];if(o.push(this.build_from_json(y,r,M,o,l,a)),r instanceof DDDAttr)debugger}}return l&&await l("end",{left:r,right:e}),r}async build_by_type(e){let i=null;const r=this.builders[e];return r&&(i=await r()),DMC?.transform_controls&&DMC.transform_controls.detach(),i}async build_by_file_path(e,i){let r=null;const o=e.split(".").pop().toLowerCase(),l=this.builders[o],a=this.builder_etc.makers[o];return l?r=await l(void 0,e):a&&(r=await a(i,e)),DMC?.transform_controls&&DMC.transform_controls.detach(),r}async build_etc_by_file_path(e,i){let r=null;const o=e.split(".").pop().toLowerCase(),l=this.builder_etc.makers[o];return l&&(r=await l(i,e)),DMC?.transform_controls&&DMC.transform_controls.detach(),r}async build_etc(e){for(const i in this.builder_etc.makers){const r=this.builder_etc.makers[i];await r(e,e)}}async store_to_json(e,i=null,r=!1){let o=null;const l=debug$5?TimeDurationChecker(e.name+"#"+e.type):null,a=getDDDProperties(e);if(a&&a.restore){let m=function(_,b){if(!c.has(_)){if(d.has(_)){if(b instanceof Vector3){if(b.x==0&&b.y==0&&b.z==0)return}else if(b instanceof Euler){if(b.x==0&&b.y==0&&b.z==0)return}else if(b instanceof Quaternion){if(b.x==0&&b.y==0&&b.z==0&&b.w==1)return}else if(b instanceof Matrix4&&b.elements[0]==1&&b.elements[1]==0&&b.elements[2]==0&&b.elements[3]==0&&b.elements[4]==0&&b.elements[5]==1&&b.elements[6]==0&&b.elements[7]==0&&b.elements[8]==0&&b.elements[9]==0&&b.elements[10]==1&&b.elements[11]==0&&b.elements[12]==0&&b.elements[13]==0&&b.elements[14]==0&&b.elements[15]==1)return}if(!(u.has(_)&&(b==null||b==!1))&&!(f.has(_)&&b==!0)){if(_=="ui"){let v=0;for(const w in b)v+=Object.keys(b[w]).length;if(v==0)return}else{if(_=="object_attach_to"&&b==null)return;if(_=="object_attach_to_flag"&&b==!1)return;if(_=="overwrite"){if(b.material==null&&b.morph==null)return}else if(_.toLowerCase().endsWith("map")&&b.opened==!1)return}return b}}};const c=new Set(["instance","destructors","__vmd_animation__","__previous_vmd__","__action_tmp__","isMMD","_actions","_mixer","vertexShader","fragmentShader"]),d=new Set(["object_attach_rotation","object_attach_offset"]),u=new Set(["source_file","dof_target","dof_dynamic","restore_geometry","active_camera","is_background","is_helper_scene"]),f=new Set(["draggable_on_tree","droppable_on_tree","draggable_on_3d","droppable_on_3d","drawable","controllable_geometry","transform_controller","removable","cast_shadow","receive_shadow","physics","animation"]),h=JSON.parse(JSON.stringify(a,m));o={children:[],_dp_:h},SaveObjectProperties(o,e),SaveMaterialProperties(o,e);{let _=function(v){if(v==null)return!1;if(v.__class__name__=="Vector3"){if(v.x==0&&v.y==0&&v.z==0)return!0}else if(v.__class__name__=="Vector2"){if(v.x==0&&v.y==0)return!0}else if(v.__class__name__=="Euler"){if(v._x==0&&v._y==0&&v._z==0)return!0}else if(v.__class__name__=="Matrix4"){const w=v.elements;if(w[0]==1&&w[1]==0&&w[2]==0&&w[3]==0&&w[4]==0&&w[5]==1&&w[6]==0&&w[7]==0&&w[8]==0&&w[9]==0&&w[10]==1&&w[11]==0&&w[12]==0&&w[13]==0&&w[14]==0&&w[15]==1)return!0}return!1};(function(v,w,y){const M=v._dp_;y&&v.type=="Bone"&&(delete v.up,delete v.scale,delete v._matrix_,delete v._vector_,delete v.rotation,delete v.position,delete v.frustumCulled,delete v._collapsible_,delete v.isMMD,delete v.receiveShadow,delete v.castShadow,delete v.isObject3D,delete v.uuid,delete v.isBone,delete v.matrixAutoUpdate,delete v.matrixWorldNeedsUpdate,delete v.matrixWorldAutoUpdate,delete M.draggable_on_tree,delete M.droppable_on_tree,delete M.draggable_on_3d,delete M.droppable_on_3d,delete M.removable,delete M.managed,delete M.type,delete M.kind);const S=M.source_file;if(M.audio){const D=M.audio,k=D.source_file?Object.keys(D.source_file).length:0;(M.type!="audio"||S==null&&k==0)&&delete M.audio}if(delete v.ikEnabled,delete v.__getActualMatrixWorld__,delete v._animation_clock_,delete M.dof_needsUpdate,v.renderOrder==0&&delete v.renderOrder,v.isMosaicObject==!1&&delete v.isMosaicObject,v.script?.length==0&&delete v.script,v.script_mode==null&&delete v.script_mode,v.visible==!0&&delete v.visible,v.userData&&Object.keys(v.userData).length==0&&delete v.userData,M.type=="pmx"&&(y=!0),y&&(_(v._matrix_)&&delete v._matrix_,_(v.bindMatrix)&&delete v.bindMatrix,_(v.bindMatrixInverse)&&delete v.bindMatrixInverse,_(v.position)&&delete v.position,_(v.quaternion)&&delete v.quaternion,v.up&&v.up.x==0&&v.up.y==1&&v.up.z==0&&delete v.up,v.scale&&v.scale.x==1&&v.scale.y==1&&v.scale.z==1&&delete v.scale,v.material)){const D=Array.isArray(v.material)?v.material:[v.material];for(const k of D){k.visible==!0&&delete k.visible,k.depthFunc==3&&delete k.depthFunc,k.depthTest==!0&&delete k.depthTest,k.depthWrite==!0&&delete k.depthWrite,k.clippingPlanes==null&&delete k.clippingPlanes,k.clipIntersection==!1&&delete k.clipIntersection,k.clipShadows==!1&&delete k.clipShadows,k.colorWrite==!0&&delete k.colorWrite,k.polygonOffset==!1&&delete k.polygonOffset,k.polygonOffsetFactor==0&&delete k.polygonOffsetFactor,k.polygonOffsetUnits==0&&delete k.polygonOffsetUnits,k.stencilWriteMask==255&&delete k.stencilWriteMask,k.stencilFunc==519&&delete k.stencilFunc,k.stencilRef==0&&delete k.stencilRef,k.stencilFuncMask==255&&delete k.stencilFuncMask,k.stencilFail==7680&&delete k.stencilFail,k.stencilZFail==7680&&delete k.stencilZFail,k.stencilZPass==7680&&delete k.stencilZPass,k.stencilWrite==!1&&delete k.stencilWrite,k.color&&k.color.r==1&&k.color.g==1&&k.color.b==1&&delete k.color,k.emissive&&k.emissive.r==0&&k.emissive.g==0&&k.emissive.b==0&&delete k.emissive,k.specularColor&&k.specularColor.r==1&&k.specularColor.g==1&&k.specularColor.b==1&&delete k.specularColor,k.opacity==1&&delete k.opacity,k.flatShading==!1&&delete k.flatShading,k.wireframe==!1&&delete k.wireframe,k.wireframeLinewidth==1&&delete k.wireframeLinewidth,k.wireframeLinecap=="round"&&delete k.wireframeLinecap,k.wireframeLinejoin=="round"&&delete k.wireframeLinejoin,k.precision==null&&delete k.precision,k.dithering==!1&&delete k.dithering,k.toneMapped==!0&&delete k.toneMapped,k.forceSingleSide==!1&&delete k.forceSingleSide,k.motionBlur==!0&&delete k.motionBlur,k.metalness==0&&delete k.metalness,k.thickness==0&&delete k.thickness,k.clearcoatNormalScale&&k.clearcoatNormalScale.x==1&&k.clearcoatNormalScale.y==1&&delete k.clearcoatNormalScale,k.aoMapIntensity==1&&delete k.aoMapIntensity,k.emissiveIntensity==1&&delete k.emissiveIntensity,k.bumpScale==1&&delete k.bumpScale,k.displacementScale==1&&delete k.displacementScale,k.displacementBias==0&&delete k.displacementBias,k.normalScale&&k.normalScale.x==1&&k.normalScale.y==1&&delete k.normalScale,k.envMapIntensity==1&&delete k.envMapIntensity,k.lightMapIntensity==1&&delete k.lightMapIntensity,k.anisotropyRotation==0&&delete k.anisotropyRotation,k.attenuationDistance==null&&delete k.attenuationDistance,k.attenuationColor&&k.attenuationColor.r==1&&k.attenuationColor.g==1&&k.attenuationColor.b==1&&delete k.attenuationColor,k.sheenColor&&k.sheenColor.r==1&&k.sheenColor.g==1&&k.sheenColor.b==1&&delete k.sheenColor,k.specularIntensity==1&&delete k.specularIntensity,k.normalMapType==0&&delete k.normalMapType,k.fog==!0&&delete k.fog,k.forceSinglePass==!1&&delete k.forceSinglePass,k._transmission==0&&delete k._transmission,delete k.isMeshStandardMaterial,delete k.isMeshPhysicalMaterial;for(const O in k)O.endsWith("Map")&&k[O]==null&&delete k[O];for(const O in k){const L=k[O]?.__class__name__;if(typeof L=="string"&&L.endsWith("Texture")){const P=k[O];P.offset&&P.offset.x==0&&P.offset.y==0&&delete P.offset,P.repeat&&P.repeat.x==1&&P.repeat.y==1&&delete P.repeat,P.center&&P.center.x==0&&P.center.y==0&&delete P.center,P.rotation==0&&delete P.rotation}}delete k._anisotropy}}})(o,null,r)}{let _=function(v){return typeof v=="number"?parseFloat(v.toFixed(6)):v},b=function(v){for(const w in v)typeof v[w]=="object"?b(v[w]):v[w]=_(v[w])};b(o)}e.type=="Scene"&&(e.background instanceof Texture&&delete o.background,e.environment instanceof Texture&&delete o.environment),a.restore_geometry&&e.geometry&&(o.geometry=e.geometry.toJSON(),o.geometry.__class__name__="GeometryBuffer",console.log("Store Geometry:",e.name)),i&&o&&i.children.push(o),h.type=="pmx"&&(r=!0);for(const _ of e.children)await this.store_to_json(_,o,r);o&&o.children?.length==0&&delete o.children}return l?.finish?.(),o}async load_project(e,i={}){window.lock_rendering();const r=DMC,o={flags:!0,objects:!0,path_adjust:!0,observer:null};i&&Object.assign(o,i);let l=null;if(r.project_setting=e.project_setting||{},r.star=e.star,r.license=e.license,r.project_thumbnail_lock_flag=e.lock_thumbnail,r.secret=e.secret,o.flags){let d=function(u){r.ui[u]={},e[u]&&(r.ui[u]=e[u])};d("generic_flags"),d("renderer_flags"),d("material_flags"),d("rigid_body_flags"),d("bone_flags"),d("light_flags"),d("system_flags")}const a=e.instance||e.scene;if(SanitizeOlderProperties(a),o.path_adjust){const d=o.base_path;if(r.ui?.system_flags?.absolute_path!==void 0){if(r.ui.system_flags.absolute_path==!1){if(d==null){debugger;throw new Error("Required base path.")}const u=C$2.DPath(d);let f=!1;u.is_absolute_path==!1&&(f=!0),BuilderUtil$1.convert_to_abs_path(d,a,{left_should_be_absolute_path:f})}{const u=e.renderer_flags?.environment_map?.file,f=e.renderer_flags?.environment_map?.is_system_resource;if(u&&!f){const m=C$2.DPath(u);let h=null;if(m.is_absolute_path)h=m.path;else if(o.left_should_be_absolute_path){const _="/"+d,b=m.path;h=C$2.path.join(C$2.DPath(_).dirname,b),h=h.slice(1,h.length)}else if(d.indexOf("://")>=0){const _=new URL(d);h=_.origin+C$2.path.join(C$2.DPath(_.pathname).dirname,m.path)}else h=C$2.path.join(C$2.DPath(d).dirname,m.path);h&&(e.renderer_flags.environment_map.file=h)}}}}if(o.objects){const d=[];l=await this.build_from_json(a,null,null,d,o.observer,o);for(let u=0;u<d.length;u++)try{await d[u]}catch(f){if(o.observer&&await o.observer("error",{error:f})==!1)throw f}if(r.scene){LoadObjectProperties(r.scene,l,{type:!0,name:!0}),CopyObjectDecoProperties(r.scene,l);const u=[];for(const f of l.children)u.push(f);for(const f of u)l.remove(f),r.scene.add(f)}else r.scene=l;r.scene.updateWorldMatrix(!0,!0),e.current_object_sub_uuid&&(r.current.object=r.getObjectBySubUUID(e.current_object_sub_uuid))}const c=[];l?.traverse(d=>{const u=d?.getDDDProperties?.();if(u){const f=u.on_ready?.();c.push(f)}d.isMesh&&c.push(BuilderUtil$1.tessellate(d))});try{await Promise.all(c)}catch(d){if(o.observer&&await o.observer("error",{error:d})==!1)throw d}return setTimeout(()=>{r.scene&&r.scene.traverse(d=>{const u=d.getDDDProperties?.();if(u){if(d.type=="PerspectiveCamera"){let f=function(m){if(m.type=="PerspectiveCamera"&&(d.position.copy(m.position),d.up.copy(m.up),d.coordinateSystem=m.coordinateSystem,d.fov=m.fov,d.zoom=m.zoom,d.near=m.near,d.far=m.far,d.focus=m.focus),m.children)for(const h of m.children)f(h)};f(a)}if(u.apply_attach_object(d),u.spectrum_audio_source&&d.setAudio){const f=r.scene.find(u.spectrum_audio_source,!0);f&&(f.__on_started_audio__=function(){d.setAudio(f)})}}})},1e3),DMC?.transform_controls&&r.transform_controls.detach(),update_window_title(await GetProjectPath()||"Untitled"),window.unlock_rendering(),l}async load_object(e,i,r={}){window.lock_rendering();const o=DMC;try{const l={};r&&Object.assign(l,r);let a=null;const c=[],d=i.instance,u=i.export_params,f={};if(u)for(const _ in u){const b=u[_];f[b.label]=b}const m=l.base_path;if(m==null){debugger;throw new Error("Required base path.")}if(i&&f?.AbsolutePath?.value==!1){const _=C$2.DPath(m);let b=!1;_.is_absolute_path==!1&&(b=!0),BuilderUtil$1.convert_to_abs_path(m,d,{left_should_be_absolute_path:b})}a=await this.build_from_json(d,null,e,c,l.observer,l);for(let _=0;_<c.length;_++)try{await c[_]}catch(b){if(l.observer&&await l.observer("error",{error:b})==!1)throw b}const h=a._dp_;return h&&(h.j_object_source_file=m),setTimeout(()=>{o.scene&&o.scene.traverse(_=>{const b=_.getDDDProperties?.();b&&b.apply_attach_object(_)})},1e3),await h?.on_ready?.(),DMC?.transform_controls&&o.transform_controls.detach(),window.unlock_rendering(),a}catch(l){throw window.unlock_rendering(),l}return null}async save_project(e=void 0,i={}){const r=DMC;window.lock_rendering(),r.dispatchEvent("before_save@scene",{});const o={both_should_be_absolute:!1,store_file:!0,force_absolute_path:!1};i&&Object.assign(o,i),e===void 0&&(e=await GetProjectPath()),C$2.modal_processing(e==null?window.T("menu.file_sub.save_project_as"):window.T("menu.file_sub.save_project"),""),await C$2.sleep(250);let l,a;if(e==null){const w=await GetProjectPath();if(window.nodejs){const y={filters:[{name:"Project file",extensions:["ddd"]}]},M=await __storage__.project.get("previous_project_file");if(M&&(y.defaultPath=M),w&&(y.defaultPath=w),a=await window.cross_file_system.save_dialog(y),!a?.[0]){C$2.close_modal_processing(),window.unlock_rendering();return}}else{let y=w??C$2.path.join("/DScene","untitled.ddd");e&&await window.external_io.exists(e)&&(y=e);let M="";if(M+=`URL : <input type='text' autocomplete='off' id="project_path" style='width:90%' onchange='console.log(this.value);document.getElementById("project_path").value=this.value;' value='${y}'>`,setTimeout(()=>{const k=document.getElementById("project_path");if(k){const O=k.value;k.focus(),console.log("FOCUS:",O),k.setSelectionRange(O.lastIndexOf("/")+1,O.lastIndexOf("."))}},50),await C$2.sleep(50),C$2.close_modal_processing(),await C$2.modal_ok_cancel_promise("Project Location",M,{ok:"Save",prevent_input:!1})==!1){C$2.close_modal_processing(),window.unlock_rendering();return}l=document.getElementById("project_path").value}}let c=null;const d=r.current?.object?.getDDDProperties?.();d&&(c=d.uuid);const u=window.external_io?.driver;u==null||u=="local"||(o.both_should_be_absolute=!0),debug$5&&console.log("Clone project");const f=C$2.clone({current_object_sub_uuid:c,project_setting:r.project_setting??{},instance:null,generic_flags:r.ui.generic_flags??{},renderer_flags:r.ui.renderer_flags??{},system_flags:r.ui.system_flags??{},star:r.star,material_flags:r.ui.material_flags??{},rigid_body_flags:r.ui.rigid_body_flags??{},bone_flags:r.ui.bone_flags??{},light_flags:r.ui.light_flags??{}});if(debug$5&&console.log("Check with dialog"),e&&await window.cross_file_system.exists(e))try{const w=await C$2.s_decode_async(await window.cross_file_system.read(e));r.star=w.star,r.license=w.license,r.secret=w.secret,r.project_thumbnail_lock_flag=w.lock_thumbnail}catch(w){console.error(w)}debug$5&&console.log("Object to JSON"),f.instance=await this.store_to_json(r.scene),f.star=r.star,f.license=r.license,f.secret=r.secret,f.lock_thumbnail=r.project_thumbnail_lock_flag,f.SDK_VERSION=window.SDK_VERSION;const m=f.lock_thumbnail!=!0;async function h(){const w=await GetProjectPath();r.ui?.system_flags?.absolute_path==!1&&o.force_absolute_path==!1&&(BuilderUtil$1.convert_to_relative_path(w,f.instance,o),console.warn("Relative Path"));const y=C$2.DPath(w).dirname,M=f.renderer_flags?.environment_map?.file,S=f.renderer_flags?.environment_map?.is_system_resource;if(M&&!S){const k=C$2.DPath(M);let O=null;if(window.external_io==null&&window.nodejs&&k.path.indexOf(nodejs.root_path)==0&&(O=k.path),O==null)if(o.both_should_be_absolute){const L="/"+y,P="/"+k.path;O=C$2.path.relative(C$2.DPath(L).dirname,P)}else k.is_absolute_path?O=C$2.path.relative(C$2.DPath(y).dirname,k.path):O=k.path;O&&(f.renderer_flags.environment_map.file=O)}return debug$5&&console.log("Encode"),await C$2.s_encode_async(f)}console.log(`Absolute Path: ${r.ui?.system_flags?.absolute_path}`);const _=e&&e.indexOf("http")==0;function b(w){const y=C$2.DPath(w).ext;return y=="ddd"||y=="mmd"?w:w+".ddd"}function v(w){if(w.indexOf("/")>=0){const y=w.split("/");y.pop(),w=y.join("/")}else w="";console.log(w,window.file_browser.current_link,w==window.file_browser.current_link),w==window.file_browser.current_link&&window.file_browser&&window.file_browser.update(!1,!0,!1)}if(o.store_file){if(_)C$2.close_modal_processing(),C$2.modal_ok_cancel("Error",`"${e}"<br> The project is running on read-only mode.`,{cancel:null});else try{if(window.external_io){if(debug$5&&console.log("SaveProject:",e,window.external_io),e){if(e=e.replace(/\\/g,"/"),o.store_file){const w=await h();await window.external_io.put(e,w),m&&await C$2.screenshot(e,{type:"save",thumbnail:!0}),debug$5&&console.log("After processing."),v(e),store_project_history(e)}}else if(console.log(l),l.length>0){C$2.modal_processing(window.T("menu.file_sub.save_project_as"));try{console.log("Save"),await SetProjectPath(l);const w=window.file_browser.entry_point;if(l.indexOf(w)!=0)throw console.error(w,l),new Error("Invalid path. It should be under workspace.");l.lastIndexOf(".ddd")!=l.length-4&&(l=l+".ddd"),console.log("Save to ",l);const y=await h();await window.external_io.put(l,y),m&&await C$2.screenshot(l,{type:"save",thumbnail:!0}),v(l),store_project_history(l)}catch(w){console.error(w)}C$2.close_modal_processing()}C$2.close_modal_processing()}else if(nodejs){if(console.log("SaveProject:",e),e){e=e.replace(/\\/g,"/");const w=await h();nodejs.fs.writeFileSync(e,window.nodejs.to_nodejs_buffer(w)),m&&await C$2.screenshot(e,{type:"save",thumbnail:!0}),store_project_history(e)}else if(a?.[0]){let w=a[0];if(w){w=w.replace(/\\/g,"/"),w=b(w),e=w,await SetProjectPath(e);const y=await h();nodejs.fs.writeFileSync(e,window.nodejs.to_nodejs_buffer(y)),m&&await C$2.screenshot(e,{type:"save",thumbnail:!0}),store_project_history(e)}}C$2.close_modal_processing()}else C$2.close_modal_processing(),C$2.modal_ok_cancel("Error","<div>Online storage is not enabled.</div>",{cancel:null},w=>{})}catch(w){console.error(w),C$2.close_modal_processing(),C$2.modal_ok_cancel("Error",""+w,{cancel:null},y=>{})}update_window_title(e||"Untitled")}return window.unlock_rendering(),window.file_browser?.sync_directory_button?.(),f}async load_j_object(e){const i=await window.cross_file_system.read(e);let r=null;try{r=await C$2.s_decode_async(i)}catch{r=C$2.b_decode(i)}return r}async store_j_object(e,i){const r=C$2.s_encode_async(i);await window.cross_file_system.write(e,r)}async replace_path_as_absolute(e,i){const r={};i&&Object.assign(r,i);const o=window.external_io?.driver;o==null||o=="local"||(r.both_should_be_absolute=!0);const l=await load_j_object(e),a=l.instance,c=C$2.DPath(e),d=c.dirname;if(!l.system_flags.absolute_path){let u=!1;c.is_absolute_path==!1&&(u=!0),BuilderUtil$1.convert_to_abs_path(d,a,{left_should_be_absolute_path:u}),l.system_flags.absolute_path=!0,await this.store_j_object(e,l)}}async replace_path_as_relative(e,i){const r={};i&&Object.assign(r,i);const o=window.external_io?.driver;o==null||o=="local"||(r.both_should_be_absolute=!0);const l=await load_j_object(e),a=l.instance,c=C$2.DPath(e),d=c.dirname;l.system_flags.absolute_path&&(c.is_absolute_path==!1,BuilderUtil$1.convert_to_relative_path(d,a,r),l.system_flags.absolute_path=!1,await this.store_j_object(e,l))}remove_object(e,i={}){const r=DMC;if(e!=null){if(window.lock_rendering(),e instanceof Object3D){let o=function(c){if(Array.isArray(c)&&c.length>0){for(let d=0;d<c.length;d++)if(c[d]instanceof Material)return!0}else if(c instanceof Material)return!0;return!1},l=function(c){let d=[];Array.isArray(c)?d=c:d.push(c);for(const u of d){u.dispose&&u.dispose();for(const f in u){const m=u[f];f.indexOf("map")>=0&&debug$5&&console.warn(m),m&&m instanceof Texture&&(m.no_delete||(m.destruct&&(m.destruct(),debug$5&&console.log("Destruct Texture:",m.source_file||m._source_file_)),m.dispose&&(m.dispose(),debug$5&&console.log("Dispose Texture:",m.source_file||m._source_file_)),m.dispose_watcher&&(m.dispose_watcher(),delete m.dispose_watcher)))}}};r.transform_controls&&r.transform_controls.detach(),r.progressive_surface_map=null;try{const c=getDDDProperties(e);(C$2.is_model_ext(c?.type)||e instanceof SkinnedMesh||e instanceof Camera||e instanceof Audio$1)&&r.mmd_animation_helper.remove(e)}catch(c){debug$5&&console.log(c)}e.parent&&e.parent.remove(e),r.progressive_light_map_lights=[],r.progressive_light_map_objects=[],r.enabled_progressive_surface_map&&(console.warn("TODO: Light object bug."),r.add_to_progressive_surfacemap());const a=[];e.traverse(c=>{a.push(c)});for(const c of a)c.removeFromParent();for(const c of a){const d=getDDDProperties(c);if(d&&(d.destruct(),d.audio))try{d.audio.instance?.stop?.()}catch{}for(const u in c){const f=c[u];o(f)?(l(f),debug$5&&console.log("Dispose material:",u,c.name)):!(f instanceof Object3D)&&f?.dispose&&typeof f.dispose=="function"&&(f.dispose(),debug$5&&console.log("Dispose:",u,c.name))}c.dispose&&c.dispose()}r.current.object=null,r.dispatchEvent("change@scene",{object:e,auto_focus:!1})}else{e.destruct&&e.destruct(),e.dispose_watcher&&(e.dispose_watcher(),delete e.dispose_watcher);for(const o in e){const l=e[o];!(l instanceof Object3D)&&l?.dispose&&typeof l.dispose=="function"&&l.dispose()}e.dispose&&e.dispose()}r.transform_controls&&r.transform_controls.detach(),window.unlock_rendering()}}remove_object_by_type(e){window.lock_rendering();const i=DMC.scene,r=[];i.traverse(function(o){const l=getDDDProperties(o);l&&l.type==e&&r.push(o)});for(const o of r)this.remove_object(o);window.unlock_rendering()}remove_object_by_kind(e){window.lock_rendering();const i=DMC.scene,r=[];i.traverse(function(o){const l=getDDDProperties(o);l&&l.kind==e&&r.push(o)});for(const o of r)this.remove_object(o);window.unlock_rendering()}replace_object(e,i){const r=DMC,o=e.parent;if(o==null)return;window.lock_rendering();const l=o.children.slice(),a=[];for(let c=0;c<l.length;c++){const d=l[c];d==e?a.push(i):a.push(d)}for(let c=0;c<l.length;c++){const d=l[c];d==e?this.remove_object(e):o.remove(d)}for(let c=0;c<a.length;c++)o.add(a[c]);if(r.mmd_animation_helper)try{r.mmd_animation_helper.remove(e)}catch{}window.unlock_rendering(),r.dispatchEvent("change@scene",{object:e,focus_object:i})}async duplicate_current_object(){const e=DMC,i=e.current.object;if(i){const r=await this.store_to_json(i),o=[],l=await this.build_from_json(r,null,e.scene,o,null,{});let a=0;l.name=l.name.split(" Copied")[0],l.name+=" Copied",e.scene.traverse(c=>{l.name+String(a)==c?.name&&a++}),l.name+=String(a),e.scene.add(l),await l.getDDDProperties()?.on_ready?.(),e.dispatchEvent("change@scene",{focus_object:l})}}async load_from_j_object(e){const i=DMC,r=[],o=await this.build_from_json(e,null,i.scene,r,null,{});let l=0;o.name=o.name.split(" Copied")[0],o.name+=" Copied",i.scene.traverse(a=>{o.name+String(l)==a?.name&&l++}),o.name+=String(l),i.scene.add(o),await o.getDDDProperties()?.on_ready?.(),i.dispatchEvent("change@scene",{focus_object:o})}async generate_preset(e,i){const r=DMC,o=r.scene.isXRMode,l={auto_append:!0};i&&Object.assign(l,i);let a=null;e.indexOf('"')>=0&&(e=e.split('"')[1]),e=e.toLowerCase(),e=e.replace(/ /g,"_");function c(d){return l.auto_append&&r.scene.add(d),a=d,d}return e=="day_preset"?(this.remove_object_by_kind("light"),c(await this.build_by_type("ambient_light")),c(await this.build_by_type("directional_light")),c(await this.build_by_type("hemisphere_light"))):e=="evening_preset"?(this.remove_object_by_kind("light"),c(await this.build_by_type("directional_light"))):e=="night_preset"?(this.remove_object_by_kind("light"),c(await this.build_by_type("point_light"))):c(await this.build_by_type(e)),a&&(r.current.object=a),o&&r.xr.applyScaling(!0,a),r.transform_controls&&r.transform_controls.detach(),r.dispatchEvent("change@scene",{}),r.needsPrecompile=!0,a}}const _q$1=new Quaternion,_targetPos=new Vector3,_targetVec=new Vector3,_effectorPos=new Vector3,_effectorVec=new Vector3,_linkPos=new Vector3,_invLinkQ=new Quaternion,_linkScale=new Vector3,_axis=new Vector3,_vector=new Vector3,_matrix$1=new Matrix4;class CCDIKSolver{constructor(e,i=[]){this.mesh=e,this.iks=i,this._valid()}update(){const e=this.iks;for(let i=0,r=e.length;i<r;i++)this.updateOne(e[i]);return this}updateOne(e){const i=this.mesh.skeleton.bones,r=Math,o=i[e.effector],l=i[e.target];_targetPos.setFromMatrixPosition(l.matrixWorld);const a=e.links,c=e.iteration!==void 0?e.iteration:1;for(let d=0;d<c;d++){let u=!1;for(let f=0,m=a.length;f<m;f++){const h=i[a[f].index];if(a[f].enabled===!1)break;const _=a[f].limitation,b=a[f].rotationMin,v=a[f].rotationMax;h.matrixWorld.decompose(_linkPos,_invLinkQ,_linkScale),_invLinkQ.invert(),_effectorPos.setFromMatrixPosition(o.matrixWorld),_effectorVec.subVectors(_effectorPos,_linkPos),_effectorVec.applyQuaternion(_invLinkQ),_effectorVec.normalize(),_targetVec.subVectors(_targetPos,_linkPos),_targetVec.applyQuaternion(_invLinkQ),_targetVec.normalize();let w=_targetVec.dot(_effectorVec);if(w>1?w=1:w<-1&&(w=-1),w=r.acos(w),!(w<1e-5)){if(e.minAngle!==void 0&&w<e.minAngle&&(w=e.minAngle),e.maxAngle!==void 0&&w>e.maxAngle&&(w=e.maxAngle),_axis.crossVectors(_effectorVec,_targetVec),_axis.normalize(),_q$1.setFromAxisAngle(_axis,w),h.quaternion.multiply(_q$1),_!==void 0){let y=h.quaternion.w;y>1&&(y=1);const M=r.sqrt(1-y*y);h.quaternion.set(_.x*M,_.y*M,_.z*M,y)}b!==void 0&&h.rotation.setFromVector3(_vector.setFromEuler(h.rotation).max(b)),v!==void 0&&h.rotation.setFromVector3(_vector.setFromEuler(h.rotation).min(v)),h.updateMatrixWorld(!0),u=!0}}if(!u)break}return this}createHelper(e){return new CCDIKHelper(this.mesh,this.iks,e)}_valid(){const e=this.iks,i=this.mesh.skeleton.bones;for(let r=0,o=e.length;r<o;r++){const l=e[r],a=i[l.effector],c=l.links;let d,u;d=a;for(let f=0,m=c.length;f<m;f++)u=i[c[f].index],d.parent!==u&&console.warn("THREE.CCDIKSolver: bone "+d.name+" is not the child of bone "+u.name),d=u}}}function getPosition(s,e){return _vector.setFromMatrixPosition(s.matrixWorld).applyMatrix4(e)}function setPositionOfBoneToAttributeArray(s,e,i,r){const o=getPosition(i,r);s[e*3+0]=o.x,s[e*3+1]=o.y,s[e*3+2]=o.z}class CCDIKHelper extends Object3D{constructor(e,i=[],r=.25){super(),this.root=e,this.iks=i,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new SphereGeometry(r,16,8),this.targetSphereMaterial=new MeshBasicMaterial({color:new Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new MeshBasicMaterial({color:new Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new MeshBasicMaterial({color:new Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new LineBasicMaterial({color:new Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}updateMatrixWorld(e){const i=this.root;if(this.visible){let r=0;const o=this.iks,l=i.skeleton.bones;_matrix$1.copy(i.matrixWorld).invert();for(let a=0,c=o.length;a<c;a++){const d=o[a],u=l[d.target],f=l[d.effector],m=this.children[r++],h=this.children[r++];m.position.copy(getPosition(u,_matrix$1)),h.position.copy(getPosition(f,_matrix$1));for(let v=0,w=d.links.length;v<w;v++){const y=d.links[v],M=l[y.index];this.children[r++].position.copy(getPosition(M,_matrix$1))}const _=this.children[r++],b=_.geometry.attributes.position.array;setPositionOfBoneToAttributeArray(b,0,u,_matrix$1),setPositionOfBoneToAttributeArray(b,1,f,_matrix$1);for(let v=0,w=d.links.length;v<w;v++){const y=d.links[v],M=l[y.index];setPositionOfBoneToAttributeArray(b,v+2,M,_matrix$1)}_.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(i.matrixWorld),super.updateMatrixWorld(e)}dispose(){this.sphereGeometry.dispose(),this.targetSphereMaterial.dispose(),this.effectorSphereMaterial.dispose(),this.linkSphereMaterial.dispose(),this.lineMaterial.dispose();const e=this.children;for(let i=0;i<e.length;i++){const r=e[i];r.isLine&&r.geometry.dispose()}}_init(){const e=this,i=this.iks;function r(d){const u=new BufferGeometry,f=new Float32Array((2+d.links.length)*3);return u.setAttribute("position",new BufferAttribute(f,3)),u}function o(){return new Mesh(e.sphereGeometry,e.targetSphereMaterial)}function l(){return new Mesh(e.sphereGeometry,e.effectorSphereMaterial)}function a(){return new Mesh(e.sphereGeometry,e.linkSphereMaterial)}function c(d){return new Line(r(d),e.lineMaterial)}for(let d=0,u=i.length;d<u;d++){const f=i[d];this.add(o()),this.add(l());for(let m=0,h=f.links.length;m<h;m++)this.add(a());this.add(c(f))}}}class MMDPhysics{constructor(e,i,r=[],o={}){if(typeof Ammo>"u")throw new Error("THREE.MMDPhysics: Import ammo.js https://github.com/kripken/ammo.js");this.manager=new ResourceManager,this.mesh=e,this.unitStep=o.unitStep!==void 0?o.unitStep:1/60,this.maxStepNum=o.maxStepNum!==void 0?o.maxStepNum:4,this.fixedCalculation=o.fixedCalculation!==void 0?o.fixedCalculation:!0,this.gravity=new Vector3(0,-9.8*10,0),o.gravity!==void 0&&this.gravity.copy(o.gravity),this.world=o.world!==void 0?o.world:null,this.bodies=[],this.constraints=[],this._init(e,i,r)}update(e){const i=this.manager,r=this.mesh;if(!r.visible)return;let o=!1;const l=i.allocThreeVector3(),a=i.allocThreeQuaternion(),c=i.allocThreeVector3();r.matrixWorld.decompose(l,a,c),(c.x!==1||c.y!==1||c.z!==1)&&(o=!0);let d;return o&&(d=r.parent,d!==null&&(r.parent=null),c.copy(this.mesh.scale),r.scale.set(1,1,1),r.updateMatrixWorld(!0)),this._updateRigidBodies(),this._stepSimulation(e),this._updateBones(),o&&(d!==null&&(r.parent=d),r.scale.copy(c)),i.freeThreeVector3(c),i.freeThreeQuaternion(a),i.freeThreeVector3(l),this}reset(){for(let e=0,i=this.bodies.length;e<i;e++)this.bodies[e].reset();return this}warmup(e){for(let i=0;i<e;i++)this.update(1/60);return this}setGravity(e){let i=new Ammo.btVector3(e.x,e.y,e.z);return this.manager.manage(i),this.world.setGravity(i),this.gravity.copy(e),this}createHelper(){return new MMDPhysicsHelper(this.mesh,this)}_init(e,i,r){const o=this.manager;let l=e.parent;l!==null&&(l=null);const a=o.allocThreeVector3(),c=o.allocThreeQuaternion(),d=o.allocThreeVector3();a.copy(e.position),c.copy(e.quaternion),d.copy(e.scale),e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.updateMatrixWorld(!0),this.world===null&&(this.world=this._createWorld(),this.setGravity(this.gravity)),this._initRigidBodies(i),this._initConstraints(r),l!==null&&(e.parent=l),e.position.copy(a),e.quaternion.copy(c),e.scale.copy(d),e.updateMatrixWorld(!0),this.reset(),o.freeThreeVector3(a),o.freeThreeQuaternion(c),o.freeThreeVector3(d)}_createWorld(){const e=new Ammo.btDefaultCollisionConfiguration,i=new Ammo.btCollisionDispatcher(e),r=new Ammo.btDbvtBroadphase,o=new Ammo.btSequentialImpulseConstraintSolver,l=new Ammo.btDiscreteDynamicsWorld(i,r,o,e),a=this.manager;return a.manage(e),a.manage(i),a.manage(r),a.manage(o),a.manage(l),l}_initRigidBodies(e){for(let i=0,r=e.length;i<r;i++)this.bodies.push(new RigidBody(this.mesh,this.world,e[i],this.manager))}_initConstraints(e){for(let i=0,r=e.length;i<r;i++){const o=e[i],l=this.bodies[o.rigidBodyIndex1],a=this.bodies[o.rigidBodyIndex2];this.constraints.push(new Constraint(this.mesh,this.world,l,a,o,this.manager))}}_stepSimulation(e){if(this.fixedCalculation)this.world.stepSimulation(e*.975,this.maxStepNum,this.unitStep);else{const i=this.unitStep;let r=e,o=(e/i|0)+1;r<i&&(r=i,o=1),o>this.maxStepNum&&(o=this.maxStepNum),this.world.stepSimulation(r,o,i)}}_updateRigidBodies(){for(let e=0,i=this.bodies.length;e<i;e++)this.bodies[e].updateFromBone()}_updateBones(){for(let e=0,i=this.bodies.length;e<i;e++)this.bodies[e].updateBone()}}class ResourceManager{constructor(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[],this.ammo_objects=[]}destroy(){for(let e of this.transforms)Ammo.destroy(e);for(let e of this.quaternions)Ammo.destroy(e);for(let e of this.vector3s)Ammo.destroy(e);for(let e of this.ammo_objects.reverse())Ammo.destroy(e);this.transforms=[],this.quaternions=[],this.vector3s=[],this.ammo_objects=[]}manage(e){this.ammo_objects.push(e)}allocThreeVector3(){return this.threeVector3s.length>0?this.threeVector3s.pop():new Vector3}freeThreeVector3(e){this.threeVector3s.push(e)}allocThreeMatrix4(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new Matrix4}freeThreeMatrix4(e){this.threeMatrix4s.push(e)}allocThreeQuaternion(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new Quaternion}freeThreeQuaternion(e){this.threeQuaternions.push(e)}allocThreeEuler(){return this.threeEulers.length>0?this.threeEulers.pop():new Euler}freeThreeEuler(e){this.threeEulers.push(e)}allocTransform(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform}freeTransform(e){this.transforms.push(e)}allocQuaternion(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion}freeQuaternion(e){this.quaternions.push(e)}allocVector3(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3}freeVector3(e){this.vector3s.push(e)}setIdentity(e){e.setIdentity()}getBasis(e){var i=this.allocQuaternion();return e.getBasis().getRotation(i),i}getBasisAsMatrix3(e){var i=this.getBasis(e),r=this.quaternionToMatrix3(i);return this.freeQuaternion(i),r}getOrigin(e){return e.getOrigin()}setOrigin(e,i){e.getOrigin().setValue(i.x(),i.y(),i.z())}copyOrigin(e,i){var r=i.getOrigin();this.setOrigin(e,r)}setBasis(e,i){e.setRotation(i)}setBasisFromMatrix3(e,i){var r=this.matrix3ToQuaternion(i);this.setBasis(e,r),this.freeQuaternion(r)}setOriginFromArray3(e,i){e.getOrigin().setValue(i[0],i[1],i[2])}setOriginFromThreeVector3(e,i){e.getOrigin().setValue(i.x,i.y,i.z)}setBasisFromArray3(e,i){var r=this.allocThreeQuaternion(),o=this.allocThreeEuler();o.set(i[0],i[1],i[2]),this.setBasisFromThreeQuaternion(e,r.setFromEuler(o)),this.freeThreeEuler(o),this.freeThreeQuaternion(r)}setBasisFromThreeQuaternion(e,i){var r=this.allocQuaternion();r.setX(i.x),r.setY(i.y),r.setZ(i.z),r.setW(i.w),this.setBasis(e,r),this.freeQuaternion(r)}multiplyTransforms(e,i){var r=this.allocTransform();this.setIdentity(r);var o=this.getBasisAsMatrix3(e),l=this.getBasisAsMatrix3(i),a=this.getOrigin(e),c=this.getOrigin(i),d=this.multiplyMatrix3ByVector3(o,c),u=this.addVector3(d,a);this.setOrigin(r,u);var f=this.multiplyMatrices3(o,l);return this.setBasisFromMatrix3(r,f),this.freeVector3(d),this.freeVector3(u),r}inverseTransform(e){var i=this.allocTransform(),r=this.getBasisAsMatrix3(e),o=this.getOrigin(e),l=this.transposeMatrix3(r),a=this.negativeVector3(o),c=this.multiplyMatrix3ByVector3(l,a);return this.setOrigin(i,c),this.setBasisFromMatrix3(i,l),this.freeVector3(a),this.freeVector3(c),i}multiplyMatrices3(e,i){var r=[],o=this.rowOfMatrix3(e,0),l=this.rowOfMatrix3(e,1),a=this.rowOfMatrix3(e,2),c=this.columnOfMatrix3(i,0),d=this.columnOfMatrix3(i,1),u=this.columnOfMatrix3(i,2);return r[0]=this.dotVectors3(o,c),r[1]=this.dotVectors3(o,d),r[2]=this.dotVectors3(o,u),r[3]=this.dotVectors3(l,c),r[4]=this.dotVectors3(l,d),r[5]=this.dotVectors3(l,u),r[6]=this.dotVectors3(a,c),r[7]=this.dotVectors3(a,d),r[8]=this.dotVectors3(a,u),this.freeVector3(o),this.freeVector3(l),this.freeVector3(a),this.freeVector3(c),this.freeVector3(d),this.freeVector3(u),r}addVector3(e,i){var r=this.allocVector3();return r.setValue(e.x()+i.x(),e.y()+i.y(),e.z()+i.z()),r}dotVectors3(e,i){return e.x()*i.x()+e.y()*i.y()+e.z()*i.z()}rowOfMatrix3(e,i){var r=this.allocVector3();return r.setValue(e[i*3+0],e[i*3+1],e[i*3+2]),r}columnOfMatrix3(e,i){var r=this.allocVector3();return r.setValue(e[i+0],e[i+3],e[i+6]),r}negativeVector3(e){var i=this.allocVector3();return i.setValue(-e.x(),-e.y(),-e.z()),i}multiplyMatrix3ByVector3(e,i){var r=this.allocVector3(),o=this.rowOfMatrix3(e,0),l=this.rowOfMatrix3(e,1),a=this.rowOfMatrix3(e,2),c=this.dotVectors3(o,i),d=this.dotVectors3(l,i),u=this.dotVectors3(a,i);return r.setValue(c,d,u),this.freeVector3(o),this.freeVector3(l),this.freeVector3(a),r}transposeMatrix3(e){var i=[];return i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8],i}quaternionToMatrix3(e){var i=[],r=e.x(),o=e.y(),l=e.z(),a=e.w(),c=r*r,d=o*o,u=l*l,f=r*o,m=o*l,h=l*r,_=r*a,b=o*a,v=l*a;return i[0]=1-2*(d+u),i[1]=2*(f-v),i[2]=2*(h+b),i[3]=2*(f+v),i[4]=1-2*(u+c),i[5]=2*(m-_),i[6]=2*(h-b),i[7]=2*(m+_),i[8]=1-2*(c+d),i}matrix3ToQuaternion(e){var i=e[0]+e[4]+e[8],r,o,l,a,c;i>0?(r=Math.sqrt(i+1)*2,c=.25*r,o=(e[7]-e[5])/r,l=(e[2]-e[6])/r,a=(e[3]-e[1])/r):e[0]>e[4]&&e[0]>e[8]?(r=Math.sqrt(1+e[0]-e[4]-e[8])*2,c=(e[7]-e[5])/r,o=.25*r,l=(e[1]+e[3])/r,a=(e[2]+e[6])/r):e[4]>e[8]?(r=Math.sqrt(1+e[4]-e[0]-e[8])*2,c=(e[2]-e[6])/r,o=(e[1]+e[3])/r,l=.25*r,a=(e[5]+e[7])/r):(r=Math.sqrt(1+e[8]-e[0]-e[4])*2,c=(e[3]-e[1])/r,o=(e[2]+e[6])/r,l=(e[5]+e[7])/r,a=.25*r);var d=this.allocQuaternion();return d.setX(o),d.setY(l),d.setZ(a),d.setW(c),d}}class RigidBody{constructor(e,i,r,o){this.mesh=e,this.world=i,this.params=r,this.manager=o,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this._init()}reset(){return this._setTransformFromBone(),this}updateFromBone(){return this.params.boneIndex!==-1&&this.params.type===0&&this._setTransformFromBone(),this}updateBone(){return this.params.type===0||this.params.boneIndex===-1?this:(this._updateBoneRotation(),this.params.type===1&&this._updateBonePosition(),this.bone.updateMatrixWorld(!0),this.params.type===2&&this._setPositionFromBone(),this)}_init(){function e(w){switch(w.shapeType){case 0:return new Ammo.btSphereShape(w.width);case 1:{let y=new Ammo.btVector3(w.width,w.height,w.depth);return i.manage(y),new Ammo.btBoxShape(y)}case 2:return new Ammo.btCapsuleShape(w.width,w.height);default:throw new Error("unknown shape type "+w.shapeType)}}const i=this.manager,r=this.params,o=this.mesh.skeleton.bones,l=r.boneIndex===-1?new Bone:o[r.boneIndex],a=e(r),c=r.type===0?0:r.weight,d=i.allocVector3();d.setValue(0,0,0),c!==0&&a.calculateLocalInertia(c,d);const u=i.allocTransform();i.setIdentity(u),i.setOriginFromArray3(u,r.position),i.setBasisFromArray3(u,r.rotation);const f=i.allocThreeVector3(),m=i.allocTransform();i.setIdentity(m),i.setOriginFromThreeVector3(m,l.getWorldPosition(f));const h=i.multiplyTransforms(m,u),_=new Ammo.btDefaultMotionState(h);i.manage(_);const b=new Ammo.btRigidBodyConstructionInfo(c,_,a,d);b.set_m_friction(r.friction),b.set_m_restitution(r.restitution),this.body_info=b,i.manage(b);const v=new Ammo.btRigidBody(b);i.manage(v),r.type===0&&(v.setCollisionFlags(v.getCollisionFlags()|2),v.setActivationState(4)),v.setDamping(r.positionDamping,r.rotationDamping),v.setSleepingThresholds(0,0),this.world.addRigidBody(v,1<<r.groupIndex,r.groupTarget),this.body=v,this.bone=l,this.boneOffsetForm=u,this.boneOffsetFormInverse=i.inverseTransform(u),i.freeVector3(d),i.freeTransform(h),i.freeTransform(m),i.freeThreeVector3(f)}_getBoneTransform(){const e=this.manager,i=e.allocThreeVector3(),r=e.allocThreeQuaternion(),o=e.allocThreeVector3();this.bone.matrixWorld.decompose(i,r,o);const l=e.allocTransform();e.setOriginFromThreeVector3(l,i),e.setBasisFromThreeQuaternion(l,r);const a=e.multiplyTransforms(l,this.boneOffsetForm);return e.freeTransform(l),e.freeThreeVector3(o),e.freeThreeQuaternion(r),e.freeThreeVector3(i),a}_getWorldTransformForBone(){const e=this.manager,i=this.body.getCenterOfMassTransform();return e.multiplyTransforms(i,this.boneOffsetFormInverse)}_setTransformFromBone(){const e=this.manager,i=this._getBoneTransform();this.body.setCenterOfMassTransform(i),this.body.getMotionState().setWorldTransform(i),e.freeTransform(i)}_setPositionFromBone(){const e=this.manager,i=this._getBoneTransform(),r=e.allocTransform();this.body.getMotionState().getWorldTransform(r),e.copyOrigin(r,i),this.body.setCenterOfMassTransform(r),this.body.getMotionState().setWorldTransform(r),e.freeTransform(r),e.freeTransform(i)}_updateBoneRotation(){const e=this.manager,i=this._getWorldTransformForBone(),r=e.getBasis(i),o=e.allocThreeQuaternion(),l=e.allocThreeQuaternion(),a=e.allocThreeQuaternion();o.set(r.x(),r.y(),r.z(),r.w()),l.setFromRotationMatrix(this.bone.matrixWorld),l.conjugate(),l.multiply(o),a.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(l.multiply(a).normalize()),e.freeThreeQuaternion(o),e.freeThreeQuaternion(l),e.freeThreeQuaternion(a),e.freeQuaternion(r),e.freeTransform(i)}_updateBonePosition(){const e=this.manager,i=this._getWorldTransformForBone(),r=e.allocThreeVector3(),o=e.getOrigin(i);r.set(o.x(),o.y(),o.z()),this.bone.parent&&this.bone.parent.worldToLocal(r),this.bone.position.copy(r),e.freeThreeVector3(r),e.freeTransform(i)}}class Constraint{constructor(e,i,r,o,l,a){this.mesh=e,this.world=i,this.bodyA=r,this.bodyB=o,this.params=l,this.manager=a,this.constraint=null,this._init()}_init(){const e=this.manager,i=this.params,r=this.bodyA,o=this.bodyB,l=e.allocTransform();e.setIdentity(l),e.setOriginFromArray3(l,i.position),e.setBasisFromArray3(l,i.rotation);const a=e.allocTransform(),c=e.allocTransform();r.body.getMotionState().getWorldTransform(a),o.body.getMotionState().getWorldTransform(c);const d=e.inverseTransform(a),u=e.inverseTransform(c),f=e.multiplyTransforms(d,l),m=e.multiplyTransforms(u,l),h=new Ammo.btGeneric6DofSpringConstraint(r.body,o.body,f,m,!0);e.manage(h);const _=e.allocVector3(),b=e.allocVector3(),v=e.allocVector3(),w=e.allocVector3();_.setValue(i.translationLimitation1[0],i.translationLimitation1[1],i.translationLimitation1[2]),b.setValue(i.translationLimitation2[0],i.translationLimitation2[1],i.translationLimitation2[2]),v.setValue(i.rotationLimitation1[0],i.rotationLimitation1[1],i.rotationLimitation1[2]),w.setValue(i.rotationLimitation2[0],i.rotationLimitation2[1],i.rotationLimitation2[2]),h.setLinearLowerLimit(_),h.setLinearUpperLimit(b),h.setAngularLowerLimit(v),h.setAngularUpperLimit(w);for(let y=0;y<3;y++)i.springPosition[y]!==0&&(h.enableSpring(y,!0),h.setStiffness(y,i.springPosition[y]));for(let y=0;y<3;y++)i.springRotation[y]!==0&&(h.enableSpring(y+3,!0),h.setStiffness(y+3,i.springRotation[y]));if(h.setParam!==void 0)for(let y=0;y<6;y++)h.setParam(2,.475,y);this.world.addConstraint(h,!0),this.constraint=h,e.freeTransform(l),e.freeTransform(a),e.freeTransform(c),e.freeTransform(d),e.freeTransform(u),e.freeTransform(f),e.freeTransform(m),e.freeVector3(_),e.freeVector3(b),e.freeVector3(v),e.freeVector3(w)}}const _position=new Vector3,_quaternion=new Quaternion,_scale=new Vector3,_matrixWorldInv=new Matrix4;class MMDPhysicsHelper extends Object3D{constructor(e,i){super(),this.root=e,this.physics=i,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new MeshBasicMaterial({color:new Color(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init()}updateMatrixWorld(e){var i=this.root;if(this.visible){var r=this.physics.bodies;_matrixWorldInv.copy(i.matrixWorld).decompose(_position,_quaternion,_scale).compose(_position,_quaternion,_scale.set(1,1,1)).invert();for(var o=0,l=r.length;o<l;o++){var a=r[o].body,c=this.children[o],d=a.getCenterOfMassTransform(),u=d.getOrigin(),f=d.getRotation();c.position.set(u.x(),u.y(),u.z()).applyMatrix4(_matrixWorldInv),c.quaternion.setFromRotationMatrix(_matrixWorldInv).multiply(_quaternion.set(f.x(),f.y(),f.z(),f.w()))}}this.matrix.copy(i.matrixWorld).decompose(_position,_quaternion,_scale).compose(_position,_quaternion,_scale.set(1,1,1)),super.updateMatrixWorld(e)}_init(){var e=this.physics.bodies;function i(a){const c=a.width>a.width?a.width:1,d=a.height>a.height?a.height:1,u=a.depth>a.depth?a.depth:1;switch(a.shapeType){case 0:return new SphereGeometry(c??1,16,8);case 1:return new BoxGeometry(c*2,d*2,u*2,1,1,1);case 2:return new THREE.CapsuleGeometry(c,d,2,8);default:return null}}for(var r=0,o=e.length;r<o;r++){var l=e[r].params;const a=new Mesh(i(l),this.materials[l.type]);a.__backup_mmd_physics_helper_material__=this.materials[l.type],this.add(a)}}}class MMDAnimationHelper{constructor(e={}){this.meshes=[],this.camera=null,this.cameraTarget=new Object3D,this.cameraTarget.name="target",this.audio=null,this.audioManager=null,this.objects=new WeakMap,this.configuration={sync:e.sync!==void 0?e.sync:!0,afterglow:e.afterglow!==void 0?e.afterglow:0,resetPhysicsOnLoop:e.resetPhysicsOnLoop!==void 0?e.resetPhysicsOnLoop:!0,pmxAnimation:e.pmxAnimation!==void 0?e.pmxAnimation:!1},this.enabled={animation:!0,ik:!0,grant:!0,physics:!0,cameraAnimation:!0},this.onBeforePhysics=function(i){},this.sharedPhysics=!1,this.masterPhysics=null}add(e,i={}){const r={physics:!0,warmup:30,unitStep:.016666666666666666,maxStepNum:4,gravity:new Vector3(0,-98,0),delayTime:0,fixedCalculation:!0};if(i&&Object.assign(r,i),e.isSkinnedMesh)this._addMesh(e,r);else if(e.isCamera)this._setupCamera(e,r);else if(e.type==="Audio")this._setupAudio(e,r);else throw new Error("THREE.MMDAnimationHelper.add: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");return this.configuration.sync&&this._syncDuration(),this}previous_best_fps=60;setPhysicsFPS(e){if(Math.abs(this.previous_best_fps-e)>5||this.previous_best_fps<e){window.debug&&console.log("Physics FPS changed to ",e),this.previous_best_fps=e;const i=1/e;for(const r of this.meshes){const o=this.objects.get(r);o.physics&&(o.physics.unitStep=i)}}}remove(e){if(e.isSkinnedMesh)this._removeMesh(e);else if(e.isCamera)this._clearCamera(e);else if(e.type==="Audio")this._clearAudio(e);else throw new Error("THREE.MMDAnimationHelper.remove: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");return this.configuration.sync&&this._syncDuration(),this}update(e,i={}){this.audioManager!==null&&this.audioManager.control(e);for(let r=0;r<this.meshes.length;r++)this._animateMesh(this.meshes[r],e,i);return this.sharedPhysics&&this._updateSharedPhysics(i.force_update_physics?i.delta:e),this.camera!==null&&this._animateCamera(this.camera,e),this}update_without_animation(e,i={}){for(let r=0;r<this.meshes.length;r++)this._animateMesh_without_animation(this.meshes[r],e,i);return this.sharedPhysics&&this._updateSharedPhysics(i.force_update_physics?i.delta:e),this}pose(e,i,r={}){if(r.resetPose!==!1&&e.pose?.(),i){const o=e.skeleton.bones,l=i.bones,a={};for(let u=0,f=o.length;u<f;u++)a[o[u].name]=u;const c=new Vector3,d=new Quaternion;for(let u=0,f=l.length;u<f;u++){const m=l[u],h=a[m.name];if(h===void 0)continue;const _=o[h];_.position.add(c.fromArray(m.translation)),_.quaternion.multiply(d.fromArray(m.quaternion))}}if(this._morphing(e),e.updateMatrixWorld(!0),this.configuration.pmxAnimation&&e.geometry.userData.MMD&&e.geometry.userData.MMD.format==="pmx"){const o=this._sortBoneDataArray(e.geometry.userData.MMD.bones.slice()),l=r.ik!==!1?this._createCCDIKSolver(e):null,a=r.grant!==!1?this.createGrantSolver(e):null;this.calculateGrantAndIK(e,o,l,a)}else r.ik!==!1&&this._createCCDIKSolver(e).update(),r.grant!==!1&&this.createGrantSolver(e).update();return this._saveBones(e),this}enable(e,i){if(this.enabled[e]===void 0)throw new Error("THREE.MMDAnimationHelper.enable: unknown key "+e);if(this.enabled[e]=i,e==="physics")for(let r=0,o=this.meshes.length;r<o;r++)this._optimizeIK(this.meshes[r],i);return this}createGrantSolver(e){return new GrantSolver(e,e.geometry.userData.MMD.grants)}_addMesh(e,i){if(this.meshes.indexOf(e)>=0)throw new Error("THREE.MMDAnimationHelper._addMesh: SkinnedMesh '"+e.name+"' has already been added.");return this.meshes.push(e),this.objects.set(e,{finished:!1}),this._setupMeshAnimation(e,i.animation),i.physics!==!1&&this._setupMeshPhysics(e,i),this}_setupCamera(e,i){if(this.camera===e)throw new Error("THREE.MMDAnimationHelper._setupCamera: Camera '"+e.name+"' has already been set.");return this.camera&&this._clearCamera(this.camera),this.camera=e,e.add(this.cameraTarget),this.objects.set(e,{}),i.animation!==void 0&&this._setupCameraAnimation(e,i.animation),this}_setupAudio(e,i){if(this.audio===e)throw new Error("THREE.MMDAnimationHelper._setupAudio: Audio '"+e.name+"' has already been set.");return this.audio&&this._clearAudio(this.audio),this.audio=e,this.audioManager=new AudioManager(e,i),this.objects.set(this.audioManager,{duration:this.audioManager.duration}),this}_removeMesh(e){let i=!1,r=0;for(let o=0,l=this.meshes.length;o<l;o++){if(this.meshes[o]===e){{let a=this.objects.get(e);if(a.physics){for(let c of a.physics.bodies)a.physics.world.removeRigidBody(c.body);for(let c of a.physics.constraints)a.physics.world.removeConstraint(c.constraint);a.physics.manager.destroy()}}this.objects.delete(e),i=!0;continue}this.meshes[r++]=this.meshes[o]}if(!i)throw new Error("THREE.MMDAnimationHelper._removeMesh: SkinnedMesh '"+e.name+"' has not been added yet.");return this.meshes.length=r,this}_clearCamera(e){if(e!==this.camera)throw new Error("THREE.MMDAnimationHelper._clearCamera: Camera '"+e.name+"' has not been set yet.");return this.camera.remove(this.cameraTarget),this.objects.delete(this.camera),this.camera=null,this}_clearAudio(e){if(e!==this.audio)throw new Error("THREE.MMDAnimationHelper._clearAudio: Audio '"+e.name+"' has not been set yet.");return this.objects.delete(this.audioManager),this.audio=null,this.audioManager=null,this}_setupMeshAnimation(e,i){const r=this.objects.get(e);return r.ikSolver=this._createCCDIKSolver(e),r.grantSolver=this.createGrantSolver(e),this}_setupCameraAnimation(e,i){}_setupMeshPhysics(e,i){const r=this.objects.get(e),o=e.getAnimationMixer();if(i.world===void 0&&this.sharedPhysics){const l=this._getMasterPhysics();l!==null&&(world=l.world)}r.physics=this._createMMDPhysics(e,i),o&&i.animationWarmup!==!1&&this._animateMesh(e,1e-4),this._optimizeIK(e,!0),r.physics.reset(),r.physics.warmup(i.warmup!==void 0?i.warmup:60)}is_enabled(e){return this.enabled[e]}reset_physics(){for(const e of this.meshes){const i=this.objects.get(e);if(i){const r=i.ikSolver,o=i.grantSolver,l=i.physics;this.enabled.ik&&(e.updateMatrixWorld(!0),r?.update?.()),this.enabled.grant&&o?.update?.(),l?.reset?.()}}}reset_physics_of_single_object(e){const i=this.objects.get(e);i&&i.physics?.reset?.()}reset_animation(e){const i={time:0};e&&Object.assign(i,e);const r=this.enabled.animation;this.enabled.animation=!0;const o=this.meshes;for(const l of o){const a=l.getAnimationMixer();a&&a.setTime(i.time)}this.update(0),this.enabled.animation=r}setup_animation_to_specified_object(e,i){const r=this.enabled.animation;this.enabled.animation=!0;const o=e.getAnimationMixer();o&&o.setTime(i),this.update(0),this.enabled.animation=r}_morphing(e){const i=e.material,r=e.material_overwrite,o=e.skeleton.bones;for(const l of o)l.morph?(l.morph.position.set(0,0,0),l.morph.quaternion.set(0,0,0,1)):l.morph={tmpV1:new Vector3,tmpV2:new Vector3,tmpV3:new Vector3,tmpQ1:new Quaternion,tmpQ2:new Quaternion,tmpQ3:new Quaternion,position:new Vector3,quaternion:new Quaternion};if(r){let d=function(f,m,h){return f*(1-h)+m*h};for(let f=0,m=r.length;f<m;f++){const h=i[f],_=r[f];if(!(_ instanceof THREE.MeshPhysicalMaterial)){if(!(_ instanceof THREE.MeshToonMaterial))continue}h.color.copy(_.color),h.emissive.copy(_.emissive),h.opacity=_.opacity,h.visible=_.visible,h.color==_.color&&console.error("Dup")}const l=e.geometry.morphs,a=e.morphTargetInfluences,c=e.morphTargetInfluences_cache,u=l.length;for(let f=0;f<u;f++){const m=l[f],h=c[f]+a[f];if(m.type===0)for(let _=0,b=m.elementCount;_<b;_++){const v=m.elements[_];if(v==null||v.index==-1)continue;const w=v.index,y=l[w],M=v.ratio*h;if(y!=null&&y.type!==1){if(y.type===2){if(M==0)continue;for(const S of y.elements){if(S==null||S.rotation==null)continue;const D=o[S.index].morph,k=D.tmpV1,O=D.tmpV2;O.fromArray(S.position),k.set(0,0,0),k.lerp(O,M),k.z=-k.z,D.position.add(k);const L=D.tmpQ1,P=D.tmpQ2;P.set(-S.rotation[0],-S.rotation[1],S.rotation[2],S.rotation[3]),L.set(0,0,0,1),L.slerp(P,M),D.quaternion.multiply(L)}}else if(y.type!==3){if(y.type!==4){if(y.type!==5){if(y.type!==6){if(y.type!==7){if(y.type===8)for(let S=0;S<y.elementCount;S++){const D=y.elements[S];if(D==null)continue;const k=D.type,O=D.index,L=i[O];if(!(L instanceof THREE.MeshPhysicalMaterial)){if(!(L instanceof THREE.MeshToonMaterial))continue}if(L){if(k==0){const P=L.color,N=D.diffuse,z=D.toonColor;P.r*=d(1,N[0],M),P.g*=d(1,N[1],M),P.b*=d(1,N[2],M),L.opacity*=d(1,N[3],M),P.r*=d(1,z[0],M),P.g*=d(1,z[1],M),P.b*=d(1,z[2],M),L.opacity*=d(1,z[3],M)}else if(k==1){const P=L.color,N=D.diffuse,z=D.toonColor;P.r+=N[0]*M,P.g+=N[1]*M,P.b+=N[2]*M,L.opacity+=N[3]*M,P.r+=z[0]*M,P.g+=z[1]*M,P.b+=z[2]*M,L.opacity+=z[3]*M}}}}}}}}}}else if(m.type!==1){if(m.type===2){if(h==0||m.elements==null)continue;for(const _ of m.elements){if(_==null||_.rotation==null)continue;const b=o[_.index].morph,v=b.tmpV1,w=b.tmpV2;w.fromArray(_.position),v.set(0,0,0),v.lerp(w,h),v.z=-v.z,b.position.add(v);const y=b.tmpQ1,M=b.tmpQ2;M.set(-_.rotation[0],-_.rotation[1],_.rotation[2],_.rotation[3]),y.set(0,0,0,1),y.slerp(M,h),b.quaternion.multiply(y)}}else if(m.type!==3){if(m.type!==4){if(m.type!==5){if(m.type!==6){if(m.type!==7){if(m.type===8){const _=m.elementCount;if(_==null)continue;for(let b=0;b<_;b++){const v=m.elements[b];if(v==null)continue;const w=v.type,y=v.index,M=i[y];if(M){if(!(M instanceof THREE.MeshPhysicalMaterial)){if(!(M instanceof THREE.MeshToonMaterial))continue}if(w==0){const S=M.color,D=v.diffuse,k=v.textureColor;S.r*=d(1,D[0],h),S.g*=d(1,D[1],h),S.b*=d(1,D[2],h),M.opacity*=d(1,D[3],h),S.r*=d(1,k[0],h),S.g*=d(1,k[1],h),S.b*=d(1,k[2],h),M.opacity*=d(1,k[3],h)}else if(w==1){const S=M.color,D=v.diffuse,k=v.textureColor;S.r+=D[0]*h,S.g+=D[1]*h,S.b+=D[2]*h,M.opacity+=D[3]*h,S.r+=k[0]*h,S.g+=k[1]*h,S.b+=k[2]*h,M.opacity+=k[3]*h}}}}}}}}}}}for(let f=0;f<u;f++){let m=i[f];if(!(m instanceof THREE.MeshPhysicalMaterial)){if(!(m instanceof THREE.MeshToonMaterial))continue}m.opacity<.01&&(m.visible=!1),m.opacity>1&&(m.opacity=1)}}}_animateMesh_without_animation(e,i,r){const o=this.objects.get(e);if(o==null)return;const l=o.ikSolver,a=o.grantSolver,c=o.physics,d=(e.getDDDProperties?.()?.physics??!0)&&(this.enabled.physics||r?.force_update_physics);if(this._morphing(e),this._restoreBones(e),this._saveBones(e),this.configuration.pmxAnimation&&e.geometry.userData.MMD&&e.geometry.userData.MMD.format==="pmx"?(o.sortedBonesData||(o.sortedBonesData=this._sortBoneDataArray(e.geometry.userData.MMD.bones.slice())),this.calculateGrantAndIK(e,o.sortedBonesData,l&&(this.enabled.ik||r?.force_update_ik)?l:null,a&&(this.enabled.grant||r?.force_update_grant)?a:null)):(l&&(this.enabled.ik||r?.force_update_ik)&&(e.updateMatrixWorld(!0),l.update()),a&&(this.enabled.grant||r?.force_update_grant)&&a.update()),c&&this.enabled.physics&&!this.sharedPhysics&&d){this.onBeforePhysics(e);const u=r?.delta??i;c.update(u==0?.0333:u)}}_animateMesh(e,i,r){const o=this.objects.get(e);if(o==null)return;const l=o.ikSolver,a=o.grantSolver,c=o.physics;this._morphing(e);const d=(e.gebtDecoProperties?.()?.animation??!0)&&(this.enabled.animation||r?.force_update_animation),u=(e.getDDDProperties?.()?.physics??!0)&&(this.enabled.physics||r?.force_update_physics);if(d){e._animation_clock_===void 0&&(e._animation_clock_=0);const f=this.enabled.animation&&d?i:0;e._animation_clock_+=f,this._restoreBones(e),e.updateActions(i),this._saveBones(e),e.traverse(m=>m.user.afterAnimated?.(m,i)),this.configuration.pmxAnimation&&e.geometry.userData.MMD&&e.geometry.userData.MMD.format==="pmx"?(o.sortedBonesData||(o.sortedBonesData=this._sortBoneDataArray(e.geometry.userData.MMD.bones.slice())),this.calculateGrantAndIK(e,o.sortedBonesData,l&&(this.enabled.ik||r?.force_update_ik)?l:null,a&&(this.enabled.grant||r?.force_update_grant)?a:null)):(l&&(this.enabled.ik||r?.force_update_ik)&&(e.updateMatrixWorld(!0),l.update()),a&&(this.enabled.grant||r?.force_update_grant)&&a.update())}c&&this.enabled.physics&&!this.sharedPhysics&&u&&(this.onBeforePhysics(e),c.update(r?.delta??i))}_sortBoneDataArray(e){return e.sort(function(i,r){return i.transformationClass!==r.transformationClass?i.transformationClass-r.transformationClass:i.index-r.index})}calculateGrantAndIK(e,i,r,o){_quaternionIndex=0,_grantResultMap.clear();for(let l=0,a=i.length;l<a;l++)CalculateGrantAndIK(e,i[l].index,r,o,this.enabled.animation);return e.updateMatrixWorld(!0),this}_animateCamera(e,i){const r=this.objects.get(e),o=e.getAnimationMixer(),l=e.getDDDProperties().__action_tmp__;if(o&&l.__is_mixing__&&this.enabled.cameraAnimation){r.previous_camera==null?(r.backup={position:e.position.clone(),quaternion:e.quaternion.clone(),matrixWorld:e.matrixWorld.clone(),target:e.target.clone(),up:e.up.clone(),fov:e.fov,alt_target:this.cameraTarget.position.clone()},e.quaternion.identity(),e.position.set(0,10,45),e.target.set(0,10,0),this.cameraTarget.position.set(0,10,0),e.up.set(0,1,0),e.updateActions(i),r.previous_camera={position:e.position.clone(),quaternion:e.quaternion.clone(),up:e.up.clone(),target:e.target.clone(),alt_target:this.cameraTarget.position.clone(),_camera_motion_vmd_distance:e._camera_motion_vmd_distance,_camera_motion_vmd_rotate:e._camera_motion_vmd_rotate.clone()},r.V=new THREE.Vector3,r.Q=new THREE.Quaternion,r.dir=new THREE.Vector3,r.center=new THREE.Vector3):(e.position.copy(r.previous_camera.position),e.quaternion.copy(r.previous_camera.quaternion),e.up.copy(r.previous_camera.up),e.target.copy(r.previous_camera.target),this.cameraTarget.position.copy(r.previous_camera.alt_target),e._camera_motion_vmd_distance=r.previous_camera._camera_motion_vmd_distance,e._camera_motion_vmd_rotate.copy(r.previous_camera._camera_motion_vmd_rotate),e.updateActions(i),r.previous_camera.position.copy(e.position),r.previous_camera.quaternion.copy(e.quaternion),r.previous_camera.up.copy(e.up),r.previous_camera.target.copy(e.target),r.previous_camera.alt_target.copy(this.cameraTarget.position),r.previous_camera._camera_motion_vmd_distance=e._camera_motion_vmd_distance,r.previous_camera._camera_motion_vmd_rotate.copy(e._camera_motion_vmd_rotate));{const a=r.center,c=r.dir;c.set(0,0,-1),a.copy(e.position);const d=e._camera_motion_vmd_rotate,u=r.Q,f=r.V;e.up.set(0,1,0);{const m=()=>{f.set(1,0,0),u.setFromAxisAngle(f,d.x),c.applyQuaternion(u),e.up.applyQuaternion(u)},h=()=>{f.set(0,1,0),u.setFromAxisAngle(f,d.y),c.applyQuaternion(u),e.up.applyQuaternion(u)};(()=>{f.set(0,0,1),u.setFromAxisAngle(f,d.z),c.applyQuaternion(u),e.up.applyQuaternion(u)})(),m(),h(),e.ext1?.quaternion&&(c.applyQuaternion(e.ext1.quaternion),e.up.applyQuaternion(e.ext1.quaternion))}e.quaternion.identity(),c.multiplyScalar(-Math.abs(e._camera_motion_vmd_distance)),c.add(a),e.ext1?.position&&c.add(e.ext1.position),e.ext1?.target&&a.add(e.ext1.target),e.ext1?.onUpdate&&e.ext1.onUpdate({position:c,target:a,up:e.up,camera:e}),this.cameraTarget.position.copy(a),e.target.copy(a),e.position.copy(c),e.updateProjectionMatrix(),e.lookAt(this.cameraTarget.position),e.updateMatrixWorld(),e.onUpdateCameraAfterAnimated&&e.onUpdateCameraAfterAnimated()}}else r.previous_camera=null,r.backup&&(r.backup={position:e.position.clone(),quaternion:e.quaternion.clone(),matrixWorld:e.matrixWorld.clone(),target:e.target.clone(),up:e.up.clone(),alt_target:this.cameraTarget.position.clone()},e.position.copy(r.backup.position),e.quaternion.copy(r.backup.quaternion),e.matrixWorld.copy(r.backup.matrixWorld),e.target.copy(r.backup.target),e.up.copy(r.backup.up),this.cameraTarget.position.copy(r.backup.alt_target),r.backup=null)}_optimizeIK(e,i){const r=e.geometry.userData.MMD.iks,o=e.geometry.userData.MMD.bones;for(let l=0,a=r.length;l<a;l++){const d=r[l].links;for(let u=0,f=d.length;u<f;u++){const m=d[u];i===!0?m.enabled=!(o[m.index].rigidBodyType>0):m.enabled=!0}}}_createCCDIKSolver(e){if(CCDIKSolver===void 0)throw new Error("THREE.MMDAnimationHelper: Import CCDIKSolver.");return new CCDIKSolver(e,e.geometry.userData.MMD.iks)}_createMMDPhysics(e,i){if(MMDPhysics===void 0)throw new Error("THREE.MMDPhysics: Import MMDPhysics.");return new MMDPhysics(e,e.geometry.userData.MMD.rigidBodies,e.geometry.userData.MMD.constraints,i)}_syncDuration(){let e=0;const i=this.objects,r=this.meshes,o=this.camera,l=this.audioManager;for(let a=0,c=r.length;a<c;a++){const d=r[a].getAnimationMixer();if(d!==void 0)for(let u=0;u<d._actions.length;u++){const f=d._actions[u]._clip;i.has(f)||i.set(f,{duration:f.duration}),e=Math.max(e,i.get(f).duration)}}if(o!==null){const a=o.getAnimationMixer();if(a!==void 0)for(let c=0,d=a._actions.length;c<d;c++){const u=a._actions[c]._clip;i.has(u)||i.set(u,{duration:u.duration}),e=Math.max(e,i.get(u).duration)}}l!==null&&(e=Math.max(e,i.get(l).duration)),e+=this.configuration.afterglow;for(let a=0,c=this.meshes.length;a<c;a++){const d=r[a].getAnimationMixer();if(d!==void 0)for(let u=0,f=d._actions.length;u<f;u++)d._actions[u]._clip.duration=e}if(o!==null){const a=o.getAnimationMixer();if(a!==void 0)for(let c=0,d=a._actions.length;c<d;c++)a._actions[c]._clip.duration=e}l!==null&&(l.duration=e)}_updatePropertyMixersBuffer(e){const i=e.getAnimationMixer(),r=i._bindings,o=i._accuIndex;for(let l=0,a=r.length;l<a;l++){const c=r[l],d=c.buffer,u=c.valueSize,f=(o+1)*u;c.binding.getValue(d,f)}}_saveBones(e){const i=this.objects.get(e),r=e.skeleton.bones;let o=i.backupBones;o===void 0&&(o=new Float32Array(r.length*7),i.backupBones=o);for(let l=0,a=r.length;l<a;l++){const c=r[l];c.position.toArray(o,l*7),c.quaternion.toArray(o,l*7+3)}}_restoreBones(e){const r=this.objects.get(e).backupBones;if(r===void 0)return;const o=e.skeleton.bones;for(let l=0,a=o.length;l<a;l++){const c=o[l];c.position.fromArray(r,l*7),c.quaternion.fromArray(r,l*7+3)}}_getMasterPhysics(){if(this.masterPhysics!==null)return this.masterPhysics;for(let e=0,i=this.meshes.length;e<i;e++){const r=this.meshes[e].physics;if(r!=null)return this.masterPhysics=r,this.masterPhysics}return null}_updateSharedPhysics(e){if(this.meshes.length===0||!this.enabled.physics||!this.sharedPhysics)return;const i=this._getMasterPhysics();if(i!==null){for(let r=0,o=this.meshes.length;r<o;r++){const l=this.meshes[r].physics;l?.updateRigidBodies()}i.stepSimulation(e);for(let r=0,o=this.meshes.length;r<o;r++){const l=this.meshes[r].physics;l?.updateBones()}}}}const _quaternions=[];let _quaternionIndex=0;function GetQuaternion(){return _quaternionIndex>=_quaternions.length&&_quaternions.push(new Quaternion),_quaternions[_quaternionIndex++]}const _grantResultMap=new Map;function CalculateGrantAndIK(s,e,i,r,o){o=!0;const l=s.skeleton.bones,c=s.geometry.userData.MMD.bones[e],d=l[e],u=d.ext1;if(u&&o){const h=u.callback,_=u.position,b=u.quaternion;h&&h(d),_&&d.position.add(_),b&&d.quaternion.multiply(b)}const f=d.morph;if(f&&o&&(d.position.add(f.position),d.quaternion.multiply(f.quaternion)),_grantResultMap.has(e))return;const m=GetQuaternion();if(_grantResultMap.set(e,m.copy(d.quaternion)),r&&c.grant&&!c.grant.isLocal&&c.grant.affectRotation){const h=c.grant.parentIndex==-1?0:c.grant.parentIndex,_=c.grant.ratio;_grantResultMap.has(h)||CalculateGrantAndIK(s,h,i,r,o),r.addGrantRotation(d,_grantResultMap.get(h),_)}if(i&&c.ik){s.updateMatrixWorld(!0);let h=d.ikEnabled;h==null&&(h=!0),h&&i.updateOne(c.ik);const _=c.ik.links;for(let b=0,v=_.length;b<v;b++){const w=_[b];if(w.enabled===!1)continue;const y=w.index;_grantResultMap.has(y)&&_grantResultMap.set(y,_grantResultMap.get(y).copy(l[y].quaternion))}}m.copy(d.quaternion)}class AudioManager{constructor(e,i={}){this.audio=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=i.delayTime!==void 0?i.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime}control(e){return this.elapsed+=e,this.currentTime+=e,this._shouldStopAudio()&&this.audio.stop(),this._shouldStartAudio()&&this.audio.play(),this}_shouldStartAudio(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime||this.currentTime-this.delayTime>this.audioDuration)}_shouldStopAudio(){return this.audio.isPlaying&&this.currentTime>=this.duration}}const _q=new Quaternion;class GrantSolver{constructor(e,i=[]){this.mesh=e,this.grants=i}update(){const e=this.grants;for(let i=0,r=e.length;i<r;i++)this.updateOne(e[i]);return this}updateOne(e){const i=this.mesh.skeleton.bones,r=i[e.index],o=i[e.parentIndex];return e.isLocal?(e.affectPosition,e.affectRotation):(e.affectPosition,e.affectRotation&&o?.quaternion&&this.addGrantRotation(r,o.quaternion,e.ratio)),this}addGrantRotation(e,i,r){return _q.set(0,0,0,1),_q.slerp(i,r),e.quaternion.multiply(_q),this}}class ViewHelper extends Scene{constructor(e,i){super(),this.camera=e,this.animating=!1,this.controls=null;const r=new Color("#ff3653"),o=new Color("#8adb00"),l=new Color("#2c8fff"),a=[],c=new Raycaster,d=new Vector2,u=new Object3D,f=new OrthographicCamera(-2,2,2,-2,0,4);f.position.set(0,0,2);const m=new BoxGeometry(.8,.05,.05).translate(.4,0,0),h=new Mesh(m,Y(r)),_=new Mesh(m,Y(o)),b=new Mesh(m,Y(l));_.rotation.z=Math.PI/2,b.rotation.y=-Math.PI/2,this.add(h),this.add(b),this.add(_);const v=new Sprite(q(r,"X"));v.userData.type="posX";const w=new Sprite(q(o,"Y"));w.userData.type="posY";const y=new Sprite(q(l,"Z"));y.userData.type="posZ";const M=new Sprite(q(r));M.userData.type="negX";const S=new Sprite(q(o));S.userData.type="negY";const D=new Sprite(q(l));D.userData.type="negZ",v.position.x=1,w.position.y=1,y.position.z=1,M.position.x=-1,M.scale.setScalar(.8),S.position.y=-1,S.scale.setScalar(.8),D.position.z=-1,D.scale.setScalar(.8),this.add(v),this.add(w),this.add(y),this.add(M),this.add(S),this.add(D),a.push(v),a.push(w),a.push(y),a.push(M),a.push(S),a.push(D);const k=new Vector3,O=128,L=2*Math.PI,P=new Vector4;this.render=function(J){this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld(),k.set(0,0,1),k.applyQuaternion(this.camera.quaternion),k.x>=0?(v.material.opacity=1,M.material.opacity=.5):(v.material.opacity=.5,M.material.opacity=1),k.y>=0?(w.material.opacity=1,S.material.opacity=.5):(w.material.opacity=.5,S.material.opacity=1),k.z>=0?(y.material.opacity=1,D.material.opacity=.5):(y.material.opacity=.5,D.material.opacity=1);const W=i.offsetWidth-O;let te=J.autoClear;J.autoClear=!1,J.clearDepth(),J.getViewport(P),J.setViewport(W,0,O,O),J.render(this,f),J.setViewport(P),J.autoClear=te};const N=new Vector3,z=new Quaternion,K=new Quaternion,Z=new Quaternion;let V=0;this.handleClick=function(J){if(this.animating===!0)return!1;const W=i.getBoundingClientRect(),te=W.left+(i.offsetWidth-O),ie=W.top+(i.offsetHeight-O);d.x=(J.clientX-te)/(W.width-te)*2-1,d.y=-((J.clientY-ie)/(W.bottom-ie))*2+1,c.setFromCamera(d,f);const oe=c.intersectObjects(a);if(oe.length>0){const ve=oe[0].object;return H(ve,this.camera.target),this.animating=!0,!0}else return!1},this.update=function(J){const W=J*L,te=this.camera.target;K.rotateTowards(Z,W),this.camera.position.set(0,0,1).applyQuaternion(K).multiplyScalar(V).add(te),this.camera.quaternion.rotateTowards(z,W),K.angleTo(Z)===0&&(this.animating=!1)};function H(J,W){switch(J.userData.type){case"posX":N.set(1,0,0),z.setFromEuler(new Euler(0,Math.PI*.5,0));break;case"posY":N.set(0,1,0),z.setFromEuler(new Euler(-Math.PI*.5,0,0));break;case"posZ":N.set(0,0,1),z.setFromEuler(new Euler);break;case"negX":N.set(-1,0,0),z.setFromEuler(new Euler(0,-Math.PI*.5,0));break;case"negY":N.set(0,-1,0),z.setFromEuler(new Euler(Math.PI*.5,0,0));break;case"negZ":N.set(0,0,-1),z.setFromEuler(new Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}V=this.camera.position.distanceTo(W),N.multiplyScalar(V).add(W),u.position.copy(W),u.lookAt(this.camera.position),K.copy(u.quaternion),u.lookAt(N),Z.copy(u.quaternion)}function Y(J){return new MeshBasicMaterial({name:"ViewHelper-AxisMaterial",color:J,toneMapped:!1})}function q(J,W=null){const te=document.createElement("canvas");te.width=64,te.height=64;const ie=te.getContext("2d");ie.beginPath(),ie.arc(32,32,16,0,2*Math.PI),ie.closePath(),ie.fillStyle=J.getStyle(),ie.fill(),W!==null&&(ie.font="24px Arial",ie.textAlign="center",ie.fillStyle="#000000",ie.fillText(W,32,41));const oe=new CanvasTexture(te);return new SpriteMaterial({name:"ViewHelper-SpriteMaterial",map:oe,toneMapped:!1})}}}ViewHelper.prototype.isViewHelper=!0;var Stats=function(){var s=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;",e.addEventListener("click",function(f){f.preventDefault(),r(++s%e.children.length)},!1);function i(f){return e.appendChild(f.dom),f}function r(f){for(var m=0;m<e.children.length;m++)e.children[m].style.display=m===f?"block":"none";s=f}var o=(performance||Date).now(),l=o,a=0,c=i(new Stats.Panel("FPS","#0ff","#002")),d=i(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=i(new Stats.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:i,showPanel:r,begin:function(){o=(performance||Date).now()},end:function(){a++;var f=(performance||Date).now();if(d.update(f-o,200),f>=l+1e3&&(c.update(a*1e3/(f-l),100),l=f,a=0,u)){var m=performance.memory;u.update(m.usedJSHeapSize/1048576,m.jsHeapSizeLimit/1048576)}return f},update:function(){o=this.end()},domElement:e,setMode:r}};Stats.Panel=function(s,e,i){var r=1/0,o=0,l=Math.round,a=l(window.devicePixelRatio||1),c=80*a,d=48*a,u=3*a,f=2*a,m=3*a,h=15*a,_=74*a,b=30*a,v=document.createElement("canvas");v.width=c,v.height=d,v.style.cssText="width:80px;height:48px";var w=v.getContext("2d");return w.font="bold "+9*a+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=i,w.fillRect(0,0,c,d),w.fillStyle=e,w.fillText(s,u,f),w.fillRect(m,h,_,b),w.fillStyle=i,w.globalAlpha=.9,w.fillRect(m,h,_,b),{dom:v,update:function(y,M){r=Math.min(r,y),o=Math.max(o,y),w.fillStyle=i,w.globalAlpha=1,w.fillRect(0,0,c,h),w.fillStyle=e,w.fillText(l(y)+" "+s+" ("+l(r)+"-"+l(o)+")",u,f),w.drawImage(v,m+a,h,_-a,b,m,h,_-a,b),w.fillRect(m+_-a,h,a,b),w.fillStyle=i,w.globalAlpha=.9,w.fillRect(m+_-a,h,a,l((1-y/M)*b))}}};class MeshPostProcessingMaterial extends MeshPhysicalMaterial{constructor(e={}){const i=e.aoPassMap,r=e.aoPassMapScale||1;delete e.aoPassMap,delete e.aoPassMapScale,super(e),this.onBeforeCompile=this._onBeforeCompile,this.customProgramCacheKey=this._customProgramCacheKey,this._aoPassMap=i,this.aoPassMapScale=r,this._shader=null}get aoPassMap(){return this._aoPassMap}set aoPassMap(e){this._aoPassMap=e,this.needsUpdate=!0,this._setUniforms()}_customProgramCacheKey(){return this._aoPassMap!==void 0&&this._aoPassMap!==null?"aoPassMap":""}_onBeforeCompile(e){this._shader=e,this._aoPassMap!==void 0&&this._aoPassMap!==null&&(e.fragmentShader=e.fragmentShader.replace("#include <aomap_pars_fragment>",aomap_pars_fragment_replacement),e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",aomap_fragment_replacement)),this._setUniforms()}_setUniforms(){this._shader&&(this._shader.uniforms.tAoPassMap={value:this._aoPassMap},this._shader.uniforms.aoPassMapScale={value:this.aoPassMapScale})}}const aomap_pars_fragment_replacement=`
#ifdef USE_AOMAP

	uniform sampler2D aoMap;
	uniform float aoMapIntensity;

#endif

	uniform sampler2D tAoPassMap;
	uniform float aoPassMapScale;
`,aomap_fragment_replacement=`
#ifndef AOPASSMAP_SWIZZLE
	#define AOPASSMAP_SWIZZLE r
#endif
	float ambientOcclusion = texelFetch( tAoPassMap, ivec2( gl_FragCoord.xy * aoPassMapScale ), 0 ).AOPASSMAP_SWIZZLE;

#ifdef USE_AOMAP

	// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	ambientOcclusion = min( ambientOcclusion, texture2D( aoMap, vAoMapUv ).r );
	ambientOcclusion *= ( ambientOcclusion - 1.0 ) * aoMapIntensity + 1.0;

#endif

	reflectedLight.indirectDiffuse *= ambientOcclusion;

	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif

	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif

	#if defined( USE_ENVMAP ) && defined( STANDARD )

		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );

		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );

	#endif
`;class Pass{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const _camera=new OrthographicCamera(-1,1,1,-1,0,1);class FullscreenTriangleGeometry extends BufferGeometry{constructor(){super(),this.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2))}}const _geometry$1=new FullscreenTriangleGeometry;class FullScreenQuad{constructor(e){this._mesh=new Mesh(_geometry$1,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,_camera)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class ShaderPass extends Pass{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=UniformsUtils.clone(e.uniforms),this.material=new ShaderMaterial({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new FullScreenQuad(this.material)}render(e,i,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const CopyShader={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class RenderPass extends Pass{constructor(e,i,r=null,o=null,l=null){super(),this.scene=e,this.camera=i,this.overrideMaterial=r,this.clearColor=o,this.clearAlpha=l,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Color,this.copy_pass=new ShaderPass(CopyShader)}render(e,i,r,o,l,a){const c=a.effect_composer,d=e.autoClear;e.autoClear=!1;let u,f;this.overrideMaterial!==null&&(f=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(u=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth();const m=this.renderToScreen?null:c.renderTarget3;e.setRenderTarget(m),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),window.DMC.start_gpu_status_check(),e.render(this.scene,this.camera),this.outline_effect&&this.outline_effect.renderOutline(this.scene,this.camera),c.renderTarget3==m&&this.copy_pass.render(e,r,c.renderTarget3),window.DMC.end_gpu_status_check(),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(u),this.overrideMaterial!==null&&(this.scene.overrideMaterial=f),e.autoClear=d}}const SMAAEdgesShader={name:"SMAAEdgesShader",defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];

		void SMAAEdgeDetectionVS( vec2 texcoord ) {
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component
		}

		void main() {

			vUv = uv;

			SMAAEdgeDetectionVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];

		vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
			vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );

			// Calculate color deltas:
			vec4 delta;
			vec3 C = texture2D( colorTex, texcoord ).rgb;

			vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
			vec3 t = abs( C - Cleft );
			delta.x = max( max( t.r, t.g ), t.b );

			vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
			t = abs( C - Ctop );
			delta.y = max( max( t.r, t.g ), t.b );

			// We do the usual threshold:
			vec2 edges = step( threshold, delta.xy );

			// Then discard if there is no edge:
			if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
				discard;

			// Calculate right and bottom deltas:
			vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
			t = abs( C - Cright );
			delta.z = max( max( t.r, t.g ), t.b );

			vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
			t = abs( C - Cbottom );
			delta.w = max( max( t.r, t.g ), t.b );

			// Calculate the maximum delta in the direct neighborhood:
			float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

			// Calculate left-left and top-top deltas:
			vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
			t = abs( C - Cleftleft );
			delta.z = max( max( t.r, t.g ), t.b );

			vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
			t = abs( C - Ctoptop );
			delta.w = max( max( t.r, t.g ), t.b );

			// Calculate the final maximum delta:
			maxDelta = max( max( maxDelta, delta.z ), delta.w );

			// Local contrast adaptation in action:
			edges.xy *= step( 0.5 * maxDelta, delta.xy );

			return vec4( edges, 0.0, 0.0 );
		}

		void main() {

			gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );

		}`},SMAAWeightsShader={name:"SMAAWeightsShader",defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];
		varying vec2 vPixcoord;

		void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
			vPixcoord = texcoord / resolution;

			// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 ); // WebGL port note: Changed sign in Y and W components
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 ); // WebGL port note: Changed sign in Y and W components

			// And these for the searches, they indicate the ends of the loops:
			vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );

		}

		void main() {

			vUv = uv;

			SMAABlendingWeightCalculationVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )

		uniform sampler2D tDiffuse;
		uniform sampler2D tArea;
		uniform sampler2D tSearch;
		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[3];
		varying vec2 vPixcoord;

		#if __VERSION__ == 100
		vec2 round( vec2 x ) {
			return sign( x ) * floor( abs( x ) + 0.5 );
		}
		#endif

		float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
			// Not required if searchTex accesses are set to point:
			// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
			// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
			//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
			e.r = bias + e.r * scale;
			return 255.0 * texture2D( searchTex, e, 0.0 ).r;
		}

		float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			/**
				* @PSEUDO_GATHER4
				* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to
				* sample between edge, thus fetching four edges in a row.
				* Sampling with different offsets in each direction allows to disambiguate
				* which edges are active from the four fetched ones.
				*/
			vec2 e = vec2( 0.0, 1.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord -= vec2( 2.0, 0.0 ) * resolution;
				if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
			}

			// We correct the previous (-0.25, -0.125) offset we applied:
			texcoord.x += 0.25 * resolution.x;

			// The searches are bias by 1, so adjust the coords accordingly:
			texcoord.x += resolution.x;

			// Disambiguate the length added by the last step:
			texcoord.x += 2.0 * resolution.x; // Undo last step
			texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

			return texcoord.x;
		}

		float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 0.0, 1.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord += vec2( 2.0, 0.0 ) * resolution;
				if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
			}

			texcoord.x -= 0.25 * resolution.x;
			texcoord.x -= resolution.x;
			texcoord.x -= 2.0 * resolution.x;
			texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

			return texcoord.x;
		}

		float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 1.0, 0.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord += vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign
				if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
			}

			texcoord.y -= 0.25 * resolution.y; // WebGL port note: Changed sign
			texcoord.y -= resolution.y; // WebGL port note: Changed sign
			texcoord.y -= 2.0 * resolution.y; // WebGL port note: Changed sign
			texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 ); // WebGL port note: Changed sign

			return texcoord.y;
		}

		float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 1.0, 0.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord -= vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign
				if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
			}

			texcoord.y += 0.25 * resolution.y; // WebGL port note: Changed sign
			texcoord.y += resolution.y; // WebGL port note: Changed sign
			texcoord.y += 2.0 * resolution.y; // WebGL port note: Changed sign
			texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 ); // WebGL port note: Changed sign

			return texcoord.y;
		}

		vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
			// Rounding prevents precision errors of bilinear filtering:
			vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;

			// We do a scale and bias for mapping to texel space:
			texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );

			// Move to proper place, according to the subpixel offset:
			texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

			return texture2D( areaTex, texcoord, 0.0 ).rg;
		}

		vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
			vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );

			vec2 e = texture2D( edgesTex, texcoord ).rg;

			if ( e.g > 0.0 ) { // Edge at north
				vec2 d;

				// Find the distance to the left:
				vec2 coords;
				coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
				coords.y = offset[ 1 ].y; // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)
				d.x = coords.x;

				// Now fetch the left crossing edges, two at a time using bilinear
				// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
				// discern what value each edge has:
				float e1 = texture2D( edgesTex, coords, 0.0 ).r;

				// Find the distance to the right:
				coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
				d.y = coords.x;

				// We want the distances to be in pixel units (doing this here allow to
				// better interleave arithmetic and memory accesses):
				d = d / resolution.x - pixcoord.x;

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				vec2 sqrt_d = sqrt( abs( d ) );

				// Fetch the right crossing edges:
				coords.y -= 1.0 * resolution.y; // WebGL port note: Added
				float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;

				// Ok, we know how this pattern looks like, now it is time for getting
				// the actual area:
				weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
			}

			if ( e.r > 0.0 ) { // Edge at west
				vec2 d;

				// Find the distance to the top:
				vec2 coords;

				coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
				coords.x = offset[ 0 ].x; // offset[1].x = texcoord.x - 0.25 * resolution.x;
				d.x = coords.y;

				// Fetch the top crossing edges:
				float e1 = texture2D( edgesTex, coords, 0.0 ).g;

				// Find the distance to the bottom:
				coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
				d.y = coords.y;

				// We want the distances to be in pixel units:
				d = d / resolution.y - pixcoord.y;

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				vec2 sqrt_d = sqrt( abs( d ) );

				// Fetch the bottom crossing edges:
				coords.y -= 1.0 * resolution.y; // WebGL port note: Added
				float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;

				// Get the area for this direction:
				weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );
			}

			return weights;
		}

		void main() {

			gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );

		}`},SMAABlendShader={name:"SMAABlendShader",uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 2 ];

		void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component
		}

		void main() {

			vUv = uv;

			SMAANeighborhoodBlendingVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform sampler2D tColor;
		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 2 ];

		vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
			// Fetch the blending weights for current pixel:
			vec4 a;
			a.xz = texture2D( blendTex, texcoord ).xz;
			a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
			a.w = texture2D( blendTex, offset[ 1 ].xy ).a;

			// Is there any blending weight with a value greater than 0.0?
			if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
				return texture2D( colorTex, texcoord, 0.0 );
			} else {
				// Up to 4 lines can be crossing a pixel (one through each edge). We
				// favor blending by choosing the line with the maximum weight for each
				// direction:
				vec2 offset;
				offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
				offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

				// Then we go in the direction that has the maximum weight:
				if ( abs( offset.x ) > abs( offset.y )) { // horizontal vs. vertical
					offset.y = 0.0;
				} else {
					offset.x = 0.0;
				}

				// Fetch the opposite color and lerp by hand:
				vec4 C = texture2D( colorTex, texcoord, 0.0 );
				texcoord += sign( offset ) * resolution;
				vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
				float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );

				// WebGL port note: Added gamma correction
				C.xyz = pow(C.xyz, vec3(2.2));
				Cop.xyz = pow(Cop.xyz, vec3(2.2));
				vec4 mixed = mix(C, Cop, s);
				mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

				return mixed;
			}
		}

		void main() {

			gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );

		}`};class SMAAPass extends Pass{constructor(e,i){super(),this.edgesRT=new WebGLRenderTarget(e,i,{depthBuffer:!1,type:HalfFloatType}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new WebGLRenderTarget(e,i,{depthBuffer:!1,type:HalfFloatType}),this.weightsRT.texture.name="SMAAPass.weights";const r=this,o=new Image;o.src=this.getAreaTexture(),o.onload=function(){r.areaTexture.needsUpdate=!0},this.areaTexture=new Texture,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=o,this.areaTexture.minFilter=LinearFilter,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;const l=new Image;l.src=this.getSearchTexture(),l.onload=function(){r.searchTexture.needsUpdate=!0},this.searchTexture=new Texture,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=l,this.searchTexture.magFilter=NearestFilter,this.searchTexture.minFilter=NearestFilter,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,this.uniformsEdges=UniformsUtils.clone(SMAAEdgesShader.uniforms),this.uniformsEdges.resolution.value.set(1/e,1/i),this.materialEdges=new ShaderMaterial({defines:Object.assign({},SMAAEdgesShader.defines),uniforms:this.uniformsEdges,vertexShader:SMAAEdgesShader.vertexShader,fragmentShader:SMAAEdgesShader.fragmentShader}),this.uniformsWeights=UniformsUtils.clone(SMAAWeightsShader.uniforms),this.uniformsWeights.resolution.value.set(1/e,1/i),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new ShaderMaterial({defines:Object.assign({},SMAAWeightsShader.defines),uniforms:this.uniformsWeights,vertexShader:SMAAWeightsShader.vertexShader,fragmentShader:SMAAWeightsShader.fragmentShader}),this.uniformsBlend=UniformsUtils.clone(SMAABlendShader.uniforms),this.uniformsBlend.resolution.value.set(1/e,1/i),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new ShaderMaterial({uniforms:this.uniformsBlend,vertexShader:SMAABlendShader.vertexShader,fragmentShader:SMAABlendShader.fragmentShader}),this.fsQuad=new FullScreenQuad(null)}render(e,i,r){this.uniformsEdges.tDiffuse.value=r.texture,this.fsQuad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),this.fsQuad.render(e),this.uniformsBlend.tColor.value=r.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.clear&&e.clear(),this.fsQuad.render(e))}setSize(e,i){this.edgesRT.setSize(e,i),this.weightsRT.setSize(e,i),this.materialEdges.uniforms.resolution.value.set(1/e,1/i),this.materialWeights.uniforms.resolution.value.set(1/e,1/i),this.materialBlend.uniforms.resolution.value.set(1/e,1/i)}getAreaTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}dispose(){this.edgesRT.dispose(),this.weightsRT.dispose(),this.areaTexture.dispose(),this.searchTexture.dispose(),this.materialEdges.dispose(),this.materialWeights.dispose(),this.materialBlend.dispose(),this.fsQuad.dispose()}}const LuminosityHighPassShader={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Color(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class UnrealBloomPass extends Pass{constructor(e,i,r,o){super(),this.strength=i!==void 0?i:1,this.radius=r,this.threshold=o,this.resolution=e!==void 0?new Vector2(e.x,e.y):new Vector2(256,256),this.clearColor=new Color(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let l=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new WebGLRenderTarget(l,a,{type:HalfFloatType}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let m=0;m<this.nMips;m++){const h=new WebGLRenderTarget(l,a,{type:HalfFloatType});h.texture.name="UnrealBloomPass.h"+m,h.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(h);const _=new WebGLRenderTarget(l,a,{type:HalfFloatType});_.texture.name="UnrealBloomPass.v"+m,_.texture.generateMipmaps=!1,this.renderTargetsVertical.push(_),l=Math.round(l/2),a=Math.round(a/2)}const c=LuminosityHighPassShader;this.highPassUniforms=UniformsUtils.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=o,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),this.separableBlurMaterials=[];const d=[3,5,7,9,11];l=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let m=0;m<this.nMips;m++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(d[m])),this.separableBlurMaterials[m].uniforms.invSize.value=new Vector2(1/l,1/a),l=Math.round(l/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=i,this.compositeMaterial.uniforms.bloomRadius.value=.1;const u=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=u,this.bloomTintColors=[new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const f=CopyShader;this.copyUniforms=UniformsUtils.clone(f.uniforms),this.blendMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Color,this.oldClearAlpha=1,this.basic=new MeshBasicMaterial,this.fsQuad=new FullScreenQuad(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,i){let r=Math.round(e/2),o=Math.round(i/2);this.renderTargetBright.setSize(r,o);for(let l=0;l<this.nMips;l++)this.renderTargetsHorizontal[l].setSize(r,o),this.renderTargetsVertical[l].setSize(r,o),this.separableBlurMaterials[l].uniforms.invSize.value=new Vector2(1/r,1/o),r=Math.round(r/2),o=Math.round(o/2)}render(e,i,r,o,l){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),l&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let c=this.renderTargetBright;for(let d=0;d<this.nMips;d++)this.fsQuad.material=this.separableBlurMaterials[d],this.separableBlurMaterials[d].uniforms.colorTexture.value=c.texture,this.separableBlurMaterials[d].uniforms.direction.value=UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[d]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[d].uniforms.colorTexture.value=this.renderTargetsHorizontal[d].texture,this.separableBlurMaterials[d].uniforms.direction.value=UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[d]),e.clear(),this.fsQuad.render(e),c=this.renderTargetsVertical[d];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,l&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeperableBlurMaterial(e){const i=[];for(let r=0;r<e;r++)i.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return new ShaderMaterial({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)},gaussianCoefficients:{value:i}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}UnrealBloomPass.BlurDirectionX=new Vector2(1,0);UnrealBloomPass.BlurDirectionY=new Vector2(0,1);const ColorFiltersShader={defines:{EXPOSURE:1,CONTRAST:0,sRGB_ENCODING:1,TONE_MAPPING_O:4,FILM_GRAIN:1,VIGNETTE:1,POWER:0},uniforms:{tDiffuse:{value:null},tSpecular:{value:null},noise_time:{value:0},contrast:{value:5},exposure:{value:1.5},power:{value:1},vignette_intensity:{value:1},blackout:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#define saturate(a) clamp( a, 0.0, 1.0 )

		uniform sampler2D tDiffuse;
		uniform sampler2D tSpecular;
		uniform float contrast;
		uniform float exposure;
		uniform float power;
		uniform float vignette_intensity;
		uniform float blackout;
		
		uniform float noise_time;
		varying vec2 vUv;


		vec3 Linear_to_sRGB(vec3 RGB) {
			#if sRGB_ENCODING == 1
				return pow(RGB, vec3(1.0/2.2));
			#else
				return RGB;
			#endif
		}

		vec3 Uncharted2ToneMap(const vec3 x) {
			const float A = 0.15;
			const float B = 0.50;
			const float C = 0.10;
			const float D = 0.20;
			const float E = 0.02;
			const float F = 0.30;
			return ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F;
		}

		vec3 ToneMap_Uncharted2(const vec3 color) {
			const float W = 11.2;
			const float exposureBias = 2.0;
			vec3 curr = Uncharted2ToneMap(exposureBias * color);
			vec3 whiteScale = 1.0 / Uncharted2ToneMap(vec3(W));
			return curr * whiteScale;
		}

		vec3 RRTAndODTFit( vec3 v ) {

			vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
			vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
			return a / b;

		}
		vec3 ToneMap_ACESFilm_older(vec3 x) {
			const float a = 2.51;
			const float b = 0.03;
			const float c = 2.43;
			const float d = 0.59;
			const float e = 0.14;
			return clamp((x*(a*x+b))/(x*(c*x+d)+e), 0.0, 1.0);
		}
		
		vec3 ToneMap_ACESFilm( vec3 color ) {

			// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT
			const mat3 ACESInputMat = mat3(
				vec3( 0.59719, 0.07600, 0.02840 ), // transposed from source
				vec3( 0.35458, 0.90834, 0.13383 ),
				vec3( 0.04823, 0.01566, 0.83777 )
			);

			// ODT_SAT => XYZ => D60_2_D65 => sRGB
			const mat3 ACESOutputMat = mat3(
				vec3(  1.60475, -0.10208, -0.00327 ), // transposed from source
				vec3( -0.53108,  1.10813, -0.07276 ),
				vec3( -0.07367, -0.00605,  1.07602 )
			);

			color = ACESInputMat * color;

			// Apply RRT and ODT
			color = RRTAndODTFit( color );

			color = ACESOutputMat * color;

			// Clamp to [0, 1]
			return saturate( color );
	
		}

		vec3 ToneMap_ACESFilmApprox(vec3 x) {
		    return -0.053173 + x*(2.170622 + x*(-2.132296 + x*(0.996822 + x*-0.176583)));
		}

		vec3 ToneMap_Reinhard(const vec3 color) {
			return color / (color + vec3(1.0));
		}

		vec3 ToneMap_Filmic(const vec3 color) {
			vec3 x = max(vec3(0.0), color - 0.004);
			return (x * (6.2 * x + 0.5)) / (x * (6.2 * x + 1.7) + 0.06);
		}


		// Matrices for rec 2020 <> rec 709 color space conversion
		// matrix provided in row-major order so it has been transposed
		// https://www.itu.int/pub/R-REP-BT.2407-2017
		const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
			vec3( 1.6605, - 0.1246, - 0.0182 ),
			vec3( - 0.5876, 1.1329, - 0.1006 ),
			vec3( - 0.0728, - 0.0083, 1.1187 )
		);
		
		const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
			vec3( 0.6274, 0.0691, 0.0164 ),
			vec3( 0.3293, 0.9195, 0.0880 ),
			vec3( 0.0433, 0.0113, 0.8956 )
		);
		
		// https://iolite-engine.com/blog_posts/minimal_agx_implementation
		// Mean error^2: 3.6705141e-06
		vec3 agxDefaultContrastApprox( vec3 x ) {
		
			vec3 x2 = x * x;
			vec3 x4 = x2 * x2;
		
			return + 15.5 * x4 * x2
				- 40.14 * x4 * x
				+ 31.96 * x4
				- 6.868 * x2 * x
				+ 0.4298 * x2
				+ 0.1191 * x
				- 0.00232;
		
		}
		
		// Input and output encoded as Linear-sRGB.
		vec3 AgXToneMapping( vec3 color ) {
		
			// AgX constants
			const mat3 AgXInsetMatrix = mat3(
				vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
				vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
				vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
			);
		
			// explicit AgXOutsetMatrix generated from Filaments AgXOutsetMatrixInv
			const mat3 AgXOutsetMatrix = mat3(
				vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
				vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
				vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
			);
		
			const float AgxMinEv = - 12.47393;  // log2(pow(2, LOG2_MIN) * MIDDLE_GRAY)
			const float AgxMaxEv = 4.026069;    // log2(pow(2, LOG2_MAX) * MIDDLE_GRAY)
		
			// AGX Tone Mapping implementation based on Filament, which is in turn based
			// on Blender's implementation for rec 2020 colors:
			// https://github.com/google/filament/pull/7236
			color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;

			#if EXPOSURE == 1
				color *= exposure;
			#endif
		
			color = AgXInsetMatrix * color;
		
			// Log2 encoding
			color = max( color, 1e-10 ); // avoid 0 or negative numbers for log2
			color = log2( color );
			color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
		
			color = clamp( color, 0.0, 1.0 );
		
			// Apply sigmoid
			color = agxDefaultContrastApprox( color );
		
			// Apply AgX look
			// v = agxLook(v, look);
		
			color = AgXOutsetMatrix * color;
		
			// Linearize
			#if sRGB_ENCODING == 1
				color = max( vec3( 0.0 ), color );
			#else
				color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
				color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
			#endif

		
			return color;
		
		}
		
		

		vec3 rgb2hsv(vec3 c)
		{
			vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
			vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
			vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

			float d = q.x - min(q.w, q.y);
			float e = 1.0e-10;
			return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
		}

		vec3 hsv2rgb(vec3 c)
		{
			vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
			vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
			return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
		}


		vec3 Contrast(vec3 c) {
			c = clamp(c,0.0,1.0);
			vec3 d = 1.0/(1.0+exp(-contrast*(c-0.5)));
			float p = length(d);
			vec3 ret = mix(c,d,p);
			ret = clamp(ret, 0.0, 1.0);
			return ret;
		}

		float rand(const vec2 co) {
			return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
		}
		
		vec3 Vignette(vec3 rgb) {
			float ma = (1.0-distance(vec2(0.5),vUv));
			return mix(rgb, mix(rgb * ma, rgb, ma), vignette_intensity);
		}

		vec3 exposure_rgb(vec3 rgb) {
			#if EXPOSURE == 1
				rgb *= exposure;
				return rgb;
			#else
				return rgb;
			#endif
		}

		vec3 power_rgb(vec3 rgb) {
			#if POWER == 1
				rgb = pow(rgb,vec3(power));
				return rgb;
			#else
				return rgb;
			#endif
		}


		void main() {
			// vec4 color4 = textureLod( tDiffuse, vUv, 3.0);
			vec4 color4 = texture2D( tDiffuse, vUv);
			// vec4 color5 = texture2D( tSpecular, vec2(0.5,0.5));
			// vec3 rgb = (color4.xyz+color5.xyz)/2.0;
			vec3 rgb = color4.xyz;





			#if TONE_MAPPING_O == 1
				rgb = power_rgb(rgb);
				rgb = exposure_rgb(rgb);
				rgb = ToneMap_Uncharted2(rgb);
				rgb = Linear_to_sRGB(rgb);
			#elif TONE_MAPPING_O == 2
				rgb = power_rgb(rgb);
				rgb = exposure_rgb(rgb);
				rgb = ToneMap_Reinhard(rgb);
				rgb = Linear_to_sRGB(rgb);
			#elif TONE_MAPPING_O == 3
				rgb = power_rgb(rgb);
				rgb = exposure_rgb(rgb);
				rgb = ToneMap_Filmic(rgb);
			#elif TONE_MAPPING_O == 4
				rgb = power_rgb(rgb);
				// rgb = exposure_rgb(rgb);
				#if EXPOSURE == 1
					rgb *= exposure / 0.6;
				#else
					rgb *= 1.0 / 0.6;
				#endif			
				rgb = ToneMap_ACESFilm(rgb);
				rgb = Linear_to_sRGB(rgb);
			#elif TONE_MAPPING_O == 5
				rgb = power_rgb(rgb);
				rgb = AgXToneMapping(rgb);
			#else
				rgb = power_rgb(rgb);
				rgb = exposure_rgb(rgb);
				rgb = Linear_to_sRGB(rgb);
			#endif





			// FilmGrain
			#if FILM_GRAIN == 1
				rgb = pow(rgb, vec3(1.0+rand(vUv+vec2(noise_time*0.127))*0.1));
			#endif

			// Vignette
			#if VIGNETTE == 1
				rgb = Vignette(rgb);
			#endif
			
			#if CONTRAST == 1
				rgb = Contrast(rgb);
			#endif


			// float glay = 0.21 * color5.x + 0.71 * color5.y + 0.07 * color5.z;
			// rgb = rgb + (exposure-glay)*0.01;//f*0.2;
			// rgb = mix(rgb,vec3(glay), 0.9);
			// rgb = rgb + rgb*(exposure-glay) * 0.4;
			// rgb = rgb + (glay-exposure) * 0.4;
			// rgb = rgb + rgb*(exposure-glay) * 0.01;
			// glay = clamp(glay, 0.0, 0.9);
			// float f = exposure-glay;//((0.9-glay)*0.8+0.1);
			// float f_acc = f * 0.001;
			// rgb = (color5.xyz+rgb)/2.0;//rgb + rgb*(glay-1.0) ;//* 0.01;
			// rgb = rgb + (rgb*exposure - rgb*glay) * 0.1;
			// rgb *= exposure;
			// rgb *= (1.0 - color5.x) * exposure;

			color4.xyz = rgb * vec3(blackout);
			gl_FragColor = color4;



		}`};class ColorFiltersPass extends Pass{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!1,this.clearDepth=!1,this.needsSwap=!0,this.copy_pass=new ShaderPass(CopyShader),this.width=this.height=1;const r=CopyShader;this.copyUniforms=UniformsUtils.clone(r.uniforms),this.copyMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,premultipliedAlpha:!1,transparent:!1,blending:NoBlending,depthTest:!1,depthWrite:!1}),this.cnt=0,this.fsQuad=new FullScreenQuad(this.copyMaterial),this.color_filters_pass=new ShaderPass(ColorFiltersShader),this.counter=0,this.renderTarget=this.create_render_target(this.width,this.height),this.renderTargetLod=this.create_render_target(128,128,{type:FloatType,minFilter:LinearMipMapLinearFilter}),this.renderTargetLod.texture.generateMipmaps=!0,this.noise_time=performance.now(),this.self_delta=0,this.previous_time=performance.now()}create_render_target(e,i,r={}){const o={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,type:HalfFloatType,depthBuffer:!1,stencilBuffer:!1,colorSpace:NoColorSpace};return Object.assign(o,r),new WebGLRenderTarget(e,i,o)}compile(){this.needsCompile=!0}dispose(){this.fsQuad.dispose()}setSize(e,i){this.width=e,this.height=i,this.renderTarget.setSize(e,i)}render(e,i,r,o,l){const a=performance.now();this.self_delta=a-this.previous_time,this.previous_time=a,this.needsCompile&&(this.needsCompile=!1,this.color_filters_pass.material.needsUpdate=!0),this.counter++%7==0&&(this.noise_time+=this.self_delta*1e3,this.color_filters_pass.material.uniforms.noise_time.value=this.noise_time%1e4/1e4),this.color_filters_pass.render(e,this.renderTarget,r),this.copy_pass.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.copy_pass.render(e,this.renderToScreen?null:i,this.renderTarget)}}const prev_skinning_pars_vertex=`
		${ShaderChunk.common}
		${ShaderChunk.uv_pars_vertex}
		${ShaderChunk.batching_pars_vertex}
		${ShaderChunk.displacementmap_pars_vertex}
		${ShaderChunk.normal_pars_vertex}
		${ShaderChunk.morphtarget_pars_vertex}
        ${ShaderChunk.skinning_pars_vertex}

        // #include <common>
        // #include <batching_pars_vertex>
        // #include <uv_pars_vertex>
        // #include <displacementmap_pars_vertex>
        // #include <color_pars_vertex>
        // #include <fog_pars_vertex>
        // #include <normal_pars_vertex>
        // #include <morphtarget_pars_vertex>
        // #include <skinning_pars_vertex>
        // #include <shadowmap_pars_vertex>
        // #include <logdepthbuf_pars_vertex>
        // #include <clipping_planes_pars_vertex>
        
		#ifdef USE_SKINNING
		uniform sampler2D prevBoneTexture;
		mat4 getPrevBoneMatrix( const in float i ) {
			int boneTextureSize = textureSize( boneTexture, 0 ).x;
			
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( prevBoneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( prevBoneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( prevBoneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( prevBoneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
		#endif




	`,velocity_vertex=`
        // #include <uv_vertex>
        // #include <color_vertex>
        // #include <morphcolor_vertex>
        // #include <batching_vertex>

        // #include <beginnormal_vertex>
        // #include <morphnormal_vertex>
        // #include <skinbase_vertex>
        // #include <skinnormal_vertex>
        // #include <defaultnormal_vertex>
        // #include <normal_vertex>
    
        // #include <begin_vertex>
        // #include <morphtarget_vertex>
        // #include <skinning_vertex>
        // #include <displacementmap_vertex>
        // #include <project_vertex>
        // #include <logdepthbuf_vertex>
        // #include <clipping_planes_vertex>

        ${ShaderChunk.uv_vertex}


        ${ShaderChunk.beginnormal_vertex}
        ${ShaderChunk.morphnormal_vertex}
		${ShaderChunk.skinbase_vertex}
		${ShaderChunk.skinnormal_vertex}
		${ShaderChunk.defaultnormal_vertex}
		${ShaderChunk.normal_vertex}


        

		// Get the current vertex position
		${ShaderChunk.begin_vertex}
		transformed = vec3( position );
		${ShaderChunk.morphtarget_vertex}
		${ShaderChunk.skinning_vertex}

        vec3 displacedPosition = vec3(0.0);
        #ifdef USE_DISPLACEMENTMAP

            displacedPosition = normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
            
        #endif

        transformed += displacedPosition;
		newPosition = modelViewMatrix * vec4(transformed, 1.0);
		// #ifdef USE_INSTANCING
        //     newPosition = instanceMatrix * mvPosition;
        // #endif

		// Get the previous vertex position
		${ShaderChunk.skinbase_vertex.replace(/mat4 /g,"").replace(/getBoneMatrix/g,"getPrevBoneMatrix").replace(/bindMatrixInverse/g,"prevBindMatrixInverse").replace(/bindMatrix/g,"prevBindMatrix")}
		transformed = vec3( position );
		${ShaderChunk.morphtarget_vertex}
		${ShaderChunk.skinning_vertex.replace(/vec4 /g,"").replace(/bindMatrixInverse/g,"prevBindMatrixInverse").replace(/bindMatrix/g,"prevBindMatrix")}

        transformed += displacedPosition;
		prevPosition = prevModelViewMatrix * vec4(transformed, 1.0);
        


		// The delta between frames
		vec3 delta = newPosition.xyz - prevPosition.xyz;
		float d = length(delta);
		vec4 newPosition2;
		vec4 prevPosition2;
		float stretchDot = 0.0;
		if (d > 0.001) {
			vec3 direction = normalize(delta);
			// Stretch along the velocity axes
			// TODO: Can we combine the stretch and expand
			stretchDot = dot(direction, transformedNormal);
			vec4 expandDir = vec4(direction, 0.0) * stretchDot * expandGeometry * d;
			newPosition2 = projectionMatrix * (newPosition + expandDir);
			prevPosition2 = prevProjectionMatrix * (prevPosition + expandDir);
		} else {
			newPosition2 = projectionMatrix * newPosition;
			prevPosition2 = prevProjectionMatrix * prevPosition;
		}

		newPosition = projectionMatrix * newPosition;
		prevPosition = prevProjectionMatrix * prevPosition;

		gl_Position = mix(newPosition2, prevPosition2, interpolateGeometry * (1.0 - step(0.0, stretchDot) ) );

	`;class BlueNoiseSamples{constructor(e){this.count=0,this.size=-1,this.sigma=-1,this.radius=-1,this.lookupTable=null,this.score=null,this.binaryPattern=null,this.resize(e),this.setSigma(1.5)}findVoid(){const{score:e,binaryPattern:i}=this;let r=1/0,o=-1;for(let l=0,a=i.length;l<a;l++){if(i[l]!==0)continue;const c=e[l];c<r&&(r=c,o=l)}return o}findCluster(){const{score:e,binaryPattern:i}=this;let r=-1/0,o=-1;for(let l=0,a=i.length;l<a;l++){if(i[l]!==1)continue;const c=e[l];c>r&&(r=c,o=l)}return o}setSigma(e){if(e===this.sigma)return;const i=~~(Math.sqrt(10*2*e**2)+1),r=2*i+1,o=new Float32Array(r*r),l=e*e;for(let a=-i;a<=i;a++)for(let c=-i;c<=i;c++){const d=(i+c)*r+a+i,u=a*a+c*c;o[d]=Math.E**(-u/(2*l))}this.lookupTable=o,this.sigma=e,this.radius=i}resize(e){this.size!==e&&(this.size=e,this.score=new Float32Array(e*e),this.binaryPattern=new Uint8Array(e*e))}invert(){const{binaryPattern:e,score:i,size:r}=this;i.fill(0);for(let o=0,l=e.length;o<l;o++)if(e[o]===0){const a=~~(o/r),c=o-a*r;this.updateScore(c,a,1),e[o]=1}else e[o]=0}updateScore(e,i,r){const{size:o,score:l,lookupTable:a}=this,c=this.radius,d=2*c+1;for(let u=-c;u<=c;u++)for(let f=-c;f<=c;f++){const m=(c+f)*d+u+c,h=a[m];let _=e+u;_=_<0?o+_:_%o;let b=i+f;b=b<0?o+b:b%o;const v=b*o+_;l[v]+=r*h}}addPointIndex(e){this.binaryPattern[e]=1;const i=this.size,r=~~(e/i),o=e-r*i;this.updateScore(o,r,1),this.count++}removePointIndex(e){this.binaryPattern[e]=0;const i=this.size,r=~~(e/i),o=e-r*i;this.updateScore(o,r,-1),this.count--}copy(e){this.resize(e.size),this.score.set(e.score),this.binaryPattern.set(e.binaryPattern),this.setSigma(e.sigma),this.count=e.count}}const VelocityShader={uniforms:{prevProjectionMatrix:{value:new Matrix4},prevModelViewMatrix:{value:new Matrix4},prevBindMatrix:{value:new Matrix4},prevBindMatrixInverse:{value:new Matrix4},prevBoneTexture:{value:null},expandGeometry:{value:0},interpolateGeometry:{value:1},smearIntensity:{value:1}},vertexShader:`
		${prev_skinning_pars_vertex}

			uniform mat4 prevProjectionMatrix;
			uniform mat4 prevModelViewMatrix;
			uniform mat4 prevBindMatrix;
			uniform mat4 prevBindMatrixInverse;
			uniform float expandGeometry;
			uniform float interpolateGeometry;
			varying vec4 prevPosition;
			varying vec4 newPosition;

			void main() {
				${velocity_vertex}
			}
		`,fragmentShader:`
			uniform float smearIntensity;
			varying vec4 prevPosition;
			varying vec4 newPosition;
			${ShaderChunk.alphamap_pars_fragment}
			${ShaderChunk.alphatest_pars_fragment}
			${ShaderChunk.uv_pars_fragment}	
			void main() {
				vec4 diffuseColor = vec4(1.0);
				${ShaderChunk.alphamap_fragment}
				${ShaderChunk.alphatest_fragment}
				// NOTE: It seems the velociyt is incorrectly calculated here -- see the velocity pass
				// in shader replacement to see how to compute velocities in screen uv space.
				vec3 vel;
				vel = (newPosition.xyz / newPosition.w) - (prevPosition.xyz / prevPosition.w);

				gl_FragColor = vec4(vel * smearIntensity, 1.0);
			}
		`},GeometryShader={uniforms:{prevProjectionMatrix:{value:new Matrix4},prevModelViewMatrix:{value:new Matrix4},prevBindMatrix:{value:new Matrix4},prevBoneTexture:{value:null},expandGeometry:{value:0},interpolateGeometry:{value:1},smearIntensity:{value:1}},vertexShader:`
			${ShaderChunk.skinning_pars_vertex}
			${prev_skinning_pars_vertex}

			uniform mat4 prevProjectionMatrix;
			uniform mat4 prevModelViewMatrix;
			uniform mat4 prevBindMatrix;
			uniform float expandGeometry;
			uniform float interpolateGeometry;
			varying vec4 prevPosition;
			varying vec4 newPosition;
			varying vec3 color;

			void main() {

				${velocity_vertex}

				color = (modelViewMatrix * vec4(normal.xyz, 0)).xyz;
				color = normalize(color);

			}
		`,fragmentShader:`
			varying vec3 color;

			void main() {
				gl_FragColor = vec4(color, 1);
			}
		`},CompositeShader={defines:{SAMPLES:30,JITTER_STRATEGY:1,BLUENOISE_SIZE:"32.0"},uniforms:{sourceBuffer:{value:null},velocityBuffer:{value:null},depthBuffer:{value:null},jitter:{value:1},blueNoiseTex:{value:null},intensity:{value:1}},vertexShader:`
			varying vec2 vUv;
			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}
		`,fragmentShader:`
			varying vec2 vUv;
			uniform sampler2D sourceBuffer;
			uniform sampler2D velocityBuffer;
			uniform sampler2D depthBuffer;
			uniform float jitter;
			uniform float intensity;

			#if JITTER_STRATEGY == 2 // blue noise
			uniform sampler2D blueNoiseTex;
			#endif

			#include <common>

			float sig(float x,float a) {
				return 1.0/(1.0+exp(-x*a));
			}
			void main() {

				vec2 vel = texture2D( velocityBuffer, vUv ).xy * intensity;

				#if JITTER_STRATEGY == 0 // Regular Jitter
				float jitterValue = mod( ( gl_FragCoord.x + gl_FragCoord.y ) * 0.25, 1.0 );
				#elif JITTER_STRATEGY == 1 // Random Jitter
				float jitterValue = rand( gl_FragCoord.xy * 0.01 );
				#elif JITTER_STRATEGY == 2 // Blue Noise Jitter
				float jitterValue = texture2D( blueNoiseTex, gl_FragCoord.xy / BLUENOISE_SIZE ).r;
				#endif

				vec2 jitterOffset = jitter * vel * vec2( jitterValue ) / float( SAMPLES );

				vec2 startUv = clamp( vUv - vel * 0.5 + jitterOffset, 0.0, 1.0 );
				vec2 endUv = clamp( vUv + vel * 0.5 + jitterOffset, 0.0, 1.0 );
				vec4 result = texture2D( sourceBuffer, vUv );
				vec4 first = result;
				float depth = texture2D( depthBuffer, vUv ).r - 0.0033;
				float count = 1.0;
				for( int i = 1; i < SAMPLES; i ++ ) {

					vec2 sampleUv = mix( startUv, endUv, float( i ) / float( SAMPLES ) );
					float depth2 = texture2D( depthBuffer, sampleUv ).r;

					if (depth2 > depth) {
						// float d = 1.0 - sig((depth2 - depth)*100.0, 3.5);
						float d = 1.0 - sig((depth2 - depth)*100.0, 5.0);
						result += mix(texture2D( sourceBuffer, sampleUv ), first, d);
						//result += texture2D( sourceBuffer, sampleUv );
						count += 1.0;
					}

				}

				result /= count;
				// result /= float( SAMPLES );

				gl_FragColor = result;

			}
		`};function traverseVisibleMeshes(s,e){if(s.visible){(s.isMesh||s.isSkinnedMesh)&&e(s);const i=s.children;for(let r=0,o=i.length;r<o;r++)traverseVisibleMeshes(i[r],e)}}function shuffleArray(s,e=Math.random){for(let i=s.length-1;i>0;i--){const r=~~((e()-1e-6)*i),o=s[i];s[i]=s[r],s[r]=o}}function fillWithOnes(s,e){s.fill(0);for(let i=0;i<e;i++)s[i]=1}class BlueNoiseGenerator{constructor(){this.random=Math.random,this.sigma=1.5,this.size=64,this.majorityPointsRatio=.1,this.samples=new BlueNoiseSamples(1),this.savedSamples=new BlueNoiseSamples(1)}generate(){const{samples:e,savedSamples:i,sigma:r,majorityPointsRatio:o,size:l}=this;e.resize(l),e.setSigma(r);const a=Math.floor(l*l*o),c=e.binaryPattern;fillWithOnes(c,a),shuffleArray(c,this.random);for(let m=0,h=c.length;m<h;m++)c[m]===1&&e.addPointIndex(m);for(;;){const m=e.findCluster();e.removePointIndex(m);const h=e.findVoid();if(m===h){e.addPointIndex(m);break}e.addPointIndex(h)}const d=new Uint32Array(l*l);i.copy(e);let u;for(u=e.count-1;u>=0;){const m=e.findCluster();e.removePointIndex(m),d[m]=u,u--}const f=l*l;for(u=i.count;u<f/2;){const m=i.findVoid();i.addPointIndex(m),d[m]=u,u++}for(i.invert();u<f;){const m=i.findCluster();i.removePointIndex(m),d[m]=u,u++}return{data:d,maxValue:f}}}class RendererState{constructor(){this.clearAlpha=0,this.clearColor=new Color,this.renderTarget=null,this.outputColorSpace=NoColorSpace,this.overrideMaterial=null,this.shadowsEnabled=!1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.background=null,this.autoUpdate=!0}copy(e,i){e&&(this.clearAlpha=e.getClearAlpha(),this.clearColor=e.getClearColor(this.clearColor),this.renderTarget=e.getRenderTarget(),this.shadowsEnabled=e.shadowMap.enabled,this.outputColorSpace=e.outputColorSpace,this.autoClear=e.autoClear,this.autoClearColor=e.autoClearColor,this.autoClearDepth=e.autoClearDepth,this.autoClearStencil=e.autoClearStencil),i&&(this.overrideMaterial=i.overrideMaterial,this.background=i.background,this.autoUpdate=i.matrixWorldAutoUpdate)}restore(e,i){e&&(e.setClearAlpha(this.clearAlpha),e.setClearColor(this.clearColor),e.setRenderTarget(this.renderTarget),e.shadowMap.enabled=this.shadowsEnabled,e.outputColorSpace=this.outputColorSpace,e.autoClear=this.autoClear,e.autoClearColor=this.autoClearColor,e.autoClearDepth=this.autoClearDepth,e.autoClearStencil=this.autoClearStencil),i&&(i.overrideMaterial=this.overrideMaterial,i.background=this.background,i.matrixWorldAutoUpdate=this.autoUpdate),this.renderTarget=null,this.overrideMaterial=null}}const _blackColor=new Color(0,0,0),_rendererState=new RendererState;let generator=null,blueNoiseTex=null;const COEF_RAD2DEG=180/Math.PI;function sig(s,e=1){return 1/(1+Math.exp(-s*e))}function disposeMaterial(s){if(s!=null)if(Array.isArray(s))for(const e of s)e.dispose?.();else s.dispose?.()}class MotionBlurPass extends Pass{constructor(e,i,r={}){if(super(),generator==null){generator=new BlueNoiseGenerator,generator.size=32;const a=new Uint8Array(32**2*4);for(let c=0,d=1;c<d;c++){const u=generator.generate(),f=u.data,m=u.maxValue;for(let h=0,_=f.length;h<_;h++){const b=255*(f[h]/m);a[h*3+c]=b}}blueNoiseTex=new DataTexture(a,generator.size,generator.size,RGBAFormat),blueNoiseTex.wrapS=RepeatWrapping,blueNoiseTex.wrapT=RepeatWrapping,blueNoiseTex.minFilter=LinearFilter}let o=this;this.enabled=!0,this.needsSwap=!0,this.samples="samples"in r&&typeof r.samples=="number"?r.samples:15,this.expandGeometry="expandGeometry"in r?r.expandGeometry:0,this.interpolateGeometry="interpolateGeometry"in r?r.interpolateGeometry:1,this.smearIntensity="smearIntensity"in r?r.smearIntensity:1,this.blurTransparent="blurTransparent"in r?r.blurTransparent:!1,this.renderCameraBlur="renderCameraBlur"in r?r.renderCameraBlur:!0,this.renderTargetScale="renderTargetScale"in r&&typeof r.renderTargetScale=="number"?r.renderTargetScale:1,this.jitter="jitter"in r?r.jitter:1,this.jitterStrategy="jitterStrategy"in r?r.jitterStrategy:MotionBlurPass.RANDOM_JITTER,this.intensity_backup=this.intensity=.5,this.intensity_acc=1,this.auto_intensity=!0,this.auto_refresh=!0,this.previous_time=0,this.previous_fov=i.fov,this.previous_camera_pos=new Vector3,this.previous_camera_acc=new Vector3,this.previous_camera_tmp1=new Vector3,this.previous_camera_tmp2=new Vector3,this.previous_camera_q=new Quaternion,this.previous_camera_angle_diff=0,this.tmp_group={start:0,count:1/0},this.debug={display:MotionBlurPass.DEFAULT,dontUpdateState:!1},this.scene=e,this.camera=i,this._prevPosMap=new Map,this._currentFrameMod=0,this._frustum=new Frustum,this._projScreenMatrix=new Matrix4,this._cameraMatricesNeedInitializing=!0,this._prevCamProjection=new Matrix4,this._prevCamWorldInverse=new Matrix4;const l=new DepthTexture(1,1);l.type=UnsignedShortType,l.minFilter=NearestFilter,l.magFilter=NearestFilter,this._depthTexture=l,this._velocityBuffer=new WebGLRenderTarget(256,256,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,type:HalfFloatType,depthBuffer:!0,depthTexture:l}),this._velocityBuffer.texture.name="MotionBlurPass.Velocity",this._velocityBuffer.texture.generateMipmaps=!1,this._compositeMaterial=new ShaderMaterial(JSON.parse(JSON.stringify(CompositeShader))),this._compositeQuad=new FullScreenQuad(this._compositeMaterial),this._copyShader=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader.replace("gl_FragColor = texture2D( tDiffuse, vUv )","gl_FragColor = vec4(vec3(texture2D( tDiffuse, vUv ).r), 1.0)"),blending:NoBlending}),this._copyQuad=new FullScreenQuad(this._copyShader),this._color_backup_=new THREE.Color,this._alpha_backup_=0,DMC.addEventListener("change@scene",a=>{o._prevPosMap=new Map;for(const c in o._prevPosMap){const d=o._prevPosMap[c];disposeMaterial(d.velocityMaterial),disposeMaterial(d.geometryMaterial),disposeMaterial(d.boneTexture)}this._prevPosMap.clear()})}dispose(){const e=this;this._compositeQuad.dispose(),this._velocityBuffer.dispose();for(const i in e._prevPosMap){const r=e._prevPosMap[i];disposeMaterial(r.velocityMaterial),disposeMaterial(r.geometryMaterial),disposeMaterial(r.boneTexture)}this._prevPosMap.clear(),this._depthTexture.dispose()}setSize(e,i){const r=this.renderTargetScale;this._velocityBuffer.setSize(e*r,i*r),this.needsCompile=!0}_updateMaterial(e,i){let r=!1,o=i.visible;i.depthWrite==!1&&(o=!1),i.opacity<=i.alphaTest&&(o=!1),e.visible!==o&&(e.visible=o,r=!0),e.depthWrite!==i.depthWrite&&(e.depthWrite=i.depthWrite,r=!0),e.depthTest!==i.depthTest&&(e.depthTest=i.depthTest,r=!0),e.depthFunc!==i.depthFunc&&(e.depthFunc=i.depthFunc,r=!0),e.alphaHash!==i.alphaHash&&(e.alphaHash=i.alphaHash,r=!0),e.transparent!==i.transparent&&(e.transparent=i.transparent,r=!0),e.alphaToCoverage!==i.alphaToCoverage&&(e.alphaToCoverage=i.alphaToCoverage,r=!0),e.side!==i.side&&(e.side=i.side,r=!0),e.normalMapType!==i.normalMapType&&(e.normalMapType=i.normalMapType,r=!0),e.flatShading!==i.flatShading&&(e.flatShading=i.flatShading,r=!0),e.map!==i.map&&(e.map=i.map,r=!0),e.alphaMap!==i.alphaMap&&(e.alphaMap=i.alphaMap,r=!0),e.displacementMap!==void 0&&e.displacementMap!=i.displacementMap&&(e.displacementMap=i.displacementMap,e.uniforms.displacementMap.value=i.displacementMap,e.extensions.derivatives=!0,r=!0),i.displacementScale!==void 0&&e.displacementScale!=null&&(e.displacementScale=i.displacementScale,e.uniforms.displacementScale.value=i.displacementScale),i.displacementBias!==void 0&&e.displacementBias!=null&&(e.displacementBias=i.displacementBias,e.uniforms.displacementBias.value=i.displacementBias),i.opacity!==void 0&&(e.opacity=i.opacity),i.alphaTest!==void 0&&(e.alphaTest=i.alphaTest),r&&(e.needsUpdate=!0)}render(e,i,r){const o=this.debug,l=this.scene,a=this.camera,c=this._compositeQuad,d=this.renderToScreen?null:i;if(this.auto_intensity||this.auto_refresh){let f=this.previous_camera_pos.distanceTo(a.position);this.previous_camera_tmp1.copy(this.previous_camera_acc),this.previous_camera_acc.subVectors(a.position,this.previous_camera_pos),this.previous_camera_tmp2.copy(this.previous_camera_acc),this.previous_camera_tmp1.normalize(),this.previous_camera_tmp2.normalize();let m=this.previous_camera_tmp1.dot(this.previous_camera_tmp2);this.previous_camera_pos.copy(a.position);let h=Math.abs(a.fov-this.previous_fov);this.previous_fov=a.fov;const _=Math.abs(this.previous_camera_q.angleTo(a.quaternion))*COEF_RAD2DEG;if(this.previous_camera_q.copy(a.quaternion),this.auto_refresh&&(m<-.25||m<=.8&&f>10||h>5||_>Math.max(15,this.previous_camera_angle_diff*3)))this.intensity=0;else if(this.auto_intensity){let b=1e3/(performance.now()-this.previous_time+1e-4);this.intensity=1-(sig(1/b,1/((b+10)*.005))-.5)*2}else this.intensity=this.intensity_backup;this.previous_time=performance.now(),this.previous_camera_angle_diff=_}else this.intensity=this.intensity_backup;_rendererState.copy(e,l);const u=e.autoClear;switch(e.autoClear=!1,e.getClearColor(this._color_backup_),this._alpha_backup_=e.getClearAlpha(),e.setClearColor(_blackColor,0),this.needsCompile&&(this.needsCompile=!1),this._ensurePrevCameraTransform(),o.display){case MotionBlurPass.GEOMETRY:{e.setRenderTarget(d),e.clear(),this._drawAllMeshes(e,MotionBlurPass.GEOMETRY,!o.dontUpdateState),this._copyShader.uniforms.tDiffuse.value=this._velocityBuffer.depthTexture,this._copyQuad.render(e);break}case MotionBlurPass.VELOCITY:{e.setRenderTarget(d),e.clear(),this._drawAllMeshes(e,MotionBlurPass.VELOCITY,!o.dontUpdateState),this._copyShader.uniforms.tDiffuse.value=this._velocityBuffer.depthTexture,this._copyQuad.render(e);break}case MotionBlurPass.DEFAULT:{e.setRenderTarget(this._velocityBuffer),e.clear(),this._drawAllMeshes(e,MotionBlurPass.VELOCITY,!o.dontUpdateState);const f=this._compositeMaterial,m=f.uniforms;m.sourceBuffer.value=r.texture,m.velocityBuffer.value=this._velocityBuffer.texture,m.depthBuffer.value=this._depthTexture,m.jitter.value=this.jitter,m.blueNoiseTex.value=blueNoiseTex,m.intensity.value=this.intensity*this.intensity_acc,f.defines.SAMPLES!==this.samples&&(f.defines.SAMPLES=Math.max(0,Math.floor(this.samples)),f.needsUpdate=!0),f.defines.JITTER_STRATEGY!==this.jitterStrategy&&(f.defines.JITTER_STRATEGY=this.jitterStrategy,f.needsUpdate=!0),e.setRenderTarget(d),c.render(e);break}}this._prevCamWorldInverse.copy(a.matrixWorldInverse),this._prevCamProjection.copy(a.projectionMatrix),_rendererState.restore(e,l),e.setClearColor(this._color_backup_,this._alpha_backup_),e.autoClear=u}_getPreviousFrameState(e){const i=this._prevPosMap;let r=i.get(e);if(r===void 0){r={lastUsedFrame:-1,matrixWorld:e.matrixWorld.clone(),bindMatrix:e.bindMatrix?e.bindMatrix.clone():new THREE.Matrix4,bindMatrixInverse:e.bindMatrixInverse?e.bindMatrixInverse.clone():new THREE.Matrix4,boneMatrices:null,boneTexture:null};const c=()=>new ShaderMaterial({uniforms:UniformsUtils.clone(GeometryShader.uniforms),vertexShader:GeometryShader.vertexShader,fragmentShader:GeometryShader.fragmentShader}),d=()=>{const u=new ShaderMaterial({uniforms:THREE.UniformsUtils.merge([UniformsUtils.clone(THREE.UniformsLib.common),UniformsUtils.clone(THREE.UniformsLib.displacementmap),UniformsUtils.clone(VelocityShader.uniforms)]),vertexShader:VelocityShader.vertexShader,fragmentShader:VelocityShader.fragmentShader});return u.map=null,u.alphaMap=null,u.alphaTest=0,u.alphaHash=!1,u.transparent=!1,u.depthWrite=!1,u.depthTest=!1,u.side=DoubleSide,u.alphaToCoverage=!1,u.displacementMap=null,u.displacementScale=1,u.displacementBias=0,u};if(Array.isArray(e.material)){r.geometryMaterial=[],r.velocityMaterial=[];for(const u of e.material)r.geometryMaterial.push(c()),r.velocityMaterial.push(d())}else r.geometryMaterial=c(),r.velocityMaterial=d();i.set(e,r)}const o=e.type==="SkinnedMesh"&&e.skeleton&&e.skeleton.bones&&e.skeleton.boneMatrices;Array.isArray(e.material)?(r.geometryMaterial.forEach(c=>c.skinning=o),r.velocityMaterial.forEach(c=>c.skinning=o)):(r.geometryMaterial.skinning=o,r.velocityMaterial.skinning=o);const l=e.skeleton,a=r.boneMatrices===null||r.boneMatrices.length!==l.boneMatrices.length;if(o&&a){const c=new Float32Array(l.boneMatrices.length);c.set(l.boneMatrices),r.boneMatrices=c;const d=Math.sqrt(l.boneMatrices.length/4),u=new DataTexture(c,d,d,RGBAFormat,FloatType);u.needsUpdate=!0,Array.isArray(e.material)?(r.geometryMaterial.forEach(f=>f.uniforms.prevBoneTexture.value=u),r.velocityMaterial.forEach(f=>f.uniforms.prevBoneTexture.value=u)):(r.geometryMaterial.uniforms.prevBoneTexture.value=u,r.velocityMaterial.uniforms.prevBoneTexture.value=u),r.boneTexture=u}return r}_saveCurrentObjectState(e){const i=this._prevPosMap,r=i.get(e);r.boneMatrices!==null?r.boneMatrices.length==e.skeleton.boneMatrices.length?(r.boneMatrices.set(e.skeleton.boneMatrices),r.boneTexture.needsUpdate=!0,r.bindMatrix.copy(e.bindMatrix),r.bindMatrixInverse.copy(e.bindMatrixInverse),r.matrixWorld.copy(e.matrixWorld)):(disposeMaterial(r.velocityMaterial),disposeMaterial(r.geometryMaterial),disposeMaterial(r.boneTexture),i.delete(e)):r.matrixWorld.copy(e.matrixWorld)}_drawAllMeshes(e,i,r){this._currentFrameMod=(this._currentFrameMod+1)%2;const o=this._currentFrameMod,l=this._prevPosMap;traverseVisibleMeshes(this.scene,a=>{this._drawMesh(e,a,i,r),l.has(a)&&(l.get(a).lastUsedFrame=o)}),l.forEach((a,c)=>{a.lastUsedFrame!==o&&(disposeMaterial(a.velocityMaterial),disposeMaterial(a.geometryMaterial),disposeMaterial(a.boneTexture),l.delete(c))})}_draw(e,i,r,o,l){this._updateMaterial(o,l),o.transparent===!0&&o.side===DoubleSide?(o.side=BackSide,o.needsUpdate=!0,e.renderBufferDirect(i,null,r.geometry,o,r,null),o.side=FrontSide,o.needsUpdate=!0,e.renderBufferDirect(i,null,r.geometry,o,r,null),o.side=DoubleSide):(o.needsUpdate=!0,e.renderBufferDirect(i,null,r.geometry,o,r,null))}_applyUniforms(e,i){const r=this.camera,o=e.uniforms;o.expandGeometry.value=this.expandGeometry,o.interpolateGeometry.value=this.interpolateGeometry,o.smearIntensity.value=this.smearIntensity;const l=this.renderCameraBlur?this._prevCamProjection:r.projectionMatrix,a=this.renderCameraBlur?this._prevCamWorldInverse:r.matrixWorldInverse;o.prevProjectionMatrix.value.copy(l),o.prevModelViewMatrix.value.multiplyMatrices(a,i.matrixWorld),i.bindMatrixInverse?(o.prevBindMatrix.value.copy(i.bindMatrix),o.prevBindMatrixInverse.value.copy(i.bindMatrixInverse)):(o.prevBindMatrix.value.identity(),o.prevBindMatrixInverse.value.identity())}_drawMesh(e,i,r,o){const l=i.frustumCulled&&!this._frustum.intersectsObject(i),a=this.camera;if(l)this._prevPosMap.has(i)&&o&&this._saveCurrentObjectState(i);else{const c=this._getPreviousFrameState(i),d=r===MotionBlurPass.GEOMETRY?c.geometryMaterial:c.velocityMaterial;if(i.visible&&!i.__prevent__motion_blur__)if(Array.isArray(i.material)){const u=i.material,f=i.geometry.groups;for(let m=0,h=f.length;m<h;m++){const _=f[m+0],b=u[_.materialIndex],v=d[_.materialIndex];b.visible&&b.opacity>b.alphaTest&&b.motionBlur&&(this._applyUniforms(v,c),this._draw(e,a,i,v,b))}}else{const u=i.material,f=d;u.visible&&u.opacity>u.alphaTest&&u.motionBlur&&(this._applyUniforms(f,c),this._draw(e,a,i,d,u))}i.__prevent__motion_blur__&&delete i.__prevent__motion_blur__,o&&this._saveCurrentObjectState(i)}}_ensurePrevCameraTransform(){const e=this.camera,i=this._projScreenMatrix;this._cameraMatricesNeedInitializing&&(this._prevCamWorldInverse.copy(e.matrixWorldInverse),this._prevCamProjection.copy(e.projectionMatrix),this._cameraMatricesNeedInitializing=!1),i.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i)}}MotionBlurPass.DEFAULT=0;MotionBlurPass.VELOCITY=1;MotionBlurPass.GEOMETRY=2;MotionBlurPass.REGULAR_JITTER=0;MotionBlurPass.RANDOM_JITTER=1;MotionBlurPass.BLUENOISE_JITTER=2;const LensDistortionShader={defines:{BAND_MODE:2,CHROMA_SAMPLES:1},uniforms:{tDiffuse:{value:null},baseIor:{value:.075},bandOffset:{value:.003},jitterIntensity:{value:1},jitterOffset:{value:0}},vertexShader:`

		varying vec2 vUv;
		//varying vec3 viewDir;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			//viewDir = normalize( ( modelViewMatrix * vec4( position, 1.0 ) ).xyz );

		}

	`,fragmentShader:`

		varying vec2 vUv;
		//varying vec3 viewDir;
		uniform float baseIor;
		uniform float bandOffset;
		uniform float jitterIntensity;
		uniform float jitterOffset;
		uniform sampler2D tDiffuse;

		#include <common>
		void main() {

			vec3 normal = vec3( ( 2.0 * vUv - vec2( 1.0 ) ), 1.0 );
			normal.z = 1.0;
			normal = normalize( normal );

			vec4 color = vec4(1.0); // @DDD@

			// if NO BANDS
			#if BAND_MODE == 0

			vec3 refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor );
			color = texture2D( tDiffuse, vUv + refracted.xy );

			// if RGB or RYGCBV BANDS
			#else

			float index, randValue, offsetValue;
			float r, g, b, r_ior, g_ior, b_ior;
			vec3 r_refracted, g_refracted, b_refracted;
			vec4 r_sample, g_sample, b_sample;

			#if BAND_MODE == 2
			float y, c, v, y_ior, c_ior, v_ior;
			vec3 y_refracted, c_refracted, v_refracted;
			vec4 y_sample, c_sample, v_sample;
			#endif

			for ( int i = 0; i < CHROMA_SAMPLES; i ++ ) {

				index = float( i );
				randValue = rand( sin( index + 1. ) * gl_FragCoord.xy + vec2( jitterOffset, - jitterOffset ) ) - 0.5;
				offsetValue = index / float( CHROMA_SAMPLES ) + randValue * jitterIntensity;
				#if BAND_MODE == 1
				randValue *= 2.0;
				#endif

				// Paper describing functions for creating yellow, cyan, and violet bands and reforming
				// them into RGB:
				// https://web.archive.org/web/20061108181225/http://home.iitk.ac.in/~shankars/reports/dispersionraytrace.pdf
				r_ior = 1.0 + bandOffset * ( 0.0 + offsetValue );
				g_ior = 1.0 + bandOffset * ( 2.0 + offsetValue );
				b_ior = 1.0 + bandOffset * ( 4.0 + offsetValue );

				r_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / r_ior );
				g_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / g_ior );
				b_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / b_ior );

				r_sample = texture2D( tDiffuse, vUv + r_refracted.xy );
				g_sample = texture2D( tDiffuse, vUv + g_refracted.xy );
				b_sample = texture2D( tDiffuse, vUv + b_refracted.xy );

				#if BAND_MODE == 2
				y_ior = 1.0 + bandOffset * ( 1.0 + offsetValue );
				c_ior = 1.0 + bandOffset * ( 3.0 + offsetValue );
				v_ior = 1.0 + bandOffset * ( 5.0 + offsetValue );

				y_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / y_ior );
				c_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / c_ior );
				v_refracted = refract( vec3( 0.0, 0.0, - 1.0 ), normal, baseIor / v_ior );

				y_sample = texture2D( tDiffuse, vUv + y_refracted.xy );
				c_sample = texture2D( tDiffuse, vUv + c_refracted.xy );
				v_sample = texture2D( tDiffuse, vUv + v_refracted.xy );

				r = r_sample.r / 2.0;
				y = ( 2.0 * y_sample.r + 2.0 * y_sample.g - y_sample.b ) / 6.0;
				g = g_sample.g / 2.0;
				c = ( 2.0 * c_sample.g + 2.0 * c_sample.b - c_sample.r ) / 6.0;
				b = b_sample.b / 2.0;
				v = ( 2.0 * v_sample.b + 2.0 * v_sample.r - v_sample.g ) / 6.0;

				color.r += r + ( 2.0 * v + 2.0 * y - c ) / 3.0;
				color.g += g + ( 2.0 * y + 2.0 * c - v ) / 3.0;
				color.b += b + ( 2.0 * c + 2.0 * v - y ) / 3.0;
				color.a += g_sample.a;
				#else
				color.r += r_sample.r;
				color.g += g_sample.g;
				color.b += b_sample.b;
				color.a += g_sample.a;
				#endif

			}

			color /= float( CHROMA_SAMPLES );

			#endif

			gl_FragColor = color;//vec4( color, 1.0 );

		}

	`},BokehShader={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		varying vec2 vUv;

		uniform sampler2D tColor;
		uniform sampler2D tDepth;

		uniform float maxblur; // max blur amount
		uniform float aperture; // aperture - bigger values for shallower depth of field

		uniform float nearClip;
		uniform float farClip;

		uniform float focus;
		uniform float aspect;


		#include <packing>

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, nearClip, farClip );
			#else
			return orthographicDepthToViewZ( depth, nearClip, farClip );
			#endif
		}


		float total = 0.0;
		float current_view_z = 0.0;
		float current_view_d = 0.0;
		vec4 col = vec4(0.0);
		vec4 current_col = vec4(0.0);

		vec4 getTexColor(const in sampler2D tColor, const in vec2 uv) {
			total+=1.0;
			vec4 c = texture2D( tColor, uv );
			// float viewZ = getViewZ( getDepth( vUv ) );
			float viewD = getDepth( uv );
			float viewZ = getViewZ( viewD );
			float sub = abs(current_view_d-viewD);
			if (sub > 0.01) {
				return col/total;
				// c.x = 1.0;
			}
			// if (viewD - current_view_d > 0.001) {
			// 	c.x = 1.0;
			// }
			return c;
		}
		void main() {

			vec2 aspectcorrect = vec2( 1.0, aspect );
			current_view_d = getDepth( vUv );
			current_view_z = getViewZ( current_view_d );

			float factor = ( focus + current_view_z ); // current_view_z is <= 0, so this is a difference equation

			vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );

			vec2 dofblur9 = dofblur * 0.9;
			vec2 dofblur7 = dofblur * 0.7;
			vec2 dofblur4 = dofblur * 0.4;

			// vec4 col = vec4( 0.0 );

			current_col = getTexColor( tColor, vUv.xy );
			col += current_col;
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );

			col += getTexColor( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );

			col += getTexColor( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );

			col += getTexColor( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );
			col += getTexColor( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );
			col += getTexColor( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );

			gl_FragColor = col / total;
			// gl_FragColor = col / 41.0;
			
			//gl_FragColor.a = 1.0;

		}`},_positionVector=new Vector3,_normalVector=new Vector3,_tangentVector=new Vector3,_tangentVector4=new Vector4,_morphVector=new Vector3,_temp=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_matrix=new Matrix4,_boneMatrix=new Matrix4;function validateAttributes(s,e){if(!s&&!e)return;const i=s.count===e.count,r=s.normalized===e.normalized,o=s.array.constructor===e.array.constructor,l=s.itemSize===e.itemSize;if(!i||!r||!o||!l)throw new Error}function createAttributeClone(s,e=null){const i=s.array.constructor,r=s.normalized,o=s.itemSize,l=e===null?s.count:e;return new BufferAttribute(new i(o*l),o,r)}function copyAttributeContents(s,e,i=0){if(s.isInterleavedBufferAttribute){const r=s.itemSize;for(let o=0,l=s.count;o<l;o++){const a=o+i;e.setX(a,s.getX(o)),r>=2&&e.setY(a,s.getY(o)),r>=3&&e.setZ(a,s.getZ(o)),r>=4&&e.setW(a,s.getW(o))}}else{const r=e.array,o=r.constructor,l=r.BYTES_PER_ELEMENT*s.itemSize*i;new o(r.buffer,l,s.array.length).set(s.array)}}function addScaledMatrix(s,e,i){const r=s.elements,o=e.elements;for(let l=0,a=o.length;l<a;l++)r[l]+=o[l]*i}function boneNormalTransform(s,e,i){const r=s.skeleton,o=s.geometry,l=r.bones,a=r.boneInverses;_skinIndex.fromBufferAttribute(o.attributes.skinIndex,e),_skinWeight.fromBufferAttribute(o.attributes.skinWeight,e),_matrix.elements.fill(0);for(let c=0;c<4;c++){const d=_skinWeight.getComponent(c);if(d!==0){const u=_skinIndex.getComponent(c);_boneMatrix.multiplyMatrices(l[u].matrixWorld,a[u]),addScaledMatrix(_matrix,_boneMatrix,d)}}return _matrix.multiply(s.bindMatrix).premultiply(s.bindMatrixInverse),i.transformDirection(_matrix),i}function applyMorphTarget(s,e,i,r,o){_morphVector.set(0,0,0);for(let l=0,a=s.length;l<a;l++){const c=e[l],d=s[l];c!==0&&(_temp.fromBufferAttribute(d,r),i?_morphVector.addScaledVector(_temp,c):_morphVector.addScaledVector(_temp.sub(o),c))}o.add(_morphVector)}function mergeBufferGeometries(s,e={useGroups:!1,updateIndex:!1},i=new BufferGeometry){const r=s[0].index!==null,{useGroups:o,updateIndex:l}=e,a=new Set(Object.keys(s[0].attributes)),c={};let d=0;for(let u=0;u<s.length;++u){const f=s[u];let m=0;if(r!==(f.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const h in f.attributes){if(!a.has(h))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+h+'" attribute exists among all geometries, or in none of them.');c[h]===void 0&&(c[h]=[]),c[h].push(f.attributes[h]),m++}if(m!==a.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(o){let h;if(r)h=f.index.count;else if(f.attributes.position!==void 0)h=f.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");i.addGroup(d,h,u),d+=h}}if(r){let u=!1;if(!i.index){let f=0;for(let m=0;m<s.length;++m)f+=s[m].index.count;i.setIndex(new BufferAttribute(new Uint32Array(f),1,!1)),u=!0}if(l||u){const f=i.index;let m=0,h=0;for(let _=0;_<s.length;++_){const b=s[_],v=b.index;for(let w=0;w<v.count;++w)f.setX(m,v.getX(w)+h),m++;h+=b.attributes.position.count}}}for(const u in c){const f=c[u];if(!(u in i.attributes)){let _=0;for(const b in f)_+=f[b].count;i.setAttribute(u,createAttributeClone(c[u][0],_))}const m=i.attributes[u];let h=0;for(const _ in f){const b=f[_];copyAttributeContents(b,m,h),h+=b.count}}return i}class StaticGeometryGenerator{constructor(e){Array.isArray(e)||(e=[e]);const i=[];e.forEach(r=>{r.traverse(o=>{o.isMesh&&i.push(o)})}),this.meshes=i,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","tangent","uv","uv2"],this._intermediateGeometry=new Array(i.length).fill().map(()=>new BufferGeometry)}getMaterials(){const e=[];return this.meshes.forEach(i=>{Array.isArray(i.material)?e.push(...i.material):e.push(i.material)}),e}generate(e=new BufferGeometry){const{meshes:i,useGroups:r,_intermediateGeometry:o}=this;for(let l=0,a=i.length;l<a;l++){const c=i[l],d=o[l];this._convertToStaticGeometry(c,d)}mergeBufferGeometries(o,{useGroups:r},e);for(const l in e.attributes)e.attributes[l].needsUpdate=!0;return e}_convertToStaticGeometry(e,i=new BufferGeometry){const r=e.geometry,o=this.applyWorldTransforms,l=this.attributes.includes("normal"),a=this.attributes.includes("tangent"),c=r.attributes,d=i.attributes;i.index||(i.index=r.index),d.position||i.setAttribute("position",createAttributeClone(c.position)),l&&!d.normal&&c.normal&&i.setAttribute("normal",createAttributeClone(c.normal)),a&&!d.tangent&&c.tangent&&i.setAttribute("tangent",createAttributeClone(c.tangent)),validateAttributes(r.index,i.index),validateAttributes(c.position,d.position),l&&validateAttributes(c.normal,d.normal),a&&validateAttributes(c.tangent,d.tangent);const u=c.position,f=l?c.normal:null,m=a?c.tangent:null,h=r.morphAttributes.position,_=r.morphAttributes.normal,b=r.morphAttributes.tangent,v=r.morphTargetsRelative,w=e.morphTargetInfluences,y=new Matrix3;y.getNormalMatrix(e.matrixWorld);for(let M=0,S=c.position.count;M<S;M++)_positionVector.fromBufferAttribute(u,M),f&&_normalVector.fromBufferAttribute(f,M),m&&(_tangentVector4.fromBufferAttribute(m,M),_tangentVector.fromBufferAttribute(m,M)),w&&(h&&applyMorphTarget(h,w,v,M,_positionVector),_&&applyMorphTarget(_,w,v,M,_normalVector),b&&applyMorphTarget(b,w,v,M,_tangentVector)),e.isSkinnedMesh&&(e.boneTransform(M,_positionVector),f&&boneNormalTransform(e,M,_normalVector),m&&boneNormalTransform(e,M,_tangentVector)),o&&_positionVector.applyMatrix4(e.matrixWorld),d.position.setXYZ(M,_positionVector.x,_positionVector.y,_positionVector.z),f&&(o&&_normalVector.applyNormalMatrix(y),d.normal.setXYZ(M,_normalVector.x,_normalVector.y,_normalVector.z)),m&&(o&&_tangentVector.transformDirection(e.matrixWorld),d.tangent.setXYZW(M,_tangentVector.x,_tangentVector.y,_tangentVector.z,_tangentVector4.w));for(const M in this.attributes){const S=this.attributes[M];S==="position"||S==="tangent"||S==="normal"||!(S in c)||(d[S]||i.setAttribute(S,createAttributeClone(c[S])),validateAttributes(c[S],d[S]),copyAttributeContents(c[S],d[S]))}return i}}class MaterialReplacer{constructor(){this.materialCacheTable=new Map,this.originalClearColor=new Color,this.scene=null,this.camera=null,this.current=0}_updateMaterial(e,i){let r=!1,o=i.visible;i.depthWrite==!1&&(o=!1),i.opacity<=i.alphaTest&&(o=!1),e.visible!==o&&(e.visible=o,r=!0),e.depthWrite!==i.depthWrite&&(e.depthWrite=i.depthWrite,r=!0),e.depthTest!==i.depthTest&&(e.depthTest=i.depthTest,r=!0),e.depthFunc!==i.depthFunc&&(e.depthFunc=i.depthFunc,r=!0),e.alphaHash!==i.alphaHash&&(e.alphaHash=i.alphaHash,r=!0),e.transparent!==i.transparent&&(e.transparent=i.transparent,r=!0),e.alphaToCoverage!==i.alphaToCoverage&&(e.alphaToCoverage=i.alphaToCoverage,r=!0),e.side!==i.side&&(e.side=i.side,r=!0),e.normalMapType!==i.normalMapType&&(e.normalMapType=i.normalMapType,r=!0),e.flatShading!==i.flatShading&&(e.flatShading=i.flatShading,r=!0),e.map!==i.map&&(e.map=i.map,r=!0),e.alphaMap!==i.alphaMap&&(e.alphaMap=i.alphaMap,r=!0),e.normalMap!==void 0&&e.normalMap!==i.normalMap&&(e.normalMap=i.normalMap,r=!0),e.displacementMap!==void 0&&e.displacementMap!=i.displacementMap&&(e.displacementMap=i.displacementMap,r=!0),i.normalScale!==void 0&&e.normalScale&&e.normalScale.copy(i.normalScale),i.displacementScale!==void 0&&e.displacementScale!=null&&(e.displacementScale=i.displacementScale),i.opacity!==void 0&&(e.opacity=i.opacity),i.alphaTest!==void 0&&(e.alphaTest=i.alphaTest),i.displacementBias!==void 0&&e.displacementBias!=null&&(e.displacementBias=i.displacementBias),r&&(e.needsUpdate=!0)}_makeMaterial(e,i){let r=this.materialCacheTable.get(e);return r==null&&(r={material:i()},this.materialCacheTable.set(e,r)),r.current=this.current,this._updateMaterial(r.material,e),r.material}replaceMaterials(e,i){if(e.material){const r=Array.isArray(e.material);let o=e._original_material_==null;if(o==!1&&(r?o=e._original_material_[0]!==e.material[0]:o=e._original_material_!==e.material),o&&(e._original_material_=Array.isArray(e.material)?e.material.slice():e.material),Array.isArray(e._original_material_)){const l=e._original_material_;for(let a=0;a<l.length;++a)e.material[a]=this._makeMaterial(l[a],i)}else e.material=this._makeMaterial(e._original_material_,i)}for(const r of e.children)this.replaceMaterials(r,i)}restoreMaterials(e,i=!0){if(i){const r=this.materialCacheTable;r.forEach((o,l)=>{o.current!==this.current&&(o.material.dispose(),r.delete(l),console.log("Drop:",o.material.name))}),this.current++}if(e._original_material_)if(Array.isArray(e._original_material_)){const r=e.material;for(let o=0;o<r.length;++o)r[o]=e._original_material_[o]}else e.material=e._original_material_;for(const r of e.children)this.restoreMaterials(r,!1)}renderPass(e,i,r,o,l,a){r.getClearColor(this.originalClearColor);const c=r.getClearAlpha(),d=r.autoClear;r.setRenderTarget(o),r.autoClear=!1,l!=null&&(r.setClearColor(l),r.setClearAlpha(a||0),r.clear()),r.render(e,i),r.autoClear=d,r.setClearColor(this.originalClearColor),r.setClearAlpha(c)}}const CENTER=0,AVERAGE=1,SAH=2,CONTAINED=2,TRIANGLE_INTERSECT_COST=1.25,TRAVERSAL_COST=1,BYTES_PER_NODE=6*4+4+4,IS_LEAFNODE_FLAG=65535,FLOAT32_EPSILON=Math.pow(2,-24);class MeshBVHNode{constructor(){}}function arrayToBox(s,e,i){return i.min.x=e[s],i.min.y=e[s+1],i.min.z=e[s+2],i.max.x=e[s+3],i.max.y=e[s+4],i.max.z=e[s+5],i}function getLongestEdgeIndex(s){let e=-1,i=-1/0;for(let r=0;r<3;r++){const o=s[r+3]-s[r];o>i&&(i=o,e=r)}return e}function copyBounds(s,e){e.set(s)}function unionBounds(s,e,i){let r,o;for(let l=0;l<3;l++){const a=l+3;r=s[l],o=e[l],i[l]=r<o?r:o,r=s[a],o=e[a],i[a]=r>o?r:o}}function expandByTriangleBounds(s,e,i){for(let r=0;r<3;r++){const o=e[s+2*r],l=e[s+2*r+1],a=o-l,c=o+l;a<i[r]&&(i[r]=a),c>i[r+3]&&(i[r+3]=c)}}function computeSurfaceArea(s){const e=s[3]-s[0],i=s[4]-s[1],r=s[5]-s[2];return 2*(e*i+i*r+r*e)}function ensureIndex(s,e){if(!s.index){const i=s.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let o;i>65535?o=new Uint32Array(new r(4*i)):o=new Uint16Array(new r(2*i)),s.setIndex(new BufferAttribute(o,1));for(let l=0;l<i;l++)o[l]=l}}function getRootIndexRanges(s){if(!s.groups||!s.groups.length)return[{offset:0,count:s.index.count/3}];const e=[],i=new Set;for(const o of s.groups)i.add(o.start),i.add(o.start+o.count);const r=Array.from(i.values()).sort((o,l)=>o-l);for(let o=0;o<r.length-1;o++){const l=r[o],a=r[o+1];e.push({offset:l/3,count:(a-l)/3})}return e}function getBounds(s,e,i,r,o=null){let l=1/0,a=1/0,c=1/0,d=-1/0,u=-1/0,f=-1/0,m=1/0,h=1/0,_=1/0,b=-1/0,v=-1/0,w=-1/0;const y=o!==null;for(let M=e*6,S=(e+i)*6;M<S;M+=6){const D=s[M+0],k=s[M+1],O=D-k,L=D+k;O<l&&(l=O),L>d&&(d=L),y&&D<m&&(m=D),y&&D>b&&(b=D);const P=s[M+2],N=s[M+3],z=P-N,K=P+N;z<a&&(a=z),K>u&&(u=K),y&&P<h&&(h=P),y&&P>v&&(v=P);const Z=s[M+4],V=s[M+5],H=Z-V,Y=Z+V;H<c&&(c=H),Y>f&&(f=Y),y&&Z<_&&(_=Z),y&&Z>w&&(w=Z)}r[0]=l,r[1]=a,r[2]=c,r[3]=d,r[4]=u,r[5]=f,y&&(o[0]=m,o[1]=h,o[2]=_,o[3]=b,o[4]=v,o[5]=w)}function getCentroidBounds(s,e,i,r){let o=1/0,l=1/0,a=1/0,c=-1/0,d=-1/0,u=-1/0;for(let f=e*6,m=(e+i)*6;f<m;f+=6){const h=s[f+0];h<o&&(o=h),h>c&&(c=h);const _=s[f+2];_<l&&(l=_),_>d&&(d=_);const b=s[f+4];b<a&&(a=b),b>u&&(u=b)}r[0]=o,r[1]=l,r[2]=a,r[3]=c,r[4]=d,r[5]=u}function partition(s,e,i,r,o){let l=i,a=i+r-1;const c=o.pos,d=o.axis*2;for(;;){for(;l<=a&&e[l*6+d]<c;)l++;for(;l<=a&&e[a*6+d]>=c;)a--;if(l<a){for(let u=0;u<3;u++){let f=s[l*3+u];s[l*3+u]=s[a*3+u],s[a*3+u]=f;let m=e[l*6+u*2+0];e[l*6+u*2+0]=e[a*6+u*2+0],e[a*6+u*2+0]=m;let h=e[l*6+u*2+1];e[l*6+u*2+1]=e[a*6+u*2+1],e[a*6+u*2+1]=h}l++,a--}else return l}}const BIN_COUNT=32,binsSort=(s,e)=>s.candidate-e.candidate,sahBins=new Array(BIN_COUNT).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),leftBounds=new Float32Array(6);function getOptimalSplit(s,e,i,r,o,l){let a=-1,c=0;if(l===CENTER)a=getLongestEdgeIndex(e),a!==-1&&(c=(e[a]+e[a+3])/2);else if(l===AVERAGE)a=getLongestEdgeIndex(s),a!==-1&&(c=getAverage(i,r,o,a));else if(l===SAH){const d=computeSurfaceArea(s);let u=TRIANGLE_INTERSECT_COST*o;const f=r*6,m=(r+o)*6;for(let h=0;h<3;h++){const _=e[h],w=(e[h+3]-_)/BIN_COUNT;if(o<BIN_COUNT/4){const y=[...sahBins];y.length=o;let M=0;for(let D=f;D<m;D+=6,M++){const k=y[M];k.candidate=i[D+2*h],k.count=0;const{bounds:O,leftCacheBounds:L,rightCacheBounds:P}=k;for(let N=0;N<3;N++)P[N]=1/0,P[N+3]=-1/0,L[N]=1/0,L[N+3]=-1/0,O[N]=1/0,O[N+3]=-1/0;expandByTriangleBounds(D,i,O)}y.sort(binsSort);let S=o;for(let D=0;D<S;D++){const k=y[D];for(;D+1<S&&y[D+1].candidate===k.candidate;)y.splice(D+1,1),S--}for(let D=f;D<m;D+=6){const k=i[D+2*h];for(let O=0;O<S;O++){const L=y[O];k>=L.candidate?expandByTriangleBounds(D,i,L.rightCacheBounds):(expandByTriangleBounds(D,i,L.leftCacheBounds),L.count++)}}for(let D=0;D<S;D++){const k=y[D],O=k.count,L=o-k.count,P=k.leftCacheBounds,N=k.rightCacheBounds;let z=0;O!==0&&(z=computeSurfaceArea(P)/d);let K=0;L!==0&&(K=computeSurfaceArea(N)/d);const Z=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(z*O+K*L);Z<u&&(a=h,u=Z,c=k.candidate)}}else{for(let S=0;S<BIN_COUNT;S++){const D=sahBins[S];D.count=0,D.candidate=_+w+S*w;const k=D.bounds;for(let O=0;O<3;O++)k[O]=1/0,k[O+3]=-1/0}for(let S=f;S<m;S+=6){let O=~~((i[S+2*h]-_)/w);O>=BIN_COUNT&&(O=BIN_COUNT-1);const L=sahBins[O];L.count++,expandByTriangleBounds(S,i,L.bounds)}const y=sahBins[BIN_COUNT-1];copyBounds(y.bounds,y.rightCacheBounds);for(let S=BIN_COUNT-2;S>=0;S--){const D=sahBins[S],k=sahBins[S+1];unionBounds(D.bounds,k.rightCacheBounds,D.rightCacheBounds)}let M=0;for(let S=0;S<BIN_COUNT-1;S++){const D=sahBins[S],k=D.count,O=D.bounds,P=sahBins[S+1].rightCacheBounds;k!==0&&(M===0?copyBounds(O,leftBounds):unionBounds(O,leftBounds,leftBounds)),M+=k;let N=0,z=0;M!==0&&(N=computeSurfaceArea(leftBounds)/d);const K=o-M;K!==0&&(z=computeSurfaceArea(P)/d);const Z=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(N*M+z*K);Z<u&&(a=h,u=Z,c=D.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${l} used.`);return{axis:a,pos:c}}function getAverage(s,e,i,r){let o=0;for(let l=e,a=e+i;l<a;l++)o+=s[l*6+r*2];return o/i}function computeTriangleBounds(s,e){const i=s.attributes.position,r=s.index.array,o=r.length/3,l=new Float32Array(o*6),a=i.normalized,c=i.array,d=i.offset||0;let u=3;i.isInterleavedBufferAttribute&&(u=i.data.stride);const f=["getX","getY","getZ"];for(let m=0;m<o;m++){const h=m*3,_=m*6;let b,v,w;a?(b=r[h+0],v=r[h+1],w=r[h+2]):(b=r[h+0]*u+d,v=r[h+1]*u+d,w=r[h+2]*u+d);for(let y=0;y<3;y++){let M,S,D;a?(M=i[f[y]](b),S=i[f[y]](v),D=i[f[y]](w)):(M=c[b+y],S=c[v+y],D=c[w+y]);let k=M;S<k&&(k=S),D<k&&(k=D);let O=M;S>O&&(O=S),D>O&&(O=D);const L=(O-k)/2,P=y*2;l[_+P+0]=k+L,l[_+P+1]=L+(Math.abs(k)+L)*FLOAT32_EPSILON,k<e[y]&&(e[y]=k),O>e[y+3]&&(e[y+3]=O)}}return l}function buildTree(s,e){function i(y){h&&h(y/_)}function r(y,M,S,D=null,k=0){if(!b&&k>=d&&(b=!0,u&&(console.warn(`MeshBVH: Max depth of ${d} reached when generating BVH. Consider increasing maxDepth.`),console.warn(s))),S<=f||k>=d)return i(M+S),y.offset=M,y.count=S,y;const O=getOptimalSplit(y.boundingData,D,a,M,S,m);if(O.axis===-1)return i(M+S),y.offset=M,y.count=S,y;const L=partition(c,a,M,S,O);if(L===M||L===M+S)i(M+S),y.offset=M,y.count=S;else{y.splitAxis=O.axis;const P=new MeshBVHNode,N=M,z=L-M;y.left=P,P.boundingData=new Float32Array(6),getBounds(a,N,z,P.boundingData,l),r(P,N,z,l,k+1);const K=new MeshBVHNode,Z=L,V=S-z;y.right=K,K.boundingData=new Float32Array(6),getBounds(a,Z,V,K.boundingData,l),r(K,Z,V,l,k+1)}return y}ensureIndex(s,e);const o=new Float32Array(6),l=new Float32Array(6),a=computeTriangleBounds(s,o),c=s.index.array,d=e.maxDepth,u=e.verbose,f=e.maxLeafTris,m=e.strategy,h=e.onProgress,_=s.index.count/3;let b=!1;const v=[],w=getRootIndexRanges(s);if(w.length===1){const y=w[0],M=new MeshBVHNode;M.boundingData=o,getCentroidBounds(a,y.offset,y.count,l),r(M,y.offset,y.count,l),v.push(M)}else for(let y of w){const M=new MeshBVHNode;M.boundingData=new Float32Array(6),getBounds(a,y.offset,y.count,M.boundingData,l),r(M,y.offset,y.count,l),v.push(M)}return v}function buildPackedTree(s,e){const i=buildTree(s,e);let r,o,l;const a=[],c=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let f=0;f<i.length;f++){const m=i[f];let h=d(m);const _=new c(BYTES_PER_NODE*h);r=new Float32Array(_),o=new Uint32Array(_),l=new Uint16Array(_),u(0,m),a.push(_)}return a;function d(f){return f.count?1:1+d(f.left)+d(f.right)}function u(f,m){const h=f/4,_=f/2,b=!!m.count,v=m.boundingData;for(let w=0;w<6;w++)r[h+w]=v[w];if(b){const w=m.offset,y=m.count;return o[h+6]=w,l[_+14]=y,l[_+15]=IS_LEAFNODE_FLAG,f+BYTES_PER_NODE}else{const w=m.left,y=m.right,M=m.splitAxis;let S;if(S=u(f+BYTES_PER_NODE,w),S/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return o[h+6]=S/4,S=u(S,y),o[h+7]=M,S}}}class SeparatingAxisBounds{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let r=1/0,o=-1/0;for(let l=0,a=e.length;l<a;l++){const d=e[l][i];r=d<r?d:r,o=d>o?d:o}this.min=r,this.max=o}setFromPoints(e,i){let r=1/0,o=-1/0;for(let l=0,a=i.length;l<a;l++){const c=i[l],d=e.dot(c);r=d<r?d:r,o=d>o?d:o}this.min=r,this.max=o}isSeparated(e){return this.min>e.max||e.min>this.max}}SeparatingAxisBounds.prototype.setFromBox=function(){const s=new Vector3;return function(i,r){const o=r.min,l=r.max;let a=1/0,c=-1/0;for(let d=0;d<=1;d++)for(let u=0;u<=1;u++)for(let f=0;f<=1;f++){s.x=o.x*d+l.x*(1-d),s.y=o.y*u+l.y*(1-u),s.z=o.z*f+l.z*(1-f);const m=i.dot(s);a=Math.min(m,a),c=Math.max(m,c)}this.min=a,this.max=c}}();const closestPointLineToLine=function(){const s=new Vector3,e=new Vector3,i=new Vector3;return function(o,l,a){const c=o.start,d=s,u=l.start,f=e;i.subVectors(c,u),s.subVectors(o.end,o.start),e.subVectors(l.end,l.start);const m=i.dot(f),h=f.dot(d),_=f.dot(f),b=i.dot(d),w=d.dot(d)*_-h*h;let y,M;w!==0?y=(m*h-b*_)/w:y=0,M=(m+y*h)/_,a.x=y,a.y=M}}(),closestPointsSegmentToSegment=function(){const s=new Vector2,e=new Vector3,i=new Vector3;return function(o,l,a,c){closestPointLineToLine(o,l,s);let d=s.x,u=s.y;if(d>=0&&d<=1&&u>=0&&u<=1){o.at(d,a),l.at(u,c);return}else if(d>=0&&d<=1){u<0?l.at(0,c):l.at(1,c),o.closestPointToPoint(c,!0,a);return}else if(u>=0&&u<=1){d<0?o.at(0,a):o.at(1,a),l.closestPointToPoint(a,!0,c);return}else{let f;d<0?f=o.start:f=o.end;let m;u<0?m=l.start:m=l.end;const h=e,_=i;if(o.closestPointToPoint(m,!0,e),l.closestPointToPoint(f,!0,i),h.distanceToSquared(m)<=_.distanceToSquared(f)){a.copy(h),c.copy(m);return}else{a.copy(f),c.copy(_);return}}}}(),sphereIntersectTriangle=function(){const s=new Vector3,e=new Vector3,i=new Plane,r=new Line3;return function(l,a){const{radius:c,center:d}=l,{a:u,b:f,c:m}=a;if(r.start=u,r.end=f,r.closestPointToPoint(d,!0,s).distanceTo(d)<=c||(r.start=u,r.end=m,r.closestPointToPoint(d,!0,s).distanceTo(d)<=c)||(r.start=f,r.end=m,r.closestPointToPoint(d,!0,s).distanceTo(d)<=c))return!0;const v=a.getPlane(i);if(Math.abs(v.distanceToPoint(d))<=c){const y=v.projectPoint(d,e);if(a.containsPoint(y))return!0}return!1}}(),DIST_EPSILON=1e-15;function isNearZero(s){return Math.abs(s)<DIST_EPSILON}class ExtendedTriangle extends Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new Vector3),this.satBounds=new Array(4).fill().map(()=>new SeparatingAxisBounds),this.points=[this.a,this.b,this.c],this.sphere=new Sphere,this.plane=new Plane,this.needsUpdate=!0}intersectsSphere(e){return sphereIntersectTriangle(e,this)}update(){const e=this.a,i=this.b,r=this.c,o=this.points,l=this.satAxes,a=this.satBounds,c=l[0],d=a[0];this.getNormal(c),d.setFromPoints(c,o);const u=l[1],f=a[1];u.subVectors(e,i),f.setFromPoints(u,o);const m=l[2],h=a[2];m.subVectors(i,r),h.setFromPoints(m,o);const _=l[3],b=a[3];_.subVectors(r,e),b.setFromPoints(_,o),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(c,e),this.needsUpdate=!1}}ExtendedTriangle.prototype.closestPointToSegment=function(){const s=new Vector3,e=new Vector3,i=new Line3;return function(o,l=null,a=null){const{start:c,end:d}=o,u=this.points;let f,m=1/0;for(let h=0;h<3;h++){const _=(h+1)%3;i.start.copy(u[h]),i.end.copy(u[_]),closestPointsSegmentToSegment(i,o,s,e),f=s.distanceToSquared(e),f<m&&(m=f,l&&l.copy(s),a&&a.copy(e))}return this.closestPointToPoint(c,s),f=c.distanceToSquared(s),f<m&&(m=f,l&&l.copy(s),a&&a.copy(c)),this.closestPointToPoint(d,s),f=d.distanceToSquared(s),f<m&&(m=f,l&&l.copy(s),a&&a.copy(d)),Math.sqrt(m)}}();ExtendedTriangle.prototype.intersectsTriangle=function(){const s=new ExtendedTriangle,e=new Array(3),i=new Array(3),r=new SeparatingAxisBounds,o=new SeparatingAxisBounds,l=new Vector3,a=new Vector3,c=new Vector3,d=new Vector3,u=new Line3,f=new Line3,m=new Line3;return function(_,b=null,v=!1){this.needsUpdate&&this.update(),_.isExtendedTriangle?_.needsUpdate&&_.update():(s.copy(_),s.update(),_=s);const w=this.plane,y=_.plane;if(Math.abs(w.normal.dot(y.normal))>1-1e-10){const M=this.satBounds,S=this.satAxes;i[0]=_.a,i[1]=_.b,i[2]=_.c;for(let O=0;O<4;O++){const L=M[O],P=S[O];if(r.setFromPoints(P,i),L.isSeparated(r))return!1}const D=_.satBounds,k=_.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let O=0;O<4;O++){const L=D[O],P=k[O];if(r.setFromPoints(P,e),L.isSeparated(r))return!1}for(let O=0;O<4;O++){const L=S[O];for(let P=0;P<4;P++){const N=k[P];if(l.crossVectors(L,N),r.setFromPoints(l,e),o.setFromPoints(l,i),r.isSeparated(o))return!1}}return b&&(v||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),b.start.set(0,0,0),b.end.set(0,0,0)),!0}else{const M=this.points;let S=!1,D=0;for(let H=0;H<3;H++){const Y=M[H],q=M[(H+1)%3];u.start.copy(Y),u.end.copy(q),u.delta(a);const J=S?f.start:f.end,W=isNearZero(y.distanceToPoint(Y));if(isNearZero(y.normal.dot(a))&&W){f.copy(u),D=2;break}if((y.intersectLine(u,J)||W)&&!isNearZero(J.distanceTo(q))){if(D++,S)break;S=!0}}if(D===1&&_.containsPoint(f.end))return b&&(b.start.copy(f.end),b.end.copy(f.end)),!0;if(D!==2)return!1;const k=_.points;let O=!1,L=0;for(let H=0;H<3;H++){const Y=k[H],q=k[(H+1)%3];u.start.copy(Y),u.end.copy(q),u.delta(c);const J=O?m.start:m.end,W=isNearZero(w.distanceToPoint(Y));if(isNearZero(w.normal.dot(c))&&W){m.copy(u),L=2;break}if((w.intersectLine(u,J)||W)&&!isNearZero(J.distanceTo(q))){if(L++,O)break;O=!0}}if(L===1&&this.containsPoint(m.end))return b&&(b.start.copy(m.end),b.end.copy(m.end)),!0;if(L!==2)return!1;if(f.delta(a),m.delta(c),a.dot(c)<0){let H=m.start;m.start=m.end,m.end=H}const P=f.start.dot(a),N=f.end.dot(a),z=m.start.dot(a),K=m.end.dot(a),Z=N<z,V=P<K;return P!==K&&z!==N&&Z===V?!1:(b&&(d.subVectors(f.start,m.start),d.dot(a)>0?b.start.copy(f.start):b.start.copy(m.start),d.subVectors(f.end,m.end),d.dot(a)<0?b.end.copy(f.end):b.end.copy(m.end)),!0)}}}();ExtendedTriangle.prototype.distanceToPoint=function(){const s=new Vector3;return function(i){return this.closestPointToPoint(i,s),i.distanceTo(s)}}();ExtendedTriangle.prototype.distanceToTriangle=function(){const s=new Vector3,e=new Vector3,i=["a","b","c"],r=new Line3,o=new Line3;return function(a,c=null,d=null){const u=c||d?r:null;if(this.intersectsTriangle(a,u))return(c||d)&&(c&&u.getCenter(c),d&&u.getCenter(d)),0;let f=1/0;for(let m=0;m<3;m++){let h;const _=i[m],b=a[_];this.closestPointToPoint(b,s),h=b.distanceToSquared(s),h<f&&(f=h,c&&c.copy(s),d&&d.copy(b));const v=this[_];a.closestPointToPoint(v,s),h=v.distanceToSquared(s),h<f&&(f=h,c&&c.copy(v),d&&d.copy(s))}for(let m=0;m<3;m++){const h=i[m],_=i[(m+1)%3];r.set(this[h],this[_]);for(let b=0;b<3;b++){const v=i[b],w=i[(b+1)%3];o.set(a[v],a[w]),closestPointsSegmentToSegment(r,o,s,e);const y=s.distanceToSquared(e);y<f&&(f=y,c&&c.copy(s),d&&d.copy(e))}}return Math.sqrt(f)}}();class OrientedBox{constructor(e,i,r){this.isOrientedBox=!0,this.min=new Vector3,this.max=new Vector3,this.matrix=new Matrix4,this.invMatrix=new Matrix4,this.points=new Array(8).fill().map(()=>new Vector3),this.satAxes=new Array(3).fill().map(()=>new Vector3),this.satBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.alignedSatBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),r&&this.matrix.copy(r)}set(e,i,r){this.min.copy(e),this.max.copy(i),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}OrientedBox.prototype.update=function(){return function(){const e=this.matrix,i=this.min,r=this.max,o=this.points;for(let u=0;u<=1;u++)for(let f=0;f<=1;f++)for(let m=0;m<=1;m++){const h=1*u|2*f|4*m,_=o[h];_.x=u?r.x:i.x,_.y=f?r.y:i.y,_.z=m?r.z:i.z,_.applyMatrix4(e)}const l=this.satBounds,a=this.satAxes,c=o[0];for(let u=0;u<3;u++){const f=a[u],m=l[u],h=1<<u,_=o[h];f.subVectors(c,_),m.setFromPoints(f,o)}const d=this.alignedSatBounds;d[0].setFromPointsField(o,"x"),d[1].setFromPointsField(o,"y"),d[2].setFromPointsField(o,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();OrientedBox.prototype.intersectsBox=function(){const s=new SeparatingAxisBounds;return function(i){this.needsUpdate&&this.update();const r=i.min,o=i.max,l=this.satBounds,a=this.satAxes,c=this.alignedSatBounds;if(s.min=r.x,s.max=o.x,c[0].isSeparated(s)||(s.min=r.y,s.max=o.y,c[1].isSeparated(s))||(s.min=r.z,s.max=o.z,c[2].isSeparated(s)))return!1;for(let d=0;d<3;d++){const u=a[d],f=l[d];if(s.setFromBox(u,i),f.isSeparated(s))return!1}return!0}}();OrientedBox.prototype.intersectsTriangle=function(){const s=new ExtendedTriangle,e=new Array(3),i=new SeparatingAxisBounds,r=new SeparatingAxisBounds,o=new Vector3;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(s.copy(a),s.update(),a=s);const c=this.satBounds,d=this.satAxes;e[0]=a.a,e[1]=a.b,e[2]=a.c;for(let h=0;h<3;h++){const _=c[h],b=d[h];if(i.setFromPoints(b,e),_.isSeparated(i))return!1}const u=a.satBounds,f=a.satAxes,m=this.points;for(let h=0;h<3;h++){const _=u[h],b=f[h];if(i.setFromPoints(b,m),_.isSeparated(i))return!1}for(let h=0;h<3;h++){const _=d[h];for(let b=0;b<4;b++){const v=f[b];if(o.crossVectors(_,v),i.setFromPoints(o,e),r.setFromPoints(o,m),i.isSeparated(r))return!1}}return!0}}();OrientedBox.prototype.closestPointToPoint=function(){return function(e,i){return this.needsUpdate&&this.update(),i.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),i}}();OrientedBox.prototype.distanceToPoint=function(){const s=new Vector3;return function(i){return this.closestPointToPoint(i,s),i.distanceTo(s)}}();OrientedBox.prototype.distanceToBox=function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new Line3),i=new Array(12).fill().map(()=>new Line3),r=new Vector3,o=new Vector3;return function(a,c=0,d=null,u=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(d||u)&&(a.getCenter(o),this.closestPointToPoint(o,r),a.closestPointToPoint(r,o),d&&d.copy(r),u&&u.copy(o)),0;const f=c*c,m=a.min,h=a.max,_=this.points;let b=1/0;for(let w=0;w<8;w++){const y=_[w];o.copy(y).clamp(m,h);const M=y.distanceToSquared(o);if(M<b&&(b=M,d&&d.copy(y),u&&u.copy(o),M<f))return Math.sqrt(M)}let v=0;for(let w=0;w<3;w++)for(let y=0;y<=1;y++)for(let M=0;M<=1;M++){const S=(w+1)%3,D=(w+2)%3,k=y<<S|M<<D,O=1<<w|y<<S|M<<D,L=_[k],P=_[O];e[v].set(L,P);const z=s[w],K=s[S],Z=s[D],V=i[v],H=V.start,Y=V.end;H[z]=m[z],H[K]=y?m[K]:h[K],H[Z]=M?m[Z]:h[K],Y[z]=h[z],Y[K]=y?m[K]:h[K],Y[Z]=M?m[Z]:h[K],v++}for(let w=0;w<=1;w++)for(let y=0;y<=1;y++)for(let M=0;M<=1;M++){o.x=w?h.x:m.x,o.y=y?h.y:m.y,o.z=M?h.z:m.z,this.closestPointToPoint(o,r);const S=o.distanceToSquared(r);if(S<b&&(b=S,d&&d.copy(r),u&&u.copy(o),S<f))return Math.sqrt(S)}for(let w=0;w<12;w++){const y=e[w];for(let M=0;M<12;M++){const S=i[M];closestPointsSegmentToSegment(y,S,r,o);const D=r.distanceToSquared(o);if(D<b&&(b=D,d&&d.copy(r),u&&u.copy(o),D<f))return Math.sqrt(D)}}return Math.sqrt(b)}}();const _vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3;function checkIntersection(s,e,i,r,o,l){let a;return l===BackSide?a=s.intersectTriangle(r,i,e,!0,o):a=s.intersectTriangle(e,i,r,l!==DoubleSide,o),a===null?null:{distance:s.origin.distanceTo(o),point:o.clone()}}function checkBufferGeometryIntersection(s,e,i,r,o,l,a,c,d){_vA.fromBufferAttribute(e,l),_vB.fromBufferAttribute(e,a),_vC.fromBufferAttribute(e,c);const u=checkIntersection(s,_vA,_vB,_vC,_intersectionPoint,d);if(u){r&&(_uvA.fromBufferAttribute(r,l),_uvB.fromBufferAttribute(r,a),_uvC.fromBufferAttribute(r,c),u.uv=Triangle.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),o&&(_uvA.fromBufferAttribute(o,l),_uvB.fromBufferAttribute(o,a),_uvC.fromBufferAttribute(o,c),u.uv1=Triangle.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),i&&(_normalA.fromBufferAttribute(i,l),_normalB.fromBufferAttribute(i,a),_normalC.fromBufferAttribute(i,c),u.normal=Triangle.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_normalA,_normalB,_normalC,new Vector3),u.normal.dot(s.direction)>0&&u.normal.multiplyScalar(-1));const f={a:l,b:a,c,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA,_vB,_vC,f.normal),u.face=f,u.faceIndex=l}return u}function intersectTri(s,e,i,r,o){const l=r*3,a=s.index.getX(l),c=s.index.getX(l+1),d=s.index.getX(l+2),{position:u,normal:f,uv:m,uv1:h}=s.attributes,_=checkBufferGeometryIntersection(i,u,f,m,h,a,c,d,e);return _?(_.faceIndex=r,o&&o.push(_),_):null}function intersectTris(s,e,i,r,o,l){for(let a=r,c=r+o;a<c;a++)intersectTri(s,e,i,a,l)}function intersectClosestTri(s,e,i,r,o){let l=1/0,a=null;for(let c=r,d=r+o;c<d;c++){const u=intersectTri(s,e,i,c);u&&u.distance<l&&(a=u,l=u.distance)}return a}function convertRaycastIntersect(s,e,i){return s===null||(s.point.applyMatrix4(e.matrixWorld),s.distance=s.point.distanceTo(i.ray.origin),s.object=e,s.distance<i.near||s.distance>i.far)?null:s}function setTriangle(s,e,i,r){const o=s.a,l=s.b,a=s.c;let c=e,d=e+1,u=e+2;i&&(c=i.getX(e),d=i.getX(e+1),u=i.getX(e+2)),o.x=r.getX(c),o.y=r.getY(c),o.z=r.getZ(c),l.x=r.getX(d),l.y=r.getY(d),l.z=r.getZ(d),a.x=r.getX(u),a.y=r.getY(u),a.z=r.getZ(u)}function iterateOverTriangles(s,e,i,r,o,l,a){const c=i.index,d=i.attributes.position;for(let u=s,f=e+s;u<f;u++)if(setTriangle(a,u*3,c,d),a.needsUpdate=!0,r(a,u,o,l))return!0;return!1}class PrimitivePool{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function IS_LEAF(s,e){return e[s+15]===65535}function OFFSET(s,e){return e[s+6]}function COUNT(s,e){return e[s+14]}function LEFT_NODE(s){return s+8}function RIGHT_NODE(s,e){return e[s+6]}function SPLIT_AXIS(s,e){return e[s+7]}function BOUNDING_DATA_INDEX(s){return s}const boundingBox$1=new Box3,boxIntersection=new Vector3,xyzFields=["x","y","z"];function raycast(s,e,i,r,o){let l=s*2,a=_float32Array,c=_uint16Array,d=_uint32Array;if(IS_LEAF(l,c)){const f=OFFSET(s,d),m=COUNT(l,c);intersectTris(e,i,r,f,m,o)}else{const f=LEFT_NODE(s);intersectRay(f,a,r,boxIntersection)&&raycast(f,e,i,r,o);const m=RIGHT_NODE(s,d);intersectRay(m,a,r,boxIntersection)&&raycast(m,e,i,r,o)}}function raycastFirst(s,e,i,r){let o=s*2,l=_float32Array,a=_uint16Array,c=_uint32Array;if(IS_LEAF(o,a)){const u=OFFSET(s,c),f=COUNT(o,a);return intersectClosestTri(e,i,r,u,f)}else{const u=SPLIT_AXIS(s,c),f=xyzFields[u],h=r.direction[f]>=0;let _,b;h?(_=LEFT_NODE(s),b=RIGHT_NODE(s,c)):(_=RIGHT_NODE(s,c),b=LEFT_NODE(s));const w=intersectRay(_,l,r,boxIntersection)?raycastFirst(_,e,i,r):null;if(w){const S=w.point[f];if(h?S<=l[b+u]:S>=l[b+u+3])return w}const M=intersectRay(b,l,r,boxIntersection)?raycastFirst(b,e,i,r):null;return w&&M?w.distance<=M.distance?w:M:w||M||null}}const shapecast=function(){let s,e;const i=[],r=new PrimitivePool(()=>new Box3);return function(...a){s=r.getPrimitive(),e=r.getPrimitive(),i.push(s,e);const c=o(...a);r.releasePrimitive(s),r.releasePrimitive(e),i.pop(),i.pop();const d=i.length;return d>0&&(e=i[d-1],s=i[d-2]),c};function o(l,a,c,d,u=null,f=0,m=0){function h(S){let D=S*2,k=_uint16Array,O=_uint32Array;for(;!IS_LEAF(D,k);)S=LEFT_NODE(S),D=S*2;return OFFSET(S,O)}function _(S){let D=S*2,k=_uint16Array,O=_uint32Array;for(;!IS_LEAF(D,k);)S=RIGHT_NODE(S,O),D=S*2;return OFFSET(S,O)+COUNT(D,k)}let b=l*2,v=_float32Array,w=_uint16Array,y=_uint32Array;if(IS_LEAF(b,w)){const S=OFFSET(l,y),D=COUNT(b,w);return arrayToBox(l,v,s),d(S,D,!1,m,f+l,s)}else{const S=LEFT_NODE(l),D=RIGHT_NODE(l,y);let k=S,O=D,L,P,N,z;if(u&&(N=s,z=e,arrayToBox(k,v,N),arrayToBox(O,v,z),L=u(N),P=u(z),P<L)){k=D,O=S;const J=L;L=P,P=J,N=z}N||(N=s,arrayToBox(k,v,N));const K=IS_LEAF(k*2,w),Z=c(N,K,L,m+1,f+k);let V;if(Z===CONTAINED){const J=h(k),te=_(k)-J;V=d(J,te,!0,m+1,f+k,N)}else V=Z&&o(k,a,c,d,u,f,m+1);if(V)return!0;z=e,arrayToBox(O,v,z);const H=IS_LEAF(O*2,w),Y=c(z,H,P,m+1,f+O);let q;if(Y===CONTAINED){const J=h(O),te=_(O)-J;q=d(J,te,!0,m+1,f+O,z)}else q=Y&&o(O,a,c,d,u,f,m+1);return!!q}}}(),intersectsGeometry=function(){const s=new ExtendedTriangle,e=new ExtendedTriangle,i=new Matrix4,r=new OrientedBox,o=new OrientedBox;return function l(a,c,d,u,f=null){let m=a*2,h=_float32Array,_=_uint16Array,b=_uint32Array;if(f===null&&(d.boundingBox||d.computeBoundingBox(),r.set(d.boundingBox.min,d.boundingBox.max,u),f=r),IS_LEAF(m,_)){const w=c,y=w.index,M=w.attributes.position,S=d.index,D=d.attributes.position,k=OFFSET(a,b),O=COUNT(m,_);if(i.copy(u).invert(),d.boundsTree)return arrayToBox(a,h,o),o.matrix.copy(i),o.needsUpdate=!0,d.boundsTree.shapecast({intersectsBounds:P=>o.intersectsBox(P),intersectsTriangle:P=>{P.a.applyMatrix4(u),P.b.applyMatrix4(u),P.c.applyMatrix4(u),P.needsUpdate=!0;for(let N=k*3,z=(O+k)*3;N<z;N+=3)if(setTriangle(e,N,y,M),e.needsUpdate=!0,P.intersectsTriangle(e))return!0;return!1}});for(let L=k*3,P=O+k*3;L<P;L+=3){setTriangle(s,L,y,M),s.a.applyMatrix4(i),s.b.applyMatrix4(i),s.c.applyMatrix4(i),s.needsUpdate=!0;for(let N=0,z=S.count;N<z;N+=3)if(setTriangle(e,N,S,D),e.needsUpdate=!0,s.intersectsTriangle(e))return!0}}else{const w=a+8,y=b[a+6];return arrayToBox(w,h,boundingBox$1),!!(f.intersectsBox(boundingBox$1)&&l(w,c,d,u,f)||(arrayToBox(y,h,boundingBox$1),f.intersectsBox(boundingBox$1)&&l(y,c,d,u,f)))}}}();function intersectRay(s,e,i,r){return arrayToBox(s,e,boundingBox$1),i.intersectBox(boundingBox$1,r)}const bufferStack=[];let _prevBuffer,_float32Array,_uint16Array,_uint32Array;function setBuffer(s){_prevBuffer&&bufferStack.push(_prevBuffer),_prevBuffer=s,_float32Array=new Float32Array(s),_uint16Array=new Uint16Array(s),_uint32Array=new Uint32Array(s)}function clearBuffer(){_prevBuffer=null,_float32Array=null,_uint16Array=null,_uint32Array=null,bufferStack.length&&setBuffer(bufferStack.pop())}const SKIP_GENERATION=Symbol("skip tree generation"),aabb=new Box3,aabb2=new Box3,tempMatrix=new Matrix4,obb=new OrientedBox,obb2=new OrientedBox,temp=new Vector3,temp1=new Vector3,temp2=new Vector3,temp3=new Vector3,temp4=new Vector3,tempBox=new Box3,trianglePool=new PrimitivePool(()=>new ExtendedTriangle);class MeshBVH{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),MeshBVH.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});i={cloneBuffers:!0,...i};const r=e.geometry,o=e._roots,l=r.getIndex();let a;return i.cloneBuffers?a={roots:o.map(c=>c.slice()),index:l.array.slice()}:a={roots:o,index:l.array},a}static deserialize(e,i,r={}){if(typeof r=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),MeshBVH.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});r={setIndex:!0,...r};const{index:o,roots:l}=e,a=new MeshBVH(i,{...r,[SKIP_GENERATION]:!0});if(a._roots=l,r.setIndex){const c=i.getIndex();if(c===null){const d=new BufferAttribute(e.index,1,!1);i.setIndex(d)}else c.array!==o&&(c.array.set(o),c.needsUpdate=!0)}return a}constructor(e,i={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(i=Object.assign({strategy:CENTER,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[SKIP_GENERATION]:!1},i),i.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[SKIP_GENERATION]||(this._roots=buildPackedTree(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Box3))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=this.geometry,r=i.index.array,o=i.attributes.position;let l,a,c,d,u=0;const f=this._roots;for(let h=0,_=f.length;h<_;h++)l=f[h],a=new Uint32Array(l),c=new Uint16Array(l),d=new Float32Array(l),m(0,u),u+=l.byteLength;function m(h,_,b=!1){const v=h*2;if(c[v+15]===IS_LEAFNODE_FLAG){const y=a[h+6],M=c[v+14];let S=1/0,D=1/0,k=1/0,O=-1/0,L=-1/0,P=-1/0;for(let N=3*y,z=3*(y+M);N<z;N++){const K=r[N],Z=o.getX(K),V=o.getY(K),H=o.getZ(K);Z<S&&(S=Z),Z>O&&(O=Z),V<D&&(D=V),V>L&&(L=V),H<k&&(k=H),H>P&&(P=H)}return d[h+0]!==S||d[h+1]!==D||d[h+2]!==k||d[h+3]!==O||d[h+4]!==L||d[h+5]!==P?(d[h+0]=S,d[h+1]=D,d[h+2]=k,d[h+3]=O,d[h+4]=L,d[h+5]=P,!0):!1}else{const y=h+8,M=a[h+6],S=y+_,D=M+_;let k=b,O=!1,L=!1;e?k||(O=e.has(S),L=e.has(D),k=!O&&!L):(O=!0,L=!0);const P=k||O,N=k||L;let z=!1;P&&(z=m(y,_,k));let K=!1;N&&(K=m(M,_,k));const Z=z||K;if(Z)for(let V=0;V<3;V++){const H=y+V,Y=M+V,q=d[H],J=d[H+3],W=d[Y],te=d[Y+3];d[h+V]=q<W?q:W,d[h+V+3]=J>te?J:te}return Z}}}traverse(e,i=0){const r=this._roots[i],o=new Uint32Array(r),l=new Uint16Array(r);a(0);function a(c,d=0){const u=c*2,f=l[u+15]===IS_LEAFNODE_FLAG;if(f){const m=o[c+6],h=l[u+14];e(d,f,new Float32Array(r,c*4,6),m,h)}else{const m=c+BYTES_PER_NODE/4,h=o[c+6],_=o[c+7];e(d,f,new Float32Array(r,c*4,6),_)||(a(m,d+1),a(h,d+1))}}}raycast(e,i=FrontSide){const r=this._roots,o=this.geometry,l=[],a=i.isMaterial,c=Array.isArray(i),d=o.groups,u=a?i.side:i;for(let f=0,m=r.length;f<m;f++){const h=c?i[d[f].materialIndex].side:u,_=l.length;if(setBuffer(r[f]),raycast(0,o,h,e,l),clearBuffer(),c){const b=d[f].materialIndex;for(let v=_,w=l.length;v<w;v++)l[v].face.materialIndex=b}}return l}raycastFirst(e,i=FrontSide){const r=this._roots,o=this.geometry,l=i.isMaterial,a=Array.isArray(i);let c=null;const d=o.groups,u=l?i.side:i;for(let f=0,m=r.length;f<m;f++){const h=a?i[d[f].materialIndex].side:u;setBuffer(r[f]);const _=raycastFirst(0,o,h,e);clearBuffer(),_!=null&&(c==null||_.distance<c.distance)&&(c=_,a&&(_.face.materialIndex=d[f].materialIndex))}return c}intersectsGeometry(e,i){const r=this.geometry;let o=!1;for(const l of this._roots)if(setBuffer(l),o=intersectsGeometry(0,r,e,i),clearBuffer(),o)break;return o}shapecast(e,i,r){const o=this.geometry;if(e instanceof Function){if(i){const h=i;i=(_,b,v,w)=>{const y=b*3;return h(_,y,y+1,y+2,v,w)}}e={boundsTraverseOrder:r,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const l=trianglePool.getPrimitive();let{boundsTraverseOrder:a,intersectsBounds:c,intersectsRange:d,intersectsTriangle:u}=e;if(d&&u){const h=d;d=(_,b,v,w,y)=>h(_,b,v,w,y)?!0:iterateOverTriangles(_,b,o,u,v,w,l)}else d||(u?d=(h,_,b,v)=>iterateOverTriangles(h,_,o,u,b,v,l):d=(h,_,b)=>b);let f=!1,m=0;for(const h of this._roots){if(setBuffer(h),f=shapecast(0,o,c,d,a,m),clearBuffer(),f)break;m+=h.byteLength}return trianglePool.releasePrimitive(l),f}bvhcast(e,i,r){let{intersectsRanges:o,intersectsTriangles:l}=r;const a=this.geometry.index,c=this.geometry.attributes.position,d=e.geometry.index,u=e.geometry.attributes.position;tempMatrix.copy(i).invert();const f=trianglePool.getPrimitive(),m=trianglePool.getPrimitive();if(l){let _=function(b,v,w,y,M,S,D,k){for(let O=w,L=w+y;O<L;O++){setTriangle(m,O*3,d,u),m.a.applyMatrix4(i),m.b.applyMatrix4(i),m.c.applyMatrix4(i),m.needsUpdate=!0;for(let P=b,N=b+v;P<N;P++)if(setTriangle(f,P*3,a,c),f.needsUpdate=!0,l(f,m,P,O,M,S,D,k))return!0}return!1};if(o){const b=o;o=function(v,w,y,M,S,D,k,O){return b(v,w,y,M,S,D,k,O)?!0:_(v,w,y,M,S,D,k,O)}}else o=_}e.getBoundingBox(aabb2),aabb2.applyMatrix4(i);const h=this.shapecast({intersectsBounds:_=>aabb2.intersectsBox(_),intersectsRange:(_,b,v,w,y,M)=>(aabb.copy(M),aabb.applyMatrix4(tempMatrix),e.shapecast({intersectsBounds:S=>aabb.intersectsBox(S),intersectsRange:(S,D,k,O,L)=>o(_,b,S,D,w,y,O,L)}))});return trianglePool.releasePrimitive(f),trianglePool.releasePrimitive(m),h}intersectsBox(e,i){return obb.set(e.min,e.max,i),obb.needsUpdate=!0,this.shapecast({intersectsBounds:r=>obb.intersectsBox(r),intersectsTriangle:r=>obb.intersectsTriangle(r)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,r={},o={},l=0,a=1/0){e.boundingBox||e.computeBoundingBox(),obb.set(e.boundingBox.min,e.boundingBox.max,i),obb.needsUpdate=!0;const c=this.geometry,d=c.attributes.position,u=c.index,f=e.attributes.position,m=e.index,h=trianglePool.getPrimitive(),_=trianglePool.getPrimitive();let b=temp1,v=temp2,w=null,y=null;o&&(w=temp3,y=temp4);let M=1/0,S=null,D=null;return tempMatrix.copy(i).invert(),obb2.matrix.copy(tempMatrix),this.shapecast({boundsTraverseOrder:k=>obb.distanceToBox(k),intersectsBounds:(k,O,L)=>L<M&&L<a?(O&&(obb2.min.copy(k.min),obb2.max.copy(k.max),obb2.needsUpdate=!0),!0):!1,intersectsRange:(k,O)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:L=>obb2.distanceToBox(L),intersectsBounds:(L,P,N)=>N<M&&N<a,intersectsRange:(L,P)=>{for(let N=L*3,z=(L+P)*3;N<z;N+=3){setTriangle(_,N,m,f),_.a.applyMatrix4(i),_.b.applyMatrix4(i),_.c.applyMatrix4(i),_.needsUpdate=!0;for(let K=k*3,Z=(k+O)*3;K<Z;K+=3){setTriangle(h,K,u,d),h.needsUpdate=!0;const V=h.distanceToTriangle(_,b,w);if(V<M&&(v.copy(b),y&&y.copy(w),M=V,S=K/3,D=N/3),V<l)return!0}}}});{const L=m?m.count:f.count;for(let P=0,N=L;P<N;P+=3){setTriangle(_,P,m,f),_.a.applyMatrix4(i),_.b.applyMatrix4(i),_.c.applyMatrix4(i),_.needsUpdate=!0;for(let z=k*3,K=(k+O)*3;z<K;z+=3){setTriangle(h,z,u,d),h.needsUpdate=!0;const Z=h.distanceToTriangle(_,b,w);if(Z<M&&(v.copy(b),y&&y.copy(w),M=Z,S=z/3,D=P/3),Z<l)return!0}}}}}),trianglePool.releasePrimitive(h),trianglePool.releasePrimitive(_),M===1/0?null:(r.point?r.point.copy(v):r.point=v.clone(),r.distance=M,r.faceIndex=S,o&&(o.point?o.point.copy(y):o.point=y.clone(),o.point.applyMatrix4(tempMatrix),v.applyMatrix4(tempMatrix),o.distance=v.sub(o.point).length(),o.faceIndex=D),r)}closestPointToPoint(e,i={},r=0,o=1/0){const l=r*r,a=o*o;let c=1/0,d=null;if(this.shapecast({boundsTraverseOrder:f=>(temp.copy(e).clamp(f.min,f.max),temp.distanceToSquared(e)),intersectsBounds:(f,m,h)=>h<c&&h<a,intersectsTriangle:(f,m)=>{f.closestPointToPoint(e,temp);const h=e.distanceToSquared(temp);return h<c&&(temp1.copy(temp),c=h,d=m),h<l}}),c===1/0)return null;const u=Math.sqrt(c);return i.point?i.point.copy(temp1):i.point=temp1.clone(),i.distance=u,i.faceIndex=d,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(r=>{arrayToBox(0,new Float32Array(r),tempBox),e.union(tempBox)}),e}}const ray=new Ray,tmpInverseMatrix=new Matrix4,origMeshRaycastFunc=Mesh.prototype.raycast;function acceleratedRaycast(s,e){if(this.geometry.boundsTree){if(this.material===void 0)return;tmpInverseMatrix.copy(this.matrixWorld).invert(),ray.copy(s.ray).applyMatrix4(tmpInverseMatrix);const i=this.geometry.boundsTree;if(s.firstHitOnly===!0){const r=convertRaycastIntersect(i.raycastFirst(ray,this.material),this,s);r&&e.push(r)}else{const r=i.raycast(ray,this.material);for(let o=0,l=r.length;o<l;o++){const a=convertRaycastIntersect(r[o],this,s);a&&e.push(a)}}}else origMeshRaycastFunc.call(this,s,e)}function computeBoundsTree(s){return this.boundsTree=new MeshBVH(this,s),this.boundsTree}function disposeBoundsTree(){this.boundsTree=null}BufferGeometry.prototype.computeBoundsTree=computeBoundsTree;BufferGeometry.prototype.disposeBoundsTree=disposeBoundsTree;Mesh.prototype.raycast=acceleratedRaycast;class BokehPass extends Pass{constructor(e,i,r){super(),this.scene=e,this.camera=i;const o=r.focus!==void 0?r.focus:1,l=r.aperture!==void 0?r.aperture:.025,a=r.maxblur!==void 0?r.maxblur:.015,c=r.width||window.innerWidth||1,d=r.height||window.innerHeight||1;this.renderTargetDepth=new WebGLRenderTarget(c,d,{minFilter:NearestFilter,magFilter:NearestFilter,type:window.THREE.HalfFloatType}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new MeshDepthMaterial,this.materialDepth.depthPacking=RGBADepthPacking,this.materialDepth.blending=NoBlending,this.materialReplacer=new MaterialReplacer,BokehShader===void 0&&console.error("THREE.BokehPass relies on BokehShader");const u=BokehShader,f=UniformsUtils.clone(u.uniforms);f.tDepth.value=this.renderTargetDepth.texture,f.focus.value=o,f.aspect.value=i.aspect,f.aperture.value=l,f.maxblur.value=a,f.nearClip.value=i.near,f.farClip.value=i.far,this.materialBokeh=new ShaderMaterial({defines:Object.assign({},u.defines),uniforms:f,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}),this.uniforms=f,this.needsSwap=!0,this.fsQuad=new FullScreenQuad(this.materialBokeh),this._oldClearColor=new Color,this.autoDoF=!0,this.aperture_coef=1.03,this.maxBlur=a,this.mouse3D=new Vector2(0,0),this.mouse3D_left=new Vector2(-.5,0),this.mouse3D_right=new Vector2(.5,0),this.raycaster=new Raycaster,this.object_cache=new Set,this.skip_frame=1,this.previous_time=0,this.cache_distance=0,this.acc_distance=0,this.previous_camera_pos=new Vector3(0,0,0),this.width=c,this.height=d,this.three_points=!1}setSize(e,i){this.width=e,this.height=i,this.renderTargetDepth.setSize(e,i),this.materialBokeh.uniforms.aspect.value=e/i}render(e,i,r,o,l){this.scene.overrideMaterial=null,e.getClearColor(this._oldClearColor);const a=e.getClearAlpha(),c=e.autoClear;if(e.autoClear=!1,this.scene.overrideMaterial)e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera);else{const d=this.materialReplacer;d.replaceMaterials(this.scene,()=>{const u=new MeshDepthMaterial;return u.depthPacking=RGBADepthPacking,u.blending=NoBlending,u}),d.renderPass(this.scene,this.camera,e,this.renderTargetDepth,16777215,1),d.restoreMaterials(this.scene)}if(this.autoDoF){if(performance.now()-this.previous_time>100){this.previous_time=performance.now();let d=this.object_cache,u=!1,f=0;for(let m=0,h=this.scene.children.length;m<h;++m){let _=this.scene.children[m],b=_.getDDDProperties?.();b&&b.dof_target&&(++f,d.has(_)||(u=!0),b.dof_needsUpdate&&(u=!0,b.dof_needsUpdate=!1))}if(d.size!=f&&(u=!0),u){let m=this.target_skinned_meshes=[],h=this.target_static_meshes=[],_=this.target_all=[];d=this.object_cache=new Set;for(let b=0,v=this.scene.children.length;b<v;++b){let w=this.scene.children[b],y=w.getDDDProperties?.();y&&y.dof_target&&(window.debug&&console.log("DoF:",w.name),d.add(w),y.is_background?(h.push(w),_.push(w)):w.isSkinnedMesh?m.push(w):w.isMesh&&(h.push(w),_.push(w)))}this.integrated&&(this.integrated.geometry.dispose(),this.integrated=null),m.length>0&&(this.generator=new StaticGeometryGenerator(m),this.geometry=this.generator.generate(),this.integrated=new Mesh(this.geometry,new MeshBasicMaterial({})),this.integrated.geometry.computeBoundsTree(),_.push(this.integrated))}if(this.target_all?.length>0){this.integrated&&(this.generator.generate(this.integrated.geometry),this.integrated.geometry.boundsTree.refit());let m=0,h=1;this.raycaster.setFromCamera(this.mouse3D,this.camera);let _=this.raycaster.intersectObjects(this.target_all);if(m+=_.length>0?_[0].distance:70,this.three_points){this.raycaster.setFromCamera(this.mouse3D_left,this.camera);let b=this.raycaster.intersectObjects(this.target_all);this.raycaster.setFromCamera(this.mouse3D_right,this.camera);let v=this.raycaster.intersectObjects(this.target_all);m+=b.length>0?b[0].distance:70,m+=v.length>0?v[0].distance:70,h+=2}m/=h,this.cache_distance=m}}{let d=this.cache_distance,u=this.materialBokeh.uniforms.focus.value;this.previous_camera_pos.sub(this.camera.position),this.previous_camera_pos.length()>5&&(u=this.materialBokeh.uniforms.focus.value=d),this.previous_camera_pos.copy(this.camera.position);let f=.05;this.acc_distance+=(d-u)*.01,this.acc_distance*=.9,this.materialBokeh.uniforms.focus.value=u+this.acc_distance;let m=d/50;m=m>1?1:m,m=1-m;let h=2e-5+m*(4e-4-2e-5),_=this.materialBokeh.uniforms.aperture.value;this.materialBokeh.uniforms.aperture.value=(_+(h-_)*f)*this.aperture_coef,this.materialBokeh.uniforms.maxblur.value=this.maxBlur}}this.uniforms.tColor.value=r.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.scene.overrideMaterial=null,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),e.clear(),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,a),e.autoClear=c}}function TL$5(s){return window.T("tabs.graphics."+s)}function padding(){const s=document.createElement("div");return s.style.cssText="width:100%;height:5px;",s}let debug_log_deferred_renderer_pass_toggle=window.debug,toggle_semaphore=0,toggle_posts=0;async function __inner_toggle__(s){const e=DMC;if(s==null)return;s.passes=[];const i=[];for(const o in e.render_passes)i.push(e.render_passes[o]);const r=i.filter(o=>o.value);r.sort((o,l)=>o.order<l.order?-1:o.order>l.order?1:0),debug_log_deferred_renderer_pass_toggle&&console.log("=========================="),await Promise.all(r.map(o=>o.preload()));for(const o of r){if(o.initialize&&await o.initialize()&&o.update_components){for(const a of o.sub_params)a.pass=o.pass;o.update_components()}const l=o.pass;debug_log_deferred_renderer_pass_toggle&&console.log("D:",o.name?.padStart?.(12," "),l.needsSwap?1:0,l.clear?1:0,l.renderToScreen?1:0),s.addPass(o.pass)}for(const o of r)o.pass.renderToScreen=!1;r.length>0&&(r[r.length-1].pass.renderToScreen=!0),s.is_ready=!0,e.main_is_ready3=!0}async function deferred_renderer_pass_toggle(){const s=DMC;s&&s.renderer_selector?.modifier?.value=="Deferred"&&(toggle_posts++,toggle_semaphore==0&&(toggle_semaphore++,setTimeout(async()=>{toggle_posts=0;const e=s.getRenderer("Deferred");await e.init(),await __inner_toggle__(e.effect_composer),toggle_semaphore--,toggle_posts>0&&toggle_semaphore==0&&await __inner_toggle__(e.effect_composer),window.dispatchEvent(new Event("resize"))},0))),s.needsPrecompile=!0}let R=null;async function init_render_passes(){const s={};s.DEFAULT=0,s.FRONT_DEPTH=1,s.BACK_DEPTH=2,s.DEPTH_DELTA=3,s.NORMAL=4,s.ROUGHNESS=5,s.INTERSECTION_RESULTS=6,s.INTERSECTION_DISTANCE=7,s.INTERSECTION_COLOR=8,s.NO_GLOSSY=0,s.SIMPLE_GLOSSY=1,s.MULTI_GLOSSY=2,s.MIP_PYRAMID_GLOSSY=3,s.REGULAR_JITTER=0,s.BLUENOISE_JITTER=1,s.RANDOM_JITTER=2;let e=32,i=32;const r={"Remy 24.CUBE":null};let o=0;R={BaseRenderer:{name:TL$5("base_renderer"),async preload(){},async initialize(){return this.pass==null?(this.pass=new RenderPass(DMC.scene,DMC.camera),!0):!1},sub_params:[{type:"make_toggle",key:"Outline",get(){return this.pass.outline_effect},async set(a){if(this.pass){if(this.pass._outline_effect_==null&&a){const{OutlineEffect:c}=await __vitePreload(()=>import("./OutlineEffect@CWld7flV.js"),[],import.meta.url);this.OutlineEffect=c;const d=new this.OutlineEffect(DMC.base_renderer,{defaultThickness:.01,defaultColor:new Color(8947848),defaultAlpha:.8,defaultKeepAlive:!0});this.pass._outline_effect_=d}a?this.pass.outline_effect=this.pass._outline_effect_:this.pass.outline_effect=null}}}],order:o++,pass:null,value:!0,toggle:deferred_renderer_pass_toggle},TAA:{name:TL$5("taa"),async preload(){if(this.TAARenderPass==null){const{TAARenderPass:a}=await __vitePreload(()=>import("./TAARenderPass@C2E6-JSV.js"),__vite__mapDeps([8,9]),import.meta.url);this.TAARenderPass=a}},async initialize(){if(this.pass==null){const a=new this.TAARenderPass(DMC.scene,DMC.camera);return window.devicePixelRatio-1.5>.01?a.sampleLevel=1:a.sampleLevel=2,this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_toggle",key:"Outline",get(){return this.pass.outline_effect},async set(a){if(this.pass){if(this.pass._outline_effect_==null&&a){const{OutlineEffect:c}=await __vitePreload(()=>import("./OutlineEffect@CWld7flV.js"),[],import.meta.url);this.OutlineEffect=c;const d=new this.OutlineEffect(DMC.base_renderer,{defaultThickness:.01,defaultColor:new Color(8947848),defaultAlpha:.8,defaultKeepAlive:!0});this.pass._outline_effect_=d}a?this.pass.outline_effect=this.pass._outline_effect_:this.pass.outline_effect=null}}},{type:"make_toggle",key:"TAA unbiased",get(){return this.pass.unbiased},set(a){this.pass&&(this.pass.unbiased=a)}},{type:"make_toggle",key:"TAA accumulate",get(){return this.pass.accumulate},set(a){this.pass&&(this.pass.accumulate=a)}},{type:"make_pulldown",key:"TAA Sample Level",values:[{key:"x1",value:0},{key:"x2",value:1},{key:"x4",value:2},{key:"x8",value:3},{key:"x16",value:4},{key:"x32",value:5}],get(){return this.pass.sampleLevel},set(a){this.pass.sampleLevel=Number(a)}}],toggle:deferred_renderer_pass_toggle},SSAA:{name:TL$5("ssaa"),async preload(){if(this.SSAARenderPass==null){const{SSAARenderPass:a}=await __vitePreload(()=>import("./SSAARenderPass@CzwPtIot.js"),[],import.meta.url);this.SSAARenderPass=a}},async initialize(){if(this.pass==null){const a=new this.SSAARenderPass(DMC.scene,DMC.camera);return window.devicePixelRatio-1>.01?a.sampleLevel=1:a.sampleLevel=2,this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_pulldown",key:"Sample Level",values:[{key:"x1",value:0},{key:"x2",value:1},{key:"x4",value:2},{key:"x8",value:3},{key:"x16",value:4},{key:"x32",value:5}],get(){return this.pass.sampleLevel},set(a){this.pass.sampleLevel=Number(a)}},{type:"make_toggle",key:"Outline",get(){return this.pass.outline_effect},async set(a){if(this.pass){if(this.pass._outline_effect_==null&&a){const{OutlineEffect:c}=await __vitePreload(()=>import("./OutlineEffect@CWld7flV.js"),[],import.meta.url);this.OutlineEffect=c;const d=new this.OutlineEffect(DMC.base_renderer,{defaultThickness:.01,defaultColor:new Color(8947848),defaultAlpha:.8,defaultKeepAlive:!0});this.pass._outline_effect_=d}a?this.pass.outline_effect=this.pass._outline_effect_:this.pass.outline_effect=null}}}],toggle:deferred_renderer_pass_toggle},SMAA:{name:TL$5("smaa"),async preload(){},async initialize(){if(this.pass==null){const a=new SMAAPass(e,i);return this.pass=a,this.pass.needsSwap=!0,!0}return!1},order:o++,pass:null,value:!0,toggle:deferred_renderer_pass_toggle},BleachBypass:{name:TL$5("bleach_bypass"),async preload(){},async initialize(){if(this.BleachBypass==null){const a=[__vitePreload(()=>import("./BleachBypassShader@oBD3ESB3.js"),[],import.meta.url)];await Promise.all(a);const{BleachBypassShader:c}=await a[0];this.BleachBypassShader=c}if(this.pass==null){const a=new ShaderPass(this.BleachBypassShader);return this.pass=a,this.pass.uniforms.opacity.value=.5,!0}return!1},order:o++,pass:null,value:!0,sub_params:[{type:"make_key_value_with_slider",key:"Opacity",min:0,max:1,step:.01,get(){return this.pass.uniforms.opacity.value},set(a){this.pass.uniforms.opacity.value=Number(a)}}],toggle:deferred_renderer_pass_toggle},SAO:{name:TL$5("sao"),async preload(){if(this.SAOPass==null){const{SAOPass:a}=await __vitePreload(()=>import("./SAOPass@YMIOqZcl.js"),[],import.meta.url);this.SAOPass=a}},async initialize(){if(this.pass==null){const a=new this.SAOPass(DMC.scene,DMC.camera,null,!0);return DMC.ui.renderer_flags.logarithmicDepthBuffer?(a.resolution.set(1,1),a.saoMaterial.defines.NUM_SAMPLES=16,a.params.saoBias=.5,a.params.saoIntensity=.0015,a.params.saoScale=100,a.params.saoKernelRadius=65,a.params.saoMinResolution=47e-7,a.params.saoBlur=!0,a.params.saoBlurStdDev=20,a.params.saoBlurRadius=4,a.params.saoBlurDepthCutoff=2e-6):(a.resolution.set(1,1),a.saoMaterial.defines.NUM_SAMPLES=16,a.params.saoBias=.5,a.params.saoIntensity=.002,a.params.saoScale=100,a.params.saoKernelRadius=65,a.params.saoMinResolution=47e-7,a.params.saoBlur=!0,a.params.saoBlurStdDev=20,a.params.saoBlurRadius=4,a.params.saoBlurDepthCutoff=2e-6),a.update_parameter(),this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{OUTPUT:{Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},type:"make_pulldown",key:"Mode",values:[{key:"Integrated",value:0},{key:"SAO Buffer",value:2},{key:"Beauty Buffer",value:1},{key:"Depth Buffer",value:3},{key:"Normal Buffer",value:4}],get(){return this.pass.params.output},set(a){this.pass.params.output=Number(a)}},{type:"make_key_value_with_slider",key:"Samples",min:1,max:32,step:1,get(){return this.pass.saoMaterial.defines.NUM_SAMPLES},set(a){this.pass.saoMaterial.defines.NUM_SAMPLES=Number(a),this.pass.saoMaterial.needsUpdate=!0,this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"Bias",min:0,max:1,step:.01,get(){return this.pass.params.saoBias},set(a){this.pass.params.saoBias=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"Intensity",min:0,max:.2,step:1e-5,get(){return this.pass.params.saoIntensity},set(a){this.pass.params.saoIntensity=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"Scale",min:1,max:1e4,step:.01,get(){return this.pass.params.saoScale},set(a){this.pass.params.saoScale=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"KernelRadius",min:1,max:100,step:.1,get(){return this.pass.params.saoKernelRadius},set(a){this.pass.params.saoKernelRadius=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"MinResolution",min:0,max:1e-5,step:1e-7,get(){return this.pass.params.saoMinResolution},set(a){this.pass.params.saoMinResolution=Number(a),this.pass.update_parameter()}},{type:"make_toggle",key:"Blur",get(){return this.pass.params.saoBlur},set(a){this.pass.params.saoBlur=a,this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"BlurRadius",min:1,max:10,step:.01,get(){return this.pass.params.saoBlurRadius},set(a){this.pass.params.saoBlurRadius=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"BlurStdDev",min:1,max:20,step:.01,get(){return this.pass.params.saoBlurStdDev},set(a){this.pass.params.saoBlurStdDev=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"BlurDepthCutoff",min:0,max:1e-5,step:1e-6,get(){return this.pass.params.saoBlurDepthCutoff},set(a){this.pass.params.saoBlurDepthCutoff=Number(a),this.pass.update_parameter()}},{type:"make_button",key:"Default",value:"Reset",onclick(){const a=DMC.ui.renderer_flags,c=this.pass;a.logarithmicDepthBuffer?(c.resolution.set(1,1),c.saoMaterial.defines.NUM_SAMPLES=16,c.params.saoBias=.5,c.params.saoIntensity=.0015,c.params.saoScale=100,c.params.saoKernelRadius=65,c.params.saoMinResolution=47e-7,c.params.saoBlur=!0,c.params.saoBlurStdDev=20,c.params.saoBlurRadius=4,c.params.saoBlurDepthCutoff=2e-6):(c.resolution.set(1,1),c.saoMaterial.defines.NUM_SAMPLES=16,c.params.saoBias=.5,c.params.saoIntensity=.002,c.params.saoScale=100,c.params.saoKernelRadius=65,c.params.saoMinResolution=47e-7,c.params.saoBlur=!0,c.params.saoBlurStdDev=20,c.params.saoBlurRadius=4,c.params.saoBlurDepthCutoff=2e-6);const d=DMC.render_passes.SAO.sub_components;d.Samples.update(c.saoMaterial.defines.NUM_SAMPLES),d.Intensity.update(c.params.saoIntensity),d.Scale.update(c.params.saoScale),d.KernelRadius.update(c.params.saoKernelRadius),d.MinResolution.update(c.params.saoMinResolution),d.Blur.update(c.params.saoBlur),d.BlurRadius.update(c.params.saoBlurRadius),d.BlurStdDev.update(c.params.saoBlurStdDev),d.BlurDepthCutoff.update(c.params.saoBlurDepthCutoff),c.update_parameter()}}],toggle:deferred_renderer_pass_toggle},HBAO:{name:TL$5("hbao"),async preload(){if(this.HBAOPass==null){const{HBAOPass:a}=await __vitePreload(()=>import("./HBAOPass@DG1WO0kq.js"),__vite__mapDeps([10,11]),import.meta.url);this.HBAOPass=a}},async initialize(){if(this.pass==null){const a=new this.HBAOPass(DMC.scene,DMC.camera,256,256);DMC.ui.renderer_flags;const c={radius:.035,distanceExponent:3,bias:0,samples:16},d={lumaPhi:4,depthPhi:2,normalPhi:3,radius:4,rings:4,samples:16};return this.hbaoParameters=c,this.pdParameters=d,a.updateHbaoMaterial(c),a.updatePdMaterial(d),a.hbaoParameters=c,a.pdParameters=d,this.pass=a,!0}return!1},pdParameters:null,hbaoParameters:null,order:o++,pass:null,value:!1,sub_params:[{OUTPUT:{Default:0,Diffuse:1,Depth:2,Normal:3,HBAO:4,Denoise:5},type:"make_pulldown",key:"Mode",values:[{key:"Default",value:0},{key:"Diffuse",value:1},{key:"Depth",value:2},{key:"Normal",value:3},{key:"HBAO",value:4},{key:"Denoise",value:5}],get(){return this.pass.output},set(a){this.pass.output=Number(a)}},{type:"make_key_value_with_slider",key:"H_radius",min:.001,max:.1,step:1e-4,get(){return this.pass.hbaoParameters.radius},set(a){this.pass.hbaoParameters.radius=Number(a),this.pass.updateHbaoMaterial(this.pass.hbaoParameters)}},{type:"make_key_value_with_slider",key:"H_distanceExponent",min:1,max:4,step:.01,get(){return this.pass.hbaoParameters.distanceExponent},set(a){this.pass.hbaoParameters.distanceExponent=Number(a),this.pass.updateHbaoMaterial(this.pass.hbaoParameters)}},{type:"make_key_value_with_slider",key:"H_bias",min:0,max:.1,step:.001,get(){return this.pass.hbaoParameters.bias},set(a){this.pass.hbaoParameters.bias=Number(a),this.pass.updateHbaoMaterial(this.pass.hbaoParameters)}},{type:"make_key_value_with_slider",key:"H_samples",min:1,max:32,step:1,get(){return this.pass.hbaoParameters.samples},set(a){this.pass.hbaoParameters.samples=Number(a),this.pass.updateHbaoMaterial(this.pass.hbaoParameters)}},{type:"make_key_value_with_slider",key:"P_lumaPhi",min:0,max:20,step:.01,get(){return this.pass.pdParameters.lumaPhi},set(a){this.pass.pdParameters.lumaPhi=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_depthPhi",min:.01,max:20,step:.01,get(){return this.pass.pdParameters.depthPhi},set(a){this.pass.pdParameters.depthPhi=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_normalPhi",min:.01,max:20,step:.01,get(){return this.pass.pdParameters.normalPhi},set(a){this.pass.pdParameters.normalPhi=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_radius",min:0,max:32,step:1,get(){return this.pass.pdParameters.radius},set(a){this.pass.pdParameters.radius=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_rings",min:0,max:16,step:.125,get(){return this.pass.pdParameters.rings},set(a){this.pass.pdParameters.rings=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_samples",min:1,max:32,step:1,get(){return this.pass.pdParameters.samples},set(a){this.pass.pdParameters.samples=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}}],toggle:deferred_renderer_pass_toggle},GTAO:{name:TL$5("gtao"),async preload(){if(this.GTAOPass==null){const{GTAOPass:a}=await __vitePreload(()=>import("./GTAOPass@BZIQrJwt.js"),__vite__mapDeps([12,11]),import.meta.url);this.GTAOPass=a}},async initialize(){if(this.pass==null){const a=new this.GTAOPass(DMC.scene,DMC.camera,256,256);DMC.ui.renderer_flags;const c={blendIntensity:1,radius:.001,distanceExponent:2,thickness:.002,scale:.7,samples:16,distanceFallOff:!0,clipRangeCheck:!0,depthRelativeBias:!1,nvAlignedSamples:!1,screenSpaceRadius:!1},d={lumaPhi:10,depthPhi:2,normalPhi:3,radius:4,radiusExponent:1,rings:2,samples:16};return a.updateGtaoMaterial(c),a.updatePdMaterial(d),this.aoParameters=c,this.pdParameters=d,a.updateGtaoMaterial(c),a.updatePdMaterial(d),a.aoParameters=c,a.pdParameters=d,a.backup_aoParameters=JSON.parse(JSON.stringify(c)),a.backup_pdParameters=JSON.parse(JSON.stringify(d)),this.pass=a,!0}return!1},pdParameters:null,aoParameters:null,order:o++,pass:null,value:!1,sub_params:[{type:"make_pulldown",key:"Mode",values:[{key:"Default",value:0},{key:"Diffuse",value:1},{key:"Depth",value:2},{key:"Normal",value:3},{key:"AO",value:4},{key:"Denoise",value:5}],get(){return this.pass.output},set(a){this.pass.output=Number(a)}},{type:"make_toggle",key:"AOMaterial ",get(){return this.pass.aoParameters.ao_material},set(a){this.pass.aoParameters.ao_material=a,DMC.scene.traverse(c=>{if(c.material)if(Array.isArray(c.material))c.material.forEach(d=>{d instanceof MeshPostProcessingMaterial&&(d.aoPassMap=a?this.pass.gtaoMap:null)});else{const d=c.material;d instanceof MeshPostProcessingMaterial&&(d.aoPassMap=a?this.pass.gtaoMap:null)}})}},{type:"make_toggle",key:"G_distanceFallOff ",get(){return this.pass.aoParameters.distanceFallOff},set(a){this.pass.aoParameters.distanceFallOff=a,this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_toggle",key:"G_clipRangeCheck ",get(){return this.pass.aoParameters.clipRangeCheck},set(a){this.pass.aoParameters.clipRangeCheck=a,this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_toggle",key:"G_depthRelativeBias ",get(){return this.pass.aoParameters.depthRelativeBias},set(a){this.pass.aoParameters.depthRelativeBias=a,this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_toggle",key:"G_nvAlignedSamples ",get(){return this.pass.aoParameters.nvAlignedSamples},set(a){this.pass.aoParameters.nvAlignedSamples=a,this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_toggle",key:"G_screenSpaceRadius ",get(){return this.pass.aoParameters.screenSpaceRadius},set(a){this.pass.aoParameters.screenSpaceRadius=a,this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_key_value_with_slider",key:"G_blendIntensity",min:0,max:1,step:1e-4,get(){return this.pass.aoParameters.blendIntensity},set(a){this.pass.aoParameters.blendIntensity=Number(a),this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_key_value_with_slider",key:"G_radius",min:.001,max:1,step:1e-4,get(){return this.pass.aoParameters.radius},set(a){this.pass.aoParameters.radius=Number(a),this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_key_value_with_slider",key:"G_distanceExponent",min:1,max:4,step:1e-4,get(){return this.pass.aoParameters.distanceExponent},set(a){this.pass.aoParameters.distanceExponent=Number(a),this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_key_value_with_slider",key:"G_thickness",min:.001,max:.25,step:1e-4,get(){return this.pass.aoParameters.thickness},set(a){this.pass.aoParameters.thickness=Number(a),this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_key_value_with_slider",key:"G_scale",min:.01,max:2,step:1e-4,get(){return this.pass.aoParameters.scale},set(a){this.pass.aoParameters.scale=Number(a),this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_key_value_with_slider",key:"G_samples",min:2,max:32,step:1,get(){return this.pass.aoParameters.samples},set(a){this.pass.aoParameters.samples=Number(a),this.pass.updateGtaoMaterial(this.pass.aoParameters)}},{type:"make_key_value_with_slider",key:"P_lumaPhi",min:0,max:20,step:.01,get(){return this.pass.pdParameters.lumaPhi},set(a){this.pass.pdParameters.lumaPhi=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_depthPhi",min:.01,max:20,step:.01,get(){return this.pass.pdParameters.depthPhi},set(a){this.pass.pdParameters.depthPhi=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_normalPhi",min:.01,max:20,step:.01,get(){return this.pass.pdParameters.normalPhi},set(a){this.pass.pdParameters.normalPhi=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_radius",min:0,max:32,step:1,get(){return this.pass.pdParameters.radius},set(a){this.pass.pdParameters.radius=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_rings",min:0,max:16,step:.125,get(){return this.pass.pdParameters.rings},set(a){this.pass.pdParameters.rings=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_key_value_with_slider",key:"P_samples",min:1,max:32,step:1,get(){return this.pass.pdParameters.samples},set(a){this.pass.pdParameters.samples=Number(a),this.pass.updatePdMaterial(this.pass.pdParameters)}},{type:"make_button",key:"Default",value:"Reset",onclick(){DMC.ui.renderer_flags;const a=this.pass;Object.assign(a.aoParameters,a.backup_aoParameters),Object.assign(a.pdParameters,a.backup_pdParameters),a.updateGtaoMaterial(a.aoParameters),a.updatePdMaterial(a.pdParameters);const c=DMC.render_passes.GTAO.sub_components,d=DMC.render_passes.GTAO.sub_params,u={};for(const f in d)u[d[f].key]=d[f];for(const f in c)c[f].update(u[f].get())}}],toggle:deferred_renderer_pass_toggle},SSR:{name:TL$5("ssr"),async preload(){if(this.SSRPass==null){__vitePreload(()=>import("./MipGenerationShader@34s1mtIh.js"),__vite__mapDeps([13,14]),import.meta.url),__vitePreload(()=>import("./mipSampleFunctions@CE2NLcig.js"),[],import.meta.url),__vitePreload(()=>import("./ShaderReplacement@CxvBdKt5.js"),__vite__mapDeps([15,16,17]),import.meta.url),__vitePreload(()=>import("./PackedShader@D9dUVuxe.js"),[],import.meta.url),__vitePreload(()=>import("./WrappedShaderMaterial@jJQ4lvlR.js"),__vite__mapDeps([16,17]),import.meta.url),__vitePreload(()=>import("./ExtendedShaderMaterial@CoOG-Exu.js"),[],import.meta.url);const{SSRPass:a}=await __vitePreload(()=>import("./SSRPass@BsVtJJvQ.js"),__vite__mapDeps([18,14,15,16,17,19,13]),import.meta.url);this.SSRPass=a}},async initialize(){if(this.pass==null){const a=this.SSRPass,c=new a(DMC.scene,DMC.camera);{const d={enabled:!0,orthographic:!1,stride:5,steps:90,binarySearchSteps:4,intensity:.18,jitter:1,jitterStrategy:s.REGULAR_JITTER,renderTargetScale:.5,raymarchTargetScale:.5,useThickness:!1,thickness:1,enableBlur:!0,blurStride:1,blurRadius:3,glossinessMode:s.MULTI_GLOSSY,glossyJitterStrategy:s.BLUENOISE_JITTER,useNormalMaps:!0,useRoughnessMaps:!0,useRoughnessOverride:!1,roughnessOverride:null,roughnessOverrideValue:.98,roughnessCutoff:.9,display:a.DEFAULT},u=c;u.raymarchTargetScale=d.raymarchTargetScale,u.renderTargetScale=d.renderTargetScale,u.intensity=d.intensity,u.steps=d.steps,u.stride=d.stride,u.binarySearchSteps=d.binarySearchSteps,u.enabled=d.enabled,u.jitter=d.jitter,u.jitterStrategy=d.jitterStrategy,u.useThickness=d.useThickness,u.thickness=d.thickness,u.useNormalMaps=d.useNormalMaps,u.useRoughnessMaps=d.useRoughnessMaps,u.useRoughnessOverride=d.useRoughnessOverride,u.roughnessOverrideValue=d.roughnessOverrideValue,u.roughnessOverride=u.useRoughnessOverride?d.roughnessOverride:null,u.glossyJitterStrategy=d.glossyJitterStrategy,u.glossinessMode=d.glossinessMode,u.roughnessCutoff=d.roughnessCutoff,u.enableBlur=d.enableBlur,u.blurRadius=d.blurRadius,u.blurStride=d.blurStride,u.update_parameter()}return this.pass=c,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_pulldown",key:"Mode",values:[{key:"Integrated",value:s.DEFAULT},{key:"FRONT_DEPTH",value:s.FRONT_DEPTH},{key:"BACK_DEPTH",value:s.BACK_DEPTH},{key:"DEPTH_DELTA",value:s.DEPTH_DELTA},{key:"NORMAL",value:s.NORMAL},{key:"ROUGHNESS",value:s.ROUGHNESS},{key:"INTERSECTION_RESULTS",value:s.INTERSECTION_RESULTS},{key:"INTERSECTION_DISTANCE",value:s.INTERSECTION_DISTANCE},{key:"INTERSECTION_COLOR",value:s.INTERSECTION_COLOR}],get(){return this.pass.debug.display},set(a){this.pass.debug.display=Number(a),this.pass.update_parameter()}},{type:"make_pulldown",key:"JitterStrategy",values:[{key:"REGULAR_JITTER",value:s.REGULAR_JITTER},{key:"BLUENOISE_JITTER",value:s.BLUENOISE_JITTER},{key:"RANDOM_JITTER",value:s.RANDOM_JITTER}],get(){return this.pass.jitterStrategy},set(a){this.pass.jitterStrategy=Number(a),this.pass.update_parameter()}},{type:"make_pulldown",key:"GlossyJitterStrategy",values:[{key:"REGULAR_JITTER",value:s.REGULAR_JITTER},{key:"BLUENOISE_JITTER",value:s.BLUENOISE_JITTER},{key:"RANDOM_JITTER",value:s.RANDOM_JITTER}],get(){return this.pass.glossyJitterStrategy},set(a){this.pass.glossyJitterStrategy=Number(a),this.pass.update_parameter()}},{type:"make_pulldown",key:"GlossinessMode",values:[{key:"NO_GLOSSY",value:s.NO_GLOSSY},{key:"SIMPLE_GLOSSY",value:s.SIMPLE_GLOSSY},{key:"MULTI_GLOSSY",value:s.MULTI_GLOSSY}],get(){return this.pass.glossinessMode},set(a){this.pass.glossinessMode=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"Stride",min:0,max:50,step:1,get(){return this.pass.stride},set(a){this.pass.stride=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"Steps",min:0,max:100,step:1,get(){return this.pass.steps},set(a){this.pass.steps=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"BinarySearchSteps",min:0,max:100,step:1,get(){return this.pass.binarySearchSteps},set(a){this.pass.binarySearchSteps=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"Intensity",min:0,max:1,step:.01,get(){return this.pass.intensity},set(a){this.pass.intensity=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"Jitter",min:0,max:100,step:1,get(){return this.pass.jitter},set(a){this.pass.jitter=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"RenderTargetScale",min:0,max:3,step:.01,get(){return this.pass.renderTargetScale},set(a){this.pass.renderTargetScale=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"RaymarchTargetScale",min:0,max:3,step:.01,get(){return this.pass.raymarchTargetScale},set(a){this.pass.raymarchTargetScale=Number(a),this.pass.update_parameter()}},{type:"make_toggle",key:"UseThickness ",get(){return this.pass.useThickness},set(a){this.pass.useThickness=a,this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"Thickness",min:0,max:3,step:.01,get(){return this.pass.thickness},set(a){this.pass.thickness=Number(a),this.pass.update_parameter()}},{type:"make_toggle",key:"EnableBlur ",get(){return this.pass.enableBlur},set(a){this.pass.enableBlur=a,this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"BlurStride",min:1,max:4,step:1,get(){return this.pass.blurStride},set(a){this.pass.blurStride=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"BlurRadius",min:1,max:16,step:1,get(){return this.pass.blurRadius},set(a){this.pass.blurRadius=Number(a),this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"RoughnessOverride",min:0,max:10,step:.1,get(){return this.pass.roughnessOverrideValue},set(a){this.pass.roughnessOverrideValue=Number(a),a?this.pass.roughnessOverride=Number(this.pass.roughnessOverrideValue):this.pass.roughnessOverride=null,this.pass.update_parameter()}},{type:"make_key_value_with_slider",key:"RoughnessCutoff",min:0,max:2,step:.01,get(){return this.pass.roughnessCutoff},set(a){this.pass.roughnessCutoff=Number(a),this.pass.update_parameter()}},{type:"make_toggle",key:"UseRoughnessMaps ",get(){return this.pass.useRoughnessMaps},set(a){this.pass.useRoughnessMaps=a,this.pass.update_parameter()}},{type:"make_toggle",key:"UseRoughnessOverride ",get(){return this.pass.useRoughnessOverride},set(a){a?this.pass.roughnessOverride=Number(this.pass.roughnessOverrideValue):this.pass.roughnessOverride=null,this.pass.useRoughnessOverride=a,this.pass.update_parameter()}}],toggle:deferred_renderer_pass_toggle},"🧪SSR2":{name:TL$5("ssr2"),async preload(){if(this.SSRPass==null){const{SSRPass:a}=await __vitePreload(()=>import("./SSRPass@BrBfgE-U.js"),[],import.meta.url),{ReflectorForSSRPass:c}=await __vitePreload(()=>import("./ReflectorForSSRPass@DYrsoXuG.js"),[],import.meta.url);this.SSRPass=a,this.ReflectorForSSRPass=c}},async initialize(){if(this.pass==null){const a=this.SSRPass,c=DMC.base_renderer.renderer,d=DMC.scene,u=DMC.current.camera||DMC.camera;this.pass=new a({renderer:c,scene:d,camera:u,width:innerWidth,height:innerHeight,groundReflector:null,selects:null}),this.pass._groundReflector=null;const f=new PlaneGeometry(1,1);return this.pass._groundReflector=new this.ReflectorForSSRPass(f,{clipBias:3e-4,textureWidth:window.innerWidth,textureHeight:window.innerHeight,color:8947848,useDepthTexture:!0}),this.pass._groundReflector.material.depthWrite=!1,this.pass._groundReflector.rotation.x=-Math.PI/2,this.pass._groundReflector.visible=!1,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_key_value_with_slider",key:"Thickness",min:0,max:.1,step:1e-4,get(){return this.pass.thickness},set(a){this.pass.thickness=Number(a)}},{type:"make_toggle",key:"InfiniteThick ",get(){return this.pass.infiniteThick},set(a){this.pass.infiniteThick=a}},{type:"make_toggle",key:"GroundReflector ",get(){return this.pass.groundReflector!=null},set(a){this.pass.groundReflector=a?null:this.pass._groundReflector,this.pass._groundReflector.parent&&this.pass._groundReflector.parent.remove(this.pass._groundReflector),DMC.scene.add(this.pass._groundReflector)}}],toggle:deferred_renderer_pass_toggle},AutoExposure:{name:TL$5("auto_exposure"),async preload(){},async initialize(){if(this.pass==null){const{AdaptiveToneMappingPass:a}=await __vitePreload(()=>import("./AdaptiveToneMappingPass@BQpMIpNU.js"),[],import.meta.url);this.AdaptiveToneMappingPass=a;const c=new this.AdaptiveToneMappingPass(!0,256);return c.reset(),c.materialAdaptiveLum.uniforms.tau.value=.004,c.materialToneMap.uniforms.middleGrey.value=.6,c.materialToneMap.uniforms.minLuminance.value=5e-4,c.mip_level=5,this.pass=c,!0}return!1},order:o++,pass:null,value:!0,sub_params:[{type:"make_pulldown",key:"Sprit",values:[{key:"1x1",value:1},{key:"3x3",value:3},{key:"5x5",value:5}],get(){return this.pass.mip_level==0?3:this.pass.mip_level},set(a){this.pass.mip_level=Number(a),this.pass.mip_level=this.pass.mip_level==0?3:this.pass.mip_level,this.pass.materialAdaptiveLum.defines.MIP_LEVEL_1X1=(Math.log(this.pass.resolution/this.pass.mip_level)/Math.log(2)).toFixed(1),this.pass.materialAdaptiveLum.needsUpdate=!0}},{type:"make_key_value_with_slider",key:"Speed",min:.001,max:.01,step:1e-4,get(){return this.pass.materialAdaptiveLum.uniforms.tau.value},set(a){this.pass.setAdaptionRate(Number(a))}},{type:"make_key_value_with_slider",key:"Grey",min:.5,max:2,step:.01,get(){return this.pass.materialToneMap.uniforms.middleGrey.value},set(a){this.pass.setMiddleGrey(Number(a))}},{type:"make_key_value_with_slider",key:"Max",min:.001,max:16,step:.001,get(){return this.pass.materialToneMap.uniforms.maxLuminance.value},set(a){this.pass.setMaxLuminance(Number(a))}},{type:"make_key_value_with_slider",key:"Min",min:1e-4,max:1,step:1e-4,get(){return this.pass.materialToneMap.uniforms.minLuminance.value},set(a){this.pass.setMinLuminance(Number(a))}},{type:"make_toggle",key:"Adaptive",get(){return this.pass.adaptive},set(a){this.pass.setAdaptive(a)}}],toggle:deferred_renderer_pass_toggle},Mosaic:{name:TL$5("mosaic"),async preload(){if(this.MosaicPass==null){const{MosaicPass:a}=await __vitePreload(()=>import("./MosaicPass@C9gjqo_t.js"),[],import.meta.url);this.MosaicPass=a}},async initialize(){if(this.pass==null){const a=new this.MosaicPass(DMC.scene,DMC.camera);return this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_key_value_with_slider",key:"Size",min:.01,max:1,step:.01,get(){return this.pass.filter_pass.material.uniforms.mosaic_size.value},set(a){this.pass.filter_pass.material.uniforms.mosaic_size.value=Number(a)}}],toggle:deferred_renderer_pass_toggle},BleachBypass2:{name:TL$5("bleach_bypass2"),async preload(){},async initialize(){if(this.BleachBypass==null){const a=[__vitePreload(()=>import("./BleachBypassShader@oBD3ESB3.js"),[],import.meta.url)];await Promise.all(a);const{BleachBypassShader:c}=await a[0];this.BleachBypassShader=c}if(this.pass==null){const a=new ShaderPass(this.BleachBypassShader);return this.pass=a,this.pass.uniforms.opacity.value=1,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_key_value_with_slider",key:"Opacity",min:0,max:1,step:.01,get(){return this.pass.uniforms.opacity.value},set(a){this.pass.uniforms.opacity.value=Number(a)}}],toggle:deferred_renderer_pass_toggle},MotionBlur:{name:TL$5("motion_blur"),async preload(){this.BlueNoiseSamples=BlueNoiseSamples,this.prev_skinning_pars_vertex=prev_skinning_pars_vertex,this.MotionBlurPass=MotionBlurPass},async initialize(){if(this.pass==null){const a=new this.MotionBlurPass(DMC.scene,DMC.camera);return a.intensity_backup=a.intensity=1,a.samples=64,a.expandGeometry=0,a.interpolateGeometry=.5,a.renderCameraBlur=!0,a.smearIntensity=.5,a.jitter=1,a.jitterStrategy=2,a.auto_intensity=!0,a.auto_refresh=!0,a.blurTransparent=!0,this.pass=a,!0}return!1},order:o++,pass:null,value:!0,sub_params:[{type:"make_pulldown",key:"Mode",values:[{key:"Integrated",value:0},{key:"VELOCITY",value:1},{key:"GEOMETRY",value:2}],get(){return this.pass.debug.display},set(a){this.pass.debug.display=Number(a)}},{type:"make_pulldown",key:"JitterStrategy",values:[{key:"REGULAR_JITTER",value:0},{key:"RANDOM_JITTER",value:1},{key:"BLUENOISE_JITTER",value:2}],get(){return this.pass.jitterStrategy},set(a){this.pass.jitterStrategy=Number(a)}},{type:"make_toggle",key:"BlurTransparent",get(){return this.pass.blurTransparent},set(a){this.pass.blurTransparent=a}},{type:"make_toggle",key:"RenderCameraBlur",get(){return this.pass.renderCameraBlur},set(a){this.pass.renderCameraBlur=a}},{type:"make_toggle",key:"AutoIntensity",get(){return this.pass.auto_intensity},set(a){this.pass.auto_intensity=a}},{type:"make_toggle",key:"AutoRefresh",get(){return this.pass.auto_refresh},set(a){this.pass.auto_refresh=a}},{type:"make_key_value_with_slider",key:"Intensity",min:0,max:1,step:.01,get(){return this.pass.intensity_backup},set(a){this.pass.intensity_backup=this.pass.intensity=Number(a)}},{type:"make_key_value_with_slider",key:"Jitter",min:1,max:4,step:1,get(){return this.pass.jitter},set(a){this.pass.jitter=Number(a)}},{type:"make_pulldown",key:"Samples",values:[{key:"16",value:16},{key:"32",value:32},{key:"64",value:64},{key:"128",value:128},{key:"256",value:256}],get(){return this.pass.samples},set(a){this.pass.samples=Number(a)}},{type:"make_key_value_with_slider",key:"ExpandGeometry",min:0,max:4,step:.01,get(){return this.pass.expandGeometry},set(a){this.pass.expandGeometry=Number(a)}},{type:"make_key_value_with_slider",key:"InterpolateGeometry",min:0,max:4,step:.01,get(){return this.pass.interpolateGeometry},set(a){this.pass.interpolateGeometry=Number(a)}},{type:"make_key_value_with_slider",key:"SmearIntensity",min:0,max:4,step:.01,get(){return this.pass.smearIntensity},set(a){this.pass.smearIntensity=Number(a)}},{type:"make_key_value_with_slider",key:"RenderTargetScale",min:0,max:4,step:.01,get(){return this.pass.renderTargetScale},set(a){this.pass.renderTargetScale=Number(a)}}],toggle:deferred_renderer_pass_toggle},DoF:{name:TL$5("dof"),async preload(){},async initialize(){if(this.pass==null){const a=new BokehPass(DMC.scene,DMC.camera,{focus:40,aperture:6e-5,maxblur:.0059,width:e,height:i});return a.aperture_coef=1.01,a.maxBlur=.0125,this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_key_value_with_slider",key:"Focus",min:1,max:200,step:.1,get(){return this.pass.uniforms.focus.value},set(a){this.pass.uniforms.focus.value=Number(a)}},{type:"make_key_value_with_slider",key:"Aperture",min:0,max:.003,step:1e-5,get(){return this.pass.uniforms.aperture.value},set(a){this.pass.uniforms.aperture.value=Number(a)}},{type:"make_toggle",key:"autoDoF",get(){return this.pass.autoDoF},set(a){this.pass.autoDoF=a}},{type:"make_key_value_with_slider",key:"ApertureCoef",min:.95,max:1.05,step:.001,get(){return this.pass.aperture_coef},set(a){this.pass.aperture_coef=Number(a)}},{type:"make_key_value_with_slider",key:"MaxBlur",min:0,max:.1,step:1e-4,get(){return this.pass.maxBlur},set(a){this.pass.maxBlur=Number(a)}},{type:"make_toggle",key:"ThreePoints",get(){return this.pass.three_points},set(a){this.pass.three_points=a}},{type:"make_button",key:"🧪AutoTrackingBox2",value:"Make",async onclick(){const a=[];DMC.scene.traverse(c=>{if(c.isMesh){const d=c.getDDDProperties?.();d&&(d.type!="box"?a.push(c):d.__dof_attachment__&&Builder3D.remove_object(c))}});for(const c of a){let d=null;if(c.skeleton?.bones)for(const v of c.skeleton.bones)v.name=="センター",v.name=="上半身"&&(d=v);c.geometry?.computeBoundingBox?.();let u=c.geometry.boundingBox,f=1,m=1,h=1;d&&(f=.5,m=1,h=.75);const _=new Mesh(new BoxGeometry((u.max.x-u.min.x)*f,(u.max.y-u.min.y)*m,(u.max.z-u.min.z)*h),new MeshBasicMaterial({color:65280}));window.BindObjectAsDDD(_);const b=_.getDDDProperties?.();b.__dof_attachment__=!0,b.dof_dynamic=!1,b.dof_target=!0,b.dof_needsUpdate=!0,d?(b.object_attach_to_flag=!0,b.object_attach_offset=new Vector3(u.min.x+(u.max.x-u.min.x)/2,u.min.y+(u.max.y-u.min.y)/2,u.min.z+(u.max.z-u.min.z)/2),b.object_attach_offset.multiplyScalar(-.5),b.object_attach_to=d.getDDDProperties().uuid,b.apply_attach_object(_)):_.position.set(u.min.x+(u.max.x-u.min.x)/2,u.min.y+(u.max.y-u.min.y)/2,u.min.z+(u.max.z-u.min.z)/2),BuilderUtil.GenerateName(_,"DofBox"),DMC.scene.add(_),_.visible=!1}DMC.dispatchEvent("change@scene",{})}},{type:"make_button",key:"AutoTrackingBox",value:"Make",async onclick(){const a=[];function c(d){let u=!1;return d.getDDDProperties?.()?.source_file?!0:(d.parent&&(u=u||c(d.parent)),u)}DMC.scene.traverse(d=>{if(d.isMesh){const u=d.getDDDProperties?.();u&&(u.type!="box"?c(d)&&a.push(d):u.__dof_attachment__&&Builder3D.remove_object(d))}});for(const d of a){let u=null;if(d.skeleton?.bones)for(const w of d.skeleton.bones)w.name=="センター",w.name=="上半身"&&(u=w);d.geometry?.computeBoundingBox?.();let f=d.geometry.boundingBox;const m=new Vector3,h=new Quaternion,_=new Vector3;d.matrixWorld.decompose(m,h,_),u&&(_.x*=.5,_.y*=1,_.z*=.75),_.x*=.5,_.y*=.5,_.z*=.5;const b=await UI.generate_preset("box");b.scale.set((f.max.x-f.min.x)*_.x,(f.max.y-f.min.y)*_.y,(f.max.z-f.min.z)*_.z);const v=b.getDDDProperties?.();v.__dof_attachment__=!0,v.dof_dynamic=!1,v.dof_target=!0,v.dof_needsUpdate=!0,u&&(v.object_attach_to_flag=!0,v.object_attach_to=u.getDDDProperties().uuid,v.apply_attach_object(b)),BuilderUtil.GenerateName(b,"DofBox"),DMC.scene.add(b),b.visible=!1}DMC.dispatchEvent("change@scene",{})}}],toggle:deferred_renderer_pass_toggle},Bloom:{name:TL$5("bloom"),async preload(){this.UnrealBloomPass==null&&(this.UnrealBloomPass=UnrealBloomPass)},async initialize(){if(this.pass==null){const a=new this.UnrealBloomPass(new Vector2(e,i),.2,.35,.998);return this.pass=a,!0}return!1},order:o++,pass:null,value:!0,sub_params:[{type:"make_key_value_with_slider",key:"Strength",min:.1,max:.5,step:.02,get(){return this.pass.strength},set(a){this.pass.strength=Number(a)}},{type:"make_key_value_with_slider",key:"Radius",min:.1,max:.5,step:.02,get(){return this.pass.radius},set(a){this.pass.radius=Number(a)}},{type:"make_key_value_with_slider",key:"Threshold",min:.1,max:2,step:.01,get(){return this.pass.threshold},set(a){this.pass.threshold=Number(a)}}],toggle:deferred_renderer_pass_toggle},DotScreen:{name:TL$5("dot_screen"),async preload(){if(this.DotScreen==null){const a=[__vitePreload(()=>import("./DotScreenPass@D6lz0-Gg.js"),[],import.meta.url)];await Promise.all(a);const{DotScreenPass:c}=await a[0];this.DotScreenPass=c}},async initialize(){if(this.pass==null){const a=new this.DotScreenPass;return this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[],toggle:deferred_renderer_pass_toggle},Technicolor:{name:TL$5("technicolor"),async preload(){if(this.TechnicolorShader==null){const a=[__vitePreload(()=>import("./TechnicolorShader@DQqnUeVc.js"),[],import.meta.url)];await Promise.all(a);const{TechnicolorShader:c}=await a[0];this.TechnicolorShader=c}},async initialize(){if(this.pass==null){const a=new ShaderPass(this.TechnicolorShader);return this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[],toggle:deferred_renderer_pass_toggle},Halftone:{name:TL$5("halftone"),async preload(){if(this.Halftone==null){const a=[__vitePreload(()=>import("./HalftonePass@DGNnSRGu.js"),[],import.meta.url)];await Promise.all(a);const{HalftonePass:c}=await a[0];this.HalftonePass=c}},async initialize(){if(this.pass==null){const a=new this.HalftonePass;return this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[],toggle:deferred_renderer_pass_toggle},Glitch:{name:TL$5("glitch"),async preload(){if(this.Glitch==null){const a=[__vitePreload(()=>import("./GlitchPass@XRdZ3JKT.js"),[],import.meta.url)];await Promise.all(a);const{GlitchPass:c}=await a[0];this.GlitchPass=c}},async initialize(){if(this.pass==null){const a=new this.GlitchPass;return this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[],toggle:deferred_renderer_pass_toggle},Film:{name:TL$5("film"),async preload(){if(this.FilmPass==null){const a=[__vitePreload(()=>import("./FilmPass@CCos2mq6.js"),[],import.meta.url)];await Promise.all(a);const{FilmPass:c}=await a[0];this.FilmPass=c}},async initialize(){if(this.pass==null){const a=new this.FilmPass;return this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[],toggle:deferred_renderer_pass_toggle},LUT:{name:TL$5("lut"),async preload(){if(this.LUTPass==null){const a=[__vitePreload(()=>import("./LUTPass@Cis5h_qc.js"),[],import.meta.url),__vitePreload(()=>import("./LUTCubeLoader@DJaJYyAj.js"),[],import.meta.url),__vitePreload(()=>import("./LUT3dlLoader@CtudW5s0.js"),[],import.meta.url)];await Promise.all(a);const{LUTPass:c}=await a[0],{LUTCubeLoader:d}=await a[1],{LUT3dlLoader:u}=await a[2];this.LUTPass=c,this.LUTCubeLoader=d,this.LUT3dlLoader=u}},async initialize(){if(this.pass==null){const a=new this.LUTPass;return a.lut_key="Remy 24.CUBE",a.intensity=.5,a.LUTCubeLoader=this.LUTCubeLoader,a.LUT3dlLoader=this.LUT3dlLoader,this.pass=a,!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_pulldown",key:"File",values:Object.keys(r),get(){return this.pass.lut_key},set(a){const c=this,d=r[a];if(d)this.pass.lut=this.pass.use2DLut?d.texture:d.texture3D;else{const u=a,f=this.pass,m=()=>{/\.CUBE$/i.test(u)?new f.LUTCubeLoader().load("./ddd/luts/"+u,function(h){const _=r[u]=h;f.lut=f.use2DLut?_.texture:_.texture3D}):new f.LUT3dlLoader().load("./ddd/luts/"+u,function(h){console.log(h);const _=r[u]=h;f.lut=f.use2DLut?_.texture:_.texture3D})};window.external_io?window.PrepareFromSystemResource("./ddd/luts/"+u).then(m):m()}c.pass.lut_key=a}},{type:"make_toggle",key:"2D LUT",get(){return this.pass.use2DLut},set(a){this.pass.use2DLut=a}},{type:"make_key_value_with_slider",key:"Intensity",min:0,max:1,step:.01,get(){return this.pass.intensity},set(a){this.pass.intensity=Number(a)}}],toggle:deferred_renderer_pass_toggle},ColorFilters:{name:TL$5("color_filters"),async preload(){},async initialize(){if(this.pass==null){const a=new ColorFiltersPass(DMC.scene,DMC.camera);return a.color_filters_pass.material.defines.VIGNETTE=1,a.color_filters_pass.material.defines.CONTRAST=0,a.color_filters_pass.material.defines.POWER=0,a.color_filters_pass.material.defines.EXPOSURE=0,a.color_filters_pass.uniforms.contrast.value=5.3,a.color_filters_pass.uniforms.exposure.value=1,a.color_filters_pass.uniforms.power.value=1.05,a.color_filters_pass.uniforms.vignette_intensity.value=.5,this.pass=a,DMC.setBlackout=c=>{a.color_filters_pass.uniforms.blackout.value=c},!0}return!1},order:o++,pass:null,value:!0,sub_params:[{type:"make_pulldown",key:"ToneMapping",values:[{key:"None",value:0},{key:"Uncharted2",value:1},{key:"Reinhard",value:2},{key:"Filmic",value:3},{key:"ACESFilm",value:4},{key:"AgX",value:5}],get(){return this.pass.color_filters_pass.material.defines.TONE_MAPPING_O},set(a){this.pass.color_filters_pass.material.defines.TONE_MAPPING_O=Number(a),this.pass.compile()}},{type:"make_toggle",key:"Vignette",get(){return this.pass.color_filters_pass.material.defines.VIGNETTE==1},set(a){this.pass.color_filters_pass.material.defines.VIGNETTE=a?1:0,this.pass.compile()}},{type:"make_key_value_with_slider",key:"VignetteIntensity",min:0,max:1,step:.01,get(){return this.pass.color_filters_pass.uniforms.vignette_intensity.value},set(a){this.pass.color_filters_pass.uniforms.vignette_intensity.value=Number(a)}},{type:"make_toggle",key:"FilmGrain",get(){return this.pass.color_filters_pass.material.defines.FILM_GRAIN==1},set(a){this.pass.color_filters_pass.material.defines.FILM_GRAIN=a?1:0,this.pass.compile()}},{type:"make_toggle",key:"EnableContrast",get(){return this.pass.color_filters_pass.material.defines.CONTRAST==1},set(a){this.pass.color_filters_pass.material.defines.CONTRAST=a?1:0,this.pass.compile()}},{type:"make_key_value_with_slider",key:"Contrast",min:0,max:10,step:.01,get(){return this.pass.color_filters_pass.uniforms.contrast.value},set(a){this.pass.color_filters_pass.uniforms.contrast.value=Number(a)}},{type:"make_toggle",key:"EnableExposure",get(){return this.pass.color_filters_pass.material.defines.EXPOSURE==1},set(a){this.pass.color_filters_pass.material.defines.EXPOSURE=a?1:0,this.pass.compile()}},{type:"make_key_value_with_slider",key:"Exposure",min:0,max:10,step:.01,get(){return this.pass.color_filters_pass.uniforms.exposure.value},set(a){this.pass.color_filters_pass.uniforms.exposure.value=Number(a)}},{type:"make_toggle",key:"EnablePower",get(){return this.pass.color_filters_pass.material.defines.POWER==1},set(a){this.pass.color_filters_pass.material.defines.POWER=a?1:0,this.pass.compile()}},{type:"make_key_value_with_slider",key:"Power",min:0,max:2,step:.01,get(){return this.pass.color_filters_pass.uniforms.power.value},set(a){this.pass.color_filters_pass.uniforms.power.value=Number(a)}},{type:"make_pulldown",key:"Encoding",values:[{key:"NoColorSpace",value:0},{key:"SRGBColorSpace",value:1}],get(){return this.pass.color_filters_pass.material.defines.sRGB_ENCODING},set(a){this.pass.color_filters_pass.material.defines.sRGB_ENCODING=Number(a),this.pass.compile()}},{type:"make_button",key:"Default",value:"Reset",onclick(){const a=DMC.render_passes.ColorFilters.sub_components;a.ToneMapping.update(4),a.EnablePower.update(!0),a.FilmGrain.update(!0),a.Vignette.update(!0),a.EnableContrast.update(!0),a.EnableExposure.update(!0),a.VignetteIntensity.update(.5),a.Contrast.update(5.3),a.Exposure.update(1.05),a.Power.update(1.05),a.Encoding.update(1)}},{type:"make_pulldown",key:TL$5("preset"),values:[{key:" - "+TL$5("select")+" - ",value:0},{key:"No Effect",value:1},{key:"Middle",value:2},{key:"Deep",value:3}],get(){return 0},set(a){const c=DMC.render_passes.ColorFilters.sub_components;a==1?(c.ToneMapping.update(4),c.EnablePower.update(!1),c.FilmGrain.update(!1),c.Vignette.update(!1),c.EnableContrast.update(!1),c.EnableExposure.update(!1),c.VignetteIntensity.update(.5),c.Contrast.update(5.3),c.Exposure.update(1.05),c.Power.update(1.05),c.Encoding.update(1)):a==2?(c.ToneMapping.update(4),c.EnablePower.update(!0),c.FilmGrain.update(!1),c.Vignette.update(!1),c.EnableContrast.update(!0),c.EnableExposure.update(!0),c.VignetteIntensity.update(.5),c.Contrast.update(5.3),c.Exposure.update(1.05),c.Power.update(1.05),c.Encoding.update(1)):a==3&&(c.ToneMapping.update(4),c.EnablePower.update(!0),c.FilmGrain.update(!0),c.Vignette.update(!0),c.EnableContrast.update(!0),c.EnableExposure.update(!0),c.VignetteIntensity.update(.5),c.Contrast.update(5.7),c.Exposure.update(1),c.Power.update(1.2),c.Encoding.update(1))}}],toggle:deferred_renderer_pass_toggle},OutlinePass:{name:TL$5("outline_pass"),async preload(){},async initialize(){if(this.pass==null){const{OutlinePass:a}=await __vitePreload(()=>import("./OutlinePass@B1OyCB37.js"),[],import.meta.url),c=new a(new Vector2(e,i),DMC.scene,DMC.camera);return DMC.selectObject=function(d){c.selectedObjects=[],d?.traverse?.(u=>{u?.isMesh&&c.selectedObjects.push(u)})},c.visibleEdgeColor.setHex(16768256),c.hiddenEdgeColor.setHex(475136),c.edgeStrength=3,c.edgeGlow=0,c.edgeThickness=1,c.pulsePeriod=0,this.pass=c,!0}return!1},order:o++,pass:null,value:!0,sub_params:[{type:"make_color_picker",key:"visibleEdgeColor",get(){return"#"+this.pass.visibleEdgeColor.getHex().toString(16).padStart(6,"0")},set(a){this.pass.visibleEdgeColor.setHex(a)}},{type:"make_color_picker",key:"hiddenEdgeColor",get(){return"#"+this.pass.hiddenEdgeColor.getHex().toString(16).padStart(6,"0")},set(a){this.pass.hiddenEdgeColor.setHex(a)}},{type:"make_key_value_with_slider",key:"edgeStrength",min:0,max:5,step:.01,get(){return this.pass.edgeStrength},set(a){this.pass.edgeStrength=Number(a)}},{type:"make_key_value_with_slider",key:"edgeGlow",min:0,max:3,step:.01,get(){return this.pass.edgeGlow},set(a){this.pass.edgeGlow=Number(a)}},{type:"make_key_value_with_slider",key:"edgeThickness",min:0,max:5,step:.01,get(){return this.pass.edgeThickness},set(a){this.pass.edgeThickness=Number(a)}},{type:"make_key_value_with_slider",key:"pulsePeriod",min:0,max:1,step:.01,get(){return this.pass.pulsePeriod},set(a){this.pass.pulsePeriod=Number(a)}}],toggle:deferred_renderer_pass_toggle},FXAA:{name:TL$5("fxaa"),async preload(){if(this.FXAAShader==null){const a=[__vitePreload(()=>import("./FXAAShader@9iU-ryRt.js"),[],import.meta.url)];await Promise.all(a);const{FXAAShader:c}=await a[0];this.FXAAShader=c}},async initialize(){if(this.pass==null){const a=new ShaderPass(this.FXAAShader),c=DMC.base_renderer.getPixelRatio();return a.pixelRatio=c,a.uniforms.resolution.value.x=1/(e*c),a.uniforms.resolution.value.y=1/(i*c),this.pass=a,!0}return!1},order:o++,pass:null,value:!1,toggle:deferred_renderer_pass_toggle,sub_params:[],setSize(a,c){if(this.pass){const d=this.pass,u=DMC.base_renderer.getPixelRatio();d.pixelRatio=u,d.uniforms.resolution.value.x=1/(a*u),d.uniforms.resolution.value.y=1/(c*u)}}},LensDistortion:{name:TL$5("lens_distortion"),async preload(){this.LensDistortionShader==null&&(this.LensDistortionShader=LensDistortionShader)},async initialize(){if(this.pass==null){const a=this.LensDistortionShader;class c extends ShaderPass{constructor(f){super(a,f),this.material.defines.BAND_MODE=2,this.material.defines.CHROMA_SAMPLES=13,this.uniforms.baseIor.value=.98,this.material.uniforms.bandOffset.value=.0015,this.material.uniforms.jitterOffset.value=0,this.material.uniforms.jitterIntensity.value=1,this.material.defines.BAND_MODE=2,this.material.needsUpdate=!0}render(f,m,h){super.render(f,m,h),d.material.uniforms.jitterOffset.value+=.01}compile(){this.material.needsUpdate=!0}}const d=new c;return this.pass=d,!0}return!1},order:o++,pass:null,value:!0,sub_params:[{type:"make_pulldown",key:"BAND_MODE",values:[{key:"NONE",value:0},{key:"RGB",value:1},{key:"RYGCBV",value:2}],get(){return this.pass.material.defines.BAND_MODE},set(a){this.pass.material.defines.BAND_MODE=Number(a),this.pass.compile()}},{type:"make_key_value_with_slider",key:"CHROMA_SAMPLES",min:0,max:100,step:1,get(){return this.pass.material.defines.CHROMA_SAMPLES},set(a){this.pass.material.defines.CHROMA_SAMPLES=Number(a),this.pass.material.needsUpdate=!0}},{type:"make_key_value_with_slider",key:"BaseIor",min:.97,max:1,step:.001,get(){return this.pass.uniforms.baseIor.value},set(a){this.pass.uniforms.baseIor.value=Number(a)}},{type:"make_key_value_with_slider",key:"BandOffset",min:0,max:.01,step:1e-4,get(){return this.pass.material.uniforms.bandOffset.value},set(a){this.pass.material.uniforms.bandOffset.value=Number(a)}},{type:"make_key_value_with_slider",key:"JitterIntensity",min:0,max:1,step:.01,get(){return this.pass.material.uniforms.jitterIntensity.value},set(a){this.pass.material.uniforms.jitterIntensity.value=Number(a)}}],toggle:deferred_renderer_pass_toggle},Sharpness:{name:TL$5("sharpness"),async preload(){const a={uniforms:{tDiffuse:{type:"t",value:null},width:{type:"f",value:0},height:{type:"f",value:0},rate:{type:"f",value:.125},kernel:{type:"fv1",value:[-.5,-1,-.5,-1,7,-1,-.5,-1,-.5]}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float width;","uniform float height;","uniform float rate;","uniform float kernel[9];","void main(void)","{","float step_w = 1.0/width;","float step_h = 1.0/height;","vec2 offset[9];","offset[0] = vec2(-step_w, -step_h);","offset[1] = vec2(0.0, -step_h);","offset[2] = vec2(step_w, -step_h);","offset[3] = vec2(-step_w, 0.0);","offset[4] = vec2(0.0, 0.0);","offset[5] = vec2(step_w, 0.0);","offset[6] = vec2(-step_w, step_h);","offset[7] = vec2(0.0, step_h);","offset[8] = vec2(step_w, step_h);","vec4 sum = vec4(0.0);","for( int i=0; i<9; i++ )","sum += texture2D(tDiffuse, vUv + offset[i]) * kernel[i];","gl_FragColor = mix(texture2D(tDiffuse, vUv), sum,rate);","}"].join(`
`)};this.sharpenShader=a},async initialize(){if(this.pass==null){const a=new ShaderPass(this.sharpenShader);return this.pass=a,this.pass.setSize=function(c,d){this.material.uniforms.width.value=c,this.material.uniforms.height.value=d},!0}return!1},order:o++,pass:null,value:!1,sub_params:[{type:"make_key_value_with_slider",key:"Rate",min:0,max:1,step:.01,get(){return this.pass.uniforms.rate.value},set(a){this.pass.uniforms.rate.value=Number(a)}}],toggle:deferred_renderer_pass_toggle}};for(const a in R)R[a].name=R[a].name??a;if((await GetSystemPreferences({}))?.ui?.renderer_flags?.renderer=="Deferred")for(const a in R)R[a].value&&window.__init_promises__.push(R[a].preload())}init_render_passes();async function UI_GraphicsPanel(){const s=DMC,e=s.ui.renderer_flags;s.canvas,s.render_passes=R,s.deferred_renderer_pass_toggle=deferred_renderer_pass_toggle;{const i=document.createElement("div");i.id="render_panel",await RenderingPipeline({div:i,flags:e}),i.appendChild(padding()),await Environment({div:i,flags:e}),i.appendChild(padding()),ShadowMap({div:i,flags:e}),i.appendChild(padding()),i.appendChild(padding());const r=document.getElementById("right_side_panel_tab_graphics");r&&(r.style.marginBottom="20px",r.appendChild(i))}}async function Environment(s){const e=DMC,i=s.div,r=s.flags;{const a=UC$1.make_toggle_window(i,{title:TL$5("environment_map"),toggle:r.environment_map_window==null?!0:r.environment_map_window},d=>{r.environment_map_window=d}).holder;async function c(){a.innerHTML="";{let m=function(){u.style.display=f.style.display=d.style.display="none";const w=r.environment_map.type;w=="Static"?u.style.display="block":w=="Dynamic"?f.style.display="block":d.style.display="block"},_=function(w){e.environment_map_manager.__compatibility_processing__();let y=1;r.environment_map.clear_alpha!=null?e.base_renderer.setClearAlpha(r.environment_map.clear_alpha):(y=e.base_renderer.getClearAlpha(),r.environment_map.clear_alpha=y);let M=new Color;r.environment_map.clear_color!=null?(M.setHex(r.environment_map.clear_color),e.base_renderer.setClearColor(M,r.environment_map.clear_alpha)):(e.base_renderer.getClearColor(M),r.environment_map.clear_color=M.getHex());const S=document.createElement("div");let D=null,k=null;w.appendChild(document.createElement("br")),UC$1.make_toggle(w,TL$5("background"),r.environment_map.background??!0,{},L=>{r.environment_map.background=L,e.environment_map_manager.needsUpdateForDynamicMap=!0,e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{}),r.environment_map.background?(S.style.display="none",D.element.style.display="flex",k.element.style.display="flex"):(S.style.display="flex",D.element.style.display="none",k.element.style.display="none")});function O(L){return"#"+L.toString(16).padStart(6,"0")}UC$1.make_key_value_with_slider(S,"Clear Alpha",r.environment_map.clear_alpha,{},L=>{e.base_renderer.setClearAlpha(L),r.environment_map.clear_alpha=L}),UC$1.make_color_picker(S,"Clear Color",O(r.environment_map.clear_color),L=>{const P=new Color;P.setHex(L),r.environment_map.clear_color=P.getHex(),e.base_renderer.setClearColor(P,r.environment_map.clear_alpha)}),UC$1.make_color_picker(S,"DOM Color",O(r.environment_map.dom_color),L=>{const P=new Color;P.setHex(L),r.environment_map.dom_color=P.getHex();const N=document.getElementById("main_frame");N&&(N.style.backgroundColor=O(r.environment_map.dom_color))}),w.appendChild(S),D=UC$1.make_color_picker(w,TL$5("background_color"),O(r.environment_map.background_color),L=>{e.scene.background instanceof Color&&e.scene.background.setHex(L);const P=new Color;P.setHex(L),r.environment_map.background_color=P.getHex()}),k=UC$1.make_key_value_with_slider(w,TL$5("background_blur"),e.scene.backgroundBlurriness,{min:0,max:1,step:.01},L=>{e.scene.backgroundBlurriness=L}),r.environment_map.background?(S.style.display="none",D.element.style.display="flex",k.element.style.display="flex"):(S.style.display="flex",D.element.style.display="none",k.element.style.display="none"),e.scene.fog&&(w.appendChild(document.createElement("br")),UC$1.make_key_value_with_slider(w,TL$5("fog_density"),e.scene.fog.density,{min:0,max:.005,step:.005/100},L=>{r.environment_map.fog_density=e.scene.fog.density=L}),UC$1.make_color_picker(w,TL$5("fog_color"),O(r.environment_map.fog_color),L=>{e.scene.fog.color.setHex(L),r.environment_map.fog_color=e.scene.fog.color.getHex()}),w.appendChild(document.createElement("br")),UC$1.make_button(w,TL$5("background_to_fog"),"Sync",null,()=>{e.scene.background instanceof Color&&(e.scene.fog.color.copy(e.scene.background),r.environment_map.fog_color=e.scene.fog.color.getHex(),c())}),UC$1.make_button(w,TL$5("fog_to_background"),"Sync",null,()=>{e.scene.background instanceof Color&&(e.scene.background.copy(e.scene.fog.color),r.environment_map.background_color=e.scene.fog.color.getHex(),c())}))},b=function(){const w=[{key:"royal_esplanade_1k.hdr",value:"royal_esplanade_1k.hdr"},{key:"spot1Lux.hdr",value:"spot1Lux.hdr"},{key:"venice_sunset_1k.hdr",value:"venice_sunset_1k.hdr"}],y=C$2.clone(w);r.environment_map.is_system_resource=!1,r.environment_map.file&&y.push({key:r.environment_map.file.split("/").pop(),value:r.environment_map.file});for(const S of w)S.value==r.environment_map.file&&(r.environment_map.is_system_resource=!0);let M=document.getElementById("__envmap_selector_wrapper__");M==null&&(M=document.createElement("div"),M.id="__envmap_selector_wrapper__",u.appendChild(M)),M.innerHTML="",UC$1.make_pulldown(M,"File",y,r.environment_map.file,{},async S=>{r.environment_map.file=S;for(const D of w)D.value==r.environment_map.file&&(r.environment_map.is_system_resource=!0);e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{})})};const d=document.createElement("div"),u=document.createElement("div"),f=document.createElement("div"),h=UC$1.make_pulldown(a,TL$5("env_type"),[{key:TL$5("env_none"),value:"None"},{key:TL$5("env_static"),value:"Static"},{key:TL$5("env_dynamic"),value:"Dynamic"}],r.environment_map.type,{},async w=>{if(r.environment_map.type=w,m(),w=="Dynamic"&&(r.environment_map.background_color=0),r.environment_map.type=="Dynamic")e.scene.add(e.environment_map_center_helper_object);else try{e.scene.remove(e.environment_map_center_helper_object)}catch(y){console.log(y)}await e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{})});m(),e.environment_type_component=h,a.appendChild(d),a.appendChild(u),a.appendChild(f);{if(e.environment_map_center_helper_object==null){let k=function(V){V.castDynamicEnvironment=!1,V.receiveShadow=!1,V.alphaTest=0,V.blending=NormalBlending,V.alphaToCoverage=!1,V.premultipliedAlpha=!1,V.transparent=!0,V.color.set(0,0,0),V.roughness=0,V.reflectivity=1,V.opacity=0};const M=new MeshPhysicalMaterial,S=new Mesh(new SphereGeometry(3,50,50),M),D=window.BindObjectAsDDD(S,{type:"sphere",kind:"object"});D.scale.set(.25,.25,.25),D.position.copy(e.environment_map_manager.getCenterPosition()),D.visible=!1,D.castShadow=!1,D.receiveShadow=!1,k(D.material);const O=D.getDDDProperties();O.type="dynamic_env_helper",O.removable=!1,O.restore=!0,D.name="DynamicEnvHelper",D.position.copy(e.environment_map_manager.getCenterPosition());let L=D.position.x,P=D.position.y,N=D.position.z,z=!1,K=0,Z=performance.now();D.user.update=V=>{const H=D.position,Y=e.current.object==D;if(z==!1&&Y)K=2,e.environment_map_center_helper_object.material.opacity=1,e.environment_map_center_helper_object.material.visible=!0,e.environment_map_center_helper_object.visible=!0;else if(L==H.x&&P==H.y&&N==H.z){if(e.current.object!=D){const q=D.material,J=performance.now(),W=(J-Z)/500;if(Z=J,K=K-W,K=K<0?0:K,K<=0){let te=q.opacity;const ie=q.visible;te=te-W,te=te<0?0:te,ie==!1||(te==0&&ie==!0?(q.visible=!1,D.visible=!1):q.opacity=te)}}}else K=2,e.environment_map_center_helper_object.material.opacity=1,e.environment_map_center_helper_object.material.visible=!0,e.environment_map_center_helper_object.visible=!0,L=H.x,P=H.y,N=H.z;z=Y},e.environment_map_center_helper_object=D,r.environment_map.type=="Dynamic"&&e.scene.add(e.environment_map_center_helper_object)}const w=(M,S)=>{const D=e.current.camera||e.camera,k=e.environment_map_manager.getCenterPosition(),O=new Vector3,L=new Vector3,P=new Vector3,N=new Vector3(0,1,0);P.copy(D.position),P.sub(k),P.normalize(),P.cross(N),P.normalize(),O.copy(k),O.project(D),L.copy(k),L.add(P),L.project(D),L.sub(O);const z=e.base_renderer.domElement.width;e.base_renderer.domElement.height;const K=Math.max(1/Math.abs(z*L.x)*10,.1);return e.environment_map_center_helper_object.position.copy(e.environment_map_manager.getCenterPosition()),M+K*S},y=UC$1.make_vec3_box(f,T("g.position"),e.environment_map_manager.getCenterPosition(),1,{step:10,camera_step:!0,operator:w},M=>{e.environment_map_manager.setCenterPositionX(M)},M=>{e.environment_map_manager.setCenterPositionY(M)},M=>{e.environment_map_manager.setCenterPositionZ(M)});e.setEventListener("change@geometry@denv",function(M){y?.set(e.environment_map_center_helper_object.position),e.environment_map_manager.setCenterPosition(e.environment_map_center_helper_object.position)})}_(a),UC$1.make_toggle(f,"SharedCast",r.environment_map.dynamic_cube_map_shared_cast==null?!0:r.environment_map.dynamic_cube_map_shared_cast,{},w=>{r.environment_map.dynamic_cube_map_shared_cast=w,e.environment_map_manager.needsUpdateForDynamicMap=!0,e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{})}),UC$1.make_pulldown(f,"UpdateMode",[{key:"Always",value:"0"},{key:"Manual",value:"1"},{key:"Auto",value:"2"}],String(r.environment_map.dynamic_cube_map_update_mode==null?0:r.environment_map.dynamic_cube_map_update_mode),{},async w=>{r.environment_map.dynamic_cube_map_update_mode=Number(w),e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{})}),r.environment_map.dynamic_cube_map_num_of_reflection=r.environment_map.dynamic_cube_map_num_of_reflection==null?1:r.environment_map.dynamic_cube_map_num_of_reflection,UC$1.make_key_value_with_slider(f,"Num of Reflection",r.environment_map.dynamic_cube_map_num_of_reflection,{min:0,max:3,step:1},w=>{r.environment_map.dynamic_cube_map_num_of_reflection=w,e.environment_map_manager.needsUpdateForDynamicMap=!0,e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{})}),UC$1.make_pulldown(f,"Resolution",["32","64","128","256","512","1024","2048","4096"],r.environment_map.resolution===void 0?"32":String(r.environment_map.resolution),{},async w=>{e.environment_map_manager.resolution=r.environment_map.resolution=Number(w),C$2.modal_processing("Recompiling...."),setTimeout(()=>{e.environment_map_manager.recreate_buffer(),e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{}),C$2.close_modal_processing()},100)}),UC$1.make_button(f,"ManualUpdate","Update",{value_css:{width:"100px"}},()=>{e.environment_map_manager.needsUpdateForDynamicMap=!0,e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{})}),UC$1.make_button(f,"Make Static EnvMap","Download",{value_css:{width:"100px"}},async()=>{await e.environment_map_manager.create_cube_map_file()}),b();const v=document.createElement("div");v.style.display="flex",v.style.width="100%",v.style.height="40px",v.style.fontSize="13px",v.style.alignItems="center",v.style.justifyContent="center",v.style.whiteSpace="nowrap",v.style.overflow="hidden",v.innerText=T("g.drag_and_drop_here"),UC$1.make_drag_and_drop(v,{file:!0,directory:!0,recursive:!1},w=>{if(w.item){if(console.log(w.item),w.direct)r.environment_map.file=w.item;else throw new Error("Not impelementated yet.");r.environment_map.is_system_resource=!1,e.environment_map_manager.apply_environment_map(),e.dispatchEvent("change@scene",{}),b()}}),u.appendChild(v)}e.environment_map_manager.apply_environment_map()}await c()}function o(l){debug&&console.log("Update env map"),e.environment_map_manager.update_dynamic_map(),e.scene.traverse(a=>{a instanceof LightProbe&&a.updateProbe?.()})}e.removeEventListener("update@dynamic_env_map",o),e.addEventListener("update@dynamic_env_map",o)}function ShadowMap(s){const e=DMC,i=s.div,r=s.flags;{const l=UC$1.make_toggle_window(i,{title:TL$5("shadow_map"),toggle:r.shadow_env_window==null?!0:r.shadow_env_window},f=>{r.shadow_env_window=f}).holder;r.csm=r.csm??{light:{shadow:{camera:{}}}};async function a(){e.csm&&(e.csm.remove(),e.csm.dispose(),e.csm=null);const f=[];e.scene.traverse(m=>{m.isCSMLight?f.push(m):m instanceof DirectionalLight&&(m.visible=!0)});for(const m of f)await Builder3D.remove_object(m)}async function c(f){f.holder.innerHTML="",window.lock_rendering();function m(b,v){const w={};w.each=y=>v.forEach(M=>y(M)),w.filter=v.filter,w.map=v.map;for(const y in b)Object.defineProperty(w,y,{get:function(){return b[y]},set:function(M){v.forEach(S=>{S[y]!==void 0&&(S[y]=M)})}});return w}function h(b){if(b){let v=!1;b.traverse(w=>{if(w.material)if(Array.isArray(w.material))for(let y=0;y<w.material.length;y++)w.material[y].castDynamicEnvironment&&(v=!0);else w.material.castDynamicEnvironment&&(v=!0)}),b.isLight&&(v=!0),v&&DMC.dispatchEvent("update@dynamic_env_map")}}if(e.csm==null){let w=function(D){if(D==null)return;const k=e.csm,O=D.position.clone(),L=D.target.position.clone();L.sub(O),L.normalize(),k.lightDirection.copy(L),r.csm.light.intensity=D.intensity,r.csm.light.color=D.color.getHex(),r.csm.light.direction=L;for(let P=0;P<k.lights.length;P++)k.lights[P].name=`CSMLight(${P})`,k.lights[P].target.name=`CSMLightTg(${P})`,k.lights[P].shadow.camera.near=r.csm.light.shadow.camera.near,k.lights[P].shadow.camera.far=r.csm.light.shadow.camera.far,k.lights[P].intensity=D.intensity,k.lights[P].color.copy(D.color),k.lights[P].shadow.camera.updateProjectionMatrix()};const{CSM:b}=await __vitePreload(()=>import("./CSM@yQX4v84e.js"),[],import.meta.url);let v=null;e.scene.traverse(D=>{D instanceof DirectionalLight&&(D.isCSMLight||(v=D,D.visible=!1))}),window.lock_rendering();let y=e.scene.find("CSMGroup",!0);if(y==null&&(y=new Group,e.scene.add(y)),y.name="CSMGroup",r.csm.light.direction){const D=new Vector3;D.copy(r.csm.light.direction),r.csm.light.direction=D}r.csm.maxFar=r.csm.maxFar??500,r.csm.cascades=r.csm.cascades??3,r.csm.fade=r.csm.fade??!0,r.csm.mode=r.csm.mode??"practical",r.csm.lightMargin=r.csm.lightMargin??100,r.csm.light.intensity=r.csm.light.intensity??1,r.csm.light.direction=r.csm.light.direction??new Vector3(-1,-1,-1).normalize(),r.csm.light.shadow.size=r.csm.light.shadow.size??1024,r.csm.light.shadow.camera.near=r.csm.light.shadow.camera.near??1,r.csm.light.shadow.camera.far=r.csm.light.shadow.camera.far??1e3,r.csm.light.shadow.bias=r.csm.light.shadow.bias??-15e-5,r.csm.light.shadow.normalBias=r.csm.light.shadow.normalBias??.1,r.csm.light.color=r.csm.light.color??16777215;const M=e.csm=new b({maxFar:r.csm.maxFar,cascades:r.csm.cascades,fade:r.csm.fade,mode:r.csm.mode,parent:y,lightMargin:r.csm.lightMargin,shadowMapSize:r.csm.light.shadow.size,shadowBias:r.csm.light.shadow.bias,normalBias:r.csm.light.shadow.normalBias,lightNear:r.csm.light.shadow.camera.near,lightFar:r.csm.light.shadow.camera.far,lightDirection:r.csm.light.direction,lightIntensity:r.csm.light.intensity,camera:e.current.camera||e.camera});for(let D=0;D<M.lights.length;D++)M.lights[D].shadow.camera.near=r.csm.light.shadow.camera.near,M.lights[D].shadow.camera.far=r.csm.light.shadow.camera.far,M.lights[D].shadow.bias=r.csm.light.shadow.bias,M.lights[D].shadow.normalBias=r.csm.light.shadow.normalBias,M.lights[D].intensity=r.csm.light.intensity,M.lights[D].color.setHex(r.csm.light.color),M.lights[D].shadow.camera.updateProjectionMatrix(),M.lights[D].isCSMLight=!0,M.lights[D].target.isCSMLight=!0;w(v),e.setEventListener("copy@cascaded_shadow_map_light",D=>{const k=D.light;k&&(w(k),c(f))});const S=e.getMaterials().filter(D=>D.receiveShadow!==void 0&&D instanceof MeshPhysicalMaterial);for(const D of S)e.csm.setupMaterial(D);e.needsPrecompile=!0,e.dispatchEvent("change@scene",{object:y,auto_focus:!1}),window.unlock_rendering()}const _=e.csm;{let y=function(){setTimeout(async()=>{r.cascade_shadow_map=!1,await a();const M=e.scene.find("CSMGroup");M&&e.scene.remove(M),setTimeout(async()=>{r.cascade_shadow_map=!0,await c(f)},1)},1)};const b=_.lights[0],v=m(b,_.lights),w=f.holder;_.mode!==void 0&&UC$1.make_pulldown(w,"Mode",["practical","logarithmic","uniform","custom"],r.csm.mode,{value_css:{maxWidth:"100px",width:"100px"}},async M=>{r.csm.mode=_.mode=M,_.updateFrustums()}),UC$1.make_pulldown(w,"Resolution",["512","1024","2048","4096","8192","16384"],String(r.csm.light.shadow.size),{value_css:{maxWidth:"100px",width:"100px"}},async M=>{const S=Number(M);r.csm.light.shadow.size=S,_.shadowMapSize=S,y(),h(b)}),UC$1.make_pulldown(w,"Cascades",["2","3","4","5","6","7","8"],String(_.cascades),{value_css:{maxWidth:"100px",width:"100px"}},async M=>{M=Number(M),_.cascades=M,r.csm.cascades=M,y(),h(b)}),UC$1.make_key_value_with_slider(w,"Max Far",r.csm.maxFar,{min:100,max:1e3},M=>{r.csm.maxFar=M,_.maxFar=M,_.updateFrustums(),h(b)}),UC$1.make_toggle(w,"Fade",r.csm.fade,{},M=>{r.csm.fade=_.fade=M,_.updateFrustums(),h(b)}),UC$1.make_color_picker(w,"Light Color","#"+r.csm.light.color.toString(16).padStart(6,"0"),M=>{r.csm.light.color=M,v.each(S=>{S.color?.setHex?.(M),h(b)}),h(b)}),UC$1.make_float_box(w,"Light Intensity",r.csm.light.intensity,{step:.01,min:0,max:1e3,operator:(M,S)=>M+Math.pow(M<.001?.001:M,.5)/10*S},M=>{r.csm.light.intensity=M,v.intensity=M,h(b),h(b)}),UC$1.make_key_value_with_slider(w,"LightMargin",r.csm.lightMargin,{min:0,max:200},M=>{r.csm.lightMargin=M,_.lightMargin=M,h(b)}),UC$1.make_float_box(w,"Light Near",r.csm.light.shadow.camera.near,{step:.01},M=>{r.csm.light.shadow.camera.near=M,_.lightNear=M,h(b)}),UC$1.make_float_box(w,"Light Far",r.csm.light.shadow.camera.far,{step:1},M=>{r.csm.light.shadow.camera.far=M,_.lightFar=M,h(b)}),UC$1.make_float_box(w,"Shadow Bias",r.csm.light.shadow.bias,{step:1e-5,precision:5},M=>{r.csm.light.shadow.bias=M,_.shadowBias=M,h(b)}),UC$1.make_float_box(w,"Shadow Normal Bias",r.csm.light.shadow.normalBias,{step:.01,precision:2},M=>{r.csm.light.shadow.normalBias=M,_.shadowNormalBias=M,h(b)}),UC$1.make_button(w,"","Update",{},()=>{y()})}window.unlock_rendering()}window.debug&&console.log("ShadowMapType:",r.shadowMap_type);const d=UC$1.make_pulldown(l,TL$5("shadow_map_type"),[{key:TL$5("none"),value:null},{key:"BasicShadowMap",value:BasicShadowMap},{key:"PCFShadowMap",value:PCFShadowMap},{key:"PCFSoftShadowMap",value:PCFSoftShadowMap},{key:"VSMShadowMap",value:VSMShadowMap}],r.shadowMap_type??null,{},async f=>{r.shadowMap_type=f,e.apply_shadow_map(f),e.update_material()});d.modifier.value,d.update();const u=UC$1.make_toggle_holder(l,TL$5("cascaded_shadow_maps"),r.cascade_shadow_map==!0,{},async f=>{r.cascade_shadow_map=f,f?e.csm||await c(u):(await a(),e.removeEventListener("copy@cascaded_shadow_map_light"))});e.enable_cascade_shadow_map=function(f){u.update(f)},r.cascade_shadow_map&&c(u),e.addEventListener("change@scene",async f=>{if(r.cascade_shadow_map){if(window.lock_rendering(),e.csm){const m=e.getMaterials().filter(h=>h.receiveShadow!==void 0&&h instanceof MeshPhysicalMaterial);for(const h of m)e.csm.setupMaterial(h);e.needsPrecompile=!0}window.unlock_rendering()}}),UC$1.make_toggle(l,"🧪 "+TL$5("progressive_shadow_map"),!!r.enabled_progressive_surface_map,{},f=>{r.enabled_progressive_surface_map=e.enabled_progressive_surface_map=f,f&&setTimeout(()=>{r.enabled_progressive_surface_map=e.enabled_progressive_surface_map=f,r.enabled_progressive_surface_map&&e.add_to_progressive_surfacemap&&e.add_to_progressive_surfacemap()},500)}).update()}}async function RenderingPipeline(s){const e=DMC,i=s.div,r=s.flags,o=UC$1.make_toggle_window(i,{title:TL$5("renderer"),toggle:r.render_pipeline_window??!0},u=>{r.render_pipeline_window=u}),l=o.holder;e.current.renderer_key=r.renderer,e.FPS_Compo=UC$1.make_pulldown(l,"FPS",[15,30,60,75,90,120,144,240,-1].map(u=>u.toString()),r.fps??-1,{},u=>{r.fps=Number(u)}),e.FPS_Compo.update(),UC$1.make_toggle(l,TL$5("retina_canvas"),r.use_retina,{},u=>{r.use_retina=u,window.dispatchEvent(new Event("resize")),console.log(r.use_retina,u),e.display_meta_information("Retina",`${r.use_retina?window.devicePixelRatio:"1.0"}`,"Retina"),C$2.modal_ok_cancel("Apply and Relaunch","Are you sure?",{},async f=>{f&&(await Builder3D.save_project(),e.reload())})}),window.app_mode||e.display_meta_information("Retina",`${r.use_retina?window.devicePixelRatio:"1.0"}`,"Retina"),UC$1.make_toggle(l,TL$5("alpha_buffer"),r.alpha??!0,{},u=>{r.alpha=u,C$2.modal_ok_cancel("Relaunch","This function is required to save and relaunch.<br>Are you sure?",{},async f=>{f&&(await Builder3D.save_project(),e.reload())})}),UC$1.make_toggle(l,TL$5("stencil_buffer"),r.stencil??!1,{},u=>{r.stencil=u,C$2.modal_ok_cancel("Relaunch","This function is required to save and relaunch.<br>Are you sure?",{},async f=>{f&&(await Builder3D.save_project(),e.reload())})}),UC$1.make_toggle(l,TL$5("logarithmic_depth_buffer"),r.logarithmicDepthBuffer??!0,{},u=>{r.logarithmicDepthBuffer=u,C$2.modal_ok_cancel("Relaunch","This function is required to save and relaunch.<br>Are you sure?",{},async f=>{f&&f&&(await Builder3D.save_project(),e.reload())})});{const u=document.getElementById("xr_button");if(u){u.style.display=e.scene.isXRMode?"flex":"none";const f=UC$1.make_toggle_holder(l,"WebXR",e.scene.isXRMode,{},async m=>{e.scene.isXRMode=m,m&&await e.initializeXRWithUI(),u.style.display=m?"flex":"none",e.xr?.showXRHugeButton?.()});UC$1.make_button(f.holder,"VR (x0.1)","Apply",{value_css:{width:"140px"}},async()=>{await C$2.modal_ok_cancel_promise("Scaling: Normal ⇨ VR Mode","Related object, camera, motion will be apply x0.1 ( 10cm → 1m ).<br>Do not apply this operation twice.<br>To revert it, please use the Non VR button.",{ok:"Apply"})&&e.xr.applyScaling(!0)}),UC$1.make_button(f.holder,"Non VR (x10)","Apply",{value_css:{width:"140px"}},async()=>{await C$2.modal_ok_cancel_promise("Scaling: VR ⇨ Normal Mode","Object, camera, motion will be reverted to original size. ( 1m → 10cm ).<br>Do not apply this operation twice.<br>To revert it, please use the Non VR button.",{ok:"Apply"})&&e.xr.applyScaling(!1)}),e.addEventListener("ready@main",m=>{f.update(e.scene.isXRMode)})}}{const u=document.createElement("div");u.style.cssText="width:100%;height:20px;background:#181818",l.appendChild(u)}const a={Forward:document.createElement("div"),Deferred:document.createElement("div"),PathTrace:document.createElement("div"),Toon:document.createElement("div")};function c(u){s.render_type=u,u=="Toon"||u=="Forward"?render_target_parameter_update_to_forward_default(s):u=="Deferred"&&render_target_parameter_update_to_default(s),e.dispatchEvent("renderer@graphics",{value:u}),e.needsPrecompile=!0}const d=UC$1.make_pulldown(l,TL$5("renderer"),[{key:T("g.forward_renderer"),value:"Forward"},{key:T("g.deferred_renderer"),value:"Deferred"},{key:T("g.toon_renderer"),value:"Toon"}],"Deferred",{key_css:{color:"#FFF"},value_css:{color:"#FA7"}},async(u,f)=>{e.current.renderer_key=r.renderer=u,c(u),await e.getRenderer().init();for(const _ in a)a[_].style.display="none";a[u].style.display="block",deferred_renderer_pass_toggle();const h=o.element.querySelector(".title");h&&(h.innerHTML=`${TL$5("renderer")} [&nbsp;<span style='color:#FA0'>${f.key}</span>&nbsp;]`),window.dispatchEvent(new Event("resize"))});e.renderer_selector=d;{const u=document.createElement("div");u.style.cssText="width:100%;height:20px;background:#181818",l.appendChild(u)}for(const u in a)l.appendChild(a[u]);d.setValue(r.renderer??"Deferred"),d.modifier.value!="Deferred"&&(e.main_is_ready3=!0);{const u=a.Toon=a.Forward;UC$1.make_toggle(u,"MSAA",r.antialias??!0,{},f=>{r.antialias=f,C$2.modal_ok_cancel("Relaunch","This function is required to save and relaunch.<br>Are you sure?",{},async m=>{m&&(await Builder3D.save_project(),e.reload())})})}{const u=a.Deferred,f=[];UC$1.make_button(u,TL$5("disable_all"),TL$5("disable"),{value_css:{width:"100px"}},()=>{for(const m of f)m.update(!1)}),UC$1.make_button(u,TL$5("reset_all"),TL$5("clear"),{value_css:{width:"100px"}},()=>{C$2.modal_ok_cancel("Relaunch","This function is required to save and relaunch.<br>Are you sure?",{},async m=>{m&&(r.render_passes={},await Builder3D.save_project(),e.reload())})});{let _=function(y,M){m[y].value!=M&&m[y].holder.update(M),M&&h.push(m[y])},v=function(y,M,S){m[y].sub_components[M].update(S)};const m=e.render_passes;let h=[];async function b(){const y=h.length;let M=0;for(;M!=y;){M=0;for(const S of h)S.pass&&M++;await C$2.sleep(20)}}const w=UC$1.make_pulldown(u,TL$5("preset"),[{key:" - Select - ",callback:async()=>{}},{key:"Cinema-Low",callback:async()=>{h=[];const y=["BaseRenderer","SMAA","SSAO","SSR","DoF","Bloom","MotionBlur","ColorFilters","LensDistortion"];for(const M in m)_(M,y.filter(S=>S==M).length>0);await b();{const M="LensDistortion";v(M,"BaseIor",.98),v(M,"BandOffset",.0015)}{const M="ColorFilters";v(M,"Contrast",6),v(M,"Power",1.1)}{const M="MotionBlur";v(M,"Samples",64),v(M,"Intensity",1)}}},{key:"Cinema-Middle",callback:async()=>{h=[];const y=["TAA","SAO","SSR","DoF","Bloom","MotionBlur","ColorFilters","LensDistortion"];for(const M in m)_(M,y.filter(S=>S==M).length>0);await b();{const M="LensDistortion";v(M,"BaseIor",.98),v(M,"BandOffset",.0015)}{const M="ColorFilters";v(M,"EnableContrast",!0),v(M,"EnablePower",!0),v(M,"Contrast",6),v(M,"Power",1.1)}v("TAA","TAA Sample Level",2);{const M="MotionBlur";v(M,"Samples",64),v(M,"Intensity",1)}}},{key:"Cinema-High",callback:async()=>{h=[];const y=["SSAA","SAO","SSR","DoF","Bloom","MotionBlur","ColorFilters","LensDistortion"];for(const M in m)_(M,y.filter(S=>S==M).length>0);await b();{const M="LensDistortion";v(M,"BaseIor",.98),v(M,"BandOffset",.0015)}{const M="ColorFilters";v(M,"EnableContrast",!0),v(M,"EnablePower",!0),v(M,"Contrast",6),v(M,"Power",1.1)}v("SSAA","Sample Level",3);{const M="MotionBlur";v(M,"Samples",64),v(M,"Intensity",1)}}},{key:"Toon",callback:async()=>{h=[];const y=["TAA","SAO","SSR","DoF","Bloom","MotionBlur","ColorFilters","LensDistortion"];for(const M in m)_(M,y.filter(S=>S==M).length>0);await b();{const M="TAA";v(M,"Outline",!0),v(M,"TAA Sample Level",2)}{const M="LensDistortion";v(M,"BaseIor",.98),v(M,"BandOffset",.0015)}{const M="ColorFilters";v(M,"EnableContrast",!0),v(M,"EnablePower",!0),v(M,"Exposure",1),v(M,"Contrast",5.7),v(M,"Power",1.2)}}}]," - Select - ",{},async(y,M)=>{M&&await M.callback(),setTimeout(()=>{w.modifier.value=" - Select - "},300)});UC$1.make_separator(u,{close:!1,sub:!0,title:TL$5("post_processing")})}for(const m in e.render_passes){const h=e.render_passes[m];h.sub_components={},r.render_passes[m]!==void 0?h.value=r.render_passes[m].value:r.render_passes[m]={value:h.value};const _=UC$1.make_toggle_holder(u,`${h.experimental?"🧪 ":""}${h.name}`,h.value,{},v=>{h.value=r.render_passes[m].value=v,h.toggle(),h.holder=_});f.push(_);const b=_.holder;if(h.sub_params&&h.sub_params.length>0){for(const v of h.sub_params){v.pass=h.pass,r.render_passes[m].sub==null&&(r.render_passes[m].sub={});const w=r.render_passes[m].sub[v.key];if(v.type=="make_key_value_with_slider"){const y=UC$1.make_key_value_with_slider(b,v.key,w,{min:v.min,max:v.max,step:v.step},M=>{r.render_passes[m].sub[v.key]=M,v.set(M)});y.sub=v,h.sub_components[v.key]=y}else if(v.type=="make_pulldown"){const y=UC$1.make_pulldown(b,v.key,v.values,w,{},M=>{r.render_passes[m].sub[v.key]=M,v.set(M)});y.sub=v,h.sub_components[v.key]=y}else if(v.type=="make_toggle"){const y=UC$1.make_toggle(b,v.key,w,{},M=>{r.render_passes[m].sub[v.key]=M,v.set(M)});y.sub=v,h.sub_components[v.key]=y}else if(v.type=="make_button")UC$1.make_button(b,v.key,v.value,null,()=>{v.onclick()});else if(v.type=="make_color_picker"){const y=UC$1.make_color_picker(b,v.key,w,M=>{v.set(M),r.render_passes[m].sub[v.key]=v.get()});y.sub=v,h.sub_components[v.key]=y}}h.update_components=function(){if(h.pass)for(const v in h.sub_components){const w=h.sub_components[v],y=r.render_passes[m]?.sub?.[v];w.update(y!==void 0?y:w.sub.get())}}}_.update(h.value)}deferred_renderer_pass_toggle()}}function render_target_parameter_update_to_default(s){const e=DMC;e.ui.renderer_flags;const i=e.base_renderer;i.toneMapping=NoToneMapping,i.outputColorSpace=LinearSRGBColorSpace,i.toneMappingExposure=1,i.needsUpdate=!0,RenderTargetAndTexture(s)}function render_target_parameter_update_to_forward_default(s){const e=DMC,i=e.ui.renderer_flags,r=e.base_renderer;i.toneMapping=r.toneMapping=i.toneMapping??ACESFilmicToneMapping,i.outputColorSpace=r.outputColorSpace=i.outputColorSpace??SRGBColorSpace,i.toneMappingExposure=r.toneMappingExposure=i.toneMappingExposure??1,r.needsUpdate=!0,RenderTargetAndTexture(s)}async function RenderTargetAndTexture(s){const e=DMC,i=s.div;let r=i.querySelector("#RenderTargetAndTexture");r?.remove(),r=document.createElement("div"),r.id="RenderTargetAndTexture",i.appendChild(r);const o=s.flags,l=e.base_renderer,a=[];e.apply_deferred_effect=()=>{for(const h of a)h()};const d=UC$1.make_toggle_window(r,{title:TL$5("render_target_and_texture"),toggle:o.rendar_target_texture_window==null?!0:o.rendar_target_texture_window},h=>{o.rendar_target_texture_window=h}).holder;s.render_type=="Forward"&&(UC$1.make_pulldown(d,"Tone Mapping",[{key:"NoToneMapping",value:NoToneMapping},{key:"LinearToneMapping",value:LinearToneMapping},{key:"ReinhardToneMapping",value:ReinhardToneMapping},{key:"CineonToneMapping",value:CineonToneMapping},{key:"ACESFilmicToneMapping",value:ACESFilmicToneMapping},{key:"AgXToneMapping",value:AgXToneMapping}],o.toneMapping==null?l.toneMapping:o.toneMapping,{},_=>{l.toneMapping=o.toneMapping=Number(_)}),UC$1.make_pulldown(d,"Encoding",[{key:"SRGBColorSpace",value:SRGBColorSpace},{key:"LinearSRGBColorSpace",value:LinearSRGBColorSpace}],o.outputColorSpace??l.outputColorSpace,{},_=>{e.current.renderer_key=="Forward"||e.current.renderer_key=="Toon",l.outputColorSpace=o.outputColorSpace=_}).update(),UC$1.make_key_value_with_slider(d,"Tone Mapping Exposure",o.toneMappingExposure==null?l.toneMappingExposure:o.toneMappingExposure,{min:0,max:4,step:.01},(_,b)=>{e.current.renderer_key=="Forward"||e.current.renderer_key=="Toon"?l.toneMappingExposure=o.toneMappingExposure=_:l.toneMappingExposure=_}));const u=[],f=Number(l.capabilities.getMaxAnisotropy()),m=8;o.anisotropy=o.anisotropy||(f>m?m:f),window.anisotropy=o.anisotropy;for(let h=1;h<=f;h=h<<1)u.push({key:`x${h}`,value:h});UC$1.make_pulldown(d,TL$5("anisotropy"),[...u],o.anisotropy,{},h=>{window.anisotropy=o.anisotropy=Number(h),console.log(`Changed:Anisotropy: x${window.anisotropy}`),C$2.modal_ok_cancel("Confirmation","This setting is required to relaunch.<br>Are you sure?",{},async _=>{_&&(await Builder3D.save_project(),e.reload())})}),UC$1.make_toggle(d,TL$5("use_legacy_lights"),o.useLegacyLights,{},async h=>{o.useLegacyLights=h,ColorManagement.enabled=!o.useLegacyLights,e.base_renderer.useLegacyLights=h}),a.push(()=>{e.apply_anisotropic_texture()})}const _raycaster=new Raycaster,_tempVector=new Vector3,_tempVector2=new Vector3,_tempQuaternion=new Quaternion,_unit={X:new Vector3(1,0,0),Y:new Vector3(0,1,0),Z:new Vector3(0,0,1)},_changeEvent={type:"change"},_mouseDownEvent={type:"mouseDown",mode:null},_mouseUpEvent={type:"mouseUp",mode:null},_objectChangeEvent={type:"objectChange"};class TransformControls extends Object3D{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none"}lazy_init(){if(this.already_init)return;const e=window.DMC.current.camera||window.DMC.camera;this.already_init=!0;const i=new TransformControlsGizmo;this._gizmo=i,this.add(i);const r=new TransformControlsPlane;this._plane=r,this.add(r);const o=this;function l(y,M){let S=M;Object.defineProperty(o,y,{get:function(){return S!==void 0?S:M},set:function(D){S!==D&&(S=D,r[y]=D,i[y]=D,o.dispatchEvent({type:y+"-changed",value:D}),o.dispatchEvent(_changeEvent))}}),o[y]=M,r[y]=M,i[y]=M}l("camera",e),l("object",void 0),l("enabled",!0),l("axis",null),l("mode","translate"),l("translationSnap",null),l("rotationSnap",null),l("scaleSnap",null),l("space","world"),l("size",1),l("dragging",!1),l("showX",!0),l("showY",!0),l("showZ",!0);const a=new Vector3,c=new Vector3,d=new Quaternion,u=new Quaternion,f=new Vector3,m=new Quaternion,h=new Vector3,_=new Vector3,b=new Vector3,v=0,w=new Vector3;l("worldPosition",a),l("worldPositionStart",c),l("worldQuaternion",d),l("worldQuaternionStart",u),l("cameraPosition",f),l("cameraQuaternion",m),l("pointStart",h),l("pointEnd",_),l("rotationAxis",b),l("rotationAngle",v),l("eye",w),this._offset=new Vector3,this._startNorm=new Vector3,this._endNorm=new Vector3,this._cameraScale=new Vector3,this._parentPosition=new Vector3,this._parentQuaternion=new Quaternion,this._parentQuaternionInv=new Quaternion,this._parentScale=new Vector3,this._worldScaleStart=new Vector3,this._worldQuaternionInv=new Quaternion,this._worldScale=new Vector3,this._positionStart=new Vector3,this._quaternionStart=new Quaternion,this._scaleStart=new Vector3,this._getPointer=getPointer.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerHover=onPointerHover.bind(this),this._onPointerMove=onPointerMove.bind(this),this._onPointerUp=onPointerUp.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){if(this.already_init){if(this.object!==void 0){this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale);let i=!1;if(this.object.skeleton?.bones){for(const r of this.object.skeleton.bones)if(r.name=="上半身"){r.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),i=!0;break}}if(i==!1){this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale);const r=this.object.geometry?.boundingSphere?.center;r&&this.worldPosition.add(r)}this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()}this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}}pointerHover(e){if(!this.already_init||this.object===void 0||this.dragging===!0)return;e!==null&&_raycaster.setFromCamera(e,this.camera);const i=intersectObjectWithRay(this._gizmo.picker[this.mode],_raycaster);i?this.axis=i.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){this.lazy_init(),e!==null&&_raycaster.setFromCamera(e,this.camera);const i=intersectObjectWithRay(this._plane,_raycaster,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,_mouseDownEvent.mode=this.mode,this.dispatchEvent(_mouseDownEvent)}}pointerMove(e){if(!this.already_init)return;const i=this.axis,r=this.mode,o=this.object;let l=this.space;if(r==="scale"?l="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(l="world"),o===void 0||i===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&_raycaster.setFromCamera(e,this.camera);const a=intersectObjectWithRay(this._plane,_raycaster,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),r==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),l==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),l==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),o.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(l==="local"&&(o.position.applyQuaternion(_tempQuaternion.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.position.applyQuaternion(this._quaternionStart)),l==="world"&&(o.parent&&o.position.add(_tempVector.setFromMatrixPosition(o.parent.matrixWorld)),i.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.parent&&o.position.sub(_tempVector.setFromMatrixPosition(o.parent.matrixWorld))));else if(r==="scale"){if(i.search("XYZ")!==-1){let c=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(c*=-1),_tempVector2.set(c,c,c)}else _tempVector.copy(this.pointStart),_tempVector2.copy(this.pointEnd),_tempVector.applyQuaternion(this._worldQuaternionInv),_tempVector2.applyQuaternion(this._worldQuaternionInv),_tempVector2.divide(_tempVector),i.search("X")===-1&&(_tempVector2.x=1),i.search("Y")===-1&&(_tempVector2.y=1),i.search("Z")===-1&&(_tempVector2.z=1);o.scale.copy(this._scaleStart).multiply(_tempVector2),this.scaleSnap&&(i.search("X")!==-1&&(o.scale.x=Math.round(o.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(o.scale.y=Math.round(o.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(o.scale.z=Math.round(o.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(r==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const c=20/this.worldPosition.distanceTo(_tempVector.setFromMatrixPosition(this.camera.matrixWorld));let d=!1;i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_tempVector.copy(this.rotationAxis).cross(this.eye))*c):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(_unit[i]),_tempVector.copy(_unit[i]),l==="local"&&_tempVector.applyQuaternion(this.worldQuaternion),_tempVector.cross(this.eye),_tempVector.length()===0?d=!0:this.rotationAngle=this._offset.dot(_tempVector.normalize())*c),(i==="E"||d)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),l==="local"&&i!=="E"&&i!=="XYZE"?(o.quaternion.copy(this._quaternionStart),o.quaternion.multiply(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),o.quaternion.copy(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),o.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(_changeEvent),this.dispatchEvent(_objectChangeEvent)}}pointerUp(e){this.already_init&&(e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(_mouseUpEvent.mode=this.mode,this.dispatchEvent(_mouseUpEvent)),this.dragging=!1,this.axis=null))}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.lazy_init(),this.object=e,this.visible=!0,this}detach(){if(this.already_init)return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.already_init&&this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(_changeEvent),this.dispatchEvent(_objectChangeEvent),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _raycaster}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function getPointer(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function onPointerHover(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function onPointerDown(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function onPointerMove(s){this.enabled&&this.pointerMove(this._getPointer(s))}function onPointerUp(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function intersectObjectWithRay(s,e,i){const r=e.intersectObject(s,!0);for(let o=0;o<r.length;o++)if(r[o].object.visible||i)return r[o];return!1}const _tempEuler=new Euler,_alignVector=new Vector3(0,1,0),_zeroVector=new Vector3(0,0,0),_lookAtMatrix=new Matrix4,_tempQuaternion2=new Quaternion,_identityQuaternion=new Quaternion,_dirVector=new Vector3,_tempMatrix=new Matrix4,_unitX=new Vector3(1,0,0),_unitY=new Vector3(0,1,0),_unitZ=new Vector3(0,0,1),_v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class TransformControlsGizmo extends Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const o=i.clone();o.opacity=.5;const l=e.clone();l.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const c=e.clone();c.color.setHex(255);const d=e.clone();d.color.setHex(16711680),d.opacity=.5;const u=e.clone();u.color.setHex(65280),u.opacity=.5;const f=e.clone();f.color.setHex(255),f.opacity=.5;const m=e.clone();m.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25,e.clone().color.setHex(16776960);const b=e.clone();b.color.setHex(7895160);const v=new CylinderGeometry(0,.04,.1,12);v.translate(0,.05,0);const w=new BoxGeometry(.08,.08,.08);w.translate(0,.04,0);const y=new BufferGeometry;y.setAttribute("position",new Float32BufferAttribute([0,0,0,1,0,0],3));const M=new CylinderGeometry(.0075,.0075,.5,3);M.translate(0,.25,0);function S(Y,q){const J=new TorusGeometry(Y,.0075,3,64,q*Math.PI*2);return J.rotateY(Math.PI/2),J.rotateX(Math.PI/2),J}function D(){const Y=new BufferGeometry;return Y.setAttribute("position",new Float32BufferAttribute([0,0,0,1,1,1],3)),Y}const k={X:[[new Mesh(v,l),[.5,0,0],[0,0,-Math.PI/2]],[new Mesh(v,l),[-.5,0,0],[0,0,Math.PI/2]],[new Mesh(M,l),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(v,a),[0,.5,0]],[new Mesh(v,a),[0,-.5,0],[Math.PI,0,0]],[new Mesh(M,a)]],Z:[[new Mesh(v,c),[0,0,.5],[Math.PI/2,0,0]],[new Mesh(v,c),[0,0,-.5],[-Math.PI/2,0,0]],[new Mesh(M,c),null,[Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronGeometry(.1,0),m.clone()),[0,0,0]]],XY:[[new Mesh(new BoxGeometry(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.15,.15,.01),d.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},O={X:[[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[0,.3,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronGeometry(.2,0),r)]],XY:[[new Mesh(new BoxGeometry(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},L={START:[[new Mesh(new OctahedronGeometry(.01,2),o),null,null,null,"helper"]],END:[[new Mesh(new OctahedronGeometry(.01,2),o),null,null,null,"helper"]],DELTA:[[new Line(D(),o),null,null,null,"helper"]],X:[[new Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(y,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(y,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P={XYZE:[[new Mesh(S(.5,1),b),null,[0,Math.PI/2,0]]],X:[[new Mesh(S(.5,.5),l)]],Y:[[new Mesh(S(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new Mesh(S(.5,.5),c),null,[0,Math.PI/2,0]]],E:[[new Mesh(S(.75,1),h),null,[0,Math.PI/2,0]]]},N={AXIS:[[new Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},z={XYZE:[[new Mesh(new SphereGeometry(.25,10,8),r)]],X:[[new Mesh(new TorusGeometry(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Mesh(new TorusGeometry(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Mesh(new TorusGeometry(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Mesh(new TorusGeometry(.75,.1,2,24),r)]]},K={X:[[new Mesh(w,l),[.5,0,0],[0,0,-Math.PI/2]],[new Mesh(M,l),[0,0,0],[0,0,-Math.PI/2]],[new Mesh(w,l),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(w,a),[0,.5,0]],[new Mesh(M,a)],[new Mesh(w,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Mesh(w,c),[0,0,.5],[Math.PI/2,0,0]],[new Mesh(M,c),[0,0,0],[Math.PI/2,0,0]],[new Mesh(w,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Mesh(new BoxGeometry(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.15,.15,.01),d),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new BoxGeometry(.1,.1,.1),m.clone())]]},Z={X:[[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[0,.3,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Mesh(new BoxGeometry(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new BoxGeometry(.2,.2,.2),r),[0,0,0]]]},V={X:[[new Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(y,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(y,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function H(Y){const q=new Object3D;for(const J in Y)for(let W=Y[J].length;W--;){const te=Y[J][W][0].clone(),ie=Y[J][W][1],oe=Y[J][W][2],Ce=Y[J][W][3],ve=Y[J][W][4];te.name=J,te.tag=ve,ie&&te.position.set(ie[0],ie[1],ie[2]),oe&&te.rotation.set(oe[0],oe[1],oe[2]),Ce&&te.scale.set(Ce[0],Ce[1],Ce[2]),te.updateMatrix();const we=te.geometry.clone();we.applyMatrix4(te.matrix),te.geometry=we,te.renderOrder=1/0,te.position.set(0,0,0),te.rotation.set(0,0,0),te.scale.set(1,1,1),q.add(te)}return q}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=H(k)),this.add(this.gizmo.rotate=H(P)),this.add(this.gizmo.scale=H(K)),this.add(this.picker.translate=H(O)),this.add(this.picker.rotate=H(z)),this.add(this.picker.scale=H(Z)),this.add(this.helper.translate=H(L)),this.add(this.helper.rotate=H(N)),this.add(this.helper.scale=H(V)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const r=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:_identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let o=[];o=o.concat(this.picker[this.mode].children),o=o.concat(this.gizmo[this.mode].children),o=o.concat(this.helper[this.mode].children);for(let l=0;l<o.length;l++){const a=o[l];a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition);let c;if(this.camera.isOrthographicCamera?c=(this.camera.top-this.camera.bottom)/this.camera.zoom:c=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(c*this.size/4),a.tag==="helper"){a.visible=!1,a.name==="AXIS"?(a.visible=!!this.axis,this.axis==="X"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,0)),a.quaternion.copy(r).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitX).applyQuaternion(r).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Y"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,Math.PI/2)),a.quaternion.copy(r).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitY).applyQuaternion(r).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Z"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),a.quaternion.copy(r).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitZ).applyQuaternion(r).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="XYZE"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),_alignVector.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(_zeroVector,_alignVector,_unitY)),a.quaternion.multiply(_tempQuaternion),a.visible=this.dragging),this.axis==="E"&&(a.visible=!1)):a.name==="START"?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):a.name==="END"?(a.position.copy(this.worldPosition),a.visible=this.dragging):a.name==="DELTA"?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),_tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(_tempVector),a.visible=this.dragging):(a.quaternion.copy(r),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=this.axis.search(a.name)!==-1));continue}a.quaternion.copy(r),this.mode==="translate"||this.mode==="scale"?(a.name==="X"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(r).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Y"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(r).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Z"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(r).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XY"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(r).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="YZ"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(r).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XZ"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(r).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1)):this.mode==="rotate"&&(_tempQuaternion2.copy(r),_alignVector.copy(this.eye).applyQuaternion(_tempQuaternion.copy(r).invert()),a.name.search("E")!==-1&&a.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(this.eye,_zeroVector,_unitY)),a.name==="X"&&(_tempQuaternion.setFromAxisAngle(_unitX,Math.atan2(-_alignVector.y,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),a.quaternion.copy(_tempQuaternion)),a.name==="Y"&&(_tempQuaternion.setFromAxisAngle(_unitY,Math.atan2(_alignVector.x,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),a.quaternion.copy(_tempQuaternion)),a.name==="Z"&&(_tempQuaternion.setFromAxisAngle(_unitZ,Math.atan2(_alignVector.y,_alignVector.x)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),a.quaternion.copy(_tempQuaternion))),a.visible=a.visible&&(a.name.indexOf("X")===-1||this.showX),a.visible=a.visible&&(a.name.indexOf("Y")===-1||this.showY),a.visible=a.visible&&(a.name.indexOf("Z")===-1||this.showZ),a.visible=a.visible&&(a.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),a.material._color=a.material._color||a.material.color.clone(),a.material._opacity=a.material._opacity||a.material.opacity,a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled&&this.axis&&(a.name===this.axis||this.axis.split("").some(function(d){return a.name===d}))&&(a.material.color.setHex(16776960),a.material.opacity=1)}super.updateMatrixWorld(e)}}class TransformControlsPlane extends Mesh{constructor(){super(new PlaneGeometry(1e5,1e5,2,2),new MeshBasicMaterial({visible:!1,wireframe:!0,side:DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),_v1.copy(_unitX).applyQuaternion(i==="local"?this.worldQuaternion:_identityQuaternion),_v2.copy(_unitY).applyQuaternion(i==="local"?this.worldQuaternion:_identityQuaternion),_v3.copy(_unitZ).applyQuaternion(i==="local"?this.worldQuaternion:_identityQuaternion),_alignVector.copy(_v2),this.mode){case"translate":case"scale":switch(this.axis){case"X":_alignVector.copy(this.eye).cross(_v1),_dirVector.copy(_v1).cross(_alignVector);break;case"Y":_alignVector.copy(this.eye).cross(_v2),_dirVector.copy(_v2).cross(_alignVector);break;case"Z":_alignVector.copy(this.eye).cross(_v3),_dirVector.copy(_v3).cross(_alignVector);break;case"XY":_dirVector.copy(_v3);break;case"YZ":_dirVector.copy(_v1);break;case"XZ":_alignVector.copy(_v3),_dirVector.copy(_v2);break;case"XYZ":case"E":_dirVector.set(0,0,0);break}break;case"rotate":default:_dirVector.set(0,0,0)}_dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(_tempMatrix.lookAt(_tempVector.set(0,0,0),_dirVector,_alignVector),this.quaternion.setFromRotationMatrix(_tempMatrix)),super.updateMatrixWorld(e)}}const Handlers={};function changeHandler(s){const e=DMC.controls;e&&(e.event_listener=Handlers[s],e.current_handler_name=s)}async function UI_TransformController(){const s=DMC;window.debug&&console.log("UI_TransformController");const e=document.getElementById("main_frame"),i=e.querySelector("canvas"),r=s.camera,o=s.helper_scene,l=s.controls,a=new TransformControls(r,i);s.transform_controls&&s.transform_controls.dispose(),s.transform_controls=a,s.transform_controls.space="local",a.update=function(){};function c(f,m){let h=m.uuid==f.uuid;return f.parent&&(h=h||c(f.parent,m)),h}a.is_valid_object=function(f,m="object"){const h=f.getDDDProperties?.();return!(h&&h.transform_controller==!1||m=="object"&&(f==s.scene||c(f,s.camera)||c(f,s.transform_controls)||f.type=="AmbientLight"||f._is_background_))},a.filter=function(f="valid"){const m=[];return f=="valid"?s.scene.traverse(h=>{a.is_valid_object(h,f)&&m.push(h)}):f=="mesh"&&s.scene.traverse(h=>{h.isMesh&&m.push(h)}),m},a.focus_object=function(f,m){if(m.force=!0,a.select_object(f,m)){typeof f=="string"&&s.scene.traverse(_=>{_.uuid==f&&(f=_)});const h=s.camera;if(f.geometry?.boundingSphere){let y=function(){const M=new Vector3;M.copy(h.position),M.sub(_),M.multiplyScalar(.2),h.position.sub(M);const S=new Vector3;S.copy(h.target),S.sub(b),S.multiplyScalar(.2),h.target.sub(S),S.length()<.1?(h.position.copy(_),h.target.copy(b)):setTimeout(y,16)};const _=new Vector3,b=new Vector3,v=new Vector3;let w=f.geometry.boundingSphere.center.clone();if(v.copy(h.position),v.sub(h.target),v.normalize(),f.geometry.boundingSphere.radius*3*f.scale.length()>150?v.multiplyScalar(150):(v.multiplyScalar(f.geometry.boundingSphere.radius*3*f.scale.length()),console.log(f.scale.length())),f.skeleton?.bones){for(const M of f.skeleton.bones)if(M.name=="上半身"){const S=new Vector3,D=new Vector3,k=new Quaternion;M.matrixWorld.decompose(S,k,D),w=S}}else{const M=w,S=new Vector3,D=new Quaternion;f.matrixWorld.decompose(M,D,S),w=M}_.copy(w),_.add(v),b.copy(w),y()}else{let w=function(){const y=new Vector3;y.copy(h.position),y.sub(_),y.multiplyScalar(.2),h.position.sub(y);const M=new Vector3;M.copy(h.target),M.sub(b),M.multiplyScalar(.2),h.target.sub(M),M.length()<.1?(h.position.copy(_),h.target.copy(b)):setTimeout(w,16)};const _=new Vector3,b=new Vector3,v=new Vector3;v.copy(f.position),_.copy(v),_.sub(h.target),_.add(h.position),b.copy(v),w()}}},a.select_object=function(f,m){const h={select_tree_component:!0,attach_object:null,force:!1};if(m&&Object.assign(h,m),a.detach(),s.playing_state==s.PLAYING_STATE.PLAYING)return;if(!a.is_valid_object(f)&&h.force==!1)return!1;const _=document.querySelectorAll(".tree_component_item");typeof f=="string"&&s.scene.traverse(v=>{v.uuid==f&&(f=v)});let b=!1;for(let v=0;v<_.length;v++){const w=_[v];if(w.dataset.uuid==f.uuid){if(h.select_tree_component){let y=function(S,D){const k=document.createEvent("MouseEvents");k.initEvent(D,!0,!0),S.dispatchEvent(k)};const M=w;M&&(y(M,"mouseover"),y(M,"mousedown"),y(M,"mouseup"),y(M,"click"))}b=!0}}return b?a.attach(h.attach_object||f):f&&s.ui.tree.open_tree_by_uuid(f.uuid),!0},a.addEventListener("dragging-changed",f=>{l.enabled=!f.value,s.environment_map_center_helper_object==s.current.object?s.dispatchEvent("change@geometry@denv",{}):s.dispatchEvent("change@geometry",{})}),a.name="Transform Controller",o.add(a);function d(){const f=document.getElementsByClassName("transform_controls_switch_button");for(let m=0;m<f.length;m++){const h=f[m];h.dataset.mode==a.getMode()?(h.classList.add("active"),h.classList.add("focused_outline")):(h.classList.remove("active"),h.classList.remove("focused_outline"))}}function u(f,m,h,_){f.classList.add("bi");const b=20,v=7;f.style.top="5px",f.style.right=10+b*h+v*h+"px",f.style.width=b+"px",f.style.height=b+"px",f.style.display="flex",f.style.alignItems="center",f.style.justifyContent="center",f.dataset.mode=m,f.classList.add("transform_controls_switch_button");function w(y){y.preventDefault(),y.stopPropagation()}f.onmousedown=w,f.onmousemove=w,f.onmouseup=w,f.onclick=w,f.onpointerdown=function(y){y.preventDefault(),y.stopPropagation(),_(),d()},f.onpointerup=w,f.onpointercancel=w}if(!window.app_mode){{const f=document.createElement("i");f.classList.add("bi-arrows-move"),u(f,"translate",0,m=>{a.setMode("translate")}),e.appendChild(f)}{const f=document.createElement("i");f.classList.add("bi-arrow-repeat"),u(f,"rotate",1,m=>{a.setMode("rotate")}),e.appendChild(f)}{const f=document.createElement("i");f.classList.add("bi-arrows-angle-contract"),u(f,"scale",2,m=>{a.setMode("scale")}),e.appendChild(f)}{const f=document.createElement("i");f.classList.add("bi-pentagon"),u(f,"reset_physics",4,m=>{s.reset_physics()}),e.appendChild(f)}{const f=document.createElement("i");f.classList.add("bi-camera-video"),u(f,"reset_camera",5,m=>{s.reset_camera()}),e.appendChild(f)}}d()}class MaskPass extends Pass{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,r){const o=e.getContext(),l=e.state;l.buffers.color.setMask(!1),l.buffers.depth.setMask(!1),l.buffers.color.setLocked(!0),l.buffers.depth.setLocked(!0);let a,c;this.inverse?(a=0,c=1):(a=1,c=0),l.buffers.stencil.setTest(!0),l.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),l.buffers.stencil.setFunc(o.ALWAYS,a,4294967295),l.buffers.stencil.setClear(c),l.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),l.buffers.color.setLocked(!1),l.buffers.depth.setLocked(!1),l.buffers.color.setMask(!0),l.buffers.depth.setMask(!0),l.buffers.stencil.setLocked(!1),l.buffers.stencil.setFunc(o.EQUAL,1,4294967295),l.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),l.buffers.stencil.setLocked(!0)}}class ClearMaskPass extends Pass{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class EffectComposer{constructor(e,i){if(this.renderer=e,i===void 0){const r={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat},o=e.getSize(new Vector2);this._pixelRatio=e.getPixelRatio(),this._width=o.width,this._height=o.height,i=new WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r),i.texture.name="EffectComposer.rt1"}else this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height;this.normal_texture=null,this.depth_texture=null;{const r=new DepthTexture;r.type=FloatType,r.format=DepthFormat,this.depth_texture=r}this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget3=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.renderTarget3.texture.name="EffectComposer.rt3",this.renderTarget3.depthTexture=this.depth_texture,this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],CopyShader===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),ShaderPass===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new ShaderPass(CopyShader),this.clock=new Clock}setRenderObjects(e,i){this.scene=e,this.camera=i}overrideVisibility(){const e=this.scene,i=this._visibilityCache;e&&e.traverse(function(r){i.set(r,r.visible),(r.isPoints||r.isLine)&&(r.visible=!1)})}restoreVisibility(){const e=this.scene,i=this._visibilityCache;e&&(e.traverse(function(r){const o=i.get(r);r.visible=o}),i.clear())}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){if(e===void 0&&(e=this.clock.getDelta()),this.normal_buffer){let o=this.renderer,l=this.normal_buffer,a=this.normalMaterial;this.overrideVisibility(),o.getClearColor(this.originalClearColor);const c=o.getClearAlpha(),d=o.autoClear;o.setRenderTarget(l),o.autoClear=!1;let u=a.clearColor||7829503,f=a.clearAlpha||1;u!=null&&(o.setClearColor(u),o.setClearAlpha(f||0),o.clear()),this.scene.overrideMaterial=a,o.render(this.scene,this.camera),this.scene.overrideMaterial=null,o.autoClear=d,o.setClearColor(this.originalClearColor),o.setClearAlpha(c),this.restoreVisibility(),this.normal_texture=this.normal_buffer.texture,this.depth_texture=this.normal_buffer.depthTexture}{const o=this.renderer.getRenderTarget(),l=this.renderer;l.setRenderTarget(this.renderTarget1),l.clear(),l.setRenderTarget(this.renderTarget2),l.clear(),l.setRenderTarget(o)}const i=this.renderer.getRenderTarget();let r=!1;for(let o=0,l=this.passes.length;o<l;o++){const a=this.passes[o];if(a.enabled!==!1){if(a.delegator=this,a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(o),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,r,{effect_composer:this}),a.needsSwap){if(r){const c=this.renderer.getContext(),d=this.renderer.state.buffers.stencil;d.setFunc(c.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),d.setFunc(c.EQUAL,1,4294967295)}this.swapBuffers()}MaskPass!==void 0&&(a instanceof MaskPass?r=!0:a instanceof ClearMaskPass&&(r=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const r=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget1.setSize(r,o),this.renderTarget2.setSize(r,o),this.renderTarget3.setSize(r,o);for(let l=0;l<this.passes.length;l++)this.passes[l].setSize(r,o);this.normal_buffer&&this.normal_buffer.setSize(r,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new OrthographicCamera(-1,1,1,-1,0,1);const _geometry=new BufferGeometry;_geometry.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3));_geometry.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2));var debug$4=window.debug;class EnvironmentMapManager{constructor(){this.resolution=256,this.registered=new Map,this.mode=-1,this.tmps=new WeakMap,this.obj_tmps=new Map,this.previous_condition="",this.needsDummyRendering=!1,this.needsUpdateForDynamicMap=!1,this.dynamic_cube_map_update_mode=0,this.dynamic_cube_map_num_of_reflection=2,this.dynamic_cube_map_update_count=1,this.dynamic_cube_map_shared_cast=!0,this.first_time=!1,this.__init__()}async __compatibility_processing__(){this.__init__()}recreate_buffer(e=!1){const i=DMC;this.center_cube_dummy.dispose(),this.center_cube.dispose(),this.center_cube2.dispose(),this.center_cube_dummy=this._create_cube_map_object(e),this.center_cube=this._create_cube_map_object(e),this.center_cube2=this._create_cube_map_object(e);const o=i.ui.renderer_flags.environment_map;this.center_cube.position.set(o.center_position_x,o.center_position_y,o.center_position_z),this.center_cube2.position.set(o.center_position_x,o.center_position_y,o.center_position_z),i.scene.environment=null;for(const[l,a]of this.obj_tmps){const c=Array.isArray(l.material)?l.material:[l.material];for(const d of c)d.envMap=null;a.dispose(),this.obj_tmps.set(l,this._create_cube_map_object(e))}console.log("Recreate"),this.update_dynamic_map()}__init__(){const i=DMC.ui.renderer_flags;(i.environment_map==null||typeof i.environment_map!="object")&&(i.environment_map={});const r=i.environment_map;r.type=r.type??"Dynamic",r.file=r.file==null?"venice_sunset_1k.hdr":r.file,r.background=r.background??!0,r.resolution=r.resolution??128,r.background_color=r.background_color??0,r.fog_color=r.fog_color??11184810,r.fog_density=r.fog_density??1e-5,r.dynamic_cube_map_update_mode=r.dynamic_cube_map_update_mode??2,r.dynamic_cube_map_shared_cast=r.dynamic_cube_map_shared_cast??!0,debug$4&&console.log("DynamicCubeMapY:",r.center_position_y),r.center_position_x=r.center_position_x??0,r.center_position_y=r.center_position_y??15,r.center_position_z=r.center_position_z??0,r.dynamic_cube_map_num_of_reflection=r.dynamic_cube_map_num_of_reflection??1,r.clear_color=r.clear_color??0,r.clear_alpha=r.clear_alpha??0,r.dom_color=r.dom_color??2236962,this.center_cube_dummy=this._create_cube_map_object(),this.center_cube=this._create_cube_map_object(),this.center_cube2=this._create_cube_map_object(),this.center_cube.position.set(r.center_position_x,r.center_position_y,r.center_position_z),this.center_cube2.position.set(r.center_position_x,r.center_position_y,r.center_position_z),this.center_cube_dummy.position.set(r.center_position_x,r.center_position_y,r.center_position_z),this.dynamic_cube_map_update_mode=r.dynamic_cube_map_update_mode,this.dynamic_cube_map_shared_cast=r.dynamic_cube_map_shared_cast,this.dynamic_cube_map_num_of_reflection=r.dynamic_cube_map_num_of_reflection,this.resolution=r.resolution}async create_cube_map_file(){const e=DMC;await __vitePreload(()=>import("./jszip.min@TY6z0PXt.js"),[],import.meta.url),this.recreate_buffer(!0);const r=new JSZip;setTimeout(()=>{e.draw_thread_after_runner.push(()=>{const o=this.last_cube_map;if(o==null)return;let l=0;for(let a=0;a<6;a++){const c=o.render_target.width,d=o.render_target.height,u=new Uint8Array(4*d*c),f=u,m=e.base_renderer,h=255;m.readRenderTargetPixels(o.render_target,0,0,c,d,f,a),(async()=>{function _(w){let y=w/h;return y=Math.min(Math.max(y,0),1),y=Math.floor(y*255),y}for(let w=0,y=4*d*c;w<y;w+=4)u[w+0]=_(f[w+0]),u[w+1]=_(f[w+1]),u[w+2]=_(f[w+2]),u[w+3]=255;const b=new ImageData(new Uint8ClampedArray(u),c,d),v=await C$2.to_compressed_buffer(b);r.file(`${a}.jpg`,v),l++,l==6&&r.generateAsync({type:"blob"}).then(async function(w){await C$2.download(w,"envmap.zip")}).catch(w=>{console.error(w)})})()}this.recreate_buffer()})},2e3)}getCenterPosition(){return this.center_cube.position}setCenterPosition(e,i,r){const o=DMC,l=this.center_cube.position;e instanceof Vector3?l.copy(e):l.set(e,i,r);const c=o.ui.renderer_flags.environment_map;c.center_position_x=l.x,c.center_position_y=l.y,c.center_position_z=l.z,this.update_dynamic_map()}setCenterPositionX(e){const i=DMC;this.center_cube.position.x=e;const o=i.ui.renderer_flags.environment_map;o.center_position_x=e,this.update_dynamic_map()}setCenterPositionY(e){const i=DMC;this.center_cube.position.y=e;const o=i.ui.renderer_flags.environment_map;o.center_position_y=e,this.update_dynamic_map()}setCenterPositionZ(e){const i=DMC;this.center_cube.position.z=e;const o=i.ui.renderer_flags.environment_map;o.center_position_z=e,this.update_dynamic_map()}material_modifier(e){DMC.scene.traverse(r=>{const o=r.material;if(o)if(Array.isArray(o))for(let l=0,a=o.length;l<a;l++)e(o[l]);else e(o)})}recreate(){this.dispose(),this.center_cube=this._create_cube_map_object()}_create_cube_map_object(e=!1){const i=new WebGLCubeRenderTarget(this.resolution,{generateMipmaps:!0,minFilter:LinearMipmapLinearFilter,type:e?UnsignedByteType:HalfFloatType});i.texture.no_delete=!0;const r=new CubeCamera(.1,1e4,i);r.position.set(0,15,0);const o={render_target:i,camera:r,position:r.position,dispose(){o.render_target.dispose()}};return o}update_dynamic_map(){this.needsUpdateForDynamicMap=!0,this.dynamic_cube_map_update_count=this.dynamic_cube_map_num_of_reflection}_clear_envMaps(){const i=DMC.scene;if(i!=null){i.background?.dispose&&(i.background.no_delete||i.background.dispose()),i.environment?.dispose&&(i.environment.no_delete||i.environment.dispose()),i.background=new Color(0),i.environment=null;for(const[r,o]of this.obj_tmps){const l=Array.isArray(r.material)?r.material:[r.material];for(const a of l)a.envMap=null}}}async apply_environment_map(){const e=DMC,i=e.scene;if(i==null)return;const r=this,l=e.ui.renderer_flags.environment_map,a=`${l.type}.${l.file}.${l.background}`;if(r.dynamic_cube_map_update_mode=l.dynamic_cube_map_update_mode,r.dynamic_cube_map_num_of_reflection=l.dynamic_cube_map_num_of_reflection,r.dynamic_cube_map_shared_cast=l.dynamic_cube_map_shared_cast,r.previous_background!=l.background||r.previous_type!=l.type||l.type=="Static"&&r.previous_condition!=a){let c=!1;async function d(){for(;c;)await C$2.sleep(50);if(c=!0,l.type=="Static"){r._clear_envMaps();const u=l.file?C$2.DPathJoin(l.file,"0.jpg"):null;l.file===void 0&&(l.file="venice_sunset_1k.hdr");let f=!1;if(l.file){const h=C$2.DPath(l.file).ext;C$2.is_image_ext(h)||(f=!!(u&&await window.cross_file_system.exists(u)))}if(f){const m=new CubeTextureLoader;m.setPath(l.file+"/");const _=await new Promise((b,v)=>{m.load(["0.jpg","1.jpg","2.jpg","3.jpg","4.jpg","5.jpg"],w=>{b(w)},null,w=>{v(w)})});l.background?i.background=_.clone():i.background=null,i.environment=_.clone(),_.dispose()}else if(l.file){const h=C$2.DPath(l.file).is_absolute_path,_=h?l.file:"ddd/textures/equirectangular/"+l.file;!h&&window.external_io&&await window.PrepareFromSystemResource(_),debug$4&&console.log("EnvMap:",_);try{const b=await BuilderUtil.load_texture(_);b.mapping=EquirectangularReflectionMapping,l.background?i.background=b.clone():i.background=null,i.environment=b.clone(),b.dispose()}catch(b){console.warn(b),l.background?i.background=new Color(l.background_color):i.background=null,i.environment=null}for(const b of e.getObjectsByDecoType("sky"))e.backup_sky_object=b,b.parent?.remove?.(b)}else l.background?i.background=new Color(l.background_color):i.background=null,i.environment=null;r.mode=1}else l.type=="Dynamic"?(r._clear_envMaps(),l.background?i.background=new Color(l.background_color):i.background=null,i.fog.density=l.fog_density,i.environment=null,e.backup_sky_object&&i.add(e.backup_sky_object),e.backup_sky_object=null,r.needsDummyRendering=!0,r.mode=2,r.update_dynamic_map()):l.type=="None"&&(r._clear_envMaps(),l.background?i.background=new Color(l.background_color):i.background=null,i.fog.density=l.fog_density,i.environment=null,e.backup_sky_object&&i.add(e.backup_sky_object),e.backup_sky_object=null,r.mode=0);c=!1}r.first_time==!1?(r.first_time=!0,window.__init_promises__.push(new Promise(async u=>{await d(),u()}))):await d()}r.previous_type=l.type,r.previous_condition=a,r.previous_background=l.background}dispose(){this.center_cube.dispose(),this.center_cube=null;for(const e in this.registered)this.registered[e].dispose(),delete this.registered[e]}register(e){this.registered.get(e)||this.registered.set(e,this._create_cube_map_object())}remove(e){const i=this.registered.get(e);i&&i.cube_render_target.dispose(),this.registered.delete(e)}render_env(){const e=DMC,i=this.mode,r=e?.scene,o=this.dynamic_cube_map_update_mode,l=this.dynamic_cube_map_num_of_reflection,a=e?.base_renderer;if(i===2){this.center_cube,this.center_cube2;{const d=e.ui.renderer_flags.environment_map;this.center_cube.position.set(d.center_position_x,d.center_position_y,d.center_position_z),this.center_cube2.position.set(d.center_position_x,d.center_position_y,d.center_position_z),this.center_cube_dummy.position.set(d.center_position_x,d.center_position_y,d.center_position_z)}if(r.environment==null||this.needsUpdateForDynamicMap||o==0||this.dynamic_cube_map_update_count>0){{const c=this.center_cube,d=this.center_cube2;if(this.dynamic_cube_map_shared_cast)if(l==0)r.environment=null;else{this.material_modifier(m=>{this.tmps.has(m)||this.tmps.set(m,{});const h=this.tmps.get(m);h.visible=m.visible,m.visible!==m.castDynamicEnvironment&&m.visible&&(m.visible=m.castDynamicEnvironment)});const u=a.xr.enabled;a.xr.enabled=!1,r.environment=null;const f=this.center_cube_dummy;if(f.camera.update(a,r),r.environment=f.render_target.texture,this.last_cube_map=f,l>1)for(let m=0;m<l-1;m++)m%2===0?(c.camera.update(a,r),r.environment=c.render_target.texture,this.last_cube_map=c):(d.camera.update(a,r),r.environment=d.render_target.texture,this.last_cube_map=d);this.material_modifier(m=>{const h=this.tmps.get(m);m.visible!==h.visible&&(m.visible=h.visible)}),a.xr.enabled=u}else{if(this.needsDummyRendering){this.needsDummyRendering=!1,r.environment=null;const f=this.center_cube_dummy;f.camera.update(a,r),r.environment=f.render_target.texture,this.last_cube_map=f,this.dynamic_cube_map_update_count<=0||this.dynamic_cube_map_update_count--;return}const u=new Map;r.traverse(f=>{f.isSky||f.isMesh&&f.visible&&u.set(f,f)});for(const[f,m]of u){const h=u.get(f);this.obj_tmps.has(h)||this.obj_tmps.set(h,this._create_cube_map_object());const _=Array.isArray(h.material)?h.material:[h.material];for(const b of _)b.envMap=null}for(const[f,m]of u){const h=u.get(f);h.visible=!1;const _=this.obj_tmps.get(h);_.position.copy(h.position),_.camera.update(a,r),h.visible=!0}for(const[f,m]of u){const h=u.get(f),_=this.obj_tmps.get(h),b=Array.isArray(h.material)?h.material:[h.material];for(const v of b)v.envMap=_.render_target.texture}for(const f in this.obj_tmps)u.has(f)||(this.obj_tmps.get(f).dispose(),this.obj_tmps.delete(f))}}this.dynamic_cube_map_update_count<=0?this.needsUpdateForDynamicMap=!1:this.dynamic_cube_map_update_count--}}}}function UpdateSounds(s,e,i){s instanceof Audio$1&&s.isPlaying==!1&&s.getDDDProperties?.()?.audio?.update?.(e,i)}async function InitializeThreeJS(){const s=DMC,e=s.canvas.width,i=s.canvas.height,r=s.ui.renderer_flags,o=await GetSystemPreferences({});r.use_retina=r.use_retina!=null?r.use_retina:o.use_retina??!1,debug$4&&console.log("Stencil:",r.stencil,"Alpha:",r.alpha,"Antialias:",r.antialias,"LogarithmicDepthBuffer:",r.logarithmicDepthBuffer);const l=s.base_renderer=new WebGLRenderer({stencil:r.stencil??!1,alpha:r.alpha??!1,antialias:r.antialias??!0,logarithmicDepthBuffer:r.logarithmicDepthBuffer??!0});l.debug.checkShaderErrors=!1,r.useLegacyLights=r.useLegacyLights??!1,ColorManagement.enabled=!1,r.useLegacyLights!=!1&&(debug$4&&console.log("LegacyLights:",r.useLegacyLights,l.useLegacyLights),l.useLegacyLights=r.useLegacyLights);{const a=["","moz","webkit","ms"];let c=new Map;for(const d of a)document.addEventListener(d+"fullscreenchange",function(u){const f=document.getElementById("main_frame"),m=s.base_renderer.domElement;function h(){return document.fullscreenElement!==void 0&&document.fullscreenElement!==null||document.mozFullScreenElement!==void 0&&document.mozFullScreenElement!==null||document.webkitFullscreenElement!==void 0&&document.webkitFullscreenElement!==null||document.webkitCurrentFullScreenElement!==void 0&&document.webkitCurrentFullScreenElement!==null||document.msFullscreenElement!==void 0&&document.msFullscreenElement!==null}if(h()){console.log("Entered full screen.");for(const _ of f.children)m!=_&&(c.set(_,{display:_.style.display}),_.style.display="none")}else{console.log("Leaved full screen.");for(const _ of f.children)m!=_&&(_.style.display=c.get(_).display)}},!0)}s.set_gl_context(l.getContext()),l.outputColorSpace=SRGBColorSpace,s.setSizeToBaseRenderer(e,i),s.renderers={Forward:{is_ready:!1,async init(){},setSize(a,c){s.setSizeToBaseRenderer(a,c)},render(a,c,d){this.is_ready&&(s.start_gpu_status_check(),l.render(a,c),s.end_gpu_status_check())}},Deferred:{is_ready:!1,initialized:!1,async init(){if(this.initialized==!1){this.initialized=!0;const a={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,type:window.THREE.HalfFloatType,depthBuffer:!0,stencilBuffer:!1,colorSpace:LinearSRGBColorSpace,samples:l.capabilities.maxSamples},c=new WebGLRenderTarget(1,1,a),d=new EffectComposer(l,c);s.effect_composer=d,d.is_ready=!1,this.effect_composer=d}},setSize(a,c){this.effect_composer&&this.effect_composer.setSize(a,c),s.setSizeToBaseRenderer(a,c)},render(a,c,d){this.is_ready&&this.effect_composer?.is_ready&&(this.effect_composer.setRenderObjects&&this.effect_composer.setRenderObjects(a,c),this.effect_composer.render(d))}},Toon:{is_ready:!1,async init(){const{OutlineEffect:a}=await __vitePreload(()=>import("./OutlineEffect@CWld7flV.js"),[],import.meta.url),c=new a(l,{defaultThickness:.01,defaultColor:new Color(8947848),defaultAlpha:.8,defaultKeepAlive:!0});this.outline_effect=c},setSize(a,c){this.outline_effect&&this.outline_effect.setSize(a,c),s.setSizeToBaseRenderer(a,c)},render(a,c,d){this.is_ready&&this.outline_effect&&(l.render(a,c),this.outline_effect.renderOutline(a,c))}}},s.getRenderer=function(){const a=s.current.renderer_key;return s.renderers[a]},s.clock=new Clock,s.mmd_animation_helper=new MMDAnimationHelper({sync:!1,pmxAnimation:!0,afterglow:0}),s.mmd_animation_helper.enable("animation",!1),s.mmd_animation_helper.enable("ik",!0),s.mmd_animation_helper.enable("grant",!0),s.mmd_animation_helper.enable("cameraAnimation",!1),s.mmd_animation_helper.enable("physics",!1);for(const a in s.renderers)s.renderers[a].is_ready=!0;s.environment_map_manager=new EnvironmentMapManager}async function InitializeRenderer(){const s=DMC,e=TimeDurationChecker("Total"),i=s.ui.renderer_flags;await UI_GraphicsPanel(),s.loop_id=null,s.is_looping=!1,s.start_animation=function(){s.is_looping||(s.is_looping=!0,s._browser_vsync_update_())},s._browser_vsync_update_=function(){s.loop_id=window.requestAnimationFrame(s._browser_vsync_update_),s.ready&&s.update_display()},s.stop_animation=function(){s.loop_id&&window.cancelAnimationFrame(s.loop_id),s.loop_id=!1,s.is_looping=!1},s.viewport_overlay=new ViewHelper(s.camera,s.canvas),s.viewport_overlay.controls=s.controls,s.progressive_light_map_objects=[],s.progressive_light_map_lights=[],s.progressive_surface_map=null,s.enabled_progressive_surface_map=!1;const r=new Vector3(40,40,40);s.progressive_surface_map_update=function(){if(s.progressive_surface_map){const w=s.current.camera||s.camera;s.progressive_surface_map.update(w,200,!0);const y=s.progressive_light_map_lights,M=.5;let S=null,D=null,k=0;s.scene.traverse(L=>{L.isMesh&&(k+=1,D=L)});const O=Math.round(k*Math.random()-1e-4);k=0,s.scene.traverse(L=>{L.isMesh&&(O==k&&(S=L),k+=1)}),S==null&&(S=D);for(let L=0;L<y.length;L++)if(Math.random()>M)y[L].position.set(r.x+Math.random()*3,r.y+Math.random()*3,r.z+Math.random()*3);else{const P=Math.acos(2*Math.random()-1)-1.570795,N=2*3.14159*Math.random(),z=100;y[L].position.set(Math.cos(P)*Math.cos(N)*z+S.position.x,Math.abs(Math.cos(P)*Math.sin(N)*z)+S.position.y+20,Math.sin(P)*z+S.position.z)}}},s.add_to_progressive_surfacemap=async function(){s.scene.traverse(y=>{y.type=="DirectionalLight"&&(s.progressive_light_map_lights.push(y),s.progressive_light_map_objects.push(y),r.copy(y.position)),y.isMesh&&s.progressive_light_map_objects.push(y)});const{ProgressiveLightMap:w}=await __vitePreload(()=>import("./ProgressiveLightMap@CVbx9wrO.js"),[],import.meta.url);s.progressive_surface_map=new w(s.base_renderer,4096),s.progressive_surface_map.addObjectsToLightMap(s.progressive_light_map_objects),s.dispatchEvent("change@scene",{})};const o=new WeakMap,l=[],a=s.PLAYING_STATE;let c=!1,d=!1;function u(w,y,M=!1,S=null){const D=k=>{if(k.isMMD||k.updateActions?.(y),k.user.updaters){const O=k.user.updaters;for(const L in O)O[L](y)}k.isMesh&&M&&(k.__prevent__motion_blur__=!0)};S?D(S):w.traverse(D),s.user_flag_needs_update=!1}const f={force_update_physics:!1,force_update_animation:!1,force_update_ik:!0,force_update_grant:!0};let m={};s.renderer_animation_update=function(w=0,y=0,M=0,S=null){const D=s.mmd_animation_helper,k=s.scene,O=s.playing_state==s.PLAYING_STATE.PLAYING;if(f.force_update_physics=!1,f.force_update_animation=!1,D)if(y){const L=D.enabled.animation&&O;D.enable("animation",!0),f.force_update_animation=!0,f.force_update_physics=!0,D.update(y,f),S||(s.animation_world_time+=y),u(k,y,!0,S),L&&s.play_media(),D.enable("animation",L)}else D.enabled.animation?(S||(s.animation_world_time+=w),D.update(w,f)):(f.force_update_physics=!0,D.update_without_animation(M,f)),u(k,w,O&&s.animation_world_time<1,S);else u(k,w,O&&s.animation_world_time<1,S)};class h{total_count=0;warmup_threshold=20;warmup_listeners=[];stability_threshold=20;stability_listeners=[];frame_tm=0;frame_st=0;frame_cnt=0;frame_diff=0;frame_max=-1/0;frame_min=1/0;begin_frame(){this.frame_st=performance.now()}end_frame(){const M=performance.now(),S=M-this.frame_st;if(this.frame_diff+=S,this.frame_cnt++,this.frame_max=Math.max(this.frame_max,S),this.frame_min=Math.min(this.frame_min,S),M-this.frame_tm>3e3){const D=Math.round(1e3/(this.frame_diff/this.frame_cnt));if(s.display_meta_information("fFPS",D),s.display_meta_information("fMAX",Math.round(1e3/this.frame_min)),s.display_meta_information("fMIN",Math.round(1e3/this.frame_max)),this.frame_diff=0,this.frame_cnt=0,this.frame_tm=M,this.frame_min=1/0,this.frame_max=-1/0,this.stability_listeners.length&&D>this.stability_threshold){debug$4&&console.log("FPS is stable:",D);for(const k of this.stability_listeners)k();this.stability_listeners=[]}}if(this.warmup_listeners.length>0&&this.total_count>this.warmup_threshold){debug$4&&console.log("Warmup");for(const D of this.warmup_listeners)D();this.warmup_listeners=[]}this.total_count++}render_st=0;render_tm=0;render_cnt=0;render_diff=0;best_fps=0;fps_counter=0;fps_tm=performance.now();fps_arr=[0,0,0,0,0];fps_index=0;begin_render(){const y=performance.now();if(this.render_st=y,this.fps_counter++,y-this.fps_tm>1e3){const M=this.fps_counter;this.fps_counter=0,this.fps_tm=y,this.fps_arr[this.fps_index++%this.fps_arr.length]=M;let S=0;for(const D of this.fps_arr)S<D&&(S=D);this.best_fps=S,DMC.mmd_animation_helper?.setPhysicsFPS(M>60?M:60)}}end_render(){const M=performance.now();if(this.render_diff+=M-this.render_st,this.render_cnt++,M-this.render_tm>3e3){const S=Math.round(1e3/(this.render_diff/this.render_cnt));s.display_meta_information("rFPS",S),this.render_diff=0,this.render_cnt=0,this.render_tm=M}}}s.fps_metric=new h,s.fps_metric.stability_listeners.push(()=>{if(window.disable_physics)return;const w=s.ui.system_flags.physics==!0;w?(s.mmd_animation_helper&&s.mmd_animation_helper.enable("physics",w),debug$4&&console.log("Physics has enabled.")):s.mmd_animation_helper&&s.mmd_animation_helper.enable("physics",w)});let _=performance.now(),b=0;s.update_display=function(){if(window.is_locked_rendering())return;let y=(s.static_clock||s.synchronized_clock||s.clock).getDelta();const M=y;y=s.playing_state==a.PLAYING?y:0,y*=s.playbackRate;let S=null;s.delta_queue.length>0&&(S=s.delta_queue.pop(),s.delta_queue.length=0);const D=s.fps_metric,k=s.ready,O=s.stats,L=s.base_renderer,P=s.scene,N=s.helper_scene,z=s.current.camera||s.camera,K=s.controls,Z=s.environment_map_manager,V=s.xr?.isEntered;if(D.begin_frame(),s.draw_thread_before_runner.length>0){for(const H of s.draw_thread_before_runner)H();s.draw_thread_before_runner=[]}if(k){O.begin(),s.renderer_animation_update(y,S,M),K&&K.update();{const H=performance.now();if(b=H-_,!window.rendering_throttling||b>250)_=H;else return}if(P.traverse(H=>{if(UpdateSounds(H,s.animation_world_time,y),H.isMesh&&H.material)if(Array.isArray(H.material))for(const Y of H.material)o.set(Y,{visible:Y.visible}),Y.visible==!0&&(Y.visible=Y.opacity>Y.alphaTest);else{const Y=H.material;o.set(Y,{visible:Y.visible}),Y.visible==!0&&(Y.visible=Y.opacity>Y.alphaTest)}}),L&&s.backgrounds.size>0&&V==!1){const H=L.autoClear;L.autoClear=!1;for(const[Y,q]of s.backgrounds)q.render(L,P,z,y);L.autoClear=H}if(s.enabled_progressive_surface_map&&(s.progressive_surface_map_update(),s.progressive_surface_map&&s.progressive_surface_map.firstUpdate),s.main_is_ready3){let H=!1;if(s.needsPrecompile){performance.now(),s.needsPrecompile=!1;const J=!1;if(s.main_is_ready4=performance.now(),s.getRenderer().render(P,z,y),H&&J){window.C.modal_processing_delete_description_by_id("__shader_compile__");for(const te in m){const ie=m[te];ie.object.visible=ie.visible}m={}}H=!0}if(!s.main_is_ready4)return;const Y=performance.now();D.begin_render(),Z.render_env(P,z);const q=s.getRenderer();s.csm&&s.csm.update(),q.render(P,z,y),D.end_render(),performance.now()-Y>1e3&&console.log(`%cDrop Frame: ${Math.floor(performance.now()-Y)} ms`,"color:#FF0000")}if(P.traverse(H=>{if(H.isMesh&&H.material)if(Array.isArray(H.material))for(const Y of H.material){const q=o.get(Y);q&&(Y.visible=q.visible)}else{const Y=H.material,q=o.get(Y);q&&(Y.visible=q.visible)}}),s.overlay_scene&&V==!1){const H=L.autoClear;L.autoClear=!1,L.clearDepth(),L.render(s.overlay_scene,z),L.autoClear=H,s.overlay_scene.traverse(Y=>{const q=Y.user.updaters;if(q)for(const J in q)q[J](y)})}if(L&&s.show_helper_semaphore==0&&!window.app_mode&&V==!1)if(s.helper_view_behavior==0){if(s.playing_state!=a.PLAYING){if(N){N.traverse(Y=>{if(Y?.update?.(),Y.user.updaters){const q=Y.user.updaters;for(const J in q)q[J](y)}});const H=L.autoClear;L.autoClear=!1,L.clearDepth(),L.render(N,z),L.autoClear=H}s.viewport_overlay.render(L)}}else if(s.helper_view_behavior==1){if(s.playing_state!=a.PLAYING){const H=s.current.object;for(let Y=0;Y<P.children.length;Y++){const q=P.children[Y];q.helper_visible!==void 0&&(q==H?q.helper_visible=!0:q.helper_visible=!1)}if(N){N.traverse(q=>{if(q?.update?.(),q.user.updaters){const J=q.user.updaters;for(const W in J)J[W](y)}});const Y=L.autoClear;L.autoClear=!1,L.clearDepth(),L.render(N,z),L.autoClear=Y}s.viewport_overlay.render(L)}}else if(s.helper_view_behavior==2){const H=s.current.object;for(let Y=0;Y<P.children.length;Y++){const q=P.children[Y];q.helper_visible!==void 0&&(q==H?q.helper_visible=!0:q.helper_visible=!1)}if(N){N.traverse(q=>{if(q?.update?.(),q.user.updaters){const J=q.user.updaters;for(const W in J)J[W](y)}});const Y=L.autoClear;L.autoClear=!1,L.clearDepth(),L.render(N,z),L.autoClear=Y}s.playing_state!=a.PLAYING&&s.viewport_overlay.render(L)}else s.helper_view_behavior==3;!s.main_is_ready&&s.main_is_ready3&&(s.main_is_ready=!0),O.end()}if(L&&s.overlays.size>0&&V==!1){const H=L.autoClear;L.autoClear=!1;for(const Y in s.overlays)s.overlays[Y].render(L,P,z,y);L.autoClear=H}if(c=!1,s.draw_thread_after_runner.length>0){for(const H of s.draw_thread_after_runner)H();s.draw_thread_after_runner=[]}D.end_frame()};{s.update_display_async=async()=>{s.update_display(),d&&(d=!1,s.request_display(!1))},s.restart_animator=()=>{window.lock_rendering(),s.base_renderer.setAnimationLoop(null),s.base_renderer.setAnimationLoop(s.registered_request_display_function),console.warn("Animator restarted."),window.unlock_rendering()};let w=0,y=0,M=performance.now(),S=null;s.renderer_observer=D=>{w=0,y=0,M=performance.now(),S&&clearInterval(S),D?S=setInterval(()=>{const k=performance.now();k-M>5e3&&(M=k,s.restart_animator())},2501):S=null},s.request_display=D=>{const k=performance.now();if(M=k,s.xr?.isEntered)s.update_display();else if(D){const L=i.fps;if(L==-1||L==null)s.update_display();else{const P=1e3/L;y=k-w,y>P&&(w=k-y%P,s.update_display())}}else{if(i.fps!=0)return;c==!1?(y=k-w,y>100&&(w=k-y%100,c=!0,d=!1,s.update_display_async())):d=!0}},s.register_render_loop=()=>{s.registered_request_display_function=()=>{s.request_display(!0)},s.base_renderer.setAnimationLoop(s.registered_request_display_function),s.renderer_observer(!0)}}if(s.stats==null)s.stats=Stats(),s.stats.dom.style.position="absolute",s.stats.dom.style.top="5px",s.stats.dom.style.left="5px",s.stats.dom.style.display="none",document.getElementById("main_frame").appendChild(s.stats.dom);else debugger;const v=s.canvas;window.app_mode||(s.base_renderer.domElement.style.borderRadius="4px",s.base_renderer.domElement.style.width="calc(100% - 2px)",s.base_renderer.domElement.style.height="calc(100% - 2px)",s.base_renderer.domElement.style.border="0px"),v.appendChild(s.base_renderer.domElement),v.appendChild(s.stats.dom),UI_TransformController();{const w=document.getElementsByClassName("transform_controls_switch_button");for(let y=0;y<w.length;y++)w[y].dataset.display=w[y].style.display,l.push(w[y])}for(const w of l)w.dataset.display=w.style.display;s.helper_doms=l,s.ready=!0,e.finish()}var debug$3=window.debug;async function load_files(s,e){window.lock_rendering();const i={confirm:!0,ui:!0};e&&Object.assign(i,e);let r=[],o=!1,l=!1;if(DMC.scene.traverse(c=>{const d=c.getDDDProperties?.()||{};if(d.audio?.instance){const u=d.audio.instance;try{u.stop()}catch(f){console.warn(f)}}if(c.isMesh&&c.material)if(Array.isArray(c.material))for(let u=0;u<c.material.length;u++){const f=c.material[u];for(const m in f)f[m]instanceof THREE.VideoTexture&&f[m].stop&&f[m].stop()}else{const u=c.material;for(const f in u)u[f]instanceof THREE.VideoTexture&&u[f].stop&&u[f].stop()}}),s.length>0){let c=s[0],d=null,u=null,f=null,m=null;if(typeof c!="string"){const h=c;m=h.keep_previous_prop,c=h.file_path}i.ui&&C$2.modal_processing("Loading <span onclick='DMC.reset()' style='float:right'><i style='color:#A66' class='bi bi-power'></i></span>",c),await C$2.sleep(32);try{for(let h of s){debug$3&&console.log("Load:",h),typeof h!="string"&&(d=h.loading_behavior,u=h.loaded,f=h.onerror,h=h.file_path);const _=Builder3D.file_type(h),b=h.split(".").pop().toLowerCase();if(_=="project")if(debug$3&&console.log(_),i.ui&&C$2.close_modal_processing(),debug$3&&console.log("Confirmation"),i.confirm!=!0||await C$2.modal_ok_cancel_promise(window.T("g.confirmation"),"Current project will be cleared.")){debug$3&&console.log("Setup");const v=await SetProjectPath(h);await __storage__.project.set("previous_project_file",v),DMC.reload(),debug$3&&console.log("Reload");return}else debug$3&&console.log("Canceled");else if(_=="j_object"&&(b=="motion"||b=="operator")){debug$3&&console.log(_);const v=await C$2.s_decode_async(await window.cross_file_system.read(h));if(v.instance?.load_type=="list"){const w=v.instance.list;let y=[];DMC.scene.traverse(k=>{k?.isSkinnedMesh&&k.getDDDProperties?.()?.type=="pmx"&&y.push(k)});const M=v.instance.absolute_path_mode,S=DMC.current.object;let D=0;for(const k of w){const O=k.attach;let L=k.source_file;const P=k.condition;let N=null;if(O=="camera")N=DMC.current.camera||DMC.camera;else if(O=="current")N=S;else if(O=="pmx_order")N=y[D++];else if(O=="specified_pmx"){if(P)for(const K of y){if(K.skeleton?.bones){const Z=P.has_bone;if(Z){for(const V of K.skeleton.bones)if(V.name==Z&&(N=K,N))break}}if(N)break}}else if(O=="specified_pmx_order"){if(P)for(let K=0;K<y.length;K++){const Z=y[K];if(Z.skeleton?.bones){const V=P.has_bone;if(V){for(const H of Z.skeleton.bones)if(H.name==V&&(N=Z,N))break}}if(N)break}N&&(y=y.filter(K=>K!=N),D++)}else O=="specified"||O=="scene"&&(N=DMC.scene);const z=DMC.current.object;r.push({instance:N,post_processing:()=>{DMC.reset_animation_of_single_object(z)}}),console.log(N,L,k),N&&L&&(DMC.current.object=N,M==!1&&(L=C$2.DPathJoin(C$2.DPath(h).dirname,L)),await load_files([L]))}}}else{let v=DMC.scene;_=="model"||b=="object"||(v=DMC.current.object||DMC.scene),_=="sound"&&(l=!0);try{const w=await load_file(h,{loading_behavior:d,loaded:u,keep_previous_prop:m});(_=="model"||_=="sound"||b=="object")&&(DMC.current.object=w),(b=="vmd"||b=="vpd"||b=="fba"||b=="gla")&&(o=!0);const y=DMC.current.object;r.push({instance:w,post_processing:()=>{DMC.reset_animation_of_single_object(y)}})}catch(w){console.error(w),i?.onerror?.(w),f&&f(w),await UI.delete_file_history(h);const y=w.message||w.toString();if(i.ui&&C$2.close_modal_processing(),y=="Canceled"||i.ui&&await C$2.modal_ok_cancel_promise("Error",`${y}`,{ok:"Skip this file"}))await C$2.sleep(32),await C$2.sleep(32);else{DMC.reset_animation(0),DMC.stop_button?.click?.(),DMC.dispatchEvent("change@scene",{object:DMC.scene}),window.unlock_rendering();return}}}}i.ui&&C$2.close_modal_processing()}catch(h){console.error(h),i.ui&&C$2.close_modal_processing(),i.ui&&C$2.modal_ok_cancel("Error",h,{cancel:null},()=>{})}DMC.current?.object&&DMC.ui?.tree?.focus?.(DMC.current.object.uuid),setTimeout(()=>{DMC.scene&&DMC.scene.traverse(h=>{const _=h.getDDDProperties?.();_&&_.apply_attach_object(h)})},1e3)}(o||l)&&DMC.dispatchEvent("change@action",{});for(const c of r)c.instance&&await c.instance.getDDDProperties?.()?.on_ready?.(),c.post_processing&&c.post_processing();debug$3&&console.log("Done"),DMC.needsPrecompile=!0,i.ui&&C$2.modal_processing_replace_description_by_id("__shader_compile__","Shader compiling...."),DMC.dispatchEvent("change@scene",{object:DMC.scene}),window.unlock_rendering()}async function open_script_editor(s){try{const e=await window.cross_file_system.read(s),i=new TextDecoder().decode(new Uint8Array(e));let r="javascript";if(s){const o=s.split(".").pop().toLowerCase();o=="js"||o=="mjs"?r="javascript":o=="txt"?r="text":o=="rb"?r="ruby":o=="css"?r="css":o=="scss"?r="scss":o=="html"?r="html":o=="json"?r="json":o=="py"?r="python":o=="cpp"?r="cpp":o=="c"?r="c":o=="cs"?r="cs":o=="ts"&&(r="typescript")}UC$1.open_script_editor(s,{title:s,text:i,mode:r},async function(o,l){l=l.normalize("NFC");const a={local_variables:{}};if(a.local_variables.__dirname=C$2.DPath(s).dirname,o=="save")window.cross_file_system.write(s,l);else if(o=="run"){window.cross_file_system.write(s,l);const c={script:l,script_mode:r};window.script_runner(c,a)}})}catch(e){console.error(e)}}async function load_file(s,e={}){debug$3&&console.log("load_file:",s);let i=null;const r=C$2.DPath(s),o=Builder3D.file_type(r.path);debug$3&&console.log("load_file:file_type",o,s);let l=!1,a=e.loading_behavior||document.getElementById("load_file_behavior").value;{const c=DMC.current.object?.getDDDProperties?.();if(c?.audio?.instance){const d=c.audio.instance;try{d.isPlaying&&d.stop()}catch(u){console.warn(u)}}}if(o=="model")l=!0,i=await Builder3D.build_by_file_path(s);else if(o=="motion")i=await Builder3D.build_by_file_path(s,DMC.current.object),UI.store_file_history(s);else if(o=="pose")i=await Builder3D.build_by_file_path(s,DMC.current.object),UI.store_file_history(s);else if(o=="image"){if(C$2.is_env_image_ext(r.ext))DMC.scene&&Builder3D.load_texture(r.path,(c,d)=>{c?console.error(c):d&&(DMC.scene.background?.dispose&&DMC.scene.background.dispose(),DMC.scene.environment?.dispose&&DMC.scene.environment.dispose(),DMC.scene.background=d.clone(),DMC.scene.environment=d.clone(),d.dispose())});else{const c=DMC.current.object?.__material_modifier__;if(DMC.current.object?.__material_modifier__){const d=C$2.DPath(s);Builder3D.load_texture(d.path,(u,f)=>{u?console.error(u):f&&(c.modify_selected({needsUpdate:{texture:!0,material:!0}},m=>{const h=d.basename.toLowerCase();let _=null;const b=d.ext=="ktx2",v=w=>{for(const y of w)if(h.search(`[^a-z]${y}[^a-z]`)>=0)return!0;return!1};if(v(["albedo","diffuse"]))_="map";else if(v(["specular","roughness"]))m.specularMap!==void 0&&(_="specularMap"),m.roughnessMap!==void 0&&(_="roughnessMap");else if(v(["metalness"]))_="metalnessMap";else if(v(["emissive"]))_="emissiveMap";else if(v(["displacement"]))_="displacementMap";else if(v(["opacity","alpha"]))_="alphaMap";else{if(v(["translucency"]))return;if(v(["transmission"]))_="transmissionMap";else if(v(["normal"]))_="normalMap";else{if(v(["fuzz"]))return;v(["bump"])?_="bumpMap":v(["norm"])?_="normalMap":v(["spec"])?(m.specularMap!==void 0&&(_="specularMap"),m.roughnessMap!==void 0&&(_="roughnessMap")):v(["nrm"])?_="normalMap":v(["ao"])?_="aoMap":v(["s"])?(m.specularMap!==void 0&&(_="specularMap"),m.roughnessMap!==void 0&&(_="roughnessMap")):v(["n"])?_="normalMap":_="map"}}if(_){const w=m[_];w&&(m[_]=null,w.dispose()),m[_]!==void 0&&(m[_]=f.clone(),w?CopyTextureProperties$1(m[_],w):_=="map"&&(m[_].flipY=!b,m[_].colorSpace=THREE.SRGBColorSpace),m[_].source_file=d.path,m[_].needsUpdate=!0)}}),f.dispose())})}}UI.store_file_history(s)}else if(o=="sound")i=await Builder3D.build_by_file_path(s,DMC.current.object),UI.store_file_history(s),l=!0;else if(o=="etc")i=await Builder3D.build_by_file_path(s,DMC.current.object),UI.store_file_history(s);else if(o=="j_object"){l=!0;const c=await window.cross_file_system.read(s);let d=null;try{d=await C$2.s_decode_async(c)}catch(u){console.warn(u);try{d=C$2.b_decode(c)}catch(f){console.error(s,f)}}i=await Builder3D.load_object(DMC.current.object,d,{base_path:s}),i==null&&(a="attach",i=DMC.current.object)}else o=="script"&&(s=s.replace(/\\/g,"/"),open_script_editor(s),UI.store_file_history(s));if(l)if(i){if(RegenerateUUIDForDecoProp(i),a=="append_to_scene")DMC.scene.add(i),DMC.current.object=i;else if(a=="append_as_child")DMC.current.object?DMC.current.object.add(i):DMC.scene.add(i),DMC.current.object=i;else if(a=="attach")await Builder3D.build_etc(i),i.pose&&i.pose(),i._animation_clock_!==void 0&&DMC.reset_animation_of_single_object(i);else if(a=="replace"){performance.now();const c=await DMC.getGlobalUIFlags(),d=DMC.current.object,u=d?.getDDDProperties?.();if(d&&d!=DMC.scene&&u?.removable){if(d.isCamera){if(C$2.close_modal_processing(),!await C$2.modal_ok_cancel_promise("Replace",`The replace target object is camera object(${d.constructor.name}).<br>Are you sure?`))throw new Error("Canceled");C$2.modal_processing("Loading <span onclick='DMC.reset()' style='float:right'><i style='color:#A66' class='bi bi-power'></i></span>",s)}else if(d.isLight){if(C$2.close_modal_processing(),!await C$2.modal_ok_cancel_promise("Replace",`The replace target object is light object(${d.constructor.name}).<br>Are you sure?`))throw new Error("Canceled");C$2.modal_processing("Loading <span onclick='DMC.reset()' style='float:right'><i style='color:#A66' class='bi bi-power'></i></span>",s)}const f=d,m=i,h=f.getDDDProperties?.(),_=m.getDDDProperties?.(),b=f._animation_clock_;if(h.type==_.type){if((c.replace_mode_trs||e.keep_previous_prop)&&m.position&&f.position&&(m.position.copy(f.position),m.rotation.copy(f.rotation),m.quaternion.copy(f.quaternion),m.scale.copy(f.scale)),(c.replace_mode_material||e.keep_previous_prop)&&m.name.length>0&&m.name==f.name&&(console.warn("Replace Material:",m.name),LoadMaterialProperties(m,f,{},{match_by_name:!0,force_copy_texture:!0,log:!1})),c.replace_mode_object_prop||e.keep_previous_prop){const v={type:!0,name:!0,script:!0};Object.assign(v,c.replace_mode_trs?{}:{position:!0,rotation:!0,quaternion:!0,scale:!0}),c.replace_mode_material||(v.material=!0),LoadObjectProperties(m,f,v)}if((c.replace_mode_deco_prop||e.keep_previous_prop)&&CopyObjectDecoProperties(m,f),c.replace_mode_action||e.keep_previous_prop){const v=m._dp_,w=f._dp_;v.action=w.action,v.action_table=w.action_table}if(await Builder3D.build_etc(m),(c.replace_mode_morphing||e.keep_previous_prop)&&m.morphTargetInfluences&&f.morphTargetInfluences&&m.morphTargetDictionary&&f.morphTargetDictionary)for(const v in m.morphTargetDictionary){const w=f.morphTargetInfluences[v];w&&(m.morphTargetInfluences_cache[w]=f.morphTargetInfluences_cache[w],m.morphTargetInfluences_coef[w]=f.morphTargetInfluences_coef[w],m.morphTargetInfluences[w]=0,m.morphTargetInfluences_backup[w]=0)}}(c.replace_mode_trs||e.keep_previous_prop)&&m.position&&f.position&&(m.position.copy(f.position),m.rotation.copy(f.rotation),m.scale.copy(f.scale)),m.getDDDProperties(),Builder3D.replace_object(f,m),m.reloadActions&&await m.reloadActions(),m._animation_clock_=b,DMC.reset_animation_of_single_object(m)}else DMC.scene.add(i);DMC.current.object=i}else a=="selector"&&C$2.modal_ok_cancel("Select","Not implemented yet@XQ8VCMCVYB",{},c=>{});e.loaded&&e.loaded({instance:i,path:s,params:e}),UI.store_file_history(s)}else console.error(`Error: ${s}`),window.terminal_error(`Error: ${s}`),await UI.delete_file_history(s);return i&&(await i.getDDDProperties?.()?.on_ready?.(),await BuilderUtil.tessellate(i)),i}const UIL$1=Object.freeze(Object.defineProperty({__proto__:null,load_files,open_script_editor},Symbol.toStringTag,{value:"Module"})),ICON_BASE_URL="ddd/system_assets/icons/";var TreeComponent=function(){this.dom=null,this.event_listener=null};TreeComponent.prototype.initialize=function(s){this.params=s,this.dom=s.dom,this.index_counter=0};function build_item(s,e,i,r){const o=e.dom,l=ICON_BASE_URL,a=document.createElement("div");let c=null;const d=document.createElement("i"),u=document.createElement("i"),f=document.createElement("i"),m=document.createElement("i"),h=document.createElement("i"),_=document.createElement("i"),b=document.createElement("i"),v=document.createElement("i"),w=document.createElement("div");a.dataset.reference=s.uuid,a.style.width="calc(100% - 2px)",a.style.display="flex",a.style.alignItems="center",a.style.height="15px",a.style.fontSize="12px",a.style.position="relative",a.classList.add("tree_component_item"),w.classList.add("tree_component_item_text");const y=e.index_counter++%2==0;a.dataset.odd=y?"true":"false";const M=s.getDDDProperties?.();M?.controllable_geometry==!0&&(a.ondblclick=function(L){e.event_listener&&e.event_listener(L,{target:a})}),a.onmouseenter=function(L){a.style.backgroundColor=y?"#5566AA55":"#6677BB55"},a.onmousedown=function(L){if(a.style.backgroundColor=y?"#7777BB22":"#8888CC22",L.button==0||L.button==2){const P=document.querySelectorAll(".tree_component_item");let N=L.shiftKey||L.ctrlKey||L.metaKey;L.button==2&&(N||a.classList.contains("active")&&(N=!0));let z=null,K=-1,Z=-1;for(let V=0;V<P.length;V++){const H=P[V];H instanceof HTMLElement&&(N||(H.classList.remove("active"),H.dataset.first_select="false"),L.shiftKey&&H.classList.remove("active"),H.dataset.first_select=="true"&&(z=H,Z=V),H.isEqualNode(a)&&(K=V))}if(!N)a.dataset.first_select="true";else if(L.shiftKey&&z&&K>=0&&Z>=0)if(K<Z)for(let V=K;V<=Z;V++)P[V].classList.add("active");else for(let V=Z;V<=K;V++)P[V].classList.add("active");a.classList.add("active")}e.event_listener&&e.event_listener(L,{target:a})},a.onmouseup=function(L){a.style.backgroundColor=y?"#5566AA55":"#6677BB55",e.event_listener&&e.event_listener(L,{target:a})},a.onmouseleave=function(L){a.style.backgroundColor=y?"#FFFFFF05":"#FFFFFF11"},a.style.backgroundColor=y?"#FFFFFF05":"#FFFFFF11";const S=s.type.toLowerCase();s.name.toLowerCase();const D=s._dp_?.type||"";let k=null;s instanceof THREE.InstancedMesh?(c=document.createElement("i"),c.classList.add("bi-boxes"),c.style.color="#C60"):s instanceof THREE.Sprite?(c=document.createElement("i"),c.classList.add("bi-circle"),c.style.color="#C60"):s.isCamera?(c=document.createElement("i"),c.classList.add("bi-camera-video-fill"),c.style.color="#3A3"):S.indexOf("audiolistener")>=0?(c=document.createElement("i"),c.classList.add("bi-headphones"),c.style.color="#38F"):S.indexOf("audio")>=0?(c=document.createElement("i"),c.classList.add("bi-music-note-beamed"),c.style.color="#38F"):D.indexOf("directional_light")>=0?(c=document.createElement("i"),c.classList.add("bi-sunrise-fill"),c.style.color="#FF0"):D.indexOf("ambient_light")>=0?(c=document.createElement("i"),c.classList.add("bi-lamp-fill"),c.style.color="#F94"):D.indexOf("hemisphere_light")>=0?(c=document.createElement("i"),c.classList.add("bi-circle-half"),c.style.color="#DA4"):D.indexOf("spot_light_helper")>=0?(c=document.createElement("i"),c.classList.add("bi-sm"),c.style.color="#A80"):D.indexOf("rect_area_light")>=0?(c=document.createElement("i"),c.classList.add("bi-square-half"),c.style.color="#A80"):D.indexOf("spot_light_direction")>=0?(c=document.createElement("i"),c.classList.add("bi-sm"),c.style.color="#A80"):D.indexOf("light_probe")>=0?(c=document.createElement("i"),c.classList.add("bi-sun"),c.style.color="#DB0"):D.indexOf("spot_light")>=0?(c=document.createElement("i"),c.classList.add("bi-triangle-fill"),c.style.color="#ED0"):D.indexOf("light")>=0?(c=document.createElement("i"),c.classList.add("bi-lightbulb-fill"),c.style.color="#FC0"):D.indexOf("transform_controls")>=0?(c=document.createElement("i"),c.classList.add("bi-cog"),c.style.color="#888"):D.indexOf("sky")>=0?(c=document.createElement("i"),c.classList.add("bi-cloud-sun-fill"),c.style.color="#DFF"):D.indexOf("pmx")>=0?(c=document.createElement("img"),c.src=l+"pmx.png",k="15px",c.style.marginLeft="3px",c.style.marginRight="3px"):D.indexOf("stl")>=0?(c=document.createElement("img"),c.src=l+"stl.png",k="15px",c.style.marginLeft="2px",c.style.marginRight="4px"):D.indexOf("vrm")>=0||D.indexOf("gltf")>=0||D.indexOf("glb")>=0||D.indexOf("vrm")>=0?(c=document.createElement("img"),c.src=l+"gltf.png",k="15px",c.style.marginLeft="2px",c.style.marginRight="4px"):D.indexOf("fbx")>=0?(c=document.createElement("img"),c.src=l+"fbx.png",k="15px",c.style.marginLeft="2px",c.style.marginRight="4px"):D.indexOf("3ds")>=0?(c=document.createElement("img"),c.src=l+"3ds.svg",k="15px",c.style.marginLeft="2px",c.style.marginRight="4px"):D.indexOf("lwo")>=0?(c=document.createElement("img"),c.src=l+"lwo.png",k="15px",c.style.marginLeft="2px",c.style.marginRight="4px"):D.indexOf("dae")>=0?(c=document.createElement("img"),c.src=l+"dae.png",k="15px",c.style.marginLeft="2px",c.style.marginRight="4px"):D.indexOf("grid_floor")>=0?(c=document.createElement("i"),c.classList.add("bi-border"),c.style.color="#FFF"):D.indexOf("polar_floor")>=0?(c=document.createElement("i"),c.classList.add("bi-border-all"),c.style.color="#FFF"):D.indexOf("wood_floor")>=0?(c=document.createElement("i"),c.classList.add("bi-border-outer"),c.style.color="#A70"):D.indexOf("water_floor")>=0?(c=document.createElement("i"),c.classList.add("bi-water"),c.style.color="#4AF"):D.indexOf("floor")>=0?(c=document.createElement("i"),c.classList.add("bi-square-fill"),c.style.color="#AAA"):D.indexOf("js")>=0?(c=document.createElement("i"),c.classList.add("bi-file"),c.style.color="#FD2"):D.indexOf("dynamic_env_helper")>=0?(c=document.createElement("i"),c.classList.add("bi-pentagon-half"),c.style.color="#AAA"):D.indexOf("plane_mirror")>=0?(c=document.createElement("i"),c.classList.add("bi-slash-square"),c.style.color="#AAA"):S.indexOf("skinnedmesh")>=0?(c=document.createElement("i"),c.classList.add("bi-bounding-box-circles"),c.style.color="#C60"):S.indexOf("mesh")>=0?(c=document.createElement("i"),c.classList.add("bi-box"),c.style.color="#C60"):S.indexOf("line")>=0?(c=document.createElement("i"),c.classList.add("bi-slash"),c.style.color="#0FC"):S.indexOf("bone")>=0?(c=document.createElement("i"),c.classList.add("bi-link-45deg"),c.style.color="#BA8"):S.indexOf("scene")>=0?(c=document.createElement("i"),c.classList.add("bi-archive"),c.style.color="#FFF"):S.indexOf("object3d")>=0?(c=document.createElement("i"),c.classList.add("bi-diamond-fill"),c.style.color="#AAA"):D.indexOf("obj")>=0?(c=document.createElement("img"),c.src=l+"obj.png",k="15px",c.style.marginLeft="2px",c.style.marginRight="4px"):S.indexOf("group")>=0?(c=document.createElement("i"),c.classList.add("bi-diagram-3-fill"),c.style.color="#0CF"):(c=document.createElement("i"),c.classList.add("bi-dice-d6"),c.style.color="#C60"),c.classList.add("tree_component_item_icon"),c.classList.add("bi"),c.style.maxWidth=c.style.minWidth=c.style.width=k||"20px",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",d.style.maxWidth=d.style.minWidth=d.style.width="17px",d.style.marginLeft=17*i+"px",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="center",d.classList.add("bi"),d.classList.add("bi-lg"),d.style.color="#AAD",u.classList.add("bi"),b.classList.add("bi"),v.classList.add("bi"),m.classList.add("bi"),f.classList.add("bi"),h.classList.add("bi"),m.classList.add("bi-universal-access"),f.classList.add("bi-music"),h.classList.add("bi-bounding-box-circles"),m.style.cssText="display:none;width:15px;color:#4F4",h.style.cssText="display:none;width:15px;color:#DC4",f.style.cssText="display:none;width:15px;margin-right:2px;color:#AAF",_.classList.add("fab"),_.classList.add("bi-code-slash"),_.style.cssText="display:none;width:15px;color:#4F4",s.visible?(u.style.color="#AAA",u.classList.add("bi-eye")):(u.style.color="#666",u.classList.add("bi-eye-slash")),s.helper_visible?(b.style.color="#AAA",b.classList.add("bi-eye")):(b.style.color="#666",b.classList.add("bi-eye-slash")),s.getDDDProperties?.().transform_controller?(v.style.color="#AAA",v.classList.add("bi-unlock")):(v.style.color="#666",v.classList.add("bi-lock"));{const L=document.createElement("span");L.style.position="absolute",L.style.right="5px",L.style.bottom="0px",L.style.fontSize="10px",L.innerText="H",L.style.color="#77AAFF",L.style.textShadow="-1px -1px 0 #333,  1px -1px 0 #333, -1px 1px 0 #333, 1px 1px 0 #333",b.style.position="relative",b.appendChild(L)}b.classList.add("helper_visibility"),_.onmouseup=_.onmousedown=_.ondblclick=v.onmouseup=v.onmousedown=v.ondblclick=b.onmouseup=b.onmousedown=b.ondblclick=u.onmouseup=u.onmousedown=u.ondblclick=function(L){L.stopPropagation(),L.preventDefault()},u.onclick=function(L){s.visible=!s.visible,s.visible?(u.style.color="#AAA",u.classList.add("bi-eye"),u.classList.remove("bi-eye-slash")):(u.style.color="#666",u.classList.add("bi-eye-slash"),u.classList.remove("bi-eye")),L.stopPropagation(),L.preventDefault(),DMC.dispatchEvent("update@dynamic_env_map")},b.onclick=function(L){s.helper_visible=!s.helper_visible,s.helper_visible?(b.style.color="#AAA",b.classList.add("bi-eye"),b.classList.remove("bi-eye-slash")):(b.style.color="#666",b.classList.add("bi-eye-slash"),b.classList.remove("bi-eye")),L.stopPropagation(),L.preventDefault()},M&&(v.onclick=function(L){M.transform_controller=!M.transform_controller,M.transform_controller?(v.style.color="#AAA",v.classList.add("bi-unlock"),v.classList.remove("bi-lock")):(v.style.color="#666",v.classList.add("bi-lock"),v.classList.remove("bi-unlock")),L.stopPropagation(),L.preventDefault(),DMC?.transform_controls&&DMC.transform_controls.detach()},s.getActions?.()&&(m.style.display="inline-block",m.onclick=function(L){document.getElementById("right_side_panel_tab_bone_button").click()}),s.morphTargetInfluences?.length>0&&(h.style.display="inline-block",h.onclick=function(L){document.getElementById("right_side_panel_tab_morphing_button").click()}),M.audio?.instance&&(f.style.display="inline-block",f.onclick=function(L){document.getElementById("right_side_panel_tab_object_button").click()})),s.script?.trim().length>0&&(_.style.display="inline-block");const O=document.createElement("div");return O.style.marginLeft="auto",O.style.display="flex",O.style.alignItems="center",O.style.position="absolute",O.style.right="0px",O.style.backgroundColor=y?"#333":"#444",b.style.textAlign="center",b.style.width=u.style.width="15px",u.style.textAlign="center",v.style.width="14px",v.style.height="14px",v.style.textAlign="center",a.dataset.uuid=s.uuid,a.dataset.index=r+"",a.appendChild(d),a.appendChild(c),a.appendChild(w),s.helper_visible!==void 0&&O.appendChild(b),O.appendChild(_),O.appendChild(f),O.appendChild(m),O.appendChild(h),O.appendChild(v),O.appendChild(u),a.appendChild(O),w.innerText=s.name||s.type,w.style.marginLeft="3px",w.style.overflow="hidden",w.style.whiteSpace="nowrap",o.appendChild(a),s.name?.length>0&&s.name,s.children?.length?(d.onclick=function(L){s._collapsible_?s._collapsible_=!1:s._collapsible_=!0,e.update()},s._collapsible_?(d.classList.add("bi-caret-down-fill"),!0):(d.classList.add("bi-caret-right-fill"),!1)):!1}function recursive_build(s,e,i=0,r={index:0}){if(build_item(s,e,i,r.index++))for(const o in s.children){const l=s.children[o];recursive_build(l,e,i+1,r)}}TreeComponent.prototype.open_tree_by_uuid=function(s){const e=DMC.getObjectByUUID(s);if(e){let i=function(r){r._collapsible_=!0,r.parent&&i(r.parent)};i(e),this.event_listener&&this.event_listener&&this.event_listener({type:"open_tree"},{target:e})}};TreeComponent.prototype.build=function(s,e){this.root=s,this.root._collapsible_=!0,this.index_counter=0,this.params=e,this.dom.innerHTML="",recursive_build(s,this)};TreeComponent.prototype.update=function(){this.dom.innerHTML="",this.index_counter=0,recursive_build(this.root,this)};TreeComponent.prototype.focus=function(s){const e=document.getElementsByClassName("tree_component_item");for(let i=0;i<e.length;i++){const r=e[i];r instanceof HTMLElement&&r.dataset.uuid==s&&r.click()}};const _VALUE_CSS_={width:"100px"};function long_range_directional_light(s){const e=s.shadow,i=16384;e.mapSize.width=i,e.mapSize.height=i,e.bias=-1e-4;const r=2500;e.camera.near=1,e.camera.far=1e4,e.camera.left=-r,e.camera.right=r,e.camera.top=r,e.camera.bottom=-r,e.radius=2,e.blurSamples=8,e.map.dispose(),e.map=null,s.position.normalize(),s.position.multiplyScalar(5e3),e.camera.updateProjectionMatrix()}function short_range_directional_light(s){const e=s.shadow,i=16384;e.mapSize.width=i,e.mapSize.height=i,e.bias=-25e-5;const r=1250;e.camera.near=1,e.camera.far=2500,e.camera.left=-r,e.camera.right=r,e.camera.top=r,e.camera.bottom=-r,e.radius=2,e.blurSamples=8,e.map.dispose(),e.map=null,s.position.normalize(),s.position.multiplyScalar(1e3),e.camera.updateProjectionMatrix()}function large_room_range_directional_light(s){const e=s.shadow,i=8192;e.mapSize.width=i,e.mapSize.height=i,e.bias=-.001;const r=250;e.camera.near=1,e.camera.far=500,e.camera.left=-r,e.camera.right=r,e.camera.top=r,e.camera.bottom=-r,e.radius=2,e.blurSamples=8,e.map.dispose(),e.map=null,s.position.normalize(),s.position.multiplyScalar(200),e.camera.updateProjectionMatrix()}function small_room_range_directional_light(s){const e=s.shadow,i=4096;e.mapSize.width=i,e.mapSize.height=i,e.bias=-.0013;const r=50;e.camera.near=1,e.camera.far=100,e.camera.left=-r,e.camera.right=r,e.camera.top=r,e.camera.bottom=-r,e.radius=2,e.blurSamples=8,e.map.dispose(),e.map=null,s.position.normalize(),s.position.multiplyScalar(40),e.camera.updateProjectionMatrix()}function person_range_directional_light(s){const e=s.shadow,i=4096;e.mapSize.width=i,e.mapSize.height=i,e.bias=-.0014;const r=25;e.camera.near=1,e.camera.far=50,e.camera.left=-r,e.camera.right=r,e.camera.top=r,e.camera.bottom=-r,e.radius=2,e.blurSamples=8,e.map.dispose(),e.map=null,s.position.normalize(),s.position.multiplyScalar(25),e.camera.updateProjectionMatrix()}function create_modifier(s,e){const i={};i.each=r=>e.forEach(o=>r(o)),i.filter=e.filter,i.map=e.map;for(const r in s)Object.defineProperty(i,r,{get:function(){return s[r]},set:function(o){e.forEach(l=>{l[r]!==void 0&&(l[r]=o)})}});return i}function _md_(s){if(s){let e=!1;s.traverse(i=>{if(i.material)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)i.material[r].castDynamicEnvironment&&(e=!0);else i.material.castDynamicEnvironment&&(e=!0)}),s.isLight&&(e=!0),e&&DMC.dispatchEvent("update@dynamic_env_map")}}function GetDirectionalLight(){let s=null;return DMC.scene.traverse(e=>{e instanceof DirectionalLight&&(e.isCSMLight||(s=e))}),s}function NE(s){s instanceof DirectionalLight&&DMC.dispatchEvent("copy@cascaded_shadow_map_light",{light:s})}const TL$4=s=>(window.T&&window.T("tabs.object."+s),window.parent?.T?window.parent.T("tabs.object."+s):s);async function UI_ObjectPanel(){const s=DMC,e=s.current.object,i=document.getElementById("3d_object_panel"),r=i||document.createElement("div");s.ui.object_panel=i,r.innerHTML="";const l=s.scene.isXRMode?.1:1,a=document.getElementById("right_side_panel_tab_object_button");a&&a.classList.remove("no_item");function c(){const d=document.createElement("div");return d.style.width="100%",d.style.height="5px",d}if(e){const d=e.getDDDProperties?.()||{},u=d.controllable_geometry,f=s.get_selected_objects(),m=f.objects.filter(v=>v.getDDDProperties?.()?.controllable_geometry),h=create_modifier(e,f.objects),_=(v,w)=>{const y=s.current.camera||s.camera,M=e.position,S=new Vector3,D=new Vector3,k=new Vector3,O=new Vector3(0,1,0);k.copy(y.position),k.sub(M),k.normalize(),k.cross(O),k.normalize(),S.copy(M),S.project(y),D.copy(M),D.add(k),D.project(y),D.sub(S);const L=s.base_renderer.domElement.width,P=Math.max(1/Math.abs(L*D.x)*10,.1);return v+P*w*l};{const w=UC$1.make_toggle_window(r,{title:TL$4("object_trs"),toggle:!0},y=>{}).holder;if(UC$1.make_toggle(w,T("g.visibility"),e.visible,{},y=>{h.visible=y,_md_(e)}),u){let y=null,M=null,S=null,D=null,k=e.name!="DynamicEnvHelper";e.position!==void 0&&k&&(y=UC$1.make_vec3_box(w,T("g.position"),e.position,1,{step:.01*l,camera_step:!0,operator:_},P=>{m.forEach(N=>{N.position.x=P}),_md_(e),NE(e)},P=>{m.forEach(N=>N.position.y=P),_md_(e),NE(e)},P=>{m.forEach(N=>N.position.z=P),_md_(e),NE(e)})),e.target instanceof Object3D&&UC$1.make_vec3_box(w,"Target(L)",e.target.position,1,{step:.01*l,camera_step:!0,operator:_},P=>{m.forEach(N=>{N.target.position.x=P}),_md_(e),NE(e)},P=>{m.forEach(N=>N.target.position.y=P),_md_(e),NE(e)},P=>{m.forEach(N=>N.target.position.z=P),_md_(e),NE(e)}),e.target instanceof Vector3&&UC$1.make_vec3_box(w,"Target",e.target,1,{step:.01*l},P=>{e.target.x=P,_md_(e)},P=>{e.target.y=P,_md_(e)},P=>{e.target.z=P,_md_(e)});let O=e.rotation!==void 0&&k;e.isLight&&(e.type=="SpotLight"||e.type=="RectAreaLight"?O=!0:O=!1),O&&(D=UC$1.make_vec3_box(w,T("g.rotation"),e.rotation,Math.PI/180,{step:1},P=>{m.forEach(N=>N.rotation.x=P*Math.PI/180),_md_(e)},P=>{m.forEach(N=>N.rotation.y=P*Math.PI/180),_md_(e)},P=>{m.forEach(N=>N.rotation.z=P*Math.PI/180),_md_(e)}));let L=e.scale!==void 0&&k;e.isLight&&(L=!1),L&&(M=UC$1.make_vec3_box(w,T("g.scale"),e.scale,1,{initializers:[{title:"0.1",values:[.1,.1,.1]},{title:"5",values:[5,5,5]},{title:"10",values:[10,10,10]}],step:.01*l,default_values:[1,1,1],min_x:1e-5,min_y:1e-5,min_z:1e-5,operator:(P,N)=>P+N*l*.1},P=>{m.forEach(N=>N.scale.x=P),S.modifier.value=P,_md_(e)},P=>{m.forEach(N=>N.scale.y=P),_md_(e)},P=>{m.forEach(N=>N.scale.z=P),_md_(e)}),S=UC$1.make_float_box(w,T("g.all_scales"),e.scale.x,{min:0,precision:5,operator:(P,N)=>{let z=P*(1+l*N*.02);return N>0?z<12e-5&&(z=13e-5):N<0&&z<12e-5&&(z=0),z}},P=>{m.forEach(N=>N.scale.setScalar(P)),M.set(e.scale),_md_(e)})),s.setEventListener("change@geometry",function(P){y?.set(e.position),M?.set(e.scale),D?.set(e.rotation),S?.set(e.scale.x),_md_(e)})}}if(d.type=="audio"){let z=function(){N.innerHTML="",UC$1.make_float_box(N,"Base Rate",M.playback_rate,{step:.01,min:.25,max:1.5,value_css:{width:"80px"}},W=>{M.playback_rate=W,y.setPlaybackRate(M.playback_rate)}),UC$1.make_float_box(N,"Random Rate",S.playback_rate_random,{step:.01,min:0,max:.5,value_css:{width:"80px"}},W=>{S.playback_rate_random=W}),UC$1.make_float_box(N,"Volume",M.volume,{step:.01,min:0,max:3,value_css:{width:"80px"}},W=>{M.volume=W,y.setVolume(M.volume)}),UC$1.make_float_box(N,"Detune",M.detune,{step:.1,min:0,value_css:{width:"80px"}},W=>{M.detune=W,y.detune=M.detune}),UC$1.make_float_box(N,"Offset",M.offset,{step:.1,value_css:{width:"80px"}},W=>{M.offset=W,y.offset=M.offset}),UC$1.make_float_box(N,"Duration",M.duration,{step:.1,min:0,value_css:{width:"80px"}},W=>{M.duration=W<.01?void 0:W,y.duration=M.duration}),UC$1.make_pulldown(N,"DistanceModel",["inverse","exponential","linear"],M.distance_model,{},W=>{M.distance_model=W,y.setDistanceModel(M.distance_model)}),UC$1.make_float_box(N,"RefDistance",M.ref_distance,{step:.1,min:0,value_css:{width:"80px"}},W=>{M.ref_distance=W,y.setRefDistance(M.ref_distance)}),UC$1.make_float_box(N,"MaxDistance",M.max_distance,{step:.1,min:0,value_css:{width:"80px"}},W=>{M.max_distance=W,y.setMaxDistance(M.max_distance)}),UC$1.make_float_box(N,"RolloffFactor",M.rolloff_factor,{step:.1,min:0,value_css:{width:"80px"}},W=>{M.rolloff_factor=W,y.setRolloffFactor(M.rolloff_factor)}),UC$1.make_button(N,"Reset","Default",{value_css:{width:"100px"}},()=>{S.reset(),S.apply(),z()})},K=function(W){W.innerHTML="",S.keyframes.sort((te,ie)=>te.time-ie.time),UC$1.make_button(W,"New key","Create",{value_css:{width:"100px"}},()=>{s.draw_thread_after_runner.push(()=>{if(S.keyframes.filter(te=>te.time==s.animation_world_time.toFixed(2)).length==0){const te=C$2.clone(M);te.playback_rate+=S.playback_rate_random*.5-S.playback_rate_random*Math.random(),te.playback_rate=te.playback_rate.toFixed(2),te.time=s.animation_world_time.toFixed(2),S.keyframes.push(te),K(W)}})});for(let te=0;te<S.keyframes.length;te++){const ie=S.keyframes[te];UC$1.make_vec3_box(W,"",[ie.time,ie.playback_rate,null],1,{close_button:!0,operator:(oe,Ce,ve,we)=>{if(we==0){let Se=oe+Ce*.1;return Se=Math.max(-1,Se),Se}else if(we==1){let Se=oe+Ce*.01;return Se=Math.max(.25,Se),Se=Math.min(1.5,Se),Se}return 0}},(oe,Ce)=>{Ce?.event=="closed"?(S.keyframes.splice(te,1),K(W)):S.keyframes[te].time=Number(oe)},(oe,Ce)=>{S.keyframes[te].playback_rate=Number(oe)})}},q=function(){Y.innerHTML="";for(const W of d.fft.connectors)J(W);UC$1.make_button(Y,"","Add",{value_css:{width:"100px"}},()=>{d.fft.connectors.push({type:"material",name:null,sub_uuid:null,material_name:null,key:null,coef:.1,bias:0,max:1,color:new Color}),q()}),UC$1.make_key_value_with_slider(Y,"FFT St",d.fft.st,{min:0,max:1,step:.01},W=>{d.fft.st=W}),UC$1.make_key_value_with_slider(Y,"FFT Wd",d.fft.wd,{min:0,max:1,step:.01},W=>{d.fft.wd=W})},J=function(W){const te=[];s.scene.traverse(ve=>{te.push(ve)});const ie=document.createElement("div");ie.style.cssText="border-bottom:5px solid #333",Y.appendChild(ie),UC$1.make_pulldown(ie,"Type",[{key:"Object",value:"object"},{key:"Material",value:"material"},{key:"Morphing",value:"morphing"}],W.type,{},async ve=>{W.type=ve,W.instance=null,await Builder3D.builder_etc.makers.fft(e),Ce(W)});const oe=document.createElement("div");ie.appendChild(oe);function Ce(ve){oe.innerHTML="";const we=[{key:"None",value:null}];for(const Te of te){const ge=Te.getDDDProperties?.();if(ge){const Ee=Te.name.length>0?Te.name:Te.type;we.push({key:Ee,value:ge.uuid})}}const Se=document.createElement("div"),Re=document.createElement("div"),Fe=document.createElement("div"),$e=document.createElement("div");function Ue(Te){let ge=s.getObjectBySubUUID(Te.sub_uuid);return ge==null&&Te.name_match&&(ge=s.scene.find(Te.name_match,!0)),ge}function qe(Te){oe.contains(Re)||oe.appendChild(Re),Re.innerHTML="";const ge=Ue(Te),Ee=[{key:"None",value:null}];for(const Ie in ge)typeof ge[Ie]=="number"?Ee.push({key:Ie,value:Ie}):ge[Ie]instanceof Color&&Ee.push({key:Ie,value:Ie});UC$1.make_pulldown(Re,"ObjProp",Ee,Te.key,{},Ie=>{Te.key=Ie})}function _e(Te){oe.contains($e)||oe.appendChild($e),$e.innerHTML="";const ge=Ue(Te);if(ge.morphTargetDictionary){const Ee=[{key:"None",value:null}],Ie={};for(const Be in ge.morphTargetDictionary)Ie[ge.morphTargetDictionary[Be]]=Be;for(const Be in ge.morphTargetInfluences_cache){const Oe=Ie[Be];Ee.push({key:Oe,value:Be})}UC$1.make_pulldown($e,"Morphing",Ee,Te.key,{},Be=>{Te.key=Number(Be)})}}function be(Te){oe.contains(Se)||oe.appendChild(Se),Se.innerHTML="";const ge=Ue(Te);if(ge?.material){const Ee=[{key:"None",value:null}];let Ie=null;if(Array.isArray(ge.material))for(const Be in ge.material){const Oe=ge.material[Be];Ee.push({key:Oe.name,value:Oe.name}),Te.material_name==Oe.name&&(Ie=Oe)}else Ee.push({key:ge.material.name,value:ge.material.name}),Ie=ge.material;UC$1.make_pulldown(Se,"Material",Ee,Te.material_name,{},Be=>{Te.material_name=Be,Te.instance=null,Builder3D.builder_etc.makers.fft(e);let Oe=e.material;Array.isArray(ge.material)&&(Oe=ge.material.filter(ue=>ue.name==Be)[0]),De(Oe)}),De(Ie)}}function De(Te){oe.contains(Fe)||oe.appendChild(Fe),Fe.innerHTML="";const ge=[{key:"None",value:null}];for(const Ee in Te)typeof Te[Ee]=="number"?ge.push({key:Ee,value:Ee}):Te[Ee]instanceof Color&&ge.push({key:Ee,value:Ee});UC$1.make_pulldown(Fe,"MatProp",ge,ve.key,{},Ee=>{ve.key=Ee})}UC$1.make_pulldown(oe,"Object",we,ve.sub_uuid,{},async Te=>{ve.sub_uuid=Te,ve.instance=null;const ge=Ue(ve);ge.name?.length>0&&(ve.name_match=ge.name),await Builder3D.builder_etc.makers.fft(e),ve.type=="object"?qe(ve):ve.type=="morphing"?_e(ve):ve.type=="material"&&be(ve)}),ve.type=="object"?qe(ve):ve.type=="morphing"?_e(ve):ve.type=="material"&&be(ve)}Ce(W),typeof W.color=="number"&&(W.color=new Color(W.color)),UC$1.make_color_picker(ie,"Color","#"+W.color.getHex().toString(16).padStart(6,"0"),ve=>{W.color.setHex(ve)}),UC$1.make_key_value_with_slider(ie,"Coef",W.coef,{min:0,max:1,step:.01},ve=>{W.coef=ve}),UC$1.make_key_value_with_slider(ie,"Bias",W.bias,{min:0,max:5,step:.01},ve=>{W.bias=ve}),UC$1.make_key_value_with_slider(ie,"Max",W.max,{min:0,max:5,step:.01},ve=>{W.max=ve}),UC$1.make_button(ie,"","Delete",{value_css:{width:"100px"}},()=>{d.fft.connectors=d.fft.connectors.filter(ve=>ve!=W),q()})};r.appendChild(c());const w=UC$1.make_toggle_window(r,{title:TL$4("bgm_sound"),toggle:!0},W=>{}).holder,y=e,M=d.audio.base,S=d.audio,D=C$2.DPath(d.source_file),k=y.buffer.duration;let O=null;const L=UC$1.make_button(w,D.name,"Test",{value_css:{width:"100px"}},()=>{try{if(y?.isPlaying)y.stop(),L.modifier.innerHTML="Test",clearTimeout(O);else{S.apply(),y.playbackRate=M.playback_rate+S.playback_rate_random*Math.random(),L.modifier.innerHTML="Stop";const W=performance.now();y.play(M.delay),console.log("play cost:",performance.now()-W,"ms");const te=setTimeout(()=>{te!=O?clearTimeout(O):L.modifier.innerHTML="Test"},Math.round(k*1e3));O=te}}catch(W){console.warn(W)}});UC$1.make_key_value2(w,"Type",D.ext.toLowerCase(),{value_css:{width:"80px"}}),UC$1.make_float_box(w,"Delay",M.delay,{value_css:{width:"80px"}},W=>{M.delay=Number(W)}),UC$1.make_toggle(w,"Auto Start",S.auto_start,{},W=>{S.auto_start=W}),UC$1.make_toggle(w,"Mute",S.mute,{},W=>{S.mute=W}),UC$1.make_toggle(w,"3D",S.use_3d_sound,{},W=>{S.enable_3d_sound(W)}),UC$1.make_toggle(w,"Loop",S.loop,{},W=>{S.loop=W}),UC$1.make_toggle(w,"Synchronize with motion",S.synchronize,{},W=>{s.scene.traverse(te=>{const ie=te.getDDDProperties?.();ie&&ie.audio&&(ie.audio.synchronize=!1)}),S.synchronize=W,W?s.setSynchronizeClock(()=>y.time(),()=>{}):s.setSynchronizeClock(null)}),UC$1.make_button(w,"","Reload",{value_css:{width:"100px"}},()=>{UIL.load_files([{file_path:d.j_object_source_file||d.source_file,loading_behavior:"replace",onerror:W=>{console.error(W)},loaded:W=>{console.log(W)}}])});const N=UC$1.make_toggle_window(w,{title:TL$4("advanced"),toggle:!1},W=>{}).holder;z();const Z=UC$1.make_toggle_holder(w,"Keyframes",S.use_keyframes,{},W=>{S.use_keyframes=W});Z.update();const V=Z.holder;K(V);const H=UC$1.make_toggle_holder(w,"FFT",d.fft_enabled,{},W=>{d.fft_enabled=W,q()}),Y=H.holder;d.fft=d.fft??{value:0,connectors:[]},d.fft.connectors=d.fft.connectors??[],d.fft.value=d.fft.value??0,H.update(),d.fft_enabled,q()}if(e.fov!==void 0){r.appendChild(c());const w=UC$1.make_toggle_window(r,{title:TL$4("camera"),toggle:!0},y=>{}).holder;e.fov!==void 0&&UC$1.make_key_value_with_slider(w,"Fields of View",e.fov,{min:30,max:120,step:.1},y=>{e.fov=y,e.updateProjectionMatrix()}),e.near!==void 0&&UC$1.make_float_box(w,"Near Clip",e.near,{step:.01,min:1e-4},y=>{e.near=y,e.updateProjectionMatrix()}),e.far!==void 0&&UC$1.make_float_box(w,"Far Clip",e.far,{step:1},y=>{e.far=y,e.updateProjectionMatrix()}),e.target!==void 0&&e.target.position===void 0&&UC$1.make_vec3_box(w,"Target",e.target,1,{step:.05},y=>{e.target.x=y},y=>{e.target.y=y},y=>{e.target.z=y})}if(e.setText!==void 0){const w=UC$1.make_toggle_window(r,{title:TL$4("text_object"),toggle:!0},L=>{}).holder,y=d.text,M=()=>e.setText(e.getText());UC$1.make_script(w,"Text",e.getText?.(),{mode:"text",run:!1,value_css:{height:"150px"}},(L,P)=>{const N=P.value;L=="run"?e.setText?.(N):L=="editor"?UC$1.open_script_editor(e.uuid,{title:e.name,text:e.getText(),mode:"text"},async function(z,K){e.setText?.(K),P.value=K}):L=="input"&&e.setText?.(N)});const S=UC$1.make_key_value2(w,"Font",e.getFont?.(),{value_css:{width:"125px"}},L=>{e.setFont?.(L)});UC$1.make_key_value_with_slider(w,"Font Size",e.getFontSize?.(),{min:10,max:200,step:1},L=>{e.setFontSize?.(L)}),y.text_color=y.text_color??"#00000000",UC$1.make_color_picker(w,"TxtColor",y.text_color,L=>{y.text_color="#"+L.toString(16).padStart(6,"0"),M()}),y.background_color=y.background_color??"#00000000",UC$1.make_color_picker(w,"BgColor",y.background_color.slice(0,7),L=>{const P=y.background_color.slice(-2);y.background_color="#"+L.toString(16).padStart(6,"0")+P,M()}),UC$1.make_key_value_with_slider(w,"BgAlpha",parseInt(y.background_color.slice(-2),16),{min:0,max:1,step:.01},L=>{y.background_color=y.background_color.slice(0,7)+Math.floor(L*255).toString(16).padStart(2,"0"),M()});const D=UC$1.make_key_value_with_slider(w,"Width",y.width,{min:128,max:4096,step:1},L=>{y.width=L,M()}),k=UC$1.make_key_value_with_slider(w,"Height",y.height,{min:128,max:4096,step:1},L=>{y.height=L,M()});UC$1.make_button(w,"Sync Width-Height","Sync",{value_css:{width:"100px"}},()=>{k.update(D.modifier.value)}),y.edge_color=y.edge_color??"#000000",UC$1.make_color_picker(w,"EdgeColor",y.edge_color.slice(0,7),L=>{y.edge_color="#"+L.toString(16).padStart(6,"0"),M()}),y.edge_width=y.edge_width??6,UC$1.make_key_value_with_slider(w,"EdgeWidth",y.edge_width,{min:0,max:32,step:1},L=>{y.edge_width=L,M()}),y.h_padding=y.h_padding??5,UC$1.make_key_value_with_slider(w,"H-Padding",y.h_padding,{min:0,max:512,step:1},L=>{y.h_padding=L,M()}),y.v_padding=y.v_padding??5,UC$1.make_key_value_with_slider(w,"V-Padding",y.v_padding,{min:0,max:512,step:1},L=>{y.v_padding=L,M()}),UC$1.make_pulldown(w,"PopUp",[{key:"None",value:null},{key:"Rect",value:"rect"},{key:"Ellipse",value:"ellipse"}],y.popup,{},L=>{y.popup=L,M()}),UC$1.make_toggle(w,"Fit PupUp",y.fit_popup,{},L=>{y.fit_popup=L,M()}),y.h_align=y.h_align??"left",UC$1.make_pulldown(w,"H-Align",[{key:"Left",value:"left"},{key:"Center",value:"center"},{key:"Right",value:"right"}],y.h_align,{},L=>{y.h_align=L,M()}),y.v_align=y.v_align??"top",UC$1.make_pulldown(w,"V-Align🧪",[{key:"Top",value:"top"},{key:"Center",value:"center"},{key:"Bottom",value:"right"}],y.v_align,{},L=>{}),UC$1.make_toggle(w,"Bold",y.font_weight=="bold",{},L=>{y.font_weight=L?"bold":"normal",M()});const O=document.createElement("div");O.style.cssText="background:#333;border-radius:5px;margin:5px;width:calc(100% - 10px);height:50px;display:flex;align-items:center;justify-content:center;font-size:12px;color:gray",d.source_file?O.innerHTML=d.source_name:O.innerHTML="D&D and add ttf file.",w.appendChild(O),UC$1.make_drag_and_drop(w,{},async L=>{if(L.type=="file"||L.type=="json"){const P=C$2.DPath(L.item);if(P.ext=="ttf"){if(d.source_file=L.item,d.source_name=P.name,O.innerHTML=d.source_name,!window.__FontFaceSet__.has(d.source_name)){const N=await window.cross_file_system.read(d.source_file),z=new FontFace(d.source_name,N);document.fonts.add(z),window.__FontFaceSet__.add(d.source_name)}S.update(`"${d.source_name}"`),e.setFont?.(`"${d.source_name}"`),M()}}})}{r.appendChild(c());const w=UC$1.make_toggle_window(r,{title:TL$4("shadow_map_flags"),toggle:!0},y=>{}).holder;if(e.castShadow!==void 0&&UC$1.make_toggle(w,TL$4("cast_shadow"),e.castShadow,{},y=>{h.castShadow=d.cast_shadow=y,_md_(e)}),e.receiveShadow!==void 0&&UC$1.make_toggle(w,TL$4("receive_shadow"),e.receiveShadow,{},y=>{h.receiveShadow=d.receive_shadow=y,_md_(e)}),e.children.length>0){let y=!1;e.traverse(M=>{M!=e&&M.isMesh&&(y=!0)}),y&&(UC$1.make_toggle(w,"Cast Shadow All",e.cast_shadow!==void 0?e.cast_shadow:!1,{},M=>{e.traverse(S=>{if(console.log(S.name,S.type),S.castShadow!==void 0){S.castShadow=M;const D=S.getDDDProperties?.();D&&(D.cast_shadow=M)}}),_md_(e)}),UC$1.make_toggle(w,"Receive Shadow All",e.receiveShadow!==void 0?e.receiveShadow:!1,{},M=>{e.traverse(S=>{if(S.receiveShadow!==void 0){S.receiveShadow=M;const D=S.getDDDProperties?.();D&&(D.receive_shadow=M)}}),_md_(e)}))}}{const v=d?.type;if(d?.source_file&&(v=="pmx"||v=="pmd"||v=="gltf"||v=="glb"||v=="fbx"||v=="vrm")){let M=function(S){let D=null;return s.scene.traverse(k=>{k?.getDDDProperties?.()?.uuid==S&&(console.log(k?.getDDDProperties?.()?.uuid==S,k?.getDDDProperties?.()?.uuid,S),D=k)}),D};const y=UC$1.make_toggle_window(r,{title:TL$4("model_setting"),toggle:!0},S=>{}).holder;window.nodejs?(r.appendChild(c()),(d.j_object_source_file||d.source_file)&&UC$1.make_toggle(y,"Keep prop when replaced",d.keep_previous_prop??!1,{},S=>{d.keep_previous_prop=S}),d.j_object_source_file&&UC$1.make_button(y,C$2.DPath(d.j_object_source_file).basename,"Reload",{value_css:{width:"100px"}},async S=>{await UIL.load_files([{file_path:d.j_object_source_file,loading_behavior:"replace",keep_previous_prop:d.keep_previous_prop,onerror:D=>{console.error(D)},loaded:D=>{console.log(D)}}])}),d.source_file&&UC$1.make_button(y,C$2.DPath(d.source_file).basename,"Reload",{value_css:{width:"100px"}},async S=>{await UIL.load_files([{file_path:d.source_file,loading_behavior:"replace",keep_previous_prop:d.keep_previous_prop,onerror:D=>{console.error(D)},loaded:D=>{console.log(D)}}])}),UC$1.make_toggle(y,"Watch",e._watch_!=null,{},S=>{if(delete e._watch_,e._watcher_&&(e._watcher_.close(),delete e._watcher_,console.log("Disable and delete watcher.")),S){async function D(k,O){const L=window.nodejs.chokidar.watch(k,{persistent:!0,depth:0,usePolling:!0,awaitWriteFinish:{stabilityThreshold:700,pollInterval:100}});{let P=null;for(;P==null&&(P=M(O),P==null);)await C$2.sleep(1e3);P.getDDDProperties().destructors.push(()=>{P._watcher_&&P._watcher_.close().then(()=>console.log(`M:Watcher@destruct:${k}`)),P._watcher_=null}),P._watcher_&&P._watcher_.close(),P._watch_=!0,P._watcher_=L}return console.warn("Watch:",k,O),L.on("change",async function(P){L.close().then(()=>console.log(`M:Watcher@changed:${k}`));const N=M(O);s.current.object=N;let z=!1;const K=d.source_file,Z=N.script,V=N.script_mode,H=await s.getGlobalUIFlags(),Y=C$2.clone(H);H.replace_mode_material=!0,H.replace_mode_trs=!0,H.replace_mode_object_prop=!0,H.replace_mode_morphing=!0,H.replace_mode_action=!0,H.replace_mode_deco_prop=!0,await s.setGlobalUIFlags(H),await UIL.load_files([{file_path:K,loading_behavior:"replace",keep_previous_prop:d.keep_previous_prop,onerror:q=>{z=!0},loaded:async q=>{if(z==!1){const J=q.instance?.getDDDProperties?.();J&&(O=J.uuid,q.instance.script=Z,q.instance.script_mode=V,await s.setGlobalUIFlags(Y),setTimeout(()=>{D(k,O)},250))}}}])}),L.on("unlink",function(P){L.close().then(()=>console.log(`M:Watcher@unlink:${k}`))}),L.on("error",P=>{console.error(P),L.close().then(()=>console.error(`M:Watcher@error:${k}`))}),L}D(d.source_file,d.uuid)}}).update()):UC$1.make_toggle(y,"🧪Watch",e._watch_!=null,{},S=>{if(delete e._watch_,e._watcher_&&(e._watcher_.close(),delete e._watcher_,console.log("Disable and delete watcher.")),S){async function D(k,O){const L=await window.cross_file_system.watch(k,async(P,N)=>{const z=M(O);s.current.object=z;let K=!1;const Z=d.source_file,V=z.script,H=z.script_mode,Y=await s.getGlobalUIFlags(),q=C$2.clone(Y);Y.replace_mode_material=!0,Y.replace_mode_trs=!0,Y.replace_mode_object_prop=!0,Y.replace_mode_morphing=!0,Y.replace_mode_action=!0,Y.replace_mode_deco_prop=!0,await s.setGlobalUIFlags(Y),await UIL.load_files([{file_path:Z,loading_behavior:"replace",keep_previous_prop:d.keep_previous_prop,onerror:J=>{K=!0},loaded:async J=>{if(K==!1){const W=J.instance?.getDDDProperties?.();W&&(O=W.uuid,J.instance.script=V,J.instance.script_mode=H,await s.setGlobalUIFlags(q),setTimeout(()=>{D(k,O)},250))}}}])});{let P=null;for(;P==null&&(P=M(O),P==null);)await C$2.sleep(1e3);P.getDDDProperties().destructors.push(()=>{P._watcher_&&P._watcher_.close().then(()=>console.log(`M:Watcher@destruct:${k}`)),P._watcher_=null}),P._watcher_&&P._watcher_.close(),P._watch_=!0,P._watcher_=L}return console.warn("Watch:",k,O),L}D(d.source_file,d.uuid)}}).update(),d.source_file&&UC$1.make_button(y,"Thumbnail","Make",{value_css:_VALUE_CSS_},async()=>{await C$2.screenshot(d.source_file,{type:"save",thumbnail:!0}),await UI.make_file_history_menu()})}}if(d?.hdri_backdrop_height){r.appendChild(c());const w=UC$1.make_toggle_window(r,{title:"HDRI Backdrop",toggle:!0},y=>{}).holder;UC$1.make_key_value_with_slider(w,"Height",d.hdri_backdrop_height,{min:1,max:50,step:.01*l},y=>{d.hdri_backdrop_height=y,d.hdri_backdrop_recreate_buffer()}),UC$1.make_key_value_with_slider(w,"Distance",d.hdri_backdrop_distance_threshold,{min:10,max:100,step:1*l},y=>{d.hdri_backdrop_distance_threshold=y,d.hdri_backdrop_recreate_buffer()}),console.log(d.hdri_backdrop_height)}{r.appendChild(c());const w=UC$1.make_toggle_window(r,{title:TL$4("etc"),toggle:!0},M=>{}).holder;if(e.renderOrder!==void 0&&UC$1.make_key_value_with_slider(w,TL$4("render_order"),e.renderOrder,{min:-5,max:5,step:1},M=>{h.renderOrder=M}),e.isMesh&&(e.frustumCulled!==void 0&&UC$1.make_toggle(w,TL$4("frustum_cull"),e.frustumCulled,{},M=>{h.frustumCulled=M}),UC$1.make_toggle(w,TL$4("mosaic"),e.isMosaicObject??!1,{},M=>{e.isMosaicObject=M}),d&&(UC$1.make_toggle(w,TL$4("physics"),d.physics,{},M=>{d.physics=M}),UC$1.make_toggle(w,TL$4("animation"),d.animation,{},M=>{d.animation=M})),d&&!e.isSkinnedMesh&&!(e.morphTargetInfluences?.length>0))){d.tessellation=d.tessellation??{enabled:!1,maxEdgeLength:0,maxIterations:1};const M=document.createElement("div"),S=UC$1.make_toggle_holder(w,TL$4("tesselation"),!1,{},async D=>{d.tessellation.enabled=D,BuilderUtil.tessellate(e)});UC$1.make_key_value_with_slider(M,"Max edge length",d.tessellation.maxEdgeLength,{min:0,max:.9},D=>{d.tessellation.maxEdgeLength=D,BuilderUtil.tessellate(e)}),UC$1.make_key_value_with_slider(M,"Max iterations",d.tessellation.maxIterations,{min:1,max:16,step:1},D=>{d.tessellation.maxIterations=D,BuilderUtil.tessellate(e)}),S.update(d.tessellation.enabled),S.holder.appendChild(M)}if(d){{const M=[];M.push({key:"None",value:null,callback:()=>{d.object_attach_to=null,d.apply_attach_object(e)}}),s.scene.traverse(k=>{if(k==e||k instanceof Scene||k instanceof Audio$1||k instanceof AudioListener)return;const O=k.getDDDProperties?.();if(O){let L=[],P=k;for(;P&&(L.push(P),P=P.parent,!(P instanceof Scene)););L.reverse();let N=null,z=L[L.length-1];for(const Z of L){const V=Z.getDDDProperties?.();if(V){const H=V.type;C$2.is_model_ext(H)&&N==null&&(N=Z)}}N&&z&&N!=z&&(L=[N,z]);const K=L.map(Z=>Z.name?.length>0?Z.name:Z.type).join(" > ");M.push({key:K,value:O.uuid,callback:()=>{d.object_attach_to=O.uuid,d.apply_attach_object(e)}})}});const S=UC$1.make_toggle_holder(w,TL$4("attach_to"),d.object_attach_to_flag??!1,{},(k,O)=>{d.object_attach_to_flag=k});S.update();const D=UC$1.make_pulldown(S.holder,"",M,d.object_attach_to??null,{},(k,O)=>{for(const L of M)if(L.value==k){L.callback();break}});new window.TomSelect(D.modifier,{allowEmptyOption:!1}),UC$1.make_vec3_box(S.holder,"Offset",d.object_attach_offset??new Vector3(0,0,0),1,{step:.01*l,camera_step:!0,operator:_},k=>{d.object_attach_offset.x=k,_md_(e)},k=>{d.object_attach_offset.y=k,_md_(e)},k=>{d.object_attach_offset.z=k,_md_(e)}),d.object_attach_rotation=d.object_attach_rotation??new Euler,UC$1.make_vec3_box(S.holder,"Rotation",d.object_attach_rotation,Math.PI/180,{step:1},k=>{d.object_attach_rotation.x=k*Math.PI/180,_md_(e)},k=>{d.object_attach_rotation.y=k*Math.PI/180,_md_(e)},k=>{d.object_attach_rotation.z=k*Math.PI/180,_md_(e)})}if(e.isMesh&&d.dof_target!==void 0){const M=UC$1.make_toggle_holder(w,TL$4("depth_of_field"),!!d.dof_target,{},D=>{d.dof_target=D,d.dof_needsUpdate=!0});M.update();const S=M.holder;UC$1.make_toggle(S,TL$4("depth_of_field_dynamic"),d.dof_dynamic,{},D=>{d.dof_dynamic=D,d.dof_needsUpdate=!0})}if(d.type&&d.type.indexOf("spectrum")>=0&&e.setAudio){const M=[];s.scene.traverse(S=>{S instanceof Audio$1&&M.push(S.name)}),UC$1.make_pulldown(w,"Audio Source",M,d.spectrum_audio_source,{},S=>{d.spectrum_audio_source=S;const D=s.scene.find(S,!0);D&&(D.__on_started_audio__=function(){e.setAudio(D)})}).update()}}d?.transform_controller!==void 0&&UC$1.make_toggle(w,"Transform Controller",d.transform_controller,{},M=>{m.forEach(S=>{const D=S.getDDDProperties?.();D&&(D.transform_controller=M)})}),w.appendChild(c()),w.appendChild(c());{if(UC$1.make_button(w,"Object Exporter","Export",{value_css:_VALUE_CSS_},()=>{if(e){const M="ddd/ui/export_object.html";UC$1.make_window(M,"Object Exporter",{url:M,width:385,height:400,urlLoaded:async function(S){const D=S.iframe.contentWindow;D.object=e,D.current_link=window.file_browser?.current_link,D.self_frame=S,S.setOnCloseFrameListener(()=>{})}})}}),window.nodejs&&d.source_file){const M=d.source_file.split(".").pop();UC$1.make_button(w,`Open in App (${M})`,"Open",{value_css:_VALUE_CSS_},async()=>{window.nodejs&&window.nodejs.open_in_native(d.source_file)}),UC$1.make_button(w,"Open in Folder","Open",{value_css:_VALUE_CSS_},async()=>{window.nodejs&&window.nodejs.open_in_finder(d.source_file)})}window.nodejs&&d.source_file&&UC$1.make_button(w,"Export Script as...","Export",{value_css:_VALUE_CSS_},async()=>{const M=C$2.DPath(d.source_file),S=C$2.path.join(M.dirname,M.name+".js"),D=e.script.normalize("NFC");await window.cross_file_system.write(S,D,{encoding:"utf8"}),UI.event_notify(`Saved as "${S}"`)}),window.nodejs&&d.source_file&&UC$1.make_button(w,"Export UserData as...","Export",{value_css:_VALUE_CSS_},async()=>{const M=C$2.DPath(d.source_file),S=C$2.path.join(M.dirname,M.name+".json");await window.cross_file_system.write(S,JSON.stringify(e.userData,null,4)),UI.event_notify(`Saved as "${S}"`)})}w.appendChild(c()),w.appendChild(c()),UC$1.make_script(w,"Script",e.script?e.script:"",{},(M,S)=>{const D=s.getObjectBySubUUID(d.uuid);M=="run"?window.script_runner(D):M=="editor"?UI.open_script_editor_for_object({},(k,O)=>{(k=="save"||k=="run")&&(S.value=O)}):M=="input"&&(D.script=S.value)}),w.appendChild(c()),w.appendChild(c());const y=e.userData?JSON.stringify(e.userData):"{}";UC$1.make_script(w,"UserData",y,{run:!1},(M,S)=>{if(M=="editor"){const D=e?.getDDDProperties?.()?.uuid;if(D){const k=(e.name?.length>0?e.name:null)||e.type+" : "+e.uuid;UC$1.open_script_editor(D+"-user-data",{title:k+"-user-data",text:S.value,mode:"json"},async function(O,L){const P=s.getObjectBySubUUID(D);P&&(O=="save"?(P.script=L,S.value=L,await Builder3D.save_project()):O=="run"&&(P.script=L,S.value=L,window.script_runner(P)))})}}else if(M=="input")try{const D=s.getObjectBySubUUID(d.uuid);D.userData=JSON.parse(S.value)}catch{}})}{r.appendChild(c());const w=UC$1.make_toggle_window(r,{title:TL$4("properties"),toggle:!0},M=>{}).holder,y={value_css:{width:"160px"}};if(UC$1.make_key_value2(w,"Name",e.name,y,M=>{e.name=M,s.dispatchEvent("change@scene",{update_panel:!1})}),UC$1.make_key_value2(w,"ID",`${e.id}`,y),UC$1.make_key_value2(w,"UUID",`${e.uuid}`,y),d?.uuid){const M=UC$1.make_key_value2(w,"S-UUID",`${d.uuid}`,y);UC$1.make_button(w,"Regenerate S-UUID","Gen",{value_css:_VALUE_CSS_},()=>{d.uuid=C$2.GenerateShortID(),M.modifier.value=d.uuid})}if(UC$1.make_key_value2(w,"Type",`${e.type}`,y),UC$1.make_key_value2(w,"Attribute",`${d?.type?d.type:"Generic"}`,y),e.geometry!==void 0&&d){const M=d?.ui?.object;M&&UC$1.make_toggle(w,"VertexNormalsHelper",M.vertex_normals_helper,{},async D=>{if(M.vertex_normals_helper=D,window.VertexNormalsHelper&&s.removeHelper(k=>k instanceof window.VertexNormalsHelper),M.vertex_normals_helper){const{VertexNormalsHelper:k}=await __vitePreload(()=>import("./VertexNormalsHelper@D9ynRzjZ.js"),[],import.meta.url),O=new k(e,.2,65280);s.helper_scene.add(O),window.VertexNormalsHelper=k}}).update()}e.geometry!==void 0&&(e.geometry?.attributes?.position?.count!=null&&UC$1.make_key_value2(w,"Vertex",e.geometry.attributes.position.count,y),e.geometry?.index?.count!=null&&UC$1.make_key_value2(w,"Triangles",e.geometry.index.count/3,y),e.geometry?.attributes?.color!=null&&UC$1.make_key_value2(w,"VertexColor",!0,y),e.geometry?.attributes?.normal!=null&&UC$1.make_key_value2(w,"Normal",!0,y),e.geometry?.attributes?.uv!=null&&UC$1.make_key_value2(w,"UV",!0,y),e.geometry?.attributes?.uv1!=null&&UC$1.make_key_value2(w,"UV1",!0,y),e.geometry?.attributes?.uv2!=null&&UC$1.make_key_value2(w,"UV2",!0,y),e.geometry?.attributes?.uv3!=null&&UC$1.make_key_value2(w,"UV3",!0,y)),UC$1.make_button(w,"Delete Object","Delete",{value_css:{width:"100px"}},()=>{s.scene!=e&&UI.remove_selected_objects_with_ui()})}if(d&&d.source_file&&window.DEPLOYMENT_TYPE!="PLAYER"){let v=function(){const L=document.createElement("div");return L.style.width="100%",L.style.height="20px",L};r.appendChild(v()),r.appendChild(v());const y=UC$1.make_toggle_window(r,{title:"License",toggle:!0},L=>{}).holder;let M=null,S=null,D=null,k=null;async function O(){if(window.app_mode)return;if(D.update(!0),k.update(!0),d.binary_license_summary="",d.source_license_summary="",e.type=="Scene"){const P=await GetProjectPath();if(P){const N=C$2.DPath(P),z=s.ui.renderer_flags.fps;d.binary_license_summary=`${N.name} ${z}FPS\r
\r
`,d.source_license_summary=`${N.name} ${z}FPS\r
\r
`}}const L=C$2.get_ddd_links(e,[],e.type=="Scene");for(const P of L){const N=P.get()+".attribute";C$2.DPath(N).basename;try{if(await window.cross_file_system.exists(N)){const z=await window.cross_file_system.read(N);if(z){const K=await C$2.s_decode_async(z);d.binary_license_summary+=K.license?.format_short+`\r
`,d.source_license_summary+=K.license?.format_distribution+`\r
`;const Z=K.license?.[K.license?.type];Z&&(D.getValue()=="true"&&(Z.non_commercial_use||Z.NC)&&D.update(!1),k.getValue()=="true"&&Z.NSFW&&k.update(!1))}}}catch(z){console.error(z)}}}UC$1.make_button(y,"Summary","Update",{value_css:{width:"100px"}},async L=>{await O(),M.modifier.value=d.binary_license_summary,S.modifier.value=d.source_license_summary}),y.appendChild(v()),M=UC$1.make_script(y,"Video/Image/Application(Binary)",d.binary_license_summary?d.binary_license_summary:"",{run:!1,editor:!1},(L,P)=>{d.binary_license_summary=P.value}),D=UC$1.make_key_value2(y,"Commercial Use",!0,{value_css:{width:"50px"}}),k=UC$1.make_key_value2(y,"NSFW",!0,{value_css:{width:"50px"}}),y.appendChild(v()),y.appendChild(v()),await O(),S=UC$1.make_script(y,"Unit/OSS(Source)",d.source_license_summary?d.source_license_summary:"",{run:!1,editor:!1},(L,P)=>{d.source_license_summary=P.value}),y.appendChild(v()),r.appendChild(v()),r.appendChild(v())}document.querySelectorAll(".morph_gui_panel").forEach(v=>{v instanceof HTMLElement&&(v.style.display="none")}),e.gui&&e.gui.show()}else UC$1.make_separator(r,{close:!1,sub:!0,title:T("g.there_is_no_item")}),a&&a.classList.add("no_item");if(!i){r.id="3d_object_panel",r.style.textAlign="left",r.style.width="100%";const d=document.getElementById("right_side_panel_tab_object");d&&(d.innerHTML="",d.appendChild(r))}UI_LightPanel(),UI_MultipleObjectsPanel()}function UI_MultipleObjectsPanel(){const s=window.DMC.current.object;if(s==null)return;const e=document.getElementById("multiple_objects_panel"),i=e||document.createElement("div"),r=DMC;r.ui.light_panel=e,i.innerHTML="",UC$1.make_separator(i,{close:!1,sub:!0,title:T("tabs.multiple_objects.multiple_objects")});const o=s.getDDDProperties?.(),a=r.ui.system_flags.xr_mode?.1:1,c=document.getElementById("right_side_panel_tab_multiple_objects_button");if(c&&(c.classList.remove("no_item"),c.classList.remove("no_item_and_hidden")),o&&s instanceof InstancedMesh){const d=o.controllable_geometry,u=s;if(d){let h=function(){let _=[];for(let b=0;b<u.max_count;b++)f[b].__instanced_mesh__activated__?_.push({position:f[b].position.clone(),quaternion:f[b].quaternion.clone(),scale:f[b].scale.clone(),matrix:f[b].matrix.clone()}):(f[b].position.set(0,0,0),f[b].quaternion.identity(),f[b].scale.set(1,1,1),f[b].matrix.identity(),u.setMatrixAt(b,f[b].matrix)),delete f[b].__instanced_mesh__activated__;for(let b=0;b<_.length;b++)f[b].__instanced_mesh__activated__=!0,f[b].position.copy(_[b].position),f[b].quaternion.copy(_[b].quaternion),f[b].scale.copy(_[b].scale),f[b].matrix.copy(_[b].matrix),u.setMatrixAt(b,f[b].matrix)},f=[],m=new Map;for(let _=0;_<u.max_count;_++){const b=new Object3D;u.getMatrixAt(_,b.matrix),b.matrix.decompose(b.position,b.quaternion,b.scale),f.push(b),m.set(b,_)}for(let _=0;_<s.count;_++)f[_].__instanced_mesh__activated__=!0;{let b=function(y){const M=m.get(y);y.updateMatrix(),u.setMatrixAt(M,y.matrix),u.instanceMatrix.needsUpdate=!0,_md_(u)},v=function(y){const S=UC$1.make_toggle_window(_,{title:T("tabs.multiple_objects.object_trs"),toggle:!0},P=>{}).holder;let D=null,k=null;if(y.position!==void 0){const P=(N,z)=>{const K=r.current.camera||r.camera,Z=y.position,V=new Vector3,H=new Vector3,Y=new Vector3,q=new Vector3,J=new Vector3(0,1,0);u.getWorldScale(V);const W=1/((V.x+V.y+V.z)/3);q.copy(K.position),q.sub(Z),q.normalize(),q.cross(J),q.normalize(),H.copy(Z),H.project(K),Y.copy(Z),Y.add(q),Y.project(K),Y.sub(H);const te=r.base_renderer.domElement.width,ie=Math.max(1/Math.abs(te*Y.x)*2.5*W,.1);return N+ie*z};UC$1.make_vec3_box(S,T("g.position"),y.position,1,{step:.01*a,camera_step:!0,operator:P},N=>{y.position.x=N,b(y)},N=>{y.position.y=N,b(y)},N=>{y.position.z=N,b(y)})}y.rotation!==void 0&&UC$1.make_vec3_box(S,T("g.rotation"),y.rotation,Math.PI/180,{step:1},P=>{y.rotation.x=P*Math.PI/180,b(y)},P=>{y.rotation.y=P*Math.PI/180,b(y)},P=>{y.rotation.z=P*Math.PI/180,b(y)});let L=y.scale!==void 0;y.isLight&&(L=!1),L&&(D=UC$1.make_vec3_box(S,T("g.scale"),y.scale,1,{initializers:[{title:"0.1",values:[.1,.1,.1]},{title:"5",values:[5,5,5]},{title:"10",values:[10,10,10]}],step:.01*a,default_values:[1,1,1],min_x:1e-5,min_y:1e-5,min_z:1e-5},P=>{y.scale.x=P,k.modifier.value=P,b(y)},P=>{y.scale.y=P,b(y)},P=>{y.scale.z=P,b(y)}),k=UC$1.make_float_box(S,T("g.all_scales"),y.scale.x,{min:0,precision:5,operator:(P,N)=>{let z=P*(1+N*.02);return N>0?z<12e-5&&(z=13e-5):N<0&&z<12e-5&&(z=0),z}},P=>{y.scale.setScalar(P),D.set(y.scale),b(y)})),UC$1.make_button(S,"","Delete",{value_css:{width:"100px"}},()=>{y.position.set(0,0,0),y.quaternion.identity(),y.scale.set(0,0,0),u.count--,delete f[m.get(y)].__instanced_mesh__activated__,h(),b(y)})},w=function(){if(_.innerHTML="",!!o.instance_mesh_manual_panel){for(let y=0;y<u.count;y++){const M=f[y];u.getMatrixAt(y,M.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)}for(let y=0;y<u.count;y++){const M=f[y];u.getMatrixAt(y,M.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale),v(M)}}};UC$1.make_key_value2(i,"Num of instances",u.count,{value_css:{width:"75px"}},y=>{u.count=Number(y);for(let M=0;M<u.max_count;M++)M<u.count?f[M].__instanced_mesh__activated__=!0:f[M].__instanced_mesh__activated__=!1;h(),_md_(u),w()}),UC$1.make_toggle(i,"Manual TRS",!!o.instance_mesh_manual_panel,{},y=>{o.instance_mesh_manual_panel=y,w()});const _=document.createElement("div");i.appendChild(_),w()}}}else{UC$1.make_separator(i,{close:!1,sub:!0,title:T("g.there_is_no_item")});const d=document.getElementById("right_side_panel_tab_multiple_objects_button");d&&(d.classList.add("no_item"),d.classList.add("no_item_and_hidden"))}if(!e){i.id="multiple_objects_panel",i.style.textAlign="left",i.style.width="100%";const d=document.getElementById("right_side_panel_tab_multiple_objects");d&&(d.innerHTML="",d.appendChild(i))}}function UI_LightPanel(){const s=DMC,e=s.current.object,i=document.getElementById("3d_light_panel"),r=i||document.createElement("div");s.ui.light_panel=i,r.innerHTML="";const l=s.ui.system_flags.xr_mode?.1:1,a=document.getElementById("right_side_panel_tab_light_button");if(a&&(a.classList.remove("no_item"),a.classList.remove("no_item_and_hidden")),e){const c=e.getDDDProperties?.()||{};c.controllable_geometry;const d=s.get_selected_objects();d.objects.filter(h=>e.getDDDProperties?.()?.controllable_geometry);const u=create_modifier(e,d.objects);let f=!1;const m=[];if(e.intensity!==void 0){let _=function(w){let y="";y="Light Intensity",y!=w&&h[y]&&(h[y].modifier.value=e.intensity),y="Light Decay",y!=w&&h[y]&&(h[y].modifier.value=e.decay),y="Light Distance",y!=w&&h[y]&&(h[y].modifier.value=e.distance),y="Light Power",y!=w&&h[y]&&(h[y].modifier.value=e.power)};UC$1.make_separator(r,{close:!1,sub:!0,title:TL$4("light")});const h={};e.color!==void 0&&UC$1.make_color_picker(r,"Color","#"+e.color.getHex().toString(16).padStart(6,"0"),w=>{e.color.setHex(w),_md_(e)}),e.groundColor!==void 0&&UC$1.make_color_picker(r,"GroundColor","#"+e.groundColor.getHex().toString(16).padStart(6,"0"),w=>{e.groundColor.setHex(w),_md_(e)});let b=1e3,v=1;if(e.type=="AmbientLight"&&(b=1,v=.1),e.type=="DirectionalLight"&&(b=3,v=.1),e.intensity!==void 0&&(h["Light Intensity"]=UC$1.make_float_box(r,"Intensity",e.intensity,{step:.01,min:0,max:b,operator:(w,y)=>w+Math.pow(w<.001?.001:w,.5)/10*y*v},w=>{e.intensity=w,_md_(e),_("Light Intensity")})),e.decay!==void 0&&(h["Light Decay"]=UC$1.make_float_box(r,"Decay",e.decay,{step:.001,min:0,max:10,precision:5,operator:(w,y)=>w+Math.pow(w<.001?.001:w,.5)/100*y},w=>{e.decay=w,_md_(e),_("Light Decay")})),e.distance!==void 0&&(h["Light Distance"]=UC$1.make_float_box(r,"Distance",e.distance,{step:.25*l,min:0,operator:(w,y)=>w+Math.pow(w<.001?.001:w,.5)/(10/l)*y},w=>{e.distance=w,_md_(e),_("Light Distance"),e.shadow?.camera&&(e.shadow.camera.far=w>0?w:500,m.forEach(y=>y()),e.shadow.camera.updateProjectionMatrix())})),e.power!==void 0&&(h["Light Power"]=UC$1.make_float_box(r,"Lumen",e.power,{step:1,min:0,operator:(w,y)=>w+Math.pow(w<.001?.001:w,.5)/10*y},w=>{e.power=w,_md_(e),_("Light Power")})),e.angle!==void 0&&UC$1.make_float_box(r,"Angle",e.angle,{step:.01,min:0,max:.999},w=>{e.angle=w,_md_(e)}),e.penumbra!==void 0&&UC$1.make_float_box(r,"Penumbra",e.penumbra,{step:.01,min:0,max:.999},w=>{e.penumbra=w}),e.width!==void 0&&UC$1.make_float_box(r,"Width",e.width,{step:.1,min:0,operator:(w,y)=>w+Math.pow(w<.001?.001:w,.5)/10*y},w=>{e.width=w,_md_(e),m.forEach(y=>y())}),e.height!==void 0&&UC$1.make_float_box(r,"Height",e.height,{step:.1,min:0,operator:(w,y)=>w+Math.pow(w<.001?.001:w,.5)/10*y},w=>{e.height=w,_md_(e),m.forEach(y=>y())}),e instanceof DirectionalLight&&UC$1.make_button(r,"Sun Object","Make",{value_css:{width:"100px"}},async()=>{for(const y of e.children)await Builder3D.remove_object(y);const w=await Builder3D.build_by_type("sphere");w.name="Sun",w.material.color.setHex(16777215),w.material.emissive.setHex(16777215),w.material.emissiveIntensity=10,w.frustumCulled=!1,e.add(w),s.dispatchEvent("change@scene",{update_panel:!1})}),e instanceof PointLight&&UC$1.make_button(r,"Light Object","Make",{value_css:{width:"100px"}},async()=>{for(const y of e.children)await Builder3D.remove_object(y);const w=await Builder3D.build_by_type("sphere");w.name="Source",w.material.color.setHex(16777215),w.material.emissive.setHex(16777215),w.material.emissiveIntensity=5,w.frustumCulled=!1,e.add(w),s.dispatchEvent("change@scene",{update_panel:!1})}),e.map!==void 0){let y=function(M,S,D){const k=M;k.innerHTML="";function O(V){const H=V.texture_path;return new Promise((Y,q)=>{console.log("Try to loaded:",H.slice(0,256)),Builder3D.load_texture(H,{cache:!1,replacer:!1},(J,W)=>{if(J){console.error(J),q(J);return}const te=S[D];te&&(te.dispose(),S[D]=null),S[D]=W,W.source_file=H,Y(W)})})}async function L(V,H){H.preventDefault(),H.stopPropagation(),C$2.modal_processing("Processing",""),V.classList.remove("dragover");const Y=H.dataTransfer.getData("json"),q=H.dataTransfer.types.includes("Files");if(H.dataTransfer.types.includes("json")&&Y.length>0){const W=JSON.parse(Y);if(W.target_file_paths){const te=W.target_file_paths[0];te&&(console.log(te),await O({texture_path:te.absolute_path}),y(M,S,D)),C$2.close_modal_processing()}else C$2.close_modal_processing()}else if(q){const te=(await UC$1.get_dropped_items(H)).files;if(console.log(te),window.external_io){if(window.external_io.driver!="local"){if(C$2.close_modal_processing(),!await C$2.modal_ok_cancel_promise("Notice","<div>The texture does not save in External I/O.</div><div>Are you sure?</div>",{}))return;C$2.modal_processing("Processing","")}}else if(!window.external_io&&!window.nodejs){if(C$2.close_modal_processing(),!await C$2.modal_ok_cancel_promise("Notice","<div>The texture does not save in External I/O.</div><div>Are you sure?</div>",{}))return;C$2.modal_processing("Processing","")}if(H.dataTransfer.items&&te.length>0){const ie=te[0];if(console.log(ie),window.is_electron){let oe=ie.file.path;oe=oe.replace(/\\/g,"/"),console.log("Try to load:",oe),await O({texture_path:oe}),y(M,S,D)}else{const Ce=await function(Fe){return new Promise(($e,Ue)=>{const qe=new FileReader;qe.readAsArrayBuffer(Fe),qe.onloadend=function(){$e(qe.result)},qe.onerror=function(_e){Ue(_e)}})}(ie.file),ve=C$2.DPath(ie.file_path).ext,we=await window.cross_file_system.tmp_dir(),Se=C$2.md5.hex(Ce)+"."+ve,Re=C$2.DPathJoin(we,Se);await window.cross_file_system.write(Re,Ce),await O({texture_path:Re}),y(M,S,D)}}C$2.close_modal_processing()}else C$2.close_modal_processing()}function P(V){r.classList.add("dragover"),V.stopPropagation(),V.preventDefault()}function N(V){r.classList.remove("dragover"),V.stopPropagation(),V.preventDefault()}function z(V){r.classList.remove("dragover"),V.stopPropagation(),V.preventDefault(),u.clear_marked()}w.element.ondrop=function(V){L(r,V)},w.element.ondragover=P,w.element.ondragleave=N,w.element.ondragend=z;const K=S[D];if(K){if(UC$1.make_button(k,"Unload Texture","Unload",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{K.dispose?.(),S[D]=null,y(M,S,D)}),K._source_file_||K.source_file){const ie=K._source_file_||K.source_file;window.is_data_url(ie)==!1&&UC$1.make_button(k,"Reload Texture","Reload",{value_css:{width:"100px",whiteSpace:"nowrap"}},async()=>{await O({texture_path:ie}),y(M,S,D)})}const J={AlphaFormat,RedFormat,RedIntegerFormat,RGFormat,RGIntegerFormat,RGBAFormat,RGBAIntegerFormat,LuminanceFormat,LuminanceAlphaFormat,DepthFormat,DepthStencilFormat,RGB_S3TC_DXT1_Format:33776,RGBA_S3TC_DXT3_Format:33778,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196},W={};for(const ie in J)W[J[ie]]=ie;const te={};if(K.unpackAlignment!=null&&UC$1.make_key_value2(k,"UnpackAlignment",K.unpackAlignment,{value_css:{width:"100px"}}),K.format!=null&&UC$1.make_key_value2(k,"Format",W[K.format],{value_css:{width:"100px"}}),K.type!=null&&UC$1.make_key_value2(k,"Type",te[K.type],{value_css:{width:"100px"}}),K.width!=null&&UC$1.make_key_value2(k,"Width",K.width,{value_css:{width:"100px"}}),K.height!=null&&UC$1.make_key_value2(k,"Height",K.height,{value_css:{width:"100px"}}),K.play!=null){let ie=null,oe=null;UC$1.make_toggle(k,"Loop",K.getLoop(),{},we=>{K.setLoop(we)}),UC$1.make_toggle(k,"Muted",K.getMuted(),{},we=>{K.setMuted(we)}),UC$1.make_toggle(k,"Autoplay",K.getAutoPlay(),{},we=>{K.setAutoPlay(we)}),UC$1.make_key_value_with_slider(k,"Volume",K.getVolume(),{min:0,max:1},we=>{K.setVolume(we)});const Ce=document.createElement("button"),ve=document.createElement("i");Ce.appendChild(ve),ve.classList.add("bi","bi-play-fill"),Ce.style.cssText="width:30px",Ce.onclick=function(){ve.classList.contains("bi-play-fill")?(ve.classList.remove("bi-play-fill"),ve.classList.add("bi-stop-fill"),K.play(),ie&&clearInterval(ie),ie=setInterval(()=>{oe.slider.value=oe.modifier.value=Math.floor(K.getCurrentTime()*100)/100,oe.update_animation()},137)):(ve.classList.remove("bi-stop-fill"),ve.classList.add("bi-play-fill"),K.stop(),ie&&clearInterval(ie),ie=null,oe.slider.value=oe.modifier.value=0,oe.update_animation())},oe=UC$1.make_key_value_with_slider(k,Ce,0,{min:0,max:K.getDuration()},we=>{K.setCurrentTime(we)})}}const Z=document.createElement("div");k.appendChild(Z),Z.innerText="Drop Texture Here",Z.style.cssText="width: calc(100% - 6px);height: 30px;color: #aaa;font-size: 12px;display: flex;align-items: center;justify-content: center;"};const w=UC$1.make_toggle_window(r,{title:"Texture",toggle:!0},M=>{});y(w.holder,e,"map")}f=!0}if(e.shadow){const h=document.createElement("div");UC$1.make_separator(r,{close:!1,sub:!0,title:TL$4("shadow_map_settings")});let _=null;if(e.shadow?.bias!==void 0&&(_=UC$1.make_float_box(h,"Bias",e.shadow.bias,{max:0,step:1e-5,precision:5},v=>{e.shadow.bias=v})),e.shadow?.normalBias!==void 0&&(_=UC$1.make_float_box(h,"Normal Bias",e.shadow.normalBias,{min:0,step:1e-5,precision:5},v=>{e.shadow.normalBias=v})),e.shadow?.focus!==void 0&&UC$1.make_float_box(r,"Focus",e.shadow.focus,{step:.01,min:0,max:1},v=>{e.shadow.focus=v}),e.shadow?.radius!==void 0&&UC$1.make_float_box(r,"Radius",e.shadow.radius,{step:1e-4,min:0,max:10},v=>{e.shadow.radius=v}),e.shadow?.mapSize?.width!==void 0&&UC$1.make_pulldown(h,"Resolution",["512","1024","2048","4096","8192","16384"],String(e.shadow?.mapSize?.width),{},v=>{const w=Number(v);e.shadow.mapSize.height=e.shadow.mapSize.width=w,e.shadow.map?.dispose?.(),e.shadow.map=null,m.forEach(y=>y()),_md_(e)}),e.type=="DirectionalLight"){if(e.shadow?.camera?.left!==void 0){let y=0;UC$1.make_key_value_with_slider(h,"Range",e.shadow.camera.far,{min:10,max:1e4,step:1},M=>{const S=(M-10)/9990;e.shadow.camera.near=1,e.shadow.camera.far=M,e.shadow.bias=-.0013+(.0013-6e-5)*S*S,_.update(e.shadow.bias);const D=Math.floor(M/2);e.position.normalize(),e.position.multiplyScalar(D),e.shadow.camera.left=-D,e.shadow.camera.top=D,e.shadow.camera.bottom=-D,e.shadow.camera.right=D,e.shadow.camera.updateProjectionMatrix(),y++,setTimeout(()=>{y--,y==0&&(e.shadow.map?.dispose?.(),e.shadow.map=null)},100),_md_(e)})}const v=UC$1.make_toggle_window(h,{title:TL$4("preset"),toggle:!0},y=>{});v.update();const w=v.holder;UC$1.make_button(w,"Person Range","Setup",{},()=>{person_range_directional_light(e),UI_ObjectPanel(),_md_(e)}),UC$1.make_button(w,"Small Room Range","Setup",{},()=>{small_room_range_directional_light(e),UI_ObjectPanel(),_md_(e)}),UC$1.make_button(w,"Large Room Range","Setup",{},()=>{large_room_range_directional_light(e),UI_ObjectPanel(),_md_(e)}),UC$1.make_button(w,"Small Field Range","Setup",{},()=>{short_range_directional_light(e),UI_ObjectPanel(),_md_(e)}),UC$1.make_button(w,"Large Field Range","Setup",{},()=>{long_range_directional_light(e),UI_ObjectPanel(),_md_(e)})}if(e.shadow?.camera?.near){const v=s.helper_scene,w=e.shadow,y=e.shadow.camera,M=UC$1.make_toggle_window(h,{title:TL$4("advanced"),toggle:!1},S=>{const D=[];v.traverse(k=>{k instanceof CameraHelper&&D.push(k)});for(const k of D)k.removeFromParent();if(S){let k=null;const O=()=>{k&&k.parent?.remove(k),k=new CameraHelper(w.camera),v.add(k);const z=new Matrix4;z.makeRotationX(-Math.PI/2),k.user.updaters.adjust_rotation=function(){k.matrix.copy(e.matrix),k.matrix.multiply(z)}};m.push(O),O();const L=M.holder;L.innerHTML="";const P=()=>{y&&y.updateProjectionMatrix()};if(y.near!==void 0){const z=UC$1.make_float_box(L,"Camera Near",y.near,{step:.01},K=>{y.near=K,P()});m.push(()=>{z.update(y.near)})}if(y.far!==void 0){const z=UC$1.make_float_box(L,"Camera Far",y.far,{step:.01},K=>{y.far=K,P()});m.push(()=>{z.update(y.far)})}if(y.fov!==void 0){const z=UC$1.make_float_box(L,"Camera Fov",y.fov,{step:.01},K=>{y.fov=K,P()});m.push(()=>{z.update(y.fov)})}if(w.mapSize?.width!==void 0){const z=UC$1.make_float_box(L,"Map W",w.mapSize.width,{step:1},K=>{w.mapSize.width=K,P()});m.push(()=>{z.update(w.mapSize.width)})}if(w.mapSize?.height!==void 0){const z=UC$1.make_float_box(L,"Map H",w.mapSize.height,{step:1},K=>{w.mapSize.height=K,P()});m.push(()=>{z.update(w.mapSize.height)})}if(y.left!==void 0){const z=UC$1.make_float_box(L,"Camera Left",y.left,{step:.01},K=>{y.left=K,P()});m.push(()=>{z.update(y.left)})}if(y.right!==void 0){const z=UC$1.make_float_box(L,"Camera Right",y.right,{step:.01},K=>{y.right=K,P()});m.push(()=>{z.update(y.right)})}if(y.top!==void 0){const z=UC$1.make_float_box(L,"Camera Top",y.top,{step:.01},K=>{y.top=K,P()});m.push(()=>{z.update(y.top)})}if(y.bottom!==void 0){const z=UC$1.make_float_box(L,"Camera Bottom",y.bottom,{step:.01},K=>{y.bottom=K,P()});m.push(()=>{z.update(y.bottom)})}if(s.ui.renderer_flags.shadowMap_type=="VSMShadowMap"){if(w.radius!==void 0){const z=UC$1.make_float_box(L,"VSM Radius",w.radius,{min:0,step:.1},K=>{w.radius=K,P()});m.push(()=>{z.update(w.radius)})}if(w.blurSamples!==void 0){const z=UC$1.make_float_box(L,"VSM Blur Samples",w.blurSamples,{min:0,step:1},K=>{w.blurSamples=K,P()});m.push(()=>{z.update(w.blurSamples)})}}w.map&&UC$1.make_button(L,"Update ShadowMap","Apply",{value_css:{width:"100px"}},()=>{w.map?.dispose?.(),w.map=null,setTimeout(()=>{UI_LightPanel()},100)})}});M.update()}const b=document.createElement("div");b.style.clear="left",r.appendChild(b),h.children.length&&r.appendChild(h),f=!0}if(UC$1.make_separator(r,{close:!1,sub:!0,title:TL$4("option")}),e.wave_speed!==void 0&&(UC$1.make_key_value_with_slider(r,"Wave Speed",e.wave_speed,{min:0,max:1,step:.01},h=>{e.wave_speed=h}),f=!0),e.material?.uniforms?.distortionScale!==void 0&&(UC$1.make_key_value_with_slider(r,"Distortion Scale",e.material.uniforms.distortionScale.value,{min:0,max:5,step:.01},h=>{e.material.uniforms.distortionScale.value=h,e.material.needsUpdate=!0}),f=!0),c.type=="sky"&&c.__sky_effectController){const h=c.__sky_effectController,_=c.__sky_effectController_update;UC$1.make_key_value_with_slider(r,"Time",h.time,{min:0,max:24,step:.01,default_value:10},b=>{h.time=b,_(),NE(GetDirectionalLight()),_md_(e)}).update(),UC$1.make_key_value_with_slider(r,"Azimuth 360°",h.azimuth,{min:-180,max:180,step:.1},b=>{h.azimuth=b,_(),NE(GetDirectionalLight()),_md_(e)});{const v=UC$1.make_toggle_window(r,{title:TL$4("advanced"),toggle:!1},w=>{}).holder;UC$1.make_key_value_with_slider(v,"Elevation",h.elevation,{min:0,max:1,step:.01},w=>{h.elevation=w,_(),NE(GetDirectionalLight()),_md_(e)}),UC$1.make_key_value_with_slider(v,"Intensity",h.intensity??1,{min:0,max:3,step:.01},w=>{h.intensity=w,_(),NE(GetDirectionalLight()),_md_(e)}),UC$1.make_key_value_with_slider(v,"Turbidity",h.turbidity,{min:0,max:20,step:.01},w=>{h.turbidity=w,_(),_md_(e)}),UC$1.make_key_value_with_slider(v,"Rayleigh",h.rayleigh,{min:0,max:4,step:.01},w=>{h.rayleigh=w,_(),_md_(e)}),UC$1.make_key_value_with_slider(v,"MieCoefficient",h.mieCoefficient,{min:0,max:.1,step:.001},w=>{h.mieCoefficient=w,_(),_md_(e)}),UC$1.make_key_value_with_slider(v,"MieDirectionalG",h.mieDirectionalG,{min:0,max:1,step:.001},w=>{h.mieDirectionalG=w,_(),_md_(e)})}f=!0}e.material?.uniforms?.waterColor!==void 0&&(UC$1.make_color_picker(r,"Water Color","#"+e.material?.uniforms?.waterColor.value.getHex().toString(16).padStart(6,"0"),h=>{e.material?.uniforms?.waterColor.value.setHex(h),e.material.needsUpdate=!0}),f=!0),e.material?.uniforms?.alpha!==void 0&&(UC$1.make_key_value_with_slider(r,"Wave Alpha",e.material.uniforms.alpha.value,{min:0,max:1,step:.01},h=>{e.material.uniforms.alpha.value=h,e.material.needsUpdate=!0}),f=!0),f||(UC$1.make_separator(r,{close:!1,sub:!0,title:T("g.there_is_no_item")}),a&&(a.classList.add("no_item"),a.classList.add("no_item_and_hidden")))}else UC$1.make_separator(r,{close:!1,sub:!0,title:T("g.there_is_no_item")}),a&&(a.classList.add("no_item"),a.classList.add("no_item_and_hidden"));if(!i){r.id="3d_light_panel",r.style.textAlign="left",r.style.width="100%";const c=document.getElementById("right_side_panel_tab_light");c&&(c.innerHTML="",c.appendChild(r))}}function IsArray(s){return Array.isArray(s)?!0:s instanceof FakeArray}function copy_material_params(s,e){const i={type:!0,id:!0,uuid:!0};for(const r in e)i[r]||s[r]!==void 0&&e[r]!==void 0&&(s[r]=e[r])}class FakeArray{constructor(e){this._data=e.slice()}get length(){return this._data.length}push(){if(this._freezed)throw"Already freezed";this._data.push(...arguments)}shift(){if(this._freezed)throw"Already freezed";return this._data.shift(...arguments)}pop(){if(this._freezed)throw"Already freezed";return this._data.pop(...arguments)}slice(){return this._data.slice(...arguments)}freeze(){for(let e=0;e<this._data.length;e++)this[e]=this._data[e];this._freezed=!0}[Symbol.iterator](){let e=-1;const i=this._data;return{next:()=>({value:i[++e],done:!(e in i)})}}}const TL$3=s=>(window.T&&window.T("tabs.material."+s),window.parent?.T?window.parent.T("tabs.material."+s):s);let G_material_clipboard=null,mouse_dragging_select=!1;function triggerMouseEvent(s,e){const i=document.createEvent("MouseEvents");i.initEvent(e,!0,!0),s.dispatchEvent(i)}const RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_ETC1_Format=36196,format_map={AlphaFormat,RedFormat,RedIntegerFormat,RGFormat,RGIntegerFormat,RGBAFormat,RGBAIntegerFormat,LuminanceFormat,LuminanceAlphaFormat,DepthFormat,DepthStencilFormat,RGB_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,RGB_ETC1_Format},type_map={UnsignedByteType,ByteType,ShortType,UnsignedShortType,IntType,UnsignedIntType,FloatType,HalfFloatType,UnsignedShort4444Type,UnsignedShort5551Type,UnsignedInt248Type},format_map_s={};for(const s in format_map)format_map_s[format_map[s]]=s;const type_map_s={};for(const s in type_map)type_map_s[type_map[s]]=s;const default_params_for_albedo={wrapS:RepeatWrapping,wrapT:RepeatWrapping,magFilter:LinearFilter,minFilter:LinearMipmapLinearFilter,colorSpace:SRGBColorSpace,flipY:!1,repeat:new Vector2(1,1)},default_params_for_other={wrapS:RepeatWrapping,wrapT:RepeatWrapping,magFilter:LinearFilter,minFilter:LinearMipmapLinearFilter,colorSpace:NoColorSpace,flipY:!1,repeat:new Vector2(1,1)},default_params_for_other2={wrapS:RepeatWrapping,wrapT:RepeatWrapping,magFilter:LinearFilter,minFilter:LinearMipmapLinearFilter,colorSpace:LinearSRGBColorSpace,flipY:!1,repeat:new Vector2(1,1)};function Modifier(s){const e={};if(e.material=s.material||s._material,e.material_overwrite=s.material_overwrite||s._material_overwrite,e.material_original=s.material_original||s._material_original,e.material_replacers=s._material_replacers,e.object=s,e._previous_=null,s.__material_modifier__=e,IsArray(e.material)){const o=[];for(const l of e.material)o.push([]);e.listeners=o}else e.listeners=[[]];function i(o,l){for(const a in l)typeof l[a]=="object"?(o[a]==null&&(o[a]={}),i(o[a],l[a])):o[a]=l[a]}function r(o){for(const l in o)o[l]instanceof Texture&&(o[l].needsUpdate=!0,console.log(l,"T:U"))}return e.change_material_type=o=>{},e.modify_selected=(o,l)=>{const a={needsUpdate:{texture:!1,material:!1}};o&&i(a,o);const c=e.material,d=e.material_overwrite,u=IsArray(c),f=c.length;let m=!1;if(u){for(let h=0;h<f;h++)if(c[h].ui?.selected){l(c[h]),l(d[h]),a.needsUpdate.material&&(c[h].needsUpdate=!0,d[h].needsUpdate=!0),a.needsUpdate.texture&&(r(c[h]),r(d[h]));for(const _ of e.listeners[h])_();c[h].castDynamicEnvironment&&(m=!0)}}else if(c.ui?.selected){l(c),l(d),a.needsUpdate.material&&(c.needsUpdate=!0,d.needsUpdate=!0),a.needsUpdate.texture&&(r(c),r(d));for(const h of e.listeners[0])h();c.castDynamicEnvironment&&(m=!0)}m&&DMC.dispatchEvent("update@dynamic_env_map")},e.modify=(o,l,a)=>{const c={needsUpdate:{texture:!1,material:!1}};l&&i(c,l);const d=e.material,u=e.material_overwrite,f=IsArray(d);let m=!1;f?(a(d[o]),a(u[o]),c.needsUpdate.material&&(d[o].needsUpdate=!0,u[o].needsUpdate=!0),c.needsUpdate.texture&&(r(d[o]),r(u[o])),d[o].castDynamicEnvironment&&(m=!0)):(a(d),a(u),c.needsUpdate.material&&(d.needsUpdate=!0,u.needsUpdate=!0),c.needsUpdate.texture&&(r(d),r(u)),d.castDynamicEnvironment&&(m=!0)),m&&DMC.dispatchEvent("update@dynamic_env_map")},e.modify_all=(o,l)=>{const a={needsUpdate:{texture:!1,material:!1}};o&&i(a,o);const c=e.material,d=e.material_overwrite,u=IsArray(c),f=c.length;let m=!1;if(u)for(let h=0;h<f;h++)l(c[h],h),l(d[h],h),a.needsUpdate.material&&(c[h].needsUpdate=!0,d[h].needsUpdate=!0),a.needsUpdate.texture&&(r(c[h]),r(d[h])),c[h].castDynamicEnvironment&&(m=!0);else l(c,0),l(d,0),a.needsUpdate.material&&(c.needsUpdate=!0,d.needsUpdate=!0),a.needsUpdate.texture&&(r(c),r(d)),c.castDynamicEnvironment&&(m=!0);m&&DMC.dispatchEvent("update@dynamic_env_map")},e.update=function(){e.modify_all({},o=>{o.needsUpdate=!0})},e.clear_selected=function(){e.modify_all({},(o,l)=>{o.ui==null&&(o.ui={selected:!1,first:!1}),o.ui.selected=!1}),e._previous_=null},e.clear_marked=function(){e.modify_all({},(o,l)=>{o.ui==null&&(o.ui={selected:!1,first:!1}),o.ui.first=!1}),e._previous_=null},e.first=function(){const o=e.get_overwrite_materials();for(let l=0;l<o.length;l++)if(o[l].ui?.first)return{object:o[l],index:l};return null},e.previous=function(){const o=this._previous_,l=e.get_overwrite_materials();return l[o]?{object:l[o],index:o}:null},e.select=function(o){const l=e.first();e.modify_all({},(a,c)=>{c==o&&(a.ui==null&&(a.ui={selected:!1,first:!1}),a.ui.selected=!0,l||(a.ui.first=!0))}),e._previous_=o},e.toggle=function(o){const l=e.first();let a=!1;return e.modify_all({},(c,d)=>{d==o&&(c.ui==null&&(c.ui={selected:!1,first:!1}),c.ui.selected=!c.ui.selected,a=c.ui.selected,!l&&c.ui.selected&&(c.ui.first=!0))}),e._previous_=o,a},e.plot=function(){let o=0;console.log("==========================="),e.modify_all({},(l,a)=>{a==o&&(console.log("M",l.name,l.ui.selected),o++)})},e.select_range=function(o,l){if(o>l){const c=o;o=l,l=c}const a={};return e.modify_all({},(c,d)=>{c.ui==null&&(c.ui={selected:!1,first:!1}),o<=d&&d<=l?(c.ui.selected=!0,a[d]=!0):a[d]=!1}),a},e.get_materials=function(){const o=e.material;return IsArray(o)?o:[o]},e.get_overwrite_materials=function(){const o=e.material_overwrite;return IsArray(o)?o:[o]},e}function CopyTextureProperties(s,e){e.wrapS!=null&&(s.wrapS=e.wrapS),e.wrapT!=null&&(s.wrapT=e.wrapT),e.magFilter!=null&&(s.magFilter=e.magFilter),e.minFilter!=null&&(s.minFilter=e.minFilter),e.colorSpace!=null&&(s.colorSpace=e.colorSpace),e.flipY!=null&&(s.flipY=e.flipY),e.anisotropy!=null&&(s.anisotropy=e.anisotropy),e.rotation!=null&&(s.rotation=e.rotation),e.premultiplyAlpha!=null&&(s.premultiplyAlpha=e.premultiplyAlpha),e.repeat!=null&&(s.repeat?s.repeat.copy(e.repeat):s.repeat=e.repeat.clone()),e.offset!=null&&(s.offset?s.offset.copy(e.offset):s.offset=e.offset.clone()),e.center!=null&&(s.center?s.center.copy(e.center):s.center=e.center.clone()),s instanceof CompressedTexture||s instanceof VideoTexture?s.generateMipmaps=!1:s.generateMipmaps=e.generateMipmaps,s instanceof VideoTexture&&e instanceof VideoTexture&&(s.image.volume=e.image.volume,s.image.loop=e.image.loop,s.image.muted=e.image.muted,s.image.autoplay=e.image.autoplay)}function BasePropComponent(s){const e={parent_panel:null,dependsOnMap:void 0};Object.assign(e,s);const i=e.parent_panel,r=e.dependsOnMap,o=e.opt,l=e.__local__material,a=e.modifier;e.__prop_name__;{const c=document.createElement("div"),d={};for(const u of o.sub){let f=function(h,_){if(d[u.prop].length<2)return;const b=h.type!="make_vec3_box";for(const v of d[u.prop])h!=v&&(b?v.set({x:_,y:_,z:_}):(v.modifier.value=_,v.slider&&(v.slider.value=_,v.update_animation())))};if(u==null||u.dependsOnMap!=r)continue;d[u.prop]==null&&(d[u.prop]=[]);const m=l[u.prop];if(m!==void 0)if(u.component=="float_box"){const h=UC$1.make_float_box(c,u.name,m,{},_=>{a.modify_selected(u.modifier_params||{},b=>{b[u.prop]=_,f(h,_)})});d[u.prop].push(h)}else if(u.component=="slider"){if(u.type=="Float"){const h={min:0,max:1,step:.01};u.params&&Object.assign(h,u.params);const _=UC$1.make_key_value_with_slider(c,u.name,m,h,b=>{a.modify_selected(u.modifier_params||{},v=>v[u.prop]=b),f(_,b)});d[u.prop].push(_)}else if(u.type=="Vector2"){const h={min:0,max:1,step:.01};u.params&&Object.assign(h,u.params);const _=UC$1.make_key_value_with_slider(c,u.name,m.x,h,b=>{a.modify_selected(u.modifier_params||{},v=>v[u.prop].x=v[u.prop].y=b),f(_,b)});d[u.prop].push(_)}else if(u.type=="Array"){const h={min:0,max:1,step:.01};u.params&&Object.assign(h,u.params);{const _=UC$1.make_key_value_with_slider(c,u.name,m[0],h,b=>{a.modify_selected(u.modifier_params||{},v=>v[u.prop][0]=b),f(_,b)});d[u.prop].push(_)}{const _=UC$1.make_key_value_with_slider(c,u.name,m[1],h,b=>{a.modify_selected(u.modifier_params||{},v=>v[u.prop][1]=b),f(_,b)});d[u.prop].push(_)}}}else if(u.component=="vec3"){const h={step:.01};if(u.default_values&&(h.default_values=u.default_values),u.type=="Vector3"){const _=UC$1.make_vec3_box(c,u.name,m,1,h,b=>{a.modify_selected(u.modifier_params||{},v=>{v[u.prop].x=b,f(_,b)})},b=>{a.modify_selected(u.modifier_params||{},v=>v[u.prop].y=b)},b=>{a.modify_selected(u.modifier_params||{},v=>v[u.prop].z=b)});d[u.prop].push(_)}else if(u.type=="Vector2"){const _=UC$1.make_vec3_box(c,u.name,m,1,h,b=>{a.modify_selected(u.modifier_params||{},v=>{v[u.prop].x=b,f(_,b)})},b=>{a.modify_selected(u.modifier_params||{},v=>v[u.prop].y=b)});d[u.prop].push(_)}}else u.component=="color"?UC$1.make_color_picker(c,u.name,"#"+m.getHex().toString(16).padStart(6,"0"),h=>{a.modify_selected(u.modifier_params||{},_=>_[u.prop].setHex(h))}):u.component=="boolean"?UC$1.make_toggle(c,u.name,m,{},h=>{a.modify_selected({needsUpdate:{texture:!0,material:!0}},_=>{_[u.prop]=h})}):u.component=="pulldown"&&UC$1.make_pulldown(c,u.name,u.values,m,{},h=>{a.modify_selected({needsUpdate:{texture:!0,material:!0}},_=>{_[u.prop]!==void 0&&(_[u.prop]=Number(h))})})}i.insertBefore(c,i.firstChild)}}function __load_and_attach_texture__(s){const e={};Object.assign(e,s);const i=e.texture_path,r=e.modifier,o=e.__material_index,l=e.__ui_params__,a=e.__prop_name__,c=e.panel,d=e.__local__material,u=e.title,f=e.opt,m=e.__dp__maps;let h=!1;console.log("Try to loaded:",i.slice(0,256));let _=default_params_for_albedo;a=="map"||a=="emissiveMap"||a=="specularColorMap"?_=default_params_for_albedo:a=="envMap"||a=="lightMap"?_=default_params_for_other2:_=default_params_for_other,Builder3D.load_texture(i,{cache:!1,replacer:!1},(b,v)=>{let w=!(v instanceof VideoTexture);if(b){console.error(b);return}console.log(w);function y(M){const S=M.map,D=M[a],k=M[a]=v.clone();w&&!(D instanceof VideoTexture)&&(D?CopyTextureProperties(k,D):CopyTextureProperties(k,_)),D?k.flipY=D.flipY:S?k.flipY=S.flipY:a=="map"&&(k.flipY=!0),console.log("FlipY",k.flipY),k.needsUpdate=!0,k.source_file=i,M.needsUpdate=!0,console.log("Loaded:",i),D&&D.dispose()}h?(r.modify(o,{needsUpdate:{material:!0,texture:!0}},y),v.dispose()):(r.modify_selected({needsUpdate:{material:!0,texture:!0}},y),v.dispose(),c.innerHTML="",MakeTextureComponent(c,d,o,r,u,f,a,m,l)),h=!0})}function MakeTextureComponent(s,e,i,r,o,l,a,c,d={}){const u=e[a];if(u!==void 0){let f=function(M){v.classList.add("dragover"),M.stopPropagation(),M.preventDefault()},m=function(M){v.classList.remove("dragover"),M.stopPropagation(),M.preventDefault()},h=function(M){v.classList.remove("dragover"),M.stopPropagation(),M.preventDefault(),r.clear_marked()};c[a]==null&&(c[a]={opened:!1});let _=null,b=null;if(u){const M=C$2.make_thumbnail_texture_to_image(u,{width:20,height:20});b=UC$1.make_toggle_window(s,{title:`<span style="color:#E80">${o}</span>`,toggle:c[a].opened},L=>{c[a].opened=L}),_=b.holder;const S=document.createElement("div");S.style.cssText="position:absolute;right:3px;width:25px;height:20px;display:flex;align-items:center",M.style.outline="1px solid #555",M.style.width=M.style.height="20px",S.appendChild(M),u?.isCompressedTexture?M.style.borderRight="5px solid #00FF00":u?.isVideoTexture?M.style.borderRight="5px solid #FF00FF":u?.isTexture?M.style.borderRight="5px solid #0077FF":M.style.borderRight="5px solid gray",b.element.querySelector(".title").appendChild(S),BasePropComponent({parent_panel:_,dependsOnMap:!0,opt:l,modifier:r,__local__material:e,__prop_name__:a});let D=document.createElement("div");D.style.margin="7px",D.style.boxShadow="0px 0px 20px #00000066",_.appendChild(D);{if(a=="map"&&u.source_file&&UC$1.make_button(D,"No overwrite","Revert",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{u.source_file=null,r.modify_selected({},L=>{L[a].source_file=null,L.needsUpdate=!0}),s.innerHTML="",MakeTextureComponent(s,e,i,r,o,l,a,c,d)}),UC$1.make_button(D,"Unload Texture","Unload",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{r.modify_selected({},L=>{L[a]?.dispose?.(),L[a]?.dispose_watcher?.(),L[a]=null,L.needsUpdate=!0}),s.innerHTML="",MakeTextureComponent(s,e,i,r,o,l,a,c,d)}),u._source_file_||u.source_file){const L=u._source_file_||u.source_file;if(window.is_data_url(L)==!1){UC$1.make_button(D,"Reload Texture","Reload",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{__load_and_attach_texture__({texture_path:L,modifier:r,__material_index:i,__ui_params__:d,__prop_name__:a,panel:s,__local__material:e,title:o,opt:l,__dp__maps:c})}),window.external_io?.watch&&(e._watch_textures_=e._watch_textures_||{},UC$1.make_toggle(D,"🧪Watch",u._watch_texture_!=null,{},async z=>{if(z){async function K(V){return console.log("Watch:",V),window.cross_file_system.watch(V,async function(Y,q){console.log(Y,q),V==Y&&(console.log("Reload Texture"),__load_and_attach_texture__({texture_path:V,modifier:r,__material_index:i,__ui_params__:d,__prop_name__:a,panel:s,__local__material:e,title:o,opt:l,__dp__maps:c}))})}async function Z(){e._watch_textures_[L]?.close?.(),e._watch_textures_[L]=await K(L)}await Z()}else e._watch_textures_&&(e._watch_textures_[L]?.close?.(),delete e[L],console.log("Disable and delete watcher."))}));const N=L.replace(/\\/g,"/").split("/").pop();UC$1.make_button(D,N,"Folder",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{if(window.external_io){const z=L.slice(0,L.lastIndexOf("/"))+"/";window.file_browser.open(z)}else window.nodejs?window.nodejs.open_in_finder(L):C$2.modal_ok_cancel("Notice","There is no file system.",{})})}}if(a=="map"&&e.userData?.MMD?.mapFileName){const L=e.userData?.MMD?.mapFileName,P=e.userData?.MMD?.matcapFileName;UC$1.make_key_value2(D,"PMX Diffuse",L),UC$1.make_key_value2(D,"PMX Env",P||"None")}}if(D=UC$1.make_toggle_window(D,{title:'<span style="color:#999">Texture Parameter</span>',toggle:d.toggle},L=>{d.toggle=L}).holder,UC$1.make_vec3_box(D,"Repeat",u.repeat,1,{initializers:[{title:"2",values:[2,2]},{title:"4",values:[4,4]},{title:"8",values:[8,8]}],step:.01,default_values:[1,1]},L=>{r.modify_selected({needsUpdate:{material:!0,texture:!0}},P=>P[a].repeat.x=L)},L=>{r.modify_selected({needsUpdate:{material:!0,texture:!0}},P=>P[a].repeat.y=L)}),UC$1.make_vec3_box(D,"UV Offset",u.offset,1,{step:.1},L=>{r.modify_selected({},P=>P[a].offset.x=L)},L=>{r.modify_selected({},P=>P[a].offset.y=L)}),UC$1.make_vec3_box(D,"UV Center",u.center,1,{step:.1},L=>{r.modify_selected({},P=>P[a].center.x=L)},L=>{r.modify_selected({},P=>P[a].center.y=L)}),UC$1.make_key_value_with_slider(D,"UV Rotation",u.rotation/(Math.PI/180),{min:-180,max:180,step:1},L=>{r.modify_selected({},P=>P[a].rotation=L*Math.PI/180)}),UC$1.make_pulldown(D,"WrapS",[{key:"RepeatWrapping",value:RepeatWrapping},{key:"ClampToEdgeWrapping",value:ClampToEdgeWrapping},{key:"MirroredRepeatWrapping",value:MirroredRepeatWrapping}],u.wrapS,{},L=>{r.modify_selected({needsUpdate:{texture:!0}},P=>P[a].wrapS=Number(L))}),UC$1.make_pulldown(D,"WrapT",[{key:"RepeatWrapping",value:RepeatWrapping},{key:"ClampToEdgeWrapping",value:ClampToEdgeWrapping},{key:"MirroredRepeatWrapping",value:MirroredRepeatWrapping}],u.wrapT,{},L=>{r.modify_selected({needsUpdate:{texture:!0}},P=>P[a].wrapT=Number(L))}),UC$1.make_toggle(D,"FlipY",u.flipY,{},L=>{if(r.modify_selected({needsUpdate:{material:!0,texture:!0}},P=>P[a].flipY=L),u.isCompressedTexture&&(u._source_file_||u.source_file)){const P=u._source_file_||u.source_file;__load_and_attach_texture__({texture_path:P,modifier:r,__material_index:i,__ui_params__:d,__prop_name__:a,panel:s,__local__material:e,title:o,opt:l,__dp__maps:c})}}),UC$1.make_pulldown(D,"MagFilter",[{key:"LinearFilter",value:LinearFilter},{key:"NearestFilter",value:NearestFilter}],u.magFilter,{},L=>{r.modify_selected({needsUpdate:{texture:!0,material:!0}},P=>P[a].magFilter=Number(L))}),UC$1.make_pulldown(D,"MinFilter",[{key:"LinearMipmapLinearFilter",value:LinearMipmapLinearFilter},{key:"LinearFilter",value:LinearFilter},{key:"NearestFilter",value:NearestFilter}],u.minFilter,{},L=>{r.modify_selected({needsUpdate:{texture:!0}},P=>P[a].minFilter=Number(L))}),UC$1.make_pulldown(D,"Color Encoding",[{key:"NoColorSpace",value:NoColorSpace},{key:"SRGBColorSpace",value:SRGBColorSpace},{key:"LinearSRGBColorSpace",value:LinearSRGBColorSpace},{key:"BasicDepthPacking",value:BasicDepthPacking},{key:"RGBADepthPacking",value:RGBADepthPacking}],u.colorSpace,{},L=>{if(r.modify_selected({needsUpdate:{texture:!0,material:!0}},P=>{P[a].colorSpace=L}),u._source_file_||u.source_file){const P=u._source_file_||u.source_file;__load_and_attach_texture__({texture_path:P,modifier:r,__material_index:i,__ui_params__:d,__prop_name__:a,panel:s,__local__material:e,title:o,opt:l,__dp__maps:c})}}),u.generateMipmaps!=null&&UC$1.make_toggle(D,"GenerateMipmaps",u.generateMipmaps,{},L=>{r.modify_selected({needsUpdate:{texture:!0,material:!0}},P=>P[a].generateMipmaps=L)}),u.premultiplyAlpha!=null&&UC$1.make_toggle(D,"PremultiplyAlpha",u.premultiplyAlpha,{},L=>{r.modify_selected({needsUpdate:{texture:!0,material:!0}},P=>P[a].premultiplyAlpha=L)}),u.unpackAlignment!=null&&UC$1.make_key_value2(D,"UnpackAlignment",u.unpackAlignment,{value_css:{width:"100px"}}),u.format!=null&&UC$1.make_key_value2(D,"Format",format_map_s[u.format],{value_css:{width:"100px"}}),u.type!=null&&UC$1.make_key_value2(D,"Type",type_map_s[u.type],{value_css:{width:"100px"}}),u.width!=null&&UC$1.make_key_value2(D,"Width",u.width,{value_css:{width:"100px"}}),u.height!=null&&UC$1.make_key_value2(D,"Height",u.height,{value_css:{width:"100px"}}),u.play!=null){let L=null,P=null;UC$1.make_toggle(D,"Loop",u.getLoop(),{},K=>{u.setLoop(K)}),UC$1.make_toggle(D,"Muted",u.getMuted(),{},K=>{u.setMuted(K)}),UC$1.make_toggle(D,"Autoplay",u.getAutoPlay(),{},K=>{u.setAutoPlay(K)}),UC$1.make_key_value_with_slider(D,"Volume",u.getVolume(),{min:0,max:1},K=>{u.setVolume(K)});const N=document.createElement("button"),z=document.createElement("i");N.appendChild(z),z.classList.add("bi","bi-play-fill"),N.style.cssText="width:30px",N.onclick=function(){z.classList.contains("bi-play-fill")?(z.classList.remove("bi-play-fill"),z.classList.add("bi-stop-fill"),u.play(),L&&clearInterval(L),L=setInterval(()=>{P.slider.value=P.modifier.value=Math.floor(u.getCurrentTime()*100)/100,P.update_animation()},137)):(z.classList.remove("bi-stop-fill"),z.classList.add("bi-play-fill"),u.stop(),L&&clearInterval(L),L=null,P.slider.value=P.modifier.value=0,P.update_animation())},P=UC$1.make_key_value_with_slider(D,N,0,{min:0,max:u.getDuration()},K=>{u.setCurrentTime(K)})}}else b=UC$1.make_toggle_window(s,{title:`<span style="color:#540">${o}</span>`,toggle:c[a].opened},M=>{c[a].opened=M}),_=b.holder;BasePropComponent({parent_panel:_,dependsOnMap:void 0,opt:l,__local__material:e,modifier:r,__prop_name__:a});const v=document.createElement("div");v.style.width="100%",v.style.height="20px",v.style.display="flex",v.style.alignItems="center",v.style.justifyContent="center",v.classList.add("texture_map_draggable_component");const w=document.createElement("span");w.innerText="Drag and Drop here",w.style.fontSize="12px",w.style.color="#666",v.appendChild(w),_.appendChild(v);async function y(M,S){S.preventDefault(),S.stopPropagation(),console.log(S.dataTransfer);const D=S.dataTransfer.getData("json"),k=S.dataTransfer.types.includes("Files"),O=S.dataTransfer.types.includes("json");if(C$2.modal_processing("Processing",""),M.classList.remove("dragover"),O&&D.length>0){const L=JSON.parse(D);if(L.target_file_paths){const P=L.target_file_paths[0];P?.absolute_path&&__load_and_attach_texture__({texture_path:P.absolute_path,modifier:r,__material_index:i,__ui_params__:d,__prop_name__:a,panel:s,__local__material:e,title:o,opt:l,__dp__maps:c}),C$2.close_modal_processing()}else C$2.close_modal_processing()}else if(k){const P=(await UC$1.get_dropped_items(S)).files;if(window.external_io){if(window.external_io.driver!="local"){if(C$2.close_modal_processing(),!await C$2.modal_ok_cancel_promise("Notice","<div>The texture does not save in External I/O.</div><div>Are you sure?</div>",{}))return;C$2.modal_processing("Processing","")}}else if(!window.external_io&&!window.nodejs){if(C$2.close_modal_processing(),!await C$2.modal_ok_cancel_promise("Notice","<div>The texture does not save in External I/O.</div><div>Are you sure?</div>",{}))return;C$2.modal_processing("Processing","")}if(S.dataTransfer.items&&P.length>0){const N=P[0];if(window.is_electron){let z=N.file.path;z=z.replace(/\\/g,"/"),console.log("Try to load:",z),__load_and_attach_texture__({texture_path:z,modifier:r,__material_index:i,__ui_params__:d,__prop_name__:a,panel:s,__local__material:e,title:o,opt:l,__dp__maps:c})}else{const K=await function(q){return new Promise((J,W)=>{const te=new FileReader;te.readAsArrayBuffer(q),te.onloadend=function(){J(te.result)},te.onerror=function(ie){W(ie)}})}(N.file),Z=C$2.DPath(N.file_path).ext,V=await window.cross_file_system.tmp_dir(),H=C$2.md5.hex(K)+"."+Z,Y=C$2.DPathJoin(V,H);await window.cross_file_system.write(Y,K),__load_and_attach_texture__({texture_path:Y,modifier:r,__material_index:i,__ui_params__:d,__prop_name__:a,panel:s,__local__material:e,title:o,opt:l,__dp__maps:c})}}C$2.close_modal_processing()}else C$2.close_modal_processing()}b.element.ondrop=function(M){y(v,M)},b.element.ondragover=f,b.element.ondragleave=m,b.element.ondragend=h}}var bound_object$2=null;async function UI_MaterialPanel(){if(document.getElementById("right_side_panel_tab_material_button")==null||window.app_mode)return;let s=window.DMC.current.object;mouse_dragging_select=!1,InitializeMaterials(s);function e(a){let c=!1;return a==bound_object$2&&(c=!0),a?.parent&&(c=c||e(a.parent)),c}function i(a){let c=null;return a?.material&&(c=a),a?.parent&&(c=c||i(a.parent)),c}if(bound_object$2){if(e(s))return;bound_object$2=null}else{const a=i(s),c=s?.getDDDProperties?.()?.type;let d=!1;if(a?a?.getDDDProperties?.()?.type=="pmx"?bound_object$2=s=a:c=="fbx"||c=="gltf"||c=="glb"||c=="vrm"?d=!0:bound_object$2=s=a:(c=="fbx"||c=="gltf"||c=="glb"||c=="vrm")&&(d=!0),d){delete s._material,delete s._material_overwrite,delete s._material_original;const u=[],f=[],m=[],h=[];s.traverse(_=>{if(_.material&&_.material_overwrite)if(IsArray(_.material))for(let b=0;b<_.material.length;b++)u.push(_.material[b]),f.push(_.material_overwrite[b]),m.push(_.material[b]),h.push(v=>{const w=new THREE$1[v],y=new THREE$1[v],M=_.material[b],S=_.material_overwrite[b];_.material[b]=w,_.material_overwrite[b]=y,copy_material_params(_.material[b],M),copy_material_params(_.material_overwrite[b],S),M.dispose(),S.dispose(),w.needsUpdate=!0});else u.push(_.material),f.push(_.material_overwrite),m.push(_.material),h.push(b=>{const v=new THREE$1[b],w=new THREE$1[b],y=_.material,M=_.material_overwrite;_.material=v,_.material_overwrite=w,copy_material_params(_.material,y),copy_material_params(_.material_overwrite,M),y.dispose(),M.dispose(),v.needsUpdate=!0})}),s._material=new FakeArray(u),s._material_overwrite=new FakeArray(f),s._material_original=new FakeArray(m),s._material_replacers=h,s._material.freeze(),s._material_overwrite.freeze(),s._material_original.freeze(),bound_object$2=s}}const r=document.getElementById("3d_object_material_panel"),o=r||document.createElement("div");DMC.ui.material_panel=r,o.innerHTML="",UC$1.make_separator(o,{close:!1,sub:!0,title:TL$3("material")}),document.getElementById("right_side_panel_tab_material_button").classList.remove("no_item_and_hidden"),document.getElementById("right_side_panel_tab_material_button").classList.remove("no_item");const l=s?.getDDDProperties?.();if((s?.material||s?._material)&&l){const a=document.createElement("div");a.style.overflowY="scroll",a.style.maxHeight="400px",a.style.minHeight="50px",a.style.width="calc(100% - 2px)";const c=document.createElement("div");c.style.width="100%";let d=null;a.onmouseleave=function(){mouse_dragging_select=!1};let u=Modifier(s);{let f=function(v,w){const y=document.createElement("button");y.style.width="100%",y.classList.add("__material_property__"),y.style.backgroundColor="#222",y.style.margin="0px",y.style.padding="0px",y.style.height="18px";const M=w.name;m.push({element:y,data:M});const S=document.createElement("div");S.innerText=M,S.style.display="flex",S.style.alignItems="center",S.style.width="calc(100% - 22px - 22px - 22px - 25px)",S.style.paddingLeft="3px",S.style.overflow="hidden",S.style.textOverflow="ellipsis",S.style.whiteSpace="nowrap",S.style.borderRight="1px solid #333",S.style.fontSize="12px";const D=document.createElement("div");D.innerText=v,D.style.display="flex",D.style.alignItems="center",D.style.justifyContent="center",D.style.width="25px",D.style.borderRight="1px solid #333",D.style.backgroundColor="#111",D.style.fontSize="10px",D.style.color="#99BBFF",y.appendChild(D),y.appendChild(S);const k=document.createElement("div");k.style.float="right",k.style.textAlign="right",k.style.display="flex",k.style.alignItems="center",k.style.justifyContent="right",k.style.margin="0px",k.style.padding="0px",k.style.height="18px",y.appendChild(k);function O(){const P=w;if(k.innerHTML="",P.visible!==void 0){const K=document.createElement("button");K.style.float="right",K.style.width="20px",K.style.height="15px",K.style.background="none",K.style.backgroundColor="none",K.style.borderRight="1px solid #333";let Z=document.createElement("i");Z.classList.add("bi"),Z.classList.add("bi-eye"),P.visible?(Z.classList.add("bi-eye"),Z.classList.remove("bi-eye-slash")):(Z.classList.remove("bi-eye"),Z.classList.add("bi-eye-slash")),K.onmousedown=V=>{Z.classList.contains("bi-eye")?(Z.classList.remove("bi-eye"),Z.classList.add("bi-eye-slash"),u.modify(v,{},H=>H.visible=!1)):(Z.classList.add("bi-eye"),Z.classList.remove("bi-eye-slash"),u.modify(v,{},H=>H.visible=!0)),V.stopPropagation()},K.appendChild(Z),k.appendChild(K)}if(P.side!==void 0){let K=function(){V.classList.remove("bi-arrows-expand"),V.classList.remove("bi-arrow-up-left-square"),V.classList.remove("bi-arrow-up-left-square-fill"),P.side==DoubleSide?V.classList.add("bi-arrows-expand"):P.side==FrontSide?V.classList.add("bi-arrow-up-left-square"):P.side==BackSide&&V.classList.add("bi-arrow-up-left-square-fill")};const Z=document.createElement("button");Z.style.float="right",Z.style.width="20px",Z.style.height="15px",Z.style.background="none",Z.style.backgroundColor="none",Z.style.borderRight="1px solid #333";let V=document.createElement("i");V.classList.add("bi");const H={};H[DoubleSide]=FrontSide,H[FrontSide]=BackSide,H[BackSide]=DoubleSide,K(),Z.onmousedown=Y=>{u.modify(v,{needsUpdate:{material:!0}},q=>{q.side=H[q.side]}),K(),Y.stopPropagation()},Z.appendChild(V),k.appendChild(Z)}if(P.shadowSide!==void 0){let K=function(){H.classList.remove("bi-arrows-expand"),H.classList.remove("bi-arrow-up-left-square"),H.classList.remove("bi-arrow-up-left-square-fill"),H.classList.remove("bi-square"),P.shadowSide==DoubleSide?H.classList.add("bi-arrows-expand"):P.shadowSide==FrontSide?H.classList.add("bi-arrow-up-left-square"):P.shadowSide==BackSide?H.classList.add("bi-arrow-up-left-square-fill"):P.shadowSide==null&&H.classList.add("bi-square")};const Z=document.createElement("button");Z.style.float="right",Z.style.width="20px",Z.style.height="15px",Z.style.background="none",Z.style.backgroundColor="none",Z.style.borderRight="1px solid #333",Z.style.position="relative";const V=document.createElement("span");V.style.position="absolute",V.style.right="3px",V.style.bottom="0px",V.style.fontSize="8px",V.innerText="S",V.style.textShadow="-1px -1px 0 #222,  1px -1px 0 #222, -1px 1px 0 #333, 1px 1px 0 #222",Z.appendChild(V);let H=document.createElement("i");H.classList.add("bi");const Y={};Y[null]=FrontSide,Y[FrontSide]=BackSide,Y[BackSide]=DoubleSide,Y[DoubleSide]=null,K(),Z.onmousedown=q=>{u.modify(v,{needsUpdate:{material:!0}},J=>{J.shadowSide=Y[J.shadowSide]}),K(),q.stopPropagation()},Z.appendChild(H),k.appendChild(Z)}if(P.blending!==void 0){let K=function(){H.classList.remove("bi-record-circle"),H.classList.remove("bi-circle-fill"),P.blending==NormalBlending||P.transparent||P.opacity<1?P.transparent==!1||P.blending==NoBlending?H.classList.add("bi-record-circle"):H.classList.add("bi-circle"):P.blending==NoBlending&&H.classList.add("bi-circle-fill")};const Z=document.createElement("button");Z.style.float="right",Z.style.width="20px",Z.style.height="15px",Z.style.background="none",Z.style.backgroundColor="none",Z.style.borderRight="1px solid #333",Z.style.position="relative";const V=document.createElement("span");V.style.position="absolute",V.style.right="3px",V.style.bottom="0px",V.style.fontSize="8px",V.innerText="B",V.style.textShadow="-1px -1px 0 #222,  1px -1px 0 #222, -1px 1px 0 #333, 1px 1px 0 #222";let H=document.createElement("i");H.classList.add("bi");const Y={};Y[NormalBlending]=NoBlending,Y[NoBlending]=NormalBlending,K(),Z.onmousedown=q=>{u.modify(v,{needsUpdate:{material:!0}},J=>{J.blending=Y[J.blending]}),K(),q.stopPropagation()},Z.appendChild(H),k.appendChild(Z)}function N(K,Z,V,H,Y){const q=document.createElement("input");q.style.width="16px",q.style.height="15px",q.type="color",q.style.float="right",q.style.margin="0px",q.style.padding="0px",q.style.textAlign="center",q.style.border="0px",q.style.display="flex",q.style.alignItems="center",q.style.justifyContent="center",q.style.borderRight="1px solid #333",q.onfocus=()=>{q.select()},q.onchange=function(ie){W.style.color=ie.target.value,te(ie.target.value);const oe=parseInt(ie.target.value.replace("#","0x"),16);u.modify(v,{},Ce=>Y(Ce,isNaN(oe)?0:oe))},q.oninput=function(ie){W.style.color=ie.target.value,te(ie.target.value);const oe=parseInt(ie.target.value.replace("#","0x"),16);u.modify(v,{},Ce=>Y(Ce,isNaN(oe)?0:oe))},q.value=V,q.ondragstart=()=>!1,q.ondrop=()=>!1,q.onkeydown=ie=>{ie.key=="Enter"&&ie.isComposing==!1&&setTimeout(()=>q.blur(),0)},q.onmousedown=function(ie){ie.stopPropagation()};const J=document.createElement("div");J.style.position="relative";const W=document.createElement("span");W.style.position="absolute",W.style.right="3px",W.style.bottom="0px",W.style.fontSize="8px",W.style.color=V;function te(ie){const oe=parseInt(ie.replace("#","0x"),16),Ce=(oe&16711680)>>16,ve=(oe&65280)>>8,we=(oe&255)>>0;Ce<50&&ve<50&&we<50?W.style.textShadow="-1px -1px 0 #FFF,  1px -1px 0 #FFF, -1px 1px 0 #FFF, 1px 1px 0 #FFF":W.style.textShadow="-1px -1px 0 #222,  1px -1px 0 #222, -1px 1px 0 #333, 1px 1px 0 #222"}te(V),W.innerText=Z,W.onmousedown=function(ie){q.click(),ie.stopPropagation()},J.appendChild(W),J.appendChild(q),J.style.opacity=`${H}`,K.appendChild(J)}function z(K){const Z=(K&16711680)>>16,V=(K&65280)>>8,H=(K&255)>>0;return"#"+(("00"+Z.toString(16)).slice(-2)+("00"+V.toString(16)).slice(-2)+("00"+H.toString(16)).slice(-2))}P.color!==void 0&&N(k,"C",z(P.color.getHex()),P.opacity,(K,Z)=>{K.color.setHex(Z)});{const K=C$2.make_thumbnail_texture_to_image(P.map,{width:20,height:20});K.style.width=K.style.height="17px",K.style.outline="1px solid #555",P.map?.isCompressedTexture?K.style.borderRight="5px solid #00FF00":P.map?.isVideoTexture?K.style.borderRight="5px solid #FF00FF":P.map?.isTexture?K.style.borderRight="5px solid #0077FF":K.style.borderRight="5px solid gray",K.onmousedown=function(Z){Z.stopPropagation()},k.appendChild(K)}}O(),u.listeners[v].push(O);const L=function(P){if(P.force){const Z=u.previous();if(Z){const V=document.querySelectorAll(".__material_property__"),H=u.select_range(Z.index,v);for(let Y=0;Y<V.length;Y++){const q=V[Y],J=H[Y];q.style.backgroundColor=J?"#335":"#222"}}else u.select(v);y.style.backgroundColor="#335"}else if(P.ctrlKey==!0||P.metaKey==!0){const Z=u.toggle(v);y.style.backgroundColor=Z?"#335":"#222"}else if(P.shiftKey==!0&&u.first()){u.clear_selected();const Z=document.querySelectorAll(".__material_property__"),V=u.select_range(u.first().index,v);for(let H=0;H<Z.length;H++){const Y=Z[H],q=V[H];Y.style.backgroundColor=q?"#335":"#222"}}else document.querySelectorAll(".__material_property__").forEach(Z=>{Z.style.backgroundColor="#222"}),u.clear_selected(),u.clear_marked(),u.select(v),y.style.backgroundColor="#335";c.innerHTML="",UC$1.make_key_value2(c,TL$3("name"),w.name,{value_css:{width:"120px"}},Z=>{u.modify(v,{},V=>V.name=Z)}),UC$1.make_key_value2(c,TL$3("material_type"),w.type,{value_css:{width:"120px"}}),w.visible!==void 0&&UC$1.make_toggle(c,TL$3("visibility"),w.visible,{},Z=>{u.modify_selected({},V=>V.visible=Z)});const N={};UC$1.make_button(c,TL$3("auto_alpha"),"Setup",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{u.modify_selected({},Z=>{Z.alphaTest!==void 0&&(Z.alphaTest=.01),Z.blending!==void 0&&(Z.blending=NormalBlending),Z.alphaToCoverage!==void 0&&(Z.alphaToCoverage=!1),Z.premultipliedAlpha!==void 0&&(Z.premultipliedAlpha=!1),Z.transparent!==void 0&&(Z.transparent=!0),bound_object$2=null}),N.alphaTest!=null&&(N.alphaTest.modifier.value="0.01"),N.blending!=null&&(N.blending.modifier.value=String(NormalBlending)),N.alphaToCoverage!=null&&(N.alphaToCoverage.modifier2.value=!1),N.premultipliedAlpha!=null&&(N.premultipliedAlpha.modifier2.value=!1),N.transparent!=null&&(N.transparent.modifier2.value=!0)}),UC$1.make_button(c,TL$3("no_alpha"),"Setup",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{u.modify_selected({},Z=>{Z.alphaTest!==void 0&&(Z.alphaTest=0),Z.blending!==void 0&&(Z.blending=NoBlending),Z.alphaToCoverage!==void 0&&(Z.alphaToCoverage=!1),Z.premultipliedAlpha!==void 0&&(Z.premultipliedAlpha=!1),Z.transparent!==void 0&&(Z.transparent=!1),bound_object$2=null}),N.alphaTest!=null&&(N.alphaTest.modifier.value="0.0"),N.blending!=null&&(N.blending.modifier.value=String(NoBlending)),N.alphaToCoverage!=null&&(N.alphaToCoverage.modifier2.value=!1),N.premultipliedAlpha!=null&&(N.premultipliedAlpha.modifier2.value=!1),N.transparent!=null&&(N.transparent.modifier2.value=!1)}),N.transparent=UC$1.make_toggle(c,TL$3("transparent"),w.transparent,{},Z=>{u.modify_selected({needsUpdate:{material:!0}},V=>V.transparent=Z)}),w.alphaToCoverage!=null&&(N.alphaToCoverage=UC$1.make_toggle(c,TL$3("alpha_to_coverage"),w.alphaToCoverage,{},Z=>{u.modify_selected({needsUpdate:{material:!0}},V=>V.alphaToCoverage=Z)})),w.premultipliedAlpha!=null&&(N.premultipliedAlpha=UC$1.make_toggle(c,TL$3("premultiplied_alpha"),w.premultipliedAlpha,{},Z=>{u.modify_selected({needsUpdate:{material:!0}},V=>V.premultipliedAlpha=Z)})),UC$1.make_key_value_with_slider(c,TL$3("opacity"),w.opacity,{min:0,max:1,step:.01},Z=>{u.modify_selected({},V=>V.opacity=Z)}),N.alphaTest=UC$1.make_key_value_with_slider(c,TL$3("alpha_test"),w.alphaTest,{min:0,max:1,step:.01},Z=>{u.modify_selected({},V=>V.alphaTest=Z)}),N.alphaHash=UC$1.make_toggle(c,TL$3("alpha_hash"),w.alphaHash,{},Z=>{u.modify_selected({needsUpdate:{material:!0}},V=>V.alphaHash=Z)}),UC$1.make_toggle(c,TL$3("cast_dynamic_env"),!!w.castDynamicEnvironment,{},Z=>{u.modify_selected({},V=>{V.castDynamicEnvironment=Z,V.needsUpdate=!0,DMC.dispatchEvent("update@dynamic_env_map")})}),UC$1.make_toggle(c,TL$3("receive_shadow"),!!w.receiveShadow,{},Z=>{u.modify_selected({},V=>{V.receiveShadow=Z,V.needsUpdate=!0})}),UC$1.make_pulldown(c,TL$3("side"),[{key:"DoubleSide",value:DoubleSide},{key:"FrontSide",value:FrontSide},{key:"BackSide",value:BackSide}],w.side,{},Z=>{u.modify_selected({},V=>{V.side=Number(Z),V.needsUpdate=!0})}),UC$1.make_pulldown(c,TL$3("shadow_side"),[{key:"DoubleSide",value:DoubleSide},{key:"FrontSide",value:FrontSide},{key:"BackSide",value:BackSide}],w.shadowSide,{},Z=>{u.modify_selected({},V=>{V.shadowSide=Number(Z),V.needsUpdate=!0})}),UC$1.make_toggle(c,TL$3("depth_write"),w.depthWrite,{},Z=>{u.modify_selected({},V=>V.depthWrite=Z)}),w.depthTest!==void 0&&UC$1.make_toggle(c,TL$3("depth_test"),w.depthTest,{},Z=>{u.modify_selected({},V=>V.depthTest=Z)}),w.sizeAttenuation!==void 0&&UC$1.make_toggle(c,TL$3("size_attenuation"),!!w.sizeAttenuation,{},Z=>{u.modify_selected({},V=>{V.sizeAttenuation=Z,V.needsUpdate=!0})});const z=document.createElement("div");c.appendChild(z),z.style.paddingTop="10px",z.style.paddingBottom="10px";{l.maps||(l.maps={});const Z={alphaMap:{name:TL$3("alpha_map"),sub:[]},map:{name:TL$3("albedo_diffuse_map"),sub:[{name:"Color",prop:"color",type:"Color",component:"color"},{name:"Diffuse",prop:"diffuse",type:"Color",component:"color"},{name:"AttenuationColor",prop:"attenuationColor",type:"Color",component:"color"},{name:"AttenuationDistance",prop:"attenuationDistance",type:"Float",component:"slider"}]},normalMap:{name:TL$3("normal_map"),sub:[{name:"NormalMapType",prop:"normalMapType",type:"Integer",component:"pulldown",values:[{key:"TangentSpaceNormalMap",value:TangentSpaceNormalMap},{key:"ObjectSpaceNormalMap",value:ObjectSpaceNormalMap}],dependsOnMap:!0},{name:"NormalScale",prop:"normalScale",type:"Vector2",component:"vec3",default_values:[1,1,1],dependsOnMap:!0},{name:"NormalScaleAll",prop:"normalScale",type:"Vector2",component:"slider",params:{max:2,step:.01},dependsOnMap:!0}]},roughnessMap:{name:TL$3("roughness_map"),sub:[{name:"IoR",prop:"ior",type:"Float",component:"slider",params:{min:1,max:2.333,step:.001}},{name:"Reflectivity",prop:"reflectivity",type:"Float",component:"slider"},{name:"Roughness",prop:"roughness",type:"Float",component:"slider"}]},specularMap:{name:TL$3("specular_map"),sub:[{name:"Specular",prop:"specular",type:"Color",component:"color"},{name:"Shininess",prop:"shininess",type:"Float",component:"slider",params:{max:300,step:.5}}]},specularColorMap:{name:TL$3("specular_color_map"),sub:[{name:"SpecularColor",prop:"specularColor",type:"Color",component:"color"}]},specularIntensityMap:{name:TL$3("specular_intensity_map"),sub:[{name:"SpecularIntensity",prop:"specularIntensity",type:"Float",component:"slider",params:{max:1,step:.01}}]},sheenColorMap:{name:TL$3("sheen_color_map"),sub:[{name:"Sheen Color",prop:"sheenColor",type:"Color",component:"color"},{name:"Sheen",prop:"sheen",type:"Float",component:"slider"}]},sheenRoughnessMap:{name:TL$3("sheen_roughness_map"),sub:[{name:"SheenRoughness",prop:"sheenRoughness",type:"Float",component:"slider"}]},metalnessMap:{name:TL$3("metalness_map"),sub:[{name:"Metalness",prop:"metalness",type:"Float",component:"slider"}]}};for(const V in Z){const H={toggle:!1},Y=Z[V],q=Y.name?Y.name:V.charAt(0).toUpperCase()+V.slice(1),J=document.createElement("div");MakeTextureComponent(J,w,v,u,q,Y,V,l.maps,H),z.appendChild(J)}}{l.other_maps||(l.other_maps={});const V=UC$1.make_toggle_window(z,{title:"<span style='color: #77F'>"+TL$3("other_maps")+"</span>",toggle:l.other_maps.opened},Y=>{l.other_maps.opened=Y}).holder,H={clearcoatMap:{name:TL$3("clearcoat_map"),sub:[{name:"Clearcoat",prop:"clearcoat",type:"Float",component:"slider"}]},clearcoatRoughnessMap:{name:TL$3("clearcoat_roughness_map"),sub:[{name:"ClearcoatRoughness",prop:"clearcoatRoughness",type:"Float",component:"slider"}]},clearcoatNormalMap:{name:TL$3("clearcoat_normal_map"),sub:[{name:"ClearcoatNormalScale",prop:"clearcoatNormalScale",type:"Vector2",component:"vec3",dependsOnMap:!0}]},emissiveMap:{name:TL$3("emissive_map"),sub:[{name:"Emissive",prop:"emissive",type:"Color",component:"color"},{name:"Intensity",prop:"emissiveIntensity",type:"Float",component:"slider",params:{min:0,max:20,step:.01}}]},envMap:{name:TL$3("environment_map"),sub:[{name:"Intensity",prop:"envMapIntensity",type:"Float",component:"slider",params:{min:0,max:4,step:.01}},{name:"ReceiveDynamicEnvironment",prop:"receiveDynamicEnvironment",type:"Boolean",component:"boolean",modifier_params:{needsUpdate:{material:!0}}}]},bumpMap:{name:TL$3("bump_map"),sub:[{name:"BumpScale",prop:"bumpScale",type:"Float",component:"slider",dependsOnMap:!0}]},transmissionMap:{name:TL$3("transmission_map"),sub:[{name:"Transmission",prop:"transmission",type:"Float",component:"slider"},{name:"Dispersion",prop:"dispersion",type:"Float",component:"slider"}]},thicknessMap:{name:TL$3("thickness_map"),sub:[{name:"Thickness",prop:"thickness",type:"Float",component:"slider"}]},lightMap:{name:TL$3("light_map"),sub:[{name:"LightMapIntensity",prop:"lightMapIntensity",type:"Float",component:"slider",dependsOnMap:!0}]},displacementMap:{name:TL$3("displacement_map"),sub:[{name:"DisplacementScale",prop:"displacementScale",type:"Float",component:"slider",dependsOnMap:!0},{name:"DisplacementBias",prop:"displacementBias",type:"Float",component:"slider",dependsOnMap:!0}]},aoMap:{name:TL$3("ambient_occlusion_map"),sub:[{name:"AOMapIntensity",prop:"aoMapIntensity",type:"Float",component:"slider"}]},iridescenceMap:{name:TL$3("iridescence_map"),sub:[{name:"Iridescence",prop:"Iridescence",type:"Float",component:"slider"},{name:"iridescenceIOR",prop:"iridescenceIOR",type:"Float",component:"slider",params:{min:0,max:2.333,step:.001}}]},iridescenceThicknessMap:{name:TL$3("iridescence_thickness_map"),sub:[{name:"iridescenceThicknessRange",prop:"iridescenceThicknessRange",type:"Array",component:"slider",params:{min:0,max:1e3,step:.001}}]},gradientMap:{name:TL$3("gradient_map"),sub:[]}};for(const Y in H){const q={toggle:!1},J=H[Y],W=J.name?J.name:Y.charAt(0).toUpperCase()+Y.slice(1),te=document.createElement("div");MakeTextureComponent(te,w,v,u,W,J,Y,l.other_maps,q),V.appendChild(te)}}function K(Z){return`<span style='color:#7A7'>${Z}</span>`}{l.blend_ui||(l.blend_ui={opened:!0});const V=UC$1.make_toggle_window(c,{title:K(TL$3("blend_properties")),toggle:l.blend_ui.opened},te=>{l.blend_ui.opened=te}).holder,H=[{key:"None",value:null},{key:"ZeroFactor",value:ZeroFactor},{key:"OneFactor",value:OneFactor},{key:"SrcColorFactor",value:SrcColorFactor},{key:"OneMinusSrcColorFactor",value:OneMinusSrcColorFactor},{key:"SrcAlphaFactor",value:SrcAlphaFactor},{key:"OneMinusSrcAlphaFactor",value:OneMinusSrcAlphaFactor},{key:"DstAlphaFactor",value:DstAlphaFactor},{key:"OneMinusDstAlphaFactor",value:OneMinusDstAlphaFactor},{key:"DstColorFactor",value:DstColorFactor},{key:"OneMinusDstColorFactor",value:OneMinusDstColorFactor},{key:"SrcAlphaSaturateFactor",value:SrcAlphaSaturateFactor}],Y=[{key:"None",value:null},{key:"AddEquation",value:AddEquation},{key:"SubtractEquation",value:SubtractEquation},{key:"ReverseSubtractEquation",value:ReverseSubtractEquation},{key:"MinEquation",value:MinEquation},{key:"MaxEquation",value:MaxEquation}],q=[{key:"NoBlending",value:NoBlending},{key:"NormalBlending",value:NormalBlending},{key:"AdditiveBlending",value:AdditiveBlending},{key:"SubtractiveBlending",value:SubtractiveBlending},{key:"MultiplyBlending",value:MultiplyBlending},{key:"CustomBlending",value:CustomBlending}],J=[],W=UC$1.make_pulldown(V,"Blending",q,w.blending,{},te=>{if(u.modify_selected({needsUpdate:{material:!0}},ie=>ie.blending=Number(te)),Number(te)==CustomBlending)for(const ie of J)ie.element.style.display="flex";else for(const ie of J)ie.element.style.display="none"});if(N.blending=W,J.push(UC$1.make_pulldown(V,"BlendSrc",H,w.blendSrc,{},te=>{u.modify_selected({needsUpdate:{material:!0}},ie=>ie.blendSrc=Number(te))})),J.push(UC$1.make_pulldown(V,"BlendDst",H,w.blendDst,{},te=>{u.modify_selected({needsUpdate:{material:!0}},ie=>ie.blendDst=Number(te))})),J.push(UC$1.make_pulldown(V,"BlendEquation",Y,w.blendEquation,{},te=>{u.modify_selected({needsUpdate:{material:!0}},ie=>ie.blendEquation=Number(te))})),J.push(UC$1.make_pulldown(V,"BlendSrcAlpha",H,w.blendSrcAlpha,{},te=>{u.modify_selected({needsUpdate:{material:!0}},ie=>ie.blendSrcAlpha=Number(te))})),J.push(UC$1.make_pulldown(V,"BlendDstAlpha",H,w.blendDstAlpha,{},te=>{u.modify_selected({needsUpdate:{material:!0}},ie=>ie.blendDstAlpha=Number(te))})),J.push(UC$1.make_pulldown(V,"BlendEquationAlpha",Y,w.blendEquationAlpha,{},te=>{u.modify_selected({needsUpdate:{material:!0}},ie=>ie.blendEquationAlpha=Number(te))})),Number(w.blending)==CustomBlending)for(const te of J)te.element.style.display="flex";else for(const te of J)te.element.style.display="none"}{l.depth_ui||(l.depth_ui={opened:!0});const V=UC$1.make_toggle_window(c,{title:K(TL$3("depth_properties")),toggle:l.depth_ui.opened},Y=>{l.depth_ui.opened=Y}).holder,H=[{key:"NeverDepth",value:NeverDepth},{key:"AlwaysDepth",value:AlwaysDepth},{key:"EqualDepth",value:EqualDepth},{key:"LessDepth",value:LessDepth},{key:"LessEqualDepth",value:LessEqualDepth},{key:"GreaterEqualDepth",value:GreaterEqualDepth},{key:"GreaterDepth",value:GreaterDepth},{key:"NotEqualDepth",value:NotEqualDepth}];UC$1.make_pulldown(V,"Depth Func",H,w.depthFunc,{},Y=>{u.modify_selected({needsUpdate:{material:!0}},q=>q.depthFunc=Number(Y))})}{l.other_options_ui||(l.other_options_ui={opened:!1});const V=UC$1.make_toggle_window(c,{title:K(TL$3("other_properties")),toggle:l.other_options_ui.opened},Y=>{l.other_options_ui.opened=Y}).holder,H={motionBlur:{type:"Boolean"},vertexColors:{type:"Boolean"},clipShadows:{type:"Boolean"},fog:{type:"Boolean"},colorWrite:{type:"Boolean"},toneMapped:{type:"Boolean"},flatShading:{type:"Boolean"},wireframe:{type:"Boolean"},format:{type:"Integer",component:"Pulldown",options:[{key:"RGBAFormat",value:RGBAFormat}]}};DMC.current.renderer_key=="Deferred"&&delete H.toneMapped;for(const Y in H)if(w[Y]!==void 0){const q=H[Y],J=q.name?q.name:Y.charAt(0).toUpperCase()+Y.slice(1),W=q.type,te=q.component||W,ie=w[Y];te=="Pulldown"?UC$1.make_pulldown(V,J,q.options,w[Y],{},oe=>{u.modify_selected({},Ce=>{Ce[Y]!==void 0&&(Ce[Y]=Number(oe))})}):te=="Boolean"&&UC$1.make_toggle(V,J,ie,{},oe=>{u.modify_selected({needsUpdate:{material:!0}},Ce=>{Ce[Y]!==void 0&&(Ce[Y]=oe)})})}}{const Z=document.createElement("div");Z.style.width="100%",Z.style.height="10px",Z.style.borderBottom="1px solid #444",c.appendChild(Z)}{const Z=w,V=Z.userData?JSON.stringify(Z.userData):"{}";if(UC$1.make_script(c,"UserData",V,{run:!1},(H,Y)=>{if(H!="run"){if(H=="editor"){const q=(Z.name?.length>0?Z.name:null)||Z.type+" : "+Z.uuid;UC$1.open_script_editor(Z.uuid,{title:q,text:Y.value,mode:"json"},async function(J,W){J=="save"?(u.modify_selected({needsUpdate:{material:!0}},te=>{te.userData!==void 0&&(te.userData=JSON.parse(W))}),Y.value=W,Z.needsUpdate=!0):J=="run"&&(u.modify_selected({needsUpdate:{material:!0}},te=>{te.userData!==void 0&&(te.userData=JSON.parse(W))}),Y.value=W,Z.needsUpdate=!0)})}else if(H=="input")try{u.modify_selected({needsUpdate:{material:!0}},q=>{q.userData!==void 0&&(q.userData=JSON.parse(Y.value))})}catch(q){console.error(q)}}}),Z.userData?.outlineParameters?.alpha!=null&&UC$1.make_key_value_with_slider(c,"Edge-Alpha",Z.userData.outlineParameters.alpha,{min:0,max:1,step:.01},H=>{u.modify_selected({needsUpdate:{material:!0}},Y=>{Y.userData.outlineParameters.alpha=H})}),Z.userData?.outlineParameters?.color!=null){const H=Z.userData.outlineParameters.color;UC$1.make_color_picker(c,"Edge-Color","#"+new Color(H[0],H[1],H[2]).getHex().toString(16).padStart(6,"0"),Y=>{u.modify_selected({needsUpdate:{material:!0}},q=>{const J=new Color(Y);q.userData.outlineParameters.color[0]=J.r,q.userData.outlineParameters.color[1]=J.g,q.userData.outlineParameters.color[2]=J.b})})}Z.userData?.outlineParameters?.thickness!=null&&UC$1.make_key_value_with_slider(c,"Edge-Thickness",Z.userData.outlineParameters.thickness,{min:0,max:.01,step:1e-4},H=>{u.modify_selected({needsUpdate:{material:!0}},Y=>{Y.userData.outlineParameters.thickness=H})}),Z.userData?.outlineParameters?.visible!=null&&UC$1.make_toggle(c,"Edge-Visible",Z.userData.outlineParameters.visible,{},H=>{u.modify_selected({needsUpdate:{material:!0}},Y=>{Y.userData.outlineParameters.visible=H})})}UC$1.make_button(c,"Restore Original(M)","Reset",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{if(IsArray(u.material)){const Z=u.material[v],V=u.material_overwrite[v],H=u.material_original[v];LoadObjectProperties(Z,H),LoadObjectProperties(V,H),Z.needsUpdate=!0,V.needsUpdate=!0,Z.visible=H.visible,V.visible=H.visible,Z.color.copy(H.color),V.color.copy(H.color)}else LoadObjectProperties(u.material,u.material_original),LoadObjectProperties(u.material_overwrite,u.material_original),u.material.needsUpdate=!0,u.material_overwrite.needsUpdate=!0;y.click()}),UC$1.make_button(c,"Restore Original(T)","Reset",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{IsArray(u.material)?(u.material[v].copy(u.material_original[v]),u.material_overwrite[v].copy(u.material_original[v]),u.material[v].needsUpdate=!0):(u.material.copy(u.material_original),u.material_overwrite.copy(u.material_original),u.material.needsUpdate=!0),y.click()})};y.onmousedown=function(P){mouse_dragging_select=!0,L(P),P.stopPropagation(),DMC.mouse_point_x,h=DMC.mouse_point_y},y.onmouseup=function(P){h=null,P.stopPropagation(),mouse_dragging_select=!1,setTimeout(function(){y.focus()},10),P.button==2&&w.name?.length>0&&C$2.popup_menu(P,[{key:"Copy material name",callback:function(){navigator.clipboard.writeText(w.name)}},{key:"Copy properties",callback:function(){G_material_clipboard={type:"property",material:w}}},{key:"Copy with textures",callback:function(){G_material_clipboard={type:"all",material:w}}},G_material_clipboard?{key:"Paste",callback:function(){if(G_material_clipboard?.material?.dispose){if(G_material_clipboard.type=="all"){const N=u.material[v].name;u.material[v].copy(G_material_clipboard.material),u.material_overwrite[v].copy(G_material_clipboard.material),u.material[v].name=N,u.material_overwrite[v].name=N}else G_material_clipboard.type=="property"&&(LoadObjectProperties(u.material[v],G_material_clipboard.material,{name:!0,uuid:!0,ui:!0,"is*":!0}),LoadObjectProperties(u.material_overwrite[v],G_material_clipboard.material,{name:!0,uuid:!0,ui:!0,"is*":!0}));L(P),O()}}}:null],null,(N,z,K)=>{K.callback()})},y.onmouseover=function(P){if(mouse_dragging_select){L({force:!0});let N=null,z=null;for(let V=0;V<a.children.length;V++)a.children[V]==y&&(N=y,z=y,a.children[V-1]&&N==y&&(N=a.children[V-1]),a.children[V+1]&&z==y&&(z=a.children[V+1]));DMC.mouse_point_x;const K=DMC.mouse_point_y;let Z=h-K;h=K,Z==0&&(Z=_),Z<0?(z.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),_=-1):(N.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),_=1)}},d==null&&(d=y),a.appendChild(y)};const m=[];let h=null,_=0;{const v=document.createElement("div");v.classList.add("flex-v-center"),v.style.width="100%",v.style.height="20px",v.style.fontSize="12px",v.style.backgroundColor="#333";const w=document.createElement("input");w.style.width="100%",w.style.textAlign="center",w.classList.add("material_search_box"),w.oninput=w.onchange=function(S){const D=w.value.normalize("NFC");for(let k=0;k<m.length;k++){const O=m[k],L=O.element;O.data.normalize("NFC").indexOf(D)>=0?L.style.display="flex":L.style.display="none"}};const y=document.createElement("span");y.innerText=TL$3("search"),y.classList.add("no_wrap"),y.style.width="40%",y.style.paddingLeft="5px",v.appendChild(y);const M=document.createElement("div");M.style.width="60%",M.style.paddingRight="7px",M.style.paddingLeft="5px",M.appendChild(w),v.appendChild(M),a.appendChild(v)}{const v=document.createElement("button");v.style.width="100%",v.style.height="20px",v.innerText=`[ ${TL$3("select_all")} (${u.get_materials().length}) ]`,v.id="__material_select_all_button__",v.onclick=function(){const w=document.querySelectorAll(".__material_property__");u.clear_selected(),u.clear_marked(),triggerMouseEvent(w[0],"mousedown"),mouse_dragging_select=!1,setTimeout(function(){mouse_dragging_select=!1,triggerMouseEvent(w[0],"mouseup"),mouse_dragging_select=!1;for(let y=0;y<w.length;y++){const M=w[y];M.style.display=="none"||(u.select(y),M.style.backgroundColor="#335")}},100)},a.appendChild(v)}const b=u.get_overwrite_materials();for(let v=0;v<b.length;v++)f(v,b[v]);d&&(triggerMouseEvent(d,"mousedown"),mouse_dragging_select=!1,setTimeout(function(){mouse_dragging_select=!1,triggerMouseEvent(d,"mouseup")},100)),o.appendChild(a),a.classList.add("right_panel_list_window"),a.onclick=function(v){const w=document.getElementsByClassName("active_window"),y=a.classList.contains("active_window");for(let M=0;M<w.length;++M)w[M].classList.remove("active_window");a.classList.add("active_window"),y||document.activeElement?.blur&&!document.activeElement.classList.contains("material_search_box")&&document.activeElement.blur(),window.file_browser?.deselect_all&&window.file_browser.deselect_all()};{const v=document.createElement("div");v.style.cssText="width:100%;height:10px",a.appendChild(v)}UC$1.make_separator(o,{close:!0,sub:!0,title:TL$3("properties")}),c.classList.add("right_panel_window")}o.appendChild(c),MakeOptionComponent({div:o,object:s,D:l,modifier:u})}else UC$1.make_separator(o,{close:!1,title:"There is no material"}),document.getElementById("right_side_panel_tab_material_button").classList.add("no_item_and_hidden");if(!r){o.id="3d_object_material_panel",o.style.textAlign="left",o.style.width="100%";const a=document.getElementById("right_side_panel_tab_material");a.innerHTML="",a.appendChild(o)}}function MakeOptionComponent(s){const e=s.div,i=s.object,r=s.D,o=s.modifier,l=e;UC$1.make_separator(e,{close:!0,title:TL$3("options")});const a=[{key:"MeshBasicMaterial",value:"MeshBasicMaterial"},{key:"MeshPhysicalMaterial",value:"MeshPhysicalMaterial"},{key:"MeshPostProcessingMaterial",value:"MeshPostProcessingMaterial"},{key:"MeshStandardMaterial",value:"MeshStandardMaterial"},{key:"MMDToonMaterial",value:"MMDToonMaterial"},{key:"MeshPhongMaterial",value:"MeshPhongMaterial"},{key:"MeshLambertMaterial",value:"MeshLambertMaterial"},{key:"MeshToonMaterial",value:"MeshToonMaterial"},{key:"MeshNormalMaterial",value:"MeshNormalMaterial"},{key:"MeshDistanceMaterial",value:"MeshDistanceMaterial"},{key:"MeshMatcapMaterial",value:"MeshMatcapMaterial"},{key:"MeshDepthMaterial",value:"MeshDepthMaterial"},{key:"SpriteMaterial",value:"SpriteMaterial"},{key:"LineBasicMaterial",value:"LineBasicMaterial"}];UC$1.make_button(l,"Auto Visibility","Setup",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{if(IsArray(o.material))for(let d=0;d<o.material.length;d++){const u=o.material[d],f=o.material_overwrite[d];u.opacity<.01?(u.visible=!1,f.visible=!1):(u.visible=!0,f.visible=!0)}else{const d=o.material,u=o.material_overwrite;d.opacity<.01?(d.visible=!1,u.visible=!1):(d.visible=!0,u.visible=!0)}bound_object$2=null,UI_MaterialPanel()}),UC$1.make_button(l,"Force Visible All","Setup",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{if(IsArray(o.material))for(let d=0;d<o.material.length;d++){const u=o.material[d],f=o.material_overwrite[d];u.visible=!0,f.visible=!0}else{const d=o.material,u=o.material_overwrite;d.visible=!0,u.visible=!0}bound_object$2=null,UI_MaterialPanel()});const c=IsArray(o.material)?o.material[0]:o.material;c&&(UC$1.make_pulldown(l,"MaterialType",a,c.type,{},d=>{if(o.material_replacers)for(const u of o.material_replacers)u(d);else{const u=f=>f=="MeshPostProcessingMaterial"?new MeshPostProcessingMaterial:new THREE$1[d];if(IsArray(o.material))for(let f=0;f<o.material.length;f++){const m=o.material[f],h=o.material_overwrite[f],_=u(d),b=u(d);o.material[f]=_,o.material_overwrite[f]=b,copy_material_params(o.material[f],m),copy_material_params(o.material_overwrite[f],h),m.dispose(),h.dispose(),o.material[f].needsUpdate=!0}else{const f=u(d),m=u(d),h=i.material,_=i.material_overwrite;i.material=f,i.material_overwrite=m,copy_material_params(i.material,h),copy_material_params(i.material_overwrite,_),h.dispose(),_.dispose(),i.material.needsUpdate=!0}}InitializeMaterialsExtField(i),UI_MaterialPanel(),console.log(d)}),UC$1.make_pulldown(l,"MaterialPreset",GetMaterialPreset(c),null,{},(d,u)=>{u?.callback&&u.callback(o)})),window.is_electron&&window.external_io==null&&r?.source_file&&(UC$1.make_button(l,"Open in App","Open",{value_css:{width:"100px",whiteSpace:"nowrap"}},async()=>{window.nodejs&&window.nodejs.open_in_native(r.source_file)}),UC$1.make_button(l,"Open in Folder","Open",{value_css:{width:"100px",whiteSpace:"nowrap"}},async()=>{window.nodejs&&window.nodejs.open_in_finder(r.source_file)})),UC$1.make_button(l,"Export material","Export",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{const d="ddd/ui/export_material.html";UC$1.make_window(d,"Material Exporter",{url:d,width:385,height:350,urlLoaded:async function(u){const f=u.iframe.contentWindow;f.object=DMC.current.object,f.current_link=window.file_browser?.current_link,f.self_frame=u,u.setOnCloseFrameListener(()=>{})}})}),window.external_io==null&&(UC$1.make_button(l,"Import material","Import",{value_css:{width:"100px",whiteSpace:"nowrap"}},()=>{window.external_io?C$2.modal_ok_cancel("Error","Not implemented yet＠J42FPAQPXS"):window.nodejs&&window.node_api?(async()=>{const u=i.name.slice(0,i.name.lastIndexOf("."))+".material",f=(r?.source_file?window.nodejs.path.dirname(r.source_file):null)||window.process.env.HOME||window.process.env.USERPROFILE,m=await window.nodejs.ipcRenderer.invoke("OpenFile",{properties:["openFile"],title:"Select a file",defaultPath:window.nodejs.path.join(f,u),filters:[{name:"DDD-Material",extensions:["material"]}]});if(!m.canceled){let h=m.filePath;if(h||IsArray(m.filePaths)&&(h=m.filePaths[0]),h){h=h.replace(/\\/g,"/");const _=await window.cross_file_system.read(h),b=await C$2.s_decode_async(_);LoadMaterialProperties(i,b,{},{match_by_name:!0}),UI_MaterialPanel(),UI.store_file_history(h)}}})():C$2.modal_ok_cancel("Error","Not implemented yet@4EDE3GDR49")}).element.classList.add("texture_map_draggable_component"),UC$1.make_drag_and_drop(l,{},async u=>{let f=u.file.file.path;if(f){if(console.log("Try to load:",f),C$2.file_type(f)=="j_object"){f=f.replace(/\\/g,"/");const m=nodejs.fs.readFileSync(f),h=C$2.b_decode(m);LoadMaterialProperties(i,h,{},{match_by_name:!0}),UI_MaterialPanel(),UI.store_file_history(f)}}else C$2.modal_ok_cancel("Error","D&D material file supports on only native.",{cancel:null})}))}function GetMaterialPreset(s){return s.type=="MeshPhysicalMaterial"?[{key:"None",callback:e=>{e.modify_selected({needsUpdate:{material:!0,texture:!0}},i=>{i.roughness=i.roughnessMap?1:.89,i.reflectivity=.5,i.clearcoat=.05,i.clearcoatRoughness=.65,i.sheenColor.setHex(11184810),i.sheen=.1,i.sheenRoughness=.5,i.metalness=0,i.emissiveIntensity=0,i.transmission=0,i.alphaToCoverage=!1,i.transparent=!1,i.premultipliedAlpha=!1,i.blending=NoBlending,i.color.setHex(14540253)})}},{key:"YellowSkin",callback:e=>{e.modify_selected({needsUpdate:{material:!0,texture:!0}},i=>{i.color.setHex(12628144),i.roughness=i.roughnessMap?1:.89,i.reflectivity=.5,i.clearcoat=.15,i.clearcoatRoughness=.65,i.sheenColor.setHex(12155503),i.sheen=.3,i.sheenRoughness=.63,i.metalness=0,i.emissiveIntensity=0,i.transmission=0,i.clearcoat=0,i.alphaToCoverage=!1,i.transparent=!1,i.premultipliedAlpha=!1,i.blending=NoBlending})}},{key:"WhiteSkin",callback:e=>{e.modify_selected({needsUpdate:{material:!0,texture:!0}},i=>{i.color.setHex(15658734),i.roughness=i.roughnessMap?1:.89,i.reflectivity=.5,i.clearcoat=.15,i.clearcoatRoughness=.65,i.sheenColor.setHex(12155503),i.sheen=.4,i.sheenRoughness=.63,i.metalness=0,i.emissiveIntensity=0,i.transmission=0,i.clearcoat=0,i.alphaToCoverage=!1,i.transparent=!1,i.premultipliedAlpha=!1,i.blending=NoBlending})}},{key:"DarkSkin",callback:e=>{e.modify_selected({needsUpdate:{material:!0,texture:!0}},i=>{i.color.setHex(4999491),i.roughness=i.roughnessMap?1:.89,i.reflectivity=.5,i.clearcoat=.15,i.clearcoatRoughness=.65,i.sheenColor.setHex(5848890),i.sheen=.3,i.sheenRoughness=.63,i.metalness=0,i.emissiveIntensity=0,i.transmission=0,i.clearcoat=0,i.alphaToCoverage=!1,i.transparent=!1,i.premultipliedAlpha=!1,i.blending=NoBlending})}},{key:"Hair01",callback:e=>{e.modify_selected({needsUpdate:{material:!0,texture:!0}},i=>{i.roughness=i.roughnessMap?1:.65,i.reflectivity=.1,i.clearcoat=.05,i.clearcoatRoughness=.4,i.sheenColor.setHex(11184810),i.sheen=.1,i.sheenRoughness=.2,i.metalness=.075,i.emissiveIntensity=0,i.transmission=0,i.alphaToCoverage=!1,i.transparent=!0,i.premultipliedAlpha=!1,i.blending=NormalBlending,i.alphaTest=.3,i.color.setHex(13680832)})}}]:(s.type=="MeshToonMaterial",[])}var bound_object$1=null;async function UI_MorphPanel(){const s=window.DMC;let e=s.current.object;function i(m){let h=!1;return m==bound_object$1&&(h=!0),m?.parent&&(h=h||i(m.parent)),h}function r(m){let h=null;return m?.morphTargetInfluences&&(h=m),m?.parent&&(h=h||r(m.parent)),h}if(bound_object$1){if(i(e))return;bound_object$1=null}else{const m=r(e),h=e?.getDDDProperties?.()?.type;m&&(m?.getDDDProperties?.()?.type=="pmx"?bound_object$1=e=m:h=="fbx"||h=="gltf"||h=="glb"||h=="vrm"||(bound_object$1=e=m))}const o=[];e?.traverse(m=>{m?.morphTargetInfluences?.length>0&&o.push(m)});const l=document.getElementById("3d_object_morphing_panel"),a=l||document.createElement("div");s.ui.morphing_panel=l,a.innerHTML="",UC$1.make_separator(a,{close:!1,sub:!0,title:"Morphing"});const c=document.getElementById("right_side_panel_tab_morphing_button");c&&(c.classList.remove("no_item_and_hidden"),c.classList.remove("no_item"));const u=e?.getDDDProperties?.()?.type;let f="Morphing";if(o.length>0){let h=function(){if(u=="pmx"){const w=s.mmd_animation_helper.is_enabled("animation"),y=s.mmd_animation_helper.is_enabled("grant"),M=s.mmd_animation_helper.is_enabled("ik");s.mmd_animation_helper.enable("animation",!0),s.mmd_animation_helper.enable("grant",!0),s.mmd_animation_helper.enable("ik",!0),s.mmd_animation_helper._animateMesh_without_animation(e,0,{force_update_physics:!0,force_update_animation:!0,force_update_ik:!0,force_update_grant:!0}),s.mmd_animation_helper.enable("animation",w),s.mmd_animation_helper.enable("grant",y),s.mmd_animation_helper.enable("ik",M)}},_=function(){for(let w=0;w<s.draw_thread_after_runner.length;w++)if(s.draw_thread_after_runner[w]==h)return;s.draw_thread_after_runner.push(h)},b=function(w){const y=document.createElement("div");w.appendChild(y);const M=[];{const S=document.createElement("div");S.classList.add("flex-v-center"),S.style.width="100%",S.style.height="20px",S.style.fontSize="12px",S.style.backgroundColor="#333";const D=document.createElement("input");D.style.width="100%",D.style.textAlign="center",D.oninput=D.onchange=function(L){const N=D.value.normalize("NFC").split(" ");for(let z=0;z<M.length;z++){const K=M[z],Z=document.getElementById(K.anchor_id)?.parentElement?.parentElement;if(Z){let V=!0;for(const H of N)K.value.normalize("NFC").indexOf(H)==-1&&(V=!1);V?Z.style.display="flex":Z.style.display="none"}}};const k=document.createElement("span");k.innerText="Search",k.classList.add("no_wrap"),k.style.width="40%",k.style.paddingLeft="5px",S.appendChild(k);const O=document.createElement("div");O.style.width="60%",O.style.paddingRight="7px",O.style.paddingLeft="5px",O.appendChild(D),S.appendChild(O),w.appendChild(S)}if(u=="gltf"||u=="glb"){const S={};for(const D of o)S[D._original_mesh_name_]==null&&(S[D._original_mesh_name_]=[]),S[D._original_mesh_name_].push(D);for(const D in S){const k=S[D],O={};for(const P in k[0].morphTargetDictionary)O[k[0].morphTargetDictionary[P]]=P;const L=k[0];for(const P in L.morphTargetInfluences_cache){let Z=function(J){return J==null?"":J.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};const N=L.morphTargetInfluences_cache[P],z=O[P],K=`UI_MorphPanel_morphing_item_${L.uuid}_${P}`;M.push({value:z,anchor_id:K});let V=0;const H=L?.geometry?.morphs?.[P]?.type;let Y="",q="#EEE";if(H==0?(Y="G",q="#CCC"):H==1?(Y="V",q="#F8F"):H==2?(Y="B",q="#EA4"):H==8?(Y="M",q="#4F4"):Y="U",Y.length>0){const J=UC$1.make_key_value_with_slider(w,`<span id="${K}" style="color:#99BBFF;display:inline-block;text-align:center;background-color:#111;margin-right:5px;width:35px;border-right:1px solid #EEE">${P}-<span style="color:${q}">${Y}</span></span><span style="user-select: text;">${Z(z)}</span>`,N,{min:0,max:1,step:.01},W=>{for(const te of k)te.morphTargetInfluences[P]=0,te.morphTargetInfluences_cache[P]=W;s.playing_state!=s.PLAYING_STATE.PLAYING&&V==0&&(V++,setTimeout(()=>{_(),V--},100))});J.element.onmouseup=W=>{W.button==2&&C$2.popup_menu(W,[{key:"Copy Name",callback:async()=>{await navigator.clipboard.writeText(z)}}],null,(te,ie,oe)=>{oe.callback()})}}}}}else for(const S of o){const D={};for(const k in S.morphTargetDictionary)D[S.morphTargetDictionary[k]]=k;for(const k in S.morphTargetInfluences_cache){let N=function(H){return H==null?"":H.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};const O=S.morphTargetInfluences_cache[k],L=D[k],P=`UI_MorphPanel_morphing_item_${S.uuid}_${k}`;M.push({value:L,anchor_id:P});let z=0;const K=S?.geometry?.morphs?.[k]?.type;let Z="",V="#EEE";if(K==0?(Z="G",V="#CCC"):K==1?(Z="V",V="#F8F"):K==2?(Z="B",V="#EA4"):K==8?(Z="M",V="#4F4"):Z="U",Z.length>0){const H=UC$1.make_key_value_with_slider(w,`<span id="${P}" style="color:#99BBFF;display:inline-block;text-align:center;background-color:#111;margin-right:5px;width:35px;border-right:1px solid #EEE">${k}-<span style="color:${V}">${Z}</span></span><span style="user-select: text;">${N(L)}</span>`,O,{min:0,max:1,step:.01,slider_css:{minWidth:"10px",maxWidth:"50px",width:"50px"}},Y=>{S.morphTargetInfluences[k]=0,S.morphTargetInfluences_cache[k]=Y,s.playing_state!=s.PLAYING_STATE.PLAYING&&z==0&&(z++,setTimeout(()=>{_(),z--},100))});H.element.onmouseup=Y=>{Y.button==2&&C$2.popup_menu(Y,[{key:"Copy Name",callback:async()=>{await navigator.clipboard.writeText(L)}}],null,(q,J,W)=>{W.callback()})}}}}},v=function(w){const y=document.createElement("div");w.appendChild(y);const M=[];{const S=document.createElement("div");S.classList.add("flex-v-center"),S.style.width="100%",S.style.height="20px",S.style.fontSize="12px",S.style.backgroundColor="#333";const D=document.createElement("input");D.style.width="100%",D.style.textAlign="center",D.oninput=D.onchange=function(L){const N=D.value.normalize("NFC").split(" ");for(let z=0;z<M.length;z++){const K=M[z],Z=document.getElementById(K.anchor_id)?.parentElement?.parentElement;if(Z){let V=!0;for(const H of N)K.value.normalize("NFC").indexOf(H)==-1&&(V=!1);V?Z.style.display="flex":Z.style.display="none"}}};const k=document.createElement("span");k.innerText="Search",k.classList.add("no_wrap"),k.style.width="40%",k.style.paddingLeft="5px",S.appendChild(k);const O=document.createElement("div");O.style.width="60%",O.style.paddingRight="7px",O.style.paddingLeft="5px",O.appendChild(D),S.appendChild(O),w.appendChild(S)}if(u=="gltf"||u=="glb"){const S={};for(const D of o)S[D._original_mesh_name_]==null&&(S[D._original_mesh_name_]=[]),S[D._original_mesh_name_].push(D);for(const D in S){const k=S[D],O={};for(const P in k[0].morphTargetDictionary)O[k[0].morphTargetDictionary[P]]=P;const L=k[0];for(const P in L.morphTargetInfluences_coef){let Z=function(J){return J==null?"":J.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};const N=L.morphTargetInfluences_coef[P],z=O[P],K=`UI_MorphPanel_morphing_item_${L.uuid}_${P}`;M.push({value:z,anchor_id:K});let V=0;const H=L?.geometry?.morphs?.[P]?.type;let Y="",q="#EEE";if(H==0?(Y="G",q="#CCC"):H==1?(Y="V",q="#F8F"):H==2?(Y="B",q="#EA4"):H==8?(Y="M",q="#4F4"):Y="U",Y.length>0){const J=UC$1.make_key_value_with_slider(w,`<span id="${K}" style="color:#99BBFF;display:inline-block;text-align:center;background-color:#111;margin-right:5px;width:35px;border-right:1px solid #EEE">${P}-<span style="color:${q}">${Y}</span></span><span style="user-select: text;">${Z(z)}</span>`,N,{min:0,max:1,step:.01},W=>{for(const te of k)te.morphTargetInfluences[P]=0,te.morphTargetInfluences_coef[P]=W;s.playing_state!=s.PLAYING_STATE.PLAYING&&V==0&&(V++,setTimeout(()=>{_(),V--},100))});J.element.onmouseup=W=>{W.button==2&&C$2.popup_menu(W,[{key:"Copy Name",callback:async()=>{await navigator.clipboard.writeText(z)}}],null,(te,ie,oe)=>{oe.callback()})}}}}}else for(const S of o){const D={};for(const k in S.morphTargetDictionary)D[S.morphTargetDictionary[k]]=k;for(const k in S.morphTargetInfluences_coef){let N=function(H){return H==null?"":H.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};const O=S.morphTargetInfluences_coef[k],L=D[k],P=`UI_MorphPanel_morphing_item_${S.uuid}_${k}`;M.push({value:L,anchor_id:P});let z=0;const K=S?.geometry?.morphs?.[k]?.type;let Z="",V="#EEE";if(K==0?(Z="G",V="#CCC"):K==1?(Z="V",V="#F8F"):K==2?(Z="B",V="#EA4"):K==8?(Z="M",V="#4F4"):Z="U",Z.length>0){const H=UC$1.make_key_value_with_slider(w,`<span id="${P}" style="color:#99BBFF;display:inline-block;text-align:center;background-color:#111;margin-right:5px;width:35px;border-right:1px solid #EEE">${k}-<span style="color:${V}">${Z}</span></span><span style="user-select: text;">${N(L)}</span>`,O,{min:-2,max:2,step:.01,slider_css:{minWidth:"10px",maxWidth:"50px",width:"50px"}},Y=>{S.morphTargetInfluences[k]=0,S.morphTargetInfluences_coef[k]=Y,s.playing_state!=s.PLAYING_STATE.PLAYING&&z==0&&(z++,setTimeout(()=>{_(),z--},100))});H.element.onmouseup=Y=>{Y.button==2&&C$2.popup_menu(Y,[{key:"Copy Name",callback:async()=>{await navigator.clipboard.writeText(L)}}],null,(q,J,W)=>{W.callback()})}}}}};const m=document.createElement("div");UC$1.make_button(a,"Reset to zero","Reset",{value_css:{width:"150px"}},async()=>{for(const w of o)w.morphTargetInfluences_cache&&w.morphTargetInfluences_cache.fill(0),w.morphTargetInfluences.fill(0),w.morphTargetInfluences_backup&&w.morphTargetInfluences_backup.fill(0),w.morphTargetInfluences_coef&&w.morphTargetInfluences_coef.fill(1);m.innerHTML="",f=="Morphing"?b(m):v(m),_()}),UC$1.make_pulldown(a,"Modifier",["Morphing","Coefficient"],"Morphing",{},async w=>{m.innerHTML="",f=w,f=="Morphing"?b(m):v(m)}).update(),a.appendChild(m);{const w=document.createElement("div");w.style.cssText="width:100%;height:10px;",a.appendChild(w)}}else UC$1.make_separator(a,{close:!1,title:"There is no morphing"}),c&&c.classList.add("no_item_and_hidden");if(!l){a.id="3d_object_morphing_panel",a.classList.add("right_panel_morph_window"),a.style.textAlign="left",a.style.width="100%",a.style.overflowY="scroll";const m=document.getElementById("right_side_panel_tab_morphing");m&&(m.innerHTML="",m.appendChild(a))}}let bound_object=null,last_bone=null,previous_object=null;function get_available_object(){let s=window.DMC.current.object;if(s==null)return bound_object=null,null;const e=function(r){let o=!1;return r==bound_object&&(o=!0),r?.parent&&(o=o||e(r.parent)),o},i=function(r){let o=null;const l=r?.getDDDProperties?.();return l&&(l.type=="fbx"||l.type=="gltf"||l.type=="glb"||l.type=="vrm")&&(o=r),r?.skeleton&&(o=r),r?.isCamera&&(o=r),r?.parent&&(o=o||i(r.parent)),o};return bound_object&&e(s)?bound_object:(bound_object=s=i(s),s)}function UI_BonePanel(){const s=window.DMC,e=s.ui.bone_flags;s.setEventListener("change@action",function(d){previous_object=null,UI_BonePanel()});const i=get_available_object();if(previous_object==i)return;previous_object=i;const r=document.getElementById("3d_object_bone_panel"),o=r||document.createElement("div");s.ui.bone_panel=o,o.innerHTML="",UC$1.make_separator(o,{close:!1,sub:!0,title:"Bone / Animation"});const l=document.getElementById("right_side_panel_tab_bone_button");if(l==null||(l.classList.remove("no_item_and_hidden"),l.classList.remove("no_item"),i==null))return;const a=i?.getDDDProperties?.(),c=i?.skeleton;if((c||i?.isCamera)&&a&&(a.type=="pmx"||a.type=="pmd"||i?.isCamera)){(a.type=="pmx"||a.type=="pmd")&&(UC$1.make_toggle(o,"Show Bone Helper",e.bone_helper_visibility,{},f=>{e.bone_helper_visibility=f,s.overlay_canvas2d.getContext("2d").clearRect(0,0,s.overlay_canvas2d.width,s.overlay_canvas2d.height),f?(a.recreate_helpers(!0),a.showSkeletonHelper()):a.hideSkeletonHelper()}).update(e.bone_helper_visibility),UC$1.make_toggle(o,"Show IK Helper",e.ik_helper_visibility,{},f=>{e.ik_helper_visibility=f,f?(a.recreate_helpers(!0),a.showIKHelper()):a.hideIKHelper()}).update(e.ik_helper_visibility));const d=[];{const u=i.getActionSources();for(let f=0;f<u.length;f++){const m=u[f];if(m.source_file==null)continue;const h=C$2.DPath(m.source_file),_=h.name;d.push({key:(h.ext=="vmd"||h.ext=="vpd"?"M:":"P:")+_,value:f,callback:async function(){a.action.index=f,s.reset_animation_of_single_object(i)}})}d.push({key:"None",value:d.length,callback:async function(){a.action.index=-1,s.reset_animation_of_single_object(i)}})}if(d.length){const u={value_css:{width:"100px"}};{let b=function(){_.innerHTML="";const S=i.getCurrentAction()?.action;S&&(UC$1.make_toggle(_,"CrossFadeIn",S.crossFadeIn??!1,{},D=>{const k=i.getCurrentAction().action;k&&(k.crossFadeIn=D)}),UC$1.make_float_box(_,"CrossFadeInDur",S.crossFadeInDuration??.15,{},D=>{const k=i.getCurrentAction().action;k&&(k.crossFadeInDuration=D)}),UC$1.make_toggle(_,"CrossFadeOut",S.crossFadeOut??!1,{},D=>{const k=i.getCurrentAction().action;k&&(k.crossFadeOut=D)}),UC$1.make_float_box(_,"CrossFadeOutDur",S.crossFadeOutDuration??.15,{},D=>{const k=i.getCurrentAction().action;k&&(k.crossFadeOutDuration=D)}),UC$1.make_key_value_with_slider(_,"Weight",S.weight,{},D=>{S.weight=D}),UC$1.make_float_box(_,"TimeScale",S.timeScale,{},D=>{const k=i.getCurrentAction().action;k&&(k.timeScale=D)}),UC$1.make_float_box(_,"TimeOffset",S.timeOffset??0,{},D=>{const k=i.getCurrentAction().action;k&&(k.timeOffset=D)}),UC$1.make_pulldown(_,"BlendMode",[{key:"NormalBlend",value:THREE.NormalAnimationBlendMode},{key:"AdditiveBlend",value:THREE.AdditiveAnimationBlendMode}],S.blendMode,{},D=>{i.getActionTable()[S._clip.name].blendMode=Number(D)}),UC$1.make_pulldown(_,"LoopType",[{key:"Repeat",value:THREE.LoopRepeat},{key:"PingPong",value:THREE.LoopPingPong},{key:"Once",value:THREE.LoopOnce}],S.loop,{},D=>{const k=i.getCurrentAction().action;k&&k.setLoop(Number(D))}),UC$1.make_button(_,"Open","Folder",u,()=>{const k=i.getCurrentActionSource()?.source_file;k&&window.nodejs.open_in_finder(k)}))},w=function(S){f.style.display="none",m.style.display="none",S=="Single"?(f.style.display="block",b()):S=="Multiple"&&(m.style.display="block")},y=function(S,D){const O=UC$1.make_toggle_window(S,{title:D._clip.name,toggle:!0},L=>{}).holder;UC$1.make_key_value_with_slider(O,"Weight",D.weight,{},L=>{D.weight=L}),UC$1.make_float_box(O,"TimeScale",D.timeScale,{},L=>{D.setTimeScale(L)}),UC$1.make_float_box(O,"TimeOffset",D.timeOffset??0,{},L=>{D.timeOffset=L}),UC$1.make_pulldown(O,"BlendMode",[{key:"Mix",value:THREE.NormalAnimationBlendMode},{key:"Add",value:THREE.AdditiveAnimationBlendMode}],D.blendMode,{},L=>{i.getActionTable()[D._clip.name].blendMode=Number(L)}),UC$1.make_pulldown(O,"LoopType",[{key:"Repeat",value:THREE.LoopRepeat},{key:"PingPong",value:THREE.LoopPingPong},{key:"Once",value:THREE.LoopOnce}],D.loop,{},L=>{D.setLoop(Number(L))})},M=function(){m.innerHTML="";const S=document.createElement("div");S.style.cssText="width:calc(100% - 10px);margin-left:10px;background:#111",m.appendChild(S);for(const D of i.getActionList())y(S,D)};const f=document.createElement("div"),m=document.createElement("div"),h=document.createElement("div"),_=document.createElement("div"),v=i.getActionMode()??"Single";UC$1.make_pulldown(o,"Mode",["Single","Multiple"],v,{},S=>{i.setActionMode(S),w(S),s.reset_animation_of_single_object(i)});{const S=[],D=i.getActionList();for(let O=0;O<D.length;O++){const P=D[O]._clip.name;S.push({key:"M:"+P,value:O,callback:async function(){i.pose?.(),i.setCurrentAction?.(O,{crossFade:a.action_cross_fade,crossFadeDuration:a.action_cross_fade_duration}),i.pose?.()}})}S.push({key:"None",value:-1,callback:async function(){i.pose?.(),i.setCurrentAction?.(-1),i.pose?.(),i.isCamera||s.mmd_animation_helper.pose(i)}});const k=UC$1.make_pulldown(f,`Action(${a.type.toUpperCase()})`,S,i.getCurrentAction().index,{},(O,L)=>{L.callback(),b(),s.reset_animation_of_single_object(i)});k.modifier.id="action_pulldown_menu_on_right_panel"}f.appendChild(_),b(),M();{const S=document.createElement("div");if(S.style.cssText="background:#333;border-radius:5px;margin:5px;width:calc(100% - 10px);height:50px;display:flex;align-items:center;justify-content:center;font-size:12px;color:gray",S.innerHTML="D&D and add motion files.",h.appendChild(S),UC$1.make_button(h,"Reload Actions","Reload",u,async()=>{i.pose?.();const D=i.getCurrentAction();await i.reloadActions(),i.getActionMode()=="Single"&&i.setCurrentAction(D.index),s.reset_animation_of_single_object(i),s.dispatchEvent("change@tree",{update_tree:!0,update_panel:!1})}),window.nodejs&&window.external_io==null){const D=i.getActionSources?.()??[];D.length>0&&UC$1.make_toggle(h,"Watch",i._watch_actions_!=null,{},k=>{if(k){let O=function(P){console.log("Watch:",P);const N=window.nodejs.chokidar.watch(P,{persistent:!0,depth:0,usePolling:!0,awaitWriteFinish:{stabilityThreshold:700,pollInterval:100}});return N.on("change",async function(z){N.close().then(()=>console.log(`M:Watcher@changed:${P}`)),window.lock_rendering(),i.pose?.();const K=i.getCurrentAction();await i.reloadActions(),i.getActionMode()=="Single"&&i.setCurrentAction(K.index),s.reset_animation_of_single_object(i),s.dispatchEvent("change@tree",{update_tree:!0,update_panel:!1}),L(),window.unlock_rendering()}),N.on("unlink",function(z){N.close().then(()=>console.log(`M:Watcher@unlink:${P}`))}),N.on("error",z=>{console.error(z),N.close().then(()=>console.error(`M:Watcher@error:${P}`))}),N},L=function(){if(i._watch_actions_)for(const P of i._watch_actions_)P.close();i._watch_actions_=[];for(const P of D)i._watch_actions_.push(O(P.source_file))};L()}else if(i._watch_actions_){for(const O of i._watch_actions_)O.close();delete i._watch_actions_,console.log("Disable and delete watcher.")}})}else if(window.external_io.watch){const k=i.getActionSources?.()??[];k.length>0&&UC$1.make_toggle(h,"🧪Watch",i._watch_actions_!=null,{},async O=>{if(O){async function L(N){return console.log("Watch:",N),window.cross_file_system.watch(N,async function(K,Z){if(console.log(K,Z),N==K){window.lock_rendering(),i.pose?.();const V=i.getCurrentAction();await i.reloadActions(),i.getActionMode()=="Single"&&i.setCurrentAction(V.index),s.reset_animation_of_single_object(i),s.dispatchEvent("change@tree",{update_tree:!0,update_panel:!1}),P(),window.unlock_rendering()}})}async function P(){if(i._watch_actions_)for(const N of i._watch_actions_)N.close();i._watch_actions_=[];for(const N of k)i._watch_actions_.push(await L(N.source_file))}await P()}else if(i._watch_actions_){for(const L of i._watch_actions_)L.close();delete i._watch_actions_,console.log("Disable and delete watcher.")}})}UC$1.make_button(h,"Clear Actions","Clear",u,()=>{i.setActions(null);try{s.mmd_animation_helper.remove(i)}catch(D){console.log(D)}i.pose&&i.pose(),S.innerHTML="",bound_object=null,setTimeout(()=>{s.dispatchEvent("change@action"),s.dispatchEvent("change@tree",{update_tree:!0,update_panel:!0})},100)}),UC$1.make_drag_and_drop(S,{},async D=>{console.log(D.item);const k=D.item;if(i.isMMD&&i.isCamera&&i.getActionSources().length>0){C$2.modal_ok_cancel("Error","The camera does not support multiple.",{cancel:null},()=>{});return}try{if(await i.addActions(D.direct?k:await D.arrayBuffer()),i.isMMD){const O=i.getDDDProperties();s.reset_animation_of_single_object(i)}console.log(i.getActionSources())}catch(O){C$2.modal_ok_cancel("Error",O.toString(),{cancel:null},()=>{})}setTimeout(()=>{s.dispatchEvent("change@action"),s.dispatchEvent("change@tree",{update_tree:!0,update_panel:!0})},100)})}o.appendChild(f),o.appendChild(m),o.appendChild(h),w(i.getActionMode())}}}if(i.isCamera&&i.getActionList?.()?.length>0&&(UC$1.make_float_box(o,"Scale",a.action.scale??1,{initializers:[{title:"0.1",value:.1},{title:"5",value:5},{title:"10",value:10}]},async d=>{a.action.scale=d,window.lock_rendering(),i.pose?.();const u=i.getCurrentAction();await i.reloadActions(),i.getActionMode()=="Single"&&i.setCurrentAction(u.index),s.reset_animation_of_single_object(i),s.dispatchEvent("change@tree",{update_tree:!0,update_panel:!1}),window.unlock_rendering()}),UC$1.make_float_box(o,"DistanceScale",a.action.distance_scale??1,{initializers:[{title:"0.1",value:.1},{title:"5",value:5},{title:"10",value:10}]},async d=>{a.action.distance_scale=d,window.lock_rendering(),i.pose?.();const u=i.getCurrentAction();await i.reloadActions(),i.getActionMode()=="Single"&&i.setCurrentAction(u.index),s.reset_animation_of_single_object(i),s.dispatchEvent("change@tree",{update_tree:!0,update_panel:!1}),window.unlock_rendering()})),(a?.type=="fbx"||a?.type=="gltf"||a?.type=="glb"||a?.type=="vrm")&&i.getActionList().length>0){let h=function(){m.innerHTML="";const v=i.getCurrentAction()?.action;v&&(UC$1.make_toggle(m,"CrossFadeIn",v.crossFadeIn??!1,{},w=>{const y=i.getCurrentAction().action;y&&(y.crossFadeIn=w)}),UC$1.make_float_box(m,"CrossFadeInDur",v.crossFadeInDuration??.15,{},w=>{const y=i.getCurrentAction().action;y&&(y.crossFadeInDuration=w)}),UC$1.make_toggle(m,"CrossFadeOut",v.crossFadeOut??!1,{},w=>{const y=i.getCurrentAction().action;y&&(y.crossFadeOut=w)}),UC$1.make_float_box(m,"CrossFadeOutDur",v.crossFadeOutDuration??.15,{},w=>{const y=i.getCurrentAction().action;y&&(y.crossFadeOutDuration=w)}),UC$1.make_pulldown(m,"LoopType",[{key:"Repeat",value:THREE.LoopRepeat},{key:"PingPong",value:THREE.LoopPingPong},{key:"Once",value:THREE.LoopOnce}],v.loop,{},w=>{const y=i.getCurrentAction().action;y&&y.setLoop(Number(w))}))},_=function(v,w){const M=UC$1.make_toggle_window(v,{title:w._clip.name,toggle:!0},S=>{}).holder;UC$1.make_key_value_with_slider(M,"Weight",w.weight,{},S=>{w.weight=S}),UC$1.make_pulldown(M,"LoopType",[{key:"Repeat",value:THREE.LoopRepeat},{key:"PingPong",value:THREE.LoopPingPong},{key:"Once",value:THREE.LoopOnce}],w.loop,{},S=>{w.setLoop(Number(S))})},b=function(){u.innerHTML="";for(const v of i.getActionList())_(u,v)};const d=document.createElement("div"),u=document.createElement("div"),f=document.createElement("div"),m=document.createElement("div");UC$1.make_pulldown(o,"Mode",["Single","Multiple"],i.getActionMode()??"Single",{},v=>{i.setActionMode(v),d.style.display="none",u.style.display="none",v=="Single"?(d.style.display="block",h()):v=="Multiple"&&(u.style.display="block")}).update();{const v=[],w=i.getActionList();for(let M=0;M<w.length;M++){const D=w[M]._clip.name;v.push({key:"M:"+D,value:M,callback:async function(){i.setCurrentAction(M,{crossFade:a.action_cross_fade,crossFadeDuration:a.action_cross_fade_duration})}})}v.push({key:"None",value:-1,callback:async function(){i.setCurrentAction(-1)}});const y=UC$1.make_pulldown(d,`Action(${a.type.toUpperCase()})`,v,i.getCurrentAction().index,{},(M,S)=>{S.callback(),h()});y.modifier.id="action_pulldown_menu_on_right_panel"}d.appendChild(m),h(),b(),o.appendChild(d),o.appendChild(u),o.appendChild(f)}{const d=document.createElement("div");d.style.overflowY="scroll",d.style.maxHeight="200px",d.style.minHeight="50px",d.style.width="calc(100% - 2px)";const u=document.createElement("div");u.style.width="100%",d.onmouseleave=function(){};let f=()=>{},m=[];{UC$1.make_key_value2(o,"Search","",{oninput:b=>{m=b.target.value.split(" "),f()}},b=>{m=b.split(" "),f()}),o.appendChild(d),d.classList.add("right_panel_list_window"),d.onclick=function(b){const v=document.getElementsByClassName("active_window"),w=d.classList.contains("active_window");for(let y=0;y<v.length;++y)v[y].classList.remove("active_window");d.classList.add("active_window"),w||document.activeElement?.blur&&!document.activeElement.classList.contains("material_search_box")&&document.activeElement.blur(),window.file_browser?.deselect_all&&window.file_browser.deselect_all()},UC$1.make_separator(o,{close:!0,sub:!0,title:"Properties"});const _=[];if(i.getCurrentActionSource?.()&&i.skeleton&&i.morphTargetDictionary){{const b=i.getCurrentActionSource();if(b){let S=function(){M.holder.innerHTML="",UC$1.make_pulldown(M.holder,"Keyframe",_,null,{},D=>{})},v=b.mapper;v==null&&(v=b.mapper={morph:{},bone:{}});const w={},y={};if(b.type=="vmd"&&b.instance.data.morphs){if(b.type=="vmd"&&b.instance.data.morphs){for(const O of b.instance.data.morphs){const L=O.morphName,P=O.frameNum,N=O.weight;w[L]?Math.abs(w[L].weight-N)>.01&&(w[L].count++,w[L].weight=N):w[L]={count:0,weight:N},P==0&&N>0&&w[L].count++}const D=i.geometry.userData.MMD.rigidBodies,k={};for(const O in D){const L=D[O],P=i.skeleton.bones[L.boneIndex];L.type!=0&&P?.name&&(k[P.name]=!0)}for(const O of b.instance.data.motions){const L=O.boneName,P=O.frameNum,N=O.position,z=O.rotation;if(O.interpolation,!k[L]){if(y[L]){const K=y[L].position,Z=y[L].rotation,V=new THREE.Quaternion().fromArray(z),H=new THREE.Quaternion().fromArray(Z),Y=new THREE.Vector3().fromArray(N),q=new THREE.Vector3().fromArray(K),J=V.angleTo(H),W=Y.distanceTo(q);(J>.01||W>.01)&&(y[L].count++,y[L].position=N,y[L].rotation=z)}else y[L]={count:0,position:N,rotation:z};if(P==0){const K=new THREE.Quaternion().fromArray(z),Z=new THREE.Vector3().fromArray(N),V=new THREE.Quaternion,H=new THREE.Vector3,Y=K.angleTo(V),q=Z.distanceTo(H);(Y>.01||q>.01)&&y[L].count++}}}}for(const D in w)w[D].count>0&&_.push({key:`M: ${D}(${w[D].count})`,value:D,type:"morph"});for(const D in y)y[D].count>0&&_.push({key:`B: ${D}(${y[D].count})`,value:D,type:"bone"})}document.createElement("div");const M=UC$1.make_toggle_window(o,{title:"Keyframe Multipliers",toggle:!0},D=>{});S()}}{const b=[],v={},w=i.getCurrentActionSource();if(w){let k=function(){D.innerHTML="";for(const O in y.morph)UC$1.make_button(D,`${O}:${y.morph[O]?.key}`,"Unmap",{},async()=>{delete y.morph[O],await i.reloadActions(),s.reset_animation_of_single_object(i),k()});for(const O in y.bone)UC$1.make_button(D,`${O}:${y.bone[O]?.key}`,"Unmap",{},async()=>{delete y.bone[O],await i.reloadActions(),s.reset_animation_of_single_object(i),k()})},y=w.mapper;if(y==null&&(y=w.mapper={morph:{},bone:{}}),w.type=="vmd"&&w.instance.data.morphs){for(const O of w.instance.data.morphs){const L=O.morphName;v[L]==null&&(v[L]={counter:0,set:P=>{y.morph[L]=P}}),v[L].counter++}for(const O of w.instance.data.motions){const L=O.boneName;v[L]==null&&(v[L]={counter:0,set:P=>{y.bone[L]=P}}),v[L].counter++}}for(const O in i.morphTargetDictionary)b.push({key:`M: ${O}`,value:O,type:"morph"});for(const O of i.skeleton.bones)b.push({key:`B: ${O.name}`,value:O.name,type:"bone"});let M=null,S=null;UC$1.make_pulldown(o,"Motion map from",_,M?.value,{},(O,L,P)=>{M=L}),UC$1.make_pulldown(o,"Motion map to",b,S?.value,{},(O,L)=>{S=L});const D=document.createElement("div");UC$1.make_button(o,"",'Associate <i class="bi bi-link" style="margin-left:5px"></i>',{value_css:{width:"100px"}},async()=>{if(S&&M)if(console.log(S,M),S.type==M.type){if(M.type=="bone")y.bone[M.value]={key:S.value,type:"replace"};else if(M.type=="morph")y.morph[M.value]={key:S.value,type:"replace"};else throw new Error("Type Error.");await i.reloadActions(),s.reset_animation_of_single_object(i),k()}else C$2.modal_ok("Error","Type mismatch.")}),o.appendChild(D),k()}}}else i.getActionList?.()?.length>0;u.classList.add("right_panel_window")}if(o.appendChild(u),i?.geometry?.userData?.MMD?.bones){let M=function(){d.innerHTML="";for(let S=0;S<_.length;S++){const D=_[S];if(m.length!=0&&m.filter(ie=>D.name.indexOf(ie)>=0).length!=m.length)continue;const k=b[S],O=b[S].raw?.flag??0,L=(O&1)!=0,P=(O&2)!=0,N=(O&4)!=0,z=(O&8)!=0,K=(O&1024)!=0,Z=(O&2048)!=0,V=(O&256)!=0;let H="#555";k.ik?H="#F40":w[S]?H="#BB5":L&&P&&V&&z||P&&V&&Z&&z?H="#00A":P&&Z&&V||L&&P&&V?H="#96C":L&&P&&N==!1&&Z==!1&&z==!1?H="#F8B":z?K&&z?H="#82A":N?H="#8F8":P?H="#58F":K&&z==!0&&(H="#82A"):H="#888";const Y=["#C8FF96","#FFC896","#FFFF96"],q=document.createElement("div");q.style.cssText="width:100%;height:20px;font-size:12px;display:flex;align-items:center;",q.style.backgroundColor=S%2==0?"#292929":"#303030",q.style.opacity="0.5",q.onmouseover=ie=>{q.style.opacity="1.0"},q.onmouseleave=ie=>{q.style.opacity="0.5"},q.classList.add("bone_panel_index_item");const J=q.style.backgroundColor;q.onpointerdown=()=>{q.style.backgroundColor="#235"},q.onpointerup=()=>{q.style.backgroundColor=J},q.onclick=ie=>{for(const oe of _)delete oe.selected;D.selected=!0,s.transform_controls.select_object(D),last_bone=D.name},q.oncontextmenu=ie=>{C$2.popup_menu(ie,["Copy name"],{},oe=>{oe=="Copy name"&&window.navigator.clipboard.writeText(D.name)}),ie.button==2};const W=document.createElement("div"),te=document.createElement("div");W.style.cssText="width:50%;height:20px;display:flex;align-items:center;overflow:hidden;white-space:nowrap;",te.style.cssText="width:calc(50% - 1px);border-left:1px solid #444;height:20px;display:flex;justify-content:center;align-items:center;overflow:hidden;white-space:nowrap;",q.appendChild(W),q.appendChild(te),W.innerHTML=`<i class="bi bi-square-fill" style="margin-left:3px;display:inline-block;color:${H}"></i><span style="overflow:hidden;white-space:nowrap;text-align: center;display:inline-block;width:20px;background:#111;color:#47F;">${S}</span>`+(y[S]?`<span style="overflow:hidden;white-space:nowrap;margin-left:2px"><i class="bi bi-diamond-half" style="color:${Y[y[S].type]};display:inline-block"></i>${y[S].name}</span>`:""),te.innerText=D.name,q.dataset.bone_name=D.uuid+D.name,d.appendChild(q)}};i.geometry?.userData?.MMD?.bones;const _=i.skeleton.bones,b=i.geometry.userData.MMD.bones,v=i.geometry.userData.MMD.rigidBodies;i.geometry.userData.MMD.constraints;const w={},y={};for(let S=0;S<v.length;S++)y[v[S].boneIndex]=v[S];for(let S=0;S<_.length;S++){const D=b[S].raw;if(D.ik?.links?.length>0)for(const k of D.ik.links)w[k.index]=!0}f=()=>{M()},M()}else if(c?.bones?.length>0)for(let _=0;_<c?.bones?.length;_++){const b=c.bones[_],v=UC$1.make_key_value2(d,`<span style="user-select: text;">${_}:${b.type}</span>`,b.name,{value_css:{width:"150px"}}),w=v.element.dataset.bone_name=b.uuid+b.name;v.modifier.onpointerdown=v.element.onclick=function(){s.transform_controls.select_object(b,{select_tree_component:!1}),last_bone=w}}else{const _=[];i.traverse(b=>_.push(b));for(let b=0;b<_.length;b++){const v=_[b],w=UC$1.make_key_value2(d,`<span style="user-select: text;">${b}:${v.type}</span>`,v.name,{value_css:{width:"150px"}}),y=w.element.dataset.bone_name=v.uuid+v.name;w.modifier.onpointerdown=w.element.onclick=function(){s.transform_controls.select_object(v,{select_tree_component:!1}),last_bone=y}}}last_bone&&setTimeout(function(){const _=document.getElementsByClassName("bone_panel_index_item");for(let b=0;b<_.length;b++){const v=_[b];v.dataset.bone_name==last_bone&&v.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"})}},1),UC$1.make_separator(o,{close:!0,sub:!0,title:"IKs"});const h=i.geometry?.userData?.MMD?.iks;if(h)for(const _ of h){const b=_.target,v=i.skeleton.bones[b];UC$1.make_toggle(o,v.name,v.ikEnabled,{},w=>{v.ikEnabled=w})}}if(!r){o.id="3d_object_bone_panel",o.style.textAlign="left",o.style.width="100%",o.style.overflowY="scroll";const d=document.getElementById("right_side_panel_tab_bone");d.innerHTML="",d.appendChild(o)}}function TL$2(s){return window.T("tabs.rigid_body."+s)}const PHYSICAL_TYPE_COLOR_MAP=["#C8FF96","#FFC896","#FFFF96"],GROUP_INDEX_COLOR_MAP=["#FED584","#D4FF7F","#7FFF7F","#7FFFD4","#7FD4FF","#7F7FFF","#D47FFF","#FF5400","#FFFF00","#00FF55","#00FFFF","#0055FF","#5400FF","#FF00FF","#FF0054","#7F7F00"];let SELECT_MATERIAL=null;function rad2deg(s){return Array.isArray(s)?[s[0]/(Math.PI/180),s[1]/(Math.PI/180),s[2]/(Math.PI/180)]:s/(Math.PI/180)}function deg2rad(s){return Array.isArray(s)?[s[0]*(Math.PI/180),s[1]*(Math.PI/180),s[2]*(Math.PI/180)]:s*(Math.PI/180)}class ItemModifier{constructor(){this.items=[],this.object=null,this.previous_index=null,this.needsUpdate=!1,this.callbacks={}}clear(){this.items=[]}add(e){this.items.push(e)}get_current(){return this.current}update_dom(e=null){for(const i of this.items)e!=null&&e!=i.dom||(i.selected?(i.dom.style.background="#338",i.dom.style.opacity="1.0",i.dom.style.outline="1px solid #66A",i.dom.style.color="#F33"):(i.dom.style.background="#333",i.dom.style.opacity="0.5",i.dom.style.outline="0px solid #66A",i.dom.style.color="#FFF"),i.dom.style.display=i.display?"flex":"none")}deselect(e){this.items[e].selected=!1;for(const i of this.items)i.selected&&(this.current=i);for(const i in this.callbacks)this.callbacks[i]()}deselect_all(e=!0){for(const i of this.items)i.selected=!1;e&&(window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),this.current=null;for(const i in this.callbacks)this.callbacks[i]()}unhold(){this.previous_index=null}hold(e){this.previous_index==null&&(this.previous_index=e)}select(e){if(this.previous_index==null)this.items[e].display&&(this.items[e].selected=!0);else if(this.previous_index<e)for(let i=this.previous_index;i<=e;i++)this.items[i].display&&(this.items[i].selected=!0);else for(let i=this.previous_index;i>=e;i--)this.items[i].display&&(this.items[i].selected=!0);this.current=this.items[e];for(const i in this.callbacks)this.callbacks[i]()}toggle(e){this.items[e].display&&(this.items[e].selected=!this.items[e].selected);for(const i in this.callbacks)this.callbacks[i]()}modify(e){for(const i of this.items)i.selected&&i.display&&e(i)}modify_all(e){for(const i of this.items)e(i)}}let modifier_rigid_body=new ItemModifier,modifier_constraint=new ItemModifier;async function UI_RigidBodyPanel(){const s=DMC,e=s.ui.rigid_body_flags;SELECT_MATERIAL==null&&(SELECT_MATERIAL=new THREE.MeshBasicMaterial({color:16711680,wireframe:!0}));let i=s.current.object;function r(u){let f=null;return u?.skeleton&&(f=u),u?.parent&&(f=f||r(u.parent)),f}i=r(i),i!=modifier_rigid_body.object&&(modifier_rigid_body=new ItemModifier,modifier_rigid_body.object=i,modifier_rigid_body.needsUpdate=!0);const o=document.getElementById("3d_object_rigid_body_panel"),l=o||document.createElement("div");s.ui.rigid_body_panel=o,l.innerHTML="";const a=document.getElementById("right_side_panel_tab_rigid_body_button");a&&(a.classList.remove("no_item_and_hidden"),a.classList.remove("no_item")),UC$1.make_separator(l,{close:!1,sub:!0,title:TL$2("rigid_body")});const c=i?.getDDDProperties?.(),d=c?.type;if(d=="pmx"||d=="pmd"){let m=function(y){const M=document.getElementById("rigid_body_prop_panel");if(M==null)return;M.innerHTML="";const S=modifier_rigid_body.get_current();if(S==null)return;const k=s.mmd_animation_helper.objects.get(y)?.physics,O=k?.bodies;k?.constraints;const L=S.index,P=u[L];if(P){let N=function(J){const W=s.mmd_animation_helper.objects.get(y)?.physics,te=W?.bodies;modifier_rigid_body.modify(ie=>{const oe=u[ie.index],Ce=te[ie.index]?.body;Ce&&J({btRB:Ce,mmd_physics:W,RB:oe,world:W.world})})};O?.[L]?.body,UC$1.make_key_value2(M,TL$2("name"),P.name,{value_css:{width:"140px"}}),UC$1.make_pulldown(M,TL$2("physics_type"),[{key:TL$2("ph_type_bone"),value:0},{key:TL$2("ph_type_physics"),value:1},{key:TL$2("ph_type_physics_bone"),value:2}],P.type,{},J=>{}),UC$1.make_separator(M,{close:!1,sub:!0,title:TL$2("shape")}),UC$1.make_pulldown(M,TL$2("shape_type"),[{key:TL$2("shape_sphere"),value:0},{key:TL$2("shape_box"),value:1},{key:TL$2("shape_capsule"),value:2}],P.shapeType,{},J=>{}),UC$1.make_vec3_box(M,TL$2("whd"),[P.width,P.height,P.depth],1,{step:.01},J=>{N(W=>{W.btRB.getCollisionShape(),W.RB.width=J})},J=>{P.height=J},J=>{P.depth=J}),UC$1.make_separator(M,{close:!1,sub:!0,title:TL$2("trs")}),P.src_rigid_body_position&&P.src_bone_position&&UC$1.make_vec3_box(M,TL$2("position"),P.src_rigid_body_position,1,{step:.01},J=>{P.position[0]=J-P.src_bone_position[0]},J=>{P.position[1]=J-P.src_bone_position[1]},J=>{P.position[2]=J-P.src_bone_position[2]}),UC$1.make_vec3_box(M,TL$2("rotation"),rad2deg(P.rotation),1,{step:.01},J=>{P.rotation[0]=deg2rad(J)},J=>{P.rotation[1]=deg2rad(J)},J=>{P.rotation[2]=deg2rad(J)}),UC$1.make_separator(M,{close:!1,sub:!0,title:TL$2("physical_coefficient")});const z=document.createElement("div"),K=document.createElement("div"),Z=document.createElement("div");z.style.cssText="width:100%",K.style.cssText="width:50%;display:inline-block",Z.style.cssText="width:50%;display:inline-block",z.appendChild(K),z.appendChild(Z),M.appendChild(z);const V={borderRadius:"0px",border:"1px solid #444"};UC$1.make_float_box(K,TL$2("mass"),P.weight,{value_css:V,step:.01,min:.2,max:25,operator:(J,W)=>J+Math.pow(J<.001?.001:J,.5)/200*W},J=>{N(W=>{const te=W.mmd_physics.manager.allocVector3();te.setValue(0,0,0),W.RB.weight=J,W.btRB.getCollisionShape().calculateLocalInertia(J,te),W.btRB.setMassProps(J,te),W.mmd_physics.manager.freeVector3(te)})}),UC$1.make_float_box(K,TL$2("pos_damping"),P.positionDamping,{value_css:V,step:1e-5,min:.1,max:.999999,operator:(J,W)=>J+Math.pow(J<1e-5?1e-5:J,.1)/5e3*W},J=>{N(W=>{W.RB.positionDamping=J,W.btRB.setDamping(J,W.RB.rotationDamping)})}),UC$1.make_float_box(K,TL$2("rot_damping"),P.rotationDamping,{value_css:V,step:1e-5,min:.1,max:.999999,operator:(J,W)=>J+Math.pow(J<1e-5?1e-5:J,.1)/5e3*W},J=>{N(W=>{W.RB.rotationDamping=J,W.btRB.setDamping(W.RB.positionDamping,J)})}),UC$1.make_float_box(Z,TL$2("restitution"),P.restitution,{value_css:V,step:1e-5,min:0,max:.999999,operator:(J,W)=>J+Math.pow(J<1e-5?1e-5:J,.1)/5e3*W},J=>{N(W=>{W.RB.restitution=J,W.btRB.setRestitution(J)})}),UC$1.make_float_box(Z,TL$2("friction"),P.friction,{value_css:V,step:1e-5,min:0,max:.999999,operator:(J,W)=>J+Math.pow(J<1e-5?1e-5:J,.1)/5e3*W},J=>{N(W=>{W.RB.friction=J,W.btRB.setFriction(J)})}),UC$1.make_separator(M,{close:!1,sub:!0,title:TL$2("collision_mask")});const H=[];for(let J=0;J<16;J++)H.push(String(J+1));const Y=UC$1.make_pulldown(M,`<i class="bi bi-square-fill" style="display:inline-block;color:${GROUP_INDEX_COLOR_MAP[P.groupIndex]}"></i> ${TL$2("self_group")}`,H,String(P.groupIndex+1),{},J=>{P.groupIndex=Number(J)-1,Y.title.innerHTML=`<i class="bi bi-square-fill" style="display:inline-block;color:${GROUP_INDEX_COLOR_MAP[P.groupIndex]}"></i> ${TL$2("self_group")}`}),q=document.createElement("div");q.style.cssText="width:calc(100% - 10px);display:flex;justify-content: center;padding:5px",M.appendChild(q);{let J=function(ie){ie.align="center",ie.valign="middle",ie.style.cssText="width:17px;height:15px;font-size:12px",ie.style.color="black"};const W=document.createElement("table");W.style.cssText="margin-left:5px;margin-top:5px";let te=null;te=document.createElement("tr"),W.appendChild(te);for(let ie=0;ie<8;ie++){const oe=document.createElement("td");J(oe),oe.style.background=GROUP_INDEX_COLOR_MAP[ie],oe.innerText=String(ie+1),te.appendChild(oe)}te=document.createElement("tr"),W.appendChild(te);for(let ie=0;ie<8;ie++){const oe=document.createElement("td"),Ce=(P.groupTarget>>ie)%2!=1,ve=document.createElement("input"),we=document.createElement("label"),Se=document.createElement("span");ve.type="checkbox",ve.checked=Ce,we.appendChild(ve),we.appendChild(Se),ve.style.cursor="pointer",we.classList.add("w3s_container"),Se.classList.add("w3s_checkmark"),J(oe),oe.appendChild(we),te.appendChild(oe),ve.onchange=Re=>{N(Fe=>{const $e=1<<ie,Ue=Fe.RB.groupTarget&($e^65535)>>>0;ve.checked?Fe.RB.groupTarget=Ue:Fe.RB.groupTarget=Ue+$e,Fe.world.removeRigidBody(Fe.btRB),Fe.world.addRigidBody(Fe.btRB,1<<Fe.RB.groupIndex,Fe.RB.groupTarget)})}}te=document.createElement("tr"),W.appendChild(te);for(let ie=8;ie<16;ie++){const oe=document.createElement("td");oe.innerText=String(ie+1),J(oe),oe.style.background=GROUP_INDEX_COLOR_MAP[ie],te.appendChild(oe)}te=document.createElement("tr"),W.appendChild(te);for(let ie=8;ie<16;ie++){const oe=document.createElement("td"),Ce=(P.groupTarget>>ie)%2!=1,ve=document.createElement("input"),we=document.createElement("label"),Se=document.createElement("span");ve.type="checkbox",ve.checked=Ce,we.appendChild(ve),we.appendChild(Se),ve.style.cursor="pointer",we.classList.add("w3s_container"),Se.classList.add("w3s_checkmark"),J(oe),oe.appendChild(we),te.appendChild(oe),ve.onchange=Re=>{N(Fe=>{const $e=1<<ie,Ue=Fe.RB.groupTarget&($e^65535)>>>0;ve.checked?Fe.RB.groupTarget=Ue:Fe.RB.groupTarget=Ue+$e,Fe.world.removeRigidBody(Fe.btRB),Fe.world.addRigidBody(Fe.btRB,1<<Fe.RB.groupIndex,Fe.RB.groupTarget)})}}q.appendChild(W)}}};const u=i.geometry.userData.MMD.rigidBodies;i._physicsHelper?.children,i.geometry.userData.MMD.constraints;const f=i.skeleton.bones;UC$1.make_toggle(l,TL$2("show_helper"),e.rigid_body_helper_visibility,{},M=>{e.rigid_body_helper_visibility=M,M?(c.recreate_helpers(!0),c.showPhysicsHelper()):c.hidePhysicsHelper()}).update(e.rigid_body_helper_visibility);{const y=document.createElement("div");y.classList.add("flex-v-center"),y.style.cssText="width:100%;height:20px;font-size:12px;background:#333";const M=document.createElement("input");M.style.cssText="width:100%;text-align:center",M.value=e.search_wards_on_rigid_body??"",M.oninput=M.onchange=function(k){modifier_rigid_body.deselect_all(!1);const O=M.value.normalize("NFC"),L=O.split(/\s+/);e.search_wards_on_rigid_body=O,modifier_rigid_body.modify_all(P=>{let N=!0;for(const z of L)P.rigid_body.name.normalize("NFC").indexOf(z)==-1&&(N=!1);P.display=N}),modifier_rigid_body.update_dom(),k?.preventDefault?.(),k?.stopPropagation?.()},setTimeout(()=>{M.value.length>0&&M.oninput()},100);const S=document.createElement("span");S.innerText=TL$2("Search"),S.style.cssText="width:40%;padding-left:5px",S.classList.add("no_wrap"),y.appendChild(S);const D=document.createElement("div");D.style.cssText="width:60%;padding-left:5px;padding-right:7px",D.appendChild(M),y.appendChild(D),l.appendChild(y)}const h=document.createElement("div");h.style.cssText="width:100%;height:200px;overflow-y:scroll;overflow-x:hidden;border-top:2px solid #555;border-bottom:solid #555;",h.id="rigid_body_list",modifier_rigid_body.clear();let _=!1,b=null,v=0;for(let y=0,M=u.length;y<M;++y){const S=u[y],D=document.createElement("div"),k=15;D.style.cssText=`font-size:12px;width:98%;height:${k+1}px;margin-top:1px;border-bottom:1px dotted #555;display:flex;align-items:center;margin-left:auto;margin-right:auto`;const O=document.createElement("span"),L=document.createElement("span");O.style.cssText=`display:flex;align-items:center;padding-left:5px;width:75px;height:${k}px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap`,L.style.cssText=`display:flex;align-items:center;justify-content:center;width:calc(100% - 5px - 1px - 75px);border-left:1px solid #444;height:${k}px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:center`,D.appendChild(O),D.appendChild(L),h.appendChild(D);const P=PHYSICAL_TYPE_COLOR_MAP[S.type],N=GROUP_INDEX_COLOR_MAP[S.groupIndex];O.innerHTML=`<i class="bi bi-square-fill" style="color:${P}"></i><i class="bi bi-square-fill" style="color:${N};margin-left:2px;"><span style="width:25px;text-align:center;margin-left:3px;">${y}</span><span style="width:20px;text-align:center">G${S.groupIndex}</span>`,L.innerText=S.name,modifier_rigid_body.add({index:y,dom:D,rigid_body:S,selected:!1,display:!0}),D.onmouseup=async function(z){if(_=!1,z.button==2){const K=";Body,剛体名,剛体名(英),関連ボーン名,剛体タイプ(0:Bone/1:物理演算/2:物理演算+ボーン追従),グループ(0~15),非衝突グループ文字列(ex:1 2 3 4),形状(0:球/1:箱/2:カプセル),サイズ_x,サイズ_y,サイズ_z,位置_x,位置_y,位置_z,回転_x[deg],回転_y[deg],回転_z[deg],質量,移動減衰,回転減衰,反発力,摩擦力",Z=(await navigator.clipboard.readText()).trim();C.popup_menu(z,[{key:"Copy Name",callback:async()=>{await navigator.clipboard.writeText(S.name)}},{key:"Copy Property",callback:async()=>{const V=[K];modifier_rigid_body.modify(H=>{const Y=H.rigid_body;function q(W){return`"${W}"`}function J(W){return Number(W.toFixed(4))}V.push(["Body",q(Y.name),q(Y.englishName),q(f[Y.boneIndex].name),Y.type,Y.groupIndex,(Y.groupTarget^65535)>>>0,Y.shapeType,J(Y.width),J(Y.height),J(Y.depth),J(Y.position[0]),J(Y.position[1]),J(Y.position[2]),J(Y.rotation[0]/(Math.PI/180)),J(Y.rotation[1]/(Math.PI/180)),J(Y.rotation[2]/(Math.PI/180)),J(Y.weight),J(Y.positionDamping),J(Y.rotationDamping),J(Y.restitution),J(Y.friction)].join(","))}),await navigator.clipboard.writeText(V.join(`
`))}},Z.indexOf(K)==0?{key:"Paste from clipboard",callback:async()=>{function V(H,Y=","){const q=new RegExp("(\\"+Y+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\'+Y+"\\r\\n]*))","gi"),J=[[]];let W=null;for(;W=q.exec(H);){const te=W[1];te.length&&te!==Y&&J.push([]);let ie;W[2]?ie=W[2].replace(new RegExp('""',"g"),'"'):ie=W[3],J[J.length-1].push(ie)}return J}V(Z)}}:null],null,(V,H,Y)=>{Y.callback()})}else m(i)},D.onmouseover=function(z){if(_){z.shiftKey?(modifier_rigid_body.hold(y),modifier_rigid_body.select(y)):z.ctrlKey||z.metaKey||_?(modifier_rigid_body.unhold(),modifier_rigid_body.hold(y),modifier_rigid_body.select(y)):(modifier_rigid_body.unhold(),modifier_rigid_body.hold(y),modifier_rigid_body.deselect_all(),modifier_rigid_body.select(y)),modifier_rigid_body.update_dom();const K=D;let Z=null,V=null;for(let q=0;q<h.children.length;q++)h.children[q]==K&&(Z=K,V=K,h.children[q-1]&&Z==K&&(Z=h.children[q-1]),h.children[q+1]&&V==K&&(V=h.children[q+1]));s.mouse_point_x;const H=s.mouse_point_y;let Y=b-H;b=H,Y==0&&(Y=v),Y<0?(V.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),v=-1):(Z.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),v=1)}else modifier_rigid_body.update_dom(),D.style.background="#44A"},D.onmouseleave=function(z){modifier_rigid_body.update_dom(D)},D.onmousedown=function(z){_=!0,z.button!=2&&(z.shiftKey?(modifier_rigid_body.hold(y),modifier_rigid_body.select(y)):z.ctrlKey||z.metaKey?(modifier_rigid_body.unhold(),modifier_rigid_body.hold(y),modifier_rigid_body.toggle(y)):(modifier_rigid_body.unhold(),modifier_rigid_body.hold(y),modifier_rigid_body.deselect_all(),modifier_rigid_body.select(y)),modifier_rigid_body.update_dom())}}modifier_rigid_body.callbacks.helper=()=>{const y=modifier_rigid_body.items;for(let M=0,S=y.length;M<S;++M){const D=i._physicsHelper?.children?.[M];D&&(y[M].selected?D.material=SELECT_MATERIAL:D.material=D.__backup_mmd_physics_helper_material__,D.material.needsUpdate=!0)}},setTimeout(()=>{modifier_rigid_body.items[0]?.dom?.onmousedown?.({}),modifier_rigid_body.items[0]?.dom?.onmouseup?.({})},250),l.appendChild(h),UC$1.make_separator(l,{close:!0,title:TL$2("rigid_body_properties")});const w=document.createElement("div");w.style.cssText="width:100%",w.id="rigid_body_prop_panel",l.appendChild(w)}else a&&a.classList.add("no_item_and_hidden");if(!o){l.id="3d_object_rigid_body_panel",l.style.textAlign="left",l.style.width="100%",l.style.overflowY="scroll";const u=document.getElementById("right_side_panel_tab_rigid_body");u&&(u.innerHTML="",u.appendChild(l))}modifier_rigid_body.needsUpdate=!1}async function UI_ConstraintPanel(){const s=DMC,e=s.ui.rigid_body_flags;let i=s.current.object;function r(u){let f=null;return u?.skeleton&&(f=u),u?.parent&&(f=f||r(u.parent)),f}i=r(i);const o=document.getElementById("3d_object_constraint_panel"),l=o||document.createElement("div");s.ui.rigid_body_panel=o,l.innerHTML="";const a=document.getElementById("right_side_panel_tab_constraint_button");a&&(a.classList.remove("no_item_and_hidden"),a.classList.remove("no_item")),UC$1.make_separator(l,{close:!1,sub:!0,title:"Constraint"});const d=i?.getDDDProperties?.()?.type;if(d=="pmx"||d=="pmd"){let h=function(M){const S=document.getElementById("constraint_prop_panel");if(S==null)return;S.innerHTML="";const D=modifier_constraint.get_current();if(D==null)return;const O=s.mmd_animation_helper.objects.get(M)?.physics;O?.bodies,O?.constraints;const L=D.index,P=f[L];if(P){let N=function(){try{s.mmd_animation_helper.remove(M),s.mmd_animation_helper.add(M)}catch(z){console.log(z)}};UC$1.make_key_value2(S,"Name",P.name,{value_css:{width:"140px"}}),UC$1.make_pulldown(S,"ConstraintType",["Default","6DOF","P2P","ConeTwist","Slider","Hinge"].map((z,K)=>({key:z,value:K})),P.type,{},z=>{P.type=Number(z)}),UC$1.make_separator(S,{close:!1,sub:!0,title:"Connected Rigid Body"}),UC$1.make_pulldown(S,"From",m,P.rigidBodyIndex1,{},z=>{P.rigidBodyIndex1=Number(z)}),UC$1.make_pulldown(S,"To",m,P.rigidBodyIndex2,{},z=>{P.rigidBodyIndex2=Number(z)}),UC$1.make_separator(S,{close:!1,sub:!0,title:"TR"}),UC$1.make_vec3_box(S,"Position",P.position,1,{step:.01},z=>{P.position[0]=z},z=>{P.position[1]=z},z=>{P.position[2]=z}),UC$1.make_vec3_box(S,"Rotation",rad2deg(P.rotation),1,{step:.01},z=>{P.rotation[0]=deg2rad(z)},z=>{P.rotation[1]=deg2rad(z)},z=>{P.rotation[2]=deg2rad(z)}),UC$1.make_separator(S,{close:!1,sub:!0,title:"Limit"}),UC$1.make_vec3_box(S,"MinRot",rad2deg(P.rotationLimitation1),1,{step:.01},z=>{P.rotationLimitation1[0]=deg2rad(z)},z=>{P.rotationLimitation1[1]=deg2rad(z)},z=>{P.rotationLimitation1[2]=deg2rad(z)}),UC$1.make_vec3_box(S,"MaxRot",rad2deg(P.rotationLimitation2),1,{step:.01},z=>{P.rotationLimitation2[0]=deg2rad(z)},z=>{P.rotationLimitation2[1]=deg2rad(z)},z=>{P.rotationLimitation2[2]=deg2rad(z)}),UC$1.make_vec3_box(S,"MinTrans",P.translationLimitation1,1,{step:.01},z=>{P.translationLimitation1[0]=z,N()},z=>{P.translationLimitation1[1]=z,N()},z=>{P.translationLimitation1[2]=z,N()}),UC$1.make_vec3_box(S,"MaxTrans",P.translationLimitation2,1,{step:.01},z=>{P.translationLimitation2[0]=z},z=>{P.translationLimitation2[1]=z},z=>{P.translationLimitation2[2]=z}),UC$1.make_separator(S,{close:!1,sub:!0,title:"Spring Coefficient"}),UC$1.make_vec3_box(S,"SpringPos",P.springPosition,1,{step:.01},z=>{P.springPosition[0]=z},z=>{P.springPosition[1]=z},z=>{P.springPosition[2]=z}),UC$1.make_vec3_box(S,"SpringRot",P.springRotation,1,{step:.01},z=>{P.springRotation[0]=z},z=>{P.springRotation[1]=z},z=>{P.springRotation[2]=z})}};const u=i.geometry.userData.MMD.rigidBodies,f=i.geometry.userData.MMD.constraints;UC$1.make_button(l,"Reset to zero","Reset",null,async()=>{await C.modal_ok_cancel_promise("Confirm","Are you sure to reset?")});const m=[];for(let M=0;M<u.length;++M)m.push({key:u[M].name,value:M});{const M=document.createElement("div");M.classList.add("flex-v-center"),M.style.cssText="width:100%;height:20px;font-size:12px;background:#333";const S=document.createElement("input");S.style.cssText="width:100%;text-align:center",S.value=e.search_wards_on_constraint??"",S.oninput=S.onchange=function(O){modifier_constraint.deselect_all(!1);const L=S.value.normalize("NFC"),P=L.split(/\s+/);e.search_wards_on_constraint=L,modifier_constraint.modify_all(N=>{let z=!0;for(const K of P)N.constraint.name.normalize("NFC").indexOf(K)==-1&&(z=!1);N.display=z}),modifier_constraint.update_dom(),O?.preventDefault?.(),O?.stopPropagation?.()},setTimeout(()=>{S.value.length>0&&S.oninput()},100);const D=document.createElement("span");D.innerText="Search",D.style.cssText="width:40%;padding-left:5px",D.classList.add("no_wrap"),M.appendChild(D);const k=document.createElement("div");k.style.cssText="width:60%;padding-left:5px;padding-right:7px",k.appendChild(S),M.appendChild(k),l.appendChild(M)}const _=document.createElement("div");_.style.cssText="width:100%;height:200px;overflow-y:scroll;overflow-x:hidden;border-top:2px solid #555;border-bottom:solid #555",modifier_constraint.clear();let b=!1,v=null,w=0;for(let M=0,S=f.length;M<S;++M){const D=f[M],k=document.createElement("div"),O=15;k.style.cssText=`font-size:12px;width:98%;height:${O+1}px;margin-top:1px;border-bottom:1px dotted #555;display:flex;align-items:center`;const L=document.createElement("span"),P=document.createElement("span");L.style.cssText=`display:flex;align-items:center;padding-left:5px;width:170px;height:${O}px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap`,P.style.cssText=`display:flex;align-items:center;justify-content:center;width:calc(100% - 5px - 1px - 75px);border-left:1px solid #444;height:${O}px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:center`,k.appendChild(L),k.appendChild(P),_.appendChild(k);const z=["#FF0","#F90","#FAC","#AFA","#77F","#F8F"][D.type];L.innerHTML=`<i class="bi bi-square-fill" style="color:${z}"></i><span style="width:25px;text-align:center">${M}</span><span style="width:80px;overflow:hidden;font-size:10px">${u[D.rigidBodyIndex1].name}<i class="bi bi-arrow-right-short" style="display:inline-block"></i>${u[D.rigidBodyIndex2].name}</span>`,P.innerText=D.name,modifier_constraint.add({index:M,dom:k,constraint:D,selected:!1,display:!0}),k.onmouseup=async function(K){if(b=!1,K.button==2){const Z=";Body,剛体名,剛体名(英),関連ボーン名,剛体タイプ(0:Bone/1:物理演算/2:物理演算+ボーン追従),グループ(0~15),非衝突グループ文字列(ex:1 2 3 4),形状(0:球/1:箱/2:カプセル),サイズ_x,サイズ_y,サイズ_z,位置_x,位置_y,位置_z,回転_x[deg],回転_y[deg],回転_z[deg],質量,移動減衰,回転減衰,反発力,摩擦力",V=(await navigator.clipboard.readText()).trim();C.popup_menu(K,[{key:"Copy Name",callback:async()=>{await navigator.clipboard.writeText(D.name)}},{key:"Copy Property",callback:async()=>{const H=[Z];modifier_constraint.modify(Y=>{const q=Y.rigid_body;function J(te){return`"${te}"`}function W(te){return Number(te.toFixed(4))}H.push(["Body",J(q.name),J(q.englishName),J(bones[q.boneIndex].name),q.type,q.groupIndex,(q.groupTarget^65535)>>>0,q.shapeType,W(q.width),W(q.height),W(q.depth),W(q.position[0]),W(q.position[1]),W(q.position[2]),W(q.rotation[0]/(Math.PI/180)),W(q.rotation[1]/(Math.PI/180)),W(q.rotation[2]/(Math.PI/180)),W(q.weight),W(q.positionDamping),W(q.rotationDamping),W(q.restitution),W(q.friction)].join(","))}),await navigator.clipboard.writeText(H.join(`
`))}},V.indexOf(Z)==0?{key:"Paste from clipboard",callback:async()=>{function H(Y,q=","){const J=new RegExp("(\\"+q+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\'+q+"\\r\\n]*))","gi"),W=[[]];let te=null;for(;te=J.exec(Y);){const ie=te[1];ie.length&&ie!==q&&W.push([]);let oe;te[2]?oe=te[2].replace(new RegExp('""',"g"),'"'):oe=te[3],W[W.length-1].push(oe)}return W}H(V)}}:null],null,(H,Y,q)=>{q.callback()})}else h(i)},k.onmouseover=function(K){if(b){K.shiftKey?(modifier_constraint.hold(M),modifier_constraint.select(M)):K.ctrlKey||K.metaKey||b?(modifier_constraint.unhold(),modifier_constraint.hold(M),modifier_constraint.select(M)):(modifier_constraint.unhold(),modifier_constraint.hold(M),modifier_constraint.deselect_all(),modifier_constraint.select(M)),modifier_constraint.update_dom();const Z=k;let V=null,H=null;for(let J=0;J<_.children.length;J++)_.children[J]==Z&&(V=Z,H=Z,_.children[J-1]&&V==Z&&(V=_.children[J-1]),_.children[J+1]&&H==Z&&(H=_.children[J+1]));s.mouse_point_x;const Y=s.mouse_point_y;let q=v-Y;v=Y,q==0&&(q=w),q<0?(H.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),w=-1):(V.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),w=1)}else modifier_constraint.update_dom(),k.style.background="#44A"},k.onmouseleave=function(K){modifier_constraint.update_dom(k)},k.onmousedown=function(K){b=!0,K.button!=2&&(K.shiftKey?(modifier_constraint.hold(M),modifier_constraint.select(M)):K.ctrlKey||K.metaKey?(modifier_constraint.unhold(),modifier_constraint.hold(M),modifier_constraint.toggle(M)):(modifier_constraint.unhold(),modifier_constraint.hold(M),modifier_constraint.deselect_all(),modifier_constraint.select(M)),modifier_constraint.update_dom())}}setTimeout(()=>{modifier_constraint.items[0]?.dom?.onmousedown?.({}),modifier_constraint.items[0]?.dom?.onmouseup?.({})},250),l.appendChild(_),UC$1.make_separator(l,{close:!0,title:"Constraint Properties"});const y=document.createElement("div");y.style.cssText="width:100%",y.id="constraint_prop_panel",l.appendChild(y)}else a&&a.classList.add("no_item_and_hidden");if(!o){l.id="3d_object_constraint_panel",l.style.textAlign="left",l.style.width="100%",l.style.overflowY="scroll";const u=document.getElementById("right_side_panel_tab_constraint");u&&(u.innerHTML="",u.appendChild(l))}}function on_changed_scene(s){const e=DMC;let i={update_tree:!0,update_panel:!0};s&&Object.assign(i,s),i?.focus_object&&(DMC.current.object=i?.focus_object),i.update_tree&&(UI_WorldTimelineComponent(),UI_RightPanelTree(i)),i.update_panel&&UI_RightPanelTabs(),DMC.dispatchEvent("update@dynamic_env_map");{let r=null;e.scene.traverse(o=>{const l=o.getDDDProperties?.();l&&l.audio&&l.audio.synchronize&&(r=l.audio.instance)}),r?e.setSynchronizeClock(()=>r.time(),()=>{}):e.setSynchronizeClock(null)}}setInterval(()=>{window._c=window.DMC?.current?.object},1e3);function UI_setup_listeners(){const s=DMC;s.removeEventListener("change@scene",on_changed_scene),s.addEventListener("change@scene",on_changed_scene),s.removeEventListener("change@tree",on_changed_scene),s.addEventListener("change@tree",on_changed_scene),s.recreate_cache_table?.()}function estimate_end_of_time(){const s=DMC;let e=60*5,i=0;if(s.scene.traverse(r=>{const o=r?.getDDDProperties?.();if(o&&(r instanceof THREE.Audio&&(i=Math.max(r.buffer.duration,i)),o.audio?.use_keyframes))for(const a of o.audio.keyframes)i=Math.max(a.time,i);if(r.getActionList?.().length>0){const l=r.getActionMode();if(l=="Single"){const c=r.getCurrentAction().action?._clip;c?.duration!=null&&(i=Math.max(c.duration,i))}else if(l=="Multiple"){const a=r.getActionList();for(const c of a){const d=c._clip;d?.duration!=null&&(i=Math.max(d.duration,i))}}}}),e=i==0?60*5:i,s.animation_world_time_duration=e,s.ui.system_flags.auto_detect_end_time){s.ui.system_flags.end_time=s.animation_world_time_duration;const r=document.getElementById("system_flags_end_time");if(r){const o=s.ui.system_flags;r.value=o.keyframe_view?o.end_time*30:o.end_time,o.auto_detect_end_time||(s.animation_world_time_duration=o.end_time)}}else s.animation_world_time_duration=s.ui.system_flags.end_time}function UI_WorldTimelineComponent(){estimate_end_of_time();const s=DMC;if(document.getElementById("timeline_block")==null){s._world_time_slider_timer_&&clearInterval(s._world_time_slider_timer_);const e=`
		<div style="width: 60px;margin-left:3px;float:left;">
			<button style="display:flex;align-items:center; width: 60px;height: 17px;font-size:14px;" class="start_world_time_component"><i class="bi bi-caret-right-fill"></i></button>
		</div>
		<div style="width: 30px;margin-left:3px;float:left;">
			<button style="display:flex;align-items:center;width: 30px;height: 17px;font-size:14px;padding-top:1px;" class="stop_world_time_component"><i class="bi bi-stop-fill"></i></button>
		</div>
		`,i='<i class="bi bi-caret-right-fill"></i>',r='<i class="bi bi-pause-fill"></i>',o=document.getElementById("main_frame"),l=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div");c.innerHTML=e,l.style.cssText="width:calc(100% - 30px);position:absolute;display:flex;justify-content:center;align-items:center; left:0px;bottom:2px;z-index:5;",l.id="timeline_block",l.appendChild(c),a.style.cssText="width:calc(100% - 100px);display:flex;justify-content:center;align-items:center;margin-top:-2px",l.appendChild(a);const d=l.querySelector(".start_world_time_component"),u=l.querySelector(".stop_world_time_component");if(document.getElementById("play_button"),document.getElementById("stop_button"),d){let h=function(b){b.stopPropagation(),s.play()},_=function(b){b.stopPropagation(),s.stop()};{let b=function(v,w){if(v==null)return;function y(M){M?.preventDefault?.(),M?.stopPropagation?.()}v.onpointercancel=v.onpointerdown=v.onclick=v.onmouseup=v.onmousedown=v.onmousemove=y,v.onpointerup=w};b(d,h),b(u,_)}s.addEventListener("paused@scene",b=>{d.innerHTML=i,u.disabled=!1,u.style.opacity="1.0"}),s.addEventListener("resumed@scene",b=>{d.innerHTML=r,u.disabled=!1,u.style.opacity="1.0"}),s.addEventListener("ended@scene",b=>{d.innerHTML=i,u.disabled=!0,u.style.opacity="0.5"}),s.addEventListener("started@scene",b=>{d.innerHTML=r,u.disabled=!1,u.style.opacity="1.0"}),d.innerHTML=i,u.disabled=!0,u.style.opacity="0.5"}const f=UC.make_key_value_with_slider(a,"",DMC.animation_world_time,{key_css:{marginRight:"0px",marginLeft:"0px",minWidth:"0px"},slider_css:{marginRight:"0px",marginLeft:"0px",width:"100%",maxWidth:"unset"},value_css:{marginRight:"0px",marginLeft:"0px"},min:0,max:s.animation_world_time_duration},h=>{const _=h-s.animation_world_time;s.delta_queue.push(_)}),m=f.element;m.style.zIndex="5",m.id="world_time_slider",o.appendChild(l),f.setMax(s.ui.system_flags.end_time),s._world_time_slider_timer_=setInterval(()=>{const h=s.ui.system_flags.end_time,_=s.ui.system_flags.no_end_time,b=s.ui.system_flags.keyframe_view,v=f.slider.value=s.animation_world_time.toFixed(2);if(f.modifier.value=b?(s.animation_world_time*30).toFixed(0):v,f.update_animation(),s.playing_state==s.PLAYING_STATE.PLAYING&&!_&&h<v&&(s.ui.system_flags.loop?s.draw_thread_after_runner.push(()=>{s.stop(),s.draw_thread_after_runner.push(()=>{s.play()})}):u.click()),s.ipc_proxy){const w=s.ipc_proxy.ui;w({key:"timeline",type:"timeline",name:"Timeline",current:v,ratio:h>0?s.animation_world_time/h:200,max:h})}},317),window.app_mode&&(l.style.display="none",l.style.width="100%")}}window._UI_WorldTimelineComponent_=UI_WorldTimelineComponent;async function UI_RightPanelTree(s={}){UI_TreePanel(s)}let init_flag_for_right_panel=!1;function _update_right_panel_(){UI_ObjectPanel(),UI_MaterialPanel(),UI_MorphPanel(),UI_BonePanel(),UI_RigidBodyPanel(),UI_ConstraintPanel()}async function UI_RightPanelTabs(){DMC.main_is_ready3?(init_flag_for_right_panel=!0,_update_right_panel_()):setTimeout(()=>{init_flag_for_right_panel==!1&&UI_RightPanelTabs()},250)}const G_Clipboard={picked_motion:null,picked_light:null,picked_trs:null},TL$1=s=>(window.T&&window.T("tree_panel."+s),window.parent?.T?window.parent.T("tree_panel."+s):s);function scroll_to_active(s){if(s==null)return;const e=DMC.ui.tree.dom;if(s){e.parentElement.parentElement.clientHeight;const r=Number(s.dataset.index);e.parentElement.parentElement.scrollTop=r*17}}function get_current_object_element(){const s=DMC.current.object;if(s){const e=document.querySelectorAll(".tree_component_item");for(let i=0;i<e.length;i++)if(s.uuid==e[i].dataset.uuid)return e[i]}return null}function interactive_console(){const s=document.getElementById("tree_interactive_console");if(s&&s.onkeydown==null){let e=[""],i=0;s.onkeydown=function(r){if(r.code=="Enter"&&r.isComposing==!1){const o=s.value;if(o.length>0){s.value="",window.script_runner(o,{print:!0}),e=e.filter(a=>a.length>0);let l=e.filter(a=>a!=o);l.push(o),l=[""].concat(l),e.length=0;for(const a of l)e.push(a);i=e.length}r.stopPropagation(),r.preventDefault()}else r.code=="ArrowUp"?(i-1>=0&&(i--,s.value=e[i]),r.stopPropagation(),r.preventDefault()):r.code=="ArrowDown"&&(i+1<e.length?(i++,s.value=e[i]):(i=e.length,s.value=""),r.stopPropagation(),r.preventDefault())}}}var G_click_timer=null;function UI_TreePanel(s){if(document.getElementById("__editor_right_side_panel_object_tree_inner__")==null)return;const e={auto_focus:!0};s&&Object.assign(e,s),window.debug&&console.log("UI_TreePanel");const i=window.DMC;interactive_console();const r=document.getElementById("3d_object_tree"),o=r||document.createElement("div");o.innerHTML="";const a=document.getElementById("3d_object_helper_tree")||document.createElement("div");if(a.style.backgroundColor="#222",a.style.marginTop="0px",a.style.paddingBottom="0px",a.style.border="3px solid #222",a.innerHTML="",i.ui.tree==null&&(i.ui.helper_tree=new TreeComponent,i.ui.helper_tree.initialize({dom:a}),i.ui.tree=new TreeComponent,i.ui.tree.initialize({dom:o}),i.ui.tree.event_listener=async function(u,f){if(u)if(u?.constructor?.name=="MouseEvent"){if(u.button==0&&u.type=="mousedown"){on_object_selected(u,f);const m=document.querySelector(".tree_component_item.active");m&&(__storage__.editor.set("last_active_tree_component_item",m.dataset.uuid),i.transform_controls.select_object&&i.transform_controls.select_object(m.dataset.uuid,{select_tree_component:!1}))}else if(!(u.button==1&&u.type=="mousedown")){if(u.button==2&&u.type=="mouseup")on_object_context_menu(u,f);else if(u.button==0&&u.type=="mouseup"&&u.button==0&&u.ctrlKey&&window.is_mac)on_object_context_menu(u,f);else if(u.button==0&&u.type=="dblclick"){const m=document.querySelector(".tree_component_item.active");m&&(__storage__.editor.set("last_active_tree_component_item",m.dataset.uuid),i.transform_controls.focus_object&&i.transform_controls.focus_object(m.dataset.uuid,{select_tree_component:!1}))}}}else if(u?.constructor?.name=="DragEvent"){let m=null,h=null;if(i.scene.traverse(_=>{_.uuid==f.src?m=_:_.uuid==f.dst&&(h=_)}),m&&h&&m!=h){if(f.is_sibling){if(h?.parent){const _=[],b=h.parent;for(const v of b.children)_.push(v),h==v&&_.push(m);for(const v of _)i.scene.remove(v);for(const v of _)b.add(v)}}else{let _=!1;m.traverse(b=>{b==h&&(_=!0)}),_||(i.scene.remove(m),h.add(m))}i.ui.tree.update()}}else u?.type=="open_tree"&&UI_TreePanel()}),G_click_timer&&clearTimeout(G_click_timer),e.auto_focus&&(G_click_timer=setTimeout(async()=>{G_click_timer=null;const u=await __storage__.editor.get("last_active_tree_component_item");if(u||i.current.object){const f=document.querySelectorAll(".tree_component_item");if(f){let m=null;for(let h=0;h<f.length;h++){const _=f[h];_.classList.remove("active"),i.current.object?i.current.object?.uuid==_.dataset.uuid&&(m=_):u==_.dataset.uuid&&(m=_)}if(m){let h=function(_,b){const v=document.createEvent("MouseEvents");v.initEvent(b,!0,!0),_.dispatchEvent(v)};h(m,"mousedown"),setTimeout(function(){h(m,"mouseup")},100)}}}},500)),i.ui.tree.build(i.scene,{}),i.ui.helper_tree.build(i.helper_scene,{}),!r){o.id="3d_object_tree",o.dataset.type="3d_object_tree",o.classList.add("dark"),o.classList.add("root"),o.classList.add("right_panel_tree_window"),o.onclick=function(f){const m=document.getElementsByClassName("active_window");for(let h=0;h<m.length;++h)m[h].classList.remove("active_window");o.classList.add("active_window"),document.activeElement?.blur&&document.activeElement.blur(),window.file_browser?.deselect_all&&window.file_browser.deselect_all()};const u=document.getElementById("__editor_right_side_panel_object_tree_inner__");u.innerHTML="",u.appendChild(o),u.appendChild(a)}document.querySelectorAll(".node_title").forEach(u=>{u.onclick=function(){var f=this.parentElement.querySelector(".children");console.log(f),f.classList.toggle("hide")}}),i.apply_deferred_effect&&i.apply_deferred_effect()}function on_object_selected(s,e,i){const r=window.DMC,o={auto_focus:!0};i&&Object.assign(o,i);const l=e.target.dataset.reference;function a(d,u){if(u==d.uuid)return d;for(const f of d.children){const m=a(f,u);if(m)return m}return null}const c=a(r.scene,l);r.current.object=c,o.auto_focus&&(document.querySelector("#right_side_panel_tab_storage_button.active"),document.querySelector("#right_side_panel_tab_graphics_button.active"),document.querySelector("#right_side_panel_tab_system_button.active"),document.querySelector("#right_side_panel_tab_terminal_button.active"),document.querySelector("#right_side_panel_tab_object_button")),UI_RightPanelTabs()}async function on_object_context_menu(s,e){const i=window.DMC,r=e.target.dataset.reference;function o(k,O){if(O==k.uuid)return k;for(const L of k.children){const P=o(L,O);if(P)return P}return null}const l=o(i.scene,r);if(l==null)return;i.current.object=l;const a=l.getDDDProperties?.()||{},c=a?.type;let d=[];const f=window.external_io?.driver,m=["websocketfs","indexeddb","aws_s3","memory","webdav"].includes(f),h=function(){const k=l.getDDDProperties?.()?.source_file;k?(window.cross_file_system.open_folder(k),m&&window.file_browser.open(C$2.DPath(k).dirname)):console.error("Does not have a source file.")},_=async function(){window.cross_file_system.open_folder(await GetProjectPath())},b=a.source_file,v=await GetProjectPath()&&l.type=="Scene"?_:h;(b||await GetProjectPath()&&l.type=="Scene")&&(nodejs||m)&&(window.is_windows?(l.getDDDProperties?.()?.source_file&&d.push({key:TL$1("open_in_app"),callback:()=>{window.cross_file_system.open_in_app(l.getDDDProperties?.()?.source_file)}}),d.push({key:`<span style='float:left'>${TL$1("open_in_folder")}</span><span style='float:right;color:gray'>${window.is_mac?"⌘":"CTRL"} + o</span>`,callback:v})):window.is_mac?d.push({key:`<span style='float:left'>${TL$1("open_in_folder")}</span><span style='float:right;color:gray'>${window.is_mac?"⌘":"CTRL"} + o</span>`,callback:v}):window.is_linux&&d.push({key:`<span style='float:left'>${TL$1("open_in_folder")}</span><span style='float:right;color:gray'>${window.is_mac?"⌘":"CTRL"} + o</span>`,callback:v}),d.push("---"));let w=[];const y=[],M=[];a.audio?.instance&&a.audio.source_file&&window.is_electron&&window.external_io==null&&M.push({key:`<i class='bi bi-folder2-open'></i> ${TL$1("open_sound_in_folder")}`,callback:()=>{window.nodejs.open_in_finder(a.audio.source_file)}});const S=a.action?.sources;if(S?.length>0){for(const k of S)if(k.source_file){M.push({key:`<i class='bi bi-folder2-open'></i> ${TL$1("open_motion_in_folder")}`,callback:()=>{window.cross_file_system.open_folder(k.source_file),m&&window.file_browser.open(C$2.DPath(k.source_file).dirname)}}),M.push({key:`<span style='float:left'><i class='bi bi-c-circle-fill'></i> ${TL$1("pick_motion")}</span>`,callback:()=>{G_Clipboard.picked_motion={source_file:k.source_file}}});break}}else if(l.getCurrentActionSource?.()){const k=l.getCurrentActionSource();k.source_file&&window.is_electron&&window.external_io==null&&(M.push({key:`<i class='bi bi-folder2-open'></i> ${TL$1("open_motion_in_folder")}`,callback:()=>{window.cross_file_system.open_folder(k.source_file),m&&window.file_browser.open(C$2.DPath(k.source_file).dirname)}}),M.push({key:`<span style='float:left'><i class='bi bi-c-circle-fill'></i> ${TL$1("pick_motion")}</span>`,callback:()=>{G_Clipboard.picked_motion={source_file:k.source_file}}}))}if(G_Clipboard.picked_motion&&M.push({key:`<span style='float:left'><i class='bi bi-c-circle-fill'></i> ${TL$1("load_from_picked_motion")}</span>`,callback:async()=>{console.log(G_Clipboard.picked_motion.source_file),await UIL.load_files([G_Clipboard.picked_motion.source_file])}}),c=="pmx"&&window.nodejs&&window.external_io==null&&M.push({key:`<i class='bi bi-archive-fill'></i> ${TL$1("pack_references")}`,callback:async()=>{const k=i.current.object,O=k.getDDDProperties?.()?.source_file,L=k.getDDDProperties?.()?.j_object_source_file;if(O){const P=await window.cross_file_system.save_dialog({defaultPath:O,filters:[{name:"PMX",extensions:["pmx"]}]});if(P&&P[0]){const N=C$2.DPath(P[0]),z=C$2.DPath(O),K=k.material;window.nodejs.fs.copyFileSync(O,N.path),L&&window.nodejs.fs.copyFileSync(L,C$2.DPathJoin(N.dirname,C$2.DPath(L).basename));for(let Z=0;Z<K.length;Z++){const V=K[Z];for(const H in V){const Y=V[H];if(Y instanceof THREE.Texture){const q=Y._source_file_||Y.source_file;if(q&&window.is_data_url(q)==!1)try{const J=window.nodejs.path.relative(z.dirname,q),W=C$2.DPath(window.nodejs.path.join(N.dirname,J));window.nodejs.fs.mkdirSync(W.dirname,{recursive:!0}),window.nodejs.fs.copyFileSync(q,W.path)}catch(J){console.error(J)}}}}}}}}),a.source_file){const k=C$2.DPath(a.source_file),O=C$2.path.join(k.dirname,k.name+".js");await window.cross_file_system.exists(O)&&y.push({key:`<i class='bi bi-filetype-js'></i> ${TL$1("restore_script_from_file")}`,callback:async()=>{const L=await window.cross_file_system.read(O);l.script=L.toString()}}),y.push({key:`<i class='bi bi-filetype-js'></i> ${TL$1("export_script")}`,callback:async()=>{const L=l.script.normalize("NFC");await window.cross_file_system.write(O,L,{encoding:"utf8"}),UI.event_notify(`Saved as "${O}"`)}})}if(y.push({key:`<i class='bi bi-bar-chart-steps'></i> ${TL$1("export_as_object")}`,callback:()=>{const k="ddd/ui/export_object.html";UC$1.make_window(k,"Object Exporter",{url:k,width:385,height:400,urlLoaded:async function(O){const L=O.iframe.contentWindow;L.object=i.current.object,L.current_link=window.file_browser?.current_link,L.self_frame=O,O.setOnCloseFrameListener(()=>{})}})}}),y.push({key:`<i class='bi bi-clipboard-data'></i> ${TL$1("copy_object_status_for_script")}`,callback:()=>{const k=[];k.push(`object.quaternion.set(${l.quaternion.x.toFixed(4)},${l.quaternion.y.toFixed(4)},${l.quaternion.z.toFixed(4)},${l.quaternion.w.toFixed(4)})`),k.push(`object.position.set(${l.position.x.toFixed(2)},${l.position.y.toFixed(2)},${l.position.z.toFixed(2)})`),k.push(`object.scale.set(${l.scale.x.toFixed(2)},${l.scale.y.toFixed(2)},${l.scale.z.toFixed(2)})`),l.target&&l.target instanceof THREE.Object3D&&k.push(`object.target.position.set(${l.target.position.x.toFixed(2)},${l.target.position.y.toFixed(2)},${l.target.position.z.toFixed(2)})`),l.color&&k.push(`object.color.setRGB(${l.color.r.toFixed(2)},${l.color.g.toFixed(2)},${l.color.b.toFixed(2)})`),l.groundColor&&k.push(`object.groundColor.setRGB(${l.groundColor.r.toFixed(2)},${l.groundColor.g.toFixed(2)},${l.groundColor.b.toFixed(2)})`),l.decay&&k.push(`object.decay=${l.decay.toFixed(2)};`),l.distance&&k.push(`object.distance=${l.distance.toFixed(2)};`),l.intensity&&k.push(`object.intensity=${l.intensity.toFixed(2)};`),l.angle&&k.push(`object.angle=${l.angle.toFixed(2)};`),l.penumbra&&k.push(`object.penumbra=${l.penumbra.toFixed(2)};`),l.width&&k.push(`object.width=${l.width};`),l.height&&k.push(`object.height=${l.height};`),navigator.clipboard.writeText(k.join(`
`))}}),y.push({key:`<i class='bi bi-clipboard-data'></i> ${TL$1("copy_to_clipboard_panel")}`,callback:()=>{const k="ddd/ui/export_object.html";UC$1.make_window(k,"Object Exporter",{url:k,width:385,height:400,urlLoaded:async function(O){const L=O.iframe.contentWindow,P=L.object=i.current.object;L.is_buffer=!0,L.onBuffer=async function(N,z){const K=P._dp_.uuid,Z=JSON.parse(await window.__storage__.editor.get("object_board","{}"));Z[K]={name:P.name,type:P.type,uuid:K,source_file:z._dp_?.source_file,j_object:z},await window.__storage__.editor.set("object_board",JSON.stringify(Z)),await window.__storage__.editor.set(`object_board@${K}`,JSON.stringify(z)),i.dispatchEvent("change@object_board",{})},L.current_link=window.file_browser?.current_link,L.self_frame=O,O.setOnCloseFrameListener(()=>{})}})}}),a.type=="pmx"||a.type=="pmd"){y.push({key:`<i class='bi bi-universal-access'></i> ${TL$1("export_as_pose")}`,callback:async()=>{const{MMDExporter:O}=await __vitePreload(()=>import("./MMDExporter@BBH_vGcK.js"),[],import.meta.url),P=new O().parseVpd(l,!0,!1);C$2.download(P,"pose.vpd")}});const k=C$2.DPath(a.source_file);{const O=C$2.path.join(k.dirname,k.name+".vpd");await window.cross_file_system.exists(O)&&y.push({key:`<i class='bi bi-filetype-js'></i> ${TL$1("restore_script_from_file")}`,callback:async()=>{const L=await window.cross_file_system.read(O);l.script=L.toString()}})}{const O=C$2.path.join(k.dirname,k.name+".js");y.push({key:`<i class='bi bi-filetype-js'></i> ${TL$1("export_script")}`,callback:async()=>{const L=l.script.normalize("NFC");await window.cross_file_system.write(O,L,{encoding:"utf8"}),UI.event_notify(`Saved as "${O}"`)}})}}l.getActionSources?.()?.[0]?.source_file?.length>0&&y.push({key:`<i class='bi bi-filetype-js'></i> ${TL$1("export_as_motion")}`,callback:()=>{const k="ddd/ui/export_motion.html";UC$1.make_window(k,"Motion Reference List Exporter",{url:k,width:450,height:350,urlLoaded:async function(O){const L=O.iframe.contentWindow;L.DMC=DMC,L.current_link=window.file_browser?.current_link,L.self_frame=O,O.setOnCloseFrameListener(()=>{})}})}}),y.push({key:`<i class='bi bi-filetype-js'></i> ${TL$1("export_as_gltf")}`,callback:()=>{UI.export_as("gltf")}}),l.geometry&&y.push({key:`<i class='bi bi-filetype-js'></i> ${TL$1("export_as_wave_front_object")}`,callback:()=>{UI.export_as("obj")}}),M.length>0&&(w=w.concat(["---"],M)),y.length>0&&(w=w.concat(["---"],y)),d=d.concat([{key:`<span style='float:left'><i class='bi bi-trash'></i> ${TL$1("remove")}</span><span style='float:right;color:gray'>d</span>`,callback:()=>{UI.remove_selected_objects_with_ui()}},{key:`<span style='float:left'><i class='bi bi-c-circle-fill'></i> ${TL$1("copy_name")}</span>`,callback:()=>{navigator.clipboard.writeText(l.name)}},{key:`<span style='float:left'><i class='bi bi-filetype-js'></i> ${TL$1("script")}</span><span style='float:right;color:gray'>t</span>`,callback:()=>{UI.open_script_editor_for_object()}},{key:`<i class='bi bi-filetype-json'></i> ${TL$1("user_data")}`,callback:()=>{let k=i.current.object;const O=k?.getDDDProperties?.()?.uuid;if(O){const L=(k.name?.length>0?k.name:null)||k.type+" : "+k.uuid;UC$1.open_script_editor(O+"-user-data",{title:L+"-user-data",text:k.userData?JSON.stringify(k.userData):"{}",mode:"json"},async function(P,N){k=i.getObjectBySubUUID(O),k&&(P=="save"?(k.script=N,await Builder3D.save_project()):P=="run"&&(k.script=N,window.script_runner(k)))})}}},{key:`<i class='bi bi-box-arrow-down-left'></i> ${TL$1("duplicate")}`,callback:()=>{Builder3D.duplicate_current_object()}},a.source_file?{key:`<i class='bi bi-arrow-clockwise'></i> ${TL$1("reload")}`,callback:()=>{UIL.load_files([{file_path:a.source_file,loading_behavior:"replace",loaded:()=>{}}])}}:null,...w]);function D(k){k.code=="KeyD"&&(UI.remove_selected_objects_with_ui(),k.preventDefault(),k.stopPropagation())}C$2.popup_menu(s,d,{event_listener:D},async(k,O,L)=>{L.callback()})}var UI_Tree={refresh(){UI_TreePanel()},show_all_helpers(){const e=DMC.ui.tree.dom.querySelectorAll(".helper_visibility.fa-eye-slash");for(let i=0;i<e.length;i++)e[i].click()},hide_all_helpers(){const e=DMC.ui.tree.dom.querySelectorAll(".helper_visibility.fa-eye");for(let i=0;i<e.length;i++)e[i].click()},extract_all_item(){DMC.scene.traverse(s=>s._collapsible_=!0),UI_TreePanel()},close_all_item(){DMC.scene.traverse(s=>s._collapsible_=!1),UI_TreePanel()},move_to_previous(){const s=DMC.current.object;if(s&&s.type!="Scene"){if(!s.getDDDProperties?.())return;const{objects:i,doms:r}=DMC.get_selected_objects();if(i.length!=1)return;const o=r[0],l=s.parent.children;let a=0;for(let c=0;c<l.length;c++)if(s==l[c]){a=c;break}if(a>0){const c=l[a-1],d=l[a];l[a-1]=d,l[a]=c;const u=document.getElementsByClassName("tree_component_item");for(let f=0;f<u.length;f++){const m=u[f];m.dataset.uuid==c.uuid&&(o.remove(),m.parentElement.insertBefore(o,m))}}}},move_to_next(){const s=DMC.current.object;if(s&&s.type!="Scene"){if(!s.getDDDProperties?.())return;const{objects:i,doms:r}=DMC.get_selected_objects();if(i.length!=1)return;const o=r[0],l=s.parent.children;let a=0;for(let c=0;c<l.length;c++)if(s==l[c]){a=c;break}if(a<l.length-1){const c=l[a+1],d=l[a];l[a+1]=d,l[a]=c;const u=document.getElementsByClassName("tree_component_item");for(let f=0;f<u.length;f++){const m=u[f];m.dataset.uuid==c.uuid&&(o.remove(),m.parentElement.insertBefore(o,m.nextSibling))}}}},move_to_parent(){const s=DMC.current.object;if(s&&s.type!="Scene"){const e=s.getDDDProperties?.();if(!e||e.draggable_on_tree==!1||e.droppable_on_tree==!1||e.removable==!1)return;const i=s.parent,r=i?.parent;if(r){s.parent.remove(s);const o=r.children.slice(),l=[];for(let a=0;a<o.length;a++)l.push(o[a]),i==o[a]&&l.push(s);for(let a=0;a<o.length;a++)r.remove(o[a]);for(let a=0;a<l.length;a++)r.add(l[a]);UI_TreePanel()}}},move_to_child(){const s=DMC?.current?.object;if(s&&s.type!="Scene"){const e=s.getDDDProperties?.();if(!e||e.draggable_on_tree==!1||e.droppable_on_tree==!1||e.removable==!1)return;const i=s.parent.children;let r=0;for(let o=0;o<i.length;o++)if(s==i[o]){r=o;break}if(r>0){const o=i[r-1],l=i[r];s.parent.remove(l),o.add(l),UI_TreePanel()}}},open_node(){const s=DMC.current.object;s&&s.type!="Scene"&&(s._collapsible_=!0,UI_TreePanel(),scroll_to_active(get_current_object_element()))},close_node(){const s=DMC.current.object;s&&s.type!="Scene"&&(s._collapsible_=!1,UI_TreePanel())},focus_previous(s){const e=document.querySelectorAll(".tree_component_item");let i=0;for(let r=0;r<e.length;r++)if(e[r].classList.contains("active")){i=r;break}if(i>0){let o=function(l,a){const c=document.createEvent("MouseEvents");c.initMouseEvent(a,!0,!0,window,0,0,0,80,20,!1,!1,s==!0,!1,0,null),l.dispatchEvent(c)};if(!s){const l=document.querySelectorAll(".tree_component_item.active");for(let a=0;a<l.length;a++)l[a].classList.remove("active")}const r=e[i-1];r&&(o(r,"mouseenter"),o(r,"mousedown"),setTimeout(function(){o(r,"mouseup"),o(r,"mouseleave")},100),scroll_to_active(get_current_object_element()))}},focus_next(s){const e=document.querySelectorAll(".tree_component_item");let i=0;for(let r=e.length-1;r>=0;r--)if(e[r].classList.contains("active")){i=r;break}if(i<e.length-1){let o=function(l,a){const c=document.createEvent("MouseEvents");c.initMouseEvent(a,!0,!0,window,0,0,0,80,20,!1,!1,s==!0,!1,0,null),l.dispatchEvent(c)};if(!s){const l=document.querySelectorAll(".tree_component_item.active");for(let a=0;a<l.length;a++)l[a].classList.remove("active")}const r=e[i+1];r&&(o(r,"mouseenter"),o(r,"mousedown"),setTimeout(function(){o(r,"mouseup"),o(r,"mouseleave")},100),scroll_to_active(get_current_object_element()))}}};function no_select_and_overlay_button_css_setting(s,e){function i(r){r.preventDefault(),r.stopPropagation()}s.onpointercancel=s.onpointerdown=s.onclick=s.onmouseup=s.onmousedown=s.onmousemove=i,s.onpointerup=function(r){r.preventDefault(),r.stopPropagation(),e(r)}}function TL(s){return window.T("tabs.system."+s)}function full_screen_play_button(){document.getElementById("full_screen_play_button")?.remove();const s=DMC;(()=>{const i=document.getElementById("main_frame"),r=document.createElement("div"),o=document.createElement("button"),l=document.createElement("i");r.style.cssText="display:flex;justify-content:center;align-item:center;position:absolute;left:0px;top:0px;background: linear-gradient(#111111AA, #222222AA);width:100%;height:100%;",o.style.cssText="width:100%;height:100%;margin:0;padding:0;display:flex;justify-content:center;background:none;border:none",l.classList.add("bi","bi-play-circle-fill"),l.style.cssText="font-size:100px",o.appendChild(l),r.appendChild(o),r.id="full_screen_play_button",no_select_and_overlay_button_css_setting(r,a=>{s.play(),r.remove()}),i.appendChild(r)})()}function UI_SystemPanel_For_Application(){const s=DMC;window.debug&&console.log("UI_SystemPanel_For_Application");const e=s.ui.system_flags;document.getElementById("full_screen_play_button")?.remove?.(),e.full_screen_play_button&&full_screen_play_button()}async function UI_SystemPanel(){const s=DMC,e=s.ui.system_flags;if(s.addEventListener("started@scene",function(o){document.getElementById("full_screen_play_button")?.remove?.()}),s.addEventListener("ended@scene",function(o){document.getElementById("full_screen_play_button")?.remove(),e.full_screen_play_button&&full_screen_play_button()}),UI_SystemPanel_For_Application(),document.getElementById("right_side_panel_tab_system_button")==null)return;const i=document.getElementById("system_panel"),r=i||document.createElement("div");s.ui.system_panel=i,r.innerHTML="",document.getElementById("right_side_panel_tab_system_button").classList.remove("no_item");{const o=[];o.push({key:"None",value:null});for(const d in s.grounds)o.push({key:d,value:d});const l=document.getElementById("play_button"),a=document.getElementById("stop_button");s.play_button=l,s.stop_button=a,a.disabled=!0,a.style.opacity="0.1",a.dataset.is_playing="false";const c=l.children[0];s.addEventListener("paused@scene",d=>{c.classList.remove("bi-pause-fill"),c.classList.add("bi-caret-right-fill"),a.disabled=!1,a.dataset.is_playing="false",a.style.opacity="1.0"}),s.addEventListener("resumed@scene",d=>{c.classList.add("bi-pause-fill"),c.classList.remove("bi-caret-right-fill"),a.disabled=!1,a.dataset.is_playing="false",a.style.opacity="1.0"}),s.addEventListener("ended@scene",d=>{c.classList.remove("bi-pause-fill"),c.classList.add("bi-caret-right-fill"),a.disabled=!0,a.dataset.is_playing="true",a.style.opacity="0.1"}),s.addEventListener("started@scene",d=>{c.classList.add("bi-pause-fill"),c.classList.remove("bi-caret-right-fill"),a.disabled=!1,a.dataset.is_playing="false",a.style.opacity="1.0"}),a.disabled=!0,a.dataset.is_playing="true",a.style.opacity="0.1",l.onclick=()=>{s.play()},a.onclick=()=>{s.stop()}}{{const l=UC$1.make_toggle_window(r,{title:T("tabs.system.etc"),toggle:!0},d=>{}).holder;e.system_volume===void 0&&(e.system_volume=.8);const a=document.getElementById("bgm_volume_component");if(a==null)return;a.innerHTML="";const c=[];c.push(UC$1.make_key_value_with_slider(a,TL("volume"),e.system_volume==null?1:e.system_volume,{min:0,max:1,step:.01,title:!1,value:!1},d=>{e.system_volume=d;for(const u of c)u.modifier.value!=d&&(u.modifier.value=d,u.slider.value=d,u.slider.oninput());s.scene.traverse(u=>{const f=u.getDDDProperties?.()||{};f.audio?.instance&&f.audio.instance.setVolume(d*d),u.setVolume&&u.setVolume(d*d)})})),c.push(UC$1.make_key_value_with_slider(l,TL("volume"),e.system_volume==null?1:e.system_volume,{min:0,max:1,step:.01},d=>{e.system_volume=d;for(const u of c)u.modifier.value!=d&&(u.modifier.value=d,u.slider.value=d,u.slider.oninput());s.scene.traverse(u=>{const f=u.getDDDProperties?.()||{};f.audio?.instance&&f.audio.instance.setVolume(d*d)})})),UC$1.make_toggle(l,"IK",e.ik==null?!0:e.ik,{},d=>{e.ik=d,s.mmd_animation_helper&&s.mmd_animation_helper.enable("ik",d)}),UC$1.make_toggle(l,TL("physics"),e.physics??!0,{},d=>{e.physics=d,s.mmd_animation_helper&&s.mmd_animation_helper.enable("physics",d)}),UC$1.make_toggle(l,TL("inspector"),e.inspector??!0,{},d=>{e.inspector=d,s.toggle_inspector(e.inspector)}),UC$1.make_toggle(l,TL("absolute_path"),e.absolute_path==null?!1:e.absolute_path,{},d=>{e.absolute_path=d,d?s.display_meta_information("Absolute Path",e.absolute_path?"Y":"N","project_absolute_path_flag"):s.display_meta_information("Absolute Path",void 0,"project_absolute_path_flag")}).update(),UC$1.make_toggle(l,TL("full_screen_play_button"),e.full_screen_play_button==null?!1:e.full_screen_play_button,{},d=>{e.full_screen_play_button=d,UI_SystemPanel_For_Application()}),e.helper_visibility_behavior!==void 0&&(s.helper_view_behavior=e.helper_visibility_behavior),UC$1.make_pulldown(l,TL("helper_visibility"),[{key:TL("depends_on_flag"),value:"0"},{key:TL("visible_current"),value:"1"},{key:TL("force_visible_current"),value:"2"},{key:TL("hide_all"),value:"3"}],(e.helper_visibility_behavior?e.helper_visibility_behavior:0).toString(),{},d=>{s.helper_view_behavior=e.helper_visibility_behavior=Number(d),s.scene.traverse(u=>{u.helper_visible!==void 0&&(u.helper_visible=!0)}),UI_TreePanel()})}UserDefinedProp(r,e),s.update_user_defined_property_on_system_panel=function(){UserDefinedProp(r,e)};{let a=function(){l.innerHTML="",UC$1.make_toggle(l,TL("time_component"),e.world_time_component,{},d=>{e.world_time_component=d,s.toggle_world_time_component(e.world_time_component)}),UC$1.make_toggle(l,TL("key_frame_view"),e.keyframe_view,{},d=>{e.keyframe_view=d,a()}),UC$1.make_toggle(l,TL("loop"),e.loop,{},d=>{e.loop=d}),UC$1.make_toggle(l,TL("auto_detect_end_time"),e.auto_detect_end_time,{},d=>{e.auto_detect_end_time=d}),UC$1.make_float_box(l,TL("start"),e.keyframe_view?e.start_time*30:e.start_time,{step:e.keyframe_view?1:.01},d=>{e.start_time=e.keyframe_view?d/30:d});const c=UC$1.make_float_box(l,TL("end"),e.keyframe_view?e.end_time*30:e.end_time,{step:e.keyframe_view?1:.01},d=>{e.end_time=e.keyframe_view?d/30:d,e.auto_detect_end_time||(s.animation_world_time_duration=e.end_time)});UC$1.make_toggle(l,TL("no_end_of_time"),e.no_end_time,{},d=>{e.no_end_time=d}),c.modifier.id="system_flags_end_time",UC$1.make_key_value_with_slider(l,TL("playback_rate"),e.playbackRate,{min:.1,max:2,step:.01},d=>{s.playbackRate=e.playbackRate=d}),UC$1.make_float_box(l,TL("delayed_play"),e.auto_play_delay,{},d=>{e.auto_play_delay=d})};const l=UC$1.make_toggle_window(r,{title:T("tabs.system.sequencer"),toggle:!0},c=>{}).holder;e.world_time_component=e.world_time_component??!window.app_mode,e.loop=e.loop==null?!1:e.loop,e.auto_detect_end_time=e.auto_detect_end_time==null?!0:e.auto_detect_end_time,e.start_time=e.start_time==null?0:e.start_time,e.end_time=e.end_time==null?100:e.end_time,e.no_end_time=e.no_end_time??!1,e.playbackRate=e.playbackRate==null?1:e.playbackRate,e.auto_play_delay=e.auto_play_delay==null?0:e.auto_play_delay,e.keyframe_view=e.keyframe_view==!0,s.toggle_world_time_component(e.world_time_component),s.playbackRate=e.playbackRate,e.auto_detect_end_time||(s.animation_world_time_duration=e.end_time),a(),e.auto_play&&s.draw_thread_after_runner.push(()=>{setTimeout(()=>{s.play_button.click()},e.auto_play_delay*1e3)})}}{const o=s.base_renderer;{const l=s.base_renderer;{const a=document.createElement("div");UC$1.make_separator(a,{close:!1,sub:!0,title:T("tabs.system.browser")});{let c=0,d,u;for(u in localStorage)localStorage.hasOwnProperty(u)&&(d=(localStorage[u].length+u.length)*2,c+=d);UC$1.make_key_value2(a,"LocalStorage",(c/1024).toFixed(2)+"KB",{value_css:{width:"100px"}});const f=await navigator.storage?.estimate?.();f&&(UC$1.make_key_value2(a,"Storage usage",(f.usage/1024/1024).toFixed(2)+"MB",{value_css:{width:"100px"}}),UC$1.make_key_value2(a,"Storage quota",(f.quota/1024/1024).toFixed(2)+"MB",{value_css:{width:"100px"}})),navigator.appVersion&&UC$1.make_key_value2(a,"Version",navigator.appVersion,{value_css:{width:"100px"}})}UC$1.make_separator(a,{close:!1,sub:!0,title:T("tabs.system.cpu_device")}),navigator.hardwareConcurrency&&UC$1.make_key_value2(a,"CPU Cores",navigator.hardwareConcurrency,{value_css:{width:"100px"}}),navigator.deviceMemory&&UC$1.make_key_value2(a,"LeastMemory",navigator.deviceMemory+"GiB+",{value_css:{width:"100px"}}),performance.memory&&(UC$1.make_key_value2(a,"jsHeapSizeLimit",(performance.memory.jsHeapSizeLimit/1024/1024/1024).toFixed(2)+"GB",{value_css:{width:"100px"}}),UC$1.make_key_value2(a,"totalJSHeapSize",(performance.memory.totalJSHeapSize/1024/1024).toFixed(2)+"MB",{value_css:{width:"100px"}}),UC$1.make_key_value2(a,"usedJSHeapSize",(performance.memory.usedJSHeapSize/1024/1024).toFixed(2)+"MB",{value_css:{width:"100px"}})),r.appendChild(a),a.classList.add("toggle_component")}{let a=document.getElementById("system_panel_hardware_information");a||(a=document.createElement("div"),r.appendChild(a));const c=UC$1.make_button(r,"Hardware Information","Check",{value_css:{width:"80px"}},()=>{c.element.remove(),a.innerHTML="";{UC$1.make_separator(a,{close:!0,height:10,title:"Hardware Information"});const d=document.createElement("div"),u=o.getContext();UC$1.make_separator(d,{close:!1,sub:!0,title:"Vendor"});const f=s.getVideoCardInfo();if(UC$1.make_key_value2(d,"Renderer",f.renderer,{key_css:{minWidth:"40px",maxWidth:"unset",width:"auto"},value_css:{paddingRight:"3px",fontSize:"10px",minWidth:"60%",marginLeft:"auto",maxWidth:"unset",width:"auto",justifyContent:"left"}}),UC$1.make_separator(d,{close:!1,sub:!0,title:"Display"}),UC$1.make_key_value2(d,"Device Pixel Ratio",window.devicePixelRatio,{value_css:{width:"100px"}}),UC$1.make_separator(d,{close:!1,sub:!0,title:"WebGL"}),UC$1.make_key_value2(d,"WebGL2",l.capabilities.isWebGL2,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Multiple Render Targets",l.capabilities.isWebGL2||u.getExtension("WEBGL_draw_buffers")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"gl_FragDepth",l.capabilities.isWebGL2||u.getExtension("EXT_frag_depth")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"UNSIGNED_INT Index",l.capabilities.isWebGL2||u.getExtension("OES_element_index_uint")!=null,{value_css:{width:"100px"}}),UC$1.make_separator(d,{close:!1,sub:!0,title:"Shader Variables"}),UC$1.make_key_value2(d,"Precision",l.capabilities.precision,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Attributes",l.capabilities.maxAttributes,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Fragment Uniforms",l.capabilities.maxFragmentUniforms,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Varyings",l.capabilities.maxVaryings,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Vertex Textures",l.capabilities.maxVertexTextures,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Vertex Uniforms",l.capabilities.maxVertexUniforms,{value_css:{width:"100px"}}),UC$1.make_separator(d,{close:!1,sub:!0,title:"Texture"}),UC$1.make_key_value2(d,"Depth Texture",l.capabilities.isWebGL2||u.getExtension("WEBGL_depth_texture")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Vertex Texture",l.capabilities.vertexTextures,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Half Float Texture",l.capabilities.isWebGL2||u.getExtension("OES_texture_half_float")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Float Texture",l.capabilities.isWebGL2||u.getExtension("OES_texture_float")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Cubemap Size",l.capabilities.maxCubemapSize,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Samples",l.capabilities.maxSamples,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Texture Size",l.capabilities.maxTextureSize,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"Textures",l.capabilities.maxTextures,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"MaxAnisotropy",l.capabilities.getMaxAnisotropy(),{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"VideoTexture",u.getExtension("WEBGL_video_texture")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"EXT_texture_norm16",u.getExtension("EXT_texture_norm16")!=null,{value_css:{width:"100px"}}),UC$1.make_separator(d,{close:!1,sub:!0,title:"Compressed Texture"}),UC$1.make_key_value2(d,"DDS Texture(DXT1/3/5-RGB)",u.getExtension("WEBGL_compressed_texture_s3tc")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"DDS Texture(DXT1/3/5-sRGB)",u.getExtension("WEBGL_compressed_texture_s3tc_srgb")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"RGTC",u.getExtension("EXT_texture_compression_rgtc")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"BC6H/BC7",u.getExtension("EXT_texture_compression_bptc")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"PVRTC(iOS)",u.getExtension("WEBGL_compressed_texture_pvrtc")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"ETC1(Android)",u.getExtension("WEBGL_compressed_texture_etc1")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"ETC(Android)",u.getExtension("WEBGL_compressed_texture_etc")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"ASTC",u.getExtension("WEBGL_compressed_texture_astc")!=null,{value_css:{width:"100px"}}),UC$1.make_separator(d,{close:!1,sub:!0,title:"Buffers"}),UC$1.make_key_value2(d,"OES_draw_buffers_indexed",u.getExtension("OES_draw_buffers_indexed")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"WEBGL_multi_draw",u.getExtension("WEBGL_multi_draw")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"WEBGL_multi_draw_instanced_base_vertex_base_instance",u.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance")!=null,{value_css:{width:"100px"}}),UC$1.make_key_value2(d,"OES_fbo_render_mipmap",u.getExtension("OES_fbo_render_mipmap")!=null,{value_css:{width:"100px"}}),a.appendChild(d),d.classList.add("toggle_component"),window.nodejs){const m=window.nodejs.systeminformation;m.cpu().then(h=>{UC$1.make_separator(d,{close:!0,height:10,title:"CPU"});for(const _ in h){const b=h[_];(typeof b=="string"||typeof b=="number")&&UC$1.make_key_value2(d,_,b,{value_css:{width:"100px"}})}}).catch(h=>console.error(h)),m.mem().then(h=>{UC$1.make_separator(d,{close:!0,height:10,title:"Memory"});for(const _ in h){const b=h[_];(typeof b=="string"||typeof b=="number")&&UC$1.make_key_value2(d,_,b,{value_css:{width:"100px"}})}}).catch(h=>console.error(h)),m.graphics().then(h=>{for(const _ in h.controllers){const b=h.controllers[_];UC$1.make_separator(d,{close:!0,height:10,title:"GPU:"+_});for(const v in b){const w=b[v];(typeof w=="string"||typeof w=="number")&&UC$1.make_key_value2(d,v,w,{value_css:{width:"100px"}})}}for(const _ in h.displays){const b=h.displays[_];UC$1.make_separator(d,{close:!0,height:10,title:"Display:"+_});for(const v in b){const w=b[v];(typeof w=="string"||typeof w=="number")&&UC$1.make_key_value2(d,v,w,{value_css:{width:"100px"}})}}}).catch(h=>console.error(h))}}})}}}i||(r.id="system_panel",r.style.textAlign="left",r.style.width="100%",r.style.outline="1px solid #444",document.getElementById("right_side_panel_tab_system").appendChild(r))}let UserDefinedPropComponent=null;function UserDefinedProp(s,e,i){const r=DMC;e.user_defined=e.user_defined??{},e.user_defined_toggle=e.user_defined_toggle??!0;const o=window.app_mode!=!0;let l="Boolean",a="";const c=document.createElement("div");c.style.cssText="font-size:12px;color:red;width:100%;overflow:hidden;white-space: nowrap;text-overflow: ellipsis";function d(u){u.innerHTML="";const f=document.createElement("div");f.style.cssText="width:95%;margin-left:auto;margin-bottom:20px;border-left:1px solid #258;box-shadow:0px 0px 3px #1A1A1A;";for(const m in e.user_defined){const h=e.user_defined[m],_=h.value,b=h.component_type,v="";b=="String"?UC$1.make_key_value2(f,m+v,_,{value_css:{width:"100px"},close_button:o},(w,y)=>{y?.event=="closed"&&delete e.user_defined[m],h.value=w,d(u),r.user_flag_needs_update=!0}):b=="Number"?UC$1.make_float_box(f,m+v,_,{value_css:{width:"100px"},close_button:o},(w,y)=>{y?.event=="closed"&&delete e.user_defined[m],h.value=w,d(u),r.user_flag_needs_update=!0}):b=="Boolean"?UC$1.make_toggle(f,m+v,_,{value_css:{width:"100px"},close_button:o},(w,y)=>{y?.event=="closed"&&delete e.user_defined[m],h.value=w,d(u),r.user_flag_needs_update=!0}):b=="PullDown"&&UC$1.make_pulldown(f,m+v,h.options,_,{close_button:o},(w,y)=>{y?.event=="closed"&&delete e.user_defined[m],h.value=Number(w),d(u),r.user_flag_needs_update=!0})}u.appendChild(f),o&&(UC$1.make_button(u,TL("new_key"),TL("create"),{value_css:{width:"140px"}},()=>{e.user_defined[a]?(c.innerText="Double key",c.style.display="block"):a==""?(c.innerText="Does not allow empty key.",c.style.display="block"):(c.style.display="none",e.user_defined[a]={value:null,component_type:l},d(u))}),UC$1.make_pulldown(u,TL("type"),[{key:TL("string"),value:"String"},{key:TL("number"),value:"Number"},{key:TL("boolean"),value:"Boolean"}],l,{value_css:{width:"100px"}},m=>{l=m}),UC$1.make_key_value2(u,TL("key"),a,{value_css:{width:"100px"}},m=>{a=m}),u.appendChild(c)),r.scene.traverse(m=>m.onFlagChanged?.())}if(UserDefinedPropComponent==null){let u=s;const f=UC$1.make_toggle_window(u,{title:T("tabs.system.user_defined_flags"),toggle:e.user_defined_toggle},m=>{e.user_defined_toggle=m});if(f.update(),!o){const m=document.getElementById("main_frame");m.offsetHeight;const h=document.createElement("div");h.style.cssText="display:flex;position:absolute;right:0px;top:0px;width:150px;",h.id="user_defined_panel_on_main_screen",m.appendChild(h),u=h,f.element.style.background="#00000088",f.element.style.zIndex="998",function(b,v){if(b==null)return;function w(y){y?.preventDefault?.(),y?.stopPropagation?.()}b.onpointercancel=b.onpointerdown=b.onclick=b.onmouseup=b.onmousedown=b.onmousemove=w,b.onpointerup=v}(h,()=>{})}UserDefinedPropComponent=f}d(UserDefinedPropComponent.holder)}async function UI_DD_Components(){if(document.getElementById("right_side_panel_tab_dd_components_button")==null)return;const s=document.getElementById("dd_components_panel");if(s)return;const e=s||document.createElement("div");DMC.ui.system_panel=s,e.innerHTML="";const i=await ExternalIO$1.create_io("indexeddb",{name:"__clipboard__",purpose:"For D&D Clipboard"});{UC$1.make_separator(e,{close:!1,sub:!0,title:"Script Editor"});const r=document.createElement("div");r.style.cssText="font-size:12px;overflow:hidden;width:calc(100% - 10px);height:80px;margin:4px;border:1px solid #444;border-radius:8px;display:flex;justify-content:center;align-items:center";const o=document.createElement("span");o.style.cssText="text-align:center;color:#888",o.innerHTML="D&D here<br>object/material<br>ddd/js/ts/json",r.appendChild(o),e.appendChild(r),UC$1.make_drag_and_drop(r,{finish:async()=>{}},async a=>{try{let c=a.arrayBuffer?await a.arrayBuffer():await window.cross_file_system.read(a.item);const d=C$2.DPath(a.item),u=d.ext;console.log(d,a);let f="";if(u=="object"||u=="ddd"||u=="material")c&&(f=JSON.stringify(await C$2.s_decode_async(c),null,"  ")),UC$1.open_script_editor(d.path+"-edit",{title:d.name+"-edit",text:f,mode:"json"},async function(m,h){if(m=="save"){const _=h,b=await C$2.s_encode_async(JSON.parse(_));window.cross_file_system.write(d.path,b)}});else if(C$2.is_script_ext(u)){let m="txt";(u=="js"||u=="mjs")&&(m="javascript"),u=="ts"&&(m="typescript"),u=="json"&&(m="json"),f=new TextDecoder().decode(c),UC$1.open_script_editor(d.path+"-edit",{title:d.name+"-edit",text:f,mode:u},async function(h,_){if(h=="save"){const b=_,v=await C$2.s_encode_async(JSON.parse(b));window.nodejs?window.cross_file_system.write(d.path,v):C$2.download(v,d.path)}})}}catch(c){C$2.modal_ok_cancel("Error",c.toString(),{cancel:null})}});let l=0;r.addEventListener("dragenter",a=>{a.preventDefault(),r.style.background="#457",l++}),r.addEventListener("dragend",()=>{l=0,r.style.background="unset"}),r.addEventListener("dragleave",a=>{l--,l===0&&(r.style.background="unset")}),r.addEventListener("drop",a=>{l=0,r.style.background="unset"})}{let a=function(u){const f=document.createElement("div");f.style.cssText="width:calc(100% - 2px - 4px);padding-left:2px;padding-right:2px;height:20px;border-left:2px solid #48F;border-bottom:1px solid #444;font-size:12px;display:flex;align-items:center;opacity:0.5;white-space: nowrap;text-overflow: ellipsis;overflow:hidden",f.innerText=u.name,l.appendChild(f),f.onmouseover=function(h){h.preventDefault(),f.style.opacity="1.0"},f.onmouseleave=function(h){h.preventDefault(),f.style.opacity="0.5"},f.onpointerdown=function(h){f.style.background="#358"};function m(){UC$1.open_script_editor(u.path+"-edit",{url:"./ui/script_editor_monaco.html",title:u.name+"-edit",text:u.data,mode:u.mode??"javascript"},async function(h,_){h=="save"&&(u.script=_,await i.put(u.path,JSON.stringify(u)))})}f.onpointerup=function(h){if(f.style.background="unset",h.button==2){const _=[{key:"Copy",callback:()=>{navigator.clipboard.writeText(u.data)}},{key:"Edit",callback:()=>{m()}}];C$2.popup_menu(h,_,{},async(b,v,w)=>{w.callback()})}else h.button==0&&(f.innerText="Copied",f.style.justifyContent="center",navigator.clipboard.writeText(u.data),setTimeout(()=>{f.innerText=u.name,f.style.justifyContent="left"},1e3))},f.ondblclick=function(h){m()}};UC$1.make_separator(e,{close:!1,sub:!0,title:"Script Peek"});const r=document.createElement("div");r.style.cssText="font-size:12px;overflow:hidden;width:calc(100% - 10px);height:80px;margin:4px;border:1px solid #444;border-radius:8px;display:flex;justify-content:center;align-items:center";const o=document.createElement("span");o.style.cssText="text-align:center;color:#888",o.innerHTML="D&D here<br>object/material<br>ddd",r.appendChild(o),e.appendChild(r);const l=document.createElement("div");e.appendChild(l);async function c(){l.innerHTML="";const u=await i.all({file:!0,directory:!1,data:!0});try{for(const f of u)a(JSON.parse(new TextDecoder().decode(f.buffer)))}catch(f){console.error(f),await i.clear()}}UC$1.make_drag_and_drop(r,{finish:async()=>{}},async u=>{try{const f=await u.arrayBuffer?.(),m=C$2.DPath(u.item),h=m.ext;if(console.log(m,u),h=="object"||h=="ddd"||h=="material"){let b=function(w,y){w.script?.length>0&&y.push({name:m.name+"/"+w.name,uuid:w.uuid,data:w.script,mode:w.script_mode,path:w.uuid+"/"+w.name});for(const M of w.children)b(M,y)};const _=await C$2.s_decode_async(f),v=[];b(_.instance,v);for(const w of v)await i.put(w.path,C$2.to_array_buffer(JSON.stringify(w)));await c()}else C$2.is_script_ext(h)}catch(f){C$2.modal_ok_cancel("Error",f.toString(),{cancel:null})}}),await c(),UC$1.make_button(e,"","Clear",{},async()=>{await i.clear(),await c()});let d=0;r.addEventListener("dragenter",u=>{u.preventDefault(),r.style.background="#457",d++}),r.addEventListener("dragend",()=>{d=0,r.style.background="unset"}),r.addEventListener("dragleave",u=>{d--,d===0&&(r.style.background="unset")}),r.addEventListener("drop",u=>{d=0,r.style.background="unset"})}{UC$1.make_separator(e,{close:!1,sub:!0,title:"Object Board"});const r=document.createElement("div");r.style.cssText="font-size:12px;overflow:hidden;width:calc(100% - 10px);height:80px;margin:4px;border:1px solid #444;border-radius:8px;display:flex;justify-content:center;align-items:center";const o=document.createElement("span");o.style.cssText="text-align:center;color:#888",o.innerHTML="D&D here<br>object/material<br>ddd",r.appendChild(o),e.appendChild(r);const l=document.createElement("div");e.appendChild(l);async function a(){l.innerHTML="";const c=JSON.parse(await __storage__.editor.get("object_board","{}"));for(const d in c){const f=c[d].name,m=document.createElement("button"),h=document.createElement("button");h.style.cssText="width:20px;height:20px;font-size:12px;display:flex;align-items:center;opacity:0.5;white-space: nowrap;text-overflow: ellipsis;overflow:hidden",h.innerText="X",h.onclick=async()=>{const b=`object_board@${d}`;delete c[d],await __storage__.editor.set("object_board",JSON.stringify(c)),await __storage__.editor.delete(b),a()},m.style.cssText="width:calc(100% - 2px - 20px);height:20px;font-size:12px;display:flex;align-items:center;opacity:0.5;white-space: nowrap;text-overflow: ellipsis;overflow:hidden",m.innerText=f,m.onclick=async()=>{const b=`object_board@${d}`,v=JSON.parse(await __storage__.editor.get(b));Builder3D.load_from_j_object(v.instance)};const _=document.createElement("div");_.style.cssText="display:flex;align-items:center",_.appendChild(m),_.appendChild(h),l.appendChild(_)}}a(),DMC.addEventListener("change@object_board",async(c,d)=>{a()})}s||(e.id="dd_components_panel",e.style.textAlign="left",e.style.width="100%",e.style.outline="1px solid #444",document.getElementById("right_side_panel_tab_dd_components").appendChild(e))}const TOOL_TITLE="Geometry Controller",PLUGIN_KEY="geometry_controller",SCRIPT_BASE_PATH="ddd/ui/";function br(){const s=document.createElement("div");return s.style.width="100%",s.style.height="5px",s.style.clear="both",s}function make_icon(s,e={}){const i=document.createElement("button");if(i.classList.add("tooltip"),i.style.display="block",i.style.float="right",i.style.position="relative",i.style.width="28px",i.style.height="28px",i.style.margin="1px",s instanceof HTMLImageElement)s.style.display="inline-block",s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style.width=s.style.height="20px",s.style.margin="0px",s.style.padding="0px",s.style.objectFit="fill",i.style.padding="0px",i.appendChild(s);else{const r=document.createElement("i");r.classList.add(...`${s}`.split(" ")),r.style.fontSize="18px",e.color&&(r.style.color=e.color),i.appendChild(r)}if(e.overlay_text?.length>0){const r=document.createElement("span");r.classList.add("tool_overlay_text"),r.innerText=e.overlay_text,i.appendChild(r)}if(e.desc){const r=document.createElement("span");r.classList.add("tooltiptext"),r.innerText=e.desc,i.appendChild(r)}return e.callback&&(i.onclick=e.callback),i}async function LeftPanel(){const s=SCRIPT_BASE_PATH,e=document.getElementById("__editor_left_tool_panel__");if(!e||window.app_mode)return;e.innerHTML="";const i=JSON.parse(await __storage__.editor.get("geometry_controller_flags","{}"));function r(){__storage__.editor.set("geometry_controller_flags",JSON.stringify(i))}{{{const l=UC$1.make_toggle_window(e,{title:"Lights",toggle:i.light_window??!0},a=>{i.light_window=a,r(),calculate_coordinates_of_tips()}).holder;l.style.textAlign="center";{const a="Light Probe";l.appendChild(make_icon("bi bi-sun",{desc:a,overlay_text:"Lp",color:"#DB0",callback:c=>{generate_preset(a)}}))}{const a="Rect Area Light";l.appendChild(make_icon("bi bi-square-half",{desc:a,overlay_text:"Rct",color:"#DB0",callback:c=>{generate_preset(a)}}))}{const a="Hemisphere Light";l.appendChild(make_icon("bi bi-circle-half",{desc:a,overlay_text:"Hem",color:"#FB0",callback:c=>{generate_preset(a)}}))}{const a="Ambient Light";l.appendChild(make_icon("bi bi-lamp-fill",{desc:a,overlay_text:"Amb",color:"#F90",callback:c=>{generate_preset(a)}}))}{const a="Point Light";l.appendChild(make_icon("bi bi-lightbulb-fill",{desc:a,overlay_text:"Pnt",color:"#DB0",callback:c=>{generate_preset(a)}}))}{const a="Spot Light";l.appendChild(make_icon("bi bi-triangle-fill",{desc:a,overlay_text:"Spt",color:"#DA0",callback:c=>{generate_preset(a)}}))}{const a="Directional Light";l.appendChild(make_icon("bi bi-sunrise-fill",{desc:a,overlay_text:"Dir",color:"#DD0",callback:c=>{generate_preset(a)}}))}}e.appendChild(br());{const l=UC$1.make_toggle_window(e,{title:"Envs",toggle:i.env_window??!0},a=>{i.env_window=a,r(),calculate_coordinates_of_tips()}).holder;l.style.textAlign="center";{const a="Plane Floor";l.appendChild(make_icon("bi bi-square-fill",{desc:a,overlay_text:"Pln",color:"gray",callback:c=>{generate_preset(a)}}))}{const a="Grid Floor";l.appendChild(make_icon("bi bi-border",{desc:a,overlay_text:"Rc",color:"gray",callback:c=>{generate_preset(a)}}))}{const a="Polar Floor";l.appendChild(make_icon("bi bi-circle",{desc:a,overlay_text:"Pol",color:"gray",callback:c=>{generate_preset(a)}}))}window.external_io?.driver;{const a="Wood Floor";l.appendChild(make_icon("bi bi-border-outer",{desc:a,overlay_text:"Wd",color:"#A70",callback:c=>{generate_preset(a)}}))}{const a="Water Floor";l.appendChild(make_icon("bi bi-water",{desc:a,overlay_text:"Wt",color:"#07F",callback:async c=>{generate_preset(a)}}))}{const a="Water Floor2";l.appendChild(make_icon("bi bi-water",{desc:a,overlay_text:"Wt2",color:"#07F",callback:async c=>{generate_preset(a)}}))}{const a="Sky";l.appendChild(make_icon("bi bi-cloud-sun-fill",{desc:a,overlay_text:"Sk",color:"#ACF",callback:c=>{generate_preset(a)}}))}{const a="HDRI Backdrop";l.appendChild(make_icon("bi bi-dash-circle",{desc:a,overlay_text:"HDR",color:"#FCA",callback:c=>{generate_preset(a)}}))}}e.appendChild(br());{const l=UC$1.make_toggle_window(e,{title:"Primitives",toggle:i.primitive_window??!0},a=>{i.primitive_window=a,r(),calculate_coordinates_of_tips()}).holder;l.style.textAlign="center";{const a="Object3D";l.appendChild(make_icon("bi bi-diamond-half",{desc:a,overlay_text:"Obj",color:"#A80",callback:c=>{generate_preset(a)}}))}{const a="Group";l.appendChild(make_icon("bi bi-diagram-3-fill",{desc:a,overlay_text:"Grp",color:"#0AF",callback:c=>{generate_preset(a)}}))}{const a="Mesh";l.appendChild(make_icon("bi bi-bounding-box-circles",{desc:a,overlay_text:"Msh",color:"#F80",callback:c=>{generate_preset(a)}}))}l.appendChild(br());{const a="Box";l.appendChild(make_icon("bi bi-box",{desc:a,overlay_text:"Box",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Sphere";l.appendChild(make_icon("bi bi-circle-fill",{desc:a,overlay_text:"Sph",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Circle";l.appendChild(make_icon("bi bi-circle",{desc:a,overlay_text:"Cir",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Cone";l.appendChild(make_icon("bi bi-cone",{desc:a,overlay_text:"Con",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Cylinder";l.appendChild(make_icon("bi bi-server",{desc:a,overlay_text:"Cyl",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Plane";l.appendChild(make_icon("bi bi-square-fill",{desc:a,overlay_text:"Sqr",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Plane Mirror";l.appendChild(make_icon("bi bi-slash-square",{desc:a,overlay_text:"Mr",color:"#AAA",callback:c=>{generate_preset(a)}}))}{const a="Vector Text";l.appendChild(make_icon("bi bi-file-font",{desc:a,overlay_text:"VTx",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Sprite Text";l.appendChild(make_icon("bi bi-file-font",{desc:a,overlay_text:"STx",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Billboard Text";l.appendChild(make_icon("bi bi-file-font",{desc:a,overlay_text:"BTx",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Plane Text";l.appendChild(make_icon("bi bi-file-font",{desc:a,overlay_text:"PTx",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Exit VR";l.appendChild(make_icon("bi bi-power",{desc:a,overlay_text:"VR",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Spectrum A";l.appendChild(make_icon("bi bi-bar-chart-fill",{desc:a,overlay_text:"SpA",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Spectrum B";l.appendChild(make_icon("bi bi-bar-chart-fill",{desc:a,overlay_text:"SpB",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Sprite";l.appendChild(make_icon("bi bi-image",{desc:a,overlay_text:"Spr",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Heart";l.appendChild(make_icon("bi bi-heart",{desc:a,overlay_text:"Hrt",color:"#F80",callback:c=>{generate_preset(a)}}))}{const a="Particle A";l.appendChild(make_icon("bi bi-snow",{desc:a,overlay_text:"PcA",color:"#F80",callback:c=>{generate_preset(a)}}))}}e.appendChild(br());{const l=UC$1.make_toggle_window(e,{title:"Cameras",toggle:i.camera_window??!0},a=>{i.camera_window=a,r(),calculate_coordinates_of_tips()}).holder;l.style.textAlign="center";{const a="Orbit Camera";l.appendChild(make_icon("bi bi-camera-video-fill",{desc:a,overlay_text:"Obt",color:"#4A4",callback:c=>{generate_preset(a)}}))}{const a="Ortho Camera";l.appendChild(make_icon("bi bi-camera-video-fill",{desc:a,overlay_text:"Ort",color:"#4A4",callback:c=>{generate_preset(a)}}))}{const a="Orbit Ortho Camera";l.appendChild(make_icon("bi bi-camera-video-fill",{desc:a,overlay_text:"ObOr",color:"#4A4",callback:c=>{generate_preset(a)}}))}{const a="Perspective Camera";l.appendChild(make_icon("bi bi-camera-video-fill",{desc:a,overlay_text:"Per",color:"#4A4",callback:c=>{generate_preset(a)}}))}}e.appendChild(br());{const l=UC$1.make_toggle_window(e,{title:"Etc",toggle:i.ext_window??!0},u=>{i.ext_window=u,r(),calculate_coordinates_of_tips()}).holder;l.style.textAlign="center";async function a(u,f,m,h,_,b,v,w){const y=await Builder3D.build_by_file_path(u);y.animations?.length>0&&(y.setActions(y),y.setCurrentAction(0)),y.position.set(f,m,h);const M=Math.PI/180;return y.rotation.set(M*_,M*b,M*v),y.scale.setScalar(w),DMC.scene.add(y),DMC.current.object=y,DMC.dispatchEvent("change@scene",{}),y}async function c(u,f,m,h,_,b,v,w,y,M,S,D=()=>{}){M=await window.cross_file_system.resolve(window.nodejs&&window.external_io==null?"public/ddd/"+M:M);const k=C.DPath(M).ext;let O=null;k=="pmx"?(O=document.createElement("img"),O.src=s+"../system_assets/icons/pmx.backup.png"):k=="gltf"||k=="glb"?(O=document.createElement("img"),O.src=s+"../system_assets/icons/gltf.png"):k=="fbx"?(O=document.createElement("img"),O.src=s+"../system_assets/icons/fbx.png"):k=="dae"?(O=document.createElement("img"),O.src=s+"../system_assets/icons/dae.png"):k=="3ds"&&(O=document.createElement("img"),O.src=s+"../system_assets/icons/3ds.svg");{const L=w;l.appendChild(make_icon(O||"bi bi-male",{desc:L,overlay_text:y,color:"#888",callback:async P=>{window.external_io?await window.PrepareFromSystemResource(M):(M=M.replace(/\\/g,"/"),M=M.replace(/ddd\//,"")),await D();const N=await a(M,u,f,m,h,_,b,v);S&&S(N)}}))}}const d=window.external_io?.driver;c(0,0,0,0,0,0,1,"Puppet","Pupp","ddd/system_assets/presets/puppet/puppet.pmx",u=>{},async()=>{window.external_io&&await window.PrepareFromSystemResource("ddd/system_assets/presets/puppet/moku3.jpg")}),c(0,0,0,0,0,0,.1,"Samba Dancing","Smb","ddd/models/fbx/Samba Dancing.fbx",u=>{u.setActionMode("Single");for(const f of u.children)if(f.material?.name=="Alpha_Body_MAT"){let m=f.material;m.color.set(8947848),m.roughness=.2,m.metalness=.4,m=f.material_overwrite,m.color.set(8947848),m.roughness=.2,m.metalness=.4}}),c(0,0,0,0,180,0,10,"Soldier","Sdlr","ddd/models/gltf/Soldier.glb",u=>{u.setActionMode("Single")}),c(0,0,0,0,180,0,10,"CollisionWorld","Wld","ddd/models/gltf/collision-world.glb",u=>{}),d=="memory"||d=="indexeddb"||(c(0,0,0,0,0,0,10,"SheenChair","Chair","ddd/models/gltf/SheenChair.glb"),c(0,15,0,0,0,0,5,"Damaged Helmet","Helm","ddd/models/gltf/DamagedHelmet/glTF/DamagedHelmet.gltf"),c(0,15,0,0,0,0,1,"Clearcoat Test","Coat","ddd/models/gltf/ClearcoatTest/ClearcoatTest.glb"))}e.appendChild(br()),e.appendChild(br())}calculate_coordinates_of_tips()}}function RegisterTransformController(){let s=0,e=0,i=0,r=0,o=null;const l=DMC,a=l.transform_controls,c=new THREE.Vector3,d=function(u,f){if(l.playing_state==l.PLAYING_STATE.PLAYING){a.detach();return}if(u=="mousedown")s=f.x,e=f.y,i=0;else if(u=="mousemove"){const m=s-f.x,h=e-f.y;i+=Math.sqrt(m*m+h*h),s=f.x,e=f.y}else if(u=="mouseup"){const m=s-f.x,h=e-f.y;if(i+=Math.sqrt(m*m+h*h),i<=2){let z=function(K){K.x=(K.x+1)*w/2,K.y=-(K.y-1)*y/2,K.z=0};f.preventDefault();const _=l.canvas,b=l.current.camera||l.camera,v=_.getBoundingClientRect(),w=v.width,y=v.height,M=f.clientX-v.left,S=f.clientY-v.top,D=M/w*2-1,k=-(S/y)*2+1,O=new THREE.Vector3(D,k,.5),L=new THREE.Raycaster;L.setFromCamera(O,b);const P=l.transform_controls.filter("valid");let N=L.intersectObjects(P);N.length>0?(N=N.filter(K=>{const Z=K.object;if(Z.geometry?.boundingSphere){const V=Z.geometry.boundingSphere,H=Z.matrixWorld;let Y=0;return c.set(-V.radius,0,0),c.add(V.center),c.applyMatrix4(H),c.project(b),z(c),c.x>0&&c.x<=w&&Y++,c.set(V.radius,0,0),c.add(V.center),c.applyMatrix4(H),c.project(b),z(c),c.x>0&&c.x<=w&&Y++,Y>=2||(c.set(0,V.radius,0),c.add(V.center),c.applyMatrix4(H),c.project(b),z(c),c.y>0&&c.y<=y&&Y++,Y>=2)||(c.set(0,-V.radius,0),c.add(V.center),c.applyMatrix4(H),c.project(b),z(c),c.y>0&&c.y<=y&&Y++,Y>=2)}return!1}),N.length>0?(performance.now()-r<500&&o==N[0].object&&a.focus_object(o.uuid),o=N[0].object,a.select_object(N[0].object),r=performance.now()):o=null):o=null}i=0}l.request_display(!1)};Handlers[TOOL_TITLE]=d}function UnregisterTransformController(){delete Handlers[TOOL_TITLE]}const keymap=function(s){const e=DMC,i=e.scene,r=e.xr?.isEntered,o=i.isXRMode;if(r){s.type=="keydown"?e.xr.onDocumentKeyDown(s):e.xr.onDocumentKeyUp(s);return}if(s.type=="keydown"){const l=e.current.camera||e.camera;if(s.preventDefault(),s.code=="KeyZ"&&(s.metaKey||s.ctrlKey)&&s.shiftKey)window.OperationStack.redo();else if(s.code=="KeyZ"&&(s.metaKey||s.ctrlKey))window.OperationStack.undo();else if(s.code=="KeyF"&&(s.ctrlKey||s.metaKey))e.toggle_fullscreen();else if(s.code=="KeyP"&&(s.ctrlKey||s.metaKey))asset_browser();else if(s.code=="KeyP")document.getElementById("play_button").click();else if(s.code=="Backspace")remove_selected_objects_with_ui(),s.preventDefault(),s.stopPropagation(),console.log(s);else if(s.code=="Escape"){e.current.object=null,window.file_browser?.deselect_all&&window.file_browser.deselect_all(),DMC?.transform_controls&&e.transform_controls.detach(),e.dispatchEvent("change@tree",{update_tree:!1,update_panel:!0});const a=document.querySelectorAll(".tree_component_item");if(a)for(let c=0;c<a.length;c++)a[c].classList.remove("active");s.preventDefault(),s.stopPropagation()}else if(s.code=="KeyA"){let a=1;a=s.shiftKey?2:a,o&&(a*=.1);const c=new THREE.Vector3(0,1,0),d=new THREE.Vector3,u=new THREE.Vector3;d.copy(l.position),d.sub(l.target),d.normalize(),u.crossVectors(c,d),u.multiplyScalar(a),l.position.sub(u),l.target.sub(u)}else if(s.code=="KeyD"){let a=1;a=s.shiftKey?2:a,o&&(a*=.1);const c=new THREE.Vector3(0,1,0),d=new THREE.Vector3,u=new THREE.Vector3;d.copy(l.position),d.sub(l.target),d.normalize(),u.crossVectors(c,d),u.multiplyScalar(a),l.position.add(u),l.target.add(u)}else if(s.code=="KeyR"){let a=1;a=s.shiftKey?2:a,o&&(a*=.1);const c=new THREE.Vector3(0,1,0),d=new THREE.Vector3,u=new THREE.Vector3;d.copy(l.position),d.sub(l.target),d.normalize(),u.crossVectors(c,d),u.crossVectors(d,u),u.multiplyScalar(a),l.position.add(u),l.target.add(u)}else if(s.code=="KeyF"){let a=1;a=s.shiftKey?2:a,o&&(a*=.1);const c=new THREE.Vector3(0,1,0),d=new THREE.Vector3,u=new THREE.Vector3;d.copy(l.position),d.sub(l.target),d.normalize(),u.crossVectors(c,d),u.crossVectors(d,u),u.multiplyScalar(a),l.position.sub(u),l.target.sub(u)}else if(s.code=="KeyW"){let a=1;a=s.shiftKey?2:a,o&&(a*=.1);const c=new THREE.Vector3;c.copy(l.position),c.sub(l.target),c.normalize(),c.multiplyScalar(a),l.position.sub(c),l.target.sub(c)}else if(s.code=="KeyS"){let a=1;a=s.shiftKey?2:a,o&&(a*=.1);const c=new THREE.Vector3;c.copy(l.position),c.sub(l.target),c.normalize(),c.multiplyScalar(a),l.position.add(c),l.target.add(c)}else if(s.code=="KeyQ"){let a=1;a=s.shiftKey?2:a;const c=new THREE.Vector3,d=new THREE.Vector3(0,1,0);c.copy(l.target),c.sub(l.position),c.applyAxisAngle(d,Math.PI/180*3*a),l.target.copy(l.position),l.target.add(c)}else if(s.code=="KeyE"){let a=1;a=s.shiftKey?2:a;const c=new THREE.Vector3,d=new THREE.Vector3(0,1,0);c.copy(l.target),c.sub(l.position),c.applyAxisAngle(d,-Math.PI/180*3*a),l.target.copy(l.position),l.target.add(c)}else s.code=="ArrowLeft"?e.delta_queue.push(-2):s.code=="ArrowRight"&&e.delta_queue.push(2)}else s.type=="keyup"&&(s.code=="Backspace"?(s.preventDefault(),s.stopPropagation(),console.log(s)):s.code=="Space"&&e.scene.isXRMode&&e.xr.button&&e.xr.button.click())},geometry_controller={title:TOOL_TITLE,key:PLUGIN_KEY,on_load:async function(){RegisterTransformController(),LeftPanel()},on_unload:async function(){UnregisterTransformController()},on_change:async function(s){s==this.key&&(changeHandler(TOOL_TITLE),LeftPanel())},onkeydown:async function(s){keymap(s)},onkeyup:async function(s){keymap(s)}},file_browser_shortcut_key_history={keys:"",time:0},GlobalKeymaps={file_browser_directory_window:async function(s){if(s.type=="keydown"){if(s.code=="Backspace"&&(s.ctrlKey||s.metaKey))window.file_browser.delete_from("directory");else if(s.code=="KeyC"&&(s.ctrlKey||s.metaKey)){const i=window.file_browser.get_selected_items_from("directory").map(r=>({is_directory:r.dataset.is_directory=="true",absolute_path:r.dataset.absolute_path}));await navigator.clipboard.writeText(JSON.stringify({file_browser:!0,contents:i}))}else s.code=="KeyV"&&(s.ctrlKey||s.metaKey)||(s.code=="KeyF"&&(s.ctrlKey||s.metaKey)?DMC.toggle_fullscreen():s.code=="KeyP"&&(s.ctrlKey||s.metaKey)?UI.asset_browser():s.code=="Backspace"?window.file_browser.back_directory_button():s.code=="Delete"?window.file_browser.delete_from("directory"):s.code=="F2"||s.code=="Enter"?window.file_browser.focus_input("directory"):s.code.indexOf("Arrow")>=0?window.file_browser.arrow_key("directory",s):s.code.indexOf("Key")==0);s.preventDefault()}},file_browser_preview_window:async function(s){if(s.type=="keydown"){if(s.code=="Backspace"&&(s.ctrlKey||s.metaKey))window.file_browser.delete_from("preview");else if(s.code=="KeyC"&&(s.ctrlKey||s.metaKey)){const i=window.file_browser.get_selected_items_from("preview").map(r=>({is_directory:r.dataset.is_directory=="true",absolute_path:r.dataset.absolute_path}));await navigator.clipboard.writeText(JSON.stringify({file_browser:!0,contents:i}))}else if(s.code=="KeyV"&&(s.ctrlKey||s.metaKey)){let e=null,i="";try{i=await navigator.clipboard.readText(),console.log(i);try{e=JSON.parse(i)}catch(r){console.log(r),C.modal_ok("Error",`Invalid copy and paste.<br>"${i}"<br>Please use drag and drop instead of the clipboard to import files.`)}if(e&&e.file_browser)for(const r of e.contents)window.file_browser.copy_file_to_active_window(r.absolute_path,r.is_directory)}catch(r){console.log(r)}}else if(!(s.code=="KeyF"&&(s.ctrlKey||s.metaKey))){if(s.code=="KeyP"&&(s.ctrlKey||s.metaKey))UI.asset_browser();else if(s.code=="KeyA"&&(s.ctrlKey||s.metaKey))window.file_browser.select_all("preview");else if(s.code=="KeyR"&&(s.ctrlKey||s.metaKey))window.file_browser.update(!1,!0);else if(s.code=="Backspace")window.file_browser.back_directory_button();else if(s.code=="Delete")window.file_browser.delete_from("preview");else if(s.code=="F2")window.file_browser.focus_input("preview");else if(s.code=="Enter")window.file_browser.open();else if(s.code.indexOf("Arrow")>=0)window.file_browser.arrow_key("preview",s),console.log("@Arrow");else if(s.code.indexOf("Key")==0){Date.now()-file_browser_shortcut_key_history.time>1e3&&(file_browser_shortcut_key_history.time=Date.now(),file_browser_shortcut_key_history.keys=""),file_browser_shortcut_key_history.keys+=s.code[3];const i=window.file_browser.explore_preview_dom.querySelectorAll(".block");for(let r=0;r<i.length;r++){const o=i[r];if(o.querySelector(".file_browser_right_panel_item_path").innerText.toLowerCase().indexOf(file_browser_shortcut_key_history.keys.toLowerCase())==0){let c=function(d,u){const f=document.createEvent("MouseEvents");f.initEvent(u,!0,!0),d.dispatchEvent(f)};const a=o;if(a){c(a,"mousedown"),setTimeout(function(){c(a,"mouseup")},100),a.scrollIntoView({});break}}}}}s.preventDefault()}else s.type=="keyup"&&(s.code=="Space"?window.file_browser.is_preview?(window.file_browser.is_preview=!1,C.close_modal_image(),C.close_modal_confirmation()):(window.file_browser.is_preview=!0,window.file_browser.preview()):s.code.indexOf("Arrow")>=0?window.file_browser.is_preview&&window.file_browser.preview():(window.file_browser.is_preview=!1,C.close_modal_image()),s.preventDefault())},"3d_object_tree":function(s){if(!window.app_mode)if(s.type=="keydown")if(s.code=="KeyO"&&(s.ctrlKey||s.metaKey)){const e=DMC.current.object?.getDDDProperties?.()?.source_file;e&&window.nodejs.open_in_finder(e)}else s.code=="KeyF"&&(s.ctrlKey||s.metaKey)?DMC.toggle_fullscreen():s.code=="KeyP"&&(s.ctrlKey||s.metaKey)?UI.asset_browser():s.code=="KeyT"?(UI.open_script_editor_for_object(),s.preventDefault()):s.code=="KeyP"?(document.getElementById("play_button").click(),s.preventDefault()):s.code=="Space"?(DMC.xr.button&&DMC.xr.button.click(),s.preventDefault()):s.code=="ArrowLeft"?window.UI_Tree.close_node():s.code=="ArrowRight"?window.UI_Tree.open_node():s.code=="ArrowUp"?window.UI_Tree.focus_previous(s.shiftKey):s.code=="ArrowDown"?window.UI_Tree.focus_next(s.shiftKey):s.code=="Backspace"&&(UI.remove_selected_objects_with_ui(),s.preventDefault(),s.stopPropagation());else s.type=="keyup"&&s.code=="Backspace"&&(s.preventDefault(),s.stopPropagation())},main:{},local_search_window:async function(s){if(s.type=="keydown"){const e=document.getElementById("local_search_audio");if(e&&e.remove(),s.code=="KeyF"&&(s.ctrlKey||s.metaKey))document.getElementById("__editor_search_box_on_file_browser_for_local__")?.focus();else if(s.code=="KeyP"&&(s.ctrlKey||s.metaKey))UI.asset_browser();else if(s.code=="KeyP")document.getElementById("play_button").click(),s.preventDefault();else if(s.code=="Space"){const r=document.getElementById("__editor_search_data_list_on_file_browser_for_local__").querySelector(".active")?.dataset?.absolute_path;if(window.external_io){if(window.test_sounds.length>0){for(const o of window.test_sounds)try{o.stop()}catch{}window.test_sounds=[]}else if(r){for(const c of window.test_sounds)try{c.stop()}catch{}window.test_sounds=[];const o=new Audio$1(DMC.sound_listener);o.setBuffer(await Builder3D.ETC.sound(r)),window.test_sounds.push(o);const a=DMC.ui.system_flags?.system_volume??.8;o.setVolume(Math.pow(a,2)),o.play()}}else{const o=C.file_type(r);if(e==null&&r&&o=="sound"){const l=document.createElement("audio");l.id="local_search_audio",l.autoplay=!0,l.controls="controls",l.style.cssText="width:300px;height:50px;position:fixed;border:0px solid #444;border-radius:0px;z-index:2";const a=document.createElement("source");a.src=r,l.appendChild(a);const c=document.getElementById("main_frame").getBoundingClientRect(),d=c.left,u=c.bottom;l.style.left=`${d+128+10}px`,l.style.top=`${u-70}px`,document.body.appendChild(l)}}s.preventDefault()}else if(s.code=="Backspace")s.preventDefault(),s.stopPropagation(),console.log(s);else if(s.code=="ArrowUp"){s.preventDefault(),s.stopPropagation();const i=document.getElementById("__editor_search_data_list_on_file_browser_for_local__"),r=i.querySelectorAll(".hit"),o=i.querySelector(".active");if(o){for(let l=r.length-1;l>=0;l--)if(r[l].isEqualNode(o)){const a=r[l-1];a&&(o.classList.remove("active"),a.classList.add("active"),await __storage__.editor_permanent.set("local_search_focused_path",a.dataset.absolute_path),a.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}}}else if(s.code=="ArrowDown"){s.preventDefault(),s.stopPropagation();const i=document.getElementById("__editor_search_data_list_on_file_browser_for_local__"),r=i.querySelectorAll(".hit"),o=i.querySelector(".active");if(o){for(let l=0;l<r.length;l++)if(r[l].isEqualNode(o)){const a=r[l+1];a&&(o.classList.remove("active"),a.classList.add("active"),await __storage__.editor_permanent.set("local_search_focused_path",a.dataset.absolute_path),a.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}}}else if(s.code=="Enter"&&s.isComposing==!1)if(document.activeElement instanceof HTMLInputElement)setTimeout(()=>{document.activeElement.blur()},0),document.getElementById("__editor_search_data_list_on_file_browser_for_local__");else{const r=document.getElementById("__editor_search_data_list_on_file_browser_for_local__").querySelector(".active");if(r){const o=r.dataset.absolute_path;UIL.load_files([o])}}}else s.type=="keyup"&&s.code=="Backspace"&&(s.preventDefault(),s.stopPropagation(),console.log(s))},undefined:function(s){const e=document.activeElement;if(e&&e.classList.contains("__material_property__"))if(s.code=="KeyA"&&(s.ctrlKey||s.metaKey)){const i=document.getElementById("__material_select_all_button__");if(i){i.click(),s.preventDefault();return}}else s.code=="KeyW"&&(s.ctrlKey||s.metaKey);s.type=="keydown"?s.code=="KeyF"&&(s.ctrlKey||s.metaKey)?DMC.toggle_fullscreen():s.code=="KeyP"&&(s.ctrlKey||s.metaKey)?UI.asset_browser():s.code=="KeyT"&&(s.ctrlKey||s.metaKey)?(UI.open_script_editor_for_object(),s.preventDefault()):s.code=="KeyP"?(document.getElementById("play_button").click(),s.preventDefault()):s.code=="Space"?(DMC.xr.button&&DMC.xr.button.click(),s.preventDefault()):s.code=="Backspace"&&(UI.remove_selected_objects_with_ui(),s.preventDefault(),s.stopPropagation(),console.log(s)):s.type=="keyup"&&s.code=="Backspace"&&(s.preventDefault(),s.stopPropagation(),console.log(s))}};var debug$2=window.debug;const UPI=Math.PI/180,TMP={attach_vec3:new Vector3,attach_euler:new Euler,attach_quat:new Quaternion};class ScopedFunction{constructor(e,i,r){const o=this;if(o.enabled=e,o.callback=i,r)for(const l in r)o[l]=r[l]}}class StateSmoother{constructor(e){this.bound=e,this.current=new THREE$1[e.type],this.next=new THREE$1[e.type],this.props={},this._interpolation_=null;const i=this,r=this.current;for(const o in r)typeof r[o]=="number"?this.props[o]={interpolate:l=>{const a=i.next[o]-i.current[o];e[o]=i.current[o]+a*l}}:typeof r[o]=="object"&&(r[o]instanceof Vector3?i.props[o]={interpolate:l=>{e[o].copy(i.current[o]),e[o].lerp(i.next[o],l)}}:r[o]instanceof Quaternion?i.props[o]={interpolate:l=>{e[o].copy(i.current[o]),e[o].slerp(i.next[o],l)}}:r[o]instanceof Color?i.props[o]={interpolate:l=>{e[o].copy(i.current[o]),e[o].lerp(i.next[o],l)}}:r[o]instanceof Vector2&&(i.props[o]={interpolate:l=>{e[o].copy(i.current[o]),e[o].lerp(i.next[o],l)}}))}linear(e,i,r=1){e==null?this._copy_(this.current,this.bound):e(this.current),i(this.next);let o=0;this._interpolation_=function(l){o+=l;const a=o/r;return a>1?1:a}}cubic_spline(e,i,r=1,o={p2:0,p3:1}){e==null?this._copy_(this.current,this.bound):e(this.current),i(this.next);let l=0;const a=0,c=o.p2,d=o.p3,u=1;this._interpolation_=function(f){l+=f;const m=l/r;let h=0;const _=1-m,b=m*m,v=b*m,w=_*_,y=w*_;return h+=3*d*b*_,h+=3*c*m*w,h+=a*y,h+=u*v,m>=1?1:h}}fixed_sigmoid(e,i,r=1){e==null?this._copy_(this.current,this.bound):e(this.current),i(this.next);let o=0;this._interpolation_=function(l){o+=l;const a=o/r,c=1/(.94127742+Math.exp(-(a-.5)*7))-.02936277;return c<1e-6?0:c>.99999?1:c}}momentum(e,i,r=.1){e==null?this._copy_(this.current,this.bound):e(this.current),i(this.next);let o=1;this._interpolation_=function(l){const a=0-o;return o=o+a*(r*(l/.016)),1-o>.999999?1:1-o}}_copy_(e,i){for(const r in e)typeof e[r]=="number"?e[r]=i[r]:typeof e[r]=="object"&&(e[r]instanceof Vector3||e[r]instanceof Quaternion)&&e[r].copy(i[r])}update(e){if(this._interpolation_&&e>1e-5){const i=this._interpolation_(e);for(const r in this.props)this.props[r].interpolate(i);i>=1&&(this._interpolation_=null)}}}class BoneManipulator{constructor(e,i,r=!0,o=!0){i.ext1={position:r?new Vector3:null,quaternion:o?new Quaternion:null},this.wrapper=e,this.bone=i,this.position=i.ext1.position,this.quaternion=i.ext1.quaternion,this.tmp={vec3_1:new Vector3,vec3_2:new Vector3,quat_1:new Quaternion,eu_1:new Euler}}decompose(){return this.wrapper.decompose(this.bone)}rotate(e,i,r){this.tmp.eu_1.set(UPI*e,UPI*i,UPI*r),this.bone.ext1.quaternion.setFromEuler(this.tmp.eu_1)}}window.BoneManipulator=BoneManipulator;function SmoothInterpolation(s,e,i){const r=i*i*(3-2*i);return s+(e-s)*r}function random_generator(){const s={};return s.change_timing=5e3,s.tt=0,s.r1=0,s.r2=0,s.get=function(){return s.r1},s.update=function(){const e=performance.now();e-s.tt>s.change_timing&&(s.r1=Math.random(),s.tt=e,s.change_timing=5e3+2500*Math.random()),s.r1=(s.r2-s.r1)*.1},s}function MakeNextChain(s,e,i){return typeof e=="function"?new TimeChain(s,e,i):new StateChain(s,e,i)}class StateChain{constructor(e,i,r){this.key=i,this.time=e,this.next=null,this.scope=r}chain(e,i){const r=MakeNextChain(e,i,this.scope);return this.next=r,r}update(){return this.next&&this.scope.time>this.next.time?(this.next.scope.changeState(this.next.key),this.next):null}}class TimeChain{constructor(e,i,r){this.func=i,this.time=e,this.next=null,this.scope=r}chain(e,i){const r=MakeNextChain(e,i,this.scope);return this.next=r,r}update(){return this.next&&this.scope.time>this.next.time?(this.next.func(),this.next):null}}class ManipulatorUtil{constructor(e,i={}){const r=this;this.o=e,r.NONE=0,r.RANDOM=1,r.TRACK=2,r.HYBRID=3;const o=e.getDDDProperties?.(),l={breath:!1,blink:!1,foot:!1,foot_attach:null,eyes_direction:!1,waver:!1,random_camera:!1};if(o?.type=="pmx"&&e.skeleton?.bones)for(const d of e.skeleton.bones)d.name=="上半身"&&(l.blink=!0,l.breath=!0,l.foot=!0,l.waver=!0,l.eyes_direction=!0);const a=Object.assign(l,i);r.smooth=new StateSmoother(e),r._morph_seq_buffer_={},r._morph_buffer_index_=60;for(const d in this.o.morphTargetDictionary)r._morph_seq_buffer_[d]=new Float32Array(60);r.random_start=Math.random()*1e4,r.functions={breath:new ScopedFunction(a.breath,function(d,u){const f=this,m=f.speed,h=f.coef,_=f.offset,b=r.getMorph("呼吸");if(b!=null&&!f.initialized&&(f.initialized=!0,debug$2&&console.log("Enabled auto breath")),b!=null){const v=.1+.9*(Math.cos(r.random_start+d*.0015*m)*Math.cos(r.random_start+d*.0015*m+.3));r.setMorph("呼吸",v*h+_)}},{coef:.75,offset:-.4,speed:1}),random_camera:new ScopedFunction(a.random_camera,function(d,u){const f=this,m=f.target;e.isCamera&&m&&(f.initialized||(f.initialized=!0,debug$2&&console.log("Enabled auto breath"),f.ave=new Vector3(0,0,1),f.random=new Vector3(0,0,10),f.pre=0,f.total=0),e.getCurrentAction?.()?.index>=0||(f.total+=u,f.ave.lerp(m.position,.01),e.target.copy(f.ave),e.target.y+=5,f.total-f.pre>4&&(f.random.set(30-Math.random()*60,Math.random()*30+3,Math.random()*30+2),e.position.copy(f.random),f.pre=f.total)))},{target:null}),eyes_direction:new ScopedFunction(a.eyes_direction,function(d,u){const f=this,m=f.type,h=f.tracking_speed,_=f.random_angle_coef;if(r.find("両目")){if(this.next_time===void 0){this.next_time=d+Math.random()*1e3,this.rot=new Euler,this.ext1=r.manipulator("両目",!1,!0),this.rot2=new Quaternion,this.rot3=new Quaternion,this.rot4=new Quaternion,this.rot5=new Quaternion,this.default_rot=new Quaternion,this.default_euler=new Euler,this.unit=new Vector3,this.mat4=new Matrix4;let v="";m===r.RANDOM?v="RANDOM":m===r.TRACK?v="TRACK":m===r.HYBRID?v="HYBRID":v="NONE",debug$2&&console.log(`Enabled auto eyes direction TYPE(${v})`)}if(this.default_euler.set(f.dx*UPI,f.dy*UPI,f.dz*UPI),this.default_rot.setFromEuler(this.default_euler),m===r.RANDOM)d-this.next_time>0&&(this.next_time=d+Math.random()*7500,this.rot.set(UPI*_*(.5-Math.random()),UPI*_*(.5-Math.random()),0),this.rot2.setFromEuler(this.rot)),this.ext1.quaternion.copy(this.rot2),this.ext1.quaternion.multiply(this.default_rot);else if(m===r.TRACK){{const v=DMC.current.camera||DMC.camera,[w,y,M]=r.decompose(v),[S,D,k]=this.ext1.decompose();S.sub(w),S.normalize(),this.unit.set(0,0,-1);const O=this.unit.dot(S);this.unit.applyQuaternion(D);const L=this.unit.dot(S);O>.4&&L>.5?(this.rot3.setFromUnitVectors(this.unit,S),this.rot4.slerp(this.rot3,h)):this.rot4.identity()}this.ext1.quaternion.copy(this.rot4)}else if(m===r.HYBRID){d-this.next_time>0&&(this.next_time=d+Math.random()*7500,this.rot.set(UPI*_*(.5-Math.random()),UPI*_*(.5-Math.random()),0),this.rot4.setFromEuler(this.rot),this.rot4.multiply(this.default_rot));{const v=DMC.current.camera||DMC.camera,[w,y,M]=r.decompose(v),[S,D,k]=this.ext1.decompose();S.sub(w),S.normalize(),this.unit.set(0,0,-1),this.unit.normalize();const O=this.unit.dot(S);this.unit.applyQuaternion(D);const L=this.unit.dot(S);O>.3&&L>.4?(this.rot3.setFromUnitVectors(this.unit,S),this.rot4.slerp(this.rot3,h)):(this.rot4.setFromEuler(this.rot),this.rot4.multiply(this.default_rot))}this.ext1.quaternion.copy(this.rot4)}else this.ext1.quaternion.identity()}},{type:r.RANDOM,random_angle_coef:5,tracking_speed:.01,dx:0,dy:0,dz:0}),blink:new ScopedFunction(a.blink,function(d,u){this.next_time===void 0&&(this.next_time=d+Math.random()*1e3,this.queue=[],debug$2&&console.log("Enabled auto blink")),d-this.next_time>0&&(this.next_time=d+Math.random()*7500,this.queue.push(1));const f=this.queue;if(f.length>0)if(f[0]>0){const m=r.getActionMorph("まばたき"),h=Math.sin(f[0]*Math.PI),_=m+h;let b=0;_>1?b=h-(_-1):b=h,r.setMorph("まばたき",b),f[0]-=.15}else f.shift(),r.setMorph("まばたき",0)}),foot:new ScopedFunction(a.foot,function(d,u){const f=this,m=f.attach;if(this.q===void 0&&m&&(this.q=new Quaternion,this.p1=new Vector3,this.p2=new Vector3,this.p3=new Vector3,this.dummy=new Vector3,this.bone_hL=r.getBone("左ひざ"),this.bone_hR=r.getBone("右ひざ"),this.bone_k=r.getBone("下半身"),this.is_ready=r.getMorph(m)!==void 0&&this.bone_k&&this.bone_hL&&this.bone_hR,debug$2&&console.log(`Enabled auto foot adjustment attach => ${m} ready:${this.is_ready}`)),this.is_ready){this.bone_k.matrixWorld.decompose(this.p1,this.q,this.p1),this.p1.set(0,-1,0),this.p1.applyQuaternion(this.q),this.p3.set(0,-1,0);const h=this.p1.dot(this.p3),_=1-(h<0?0:h);this.bone_hL.matrixWorld.decompose(this.p2,this.q,this.p1),this.bone_hR.matrixWorld.decompose(this.p3,this.q,this.p1),this.p2.sub(this.p3);let b=this.p2.length();b=(b>4?4:b)/4,r.setMorph(m,(_*.5+b*.5)*f.coef)}},{attach:a.foot_attach,coef:1}),foot_ik:new ScopedFunction(a.foot,function(d,u){this.q}),waver:new ScopedFunction(a.waver,function(d,u){const f=this,m=r.find("頭");if(r.find("センター")&&m){if(this.next_time===void 0&&(this.next_time=d+Math.random()*1e3,this.rot1=new Euler,this.rot2=new Euler,this.rot3=new Euler,this.pos1=new Vector3,this.pos2=new Vector3,this.pos3=new Vector3,this.ext1=r.manipulator("センター",!0,!0),debug$2&&console.log("Enabled auto waver")),d-this.next_time>0){this.prev_time=d,this.next_time=d+3e3+Math.random()*7500,this.rot1.copy(this.rot2),this.pos1.copy(this.pos2);const v=f.coef;this.rot2.set(v*UPI*1.5*(.5-Math.random()),v*UPI*1.5*(.5-Math.random()),v*UPI*1.5*(.5-Math.random())),this.pos2.set(v*.25*(.5-Math.random()),v*.15*(.5-Math.random()),v*.2*(.5-Math.random()))}const _=this.next_time-this.prev_time,b=d-this.prev_time;if(_>.01){const v=b/_;this.rot3.x=SmoothInterpolation(this.rot1.x,this.rot2.x,v),this.rot3.y=SmoothInterpolation(this.rot1.y,this.rot2.y,v),this.rot3.z=SmoothInterpolation(this.rot1.z,this.rot2.z,v),this.pos3.x=SmoothInterpolation(this.pos1.x,this.pos2.x,v),this.pos3.y=SmoothInterpolation(this.pos1.y,this.pos2.y,v),this.pos3.z=SmoothInterpolation(this.pos1.z,this.pos2.z,v),this.ext1.position.copy(this.pos3),this.ext1.quaternion.setFromEuler(this.rot3)}}if(f.head&&r.find("頭")){this.next_time_2===void 0&&(this.next_time_2=d+Math.random()*1e3,this.rot1_2=new Euler,this.rot2_2=new Euler,this.rot3_2=new Euler,this.ext1_2=r.manipulator("頭",!1,!0)),d-this.next_time_2>0&&(this.prev_time_2=d,this.next_time_2=d+3e3+Math.random()*7500,this.rot1_2.copy(this.rot2_2),this.rot2_2.set(UPI*3*(.5-Math.random()),UPI*5*(.5-Math.random()),UPI*3*(.5-Math.random())));const _=this.next_time_2-this.prev_time_2,b=d-this.prev_time_2;if(_>.01){const v=b/_;this.rot3_2.x=SmoothInterpolation(this.rot1_2.x,this.rot2_2.x,v),this.rot3_2.y=SmoothInterpolation(this.rot1_2.y,this.rot2_2.y,v),this.rot3_2.z=SmoothInterpolation(this.rot1_2.z,this.rot2_2.z,v),this.ext1_2.quaternion.setFromEuler(this.rot3_2)}}},{coef:1,head:!0})};for(const d in r.functions){const u=r.functions[d];u.set=function(f){for(let m in f)u[m]=f[m]}}this.vec3_table={},this.quat_table={},this.mat4_table={},this.eu_table={},this.status=[],this.rot_eu=new Euler,this.bone_name_table={},this.material_table={},this.material_all_table={},this.attach_mapper=new Map,this.time=0,this.decompose_cache_array=[],this.decompose_index=0;for(let d=0;d<16;d++)this.decompose_cache_array.push([new Vector3,new Quaternion,new Vector3]);if(e.skeleton)for(const d of e.skeleton.bones)this.bone_name_table[d.name]=d;if(e.material)if(Array.isArray(e.material))for(const d of e.material)this.material_table[d.name]=d;else this.material_table[e.material.name]=e.material;e.traverse(d=>{if(d.material)if(Array.isArray(d.material))for(const u of d.material)this.material_all_table[u.name]=u;else this.material_all_table[d.material.name]=d.material}),this.random_table={};{const d=new Array(16).fill(0),u=new Array(16).fill(0);{let f=5e3,m=0;this.regenerate_random=function(){const h=performance.now();if(h-m>f){for(const _ in u)u[_]=Math.random();m=h,f=5e3+2500*Math.random()}for(const _ in d)d[_]+=(u[_]-d[_])*.1}}}const c=()=>{const d=DMC.ui?.system_flags?.user_defined??{},u=h=>d[h]?.value,f=this.o,m=f.name.slice(0,f.name.lastIndexOf("."));this.status[u(m)]&&(f.morphTargetInfluences_cache?.fill?.(0),f.morphTargetInfluences?.fill?.(0),f.morphTargetInfluences_backup?.fill?.(0),this.status[u(m)].initialize(),this.reset_opacity(),this.force_visibility(0),this.auto_visibility(0))};r.changeState=d=>{const u=this.o,f=DMC.ui?.system_flags?.user_defined??{},m=u.name.slice(0,u.name.lastIndexOf(".")),h=f[m];if(h){for(const _ of h.options)if(d==_.key){h.value=_.value;break}}h.value!=null&&(r.onflagchange?.(),c())},e.user.updaters.__script_updater__=function(d){if(d==0){r._update(d);return}else r._update(d);r.time+=d,r.onupdate?.(d),r._morph_buffer_index_++;const u=this.random_table;for(const f in u)u[f].update();DMC.user_flag_needs_update&&(r.onflagchange?.(),c()),r.smooth.update(d)},e.onFlagChanged=function(){r.onflagchange?.(),c()},e.onStopped=function(){r.onstop?.()},e.onStarted=function(){r.time=0,r.onstart?.(),r.onflagchange?.(),c()},e.onPaused=function(){r.onpause?.()},e.onResumed=function(){r.onresume?.()}}_update(e){const i=this.functions,r=performance.now();for(const o in i){const l=i[o];l.enabled&&l.callback(r,e)}if(this.attach_mapper.forEach(function(o,l){ManipulatorUtil.Attach(o.target,l,...o.offsets)}),this.current_chain){const o=this.current_chain.update();o&&(this.current_chain=o)}}setState(e,i,r){let o=()=>{},l=()=>{},a=-1;typeof i=="object"&&(i.initialize&&(o=i.initialize),i.update&&(l=i.update),i.time!=null&&(a=i.time)),typeof i=="function"&&(o=i),typeof r=="function"&&(l=r);for(const c of this.status)if(c.name==e){c.initialize=o;return}this.status.push({time:a,index:this.status.length,name:e,initialize:o,update:l}),this._setup_ui_user_defined_components_()}_setup_ui_user_defined_components_(){const e=DMC.ui.system_flags.user_defined,i=this.o,r=i.name.slice(0,i.name.lastIndexOf("."));e[r]||(e[r]={value:0,component_type:"PullDown",options:[]}),e[r].options=[];for(const o of this.status)e[r].options.push({key:o.name,value:o.index});DMC.update_user_defined_property_on_system_panel()}getRandom(e){const i=this.random_table[e];if(i)return i;const r=random_generator();return this.random_table[e]=r,r}rotate(e=0,i=0,r=0){this.rot_eu.set(UPI*e,UPI*i,UPI*r),this.o.quaternion.setFromEuler(this.rot_eu)}setFunction(e,i,r,o){return this.functions[e]=new ScopedFunction(i,r,o),this.functions[e]}setCameraOffset(e=0,i=0,r=0,o=null,l=null,a=null){const c=this.o;c.ext1==null&&(c.ext1={});const d=c.ext1;d.position==null&&(d.position=new Vector3),d.target==null&&(d.target=new Vector3),d.position.set(e,i,r),o==null&&(o=e),l==null&&(l=i),a==null&&(a=r),d.target.set(o,l,a)}UserDefinedSysFlag(e,i,r=null){const o=this.o,l=e||o.name,a=DMC.ui.system_flags.user_defined;r==null?typeof i=="number"?a[l]||(a[l]={value:i,component_type:"Number"}):typeof i=="boolean"?a[l]||(a[l]={value:i,component_type:"Boolean"}):typeof i=="string"&&(a[l]||(a[l]={value:i,component_type:"String"})):a[l]?a[l].options=r:a[l]={value:i,component_type:"PullDown",options:r},DMC.update_user_defined_property_on_system_panel()}preset(e,i={}){if(e=="heart"){const r={id:"",threshold:0,target:null,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:null,z:null}};Object.assign(r,i);const o=this.o,l=this;this.setFunction("heart"+(r.id?r.id:""),!0,function(a,c){const d=DMC.current.camera||DMC.camera;if(this.face_basic==null){if(this.face_basic=new Vector3(0,0,0),this.face_dir=new Vector3(0,-.5,-1),o.user._attachment01_==null){const u={color:new Color(16716117)},f=-5,m=-10,h=new Shape;h.moveTo(f+5,m+5),h.bezierCurveTo(f+5,m+5,f+4,m,f,m),h.bezierCurveTo(f-6,m,f-6,m+7,f-6,m+7),h.bezierCurveTo(f-6,m+11,f-3,m+15.4,f+5,m+19),h.bezierCurveTo(f+12,m+15.4,f+16,m+11,f+16,m+7),h.bezierCurveTo(f+16,m+7,f+16,m,f+10,m),h.bezierCurveTo(f+7,m,f+5,m+5,f+5,m+5);const _=new ShapeGeometry(h),b=new Matrix4().makeRotationZ(Math.PI),v=new Matrix4().makeScale(1/10,1/10,1/10);_.applyMatrix4(b),_.applyMatrix4(v);const w=window.BindObjectAsDDD(new Mesh(_,new MeshPhysicalMaterial(u)),{type:"heart",kind:"object",draggable_on_tree:!1,draggable_on_3d:!1,droppable_on_3d:!1,controllable_geometry:!1,transform_controller:!1,removable:!1,restore:!1});if(w.name="heart_"+(r.id?r.id:""),w.material.depthWrite=!1,w.material.depthTest=!1,w.material.transparent=!0,w.renderOrder=1,w.frustumCulled=!1,w.getDDDProperties().restore=!1,DMC.scene.add(w),o.user[r.id||e]){const y=o.user[r.id||e];Builder3D.remove_object(y)}o.user[r.id||e]=w}this.pos1=new Vector3,this.quat1=new Quaternion,this.pos2=new Vector3,this.quat2=new Quaternion,this.dummy=new Vector3,this.pos3=new Vector3,this.quat3=new Quaternion,this.c_pos=new Vector3,this.c_quat=new Quaternion,this.c_mat4=new Matrix4}if(this.target1=l.getBone(r.target),this.target1&&this.pos1&&this.quat1&&this.dummy){this.target1.matrixWorld.decompose(this.pos1,this.quat1,this.dummy),d.matrixWorld.decompose(this.c_pos,this.c_quat,this.dummy),this.c_mat4.multiplyMatrices(d.matrixWorldInverse,this.target1.matrixWorld),this.pos2.copy(this.face_basic),this.pos3.copy(this.face_dir),this.pos2.applyMatrix4(this.c_mat4),this.pos3.applyMatrix4(this.c_mat4),this.pos3.sub(this.pos2);const u=this.pos3.dot(this.face_dir);this.pos3.x=r.position?.x??0,this.pos3.y=r.position?.y??0,this.pos3.z=r.position?.z??0,this.pos3.applyQuaternion(this.quat1);const f=o.user[r.id||e];f.position.x=this.pos1.x+this.pos3.x,f.position.y=this.pos1.y+this.pos3.y,f.position.z=this.pos1.z+this.pos3.z,f.quaternion.copy(this.c_quat),u<r.threshold?f.visible=!1:f.visible=!0,f.material.color.r=1.2,f.material.color.g=.1,f.material.color.b=.4,f.material.emissive.r=1.2,f.material.emissive.g=.1,f.material.emissive.b=.4,f.material.emissiveIntensity=2;{const m=a,h=1,_=.4+.01*Math.sin(m*.006+h)+Math.max(.05*Math.cos(m*.006+h)*.1,0),b=r.scale?.x??1;f.scale.x=_*b,f.scale.y=_*(r.scale?.y??b),f.scale.z=_*(r.scale?.z??b)}}})}}setOffsetBone(e,i=0,r=0,o=0,l=0,a=0,c=0){const d=this.bone_name_table[e];if(d){if(d.ext1){const u=d.ext1;u.position?(u.position.x=i,u.position.y=r,u.position.z=o):u.position=new Vector3(i,r,o)}else d.ext1={position:new Vector3(i,r,o),quaternion:new Quaternion},TMP.attach_euler.set(UPI*l,UPI*a,UPI*c),d.ext1.quaternion.setFromEuler(TMP.attach_euler);return d.ext1}return null}disableAllFunctions(){for(const e in this.functions)this.functions[e].enabled=!1}enableAllFunctions(){for(const e in this.functions)this.functions[e].enabled=!0}enableFunction(e){const i=this.functions[e];return i?i.enabled=!0:console.error(`Does not exists: ${e}`),i}disableFunction(e){const i=this.functions[e];i?i.enabled=!1:console.error(`Does not exists: ${e}`)}GetExternalBone(e,i){let r=null;if(DMC.scene.traverse(o=>{if(o.name.indexOf(e)>=0&&o.skeleton?.bones)for(const l of o.skeleton.bones)l.name==i&&(r=l)}),r){const o={bone:r,decompose(){return r.matrixWorld.decompose(o.tmp.pos,o.tmp.qu,o.tmp.sc),[o.tmp.pos,o.tmp.qu,o.tmp.sc]},tmp:{pos:new Vector3,sc:new Vector3,qu:new Quaternion}};return o}return null}manipulator(e,i=!0,r=!0){const o=this,l=this.bone_name_table[e];return l?new BoneManipulator(o,l,i,r):null}reset_opacity(){const e=this.o;if(e.material)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)e.material[i].opacity=e.material_overwrite[i].opacity=e.material_original[i].opacity;else e.material.opacity=e.material_overwrite.opacity=e.material_original.opacity}auto_visibility(e=0){const i=this.o,r=()=>{e==0&&DMC.mmd_animation_helper.update(0,{force_update_physics:!1,delta:0});for(const o in i.material){const l=i.material_overwrite[o];i.material[o].opacity<.01?l.visible=!1:l.visible=!0}};e>0?setTimeout(r,e):r()}force_visibility(e=0){const i=this.o,r=()=>{e==0&&DMC.mmd_animation_helper.update(0,{force_update_physics:!1,delta:0});for(const o in i.material){const l=i.material_overwrite[o],a=i.material[o];l.visible=!0,a.visible=!0}};e>0?setTimeout(r,e):r()}hide(e=null){if(e){const i=this.o;if(i.material)if(Array.isArray(i.material))for(const r in i.material){const o=i.material[r],l=i.material_overwrite?.[r];o.name==e&&(o.visible=!1,l&&(l.visible=!1))}else{const r=i.material,o=i.material_overwrite;r.name==e&&(r.visible=!1,o&&(o.visible=!1))}}else this.o.visible=!1}show(e=null){if(e){const i=this.o;if(i.material)if(Array.isArray(i.material))for(const r in i.material){const o=i.material[r],l=i.material_overwrite?.[r];o.name==e&&(o.visible=!0,l&&(l.visible=!0))}else{const r=i.material,o=i.material_overwrite;r.name==e&&(r.visible=!0,o&&(o.visible=!0))}}else this.o.visible=!0}setMorph(e,i=1){this.detMorph(e,i,1)}detMorph(e,i=0,r=.5){if(this.o.morphTargetDictionary){const o=this.o.morphTargetDictionary,l=this.o.morphTargetInfluences_cache,a=o[e];if(a!=null){const c=l[a];l[a]=c+(i-c)*r}}}bufMorph(e,i=0,r=1){if(this.o.morphTargetDictionary){const o=this.o.morphTargetDictionary,l=this.o.morphTargetInfluences_cache,a=o[e];if(a!=null){const c=this._morph_seq_buffer_[e];l[a]=c[(this._morph_buffer_index_-r)%c.length],c[this._morph_buffer_index_%c.length]=i}}}getMorph(e){const i=this.o.morphTargetDictionary;return this.o.morphTargetInfluences_cache[i[e]]}getResultMorph(e){const i=this.o.morphTargetDictionary;return this.o.morphTargetInfluences_result[i[e]]}getActionMorph(e){const i=this.o.morphTargetDictionary;return this.o.morphTargetInfluences_backup[i[e]]}addMorph(e,i){const r=this.o.morphTargetDictionary,o=this.o.morphTargetInfluences_cache,l=r[e];l!==void 0&&(o[l]+=i)}decompose(e){const i=this.decompose_cache_array[this.decompose_index++%this.decompose_cache_array.length];return e.matrixWorld?e.matrixWorld.decompose(i[0],i[1],i[2]):this.o.matrixWorld.decompose(i[0],i[1],i[2]),i}static Attach(e,i,r=0,o=0,l=0,a=0,c=0,d=0){const u=e,f=i;u&&f&&u instanceof Object3D&&f instanceof Object3D&&(u instanceof Bone,u.matrixWorld.decompose(f.position,f.quaternion,TMP.attach_vec3),TMP.attach_vec3.set(r,o,l),TMP.attach_vec3.applyQuaternion(f.quaternion),f.position.x+=TMP.attach_vec3.x,f.position.y+=TMP.attach_vec3.y,f.position.z+=TMP.attach_vec3.z,(a!=0||c!=0||d!=0)&&(TMP.attach_euler.set(UPI*a,UPI*c,UPI*d),TMP.attach_quat.setFromEuler(TMP.attach_euler),f.quaternion.multiply(TMP.attach_quat)))}attach_to(e,i,r,o=0,l=0,a=0,c=0,d=0,u=0){const f=this.getBone(e)||this.o;let m=null;DMC.scene.traverse(h=>{if(h&&h.isMesh&&h.name?.search(i)==0&&h.skeleton)for(const _ of h.skeleton?.bones)_.name==r&&(m=_)}),f&&m&&this.attach_mapper.set(f,{target:m,offsets:[o,l,a,c,d,u]})}clearAttachMapper(){this.attach_mapper.clear()}getMaterial(e){return this.material_table[e]}findMaterial(e,i=!0){return i?this.material_all_table[e]:this.material_table[e]}getBone(e){return this.bone_name_table[e]}find(e,i=null){let r=null;return DMC.scene.traverse(o=>{if(i==null)o&&o.name&&o.name.indexOf(e)>=0&&(r=o);else if(o&&o.isMesh&&o.name?.search(e)==0&&o.skeleton)for(const l of o.skeleton?.bones)l.name==i&&(r=l)}),r}chain(e,i){return this.current_chain=this.start_chain=new TimeChain(-.001,()=>{},this),this.current_chain.next=MakeNextChain(e,i,this),this.current_chain.next}reset(e){e&&Object.assign({},e);const r=this.o;r.morphTargetInfluences_cache?.fill?.(0),r.morphTargetInfluences?.fill?.(0),r.morphTargetInfluences_backup?.fill?.(0);for(const o in this.bone_name_table)delete this.bone_name_table[o].ext1;this.vec3_table={},this.quat_table={},this.mat4_table={},this.eu_table={},this.attach_mapper=new Map,this.reset_opacity(),this.force_visibility(),this.current_chain=this.start_chain}vec(e){const i=this.vec3_table;let r=i[e];return r===void 0&&(r=i[e]=new Vector3),r}euler(e){const i=this.eu_table;let r=i[e];return r===void 0&&(r=i[e]=new Euler),r}quat(e){const i=this.quat_table;let r=i[e];return r===void 0&&(r=i[e]=new Quaternion),r}mat(e){const i=this.mat4_table;let r=i[e];return r===void 0&&(r=i[e]=new Matrix4),r}attach_c(e,i,r,o){this.bone_name_table[e]}test(e){if(performance.now(),DMC.line==null){const o=new LineBasicMaterial({color:65280}),l=[];for(let d=0;d<1e3;d++)l.push(new Vector3(0,0,-5+d*.03));const a=new BufferGeometry().setFromPoints(l),c=new Line(a,o);DMC.scene.add(c),DMC.line=c}const i=DMC.line,r=i.geometry.attributes.position.array;for(let o=0;o<1e3;o++)r[o*3+1]=SmoothInterpolation(0,1,o/1e3),r[o*3+1]*=10;i.geometry.attributes.position.needsUpdate=!0}setUpdater(e,i){this.o.setUpdater(e,i)}onupdate(e){}onstop(){}onstart(){}onpause(){}onresume(){}onflagchange(){}}class ScriptUtil{find(e,i=!1){const r=DMC.scene;return i?r.getObjectByName(e):r.find(e,i)}bind(e,i){return new ManipulatorUtil(e,i)}dummy(){return console.log("No optimize script util."),new Object3D}}const ScriptUtil$1=new ScriptUtil;var define_process_env_default={};const SDK_VERSION="0.26.1";var debug$1=window.debug;if(debug$1){const s=window;let e=!1,i=1/0;{let d=performance.now(),u;for(let f=0;f<1e5;f++){u=performance.now();const m=u-d;m>0&&m<i&&(i=m),d=u}e=i<.01}const r=s.is_electron?"Electron":"Browser",o=typeof window.WebAssembly=="object"&&typeof window.WebAssembly.instantiate=="function";let l=[];const a=(d,u,f="gray")=>(l.push("color:gray"),l.push("color:"+f),`%c${d.padStart(20)}: %c${u}
`);let c="";c+=a("Runtime",r+"-"+s.browser_type),c+=a("FileSystem",s.nodejs?"fs":"fetch",s.nodejs?"yellow":"gray"),c+=a("CrossOriginIsolated",crossOriginIsolated,crossOriginIsolated?"green":"yellow"),c+=a("SharedArrayBuffer",!!window.SharedArrayBuffer,window.SharedArrayBuffer?"green":"yellow"),c+=a("Clock precision",e?`High(${i}ms)`:`Low(${i}ms)`,e?"green":"yellow"),c+=a("Performance Func",performance.measureUserAgentSpecificMemory?"Enabled":"Disabled",performance.measureUserAgentSpecificMemory?"green":"yellow"),c+=a("WebAssembly",o,o?"green":"red"),c+=a("JS",s.js_version),c+=a("ImportMap",HTMLScriptElement.supports("importmap"),HTMLScriptElement.supports("importmap")?"green":"yellow"),c+=a("Zip",window.DecompressionStream!=null,window.DecompressionStream?"green":"yellow"),o?(async()=>{const d=window.wasmFeatureDetect,u=await d.threads(),f=await d.gc(),m=await d.bulkMemory(),h=await d.simd(),_=await d.memory64(),b=await d.relaxedSimd(),v=await d.streamingCompilation();c+=a("Threads",u,u?"green":"red"),c+=a("GC",f,f?"green":"gray"),c+=a("BulkMemory",m,m?"green":"gray"),c+=a("SIMD",h,h?"green":"gray"),c+=a("Memory64",_,_?"green":"yellow"),c+=a("RelaxedSimd",b,b?"green":"gray"),c+=a("StreamingCompilation",v,v?"green":"gray"),c+=a("WebGPU",navigator.gpu!=null,navigator.gpu?"green":"red"),c+=a("WebNN",window.MLGraphBuilder!=null,window.MLGraphBuilder?"green":"gray"),console.log(c,...l),l=[]})():(console.log(c,...l),l=[])}window.BASE_URL=document.baseURI.slice(0,document.baseURI.lastIndexOf("/"));Object3D.prototype.__getActualMatrixWorld__=null;C$2.set_base_url("./ddd/libs");for(;!window.__prepared__translator__;)await C$2.sleep(25);window.__DUMMY_AUDIO__=new Audio;window.__DUMMY_AUDIO__.src=URL.createObjectURL(new Blob([Uint8Array.from(atob("UklGRigAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABAAZGF0YQQAAAAAAAAA"),s=>s.charCodeAt(0))]));window.C=C$2;window.UI=UI$1;window.UC=UC$1;window.UIL=UIL$1;window.UI_Tree=UI_Tree;window.Builder3D=null;window.BuilderUtil=BuilderUtil$1;window.THREE=THREE$1;window.GlobalKeymaps=GlobalKeymaps;window.OperationStack=C$2.undo_redo_controller();window.test_sounds=[];window.DMC=void 0;window.ExternalIO=ExternalIO$1;const $ID=s=>document.getElementById(s),$Q=s=>document.querySelector(s),$QS=s=>document.querySelectorAll(s),$CDM=s=>document.createElement(s);let _main_window_listener_initialized_=!1;window.OpenModule=async function(s,e={}){const i={};if(Object.assign(i,e),s=="sanitize_deprecated_property")await sanitize_deprecated_property();else if(s=="asset_browser")await asset_browser(i);else if(s=="gltf_compressor")await gltf_compressor();else if(s=="ktx2_compressor")window.is_electron?await ktx2_compressor():await ktx2_compressor_for_web();else if(s=="dev_tool")await window.nodejs?.open_debug_tool();else throw new Error("Disabled dynamic import.");return null};async function nxl5abQZB1(){window._v_v_=!1}const REPLACE_POINT_OF_ENTRY_POINT=async()=>{window.force_io_driver="http";await SetProjectPath("jddu632c6s0mrvioa43w10wg/index.ddd")},REPLACE_POINT_OF_ENTRY_MODE=async()=>{window.DEPLOYMENT_TYPE="PLAYER";window.app_mode=true};async function index_init(){window.C=C$2,await nxl5abQZB1(),window.is_already_loaded=!1,await REPLACE_POINT_OF_ENTRY_POINT(),await REPLACE_POINT_OF_ENTRY_MODE(),debug$1&&console.log("APP MODE:",window.app_mode,"DEPLOYMENT_TYPE:",window.DEPLOYMENT_TYPE,"Mobile:",window.isSmartPhone);const s=async()=>{window.dispatchEvent(new Event("resize")),debug$1&&console.log("__init__");const r=$ID("main_frame");if(C$2.modal_processing("Launching...<span onclick='DMC.reset()' style='float:right'><i style='color:#A66' class='bi bi-power'></i></span>","<div id='progress_description'> </div><div>Loading....</div>",{no_alpha:!0}),window.app_mode){const o=l=>{const a=$ID(l);a&&(a.style.display="none")};o("__editor_footer__"),o("__editor_right_side_panel_object_tree__"),o("__editor_right_property_window__"),o("__editor_nav__"),o("__editor_header__"),o("__editor_header_container__"),r&&r.classList.remove("main_frame")}if(window.DEPLOYMENT_TYPE=="PLAYER"&&($QS(".disable_component_in_player > button").forEach(o=>{if(!(o instanceof HTMLButtonElement))throw new TypeError;o.onclick=o.onmouseup=()=>{C$2.modal_ok_cancel("Restricted","Not available in playback mode.",{cancel:null})},o.querySelector("i").style.color="#333"}),$QS(".disable_component_in_player > * > a").forEach(o=>{if(!(o instanceof HTMLAnchorElement))throw new TypeError;o.onclick=o.onmouseup=()=>{C$2.modal_ok_cancel("Restricted","Not available in playback mode.",{cancel:null})},o.style.color="#333"})),window.is_already_loaded=!0,window.nodejs){if(!(await window.nodejs.ipcRenderer.invoke("SystemEnvironment")).debug)for(const l of $QS(".dev_tool_button"))l.remove()}else{for(const o of $QS(".dev_tool_button"))o.remove();for(const o of $QS(".local_function_button"))o.remove()}document.activeElement?.blur?.(),on_loaded()};document.readyState==="interactive"||document.readyState==="complete"?debug$1&&console.log("DOMContentLoaded is already fired"):document.addEventListener("DOMContentLoaded",()=>{debug$1&&console.log("DOMContentLoaded is fired")}),document.readyState==="complete"?(debug$1&&console.log("load is already fired"),await s()):window.addEventListener("load",async()=>{debug$1&&console.log("load is fired"),await s()}),["","webkit","moz","ms"].forEach(r=>document.addEventListener(r+"fullscreenchange",()=>{window.dispatchEvent(new Event("resize"))},!1)),window.select_external_storage=r=>{const o=$ID("external_storage"),l=document.getElementsByClassName("storage_panel_card");if(!(o instanceof HTMLSelectElement))throw new TypeError;for(let c=0;c<l.length;c++){const d=l[c];if(!(d instanceof HTMLElement))throw new TypeError;d.style&&(d.style.display="none")}const a=$ID(o.value+"_panel");a?.style&&(a.style.display="block")},document.addEventListener("contextmenu",r=>{const o=r.target;o instanceof HTMLElement&&(o.tagName=="INPUT"||o.tagName=="TEXTAREA"?o.classList.contains("ui_component_ignore_contextmenu")&&r.preventDefault():r.preventDefault())});function e(r){if(r.button==2){const o=["Copy"];r.target.tagName=="INPUT"&&(o.push("Cut"),o.push("Paste")),C$2.popup_menu(r,o,null,l=>{l=="Copy"?document.execCommand("copy"):l=="Paste"?document.execCommand("paste"):l=="Cut"&&document.execCommand("cut")})}}if(window.on_right_click=e,window.open_tab=(r,o,l,a)=>{const c=$ID(a),d=c.querySelectorAll(".tabcontent");for(let f=0;f<d.length;f++)d[f].classList.add("deactivated");const u=c.querySelectorAll(".tablinks");for(let f=0;f<u.length;f++)u[f].classList.remove("active");$ID(o).classList.remove("deactivated"),r.currentTarget.classList.add("active"),__storage__.editor.set("last_right_panel_tab",l.id)},window.navigator.userAgent.toLowerCase().indexOf("mac os x")===-1){const r=$QS("span");for(const o of r)o.innerText.indexOf("⌘")>=0&&(o.innerHTML=o.innerHTML.replace(/⌘/g,"CTRL"))}async function i(r){const o=$ID(r);if(o&&(o instanceof HTMLSelectElement||o instanceof HTMLInputElement)){const l=await __storage__.editor.get(r);l&&(o.value=l),o.onchange=()=>{__storage__.editor.set(r,o.value)}}}i("load_file_behavior")}index_init();{let s=0,e=!1;window.lock_rendering=function(){if(s==0){const i=DMC;i&&i.playing_state==i.PLAYING_STATE.PLAYING&&(i.play(),e=!0)}s++},window.unlock_rendering=function(){s--;const i=DMC;s==0&&e&&(e=!1,i?.play())},window.is_locked_rendering=function(){return s>0}}window.script_runner=function(code_or_object,_params){const __user_defined__=DMC.ui?.system_flags?.user_defined??{},FLAG=s=>__user_defined__[s]?.value;FLAG("dummy")&&console.log("dummy");const params={recursive:!1,print:!1,local_variables:{}};_params&&Object.assign(params,_params);const console_log=window.console.log,console_error=window.console.error,console_info=window.console.info,console_warn=window.console.warn,console_dir=window.console.dir;if(!window.app_mode){const s={};s.log=(window.terminal_log||window.parent.terminal_log)??(()=>{}),s.error=(window.terminal_error||window.parent.terminal_error)??(()=>{}),s.warn=(window.terminal_error||window.parent.terminal_error)??(()=>{}),s.info=(window.terminal_log||window.parent.terminal_log)??(()=>{}),s.dir=(window.terminal_dir||window.parent.terminal_dir)??(()=>{}),typeof s.log!="function"&&(s.log=()=>{}),typeof s.error!="function"&&(s.error=()=>{}),typeof s.warn!="function"&&(s.warn=()=>{}),typeof s.info!="function"&&(s.info=()=>{}),typeof s.dir!="function"&&(s.dir=()=>{});var console={};console.log=function(){s.log(...arguments),console_log(...arguments)},console.error=function(){s.error(...arguments),console_error(...arguments)},console.info=function(){s.info(...arguments),console_info(...arguments)},console.warn=function(){s.warn(...arguments),console_warn(...arguments)},console.dir=function(){s.dir(...arguments),console_dir(...arguments)}}const local=params.local_variables;local?.dummy&&console.log("dummy");try{function print_log(s){let e="";function i(r,o=0){for(let l=0;l<o;l++)e+=" ";e+=`${r}`,e+=`
`}if(typeof s=="object"){i(`
{`);const r=4;for(const o in s){const l=s[o];typeof l=="object"?i(o+": [Object]",r):l instanceof Number||l instanceof BigInt||l instanceof Boolean?i(o+": "+l,r):typeof l=="string"?i(o+`: "${l}"`,r):l instanceof Symbol?i(o+": [Symbol]",r):i(typeof l=="function"?o+": [Function]":l===null?o+": null":l===void 0?o+": undefined":o+": "+l,r)}i("}")}else s instanceof Number||s instanceof Boolean||typeof s=="string"?i(s):i(s===null?"null":s===void 0?"undefined":s)}function __runner__(_object_){const object=_object_,U=ScriptUtil$1;console_log("RUN:",object.name,U.dummy()?.name),object?.dummy&&console.log("dummy");let script=object.script;const mode=object.script_mode??"javascript";mode=="typescript"&&(script=window.ts.transpileModule(script,{target:window.ts.ModuleKind.ES2020,compilerOptions:{module:window.ts.ModuleKind.ES2020}}).outputText);try{params.print?print_log(eval(script)):eval(script)}catch(s){console?.error?.(object.name,s),console_error(object.name,s)}}typeof code_or_object=="object"?__runner__(code_or_object):typeof code_or_object=="string"&&(params.recursive?DMC.current.object&&DMC.current.object.traverse(e=>{e.script?.length>0&&__runner__(e)}):(DMC.current.object?.dummy&&console.log("dummy"),__runner__(DMC.current.object)))}catch(s){s.stack&&(console?.error?.(s.stack),console_error(s.stack))}window.console.log=console_log,window.console.error=console_error,window.console.warn=console_warn,window.console.info=console_info,window.console.dir=console_dir,DMC.update_user_defined_property_on_system_panel()};async function load_plugin_modules(s={}){const e=$ID("__editor_tool_selector__"),i=JSON.parse(await __storage__.editor_permanent.get("registered_plugin_modules","{}")),r=Object.keys(i),o={};let l=null;if(s?.preload)return;function a(d){o[d.key]=d,l==null&&(l=d.key);const u=$CDM("option");return u.value=d.key,u.innerText=d.title,e&&e.appendChild(u),window.GlobalKeymaps.main[d.key]=d,d.on_load()}await a(geometry_controller);for(const d of r)try{const u=(await window.OpenModule(d)).default;await a(u)}catch(u){console.error(u)}const c=DMC.current_tool_module=await __storage__.editor.get("current_tool_module")||l;for(const d in o)try{o[d].on_change(c)}catch(u){console.error(u)}e&&(e.innerHTML=""),e!=null&&(e.onchange=async function(d){const u=e.value;for(const f in o)try{o[f].on_change(u)}catch(m){console.error(m)}DMC.current_tool_module=u,await __storage__.editor.set("current_tool_module",u)},e.value=c,await __storage__.editor_permanent.set("registered_plugin_modules",JSON.stringify(i)))}window.load_plugin_modules=load_plugin_modules;async function test_code(){}async function sanitize_deprecated_property(){await C$2.sleep(100);const s={};function e(u,f){f&&f[u]!=null&&(delete f[u],s[u]==null&&(s[u]=0),s[u]++)}function i(u,f){const m=f?.getDDDProperties?.();m&&m[u]!=null&&(delete m[u],s[u]==null&&(s[u]=0),s[u]++)}function r(u){u&&(e("_visible_",u),e("action_index",u),e("action_loop_type",u),e("actions",u),e("action_mode",u),e("action_cross_fade",u),e("use_dynamic_cube_mapping",u),e("_mmd_animation_finished_flag_",u),e("_watch_",u))}function o(u){u&&(i("bgm",u),i("action_index",u),i("action_loop_type",u),i("actions",u),i("action_mode",u),i("action_cross_fade",u),i("_mmd_animation_finished_flag_",u),i("_watch_",u))}function l(u){if(Array.isArray(u))for(const f of u)e("refractionRatio",f),e("_visible_",f),e("dynamicEnvironment",f);else{const f=u;e("refractionRatio",f),e("_visible_",f),e("dynamicEnvironment",f)}}const a=new Set,c=new Set,d=[];if(DMC.scene.traverse(u=>{if(u){const f=u._dp_;f&&(c.has(f.uuid)&&d.push(u),c.add(f.uuid)),a.has(u.uuid)&&c.add(f.uuid),a.add(u.uuid),u.material&&l(u.material),u.material_overwrite&&l(u.material_overwrite),r(u),o(u),u.shadow?.camera&&r(u.shadow.camera)}}),d.length>0)C$2.modal_ok_cancel_promise("Double UUIDs",d.map(u=>u.name).join("<br>"),{cancel:null}),console.error("Double UUIDs",d);else{let u="";for(const f in s)u+=`<div>${f}: ${s[f]}</div>`;C$2.modal_ok_cancel_promise("Sanitized",u,{cancel:null})}}let toggle_bottom_window;async function initialize_resizer(){if(!window.app_mode){document.onfullscreenchange=function(){window.dispatchEvent(new Event("resize"))};{let s=function(){if(o){o=0,$ID("__editor_middle_content__").style.width=window.innerWidth+"px",$ID("__editor_middle_content__").style.height=window.innerHeight-i+"px";const a=l.__editor_footer__??0,c=1-a,d=l.__editor_footer_left__!=null?l.__editor_footer_left__:.3;let u=l.__editor_right_property_window__!=null?l.__editor_right_property_window__:.25;window.innerWidth*u>250&&(u=250/window.innerWidth);const f=1-u,m=l.__editor_right_side_panel_object_tree__!=null?l.__editor_right_side_panel_object_tree__:.35;Resizable.initialise("__editor_middle_content__",{__editor_footer__:a,__editor_main_panel__:c,__editor_footer_left__:d,__editor_right_property_window__:u,__editor_left_main_all__:f,__editor_right_side_panel_object_tree__:m},r)}},e=function(a){for(const c of Resizable.activeContentWindows)if(c.divId==a)return c;return null};const i=0,r=3;let o=1;const l=JSON.parse(await __storage__.editor.get("resizable","{}"));s(),window.resizable_window_resize=function(){l.__editor_footer__=$ID("__editor_footer__").clientHeight/$ID("__editor_middle_content__").clientHeight,l.__editor_footer_left__=$ID("__editor_footer_left__").clientWidth/$ID("__editor_footer__").clientWidth,l.__editor_right_property_window__=$ID("__editor_right_property_window__").clientWidth/$ID("__editor_middle_content__").clientWidth,l.__editor_right_side_panel_object_tree__=$ID("__editor_right_side_panel_object_tree__").clientHeight/$ID("__editor_middle_content__").clientHeight,l.__editor_right_side_panel_object_tree__<.2&&(l.__editor_right_side_panel_object_tree__=.2),l.__editor_right_property_window__<.2&&(l.__editor_right_property_window__=.2),l.__editor_footer_left__<.2&&(l.__editor_footer_left__=.2),Resizable.activeContentWindows[0]&&(Resizable.activeContentWindows[0].changeSize(C$2.get_window_width(),C$2.get_window_height()-0),Resizable.activeContentWindows[0].childrenResize()),__storage__.editor.set("resizable",JSON.stringify(l)),calculate_coordinates_of_tips()},window.resize_as_default=function(){e("__editor_footer__").resize(Resizable.Sides.TOP,C$2.get_window_height()-C$2.get_window_height()*.33),e("__editor_right_property_window__").resize(Resizable.Sides.LEFT,C$2.get_window_width()-250),e("__editor_right_side_panel_object_tree__").resize(Resizable.Sides.BOTTOM,300),window.dispatchEvent(new Event("resize"))},window.resize_as_optimized=function(){e("__editor_footer__").resize(Resizable.Sides.TOP,C$2.get_window_height()-3),e("__editor_right_property_window__").resize(Resizable.Sides.LEFT,C$2.get_window_width()-250),e("__editor_right_side_panel_object_tree__").resize(Resizable.Sides.BOTTOM,300),window.dispatchEvent(new Event("resize"))},toggle_bottom_window=(a=void 0)=>{const c=C$2.get_window_height()-$ID("__editor_footer__").offsetHeight;function d(u,f,m){if(u>0){const h=f+(m-f)*.5;e("__editor_footer__").resize(Resizable.Sides.TOP,h),setTimeout(()=>{d(u-1,h,m)},16),window.dispatchEvent(new Event("resize"))}else e("__editor_footer__").resize(Resizable.Sides.TOP,m),window.dispatchEvent(new Event("resize"))}a!==void 0?a?c>C$2.get_window_height()-50&&(d(5,c,C$2.get_window_height()-230),window.dispatchEvent(new Event("resize"))):c<C$2.get_window_height()-50&&(d(5,c,C$2.get_window_height()-30),window.dispatchEvent(new Event("resize"))):(c>C$2.get_window_height()-50?d(5,c,C$2.get_window_height()-230):d(5,c,C$2.get_window_height()-30),window.dispatchEvent(new Event("resize")))}}}}function SetupMainPanelListener(){const s=$ID("main_frame");s.ondrop=async function(i){i.preventDefault(),i.stopPropagation(),s.style.opacity="1.0",C$2.modal_processing("Processing...","");const r=i.dataTransfer.types.includes("Files"),o=i.dataTransfer.types.includes("json"),l=C$2.clone(i.dataTransfer.types),a=i.dataTransfer.getData("json");let c=[];if(o&&a?.length>0){const d=JSON.parse(a),u=[];if(d.target_file_paths.length>0)for(const f of d.target_file_paths)u.push(f.absolute_path);c=c.concat(u),c.length>0&&await load_files(c),C$2.close_modal_processing()}else if(r)if(window.is_electron&&(window.external_io==null||window.external_io.driver==="local")){if(i.dataTransfer.items){for(let u=0;u<i.dataTransfer.items.length;u++)if(i.dataTransfer.items[u].kind==="file"){const f=i.dataTransfer.items[u].getAsFile();c.push(f.path?f.path:f.name)}}else for(let u=0;u<i.dataTransfer.files.length;u++)c.push(i.dataTransfer.files[u].path);c=c.map(u=>u.replace(/\\/g,"/")),await C$2.extract_zip(c,{tmp:!0});const d=c.filter(u=>C$2.DPath(u).ext=="ddd")[0];d?(console.log(d),C$2.close_modal_processing(),await load_files([d]),C$2.close_modal_processing()):(console.log(c),C$2.close_modal_processing(),await load_files(c),C$2.close_modal_processing())}else if(window.external_io?.driver==="memory"||window.external_io?.driver==="indexeddb"){const d={};for(let f=0;f<i.dataTransfer.items.length;f++){const m=i.dataTransfer.items?.[f],h=i.dataTransfer.files[f];h.type;const _=h.name;let b=!1;if(m){const v=m.webkitGetAsEntry?.();v&&(b=!0,v.isDirectory||v.isFile&&(d[C$2.DPathJoin(window.file_browser.current_link,_)]=!0))}b||!h.type&&h.size%4096==0||(d[C$2.DPathJoin(window.file_browser.current_link,_)]=!0)}let u;{const f=i.dataTransfer.items,m=[],h=[];let _=!1;for(window.file_browser.get_items(f,m,h,()=>{_=!0});!_;)await C$2.sleep(100);u={dataTransfer:{types:l,files:h,dirs:m,items:f,getData:b=>{if(b.toLowerCase()=="json")return""}},is_main_screen:!0,preventDefault:()=>{},stopPropagation:()=>{}}}await window.file_browser_drop_handler(s,u,window.file_browser,async f=>{const m=window.external_io;if(m)if(m.driver=="indexeddb"||m.driver=="memory"||m.driver=="webdav"||m.driver=="aws_s3"){const h=f,_=h.filter(v=>C$2.file_type(v.store_path)=="project")[0];if(_)return await SetProjectPath(_.store_path),DMC.reload(),null;const b=[];for(const v of h){const w=C$2.file_type(v.store_path);(w=="model"||w=="j_object"||w=="sound"||w=="project")&&b.push(v.store_path)}if(b.length>0){C$2.close_modal_processing(),C$2.modal_processing("Loading",b.join("<br>"));try{await load_files(b)}catch(v){C$2.close_modal_processing(),await C$2.modal_ok_cancel_promise("Error",v,{cancel:null})}}}else{console.log(c,f,d);let h=null,_=null;for(const b of f)if(!d[b.file_path]){const v=C$2.DPath(b.file_path).ext,w=C$2.file_type(b.file_path);h==null&&w=="model"?h=b.file_path:w=="project"?_=b.file_path:v=="model"&&(h=b.file_path)}_?(await SetProjectPath(_),DMC.load_project_proc()):(C$2.close_modal_processing(),C$2.modal_processing("Loading...",""),console.log(d),await load_files(Object.keys(d)))}C$2.close_modal_processing()})}else C$2.close_modal_processing(),C$2.modal_ok_cancel("Notice","<div>Network file system does not support temporary loading.</div><div>Move the file to the file browser once, then organize and load it.</div>",{cancel:null}),i.stopPropagation(),i.preventDefault()},s.ondragover=function(i){debug$1&&console.log("main_frame.ondragover"),s.style.opacity="0.3",i.preventDefault()},s.ondragenter=function(i){debug$1&&console.log("main_frame.ondragenter"),s.style.opacity="0.3"},s.ondragend=s.ondragleave=function(i){debug$1&&console.log("main_frame.ondragleave"),s.style.opacity="1"}}window.received_argv_from_other_process=async function(s){console.log("received_argv_from_other_process");try{const e=s.filter(i=>i.indexOf(".ddd")>0||i.indexOf(".object")>0);console.log(e),await load_files(e)}catch(e){console.error(e)}};async function _entry_point_(){if(debug$1&&console.log("_entry_point_"),window.current_code="_entry_point_",window.DEFAULT_ALL_DEBUG&&window.nodejs&&window.nodejs.open_debug_tool({force_enable:!0}),window.getApplicationArgs){const k=await window.getApplicationArgs();if(k.length>=2){const O=k[1];O.indexOf(".ddd")>0&&await SetProjectPath(O)}}await make_project_history_menu(),window.current_code="make_project_history_menu";const s=$ID("main_frame"),e=window.DMC=new MainContext(s);await e.initialize(),load_plugin_modules({preload:!0}),window.current_code="initialize",window.SDK_VERSION=SDK_VERSION;{const k=$CDM("canvas"),O=k.getContext("2d");e.overlay_canvas2d=k,e.overlay_canvas2d_context=O,k.style.cssText="position:absolute;left:0px;top:0px;width:100%;height:100%;",s.appendChild(k)}if(window!=window.parent){const k=DMC;console.log("-------------------------IPC--------------------------");const O=k.PLAYING_STATE;let L;const N=(k.ipc_proxy={post:z=>{},ui:z=>{const K=z.key,Z=z.name,V=z.type;if(typeof K!="string")throw new TypeError("key must be string");if(typeof Z!="string")throw new TypeError("name must be string");if(typeof V!="string")throw new TypeError("type must be string");L.post({ev:"ui_handler",data:[z]})}}).ui;L=window.IFrameIPC.CreateChild(z=>{const K=z.key,Z=k.ui?.system_flags?.user_defined??{};if(K=="play")switch(k.playing_state){case O.NONE:k.play();break;case O.PLAYING:k.play();break;case O.PAUSING:k.play();break}else if(K=="stop")k.stop();else if(K=="renderer")k.renderer_selector.update(z.value);else if(K=="ss")C$2.screenshot("screen_shot.png");else if(K!="mode"){if(K=="fps")k.FPS_Compo.update(Number(z.value));else if(K=="inspector"){const V=k.ui.system_flags;V.inspector=!V.inspector,V.gpu_observer=V.inspector,k.toggle_inspector(V.inspector),k.gpu_observer()}else if(Z[K]){const V=Z[K];V.component_type.toLowerCase()=="pulldown"&&(V.value=z.value,k.user_flag_needs_update=!0)}}console.log(z)},"ddd_app_iframe"),k.addEventListener("paused@scene",z=>{N({key:"play",type:"toggle",name:"Resume"}),N({key:"stop",type:"button",name:"Stop"})}),k.addEventListener("resumed@scene",z=>{N({key:"play",type:"toggle",name:"Pause"}),N({key:"stop",type:"button",name:"Stop"})}),k.addEventListener("ended@scene",z=>{N({key:"play",type:"toggle",name:"Play"}),N({key:"stop",type:"button",name:"Stop",disabled:!0})}),k.addEventListener("started@scene",z=>{N({key:"play",type:"toggle",name:"Pause"}),N({key:"stop",type:"button",name:"Stop"})}),N({key:"play",type:"toggle",name:"Play"}),N({key:"stop",type:"button",name:"Stop",disabled:!0}),N({key:"ss",type:"button",name:"SS"}),N({key:"mode",type:"select",name:"Mode",value:"Player",items:["Player","Control","Studio","VR"]}),N({key:"renderer",type:"select",name:"Renderer",value:"Forward",items:["Forward","Deferred","Toon"]}),k.addEventListener("renderer@graphics",z=>{N({key:"renderer",type:"select",name:"Renderer",value:z.value,items:["Forward","Deferred","Toon"]})}),N({key:"inspector",type:"toggle",name:"Inspector"}),k.draw_thread_after_runner.push(()=>{const z=k.ui?.system_flags?.user_defined;if(z)for(const K in z){const Z=z[K];Z.component_type.toLowerCase()=="pulldown"&&N({key:K,type:"select",name:K,value:Z.value,items:Z.options})}N({key:"fps",type:"select",name:"FPS",value:DMC.ui.renderer_flags.fps,items:["60","30","15",{key:"No limit",value:"-1"}]})})}const i=$ID("progress_description");function r(k){const O=$CDM("div");return O.innerText=k,i&&i.appendChild(O),O}const o=r("External storage");let l=null;try{l=await ExternalStorage({event_listener:async k=>{k=="close"&&!window.app_mode&&(await C$2.modal_ok_cancel_promise("Error","External storage is closed.",{cancel:null}),await e.reset_all(),e.reload())}})}catch(k){console.error(k),o.innerText="Error : Could not activate I/O system",o.style.color="red";const O=$CDM("button");O.innerText="Reset I/O",O.style.cssText="margin-left:auto;margin-right:auto",O.onclick=L=>{L.preventDefault(),L.stopPropagation(),ExternalIO$1.reset_external_storage()},i.appendChild($CDM("br")),i.appendChild(O);return}window.Builder3D=new Builder,e.addEventListener("change@scene",function(k){const O={};e.scene.traverse(L=>{const P=L?.getDDDProperties?.(),N=P?.uuid;N&&(O[N]?P.uuid=C$2.GenerateShortID():O[N]=!0)})}),window.current_code="progress_description";const a=r("Project");debug$1&&console.log("IO-Driver:",l.driver),window.current_code="storage_prog";let c=!0;const d=[];let u=null;async function f(k=!1){if(e.scene&&(e.scene.traverse(O=>{e.scene!=O.context&&Builder3D.remove_object(O)}),e.current.object=null,e.current.camera=null),await GetProjectPath()){let O=C$2.DPath(await GetProjectPath()).path;await SetProjectPath(O);let L=null,P=null;try{if(u)P=C$2.clone(u),u.SDK_VERSION!=window.SDK_VERSION&&console.warn(`Different SDK version - Project file:"${u.SDK_VERSION}" System:"${window.SDK_VERSION}"`);else{if(l.driver=="http")if(console.log(O),O.indexOf("http:")==0||O.indexOf("https:")==0){const N=new URL(O).pathname;L=await window.cross_file_system.read(N),O=N}else L=await window.cross_file_system.read(O);if(L||(L=await window.cross_file_system.read(O)),L==null)throw new Error("Failed to fetch: "+O);try{P=await C$2.s_decode_async(L)}catch(N){console.warn(N),P=C$2.b_decode(L),C$2.close_modal_processing(),await SetProjectPath(void 0),C$2.modal_ok_cancel("Error","Project loading error.<br>"+N.toString(),{cancel:null},()=>{e.reset()});return}u=P}return window.current_code="load_project_proc3",k?await Builder3D.load_project(P,{base_path:O,flags:!0,objects:!1,path_adjust:!0}):await Builder3D.load_project(P,{base_path:O,flags:!1,objects:!0,path_adjust:!1}),window.current_code="load_project_proc4",store_project_history(O),e.scene!=null&&(c=!1),!0}catch(N){window.terminal_error(N),console.error(N),console.error("j_root_object:",P),console.error("data:",L),await SetProjectPath(void 0),update_window_title("Untitled"),C$2.close_modal_processing(),C$2.modal_ok_cancel("Error","Project loading error.<br>"+N.toString(),{cancel:null},()=>{e.reset()})}}return!1}DMC.load_project_proc=f,window.current_code="load_project_proc1";{const k={configuration_version:1,ui:{renderer_flags:{fps:-1,renderer:"Deferred",environment_map:{type:"Static"},stencil:!1,antialias:!0,alpha:!1,logarithmicDepthBuffer:!0,shadowMap_type:PCFSoftShadowMap},system_flags:{texture_network_updater:!1,cpu_observer:!1,gpu_observer:!1,inspector:!window.app_mode,world_time_component:!window.app_mode}},default_preset_scene:"None",default_camera_type:"Perspective"};if(await GetSystemPreferences()==null)await SetSystemPreferences(k);else{const O=C$2.clone(k),L=await GetSystemPreferences();O.configuration_version===L.configuration_version&&C$2.copy_prop(O,L),await SetSystemPreferences(O)}}const m=[];try{await f(!0)}catch(k){console.error(k)}o.remove();{const O=(await GetSystemPreferences()).ui.renderer_flags;C$2.copy_prop(O,e.ui.renderer_flags),e.ui.renderer_flags=O}if(await InitializeThreeJS(),e.prepare_audio_context(!1),m.push(new Promise(async function(k,O){window.current_code="helper_scene",e.helper_scene=await Builder3D.build_by_type("helper_scene"),k()})),!_main_window_listener_initialized_){const k=$ID("main_frame");k.addEventListener("click",O=>{const L=document.getElementsByClassName("active_window");for(let P=0;P<L.length;++P)L[P].classList.remove("active_window");k.classList.add("active_window"),document.activeElement?.blur&&document.activeElement.blur(),window.file_browser?.deselect_all&&window.file_browser.deselect_all()}),_main_window_listener_initialized_=!0}window.current_code="_main_window_listener_initialized_",e.texture_observer(),e.cpu_observer(),e.gpu_observer();{let k=function(){e.setGlobalUIFlags(O)};const O=await e.getGlobalUIFlags();if($ID("__editor_header__")){const P=$ID("replace_mode_material_button"),N=$ID("replace_mode_trs_button"),z=$ID("replace_mode_object_prop_button"),K=$ID("replace_mode_morphing_button"),Z=$ID("replace_mode_action_button"),V=$ID("replace_mode_ddd_prop_button"),H=()=>{P.style.opacity=O.replace_mode_material?"1.0":"0.25",N.style.opacity=O.replace_mode_trs?"1.0":"0.25",z.style.opacity=O.replace_mode_object_prop?"1.0":"0.25",K.style.opacity=O.replace_mode_morphing?"1.0":"0.25",Z.style.opacity=O.replace_mode_action?"1.0":"0.25",V.style.opacity=O.replace_mode_deco_prop?"1.0":"0.25",k()};P.onclick=()=>{O.replace_mode_material=!O.replace_mode_material,H()},N.onclick=()=>{O.replace_mode_trs=!O.replace_mode_trs,H()},z.onclick=()=>{O.replace_mode_object_prop=!O.replace_mode_object_prop,H()},K.onclick=()=>{O.replace_mode_morphing=!O.replace_mode_morphing,H()},Z.onclick=()=>{O.replace_mode_action=!O.replace_mode_action,H()},V.onclick=()=>{O.replace_mode_deco_prop=!O.replace_mode_deco_prop,H()},H()}}window.current_code="load_project_proc2",await Promise.all(m);const h=await GetProjectPath();debug$1&&console.log("LoadProject:",h||"Default preset");try{window.current_code="load_project_proc1",await f()||C$2.copy_prop(DMC,await GetSystemPreferences())}catch(k){console.error(k),C$2.copy_prop(DMC,await GetSystemPreferences())}if(window.current_code="load_project_proc2",c){await SetProjectPath(void 0),update_window_title("Untitled");const k=await Builder3D.build_by_type("scene");k.background.set("rgb(197, 205, 211)"),k.fog.color.set("rgb(197, 205, 211)"),k.fog.density=1e-4,k.backup_background=k.background,e.scene=k;{const O=window.__init_camera__;if(O=="perspective_camera"?k.add(await Builder3D.build_by_type("perspective_camera")):O=="ortho_camera"?k.add(await Builder3D.build_by_type("ortho_camera")):k.add(await Builder3D.build_by_type("orbit_camera")),!window.__force_empty_preset__)if(e.default_preset_scene=="Sky"){const L=await Builder3D.build_by_type("directional_light");L.intensity=1,k.add(L),k.add(await Builder3D.build_by_type("sky")),k.add(await Builder3D.build_by_type("wood_floor"))}else if(e.default_preset_scene=="Room"){const L=await Builder3D.build_by_type("spot_light");L.position.set(5,25,10),L.rotateX(Math.PI/180*30),k.add(L);const P=await Builder3D.build_by_type("ambient_light");P.intensity=.25,k.add(P);const N=await Builder3D.build_by_type("box");N.name="BackgroundBox",N.scale.set(25,12.5,25),N.material.color.setHex(9472128),N.position.set(0,12.5,0),N.material.shadowSide=N.material.side=BackSide,N.material.transparent=!1,N.material.castDynamicEnvironment=!0,N.renderOrder=-1;const z=N.getDDDProperties();z.dof_target=!0,z.draggable_on_3d=!1,z.droppable_on_3d=!1,z.transform_controller=!1,z.tessellation={},z.tessellation.enabled=!0,z.tessellation.maxEdgeLength=0,z.tessellation.maxIterations=8,BuilderUtil$1.tessellate(N),k.add(N)}else if(e.default_preset_scene=="Makeup Room"){const L=await Builder3D.build_by_type("spot_light");L.position.set(5,25,10),L.rotateX(Math.PI/180*30),k.add(L);const P=await Builder3D.build_by_type("ambient_light");P.intensity=.5,k.add(P);const N=await Builder3D.build_by_type("box");N.name="BackgroundBox",N.scale.set(25,12.5,25),N.material.color.setHex(9472128),N.position.set(0,12.5,0),N.material.shadowSide=N.material.side=BackSide,N.material.transparent=!1,N.material.castDynamicEnvironment=!0,N.renderOrder=-1;const z=N.getDDDProperties();z.dof_target=!0,z.draggable_on_3d=!1,z.droppable_on_3d=!1,z.transform_controller=!1,z.tessellation={},z.tessellation.enabled=!0,z.tessellation.maxEdgeLength=0,z.tessellation.maxIterations=8,BuilderUtil$1.tessellate(N);{const K=L;K.position.set(-.5,25,14.2),K.scale.set(1,1,1),K.target.position.set(0,-10,0),K.color.setRGB(.75,.63,.56),K.decay=1,K.distance=0,K.intensity=47.75,K.angle=.7,K.penumbra=.8,K.quaternion.set(.5948,0,0,.8039)}k.add(N)}else if(e.default_preset_scene=="Grid"){const L=await Builder3D.build_by_type("directional_light");L.intensity=.75,k.background=new Color(3355443),k.add(L);const P=await Builder3D.build_by_type("ambient_light");P.intensity=.25,k.add(P),k.add(await Builder3D.build_by_type("grid_floor"))}else{const L=await Builder3D.build_by_type("directional_light");L.intensity=.75,k.background=new Color(3355443),k.add(L);const P=await Builder3D.build_by_type("ambient_light");P.intensity=.25,k.add(P),k.add(await Builder3D.build_by_type("wood_floor"))}}}else{let k=!1;e.scene.traverse(O=>{O.isCamera&&(k=!0)}),k==!1&&e.scene.add(await Builder3D.build_by_type("orbit_camera"))}a.remove(),window.current_code="need_default_object";const _=r("Initialize renderers");await InitializeRenderer();const b=new Map;{const k=new Vector3;let O=null,L=null;e.scene.traverse(N=>{N.isCamera&&(O=N,L=N.getDDDProperties().uuid,N.position&&N.target?b.set(N,{object:N,position:N.position.clone(),target:N.target.clone()}):b.set(N,{object:N,position:N.position.clone(),target:k.clone()}))}),e.camera==null&&(e.camera=e.current.camera=O);const P=document.getElementById("camera_selector");if(P){P.innerHTML="";const N=e.getCameras();for(const K of N){const Z=K.getDDDProperties?.();if(Z){const Y=document.createElement("option");Y.innerText=K.name&&K.name.length>0?K.name:K.type,Y.value=Z.uuid,P.appendChild(Y)}K.parent?.getDDDProperties?.()?.isCameraContainer&&(K.parent.position.set(0,0,0),K.parent.rotation.set(0,0,0),K.parent.scale.set(1,1,1))}const z=e.getObjectBySubUUID(e.ui.generic_flags.selected_camera_sub_uuid);z&&z instanceof Camera?e.onChangeCamera(z):(e.onChangeCamera(O),e.ui.generic_flags.selected_camera_sub_uuid=L,P.value=L)}}e.prepare_audio_context(),window.current_code="InitializeRenderer",C$2.modal_processing_replace_description_by_id("__shader_compile__","Shader compiling...."),await Promise.all([UI_setup_listeners(),UI_SystemPanel(),UI_DD_Components()]),load_plugin_modules(),window.app_mode||make_file_history_menu(),window.current_code="Panels";let v=!1;e.scene.traverse(k=>{k.script_mode=="typescript"&&(v=!0)}),v&&await __vitePreload(()=>import("./typescript.min@BGAkRfVV.js"),[],import.meta.url);{const k=e.ui.system_flags.ik??!0,O=e.ui.system_flags.grant??!0;e.mmd_animation_helper.enable("ik",k),e.mmd_animation_helper.enable("grant",O),e.reset_animation(0),window.current_code="reset_animation"}let w=null;async function y(){if(e.main_is_ready4){if(debug$1&&console.log("Ready"),window.current_code="main_is_ready",w&&clearInterval(w),_.remove(),d.length>0){let k='<div style="background: #222;text-align:left;padding:5px;">';for(const O of d)k+=`<div style='margin-bottom:2px;font-size:12px;font-family:monospace;color:red;'>${O}</div>`;k+="</div>",C$2.close_modal_processing(),C$2.modal_ok_cancel("Error",k,{cancel:null,ok:"Ignore"}),C$2.modal_processing(window.T("g.launching"),"Initializing renderers.")}window.current_code="_show_main_",await Promise.all(window.__init_promises__),delete window.__init_promises__,$ID("__editor_overlay__")?.remove?.(),await __storage__.editor.get("asset_browser_opened")&&window.external_io?.driver=="indexeddb"&&!window.app_mode&&asset_browser({});{const k=e.ui.system_flags;window.app_mode||e.toggle_inspector(k.inspector),e.toggle_world_time_component(k.world_time_component)}e.draw_thread_after_runner.push(()=>{C$2.close_modal_processing(),e.dispatchEvent("change@scene",{update_panel:!1}),e.reset_animation(0);for(let[k,O]of b)O.object.position.copy(O.position),O.object.target&&O.object.target.copy(O.target);window.app_mode||e.stacked_error.length>0&&(C$2.modal_ok_cancel("Error",e.stacked_error.join("<br>"),{cancel:null},()=>{}),e.stacked_error=[]),e.dispatchEvent("ready@main",{}),e.main_is_ready5=!0;{const k=DMC.base_renderer.domElement,O=L=>{L<=0?k.style.opacity="1":(k.style.opacity=`${1-L}`,setTimeout(()=>{O(L-.2)},30))};O(1)}}),e.scene.isXRMode&&!window.app_mode&&(await e.initializeXRWithUI(),e.xr?.showXRHugeButton?.()),test_code(),window.dispatchEvent(new Event("resize"))}}let M=-1,S=-1;function D(k=!1){const O=e.canvas,L=O.clientWidth,P=O.clientHeight;if(k==!1&&L==M&&P==S)return;const N=e.overlay_canvas2d;e.overlay_canvas2d.getContext("2d").clearRect(0,0,e.overlay_canvas2d.width,e.overlay_canvas2d.height),N.width=L,N.height=P,debug$1&&console.log("resize_canvas:",L,P),(k||S!=P||M!=L)&&(window.debug&&console.log("Resizse:",L,P,e.overlay_canvas2d.clientWidth,e.overlay_canvas2d.clientHeight),e.draw_thread_before_runner.push(()=>{e.getRenderer().setSize(L,P);const K=e.getCameras();for(const Z of K)Z.aspect=L/P,Z.updateProjectionMatrix();if(e.current.renderer_key=="Deferred")for(const Z in e.render_passes){const V=e.render_passes[Z];V.setSize&&V.setSize(L,P)}e.scene?.traverse?.(Z=>{Z.getRenderTarget?.()?.setSize&&(console.log("SetSize",Z.name),Z.getRenderTarget().setSize(L,P))})}),M=O.clientWidth,S=O.clientHeight),e.csm&&e.csm.updateFrustums()}if(await initialize_resizer(),window.addEventListener("resize",()=>{window.resizable_window_resize&&window.resizable_window_resize(),D(!0),e.request_display&&e.request_display(!1),setTimeout(()=>{window.resizable_window_resize&&window.resizable_window_resize();for(const k of e.resize_event_after_runner)k();e.resize_event_after_runner=[]},0)}),document.addEventListener("resizable.resize",k=>{D()}),e.resize_event_after_runner.push(async()=>{e.register_render_loop(),e.main_is_ready4?y():w=setInterval(y,50)}),window.dispatchEvent(new Event("resize")),local_search_box_UI(),window.current_code="local_search_box_UI",!window.app_mode){console.log("EDITOR MODE");{const O=$ID("main_frame"),L=$CDM("button");L.style.cssText="margin-right:5px;width:27px;height:22px;position:absolute;right:0px;bottom:0px;border-radius: 7px 7px 0px 0px;opacity:0.75";const P=$CDM("i");P.classList.add("bi","bi-dash-lg"),P.style.color="gray",L.appendChild(P),C$2.no_propagation(L),L.onclick=function(N){N.stopPropagation(),N.preventDefault(),toggle_bottom_window()},O.appendChild(L)}if(calculate_coordinates_of_tips(),await __storage__.editor.get("last_right_panel_tab")){const O=$ID(await __storage__.editor.get("last_right_panel_tab"));O&&O.click()}else{const O=$ID("right_side_panel_tab_graphics_button");O&&O.click()}const k=$QS("input");for(let O=0;O<k.length;O++)k[O].setAttribute("autocomplete","off")}window.external_io==null&&window.nodejs&&window.nodejs.ipcRenderer.invoke("has_asset_browser_window").then(async k=>{if(k){const L=await(await ExternalIO$1.get_current_io_config()).getWindowSessions();Object.keys(L.sessions).length>0&&asset_browser()}})}window.PrepareFromSystemResource=async function(s,e={}){e&&Object.assign({just_store:!0},e);const r=await window.external_io.driver;if((r=="indexeddb"||r=="webdav"||r=="aws_s3"||r=="websocketfs")&&await window.cross_file_system.exists(s)==!1){const l=await(await fetch(s)).arrayBuffer();await window.cross_file_system.write(s,l),console.log("PrepareFromSystemResource-Copied:",s)}};async function ExternalStorage(s={}){const e={event_listener:f=>{}};s&&Object.assign(e,s);const i=window.force_io_driver;if(i=="http"||i=="websocket")return window.external_io=await ExternalIO$1.create_io(i,{url:"/",event_listener:e.event_listener,purpose:"Force driver"}),DMC.display_meta_information("I/O",i,"external_io_current_driver_flag"),{driver:i};let r=null,o=null;if((i==null||i=="native")&&(o=$ID("right_side_panel_tab_storage"),r=$ID("external_storage"),r==null))return{driver:"native"};const l=await ExternalIO$1.get_current_io_config();let a={drivers:{}};if(l&&r)try{a=await l.getRaw();const f=a.drivers;r.value=a.current_driver,r.onchange();const m=document.getElementsByClassName("storage_panel_card");for(let h=0;h<m.length;h++)m[h].style.display="none";$ID(a.current_driver+"_panel").style.display="block";for(const h in f){const _=f[h];for(let b in _){const v=`${h}_${b}`,w=$ID(v);w&&(w.type=="checkbox"?w.checked=_[b]:w.value=_[b])}}$ID("external_storage").value=a.current_driver?a.current_driver:"native"}catch(f){console.error(f),await __storage__.system.delete("external_storage")}const c=$ID("right_side_panel_tab_storage");c&&(c.ondrop=async function(f){if(f.stopPropagation(),f.preventDefault(),c.classList.remove("dragover"),f.dataTransfer.items){let m=function(v,w,y){return new Promise((M,S)=>{let D=0;const k=v.length;for(let O=0;O<v.length;O++){const L=v[O].webkitGetAsEntry();L&&UC$1.traverse_file_tree(L,null,(P,N)=>{console.log("File",N),y.push({file:N,file_path:P})},P=>{w.push(P),console.log("Dir",P)},{counter:0,finish:()=>{D++,console.log(D==k,D,k),D==k&&(console.log("finish"),M())}})}})};const h=f.dataTransfer.items,_=[],b=[];await m(h,_,b);{const v=[];await Promise.all(v)}if(b.length>0)for(let v=0;v<b.length;v++){const w=b[v],y=new FileReader;y.onload=async function(M){const S=M.target.result,D=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(S)));for(const k in D.drivers){const O=D.drivers[k];for(const L in O){const P=O[L],N=$ID(`${O.type}_${L}`);N&&(N.type=="checkbox"?N.checked=P:N.value=P)}}D.current_driver&&D.drivers&&(D.current_driver&&(r.value=D.current_driver,r.onchange()),await(await ExternalIO$1.get_current_io_config()).setRawFromJObject(D))},y.onerror=async function(M){console.error(M)},y.readAsArrayBuffer(w.file)}}},c.ondragover=function(f){c.classList.add("dragover"),f.stopPropagation(),f.preventDefault()},c.ondragleave=function(f){c.classList.remove("dragover"),f.stopPropagation(),f.preventDefault()},c.ondragend=c.ondragleave);let d=null,u=r?.value||i;if(!window.is_electron&&(u=="native"||u==null)&&(u="indexeddb",DMC.display_meta_information("I/O","indexeddb","external_io_current_driver_flag")),u=="native")DMC.display_meta_information("I/O","native","external_io_current_driver_flag");else{const f=o?.querySelectorAll("input"),m=o?.querySelectorAll("select");if(f){const k=[];for(let O=0;O<f.length;O++)k.push(f[O]);for(let O=0;O<m.length;O++)k.push(m[O]);for(let O=0;O<k.length;O++){const L=k[O],P=L.dataset.type;if(P==null)continue;const z=L.id.slice(P.length+1);a.drivers[P]==null&&(a.drivers[P]={}),L instanceof HTMLInputElement&&L.type=="checkbox"?a.drivers[P][z]=L.checked:a.drivers[P][z]=L.value}}const h=C$2.get_url_query("project")||await GetProjectPath();h&&(h.indexOf("http")==0||i=="http")&&(u="http");let _=a.drivers[u];if(u=="http"?(d="/",await SetProjectPath(decodeURIComponent(h)),_={workspace:"/"}):u=="websocket"?(d="/",await SetProjectPath(decodeURIComponent(h)),_={workspace:"/",url:"ws"}):u=="memory"||u=="indexeddb"?(d="/",_={workspace:"/"}):(a.current_driver=u,d=_.last_file_browser_path||_.workspace),console.log("Driver:",u),u=="local"&&window.nodejs)if(_.workspace.indexOf("~")>=0){const k=_.workspace;_.prefix=k[0]==="~"?window.nodejs.path.join(define_process_env_default.HOME||define_process_env_default.USERPROFILE,k.slice(1)):k}else _.prefix=window.nodejs.path.resolve(_.workspace);_.event_listener=e.event_listener,debug$1&&console.log("Last file browser path:",d),DMC.display_meta_information("I/O","native","external_io_current_driver_flag");const b=__vitePreload(()=>import("./file_browser@BBP9F_ql.js"),[],import.meta.url),v=await ExternalIO$1.create_io(u,_),w=await b,y=new w.default,M=$ID("file_browser_left_panel"),S=$ID("file_browser_right_panel");let D=[];if(v){window.file_browser=y,window.external_io=v;const O=await window.cross_file_system.resolve(_.workspace);await window.cross_file_system.exists(O)||await window.cross_file_system.mkdir(O,{recursive:!0});const L=await y.initialize({entry_point:_.workspace,left_dom:M,right_dom:S,io:v,make_dir:!0,left_directory_collapse_table:_.left_directory_collapse_table});L.error&&C$2.modal_ok_cancel("Error",`<br><div style='color:red'>Description: ${L.error}</div><br>I/O Driver: "ExternalIO.${v.driver}"<br><br>`,{cancel:null}),y.event_listener=async function(P){debug$1&&console.log("file_browser.event_listener",P);let N=null;if(P.name=="open")load_files([P.absolute_path],P.params).then(()=>{});else if(P.name=="file_browser"){const K=await(await ExternalIO$1.get_current_io_config()).getCurrentDriver();y.left_directory_collapse_table[y.file_browser_current_path]=!0,K.last_file_browser_path=y.file_browser_current_path,K.left_directory_collapse_table=y.left_directory_collapse_table,await K.store()}else if(P.name=="modified_directory_browser"){const K=await(await ExternalIO$1.get_current_io_config()).getCurrentDriver();K.left_directory_collapse_table=y.left_directory_collapse_table,await K.store()}else if(P.name=="open_in_asset_browser")await asset_browser(),window.asset_browser_windows[0].send({event:"open_in_asset_browser",search_path:P.absolute_path||P.search_path});else if(P.name=="open_in_app")await window.cross_file_system.open_in_app(P.absolute_path);else if(P.name=="open_folder")await window.cross_file_system.open_folder(P.absolute_path);else if(P.name=="save_project")await Builder3D.save_project(P.absolute_path);else if(P.name=="change_to_absolute_path"){C$2.modal_processing("Converting....");try{const z=P.absolute_path;await Builder3D.replace_path_as_absolute(z),C$2.close_modal_processing()}catch(z){C$2.close_modal_processing(),C$2.modal_ok_cancel("Error",z.stack??z)}}else if(P.name=="change_to_relative_path"){C$2.modal_processing("Converting....");try{const z=P.absolute_path;await Builder3D.replace_path_as_relative(z),C$2.close_modal_processing()}catch(z){C$2.close_modal_processing(),C$2.modal_ok_cancel("Error",z.stack??z)}}else if(P.name=="make_thumbnail")await C$2.screenshot(P.absolute_path,{type:"save",thumbnail:!0}),y.update(!1,!0,!1);else if(P.name=="stop_sound"){for(const z of D)try{z.stop()}catch{}D=[]}else if(P.name=="play_sound"){for(const z of D)try{z.stop()}catch{}D=[];try{const z=await sound(P.file_path),K=new Audio$1(DMC.sound_listener);K.setBuffer(z),K.setLoop(!1),D.push(K),P.onEnded&&(K.onEnded=P.onEnded),K.play(),N=z}catch(z){console.error(z)}}return N},d&&(_.last_file_browser_path=d),DMC.display_meta_information("I/O",u.slice(0,5),"external_io_current_driver_flag")}else console.log("No FS driver")}if(window.is_electron){const f=$QS(".online_io_mode_only");for(let m=0;m<f.length;m++)f[m].remove()}else{const f=$QS(".native_io_mode_only");for(let m=0;m<f.length;m++)f[m].remove()}{const f=$ID(u+"_panel")?.querySelectorAll("input");if(f){const m={};for(let b=0;b<f.length;b++){const v=f[b];v.type=="checkbox"?m[v.id.slice(u.length+1)]=v.checked:m[v.id.slice(u.length+1)]=v.value}const h=await ExternalIO$1.get_current_io_config();await h.setCurrentDriverName(u);const _=await h.getCurrentDriver();Object.assign(_,m),await _.store()}}return{driver:u}}function terminal_interactive_console(){const s=$ID("terminal_interactive_console");if(s&&s.onkeydown==null){let e=[""],i=0;s.onkeydown=function(r){if(!(s instanceof HTMLInputElement))throw new TypeError;if(r.code=="Enter"&&r.isComposing==!1){const o=s.value;if(o.length>0){s.value="",window.script_runner(o,{print:!0}),e=e.filter(a=>a.length>0);let l=e.filter(a=>a!=o);l.push(o),l=[""].concat(l),e.length=0;for(const a of l)e.push(a);i=e.length}r.stopPropagation(),r.preventDefault()}else r.code=="ArrowUp"?(i-1>=0&&(i--,s.value=e[i]),r.stopPropagation(),r.preventDefault()):r.code=="ArrowDown"&&(i+1<e.length?(i++,s.value=e[i]):(i=e.length,s.value=""),r.stopPropagation(),r.preventDefault())}}}terminal_interactive_console();async function local_search_box_UI(){const s=$ID("__editor_search_data_list_on_file_browser_for_local_window__");if(s!=null&&window.is_electron&&window.nodejs){let e=function(){i.innerHTML="";for(const w of c.slice(0).reverse()){const y=$CDM("div"),M=C$2.DPath(w[w.length-1]=="/"?w.slice(0,w.length-1):w);y.innerHTML=`<span style='color:#444'>${M.dirname}</span><span>${M.basename}</span>`,y.style.fontFamily="Arial, sans-serif",y.style.position="relative",y.style.width="calc( 100% - 5px - 10px )",y.style.textOverflow="ellipsis",y.style.overflow="hidden",y.style.whiteSpace="nowrap",y.style.marginLeft="3px",y.style.direction="rtl",y.style.textAlign="right",y.style.cursor="pointer",y.style.paddingLeft="10px";let S=$CDM("i");S.classList.add("bi"),S.classList.add("bi-x-circle"),S.style.fontSize="12px",S.style.opacity="0.5",S.style.position="absolute",S.style.width="12px",S.style.height="12px",S.style.left="0px",S.style.top="1px",S.onmouseover=function(){S.style.opacity="1.0"},S.onmouseout=function(){S.style.opacity="0.5"},S.onmousedown=S.onclick=function(D){D.stopPropagation(),D.preventDefault()},S.onmouseup=async function(D){c=c.filter(k=>k!=w),y.remove(),D.stopPropagation(),D.preventDefault(),await r()},y.appendChild(S),y.onmouseup=async function(D){if(D.button==0){if(!(u instanceof HTMLInputElement))throw new TypeError;u.value="",await l(w.replace(/\\/g,"/")),$ID("__editor_search_path_on_file_browser_for_local__").innerText=w,b(!0)}else D.button==2&&C$2.popup_menu(D,[{key:"Open in Folder",callback:()=>{window.nodejs.open_in_finder(w)}},{key:"Remove from history",callback:async()=>{c=c.filter(k=>k!=w),await r(),e()}},{key:"Clear all history",callback:async()=>{c=[],await r(),e()}}],{},(k,O,L)=>{L.callback()})},i.appendChild(y)}};const i=$ID("file_browser_left_panel");i.style.fontSize="12px",i.style.marginBottom="1px";const r=async()=>await __storage__.editor_permanent.set("local_search_path_history",JSON.stringify(c)),o=async()=>JSON.parse(await __storage__.editor_permanent.get("local_search_path_history","[]")),l=async w=>await __storage__.editor_permanent.set("local_search_path",w),a=async()=>await __storage__.editor_permanent.get("local_search_path");let c=await o();async function d(){const w={};for(const y of c)window.nodejs.fs.existsSync(y)&&(w[y]=y);c=Object.keys(w),await r()}await d(),e();const u=$ID("__editor_search_box_on_file_browser_for_local__");if(!(u instanceof HTMLInputElement))throw new TypeError;u.style.color="#0AF",u.style.textIndent="3px";const f=async()=>await __storage__.editor_permanent.set("local_search_box",u.value),m=async()=>await __storage__.editor_permanent.get("local_search_box","");u.value=await m();const h=window.nodejs.fs;let _=null;async function b(w){if(!(u instanceof HTMLInputElement))throw new TypeError;const y=$ID("__editor_search_path_on_file_browser_for_local__").innerText,M=$ID("__editor_search_data_list_on_file_browser_for_local__");M.innerHTML="";const S=[];s.onclick=function(){const Y=document.getElementsByClassName("active_window");for(let q=0;q<Y.length;++q)Y[q].classList.remove("active_window");s.classList.add("active_window")},w&&C$2.modal_processing("Loading","");const D=0,k=1,O=2;window.search_data_list_on_file_browser_for_local_sort_by_name=function(){window.search_data_list_on_file_browser_for_local_sort_by_name_order=window.search_data_list_on_file_browser_for_local_sort_by_name_order===void 0?0:window.search_data_list_on_file_browser_for_local_sort_by_name_order+1;const Y=window.search_data_list_on_file_browser_for_local_sort_by_name_order%2,q=D,J=function(W,te){return Y?W.element.children[q].dataset.sort_value.toLowerCase().localeCompare(te.element.children[q].dataset.sort_value.toLowerCase()):te.element.children[q].dataset.sort_value.toLowerCase().localeCompare(W.element.children[q].dataset.sort_value.toLowerCase())};S.sort(J),window.search_data_list_on_file_browser_for_local_mask()},window.search_data_list_on_file_browser_for_local_sort_by_date=function(){window.search_data_list_on_file_browser_for_local_sort_by_date_order=window.search_data_list_on_file_browser_for_local_sort_by_date_order===void 0?0:window.search_data_list_on_file_browser_for_local_sort_by_date_order+1;const Y=window.search_data_list_on_file_browser_for_local_sort_by_date_order%2,q=O,J=function(W,te){const ie=W.element.children[q].dataset.sort_value,oe=te.element.children[q].dataset.sort_value;return Y?ie<oe?-1:ie>oe?1:0:ie<oe?1:ie>oe?-1:0};S.sort(J),window.search_data_list_on_file_browser_for_local_mask()},window.search_data_list_on_file_browser_for_local_sort_by_size_browser_for_local_sort_by_date=function(){window.search_data_list_on_file_browser_for_local_sort_by_size_browser_for_local_sort_by_date_order=window.search_data_list_on_file_browser_for_local_sort_by_size_browser_for_local_sort_by_date_order===void 0?0:window.search_data_list_on_file_browser_for_local_sort_by_size_browser_for_local_sort_by_date_order+1;const Y=window.search_data_list_on_file_browser_for_local_sort_by_size_browser_for_local_sort_by_date_order%2,q=k,J=function(W,te){const ie=Number(W.element.children[q].dataset.sort_value),oe=Number(te.element.children[q].dataset.sort_value);return Y?ie<oe?-1:ie>oe?1:0:ie<oe?1:ie>oe?-1:0};S.sort(J),window.search_data_list_on_file_browser_for_local_mask()};let L=null;const P=async()=>await __storage__.editor_permanent.get("local_search_mask","all"),N=async Y=>await __storage__.editor_permanent.set("local_search_mask",Y);window.search_data_list_on_file_browser_for_local_mask=async function(Y){Y==null&&(Y="all"),await N(Y);const q=new Set,J=s.querySelectorAll("i.mask_group");if(Y=="all"){q.add("model"),q.add("motion"),q.add("scene");for(let te=0;te<J.length;te++)J[te].classList.remove("toggle")}else{for(let ie=0;ie<J.length;ie++)J[ie].classList.add("toggle");s.querySelector("i."+Y).classList.remove("toggle"),q.add(Y)}M.innerHTML="";let W=null;for(const te of S){let ie=Builder3D.file_type(te.data);if(ie=ie.replace("sound","motion").replace("project","scene"),ie=="j_object"){const oe=C$2.DPath(te.data).ext;oe=="object"?ie="model":oe=="motion"&&(ie="motion")}q.has(ie)&&(W!=null&&W!=te.element.dataset.dir_path?(te.element.style.borderTop="1px solid #333",te.element.style.marginTop="3px",te.element.style.paddingTop="3px"):(te.element.style.borderTop="0px solid #333",te.element.style.paddingTop="0px",te.element.style.marginTop="0px"),W=te.element.dataset.dir_path,M.appendChild(te.element))}},window.search_data_list_on_file_browser_for_local_mask(await P());let z=0;u.onchange=u.oninput=async function(Y){await f(),z++;const q=()=>{const W=u.value.toLowerCase().normalize("NFC").split(" ");if(z==1){let te=null;for(let ie=0;ie<S.length;ie++){const oe=S[ie];let Ce=!0;oe.element.classList.remove("active"),oe.element.classList.remove("hit");const ve=oe.data.toLowerCase().normalize("NFC");for(const we of W)ve.indexOf(we)==-1&&(Ce=!1);Ce?(te==null&&(te=oe.element,oe.element.classList.add("active")),oe.element.classList.add("hit"),oe.element.style.display="flex"):oe.element.style.display="none"}L&&(L(),L=null)}z--};u.dataset.immediately=="true"?(u.dataset.immediately="false",q()):setTimeout(q)},u.onkeydown=function(Y){(Y.code=="ArrowUp"||Y.code=="ArrowDown"||Y.code=="Enter"&&Y.isComposing==!1)&&(Y.preventDefault(),Y.stopPropagation(),window.GlobalKeymaps.local_search_window(Y))};const K=performance.now(),Z=await C$2.nodejs_finder(y,C$2.available_app_exts);for(let Y=0;Y<Z.length;Y++)Z[Y].absolute_path=C$2.DPath(Z[Y].absolute_path).path;console.log("Find:",Math.floor(performance.now()-K),"ms"),w&&C$2.close_modal_processing();let V=0;for(let Y=0;Y<Z.length;Y++){let q=function(Se,Re,Fe){let $e,Ue,qe,_e,be,De,Te,ge;switch(arguments.length===1&&(Re=Se.s,Fe=Se.v,Se=Se.h),_e=Math.floor(Se*6),be=Se*6-_e,De=Fe*(1-Re),Te=Fe*(1-be*Re),ge=Fe*(1-(1-be)*Re),_e%6){case 0:$e=Fe,Ue=ge,qe=De;break;case 1:$e=Te,Ue=Fe,qe=De;break;case 2:$e=De,Ue=Fe,qe=ge;break;case 3:$e=De,Ue=Te,qe=Fe;break;case 4:$e=ge,Ue=De,qe=Fe;break;case 5:$e=Fe,Ue=De,qe=Te;break}return{r:Math.round($e*255),g:Math.round(Ue*255),b:Math.round(qe*255)}};const J=C$2.DPath(Z[Y].absolute_path);J.ext;let W=J.path;const te=W.split("/");W=te.slice(te.length-3,te.length).join("/");const ie=$CDM("div"),oe=$CDM("div"),Ce=$CDM("div"),ve=$CDM("div");ie.style.display="none",ie.style.alignItems="center",ie.style.cursor="pointer",ie.style.width="100%",ie.style.height="13px",ie.style.fontSize="12px",ie.style.marginBottom="1px",ie.style.fontFamily="Arial, sans-serif",ie.classList.add("search_data_item_on_file_browser_for_local"),ie.classList.add("hit"),ie.classList.add("no_select"),ie.dataset.absolute_path=J.path,ie.dataset.dir_path=J.dirname,ie.style.opacity="0.9",ie.style.borderBottom="1px solid #44444400",ie.draggable=!0,ie.ondragstart=function(Se){Se.dataTransfer.setData("json",JSON.stringify({items:[J.path],target_file_paths:[{absolute_path:J.path}]})),Se.stopPropagation()};let we=null;ie.onmouseover=async function(Se){ie.style.opacity="1.0",ie.style.borderBottom="1px solid #444",we&&we.remove(),we=null;const Re=C$2.make_thumbnail_path(J.path);if(await window.cross_file_system.exists(Re)){we=$CDM("img"),we.style.cssText="width:128px;height:128px;position:fixed;border:1px solid #444;border-radius:5px;z-index:2",we.src=C$2.make_thumbnail_path(J.path);const Fe=$ID("main_frame").getBoundingClientRect(),$e=Fe.left,Ue=Fe.bottom;we.style.left=`${$e}px`,we.style.top=`${Ue-128}px`,document.body.appendChild(we)}},ie.onmouseout=function(Se){ie.style.opacity="0.9",ie.style.borderBottom="1px solid #44444400",we&&we.remove(),we=null},oe.style.display="inline-block",Ce.style.display="flex",ve.style.display="inline-block",ve.style.textAlign="right",Ce.style.textAlign="right",oe.style.width="auto",oe.style.textOverflow="ellipsis",oe.style.overflow="hidden",oe.style.whiteSpace="nowrap",oe.style.marginLeft="3px",oe.style.direction="rtl",oe.style.textAlign="right",oe.style.marginLeft="auto",ve.classList.add("nowrap"),Ce.classList.add("nowrap"),ve.style.minWidth=ve.style.width="45px",ve.style.paddingRight="5px",Ce.style.minWidth=Ce.style.width="100px";{const Se=J.path,Re=Se.split(".").pop(),Fe=Se.slice(0,Se.lastIndexOf("/")),$e=Se.split("/").pop(),Ue=$e.slice(0,$e.lastIndexOf("."));let qe="#F88";Ue=="scene"&&(qe="#444");const _e=`<span  class="search_data_item_on_file_browser_for_local_dir_text">${Fe}/</span>`,be=`<span style="color:${qe}">${Ue}</span>`;oe.innerHTML=`‪<span>${_e}${be}.<span style="color:#A85">${Re}</span></span>‬`}oe.dataset.sort_value=W,h.stat(J.path,(Se,Re)=>{if(Re.isFile()){const Fe=Re.mtime.getFullYear(),$e=("0"+(Re.mtime.getMonth()+1)).slice(-2),Ue=("0"+(Re.mtime.getDate()+1)).slice(-2),qe=("0"+(Re.mtime.getHours()+1)).slice(-2),_e=("0"+(Re.mtime.getMinutes()+1)).slice(-2);Ce.innerHTML=`<span style='color:#888;'>${Fe}/${$e}/${Ue} ${qe}:${_e}</span>`;let be="";const De="<span style='display:inline-block;width:4px;height:10px;font-family: monospace'></span>";Re.size/1024<1?be="1"+De+"KB":Re.size/1024/1024<1?be=Math.floor(Re.size/1024)+De+"KB":Re.size/1024/1024/1024<1?be=(Re.size/1024/1024).toFixed(1)+De+"MB":Re.size/1024/1024/1024/1024<1&&(be=(Re.size/1024/1024/1024).toFixed(1)+De+"GB"),ve.dataset.sort_value=Re.size,Ce.dataset.sort_value=`${Fe}/${$e}/${Ue} ${qe}:${_e}`;let Te=Re.size/(1024*2)/(10*1024);Te=Te>.6?.6:Te,Te=Te+.4;const ge=q(1-Te%1,.8,.7);ve.innerHTML=`<span style='font-family: monospace;color:rgb(${ge.r},${ge.g},${ge.b})'>${be}</span>`,Re.size,M.appendChild(ie),S.push({element:ie,data:W})}V++,V==Z.length&&H()}),ie.appendChild(oe),ie.appendChild(ve),ie.appendChild(Ce);{const Se=await __storage__.editor_permanent.get("local_search_focused_path");Se&&Se==ie.dataset.absolute_path&&(_=ie)}ie.onclick=async function(){for(const Re of S)Re.element.classList.remove("active");ie.classList.add("active"),await __storage__.editor_permanent.set("local_search_focused_path",ie.dataset.absolute_path);const Se=$ID("local_search_audio");Se&&Se.remove()},ie.ondblclick=function(){const Se=ie.dataset.absolute_path;load_files([Se],{confirm:!1})},ie.onmouseup=async function(Se){if(Se.button==2){for(const $e of S)$e.element.classList.remove("active");ie.classList.add("active"),await __storage__.editor_permanent.set("local_search_focused_path",ie.dataset.absolute_path);async function Re($e){if($e.code=="KeyD"){await window.cross_file_system.remove(ie.dataset.absolute_path,{existence_check:!0});for(let Ue=0;Ue<S.length;Ue++)if(ie==S[Ue].element){S[Ue].element.remove(),S.splice(Ue,1);break}$e.preventDefault(),$e.stopPropagation()}}const Fe=["Open in App","Open in Folder",{key:"<span style='float:left'>Delete File</span><span style='float:right;color:gray'>D</span>",value:"Delete File"}];C$2.popup_menu(Se,Fe,{event_listener:Re},async $e=>{if($e=="Open in App")window.nodejs&&window.nodejs.open_in_native(ie.dataset.absolute_path);else if($e=="Open in Folder")window.nodejs&&window.nodejs.open_in_finder(ie.dataset.absolute_path);else if($e=="Delete File"){await window.cross_file_system.remove(ie.dataset.absolute_path,{existence_check:!0});for(let Ue=0;Ue<S.length;Ue++)if(ie==S[Ue].element){S[Ue].element.remove(),S.splice(Ue,1);break}}})}}}async function H(){L=async function(){const q=await __storage__.editor_permanent.get("local_search_focused_path");q&&_&&(_.click(),_.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),console.log("Focused:",q))},u.dataset.immediately="true",u.onchange();const Y=await __storage__.editor_permanent.get("local_search_mask");Y&&window.search_data_list_on_file_browser_for_local_mask(Y)}}const v=await a();v&&h.existsSync(v)&&($ID("__editor_search_path_on_file_browser_for_local__").innerText=v,b()),$ID("__editor_search_path_clear_button_on_file_browser_for_local__").onclick=async function(){$ID("__editor_search_path_on_file_browser_for_local__").innerText="";const w=await a();c=c.filter(M=>M!=w),await r(),await l(null);const y=$ID("__editor_search_data_list_on_file_browser_for_local__");y.innerHTML="",e()},UC$1.make_drag_and_drop(s,{file:!1,directory:!0,recursive:!1},async w=>{const y=w.item;h.stat(y,async(M,S)=>{if(S.isDirectory()){await l(y.replace(/\\/g,"/")),$ID("__editor_search_path_on_file_browser_for_local__").innerText=y,c.push(y.replace(/\\/g,"/"));const D={};for(const k of c)D[k]=k;c=Object.keys(D),await r(),e(),b(!0)}else C$2.modal_ok_cancel("Error",`<div>${w}</div><div>Must be directory.</div>`,{cancel:null})})}),UC$1.make_drag_and_drop(i,{file:!1,directory:!0,recursive:!1},async w=>{const y=w.item;h.stat(y,async(M,S)=>{if(S.isDirectory()){c.push(y.replace(/\\/g,"/"));const D={};for(const k of c)D[k]=k;c=Object.keys(D),await r(),e()}else C$2.modal_ok_cancel("Error",`<div>${w}</div><div>Must be directory.</div>`,{cancel:null})})}),window.search_data_list_on_file_browser_for_local_refresh=b}}async function on_loaded(){debug$1&&console.log("on_loaded"),_entry_point_(),SetupMainPanelListener(),document.addEventListener("keyup",s=>{if(window.app_mode||(s.code=="KeyR"&&(s.ctrlKey||s.metaKey)&&s.preventDefault(),s.shiftKey&&s.code=="KeyI"&&(s.ctrlKey||s.metaKey)))return;let e=$Q(".active_window");if(e==null&&(e=$ID("main_frame")),!(e instanceof HTMLElement))throw new TypeError;const i=document.activeElement.tagName.toUpperCase();if(i=="INPUT"||i=="SELECT"||i=="TEXTAREA")return;const o=GlobalKeymaps[e.dataset.type],l=typeof o;if(l==="function")o(s);else if(l==="object"){const a=o.geometry_controller,c=o[window.DMC?.current_tool_module]??a;a==c?a?.onkeyup?.(s):c&&c.onkeyup?.(s)&&a.onkeyup?.(s)}s.preventDefault()}),document.addEventListener("keydown",async s=>{if(window.app_mode||window.DMC==null||s.shiftKey&&s.code=="KeyI"&&(s.ctrlKey||s.metaKey))return;if(s.code=="KeyS"&&s.shiftKey&&(s.ctrlKey||s.metaKey)){s.preventDefault(),s.stopPropagation(),debug$1&&console.log("Save Project"),await Builder3D.save_project(null);return}else if(s.code=="KeyR"&&(s.ctrlKey||s.metaKey))s.preventDefault();else if(s.code=="KeyS"&&(s.ctrlKey||s.metaKey)){s.preventDefault(),s.stopPropagation(),debug$1&&console.log("Save Project"),await Builder3D.save_project();return}else if(s.code=="KeyQ"&&(s.ctrlKey||s.metaKey)){window.close();return}else if(s.code=="KeyW"&&(s.ctrlKey||s.metaKey)){s.preventDefault(),s.stopPropagation();return}let e=$Q(".active_window");e==null&&(e=$ID("main_frame"));const i=document.activeElement;if(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement){s.code=="Escape"&&i.blur();return}if(e instanceof HTMLElement){const r=GlobalKeymaps[e.dataset.type],o=typeof r;if(o==="function")r(s);else if(o==="object"){const l=r.geometry_controller,a=r[window.DMC?.current_tool_module]??l;l==a?l?.onkeydown?.(s):a&&a.onkeydown?.(s)&&l.onkeydown?.(s)}s.code=="KeyC"&&(s.ctrlKey||s.metaKey)||s.code=="KeyV"&&(s.ctrlKey||s.metaKey)||s.preventDefault()}})}window.is_electron||(new URL(location.href).host.indexOf("localhost")==-1,"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(i=>{i&&i.unregister()}));document.addEventListener("visibilitychange",()=>{console.warn("VISIBILITY CHANGE to",document.visibilityState),document.visibilityState!=="visible"||document.hidden?(document.getElementById("stop_button")?.click?.(),window.DMC?.stop?.(),window.lock_rendering?.()):window.unlock_rendering?.()},!1);export{ShaderLib as $,AdditiveBlending as A,BufferGeometry as B,C$2 as C,DoubleSide as D,Euler as E,FloatType as F,Group as G,HalfFloatType as H,DepthTexture as I,DepthStencilFormat as J,UnsignedInt248Type as K,Line as L,Mesh as M,NearestFilter as N,Object3D as O,PerspectiveCamera as P,Quaternion as Q,RGBAFormat as R,SphereGeometry as S,DataTexture as T,UniformsUtils as U,Vector3 as V,WebGLRenderTarget as W,UnsignedByteType as X,RepeatWrapping as Y,ZeroFactor as Z,__vitePreload as _,MeshPhysicalMaterial as a,MeshLambertMaterial as a$,MathUtils as a0,RendererState as a1,BlueNoiseGenerator as a2,LinearMipMapLinearFilter as a3,Matrix3 as a4,UnsignedShortType as a5,SrcAlphaFactor as a6,OneMinusSrcAlphaFactor as a7,NormalBlending as a8,Plane as a9,RGBA_S3TC_DXT5_Format$1 as aA,RGBA_S3TC_DXT3_Format$1 as aB,RGB_S3TC_DXT1_Format$1 as aC,DataTextureLoader as aD,CubeTexture as aE,DataUtils as aF,NoColorSpace as aG,RGBA_PVRTC_4BPPV1_Format as aH,RGB_PVRTC_4BPPV1_Format as aI,RGBA_PVRTC_2BPPV1_Format as aJ,RGB_PVRTC_2BPPV1_Format as aK,ShapeUtils as aL,Box2 as aM,Shape as aN,Path as aO,ShapePath as aP,ExtrudeGeometry as aQ,Clock as aR,BoxGeometry as aS,AddOperation as aT,EquirectangularRefractionMapping as aU,EquirectangularReflectionMapping as aV,MirroredRepeatWrapping as aW,MeshStandardMaterial as aX,AnimationClip as aY,VectorKeyframeTrack as aZ,QuaternionKeyframeTrack as a_,LinearMipmapLinearFilter as aa,RedFormat as ab,Loader as ac,FileLoader as ad,Data3DTexture as ae,ClampToEdgeWrapping as af,ShaderChunk as ag,Box3 as ah,DirectionalLight as ai,LoaderUtils as aj,FrontSide as ak,DefaultLoadingManager as al,TextureLoader as am,SRGBColorSpace as an,Float32BufferAttribute as ao,LineBasicMaterial as ap,Material as aq,PointsMaterial as ar,LineSegments as as,Points as at,LinearSRGBColorSpace as au,BufferAttribute as av,CompressedTextureLoader as aw,RGB_BPTC_UNSIGNED_Format as ax,RGB_BPTC_SIGNED_Format as ay,RGB_ETC1_Format$1 as az,Color as b,OrthographicCamera as b0,AmbientLight as b1,SpotLight as b2,PointLight as b3,Bone as b4,SkinnedMesh as b5,Skeleton as b6,GLBufferAttribute as b7,AxesHelper as b8,TangentSpaceNormalMap as b9,CanvasTexture as bA,CompressedTexture as bB,Source as bC,Uniform as bD,WebGLRenderer as bE,REVISION as ba,DynamicDrawUsage as bb,ImageLoader as bc,TrianglesDrawMode as bd,TriangleFanDrawMode as be,TriangleStripDrawMode as bf,InstancedMesh as bg,InstancedBufferAttribute as bh,ImageBitmapLoader as bi,InterleavedBuffer as bj,PropertyBinding as bk,LineLoop as bl,InterpolateLinear as bm,ColorManagement as bn,NearestMipmapNearestFilter as bo,LinearMipmapNearestFilter as bp,NearestMipmapLinearFilter as bq,InterpolateDiscrete as br,Texture as bs,InterleavedBufferAttribute as bt,NumberKeyframeTrack as bu,Sphere as bv,Interpolant as bw,Curve as bx,Uint16BufferAttribute as by,Raycaster as bz,ShaderMaterial as c,UniformsLib as d,BackSide as e,Scene as f,MeshPhongMaterial as g,MeshBasicMaterial as h,PlaneGeometry as i,Matrix4 as j,Pass as k,FullScreenQuad as l,ShaderPass as m,CopyShader as n,Vector2 as o,LinearFilter as p,MeshDepthMaterial as q,RGBADepthPacking as r,NoBlending as s,MaterialReplacer as t,MeshNormalMaterial as u,CustomBlending as v,DstColorFactor as w,AddEquation as x,DstAlphaFactor as y,Vector4 as z};
