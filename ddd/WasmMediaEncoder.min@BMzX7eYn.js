var ft=(f,p)=>()=>(p||f((p={exports:{}}).exports,p),p.exports);var ht=ft((Z,Q)=>{(function(f,p){typeof Z=="object"&&typeof Q<"u"?Q.exports=p():typeof define=="function"&&define.amd?define(p):(f=typeof globalThis<"u"?globalThis:f||self).WasmMediaEncoder=p()})(void 0,function(){var f,p=Object.prototype,d=p.hasOwnProperty,A=typeof Symbol=="function"?Symbol:{},b=A.iterator||"@@iterator",tt=A.asyncIterator||"@@asyncIterator",E=A.toStringTag||"@@toStringTag";function R(e,t,r,n){var o=t&&t.prototype instanceof S?t:S,a=Object.create(o.prototype),s=new N(n||[]);return a._invoke=function(c,u,i){var l=z;return function(h,K){if(l===B)throw new Error("Generator is already running");if(l===x){if(h==="throw")throw K;return Y()}for(i.method=h,i.arg=K;;){var X=i.delegate;if(X){var H=W(X,i);if(H){if(H===y)continue;return H}}if(i.method==="next")i.sent=i._sent=i.arg;else if(i.method==="throw"){if(l===z)throw l=x,i.arg;i.dispatchException(i.arg)}else i.method==="return"&&i.abrupt("return",i.arg);l=B;var w=k(c,u,i);if(w.type==="normal"){if(l=i.done?x:et,w.arg===y)continue;return{value:w.arg,done:i.done}}w.type==="throw"&&(l=x,i.method="throw",i.arg=w.arg)}}}(e,r,s),a}function k(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}var z="suspendedStart",et="suspendedYield",B="executing",x="completed",y={};function S(){}function O(){}function g(){}var T={};T[b]=function(){return this};var I=Object.getPrototypeOf,_=I&&I(I(M([])));_&&_!==p&&d.call(_,b)&&(T=_);var v=g.prototype=S.prototype=Object.create(T);function D(e){["next","throw","return"].forEach(function(t){e[t]=function(r){return this._invoke(t,r)}})}function U(e){var t=typeof e=="function"&&e.constructor;return!!t&&(t===O||(t.displayName||t.name)==="GeneratorFunction")}function P(e,t){function r(o,a,s,c){var u=k(e[o],e,a);if(u.type!=="throw"){var i=u.arg,l=i.value;return l&&typeof l=="object"&&d.call(l,"__await")?t.resolve(l.__await).then(function(h){r("next",h,s,c)},function(h){r("throw",h,s,c)}):t.resolve(l).then(function(h){i.value=h,s(i)},function(h){return r("throw",h,s,c)})}c(u.arg)}var n;this._invoke=function(o,a){function s(){return new t(function(c,u){r(o,a,c,u)})}return n=n?n.then(s,s):s()}}function W(e,t){var r=e.iterator[t.method];if(r===f){if(t.delegate=null,t.method==="throw"){if(e.iterator.return&&(t.method="return",t.arg=f,W(e,t),t.method==="throw"))return y;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var n=k(r,e.iterator,t.arg);if(n.type==="throw")return t.method="throw",t.arg=n.arg,t.delegate=null,y;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=f),t.delegate=null,y):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function rt(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(rt,this),this.reset(!0)}function M(e){if(e){var t=e[b];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var r=-1,n=function o(){for(;++r<e.length;)if(d.call(e,r))return o.value=e[r],o.done=!1,o;return o.value=f,o.done=!0,o};return n.next=n}}return{next:Y}}function Y(){return{value:f,done:!0}}O.prototype=v.constructor=g,g.constructor=O,g[E]=O.displayName="GeneratorFunction",D(P.prototype),P.prototype[tt]=function(){return this},D(v),v[E]="Generator",v[b]=function(){return this},v.toString=function(){return"[object Generator]"},N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(F),!e)for(var t in this)t.charAt(0)==="t"&&d.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=f)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(u,i){return a.type="throw",a.arg=e,t.next=u,i&&(t.method="next",t.arg=f),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],a=o.completion;if(o.tryLoc==="root")return r("end");if(o.tryLoc<=this.prev){var s=d.call(o,"catchLoc"),c=d.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&d.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&(e==="break"||e==="continue")&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if(e.type==="throw")throw e.arg;return e.type==="break"||e.type==="continue"?this.next=e.arg:e.type==="return"?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):e.type==="normal"&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),F(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if(n.type==="throw"){var o=n.arg;F(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:M(e),resultName:t,nextLoc:r},this.method==="next"&&(this.arg=f),y}};var m={wrap:R,isGeneratorFunction:U,AsyncIterator:P,mark:function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,E in e||(e[E]="GeneratorFunction")),e.prototype=Object.create(v),e},awrap:function(e){return{__await:e}},async:function(e,t,r,n,o){o===void 0&&(o=Promise);var a=new P(R(e,t,r,n),o);return U(t)?a:a.next().then(function(s){return s.done?s.value:a.next()})},keys:function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function n(){for(;t.length;){var o=t.pop();if(o in e)return n.value=o,n.done=!1,n}return n.done=!0,n}},values:M};const q={mimeType:"audio/mpeg",parseParams:function(e){var t,r;switch(e.bitrate){case void 0:case 8:case 16:case 24:case 32:case 40:case 48:case 64:case 80:case 96:case 112:case 128:case 160:case 192:case 224:case 256:case 320:break;default:throw new Error("Invalid constant bitrate "+e.cbrRate)}if(e.vbrQuality!==void 0&&(e.vbrQuality<0||e.vbrQuality>=10))throw new Error("Invalid VBR quality: "+e.vbrQuality);const n=new Int32Array(2);return n[0]=(t=e.bitrate)!==null&&t!==void 0?t:0,new Float32Array(n.buffer)[1]=(r=e.vbrQuality)!==null&&r!==void 0?r:e.bitrate!==void 0?-1:4,n}},C=-2147483648,nt=2147483647,V={mimeType:"audio/ogg",parseParams:function(e){var t;const r=(t=e.vbrQuality)!==null&&t!==void 0?t:3,n=e.oggSerialNo!==void 0?Math.min(Math.max(Math.floor(e.oggSerialNo),C),nt):Math.floor(4294967296*Math.random())+C;if(r<-1||r>10)throw new Error("Invalid VBR quality "+r);const o=new Int32Array(2);return new Float32Array(o.buffer)[0]=r,o[1]=n,o}};function ot(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function it(e,t){if(e==null)return{};var r,n,o=function(s,c){if(s==null)return{};var u,i,l={},h=Object.keys(s);for(i=0;i<h.length;i++)u=h[i],c.indexOf(u)>=0||(l[u]=s[u]);return l}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$(Object(r),!0).forEach(function(n){ot(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function at(e){const t=e.split(",");if(t.length!==2||/^data:application\/(octet-stream|wasm);base64$/.test(t[0])===!1)throw new Error("Passed non-data URI");return Buffer.from(t[1],"base64")}function st(e){var t,r,n,o,a,s,c,u;return m.async(function(i){for(;;)switch(i.prev=i.next){case 0:if(t={wasi_snapshot_preview1:{proc_exit:()=>{}},env:{emscripten_notify_memory_growth:u=function(){c.HEAPF32=new Float32Array(o.buffer),c.HEAP32=new Int32Array(o.buffer),c.HEAPU8=new Uint8Array(o.buffer)}}},typeof e!="string"||WebAssembly.instantiateStreaming){i.next=17;break}if(typeof fetch<"u"){i.next=9;break}return i.next=6,m.awrap(at(e));case 6:i.t0=i.sent,i.next=16;break;case 9:return i.t1=m,i.next=12,m.awrap(fetch(e));case 12:return i.t2=i.sent.arrayBuffer(),i.next=15,i.t1.awrap.call(i.t1,i.t2);case 15:i.t0=i.sent;case 16:e=i.t0;case 17:return i.next=19,m.awrap(typeof e=="string"?WebAssembly.instantiateStreaming(fetch(e),t):WebAssembly.instantiate(e,t));case 19:return r=i.sent,n=(r.instance||r).exports,o=n.memory,a=n._initialize,s=it(n,["memory","_initialize"]),c=J(J({},s),{},{module:r.module||e}),u(),a(),i.abrupt("return",c);case 25:case"end":return i.stop()}},null,null,null,Promise)}const ct={[q.mimeType]:q,[V.mimeType]:V};class L{constructor(t,r,n){this.mimeType=t,this.t=r,this.i=n}o(t){const r=this.t.enc_get_pcm(this.u,t);if(!r)throw new Error("PCM buffer allocation failed!");const n=this.t.HEAP32.subarray(r>>2,(r>>2)+this.h);return Array.from({length:this.h},(o,a)=>this.t.HEAPF32.subarray(n[a]>>2,(n[a]>>2)+t))}l(t){const r=this.t.enc_get_out_buf(this.u);return this.t.HEAPU8.subarray(r,r+t)}static create(t,r,n){return m.async(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,m.awrap(st(r));case 2:return(o=a.sent).module&&n?.(o.module),a.abrupt("return",new L(t,o,ct[t].parseParams));case 5:case"end":return a.stop()}},null,null,null,Promise);var o}configure(t){this.u&&(this.t.enc_free(this.u),this.u=0);const r=this.i(t),n=this.t.malloc(r.byteLength);if(!n)throw new Error("Failed to allocate parameter buffer");this.t.HEAP32.set(r,n>>2),this.h=t.channels;try{if(this.u=this.t.enc_init(t.sampleRate,t.channels,n),!this.u)throw new Error("Encoder initialization failed!")}finally{this.t.free(n)}}encode(t){const r=this.o(t[0].length);r.forEach((o,a)=>o.set(t[a]));const n=this.t.enc_encode(this.u,r[0].length);if(n<0)throw new Error("Error while encoding "+n);return this.l(n)}finalize(){const t=this.t.enc_flush(this.u);if(t<0)throw new Error("Error while encoding "+t);return this.l(t)}}const G=L.create,ut=G.bind(null,"audio/mpeg","ddd/libs/wasm-media-encoder/mp3.wasm"),lt=G.bind(null,"audio/ogg","ddd/libs/wasm-media-encoder/ogg.wasm"),j=L;return j.createEncoder=G,j.createMp3Encoder=ut,j.createOggEncoder=lt,j})});export default ht();
