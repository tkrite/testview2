var We=Object.defineProperty,Xt=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable,u=Math.pow,Qt=(t,i,s)=>i in t?We(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,Ee=(t,i)=>{for(var s in i||={})Ce.call(i,s)&&Qt(t,s,i[s]);if(Xt)for(var s of Xt(i))be.call(i,s)&&Qt(t,s,i[s]);return t},zt=(t,i,s)=>{if(!i.has(t))throw TypeError("Cannot "+s)},e=(t,i,s)=>(zt(t,i,"read from private field"),s?s.call(t):i.get(t)),r=(t,i,s)=>{if(i.has(t))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(t):i.set(t,s)},d=(t,i,s,a)=>(zt(t,i,"write to private field"),a?a.call(t,s):i.set(t,s),s),h=(t,i,s)=>(zt(t,i,"access private method"),s),Jt=class{constructor(t){this.value=t}},Lt=class{constructor(t){this.value=t}},jt=t=>t<256?1:t<65536?2:t<1<<24?3:t<u(2,32)?4:t<u(2,40)?5:6,Te=t=>{if(t<127)return 1;if(t<16383)return 2;if(t<(1<<21)-1)return 3;if(t<(1<<28)-1)return 4;if(t<u(2,35)-1)return 5;if(t<u(2,42)-1)return 6;throw new Error("EBML VINT size not supported "+t)},B=(t,i,s)=>{let a=0;for(let n=i;n<s;n++){let c=Math.floor(n/8),p=t[c],w=7-(n&7),Se=(p&1<<w)>>w;a<<=1,a|=Se}return a},Ue=(t,i,s,a)=>{for(let n=i;n<s;n++){let c=Math.floor(n/8),p=t[c],w=7-(n&7);p&=~(1<<w),p|=(a&1<<s-n-1)>>s-n-1<<w,t[c]=p}},Ie=class{constructor(){this.buffer=null}},te=class{constructor(t,i,s){this.onData=t,this.onDone=i,this.options=s}},Be=class{constructor(t,i){this.stream=t,this.options=i}},S,f,kt,ee,yt,ie,vt,se,j,Mt,St,ae,At=class{constructor(){r(this,kt),r(this,yt),r(this,vt),r(this,j),r(this,St),this.pos=0,r(this,S,new Uint8Array(8)),r(this,f,new DataView(e(this,S).buffer)),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}seek(t){this.pos=t}writeEBMLVarInt(t,i=Te(t)){let s=0;switch(i){case 1:e(this,f).setUint8(s++,128|t);break;case 2:e(this,f).setUint8(s++,64|t>>8),e(this,f).setUint8(s++,t);break;case 3:e(this,f).setUint8(s++,32|t>>16),e(this,f).setUint8(s++,t>>8),e(this,f).setUint8(s++,t);break;case 4:e(this,f).setUint8(s++,16|t>>24),e(this,f).setUint8(s++,t>>16),e(this,f).setUint8(s++,t>>8),e(this,f).setUint8(s++,t);break;case 5:e(this,f).setUint8(s++,8|t/u(2,32)&7),e(this,f).setUint8(s++,t>>24),e(this,f).setUint8(s++,t>>16),e(this,f).setUint8(s++,t>>8),e(this,f).setUint8(s++,t);break;case 6:e(this,f).setUint8(s++,4|t/u(2,40)&3),e(this,f).setUint8(s++,t/u(2,32)|0),e(this,f).setUint8(s++,t>>24),e(this,f).setUint8(s++,t>>16),e(this,f).setUint8(s++,t>>8),e(this,f).setUint8(s++,t);break;default:throw new Error("Bad EBML VINT size "+i)}this.write(e(this,S).subarray(0,s))}writeEBML(t){var i,s;if(t!==null)if(t instanceof Uint8Array)this.write(t);else if(Array.isArray(t))for(let a of t)this.writeEBML(a);else if(this.offsets.set(t,this.pos),h(this,j,Mt).call(this,t.id),Array.isArray(t.data)){let a=this.pos,n=t.size===-1?1:(i=t.size)!=null?i:4;t.size===-1?h(this,kt,ee).call(this,255):this.seek(this.pos+n);let c=this.pos;if(this.dataOffsets.set(t,c),this.writeEBML(t.data),t.size!==-1){let p=this.pos-c,w=this.pos;this.seek(a),this.writeEBMLVarInt(p,n),this.seek(w)}}else if(typeof t.data=="number"){let a=(s=t.size)!=null?s:jt(t.data);this.writeEBMLVarInt(a),h(this,j,Mt).call(this,t.data,a)}else typeof t.data=="string"?(this.writeEBMLVarInt(t.data.length),h(this,St,ae).call(this,t.data)):t.data instanceof Uint8Array?(this.writeEBMLVarInt(t.data.byteLength,t.size),this.write(t.data)):t.data instanceof Jt?(this.writeEBMLVarInt(4),h(this,yt,ie).call(this,t.data.value)):t.data instanceof Lt&&(this.writeEBMLVarInt(8),h(this,vt,se).call(this,t.data.value))}};S=new WeakMap;f=new WeakMap;kt=new WeakSet;ee=function(t){e(this,f).setUint8(0,t),this.write(e(this,S).subarray(0,1))};yt=new WeakSet;ie=function(t){e(this,f).setFloat32(0,t,!1),this.write(e(this,S).subarray(0,4))};vt=new WeakSet;se=function(t){e(this,f).setFloat64(0,t,!1),this.write(e(this,S))};j=new WeakSet;Mt=function(t,i=jt(t)){let s=0;switch(i){case 6:e(this,f).setUint8(s++,t/u(2,40)|0);case 5:e(this,f).setUint8(s++,t/u(2,32)|0);case 4:e(this,f).setUint8(s++,t>>24);case 3:e(this,f).setUint8(s++,t>>16);case 2:e(this,f).setUint8(s++,t>>8);case 1:e(this,f).setUint8(s++,t);break;default:throw new Error("Bad UINT size "+i)}this.write(e(this,S).subarray(0,s))};St=new WeakSet;ae=function(t){this.write(new Uint8Array(t.split("").map(i=>i.charCodeAt(0))))};var tt,T,Z,et,Wt,ze=class extends At{constructor(t){super(),r(this,et),r(this,tt,void 0),r(this,T,new ArrayBuffer(u(2,16))),r(this,Z,new Uint8Array(e(this,T))),d(this,tt,t)}write(t){h(this,et,Wt).call(this,this.pos+t.byteLength),e(this,Z).set(t,this.pos),this.pos+=t.byteLength}finalize(){h(this,et,Wt).call(this,this.pos),e(this,tt).buffer=e(this,T).slice(0,this.pos)}};tt=new WeakMap;T=new WeakMap;Z=new WeakMap;et=new WeakSet;Wt=function(t){let i=e(this,T).byteLength;for(;i<t;)i*=2;if(i===e(this,T).byteLength)return;let s=new ArrayBuffer(i),a=new Uint8Array(s);a.set(e(this,Z),0),d(this,T,s),d(this,Z,a)};var O,C,it,st,re=class extends At{constructor(t,i){super(),r(this,O,void 0),r(this,C,[]),r(this,it,0),r(this,st,void 0),d(this,O,t),d(this,st,i)}write(t){e(this,C).push({data:t.slice(),start:this.pos}),this.pos+=t.byteLength}flush(){if(e(this,C).length===0)return;let t=[],i=[...e(this,C)].sort((s,a)=>s.start-a.start);t.push({start:i[0].start,size:i[0].data.byteLength});for(let s=1;s<i.length;s++){let a=t[t.length-1],n=i[s];n.start<=a.start+a.size?a.size=Math.max(a.size,n.start+n.data.byteLength-a.start):t.push({start:n.start,size:n.data.byteLength})}for(let s of t){s.data=new Uint8Array(s.size);for(let a of e(this,C))s.start<=a.start&&a.start<s.start+s.size&&s.data.set(a.data,a.start-s.start);if(e(this,st)&&s.start<e(this,it))throw new Error("Internal error: Monotonicity violation.");e(this,O).onData(s.data,s.start),d(this,it,s.start+s.data.byteLength)}e(this,C).length=0}finalize(){var t,i;(i=(t=e(this,O)).onDone)==null||i.call(t)}};O=new WeakMap;C=new WeakMap;it=new WeakMap;st=new WeakMap;var Le=u(2,24),Ae=2,D,m,_,nt,ht,ot,Ct,Pt,ne,Vt,he,N,lt,oe=class extends At{constructor(t,i){var s,a;if(super(),r(this,ot),r(this,Pt),r(this,Vt),r(this,N),r(this,D,void 0),r(this,m,void 0),r(this,_,[]),r(this,nt,0),r(this,ht,void 0),d(this,D,t),d(this,m,(a=(s=t.options)==null?void 0:s.chunkSize)!=null?a:Le),d(this,ht,i),!Number.isInteger(e(this,m))||e(this,m)<u(2,10))throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(t){h(this,ot,Ct).call(this,t,this.pos),h(this,N,lt).call(this),this.pos+=t.byteLength}finalize(){var t,i;h(this,N,lt).call(this,!0),(i=(t=e(this,D)).onDone)==null||i.call(t)}};D=new WeakMap;m=new WeakMap;_=new WeakMap;nt=new WeakMap;ht=new WeakMap;ot=new WeakSet;Ct=function(t,i){let s=e(this,_).findIndex(w=>w.start<=i&&i<w.start+e(this,m));s===-1&&(s=h(this,Vt,he).call(this,i));let a=e(this,_)[s],n=i-a.start,c=t.subarray(0,Math.min(e(this,m)-n,t.byteLength));a.data.set(c,n);let p={start:n,end:n+c.byteLength};if(h(this,Pt,ne).call(this,a,p),a.written[0].start===0&&a.written[0].end===e(this,m)&&(a.shouldFlush=!0),e(this,_).length>Ae){for(let w=0;w<e(this,_).length-1;w++)e(this,_)[w].shouldFlush=!0;h(this,N,lt).call(this)}c.byteLength<t.byteLength&&h(this,ot,Ct).call(this,t.subarray(c.byteLength),i+c.byteLength)};Pt=new WeakSet;ne=function(t,i){let s=0,a=t.written.length-1,n=-1;for(;s<=a;){let c=Math.floor(s+(a-s+1)/2);t.written[c].start<=i.start?(s=c+1,n=c):a=c-1}for(t.written.splice(n+1,0,i),(n===-1||t.written[n].end<i.start)&&n++;n<t.written.length-1&&t.written[n].end>=t.written[n+1].start;)t.written[n].end=Math.max(t.written[n].end,t.written[n+1].end),t.written.splice(n+1,1)};Vt=new WeakSet;he=function(t){let s={start:Math.floor(t/e(this,m))*e(this,m),data:new Uint8Array(e(this,m)),written:[],shouldFlush:!1};return e(this,_).push(s),e(this,_).sort((a,n)=>a.start-n.start),e(this,_).indexOf(s)};N=new WeakSet;lt=function(t=!1){for(let i=0;i<e(this,_).length;i++){let s=e(this,_)[i];if(!(!s.shouldFlush&&!t)){for(let a of s.written){if(e(this,ht)&&s.start+a.start<e(this,nt))throw new Error("Internal error: Monotonicity violation.");e(this,D).onData(s.data.subarray(a.start,a.end),s.start+a.start),d(this,nt,s.start+a.end)}e(this,_).splice(i--,1)}}};var Pe=class extends oe{constructor(t,i){var s;super(new te((a,n)=>t.stream.write({type:"write",data:a,position:n}),void 0,{chunkSize:(s=t.options)==null?void 0:s.chunkSize}),i)}},I=1,dt=2,Ve=1,Fe=2,gt=u(2,15),ft=u(2,12),qt="https://github.com/Vanilagy/webm-muxer",le=6,de=5,xe=["strict","offset","permissive"],l,o,G,X,g,F,z,U,x,W,P,k,V,Q,y,v,R,H,K,$,q,ct,bt,fe,Et,ce,Ft,we,xt,ue,Ot,pe,Dt,_e,Nt,me,pt,Rt,_t,Ht,Kt,ge,L,Y,E,A,Tt,ke,Ut,ye,at,It,$t,ve,M,b,J,mt,wt,Yt,Zt,Me,ut,Gt,rt,Bt,Oe=class{constructor(t){r(this,bt),r(this,Et),r(this,Ft),r(this,xt),r(this,Ot),r(this,Dt),r(this,Nt),r(this,pt),r(this,_t),r(this,Kt),r(this,L),r(this,E),r(this,Tt),r(this,Ut),r(this,at),r(this,$t),r(this,M),r(this,J),r(this,wt),r(this,Zt),r(this,ut),r(this,rt),r(this,l,void 0),r(this,o,void 0),r(this,G,void 0),r(this,X,void 0),r(this,g,void 0),r(this,F,void 0),r(this,z,void 0),r(this,U,void 0),r(this,x,void 0),r(this,W,void 0),r(this,P,void 0),r(this,k,void 0),r(this,V,void 0),r(this,Q,0),r(this,y,[]),r(this,v,[]),r(this,R,void 0),r(this,H,void 0),r(this,K,-1),r(this,$,-1),r(this,q,void 0),r(this,ct,!1);var i;h(this,bt,fe).call(this,t),d(this,l,Ee({type:"webm",firstTimestampBehavior:"strict"},t)),this.target=t.target;let s=!!e(this,l).streaming;if(t.target instanceof Ie)d(this,o,new ze(t.target));else if(t.target instanceof te)d(this,o,(i=t.target.options)!=null&&i.chunked?new oe(t.target,s):new re(t.target,s));else if(t.target instanceof Be)d(this,o,new Pe(t.target,s));else throw new Error(`Invalid target: ${t.target}`);h(this,Et,ce).call(this)}addVideoChunk(t,i,s){let a=new Uint8Array(t.byteLength);t.copyTo(a),this.addVideoChunkRaw(a,t.type,s??t.timestamp,i)}addVideoChunkRaw(t,i,s,a){if(h(this,rt,Bt).call(this),!e(this,l).video)throw new Error("No video track declared.");e(this,R)===void 0&&d(this,R,s),a&&h(this,Tt,ke).call(this,a);let n=h(this,at,It).call(this,t,i,s,I);for(e(this,l).video.codec==="V_VP9"&&h(this,Ut,ye).call(this,n),d(this,K,n.timestamp);e(this,v).length>0&&e(this,v)[0].timestamp<=n.timestamp;){let c=e(this,v).shift();h(this,M,b).call(this,c)}!e(this,l).audio||n.timestamp<=e(this,$)?h(this,M,b).call(this,n):e(this,y).push(n),h(this,L,Y).call(this)}addAudioChunk(t,i,s){let a=new Uint8Array(t.byteLength);t.copyTo(a),this.addAudioChunkRaw(a,t.type,s??t.timestamp,i)}addAudioChunkRaw(t,i,s,a){if(h(this,rt,Bt).call(this),!e(this,l).audio)throw new Error("No audio track declared.");e(this,H)===void 0&&d(this,H,s),a?.decoderConfig&&(e(this,l).streaming?d(this,W,h(this,J,mt).call(this,a.decoderConfig.description)):h(this,wt,Yt).call(this,e(this,W),a.decoderConfig.description));let n=h(this,at,It).call(this,t,i,s,dt);for(d(this,$,n.timestamp);e(this,y).length>0&&e(this,y)[0].timestamp<=n.timestamp;){let c=e(this,y).shift();h(this,M,b).call(this,c)}!e(this,l).video||n.timestamp<=e(this,K)?h(this,M,b).call(this,n):e(this,v).push(n),h(this,L,Y).call(this)}finalize(){for(;e(this,y).length>0;)h(this,M,b).call(this,e(this,y).shift());for(;e(this,v).length>0;)h(this,M,b).call(this,e(this,v).shift());if(e(this,l).streaming||h(this,ut,Gt).call(this),e(this,o).writeEBML(e(this,P)),!e(this,l).streaming){let t=e(this,o).pos,i=e(this,o).pos-e(this,E,A);e(this,o).seek(e(this,o).offsets.get(e(this,G))+4),e(this,o).writeEBMLVarInt(i,le),e(this,z).data=new Lt(e(this,Q)),e(this,o).seek(e(this,o).offsets.get(e(this,z))),e(this,o).writeEBML(e(this,z)),e(this,g).data[0].data[1].data=e(this,o).offsets.get(e(this,P))-e(this,E,A),e(this,g).data[1].data[1].data=e(this,o).offsets.get(e(this,X))-e(this,E,A),e(this,g).data[2].data[1].data=e(this,o).offsets.get(e(this,F))-e(this,E,A),e(this,o).seek(e(this,o).offsets.get(e(this,g))),e(this,o).writeEBML(e(this,g)),e(this,o).seek(t)}h(this,L,Y).call(this),e(this,o).finalize(),d(this,ct,!0)}};l=new WeakMap;o=new WeakMap;G=new WeakMap;X=new WeakMap;g=new WeakMap;F=new WeakMap;z=new WeakMap;U=new WeakMap;x=new WeakMap;W=new WeakMap;P=new WeakMap;k=new WeakMap;V=new WeakMap;Q=new WeakMap;y=new WeakMap;v=new WeakMap;R=new WeakMap;H=new WeakMap;K=new WeakMap;$=new WeakMap;q=new WeakMap;ct=new WeakMap;bt=new WeakSet;fe=function(t){if(t.type&&t.type!=="webm"&&t.type!=="matroska")throw new Error(`Invalid type: ${t.type}`);if(t.firstTimestampBehavior&&!xe.includes(t.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`)};Et=new WeakSet;ce=function(){h(this,Ft,we).call(this),e(this,l).streaming||h(this,Dt,_e).call(this),h(this,Nt,me).call(this),h(this,xt,ue).call(this),h(this,Ot,pe).call(this),e(this,l).streaming||(h(this,pt,Rt).call(this),h(this,_t,Ht).call(this)),h(this,Kt,ge).call(this),h(this,L,Y).call(this)};Ft=new WeakSet;we=function(){var t;let i={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:(t=e(this,l).type)!=null?t:"webm"},{id:17031,data:2},{id:17029,data:2}]};e(this,o).writeEBML(i)};xt=new WeakSet;ue=function(){d(this,x,{id:236,size:4,data:new Uint8Array(ft)}),d(this,W,{id:236,size:4,data:new Uint8Array(ft)})};Ot=new WeakSet;pe=function(){d(this,U,{id:21936,data:[{id:21937,data:2},{id:21946,data:2},{id:21947,data:2},{id:21945,data:0}]})};Dt=new WeakSet;_e=function(){const t=new Uint8Array([28,83,187,107]),i=new Uint8Array([21,73,169,102]),s=new Uint8Array([22,84,174,107]);d(this,g,{id:290298740,data:[{id:19899,data:[{id:21419,data:t},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:i},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:s},{id:21420,size:5,data:0}]}]})};Nt=new WeakSet;me=function(){let t={id:17545,data:new Lt(0)};d(this,z,t);let i={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:qt},{id:22337,data:qt},e(this,l).streaming?null:t]};d(this,X,i)};pt=new WeakSet;Rt=function(){let t={id:374648427,data:[]};d(this,F,t),e(this,l).video&&t.data.push({id:174,data:[{id:215,data:I},{id:29637,data:I},{id:131,data:Ve},{id:134,data:e(this,l).video.codec},e(this,x),e(this,l).video.frameRate?{id:2352003,data:1e9/e(this,l).video.frameRate}:null,{id:224,data:[{id:176,data:e(this,l).video.width},{id:186,data:e(this,l).video.height},e(this,l).video.alpha?{id:21440,data:1}:null,e(this,U)]}]}),e(this,l).audio&&(d(this,W,e(this,l).streaming?e(this,W)||null:{id:236,size:4,data:new Uint8Array(ft)}),t.data.push({id:174,data:[{id:215,data:dt},{id:29637,data:dt},{id:131,data:Fe},{id:134,data:e(this,l).audio.codec},e(this,W),{id:225,data:[{id:181,data:new Jt(e(this,l).audio.sampleRate)},{id:159,data:e(this,l).audio.numberOfChannels},e(this,l).audio.bitDepth?{id:25188,data:e(this,l).audio.bitDepth}:null]}]}))};_t=new WeakSet;Ht=function(){let t={id:408125543,size:e(this,l).streaming?-1:le,data:[e(this,l).streaming?null:e(this,g),e(this,X),e(this,F)]};d(this,G,t),e(this,o).writeEBML(t)};Kt=new WeakSet;ge=function(){d(this,P,{id:475249515,data:[]})};L=new WeakSet;Y=function(){e(this,o)instanceof re&&e(this,o).flush()};E=new WeakSet;A=function(){return e(this,o).dataOffsets.get(e(this,G))};Tt=new WeakSet;ke=function(t){if(t.decoderConfig){if(t.decoderConfig.colorSpace){let i=t.decoderConfig.colorSpace;if(d(this,q,i),e(this,U).data=[{id:21937,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[i.matrix]},{id:21946,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[i.transfer]},{id:21947,data:{bt709:1,bt470bg:5,smpte170m:6}[i.primaries]},{id:21945,data:[1,2][Number(i.fullRange)]}],!e(this,l).streaming){let s=e(this,o).pos;e(this,o).seek(e(this,o).offsets.get(e(this,U))),e(this,o).writeEBML(e(this,U)),e(this,o).seek(s)}}t.decoderConfig.description&&(e(this,l).streaming?d(this,x,h(this,J,mt).call(this,t.decoderConfig.description)):h(this,wt,Yt).call(this,e(this,x),t.decoderConfig.description))}};Ut=new WeakSet;ye=function(t){if(t.type!=="key"||!e(this,q))return;let i=0;if(B(t.data,0,2)!==2)return;i+=2;let s=(B(t.data,i+1,i+2)<<1)+B(t.data,i+0,i+1);i+=2,s===3&&i++;let a=B(t.data,i+0,i+1);if(i++,a)return;let n=B(t.data,i+0,i+1);if(i++,n!==0)return;i+=2;let c=B(t.data,i+0,i+24);if(i+=24,c!==4817730)return;s>=2&&i++;let p={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[e(this,q).matrix];Ue(t.data,i+0,i+3,p)};at=new WeakSet;It=function(t,i,s,a){let n=h(this,$t,ve).call(this,s,a);return{data:t,type:i,timestamp:n,trackNumber:a}};$t=new WeakSet;ve=function(t,i){let s=i===I?e(this,R):e(this,H),a=i===I?e(this,K):e(this,$);if(e(this,l).firstTimestampBehavior==="strict"&&a===-1&&t!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${t}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
If you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.
`);if(e(this,l).firstTimestampBehavior==="offset"&&(t-=s),t<a)throw new Error(`Timestamps must be monotonically increasing (went from ${a} to ${t}).`);return t};M=new WeakSet;b=function(t){e(this,l).streaming&&!e(this,F)&&(h(this,pt,Rt).call(this),h(this,_t,Ht).call(this));let i=Math.floor(t.timestamp/1e3);if(t.type!=="key"&&i-e(this,V)>=gt)throw new Error(`Current Matroska cluster exceeded its maximum allowed length of ${gt} milliseconds. In order to produce a correct WebM file, you must pass in a video key frame at least every ${gt} milliseconds.`);let a=(t.trackNumber===I||!e(this,l).video)&&t.type==="key"&&i-e(this,V)>=1e3;(!e(this,k)||a)&&h(this,Zt,Me).call(this,i);let n=new Uint8Array(4),c=new DataView(n.buffer);c.setUint8(0,128|t.trackNumber),c.setUint16(1,i-e(this,V),!1),c.setUint8(3,+(t.type==="key")<<7);let p={id:163,data:[n,t.data]};e(this,o).writeEBML(p),d(this,Q,Math.max(e(this,Q),i))};J=new WeakSet;mt=function(t){return{id:25506,size:4,data:new Uint8Array(t)}};wt=new WeakSet;Yt=function(t,i){let s=e(this,o).pos;e(this,o).seek(e(this,o).offsets.get(t)),t=[h(this,J,mt).call(this,i),{id:236,size:4,data:new Uint8Array(ft-2-4-i.byteLength)}],e(this,o).writeEBML(t),e(this,o).seek(s)};Zt=new WeakSet;Me=function(t){e(this,k)&&!e(this,l).streaming&&h(this,ut,Gt).call(this),d(this,k,{id:524531317,size:e(this,l).streaming?-1:de,data:[{id:231,data:t}]}),e(this,o).writeEBML(e(this,k)),d(this,V,t);let i=e(this,o).offsets.get(e(this,k))-e(this,E,A);e(this,P).data.push({id:187,data:[{id:179,data:t},e(this,l).video?{id:183,data:[{id:247,data:I},{id:241,data:i}]}:null,e(this,l).audio?{id:183,data:[{id:247,data:dt},{id:241,data:i}]}:null]})};ut=new WeakSet;Gt=function(){let t=e(this,o).pos-e(this,o).dataOffsets.get(e(this,k)),i=e(this,o).pos;e(this,o).seek(e(this,o).offsets.get(e(this,k))+4),e(this,o).writeEBMLVarInt(t,de),e(this,o).seek(i)};rt=new WeakSet;Bt=function(){if(e(this,ct))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};export{Ie as ArrayBufferTarget,Be as FileSystemWritableFileStreamTarget,Oe as Muxer,te as StreamTarget};
