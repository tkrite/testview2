const __vite__fileDeps=["./GLTFExporter@cbBE5ysc.js","./ddd@DwDq534T.js","./ddd@CX4D8d_4.css","./TextureUtils@YzsTNqKi.js","./OBJExporter@PqenuyH8.js","./MMDExporter@BBH_vGcK.js","./USDZExporter@C091FDda.js","./fflate.module@Do-qMP1X.js","./STLExporter@CINTP0JI.js","./PLYExporter@U95Wcqui.js","./DRACOExporter@m31_IZiN.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as f,C as r}from"./ddd@DwDq534T.js";var g={};function x(){let s=DMC.current.object?.getDDDProperties?.()?.source_file,u=window.file_browser?.current_link,a=window.is_electron,t=window.external_io,_=window.nodejs,m=null,l=null,n=null,e=null;if(s&&(l=s.slice(0,s.lastIndexOf("/")),n=s.split("/").pop(),e=n.slice(0,n.lastIndexOf("."))),l==null&&(l=u),a==!1&&t==null)return{error:"Required network storage."};if(a==!0&&t==null){if(l==null&&u==null&&(l=u),l==null)if(_)l=g.HOME||g.USERPROFILE;else return{error:"Web local filbe does not support save."};m=r.path.join(l,e||"untitled")}else a==!0&&t?m=r.path.join(l,e||"untitled"):a==!1&&t&&(m=r.path.join(l,e||"untitled"));return{error:null,path:m}}async function y(c,s){window.cross_file_system.write(c,s),UI.event_notify("Save as "+c),await r.screenshot(c,{type:"save",thumbnail:!0})}const d=new Map;async function v(c){await d[c]()}function b(c,s){function u(l){return`
		<tr><td style='text-align:right'>${l.key}</td><td style='text-align:left'><input class='${l.key}' value='${l.value}' style='margin-left:10px;text-align:center;width:100px'></td></tr>
		`}function a(l){return`
		<tr><td  style='text-align:right'>${l.key}</td><td style='text-align:left'><input class='${l.key}' style="margin-left:10px" type="checkbox" ${l.value?"checked":""}></td></tr>
		`}let t={number_box:u,check_box:a};return`
	<div style='display:flex;align-items:center;justify-content:center;margin-top:10px;margin-bottom:10px;'><table id="exporter_parameters">${`<div>${s.map(l=>t[l.type](l)).join("")}</div>`}</table></div>
	<div style='display:flex;align-items:center;justify-content:center;margin-top:10px;margin-bottom:10px;'>Path <input id="exporter_url_path" style="margin-left:10px;padding-left:5px;width:80%" value="${c}"></div>
	`}d.gltf=async function(){return new Promise(async function(c,s){if(console.log("export_as_gltf"),DMC.current.object){const{GLTFExporter:u}=await f(()=>import("./GLTFExporter@cbBE5ysc.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),a=new u;let t={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!0,embedImages:!0,maxTextureSize:4096,animations:!1,forceIndices:!0,includeCustomExtensions:!1},_=DMC.current.object,m=x().path,l=[];for(let n in t){let e=t[n],i="number_box";typeof e=="boolean"&&(i="check_box"),l.push({key:n,value:e,type:i})}r.modal_ok_cancel("Export as glTF",b(m,l),{ok:"Export",prevent_input:!1},async n=>{if(n==!1){c();return}let e=document.getElementById("exporter_url_path").value,i=document.getElementById("exporter_parameters");for(let o in t){let p=i.querySelector("input."+o);p.type=="checkbox"?t[o]=p.checked:t[o]=Number(p.value)}t.animations?t.animations=_.gltf.animations:delete t.animations,console.warn(t),r.modal_processing("Exporting","");try{a.parse(_,async function(o){console.log("Parsed");let p=null;o instanceof ArrayBuffer?(e+=".glb",p=o):(e+=".gltf",p=JSON.stringify(o,null,2)),await y(e,p),r.close_modal_processing(),c()},o=>{r.close_modal_processing(),s(o)},t)}catch(o){r.close_modal_processing(),s(o)}})}else s("Select object before export.")})};d.obj=function(){return new Promise(async function(c,s){if(console.log("export_as_obj"),DMC.current.object){const{OBJExporter:u}=await f(()=>import("./OBJExporter@PqenuyH8.js"),__vite__mapDeps([4,1,2]),import.meta.url),a=new u;let t={},_=DMC.current.object,m=x().path,l=[];for(let n in t){let e=t[n],i="number_box";typeof e=="boolean"&&(i="check_box"),l.push({key:n,value:e,type:i})}r.modal_ok_cancel("Export as obj(WaveFrontObject)",b(m+".obj",l),{ok:"Export"},async n=>{if(n==!1){c();return}let e=document.getElementById("exporter_url_path").value;e.slice(e.length-4,e.length)!=".obj"&&(e+=".obj");let i=document.getElementById("exporter_parameters");for(let o in t){let p=i.querySelector("input."+o);p.type=="checkbox"?t[o]=p.checked:t[o]=Number(p.value)}console.warn(t),r.modal_processing("Exporting","");try{await r.sleep(100);let o=a.parse(_);await y(e,o),r.close_modal_processing(),c()}catch(o){r.close_modal_processing(),s(o)}})}else s("Select object before export.")})};d.vpd=function(){return new Promise(async function(c,s){if(console.log("export_as_vpd"),DMC.current.object){const{MMDExporter:u}=await f(()=>import("./MMDExporter@BBH_vGcK.js"),__vite__mapDeps([5,1,2]),import.meta.url),a=new u;let t={},_=DMC.current.object,m=x().path,l=[];for(let n in t){let e=t[n],i="number_box";typeof e=="boolean"&&(i="check_box"),l.push({key:n,value:e,type:i})}r.modal_ok_cancel("Export as vpd(MMD Pose)",b(m+".vpd",l),{ok:"Export"},async n=>{if(n==!1){c();return}let e=document.getElementById("exporter_url_path").value;e.slice(e.length-4,e.length)!=".vpd("&&(e+=".vpd(");let i=document.getElementById("exporter_parameters");for(let o in t){let p=i.querySelector("input."+o);p.type=="checkbox"?t[o]=p.checked:t[o]=Number(p.value)}console.warn(t),r.modal_processing("Exporting","");try{await r.sleep(100);let o=a.parseVpd(_,!0,!0);await y(e,o),r.close_modal_processing(),c()}catch(o){r.close_modal_processing(),s(o)}})}else s("Select object before export.")})};d.usdz=async function(){return new Promise(async function(c,s){if(console.log("export_as_usdz"),DMC.current.object){const{USDZExporter:u}=await f(()=>import("./USDZExporter@C091FDda.js"),__vite__mapDeps([6,1,2,7,3]),import.meta.url),a=new u;let t={},_=DMC.current.object,m=x().path,l=[];for(let n in t){let e=t[n],i="number_box";typeof e=="boolean"&&(i="check_box"),l.push({key:n,value:e,type:i})}r.modal_ok_cancel("Export as USDZ",b(m+".usdz",l),{ok:"Export"},async n=>{if(n==!1){c();return}let e=document.getElementById("exporter_url_path").value;e.slice(e.length-5,e.length)!=".usdz"&&(e+=".usdz");let i=document.getElementById("exporter_parameters");for(let o in t){let p=i.querySelector("input."+o);p.type=="checkbox"?t[o]=p.checked:t[o]=Number(p.value)}console.warn(t),r.modal_processing("Exporting","");try{await r.sleep(100);let o=await a.parse(_);await y(e,o),r.close_modal_processing(),c()}catch(o){r.close_modal_processing(),s(o)}})}else s("Select object before export.")})};d.stl=async function(){return new Promise(async(c,s)=>{if(console.log("export_as_stl"),DMC.current.object){const{STLExporter:u}=await f(()=>import("./STLExporter@CINTP0JI.js"),__vite__mapDeps([8,1,2]),import.meta.url),a=new u;let t={binary:!1},_=DMC.current.object,m=x().path,l=[];for(let n in t){let e=t[n],i="number_box";typeof e=="boolean"&&(i="check_box"),l.push({key:n,value:e,type:i})}r.modal_ok_cancel("Export as stl",b(m+".stl",l),{ok:"Export"},async n=>{if(n==!1){c();return}let e=document.getElementById("exporter_url_path").value;e.slice(e.length-4,e.length)!=".stl"&&(e+=".stl");let i=document.getElementById("exporter_parameters");for(let o in t){let p=i.querySelector("input."+o);p.type=="checkbox"?t[o]=p.checked:t[o]=Number(p.value)}console.warn(t),r.modal_processing("Exporting","");try{await r.sleep(100);let o=a.parse(_);await y(e,o),r.close_modal_processing(),c()}catch(o){r.close_modal_processing(),s(o)}})}else s("Select object before export.")})};d.ply=function(){return new Promise(async(c,s)=>{if(console.log("export_as_ply"),DMC.current.object){const{PLYExporter:u}=await f(()=>import("./PLYExporter@U95Wcqui.js"),__vite__mapDeps([9,1,2]),import.meta.url),a=new u;let t={binary:!1,littleEndian:!1},_=DMC.current.object,m=x().path,l=[];for(let n in t){let e=t[n],i="number_box";typeof e=="boolean"&&(i="check_box"),l.push({key:n,value:e,type:i})}r.modal_ok_cancel("Export as ply(Polygon File Format)",b(m+".ply",l),{ok:"Export"},async n=>{if(n==!1){c();return}let e=document.getElementById("exporter_url_path").value;e.slice(e.length-4,e.length)!=".ply"&&(e+=".ply");let i=document.getElementById("exporter_parameters");for(let o in t){let p=i.querySelector("input."+o);p.type=="checkbox"?t[o]=p.checked:t[o]=Number(p.value)}console.warn(t),r.modal_processing("Exporting","");try{await r.sleep(100);let o=a.parse(_);await y(e,o),r.close_modal_processing(),c()}catch(o){r.close_modal_processing(),s(o)}})}else s("Select object before export.")})};d.draco=async function(){if(console.log("export_as_draco"),DMC.current.object){const{DRACOExporter:c}=await f(()=>import("./DRACOExporter@m31_IZiN.js"),__vite__mapDeps([10,1,2]),import.meta.url),s=new c,u=DMC.current.object;let a=window.file_browser?.current_link||u.getDDDProperties?.().source_file;if(a==null||a.length==0)if(window.nodejs)a=g.HOME||g.USERPROFILE;else{r.modal_ok_cancel("Error","Web local file does not support save.",{cancel:null});return}if(a=a.replace(/\//g,"/"),u.name.split(".").shift().length==0){r.modal_ok_cancel("Invalid","Invalid name.",{cancel:null});return}a.length>0&&(a[a.length-1]=="/"?a+=u.name:a+="/"+u.name),console.log(a),r.modal_processing("Exporting","");let _=s.parse(u);nodejs.fs.writeFileSync(a+".drc",_),r.close_modal_processing()}};export{v as export_as};
